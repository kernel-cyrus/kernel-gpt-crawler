        <!DOCTYPE html>
        <html lang="en">
        <head><title>Removing the Linux /dev/random blocking pool [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/808575/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/808497/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/808575/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Removing the Linux /dev/random blocking pool</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>This article brought to you by LWN subscribers</b>
<p>
Subscribers to LWN.net made this article &mdash; and everything that
       surrounds it &mdash; possible.  If you appreciate our content, please
       <a href="/Promo/nst-nag3/subscribe">buy a subscription</a> and make the next
       set of articles possible.
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>January 7, 2020</br>
           </div>
<p>
The random-number generation facilities in the kernel have been reworked
some over the past few months—but problems in that subsystem have been
addressed over an <a 
href="/Kernel/Index/#Random_numbers">even longer time frame</a>.  The <a
href="/Articles/802360/">most 
recent changes</a> were made to stop the <tt>getrandom()</tt> system call from
blocking for long periods of time at system boot, but the underlying cause
was the behavior of the blocking random pool.  A recent patch set would
remove that pool and it would seem to be headed for the mainline kernel.
</p>

<p>
Andy Lutomirski <a
href="/ml/linux-kernel/cover.1577088521.git.luto@kernel.org/">posted</a>
version&nbsp;3 of the patch set toward the end of December.  It makes
"<q>two major semantic changes to Linux's random APIs</q>".  It adds
a new <tt>GRND_INSECURE</tt> flag to the <a
href="http://man7.org/linux/man-pages/man2/getrandom.2.html"><tt>getrandom()</tt></a>
system call (though Lutomirski refers to it as <tt>getentropy()</tt>, which
is implemented in glibc using <tt>getrandom()</tt> with fixed flags); that
flag would cause the call to always return the amount of 
data requested, but with no guarantee that the data is random.  The kernel
would just make its best effort to give the best random data it has at that
point in time.  "<q>Calling it 'INSECURE' is
probably the best we can do to discourage using this API for things
that need security.</q>"
</p>

<p>
The patches also remove the blocking pool.  The kernel currently maintains
two pools of random data, one that corresponds to <tt>/dev/random</tt> and
another for <tt>/dev/urandom</tt>, as described in this <a
href="/Articles/658497/">2015 article</a>.  The blocking pool is the one
for <tt>/dev/random</tt>; reads to that device will block (thus the name)
until "enough" entropy has been gathered from the system to satisfy the
request.
Further reads from that file will also block if there is
insufficient entropy in the pool.
</p>

<p>
Removing the blocking pool means that reads from <tt>/dev/random</tt> behave
like <tt>getrandom()</tt> with a <tt>flags</tt> value of zero (and turns
the <tt>GRND_RANDOM</tt> flag into a noop).  Once the cryptographic
random-number generator (CRNG) has been initialized, reads from
<tt>/dev/random</tt> and calls to <tt>getrandom(...,&nbsp;0)</tt> will not
block and will return the requested amount of random data.  Lutomirski said:
<div class="BigQuote">
I believe that Linux's blocking pool has outlived its usefulness.
Linux's CRNG generates output that is good enough to use even for
key generation.  The blocking pool is not stronger in any material
way, and keeping it around requires a lot of infrastructure of
dubious value.
</div>
</p>

<p>
The changes were made with an eye toward ensuring that existing programs
are not really affected; in fact, the problems with long waits for things
like generating GnuPG keys will get better.
<div class="BigQuote">
This series should not break any existing programs.  /dev/urandom is
unchanged.  /dev/random will still block just after booting, but it
will block less than it used to.  getentropy() with existing flags
will return output that is, for practical purposes, just as strong
as before.
</div>
</p>

<p>
Lutomirski noted that there is still the open question of whether the
kernel should provide so-called "true random numbers", which is, to a
certain extent, what the blocking pool was meant to do.  He can only see
one reason to do so: "<q>compliance with government standards</q>".
He suggested that if the kernel were to provide that, it should be done
through an entirely different interface—or be punted to user space by
providing a way for it to extract raw event samples that could be used to create
such a blocking pool.
</p>

<p>
Stephan Müller <a
href="/ml/linux-kernel/9872655.prSdhymlXK@positron.chronox.de/">suggested</a>
that his Linux random-number generator (LRNG) <a
href="/ml/linux-kernel/2722222.P16TYeLAVu%40positron.chronox.de/">patch
set</a> (now up to version&nbsp;26) might be a way to provide true random
numbers for applications that need them.  The LRNG is "<q>fully
compliant to <a
href="https://csrc.nist.gov/publications/detail/sp/800-90b/final">SP800-90B</a>
requirements</q>", which makes it a solution to the
governmental-standards problem.
Matthew Garrett <a
href="/ml/linux-kernel/20191226100334.bsh3b3dphs4j4cvx@srcf.ucam.org/">objected</a>
to the term "true random data", noting that the devices being sampled
could, in principle, be modeled accurately enough to make them predictable:
"<q>We're not sampling  
quantum events here.</q>"  Müller <a
href="/ml/linux-kernel/8794771.pXx7ivobnm@tauon.chronox.de/">said</a> that
the term comes from the German AIS&nbsp;31 standard to describe a
random-number generator that only produces output "<q>at an equal rate as the underlying 
noise source produces entropy</q>".
</p>

<p>
Beyond the terminology, though, having a blocking pool as is proposed by
the LRNG patches will just lead to various problems, at
least if it is available without privilege, Lutomirski <a
href="/ml/linux-kernel/888017FA-06A1-42EF-9FC0-46629138DA9E@amacapital.net/">said</a>:
<div class="BigQuote">
This doesn’t solve the problem. If two different users run stupid programs
like gnupg, they will starve each other. 
<p>
As I see it, there are two major problems with /dev/random right now: it’s
prone to DoS (i.e. starvation, malicious or otherwise), and, because no
privilege is required, it’s prone to misuse. Gnupg is misuse, full stop. If
we add a new unprivileged interface, gnupg and similar programs will use
it, and we lose all over again.
</div>
</p>

<p>
Müller <a
href="/ml/linux-kernel/4820831.xlnk3tY4r2@tauon.chronox.de/">noted</a> that
the addition of <tt>getrandom()</tt> will now allow GnuPG to use that
interface since it will provide the needed guarantee that the pool
has been initialized.  From discussions with GnuPG maintainer Werner Koch,
Müller believes that guarantee is the only reason GnuPG currently reads directly from
<tt>/dev/random</tt>.  But if there is an unprivileged interface that is
subject to denial of service (like <tt>/dev/random</tt> today), it will be
misused by some applications, Lutomirski <a
href="/ml/linux-kernel/E464D551-1631-4EA8-ADFB-852E16D29CA9@amacapital.net/">asserted</a>. 
</p>

<p>
Theodore Y. Ts'o, who is the maintainer of the Linux random-number
subsystem, appears to have changed his mind along the way about the
need for a blocking pool.  He <a
href="/ml/linux-kernel/20191226140423.GB3158@mit.edu/">said</a> that
removing that pool would effectively get rid of the idea that Linux has a
true random-number generator (TRNG), which "<q>is not
insane; this is what the *BSD's have always done</q>".  He, too, is <a
href="/ml/linux-kernel/20191227130436.GC70060@mit.edu/">concerned</a> that
providing a TRNG mechanism will just serve as an attractant for application
developers.  He also thinks that it is not really possible to
guarantee a TRNG in the kernel, given all of the different types of
hardware supported by Linux.
Even making the facility only available to root will not solve the problem:
<div class="BigQuote">
 Application programmers
would give instructions requiring that their application be installed
as root to be more secure, "because that way you can get access the
_really_ good random numbers".
</div>
</p>

<p>
Müller <a
href="/ml/linux-kernel/15817620.rmTN4T87Wr@tauon.chronox.de/">asked</a> if
Ts'o was giving up on the blocking pool implementation that he had added long
ago.  Ts'o <a
href="/ml/linux-kernel/20191227220857.GD70060@mit.edu/">agreed</a> that he
was; he is planning to take the patches from Lutomirski and is pretty
strongly opposed to adding a blocking interface back into the kernel.
<div class="BigQuote">
The kernel can't offer up any guarantees about whether
or not the noise source has been appropriately characterized.  All
say, a GPG or OpenSSL developer can do is get the vague sense that
TRUERANDOM is "better" and of course, they want the best security, so
of *course* they are going to try to use it.  At which point it will
block, and when some other clever user (maybe a distro release
engineer) puts it into an init script, then systems will stop working
and users will complain to Linus.
</div>
</p>

<p>
For cryptographers and others who really <i>need</i> a TRNG, Ts'o is also
in favor of providing them a way to collect their own entropy in user space
to use as they see fit.  Entropy collection is not something that the
kernel can reliably do on all of the different hardware that it supports,
nor can it estimate the amount of entropy provided by the different
sources, he said.
<div class="BigQuote">
The kernel shouldn't be mixing various noise sources together, and it
certainly shouldn't be trying to claim that it knows how many bits of
entropy that it gets when [it] is trying to play some jitter entropy game
on a stupid-simple CPU architecture for IOT/Embedded user cases where
everything is synchronized off of a single master oscillator, and
there is no CPU instruction reordering or register renaming, etc.,
etc.
<p>
You can talk about providing tools that try to make these estimations
--- but these sorts of things would have to be done on each user's
hardware, and for most distro users, it's just not practical.
<p>
So if it's just for cryptographers, then let it all be done in
userspace, and let's not make it easy for GPG, OpenSSL, etc., to all
say, "We want TrueRandom(tm); we won't settle for less".  We can talk
about how do we provide the interfaces so that those cryptographers
can get the information they need so they can get access to the raw
noise sources, separated out and named, and with possibly some way
that the noise source can authenticate itself to the Cryptographer's
userspace library/application.
</div>
</p>

<p>
There was a bit of discussion about how that interface might look; there
may be security implications for some of the events, for example. Ts'o <a
href="/ml/linux-kernel/20191229144904.GB7177@mit.edu/">noted</a> that the
keyboard scan codes (i.e. the keys pressed) are mixed into the pool as
part of the entropy collection. "<q>Exposing this to userspace, even if
it is via a privileged system 
call, would be... unwise.</q>"  It does seem possible that other event
timings could provide some kind of side-channel information leak as well.
</p>

<p>
So it would seem that a longtime feature of the Linux random-number
subsystem is on its way out.
Given the changes that the random-number subsystem have undergone recently,
it effectively was only causing denial-of-service problems when it was
used; there are now better ways to get the best random numbers that the
kernel can provide.
If a TRNG is still desired for Linux, that lack will need to be
addressed in the future, but likely will not be done within the kernel itself.
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Random_numbers">Random numbers</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/808575/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor808842"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 7, 2020 11:06 UTC (Tue)
                               by <b>cesarb</b> (subscriber, #6266)
                              [<a href="/Articles/808842/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I worry about using the same pool for the "block until fully initialized" and the "never blocks" interfaces. Suppose the pool has not been fully initialized yet, and has only four bits of entropy, which means it has only sixteen possible states; a malicious program can call the "never blocks" interface, and do a brute force search for the pool state. Then we add another four bits of entropy, the malicious program calls the "never blocks" interface again, and given the previous state (which the malicious program knows) there are again only sixteen possible states, which it can brute force search. Repeat until the pool is filled; while it's now supposed to have a number of possible states so huge that brute forcing the pool state is not viable (which is why we can allow drawing from it infinitely without waiting), the malicious program which observed it while it was being filled never had to brute force too much to know the full pool state.<br>
<p>
(The solution would probably be to still have two pools during initialization, one which is temporarily used only for the "never blocks" interfaces and is thrown away after the other one is fully initialized.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808842/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor808849"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 7, 2020 12:37 UTC (Tue)
                               by <b>hkario</b> (subscriber, #94864)
                              [<a href="/Articles/808849/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
are you sure the kernel mixes in just single bits? I thought that it mixed in the full input, it just credited it with few bits of entropy.<br>
<p>
and of course, the sources are underestimated for the amount of entropy provided<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808849/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor808855"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 7, 2020 13:34 UTC (Tue)
                               by <b>cesarb</b> (subscriber, #6266)
                              [<a href="/Articles/808855/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The entropy of the input matters. If the input has only 15 bits of unpredictability, it doesn't matter how large it is, how much it's mixed or what the entropy estimation was, there are only 32768 possible states (given an empty or known pool). If one reads 15 or more bits from the pool after that input, but before the next input, and the previous pool state is known, the current pool state can be guessed by trying the 32768 possible different values for the input, and seeing which one produces the output which was just read.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808855/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor808889"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 7, 2020 16:44 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/808889/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But what would happen after you add 40 more bits into the pool?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808889/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor808887"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 7, 2020 16:43 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/808887/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That's not exactly how it works.<br>
<p>
You can't reconstruct the state of the pool without storing all possible intermediate results. So if you want to reconstruct the pool state after 32 bits of entropy were added, you'd need a lookup table of at least 4Gb in size.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808887/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor808906"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 7, 2020 20:41 UTC (Tue)
                               by <b>nivedita76</b> (guest, #121790)
                              [<a href="/Articles/808906/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That is the point of how state extension attacks work. You may have added 32 bits of entropy, but if you added them 1 bit at a time while the attacker was reading the output of your RNG, you've lost.<br>
<p>
<a href="https://lwn.net/ml/linux-kernel/20190919143427.GQ6762@mit.edu/">https://lwn.net/ml/linux-kernel/20190919143427.GQ6762@mit...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808906/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor808854"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 7, 2020 13:45 UTC (Tue)
                               by <b>kooky</b> (subscriber, #92468)
                              [<a href="/Articles/808854/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I kind of agree.<br>
<p>
I my current job (system admin, database programmer), I've had some many problems  over the years caused  /dev/random blocking.    From CGI type programs which became fork rate limited, to java/tomcat not starting on virtual machines.  <br>
<p>
I solved the problem years ago by installing Entropykeys in every machine.   Now I do the same with chaoskeys. <br>
<p>
I'm not even sure if chaoskeys will actually do anything useful under the new system?<br>
<p>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808854/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor808903"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 7, 2020 19:14 UTC (Tue)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/808903/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I'm not even sure if chaoskeys will actually do anything useful under the new system?</font><br>
<p>
They're still mixing more entropy in, even if the kernel no longer bothers to block reads if there is insufficient entropy (after initialization). (AIUI, it can still block *additions* of entropy when there *is* believed to be sufficient entropy in the pool, so things like the chaoskey don't needlessly eat CPU time throwing entropy into the pool when it already probably has lots and nobody's using any of it.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808903/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor808864"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 7, 2020 15:19 UTC (Tue)
                               by <b>scientes</b> (guest, #83068)
                              [<a href="/Articles/808864/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Surprised no one has posted this yet: <a href="https://dilbert.com/strip/2001-10-25">https://dilbert.com/strip/2001-10-25</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808864/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor808867"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 7, 2020 15:52 UTC (Tue)
                               by <b>matthias</b> (subscriber, #94967)
                              [<a href="/Articles/808867/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And of course, this one also has to be posted: <a href="https://xkcd.com/221/">https://xkcd.com/221/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808867/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor808863"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 7, 2020 15:29 UTC (Tue)
                               by <b>gebi</b> (guest, #59940)
                              [<a href="/Articles/808863/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Entropy is a very sad story under linux (not directly kernel related!), imho needlessly so.<br>
<p>
First with haveged before rdrand became a thing and for vmware environments where rdrand is still not forwarded for various customer reasons.<br>
Then after the haveged period we would have used rng-tools from debian, but debian insists on it's own fork of rng-tools which did not support rdrand, thus back to a home-grown solution (<a href="https://github.com/mgit-at/rngd-rdrand">https://github.com/mgit-at/rngd-rdrand</a>, thx Ben Jencks :)! we just cleaned it up a bit and packaged it for debian).<br>
<p>
After that and for reasons like this we switched mostly to ubuntu and there it's just installing rng-tools (which is version 5 and supports rdrand) and be done.<br>
One newer debian systems one can now install rng-tools5 and also get the new upstream instead of the debian fork.<br>
<p>
In the end just have a small daemon running using rdrand to seed the pool and forget about all the problems.<br>
Except when they come back because of performance reasons and bite you.<br>
<p>
e.g: From a user point of view it would be nice to have a _fast_ /dev/random that never blocks, and delivers more than 1MB/s, but at least if it never blocks it's ok. But even the 160-200MB/s (1k vs 1M block size) of /dev/urandom could be faster (but for basic tasks it's ok :).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808863/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor808933"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 8, 2020 8:19 UTC (Wed)
                               by <b>k3ninho</b> (subscriber, #50375)
                              [<a href="/Articles/808933/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
rdrand is all good until you buy a CPU that answers the call with 0x00000000...0 [1].<br>
<p>
1: AMD's Ryzen 3 does, see <a href="https://arstechnica.com/gadgets/2019/10/how-a-months-old-amd-microcode-bug-destroyed-my-weekend/">https://arstechnica.com/gadgets/2019/10/how-a-months-old-...</a><br>
<p>
K3n.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808933/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor808944"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 8, 2020 13:30 UTC (Wed)
                               by <b>gebi</b> (guest, #59940)
                              [<a href="/Articles/808944/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For all practical purposes and when using rng-tools(5) it does not matter.<br>
The injected entropy is first encrypted with aes and rng-tools(5) has support for both rdrand and rdseed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808944/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor808953"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 8, 2020 15:44 UTC (Wed)
                               by <b>leromarinvit</b> (subscriber, #56850)
                              [<a href="/Articles/808953/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But a stream of encrypted 0's (or 0xFF, as seems to be the case here) still adds precisely as much entropy as the key has to the pool. And if a buggy RDRAND is your only source of "entropy" (I know that shouldn't happen in practice), then the entire stream of random numbers is trivially predictable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808953/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor808977"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 8, 2020 16:13 UTC (Wed)
                               by <b>gebi</b> (guest, #59940)
                              [<a href="/Articles/808977/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
exactly, so it's still just "For all practical purposes and when using rng-tools(5) it does not matter."<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808977/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor808909"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 7, 2020 21:32 UTC (Tue)
                               by <b>dkg</b> (subscriber, #55359)
                              [<a href="/Articles/808909/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      I'm surprised to see all the commentary about GnuPG and OpenSSL reading from <tt>/dev/random</tt>.
<p>
OpenSSL has traditionally read from <tt>/dev/urandom</tt> and for over a year now, GnuPG has <a href="https://dev.gnupg.org/T3894">been reading from the <tt>getrandom</tt> syscall even for key generation</a>.
      
          <div class="CommentReplyButton">
            <form action="/Articles/808909/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor808996"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 8, 2020 18:57 UTC (Wed)
                               by <b>ncultra</b> (<b>&#x272D; supporter &#x272D;</b>, #121511)
                              [<a href="/Articles/808996/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I also noticed it and felt it was unwarranted and showed not a small amount of hubris. Blaming developers for using a kernel facility that was made available to them is deflecting the problem. Ironically so, because it was the kernel (via ext4) that caused a blocking regression (DOS?) and started this work.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808996/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor809581"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2020 2:17 UTC (Wed)
                               by <b>luto</b> (subscriber, #39314)
                              [<a href="/Articles/809581/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This patch set actually predates the ext4 issue.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/809581/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor808921"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">the hardware RNG on a Raspberry Pi?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 8, 2020 1:05 UTC (Wed)
                               by <b>gus3</b> (guest, #61103)
                              [<a href="/Articles/808921/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For a while, I had connected the RPi's /dev/hwrng to a TCP port, just for laughs, to see if I could export a better entropy for my home network. It worked, until my desktop system failed and I lost the notes I'd taken.<br>
<p>
But this whole discussion suggests a more... *radical* possibility: a Raspberry Pi Zero, attached as a USB dongle, running dedicated kernel-level code to transmit entropy from the HWRNG to the USB bus. And on the host side, a kernel driver(?) to read the external entropy from the RPi Zero.<br>
<p>
Yes, the security cautions are numerous. But 95Kb/s of entropy, for less than $10, seems an avenue worth exploring.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808921/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor808924"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">small correction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 8, 2020 1:36 UTC (Wed)
                               by <b>gus3</b> (guest, #61103)
                              [<a href="/Articles/808924/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
95KB/s, kilo*bytes* per second, not bits.<br>
<p>
FWIW, that's over 800 feet of randomly punched paper tape per second. ;-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808924/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor809226"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">the hardware RNG on a Raspberry Pi?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 11, 2020 14:39 UTC (Sat)
                               by <b>naptastic</b> (guest, #60139)
                              [<a href="/Articles/809226/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You might be interested in this:<br>
<p>
<a href="https://onerng.info/">https://onerng.info/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/809226/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor812687"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">the hardware RNG on a Raspberry Pi?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 18, 2020 1:42 UTC (Tue)
                               by <b>ttelford</b> (guest, #44176)
                              [<a href="/Articles/812687/">Link</a>] 
      </p>
      
      </div>
      </summary>
      You may be interested in the “entropybroker” package in Debian/Rasbpian, which lets you use one hardware RNG, and share it over a network.

The documentation is not so great, though.

Also: I like the bit babbler http://www.bitbabbler.org/


      
          <div class="CommentReplyButton">
            <form action="/Articles/812687/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor808932"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Removing the Linux /dev/random blocking pool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 8, 2020 7:40 UTC (Wed)
                               by <b>joib</b> (subscriber, #8541)
                              [<a href="/Articles/808932/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How does this all now work with the jitter RNG that was recently introduced?<br>
<p>
So this change makes /dev/random work mostly like getrandom(0). If there's not enough entropy, they will block until enough entropy has been generated (including by running the jitter RNG) to seed the CRNG? After the CRNG has been seeded, they never block.<br>
<p>
What about /dev/urandom? It will never block (including not kicking the jitter RNG into action?), so it will seed the CRNG with whatever entropy there is? This is the same as getrandom() with the new GRND_INSECURE flag? And then presumably some protection against state extension attacks?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/808932/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2020, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
