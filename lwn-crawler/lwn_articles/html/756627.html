        <!DOCTYPE html>
        <html lang="en">
        <head><title>Flash storage topics [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/756627/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/756105/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/756627/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Flash storage topics</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>June 6, 2018</br>
           <hr>
<a href="/Articles/lsfmm2018/">LSFMM</a>
</div>
<p>
At the 2018 Linux Storage, Filesystem, and Memory-Management Summit
(LSFMM), Jaegeuk Kim described some current issues for flash storage,
especially with regard to Android.  Kim is the <a
href="https://en.wikipedia.org/wiki/F2FS">F2FS</a> developer and
maintainer, and the filesystem-track session was ostensibly about that
filesystem.  In the end, though, the talk did not focus on F2FS and instead
ranged over a number of problem 
areas for Android flash storage. 
</p>

<p>
He started by noting that <a
href="https://en.wikipedia.org/wiki/Universal_Flash_Storage">Universal
Flash Storage</a> (UFS) devices have high read/write speeds, but can also have
high latency for some operations.  For example, ext4 will issue a discard
command but a UFS device might take ten seconds to process it.  That leads
the user to think that Android is broken, he said.
</p>

<a href="/Articles/756687/">
<img src="https://static.lwn.net/images/2018/lsf-kim-sm.jpg" border=0 hspace=5 align="right"
alt="[Jaegeuk Kim]" title="Jaegeuk Kim" width=240 height=260>
</a>

<p>
UFS devices have a "huge garbage-collection overhead".  When garbage
collection is needed, the performance of even sequential writes drops way
down.  That needs to be avoided, so UFS must be periodically given some time to do its
garbage collection.  But power is a more important consideration, so
hibernating the device is prioritized, which does not leave much time for
the device to do its garbage collection.
</p>

<p>
Amir Goldstein suggested doing garbage collection when the device is
charging; he thought that should provide a reasonable solution.  Kim said
that Android currently declares a ten-minute idle time at 2am that is used
to defragment the 
filesystem.  It could perhaps also be used for garbage collection.
</p>

<p>
The solution to the discard performance problem should be fairly
straightforward, he said.  A kernel thread (kthread) could be added to issue
discards asynchronously during idle time.  Candidate blocks could be added
to a list that would be processed by the kthread.  There is a race
condition if the
block gets reallocated, however.
</p>

<p>
Different UFS devices have different latencies for their cache-flush
commands.  Some vendors' devices have low latency but others have
ten-second latencies for a single cache-flush command.  Given that, it
makes sense to batch cache-flush commands.
</p>

<p>
Filesystem encryption is mandatory for Android.  It is present in ext4 and
has also been added to F2FS.  There is some hardware encryption code from
Qualcomm that cannot be pushed upstream, however.  Ted Ts'o said that it is
"horrible code" that only works for ext4 ecryptfs or F2FS; no one has had
time to clean it up for the mainline.
</p>

<p>
Kim would like to see the garbage collection on the device side get
optimized.  He would like to add a customized interface that can be called
when it is time to do garbage collection.  If the system can detect idle
time, it can then initiate the garbage-collection process.
</p>

<p>
SQLite performance is another problem area.  SQLite uses <tt>fsync()</tt>
to ensure its data has gotten to storage.  By default it uses a journal, so
writes to the database end up requiring two writes and two <tt>fsync()</tt>
calls (first for the journal and then to the final location).  Two <tt>fsync()</tt>
operations can be expensive and are not needed for F2FS because it is a
copy-on-write filesystem.  A feature has been added to SQLite to avoid one
write and one <tt>fsync()</tt> by using F2FS atomic writes.
</p>

<p>
In order to reduce the latency of <tt>fsync()</tt> calls, he is looking at
write barriers.  He researched them and found that they had been <a href="/Articles/400541/">removed
long ago</a>.  Kent Overstreet said they were removed due to unclear semantics,
especially for stacked filesystems.  In that case, the stack would have to
provide order guarantees for the BIOs all the way down the stack, which
would be difficult to do and would defeat the purpose of some of the
layers.  Beyond that, it is impossible to test to make sure that has been
done correctly.
</p>

<p>
But Kim said that the Android case would not involve device-mapper or other
stacking, he is just trying to avoid the cache-flush command.  Jan Kara
suggested a new storage command, like "issue barrier", that would cause
any I/O issued before the barrier to complete before any new I/O.
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems-Flash">Filesystems/Flash</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Storage_Filesystem_and_Memory-Management_Summit-2018">Storage, Filesystem, and Memory-Management Summit/2018</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/756627/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor756804"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 6, 2018 22:58 UTC (Wed)
                               by <b>Tobu</b> (subscriber, #24111)
                              [<a href="/Articles/756804/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      That "issue barrier" command would be a perfect fit for some databases.
Ensuring a given order is a lot faster than ensuring everything has been persisted to disk, and can be a sufficient guarantee in distributed systems.
      
          <div class="CommentReplyButton">
            <form action="/Articles/756804/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor756876"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 7, 2018 17:55 UTC (Thu)
                               by <b>drh</b> (guest, #65025)
                              [<a href="/Articles/756876/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A "write barrier" does indeed help things to run faster, though if you depend on write barrier rather than fsync(), you loss Durability on a power outage.  You still have Atomic, Consistent, and Isolated - the first three letters of ACID.  But you lose the D.<br>
<p>
On the other hand, many applications don't care so much about losing a little work during a power outages as long as everything comes back up in a sane state.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756876/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor756884"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 7, 2018 19:15 UTC (Thu)
                               by <b>andresfreund</b> (subscriber, #69562)
                              [<a href="/Articles/756884/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not necessarily. You can still get durability with barriers by waiting for the barrier to complete.  But IMHO barriers are more useful for things like flushing the write ahead log because you want to write out buffers, rather than WAL flushes due to commits. Usually you have to sync the log before writing out a buffer that's covered by not yet flushed entries. Barriers can make that a lot more efficient.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756884/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor756899"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 7, 2018 20:52 UTC (Thu)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/756899/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, agreed. ACI is quite fine for most applications. As long as the files are in one consistent state or another a bit of data loss is acceptable. <br>
<p>
It doesn't happen very often anyway. Between laptops with batteries and desktops with UPS most of my data loss comes from kernel bugs these days.<br>
<p>
Speaking of UPS, I never understood why someone would balk at spending $100 to protect a $1,000 computer. Bad power can cause nasty issues.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756899/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor756905"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 7, 2018 22:10 UTC (Thu)
                               by <b>k8to</b> (guest, #15413)
                              [<a href="/Articles/756905/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I would guess at an individually owned computer because they don't understand the realities and/or because it's another thing to deal with that they don't really want to.<br>
<p>
At an organizational level it's another thing to organize and do procurement and asset management for.  Which is basically the same type of dynamic just playing out at a different scale, but here sometimes the paperwork and human hours for the 1000$ computer are larger than 1000$ (and relatedly the paperwork for the UPS could be similar to the computer).<br>
<p>
It probably still makes sense in the long run, though maybe not if you go thoroughly in the cattle direction.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756905/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor756958"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 8, 2018 15:18 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/756958/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Speaking of UPS, I never understood why someone would balk at spending $100 to protect a $1,000 computer. Bad power can cause nasty issues.</font><br>
<p>
But UPSes are *also* a source of unreliability. If you have only a couple of power flickers a decade (as the UK used to until it privatized a lot of its electricity network and started skimping on maintenance), a UPS *worsens* reliability rather than improving it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756958/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor756960"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 8, 2018 15:33 UTC (Fri)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/756960/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I suppose?<br>
<p>
In my personal experience, while I have had UPS batteries go bad, which just happens every so many years, I haven't had a UPS actually fail. I have had more computer power supplies fail.<br>
<p>
And as for utility power, I don't understand how the UK could possibly be as reliable as you say. Perhaps I'm used to more spread out rural areas of Colorado, but with power lines on poles combined with extremely high winds (tornadoes sometimes) and lightning, and heavy wet snow, well, power is just going to go out every now and then. I really don't see how maintenance could help.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756960/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor756965"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 8, 2018 15:50 UTC (Fri)
                               by <b>karkhaz</b> (subscriber, #99844)
                              [<a href="/Articles/756965/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The weather is a lot more temperate in the UK than it is in Colorado. Neither tornadoes nor hurricanes form here, and as for heavy snow---well, people freaked out last winter when London was belaboured with five glorious centimeters of it, most years we get none. Personally, I've not in my entire life seen a single power outage in London.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756965/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor756972"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 8, 2018 16:42 UTC (Fri)
                               by <b>excors</b> (subscriber, #95769)
                              [<a href="/Articles/756972/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<a href="https://www.ukpowernetworks.co.uk/power-cut/map">https://www.ukpowernetworks.co.uk/power-cut/map</a> has a handy map - right now it appears to be reporting 4 unplanned power cuts in London, affecting about 82 customers, so outages are not totally unheard of. (Unfortunately they don't seem to have an obvious way to see historical data. My vague memories are of somewhere between maybe 0.5 and 2 outages per year, living in places outside London.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756972/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor757536"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 14, 2018 17:30 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/757536/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Admittedly I have only lived on the outskirts of London for pretty much my entire life, but there are - over that entire period - only three power outages that I can remember.<br>
<p>
After heavy rain, there was a landslip at a chalk pit that took out the local substation.<br>
<p>
At work, some robbers tried to blow their way into a bank vault, but in the process took out a major electricity supply cable.<br>
<p>
Some thieves tried to steal a copper power line (250KVA, I think) and took out a small town.<br>
<p>
Things like brownouts are pretty much unknown.<br>
<p>
So yes, in Britain MOST people MOST of the time never experience a problem. The only people who will see any need for a UPS are people who live near an industrial area where their neighbours are dirtying the supply. Outside of that, supply is both good and reliable, and short outages are almost unknown. If there's a problem, it's either with the house supply itself, or in the cases I've mentioned above it's a major but localised problem - at one day, the first problem was the one rectified the quickest of the above three. The second took a week, while the third left many homes without power for days ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/757536/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor757024"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 9, 2018 10:53 UTC (Sat)
                               by <b>anselm</b> (subscriber, #2796)
                              [<a href="/Articles/757024/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <blockquote><em>Neither tornadoes nor hurricanes form here</em></blockquote>
<p>
The UK Met Office would beg to disagree on tornadoes:
<blockquote>
<a href="https://www.metoffice.gov.uk/learning/wind/tornado">Around 30 tornadoes a year</a> are reported in the UK. These are typically small and short-lived, but can cause structural damage if they pass over built-up areas.
</blockquote>
Hurricanes in a literal sense don't occur in the UK a lot, but sometimes the “tail end” of a hurricane can end up in Britain as a destructive storm, like Hurricane Ophelia in October, 2017.
</p>
<p>
Given that overhead power lines are fairly common at least in rural areas of the UK, it would not be in the least surprising that storms (including hurricane remnants and tornadoes) caused occasional power outages.
</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/757024/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor757028"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 9, 2018 12:39 UTC (Sat)
                               by <b>mpr22</b> (subscriber, #60784)
                              [<a href="/Articles/757028/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      The UK has the most tornadoes per year of any country in Europe, and more tornadoes per square kilometre per year than any country in the world except the Netherlands. (I think it might even have more tornadoes per square kilometre per year than the region of the USA known as "Tornado Alley".)
      
          <div class="CommentReplyButton">
            <form action="/Articles/757028/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor757031"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 9, 2018 13:44 UTC (Sat)
                               by <b>karkhaz</b> (subscriber, #99844)
                              [<a href="/Articles/757031/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Cheers for these facts, I must admit to not knowing them despite enthusiastically following the hurricane season in the US.<br>
<p>
One thing that occurs to me, though, is that the sources for "highest number of tornadoes recorded per area" seem to have very population densities (Bangladesh is mentioned often, and the Netherlands and UK have the highest and third-highest densities of all the non-tiny European nations). This may be the reason that the reported numbers are so high for these countries: people are a lot more likely to see a tornado, even if it is too weak to cause significant damage, than in rural Tornado Alley. This is compounded by the fact that tornadoes are difficult to observe directly using radar, so tornado reports mostly come from people who have seen the tornado first-hand. And higher population densities lead to more frequent infrastructure that could suffer from noticeable damage, e.g. power lines, train tracks, etc.<br>
<p>
Also I wonder if people being acclimatized to huge tornadoes in Tornado Alley leads to people reporting less of the smaller ones: a relatively benign tornado that would have somebody in the UK scrambling to phone the Met Office might just be ignored by their cousin over the pond.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/757031/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor757247"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 12, 2018 6:14 UTC (Tue)
                               by <b>k8to</b> (guest, #15413)
                              [<a href="/Articles/757247/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wonder what the standards are for what qualifies as a tornado.<br>
<p>
In the United States northeast growing up, we had a number of minor twisters that no one thought to label "tornado".   If it only uprooted 30 trees or so, it was "just a twister".<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/757247/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor757252"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 12, 2018 6:34 UTC (Tue)
                               by <b>mpr22</b> (subscriber, #60784)
                              [<a href="/Articles/757252/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Wikipedia tells me that to qualify as a tornado, a weather phenomenon must involve a rotating wind column, reaching from ground level to the base of the overhead clouds, with surface wind speeds in excess of 40 mph (64 km/h).
      
          <div class="CommentReplyButton">
            <form action="/Articles/757252/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor756976"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 8, 2018 17:47 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/756976/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The power lines are only on poles in the UK in rural areas (villages and smaller): elsewhere they are usually underground and immune to most weather-related failures. Local stepdown transformers are not per-house, but cover a few blocks (so are much larger, much more expensive, and correspondingly much more *reliable*: they very rarely fail, and usually survive even direct lightning strikes). Every significant power station is required to be able to restart under its own steam, too, so we don't have cascading failures where big chunks of the grid go offline and can't come back on because they themselves need grid power.<br>
<p>
Long-distance high-voltage cross-country lines and lines leaving rural power stations *are* up in the air, but it takes a hell of a lot of wind to knock down one of *those* monster pylons (again, it more or less never happens unless a tree falls on the lines, and they are usually routed away from trees for exactly that reason). It does happen, but because these are high-voltage lines there is almost always fallback from elsewhere in the grid if one is hit, unless there has been a *major* storm and numerous of them have been taken out at once. (Again, this affects major conurbations essentially never: distant rural Scotland, or single small towns that might have only one or two incoming lines, sure, but nothing larger.)<br>
<p>
I am unhappy with the current state of the UK power network. I've had two flickers in the last decade, and checking my supplier's logs I see one five-minute outage! This is awful: in the decades of the 1990s and 2000s I had none at all. It's hard to justify a UPS with reliability like that. (Note: in the same time window we had a half-*day* water outage, when a farmer drove a plough through a 6in supply pipe and de-watered half the town...)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756976/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor758503"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 28, 2018 11:32 UTC (Thu)
                               by <b>jospoortvliet</b> (guest, #33164)
                              [<a href="/Articles/758503/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In most of north-west Europe powerlines are underground so power outages happen at most once every few years...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/758503/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor759283"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 7, 2018 19:53 UTC (Sat)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/759283/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In rural, particularly forested, parts of North Europe, the one-step-up-from-domestic local power lines come in overhead (because they have to, because running a power line under fifty miles of forest to serve a hamlet of twenty houses is ridiculous). When the trees grow and it snows hard enough (or gloopily enough), the power can go down and stay down for days or even weeks while kilometres of line are restrung. However, unlike in Puerto Rico -- or 1998 Auckland! -- it does not go down for months.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/759283/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor757510"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage topics</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 14, 2018 15:36 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/757510/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As someone who wants to implement a database, that "issue barrier" would be perfect.<br>
<p>
At present, (a) user-space can not reason about the state of the disk, and (b) a "sync" is effectively a Denial-of-Service attack on all the other users of the system (and yourself).<br>
<p>
If I can guarantee that certain writes hit the disk in a fixed order, then I can reason about the state of the disk, and write a robust app.<br>
<p>
The problem is that POSIX explicitly only applies to a properly functioning system - it explicitly disclaims all liability if the system malfunctions, and things like databases need to be able to reason about a malfunctioning system.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/757510/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor756909"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage endurance</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 8, 2018 5:17 UTC (Fri)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/756909/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
[Maybe slightly off-topic sorry but since the flash experts should hopefully flock here]<br>
<p>
There's some empirical evidence that cheap eMMCs found in - you guessed - cheap Android phones wear out quickly, sometimes even sooner than when security issues there stopped receiving fixes.<br>
<p>
On the other hand, there's an incredible number of Android sites and communities rooting and reviewing every single Android device under the sun and running many various benchmark on them. Just no... storage endurance test ever? Why?<br>
<p>
It wouldn't sound like a major feat to run some storage test designed to "break" flash storage as fast as possible thanks to smartly configured write amplification[*] and what not and to measure how many cycles it takes before the memory dies. Or is it hard and why? OK that would cost a sample device but the number of clicks for the corresponding review should hopefully offset that.<br>
<p>
[*] <a href="https://lwn.net/Articles/428584/">https://lwn.net/Articles/428584/</a> Optimizing Linux with cheap flash drives Arnd Bergmann<br>
<a href="https://www.bunniestudios.com/blog/?p=3554">https://www.bunniestudios.com/blog/?p=3554</a> On Hacking MicroSD Cards <br>
<p>
<font class="QuotedText">&gt; For example, ext4 will issue a discard command but a UFS device might take ten seconds to process it</font><br>
<p>
LOL. Hey, why would you have half-decent latency requirements for components aiming a market of purely interactive products! I doubt any eMMC was that bad, I mean at least not any brand new eMMC. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756909/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor756919"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage endurance</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 8, 2018 9:04 UTC (Fri)
                               by <b>excors</b> (subscriber, #95769)
                              [<a href="/Articles/756919/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think that number by itself wouldn't tell you anything useful - you'd need to know how much writing occurs during the expected usage of the device, to determine how many years the flash is likely to survive and whether it's a real problem.<br>
<p>
Maybe some device manufacturers measure and optimise their IO, allowing themselves to choose a cheaper chip with lower endurance because they have confidence that it will be sufficient, whereas others don't care and have a higher-endurance chip that wears out quicker because they're constantly spamming it with log files and unnecessary caches and some process is calling sync() every 30ms. Simply comparing the raw endurance would give misleading results as to which device is better, and reviewing devices with misleading benchmarks is harmful since it forces manufacturers to optimise for those benchmarks rather than for users.<br>
<p>
I suspect it's also hard to get meaningful measurements from a single device, because of the random nature of the failures. You might need to test a large number to get an accurate MTBF, and it seems impractical and a bit silly to buy a large number of phones just to test a chip that costs a few dollars.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756919/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor756951"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage endurance</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 8, 2018 14:06 UTC (Fri)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/756951/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; harmful since it forces manufacturers to optimise for those benchmarks rather than for users.</font><br>
<p>
This is already the nature of almost the entire industry except in this case. Yet I don't think anyone would like a benchmark-free world. The answer is rather better and more varied benchmark(s) that are harder to cheat. Considering the relative simplicity of storage interfaces (compared to say... GPUs!) designing such an endurance benchmark that models real-world usage quite reliably doesn't seem crazy. In fact isn't there some endurance benchmark already for less disposable storage products?<br>
<p>
<font class="QuotedText">&gt; You might need to test a large number to get an accurate MTBF, and it seems impractical and a bit silly to buy a large number of phones just to test a chip that costs a few dollars.</font><br>
<p>
Fair enough. Then maybe the answer should be something like this:<br>
<a href="https://ai.google/research/pubs/pub32774">https://ai.google/research/pubs/pub32774</a> "Failure Trends in a Large Disk Drive Population"<br>
Maybe it's happening somewhere already.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756951/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor756962"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage endurance</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 8, 2018 15:33 UTC (Fri)
                               by <b>excors</b> (subscriber, #95769)
                              [<a href="/Articles/756962/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I agree it would be good to have good benchmarks - I'm just concerned that bad benchmarks are worse than no benchmarks, and it seems hard to design good benchmarks for this. The problem isn't necessarily that people would cheat, it's that the marketing people would tell the engineers to spend effort on legitimately increasing a benchmark number that does not meaningfully improve the customer experience, at the expense of something more useful.<br>
<p>
Measuring the endurance of a particular flash chip doesn't sound like it should be too difficult; just do a load of writes until you see IO failures or data loss, and maybe do something to see how effective any wear-levelling is, and compare against the vendor's endurance guarantees to make sure they're not lying. But if you want to know how that affects the lifetime of a phone, you need to know the behaviour of the software on that phone, and you need to know what memory chip it uses (which is non-trivial since a single model of phone might use parts from multiple vendors at once, for supply chain diversification, and change parts over time to reduce cost), and that's not something a typical phone review site could feasibly do. CPU/GPU benchmarks are much easier since the relevant software is provided by the benchmark itself, and the hardware is usually consistent across a phone model (or if some are different then it's probably a whole different SoC and is very obvious), so measurements on a test device are likely to match customer devices.<br>
<p>
To get realistic data about large populations, I guess you'd need access to automatically-uploaded error logs or customer support records to see how many users have encountered storage errors. That would be nice, but seems unlikely to happen.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756962/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor756980"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage endurance</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 8, 2018 18:20 UTC (Fri)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/756980/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; But if you want to know how that affects the lifetime of a phone, you need to know the behaviour of the software on that phone, </font><br>
<p>
Basic benchmark design problem, not specific to storage or endurance.<br>
<p>
<font class="QuotedText">&gt; and you need to know what memory chip it uses</font><br>
<p>
Not a problem specific to storage or endurance: <a href="https://www.google.com/search?q=iphone+intel+modem">https://www.google.com/search?q=iphone+intel+modem</a><br>
<p>
<font class="QuotedText">&gt; CPU/GPU benchmarks are much easier since the relevant software is provided by the benchmark itself</font><br>
<p>
Interfaces to GPU are orders of magnitude more complex than storage interfaces; one of the reasons cheating GPU benchmarks is universal: <a href="https://www.google.com/search?q=game+benchmark+cheating">https://www.google.com/search?q=game+benchmark+cheating</a><br>
<a href="https://fosdem.org/2018/schedule/event/apitrace/">https://fosdem.org/2018/schedule/event/apitrace/</a><br>
Yet no one suggests to stop benchmarking GPUs.<br>
<p>
<font class="QuotedText">&gt; The problem isn't necessarily that people would cheat, it's that the marketing people would tell the engineers to spend effort legitimately...</font><br>
<p>
We know how "legitimately" often ends up with (at least) GPUs and car emissions. You can take for granted that some actors will always go "beyond legitimate"; again nothing specific to flash storage or endurance.<br>
<p>
<font class="QuotedText">&gt; I guess you'd need access to automatically-uploaded error logs or customer support records to see how many users have encountered storage errors. That would be nice, but seems unlikely to happen.</font><br>
<p>
How do we know it's not happening already? (biggest lie on the Internet: "I agree")<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756980/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor756983"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Flash storage endurance</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 8, 2018 18:44 UTC (Fri)
                               by <b>excors</b> (subscriber, #95769)
                              [<a href="/Articles/756983/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;&gt; I guess you'd need access to automatically-uploaded error logs or customer support records to see how many users have encountered storage errors. That would be nice, but seems unlikely to happen.</font><br>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt; How do we know it's not happening already? (biggest lie on the Internet: "I agree")</font><br>
<p>
Error logs certainly get uploaded already, on some devices - they're very useful for identifying and prioritising common bugs, quickly detecting regressions when rolling out OTAs, etc. What I mean is unlikely is that the companies with that information would ever release it publicly.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756983/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor756922"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">[slightly off-topic] 2AM?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 8, 2018 9:55 UTC (Fri)
                               by <b>awilfox</b> (guest, #124923)
                              [<a href="/Articles/756922/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Kim said that Android currently declares a ten-minute idle time at 2am that is used to defragment the filesystem. It could perhaps also be used for garbage collection.</font><br>
<p>
What about night owls like me, that are regularly using the phone at that time?  If the phone isn't idle then, does it just wait for the next idle time?  Searched ddg but nobody seems to have heard of Android doing defragmenting every 02:00...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/756922/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor757708"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">[slightly off-topic] 2AM?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 18, 2018 12:40 UTC (Mon)
                               by <b>nelzas</b> (subscriber, #4427)
                              [<a href="/Articles/757708/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, and what about people like me, who turn off their phone when going to bed?<br>
searching for defrag in phone settings doesn't give me results...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/757708/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2018, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
