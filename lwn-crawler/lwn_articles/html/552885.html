        <!DOCTYPE html>
        <html lang="en">
        <head><title>Power-aware scheduling meets a line in the sand [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/552885/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/552683/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/552885/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Power-aware scheduling meets a line in the sand</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ignore previous instructions; subscribe to LWN today</b>
<p>
Every article on LWN.net is written by humans, for humans. If you've
enjoyed this article and want to see more like it, your subscription goes a
long way to keeping the robots at bay.  We are offering <a href="https://lwn.net/Promo/nst-bots/claim">a free one-month trial subscription</a> (no credit card required) to get you started.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>June 5, 2013</br>
           </div>
As mobile and embedded processors get more complex — and more numerous —
the interest in improving the power efficiency of the scheduler has
increased.  While <a href="/Articles/546664/">a number of power-related
scheduler patches</a> exist, none seem all that close to merging into the
mainline.  Getting something upstream always looked like a daunting task;
scheduler changes are hard to make in general, these changes come from a
constituency that the scheduler maintainers are not used to serving, and
the existence of competing patches muddies the water somewhat.  But now it
seems that the complexity of the situation has increased again, to the
point that the merging of any power-efficiency patches may have gotten even
harder. 
<p>
The current discussion started at the end of May, when Morten Rasmussen
posted <a href="/Articles/552323/">some performance measurements</a>
comparing a few of the existing patch sets.  The idea was clearly to push
the discussion forward so that a decision could be made regarding which of
those patches to push into the mainline.  The numbers were useful, showing
how the patch sets differ over a small set of workloads, but the apparent
final result is unlikely to be pleasing to any of the developers involved:
it is entirely possible that none of those patch sets will be merged in
anything close to their current form, after Ingo Molnar posted <a
href="/Articles/552889/">a strongly-worded "line in the sand" message</a>
on how power-aware scheduling should be designed.
<p>
Ingo's complaint is not really about the current patches; instead, he is
unhappy with how CPU power management is implemented in the kernel now.
Responsibility for CPU power management is currently  divided among three
independent components:
<p>
<ul>
<li> The scheduler itself clearly has a role in the system's power usage 
     characteristics.  Features like <a
     href="/Articles/228143/">deferrable timers</a> and <a
     href="/Articles/223185/">suppressing the timer tick when idle</a> have
     been added to the scheduler over the years in an attempt to improve
     the power efficiency of the system.
<p>
<li> The CPU frequency ("cpufreq") subsystem regulates the clock frequency
     of the processors in response to each processor's measured idle time.
     If the processor is idle much of the time, the frequency (and, thus,
     power consumption) can be lowered; an always-busy processor, instead,
     should run at a higher frequency if possible.  Most systems probably
     use the <a href="/Articles/384132/">on-demand cpufreq governor</a>,
     but others exist.  The <a href="/Articles/539840/">big.LITTLE
     switcher</a> operates at this level by disguising the difference
     between "big" and "little" processors to look like a wide range of
     frequency options.
<p>
<li> The <a href="/Articles/384146/">cpuidle subsystem</a> is charged with
     managing processor sleep states.  One might be tempted to regard
     sleeping as just another frequency option (0Hz, to be exact), but
     sleep is rather more complicated than that.  Contemporary processors
     have a wide range of sleep states, each of which differs in the amount
     of power consumed, the damage inflicted upon CPU caches, and the time
     required to enter and leave that state.
</ul>
<p>
Ingo's point is that splitting the responsibility for power management
decisions among three components leads to a situation where no clear policy
can be implemented:
<p>
<div class="BigQuote">
	Today the power saving landscape is fragmented and sad: we just
	randomly interface scheduler task packing changes with some idle
	policy (and cpufreq policy), which might or might not combine
	correctly.  Even when the numbers improve, it's an entirely random,
	essentially unmaintainable property: because there's no clear split
	(possible) between 'scheduler policy' and 'idle policy'.
</div>
<p>
He would like to see a new design wherein the responsibility for all of
these aspects of CPU operation has been moved into the scheduler itself.
That, he claims, is where the necessary knowledge about the current
workload and CPU topology lives, so that is where the decisions should be
made.  Any power-related patches, he asserts, must move the system in that
direction: 
<p>
<div class="BigQuote">
	This is a "line in the sand", a 'must have' design property for any
	scheduler power saving patches to be acceptable - and I'm NAK-ing
	incomplete approaches that don't solve the root design cause of our
	power saving troubles.
</div>
<p>
Needless to say, none of the current patch sets include a fundamental
redesign of the scheduler, cpuidle, and cpufreq subsystems.  So, for all
practical purposes, all of
those patches have just been rejected in their current form — probably not
the result the developers of those patches were hoping for.
<p>
Morten <a href="/Articles/552892/">responded</a> with a discussion of the
kinds of issues that an integrated power-aware scheduler would have to deal
with.  It starts with basic challenges like defining scheduling policies
for power-efficient operation and defining a mechanism by which a specific
policy can be chosen and implemented.  There would be a need to represent
the system's power topology within the scheduler; that topology might not
match the cache hierarchy represented by the existing <a
href="/Articles/80911/">scheduling domains</a> data structure.  Thermal
management, which often involves reducing CPU frequencies or powering down
processors entirely, would have to be factored in.  And so on.  In summary,
Morten said:
<p>
<div class="BigQuote">
	This is not a complete list. My point is that moving all policy to
	the scheduler will significantly increase the complexity of the
	scheduler.  It is my impression that the general opinion is that
	the scheduler is already too complicated. Correct me if I'm wrong.
</div>
<p>
In his view, the existing patch sets are part of an incremental solution to
the problem and a step toward the overall goal.
Whether Ingo will see things the same way is, as of this writing, unclear.
His words were quite firm, but lines in the sand are also relatively easy
to relocate.  If he holds fast to his expressed position, though, the
addition of power-aware scheduling could be delayed indefinitely.
<p>
It is not unheard of for subsystem maintainers to insist on improvements to
existing code as a precondition to merging a new feature.  At past kernel
summits, such requirements have been seen as being unfair, but they
sometimes persist anyway.  In this case, Ingo's message, on its face,
demands a redesign of one of the most complex core kernel
subsystems before (more) power awareness can be added.  That is a
significant raising of the bar for developers who were already struggling to
get their code looked at and merged.  A successful redesign on that scale
is unlikely to happen unless the 
current scheduler maintainers put a fair amount of their own time into the
requested redesign.
<p>
The cynical among us could certainly see this position as an easy way to
simply make the power-aware scheduling work go away.  That is 
certainly an incorrect interpretation, though.  The more straightforward
explanation — that the scheduler maintainers want to see the code get
better and more maintainable over time — is far more likely.  What has to
happen now is the identification of a path toward that better scheduler
that allows for power management improvements in the short term.  The
alternative is to see the power-aware scheduler code relegated to vendor
and distributor trees, which seems like a suboptimal outcome.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Power_management-CPU_scheduling">Power management/CPU scheduling</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Scheduler-and_power_management">Scheduler/and power management</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/552885/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor553028"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Value</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 5, 2013 20:16 UTC (Wed)
                               by <b>ncm</b> (guest, #165)
                              [<a href="/Articles/553028/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Once again LWN reminds us why we keep up our subscriptions.  Are you really chipping in your share?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553028/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor553036"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 5, 2013 20:40 UTC (Wed)
                               by <b>naptastic</b> (guest, #60139)
                              [<a href="/Articles/553036/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
*cough* pluggable schedulers *cough*<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553036/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553046"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">I want to learn more...</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 5, 2013 22:06 UTC (Wed)
                               by <b>pr1268</b> (subscriber, #24648)
                              [<a href="/Articles/553046/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <p>I'm terribly unenlightened about these&mdash;can you provide pointers to their design overview, theory of operation, how a pluggable scheduler would work in the context of the Linux Kernel, etc.?  Thanks!</p>

<p>Signed,<br/>
<br/>
Just a little curious</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/553046/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553055"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">I want to learn more...</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 5, 2013 22:39 UTC (Wed)
                               by <b>SiliconSlick</b> (guest, #39955)
                              [<a href="/Articles/553055/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Long ago, HP was working on something like this.  Here's a link via the Way Back Machine:<br>
<p>
<a href="http://web.archive.org/web/20031210095042/http://resourcemanagement.unixsolutions.hp.com/WaRM/prm_linux/schedpolicy.html">http://web.archive.org/web/20031210095042/http://resource...</a><br>
<p>
(see the white paper at the bottom)<br>
<p>
Not sure whatever became of it.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553055/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor558776"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">I want to learn more...</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 14, 2013 0:21 UTC (Sun)
                               by <b>alison</b> (subscriber, #63752)
                              [<a href="/Articles/558776/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks for the link, SiliconSlick!    The work you cite appears to anticipate cgroups: cool.   I worked for HP at the time and regret not knowing Scott Rhine, the author.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/558776/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor553053"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">I want to learn more...</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 5, 2013 22:45 UTC (Wed)
                               by <b>naptastic</b> (guest, #60139)
                              [<a href="/Articles/553053/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's a not-quite perennial topic that has, historically, been shot down every time it's come up. However, coming up with a single scheduler / power configuration system that performs well on all systems looks less and less soluble with each passing year. For example, this conversation from 2004:<br>
<p>
<a href="http://lwn.net/Articles/109458/">http://lwn.net/Articles/109458/</a><br>
<p>
NUMA and hyperthreading were much newer and less understood, and things like bigLITTLE weren't even on the horizon. The objection there was that the effort of maintaining a separate scheduler per situation would outweigh the benefits, and result in many crappy schedulers instead of one good one; I believe the balance has shifted the other way now.<br>
<p>
The Brainfuck Scheduler came out in 2009, and pluggable schedulers came up in conversation again. I can't find the reference but I think it was Linus that time that shot them down. He also shot down priority inheritance many times before finally agreeing to it, so things like this can change.<br>
<p>
We have NUMA, HT, bigLITTLE, and AMD's somewhat odd two-cores-one-FPU setup now. Who knows what other permutations chip manufacturers will bring us in coming years. (Hopefully many!) The kernel scheduler has improved leaps and bounds, but there is still a meaningful gap in performance between mainline and (in my case) BFS, for specific hardware. BFS is marginally worse on my quad-socket Opteron system, and better enough for my single-socket systems that I use it exclusively. Imagine the performance deltas possible with a custom bigLITTLE scheduler.<br>
<p>
I believe Ingo is right in his assertion that we need to look at scheduler and power management framework in the same context. I do not think that having one scheduler and power management framework to rule them all is realistic if we want to get the most from our hardware.<br>
<p>
Of course, this is largely conjecture and meaningful benchmarks may not be available for a while yet.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553053/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor553059"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">I want to learn more...</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 5, 2013 22:55 UTC (Wed)
                               by <b>naptastic</b> (guest, #60139)
                              [<a href="/Articles/553059/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Oh, also in 2004, Con Kolivas posted the beginnings of a system to make the scheduler pluggable:<br>
<p>
<a href="https://groups.google.com/forum/?fromgroups#!msg/fa.linux.kernel/THlpt3FaZTo/nVJfPtYVH4kJ">https://groups.google.com/forum/?fromgroups#!msg/fa.linux...</a><br>
<p>
Based on my limited understanding of the issues involved, I don't think the approach Con took in this patch set is going a direction compatible with what Ingo is now suggesting. I could be wrong, of course.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553059/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor553060"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 5, 2013 23:21 UTC (Wed)
                               by <b>aliguori</b> (subscriber, #30636)
                              [<a href="/Articles/553060/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That's just punting the problem.<br>
<p>
I want low power consumption and I want maximum performance.  It shouldn't have to be a choice.<br>
<p>
In fact, the two are very much related.  You want maximum work done while you're not sleep so you can extend the time that you sleep for.<br>
<p>
And since most modern systems have NUMA characteristics, to get maximum performance you really need to be NUMA aware.  It's all deeply inter-related.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553060/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553061"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 6, 2013 0:42 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/553061/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  I want low power consumption and I want maximum performance. It shouldn't have to be a choice.</font><br>
<p>
sorry, it doesn't work that way in the real world<br>
<p>
if you can get 1% better performance by spreading your work across 4 cores instead of 2 (and powering down the other two), which wins? performance or power?<br>
<p>
If tasks were batched, you could do all your work and then go to sleep. But if you don't know the future work that you will be asked to do, should you go to low-power mode, even if it means that you will be slower to do work when it arrives?<br>
<p>
It takes time to wake up from deep sleep states, sometimes you would rather be working than waiting to wake up :-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553061/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553068"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 6, 2013 2:22 UTC (Thu)
                               by <b>aliguori</b> (subscriber, #30636)
                              [<a href="/Articles/553068/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; if you can get 1% better performance by spreading your work across 4 cores instead of 2 (and powering down the other two), which wins? performance or power?</font><br>
<p>
If all you care about is performance, never do any power management.  If all you care about is power savings, just shut the machine work and take the infinite performance hit.<br>
<p>
I don't think anyone really falls on either side of the extreme.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553068/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553069"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 6, 2013 2:38 UTC (Thu)
                               by <b>naptastic</b> (guest, #60139)
                              [<a href="/Articles/553069/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If I were the pointy-haired boss:<br>
<p>
1. Tune settings on my device to err on the side of performance, rather than power (battery life)<br>
<p>
2. With every update, move just a little more towards battery life, and advertise that you've increased the battery life.<br>
<p>
3. When more people are moving away from your device because it's slow than were moving away from it because it had poor battery life, you've reached your balance.<br>
<p>
4. Come out with a new product with newer hardware, start the process over again. Maybe do it the other direction just for kicks.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553069/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor553083"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 6, 2013 7:05 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/553083/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
and the point is that there is no one correct way of doing things. you can't maximize both performance and minimize power use.<br>
<p>
You make a trade-off between them.<br>
<p>
And since different people will want different points in the trade-off, this means that there needs to be a way of setting the different policies, and then different ways make decisions based on what the policy is<br>
<p>
not to mention that the trade-offs are going to be very different on different hardware, and you have zero real clue about what the hardware will want in 2-3 years.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553083/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553089"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 6, 2013 7:29 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/553089/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
a comment I posted elsewhere is also relevant to this discussion. I'll post a link rather than reposting the longer comment<br>
<p>
in <a rel="nofollow" href="https://lwn.net/Articles/553086/">https://lwn.net/Articles/553086/</a> I give an example (disk I/O) where performance can involve 'wasting' effort by doing things that you may be able to avoid if you just wait.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553089/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor553204"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 6, 2013 18:11 UTC (Thu)
                               by <b>sbohrer</b> (guest, #61058)
                              [<a href="/Articles/553204/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I don't think anyone really falls on either side of the extreme.</font><br>
<p>
There are are plenty of us who disable all power savings.  Having power saving enabled can easily mean a 30-40% performance hit which is unacceptable for some workloads.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553204/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553242"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 6, 2013 21:42 UTC (Thu)
                               by <b>naptastic</b> (guest, #60139)
                              [<a href="/Articles/553242/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; There are are plenty of us who disable all power savings. Having power saving enabled can easily mean a 30-40% performance hit which is unacceptable for some workloads.</font><br>
<p>
Or a 5ms latency increase at unpredictable times, which ruins my recording and playback.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553242/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor553040"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 5, 2013 21:02 UTC (Wed)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/553040/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I read his message as being less about redesigning the core scheduler as it is figuring out how to define the appropriate hooks in it so that it can make more decisions.<br>
<p>
That could be a redesign of everything, but it doesn't need to be. And it especially should not be a redesign from scratch to get started.<br>
<p>
Morton's response listed a lot of the concerns, but I think there is a fairly clear path to get started.<br>
<p>
Since the current scheduling domains datastructure does not include the power related information, start by defining a structure that does.<br>
<p>
Then people can start talking about how to hook the different policies into the scheduler and have it switch between them (start with the simple 'put things on as few CPUs as possible to save power' vs 'spread across as many cores as possible for performance')<br>
<p>
meanwhile the mechanism to go into sleep modes can be implemented, and then in the idle slow path, you can insert logic to try and decide if you should go into a sleep state, if so which one, etc.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553040/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553051"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 5, 2013 22:27 UTC (Wed)
                               by <b>rahvin</b> (guest, #16953)
                              [<a href="/Articles/553051/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I read his message exactly as Jon read it. He wants everything power related in the scheduler so it's all in one place. I think you are making it a stretch to argue he meant hooking the scheduler and putting the code elsewhere. <br>
<p>
Personally I don't get how he can insist it's all in the one place. I get it from an organization point of view but power management can be touching all sorts of things that are completely unrelated. If he wants to go down that road I would agree the solution is to hook the relevant subsystems and create a new power management system that manages all the diverse areas where power management is a concern, but then you go even further from CPU and scheduler and tuck in disk, screen and other management so you have centralized power control. (Maybe the only real solution to total power management on devices like tablets)<br>
<p>
Such a system would probably decentralize things to an extent in that CPU frequency control would end up outside the CPU code and in the power management code. That sounds like it would greatly complicate the kernel and understanding how it works and would be contrary to the intent. <br>
<p>
I don't think there is a clean solution to this problem, as I said, power management is a device wide issue and touches almost every subsystem. I think the modest improvements path is probably the most viable.<br>
<p>
Great article!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553051/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553054"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 5, 2013 22:39 UTC (Wed)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/553054/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't think that anyone is saying that all power management belongs there.<br>
<p>
But having multiple systems trying to control how much power is used by the CPUs just does not make sense.<br>
<p>
There are items that the scheduler MUST to (like deciding to concentrate or distribute tasks)<br>
<p>
And then there are a things that the scheduler is in the best position to guess (predicting future loads for decisions on CPU speed settings)<br>
<p>
having one process (cpufreq or cpuidle) try to guess what the scheduler is going to do just doesn't work well.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553054/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553062"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 5, 2013 23:59 UTC (Wed)
                               by <b>luto</b> (subscriber, #39314)
                              [<a href="/Articles/553062/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For example, the new intel-idle driver is using fancy MSRs to estimate how hard the CPU has been working lately.  The scheduler should (and probably is) using similar metrics to charge tasks for their CPU usage.  This could be combined.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553062/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553075"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 6, 2013 5:05 UTC (Thu)
                               by <b>amit.kucheria</b> (subscriber, #59246)
                              [<a href="/Articles/553075/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Similar experiments have been done to use data from ARM performance counters in decisions to determine CPU state e.g. scaling frequency. The results are encouraging but we need to figure out generic kernel interfaces to use these systems.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553075/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553203"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 6, 2013 18:11 UTC (Thu)
                               by <b>rahvin</b> (guest, #16953)
                              [<a href="/Articles/553203/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Personally I think the future is device specific power management. How we get to that point or some subset of it is beyond me but there is so much different hardware available these days (how many version of ARM CPUs exist, is there even a count?) that I don't know how you can achieve reliable and efficient power management without going down the device specific route. <br>
<p>
Even if the kernel is only responsible for CPU power management there are going to be so many variations of best practices in the future that I don't know that it's manageable without some abstraction that allows variable management for every different device. The massive variation in CPUs and capabilities is only going to get worse in the near term.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553203/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553254"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 7, 2013 2:25 UTC (Fri)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/553254/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
do you really want to have to have a different kernel for every chip release?<br>
<p>
how about having to pick the right kernel for running on battery vs being plugged in?<br>
<p>
yes different CPUs and systems have different details, but most of these can be abstracted out so that the policy engine can make reasonable decisions based on a description of the system (and the related costs). When new systems come out that can't be described reasonably in the existing structure, the kernel will be adapted so that it covers the new type of system.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553254/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor553705"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 11, 2013 1:48 UTC (Tue)
                               by <b>pr1268</b> (subscriber, #24648)
                              [<a href="/Articles/553705/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <p>While I can empathize with Ingo's frustration regarding a lack of clear policy, I still think there needs to be a separation of the scheduler code and the cpufreq/cpuidle subsystems based on my (perhaps na&iuml;ve) understanding of these:</p>

<P>As our editor mentioned, the scheduler has a distinct role, but my guess is that the scheduler is architecture-<i>independent</i>.</p>

<p>Conversely, the cpufreq and cpuidle subsystems are arch-<i>dependent</i> (although it's rare to find an arch these days that doesn't support either or both of these).</p>

<p>Thus, I propose merging the cpufreq and cpuidle systems, because (like our editor said), cpuidle is just like reducing cpufreq to 0 Hz.</p>

<p>The scheduler would be kept separate from the merged cpufreq/cpuidle, but there could still be a coupling:  if the process load is light, then the scheduler could dictate the cpufreq system to slow down.  If the process load approaches zero, then the scheduler could even tell cpufreq to go to zero (i.e. cpuidle).  Conversely, if the system load is high, then the scheduler would be aware of this, and it could tell the cpufreq system to speed up (which, of course, would un-idle the CPU[s]).</p>

<p>Granted, this is merely a very high-level view of a proposed system, but the basic idea is that (1) the arch-independent code is kept separate from the arch-dependent code; (2) the scheduler acts as the single-point of control for power-aware scheduling (and this is where a clear policy can be implemented); and (3) any changes in scheduler state could then drive changing the CPU frequency (which could subsequently control idling the CPU[s]).</p>

<p>Just a thought...</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/553705/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553707"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 11, 2013 2:05 UTC (Tue)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/553707/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
the scheduler is not architecture independent, it needs to take into account what core share cache (potentially to several levels), which ones share NUMA nodes, etc.<br>
<p>
right now it doesn't know which ones share power/speed settings, or have the ability to modify it's bahavior based on this<br>
<p>
for a hard problem, consider a modern cpu with the turbo feature, if the system has just over half it's cpu used, it is better off keeping all cores running, or to power half of them off to speed up the other half?<br>
<p>
this requires not just watching the overall load, but watching the utilization of individual processes/threads. <br>
<p>
if you have a process that is using every bit of time it can get on a CPU, it may gain significantly from switching into turbo mode, if all the other threads can fit on the remaining turbo cores. <br>
<p>
on the other hand, if every process is sleeping well before it's timeslice is up, you are probably better off with more cores, spreading the threads across all of them (utilizing more cache so more can remain hot)<br>
<p>
If you are going to pass this level of detailed information out of the scheduler, you are paying a significant amount of overhead, if you don't how is your speed controller going to be able to figure out what's best?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553707/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor554681"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 15, 2013 22:11 UTC (Sat)
                               by <b>mm7323</b> (subscriber, #87386)
                              [<a href="/Articles/554681/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why not just make the scheduler pluggable already and accept that on some systems the scheduler is going to be a bit different in order to make best use of hardware features?  One scheduler to rule them all is nice in theory, but it will always be a compromise when considering the vast number of platforms Linux runs on these days.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/554681/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor554683"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 15, 2013 22:21 UTC (Sat)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/554683/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Because they don't want to end up with the situation that to run one type of application you want one scheduler and to run another type of application you need a different scheduler (and if you want to run both, you are just out of luck)<br>
<p>
there's also the issue that making the entire scheduler pluggable adds significant overhead to the fastpath of deciding which process to run next<br>
<p>
this may end up resulting in some parts of the scheduler being plugable, but they would not be the fastpath of what process to run next, but the slowpath where the scheduler makes decisions on moving processes from one core to another.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/554683/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor554688"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power-aware scheduling meets a line in the sand</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 15, 2013 23:07 UTC (Sat)
                               by <b>andresfreund</b> (subscriber, #69562)
                              [<a href="/Articles/554688/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's hard enough to find talent to write one scheduler...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/554688/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2013, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
