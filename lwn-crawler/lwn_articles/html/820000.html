        <!DOCTYPE html>
        <html lang="en">
        <head><title>O_MAYEXEC — explicitly opening files for execution [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/820000/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/819797/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/820000/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>O_MAYEXEC — explicitly opening files for execution</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Benefits for LWN subscribers</b>
<p>
The primary benefit from <a href="/Promo/nst-nag5/subscribe">subscribing to LWN</a>
       is helping to keep us publishing, but, beyond that, subscribers get
       immediate access to all site content and access to a number of extra
       site features.  Please sign up today!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>May 11, 2020</br>
           </div>
Normally, when a kernel developer shows up with a proposed option that
doesn't do anything, a skeptical response can be expected.  But there are
exceptions.  Mickaël Salaün is <a
href="/ml/linux-kernel/20200505153156.925111-1-mic@digikod.net/">proposing</a>
the addition of a new flag (<tt>O_MAYEXEC</tt>) for the <a
href="http://man7.org/linux/man-pages/man2/openat2.2.html"><tt>openat2()</tt></a> 
system call that, by default, will change nothing.  But it does
open a path toward tighter security in some situations.
<p>
Executing a file on a Unix-like system requires that said file have an
applicable execute-permission bit set.  The file must also not reside on a
filesystem that has been mounted with the <tt>noexec</tt> option.  These
checks can prevent the execution of unwanted code on a tightly controlled
system, but there is a significant hole in this protection: interpreters
that will happily read and execute code found in a file.  If a file
contains Perl code, for example, it cannot be executed by typing its name
if it fails either of the above two tests.  If an attacker is able to pass
that file as a parameter to a <tt>perl&nbsp;-e</tt> command, though, its
contents will still be executed.
<p>
The new <tt>O_MAYEXEC</tt> flag is a way for language interpreters (or
other programs, such as dynamic linkers, that execute code) to indicate
to the kernel that a file is being opened with the intent of executing its
contents.  This flag is totally ignored by <tt>open()</tt> which, because
it never checked for invalid flags, is difficult to extend in general.  The
newer <tt>openat2()</tt> system call, instead, does fail when unknown flags
are passed to it; it has been extended to recognize <tt>O_MAYEXEC</tt>.
But, by default, nothing will change if that flag is present.
<p>
The patch set also adds a new sysctl knob called
<tt>fs.open_mayexec_enforce</tt> that can bring out a change in behavior.
Its default value (zero) naturally preserves current behavior so that
nobody's system is broken by mistake.  If, instead, bit&nbsp;0 is set, an
<tt>openat2()</tt> call with <tt>O_MAYEXEC</tt> will fail if the filesystem
holding the target file was mounted with the <tt>noexec</tt> option.
Bit&nbsp;1 will cause such an open to fail if the file lacks execute
permission.  Setting both bits will thus cause <tt>O_MAYEXEC</tt> opens to fail
in the situations where a direct attempt at execution would also fail.
<p>
Integrity measurement is another subsystem that can benefit from
<tt>O_MAYEXEC</tt>.  The kernel's integrity-measurement subsystem can be
configured to block the execution of files that do not meet the integrity
criteria but, once again, passing a file directly to an interpreter can
bypass this check.  This patch set adds a hook by which files opened with
<tt>O_MAYEXEC</tt> can be passed to the integrity-measurement code for
vetting before an open is allowed to succeed.
<p>
Finally, as one might expect, security modules can also note the existence
of this flag and respond accordingly.  It would be relatively
straightforward to write a policy for SELinux or Smack that prevents 
execution-by-interpreter of files that lack a certain label (or to prevent
such execution entirely, of course).
<p>
The above discussion skips over one little detail, though: this mechanism
will only work if the programs that execute code from files cooperate and
provide the <tt>O_MAYEXEC</tt> flag.  That would require getting patches into
various language interpreters, linkers, etc. to properly mark the opening
of any files that might lead to the execution of code.  Actions such as
opening files passed on the command line,  importing code in modules, and
more would need this flag.  Getting all of the commonly installed
interpreters patched is likely 
to be a project that takes some time, even if all of the relevant projects
go along with the idea.
<p>
The good news is that some projects, at least, are aware of the issue.  The
Python project, for example, has been working since (at least) 2017 to <a
href="/Articles/732951/">provide audit information</a> to the underlying
operating system; that work is currently formalized as <a
href="https://www.python.org/dev/peps/pep-0578/">PEP&nbsp;578</a> ("Python
runtime audit hooks"), which
was <a
href="/ml/python-dev/2f1e4bef-d845-c006-537f-d81abc4c980c%40python.org/">approved</a>
in May 2019 and appears to be on track for the Python&nbsp;3.9
release. Simply supporting <tt>O_MAYEXEC</tt> doesn't require the addition
of an entire new subsystem, though, so adding this support to other
interpreters need not be a multi-year project.
<p>
This patch set is in its fifth revision as of this writing.  It has changed
considerably as the result of review comments.  The <a
href="/ml/linux-kernel/20181212081712.32347-1-mic@digikod.net/">original
version</a>, posted at the end of 2018, predated <tt>openat2()</tt> and
relied on the Yama security module for enforcement.  Developers seem
relatively happy with the current version, though, so this feature may be
getting close to being ready to enter the mainline.  Only then can the task
of adding support to various interpreters begin.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems-Virtual_filesystem_layer">Filesystems/Virtual filesystem layer</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-Language_interpreters">Security/Language interpreters</a></td></tr>
            <tr><td><a href="/Archives/PythonIndex/">Python</a></td><td><a href="/Archives/PythonIndex/#Python_Enhancement_Proposals_PEP-PEP_578">Python Enhancement Proposals (PEP)/PEP 578</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/820000/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor820260"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 4:07 UTC (Tue)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/820260/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Could this lead to a way to block people from running `curl | bash`?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820260/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820262"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 4:17 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/820262/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What's wrong with "curl | bash"?<br>
<p>
How is it different from "pip install"?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820262/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820265"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 4:31 UTC (Tue)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/820265/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
pip traditionally downloads from PyPI, although you can feed it a raw URL if you enjoy living dangerously. PyPI is not categorically immune from unintentionally hosting malware, of course, but it's a poor choice for intentional malware distribution, because it can be audited by security researchers et al. upon request. Most malware tries to obfuscate itself to make it harder to block, and a well-known host which complies with legal requests is a poor vector for this and other reasons.<br>
<p>
Having said all that, bash does not call openat2() on stdin (nor should any remotely reasonable program), so I'm going to say this whole question is moot.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820265/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820266"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 4:37 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/820266/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
PyPI not only can be used to distribute actual malware, but it HAS been used to do that more than once. Ruby gems and JS NPMs also have been used for this purpose.<br>
<p>
Running "curl | bash" is at least honest about its possible impact.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820266/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820268"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 5:27 UTC (Tue)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/820268/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; PyPI not only can be used to distribute actual malware, but it HAS been used to do that more than once.</font><br>
<p>
I don't dispute that. My point was merely that a smart malware author would probably choose a different host, in practice, most of the time. That is a vastly different claim from "PyPI software is always safe," which I certainly did not say. Rather, my claim is more focused on the possible remediation after a malware event. If you know you got it from PyPI, you can pass that information on to security researchers and authorities, who can then study the malware and make recommendations to others. If you got it from curl | bash, who's to say the site is even still there?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820268/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820269"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 5:34 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/820269/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A PyPI package can trivially do an equivalent of "system('curl | bash')". There really is no difference here.<br>
<p>
Pretty much the only semi-reliable package source are native Linux distribution packages. And even that is likely borderline.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820269/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor820277"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 9:41 UTC (Tue)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/820277/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Agreed. PyPi/NPM provide a false sense of security while being very convenient, which is a combination that leads to disasters.<br>
curl | bash provide a correct sense of insecurity while being rather inconvenient. Much less likely to lead to a disaster.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820277/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor820475"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2020 8:43 UTC (Thu)
                               by <b>mina86</b> (guest, #68442)
                              [<a href="/Articles/820475/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The one real issue with ‘curl | bash’ is an interrupted connection. If the script being downloaded isn’t written properly, this can lead to execution of corrupted script and e.g. ‘rm -rf /’ instead of ‘rm -rf /tmp/my-temp-file’.<br>
<p>
For those wondering, the way to guard against that is to wrap the entire script with ‘_() { …; }; |’.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820475/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820536"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2020 16:23 UTC (Thu)
                               by <b>dkg</b> (subscriber, #55359)
                              [<a href="/Articles/820536/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      I'm pretty sure you mean to wrap the entire script in:

<pre>
_() {
    […]
}
_
</pre>

the trailing pipe doesn't make sense.
      
          <div class="CommentReplyButton">
            <form action="/Articles/820536/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820537"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2020 16:28 UTC (Thu)
                               by <b>mina86</b> (guest, #68442)
                              [<a href="/Articles/820537/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, sorry, a typo. I meant underscore, not a pipe.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820537/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor820271"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 5:59 UTC (Tue)
                               by <b>jezuch</b> (subscriber, #52988)
                              [<a href="/Articles/820271/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Me wonders, what would happen if the Java VM was modified to use this flag, then some distribution flicked the switch and everyone was forced to chmod +x all their .jar files? ;)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820271/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820317"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 16:10 UTC (Tue)
                               by <b>l0kod</b> (subscriber, #111864)
                              [<a href="/Articles/820317/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
General purpose distros will not enforce anything by default but will let sysadmins tune their system (according to its mount points and files). Only tailored security distros will embedded such security policy.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820317/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor820330"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 18:42 UTC (Tue)
                               by <b>error27</b> (subscriber, #8346)
                              [<a href="/Articles/820330/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think you're right that that's what will happen.  But you can disable it with a sysctl until everything is fixed.  It's just like SELinux and people will eventually get used to it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820330/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor820279"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 10:42 UTC (Tue)
                               by <b>dullfire</b> (guest, #111432)
                              [<a href="/Articles/820279/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
While the idea of improving security measures is commendable, I am not sure that this idea actually buys us a whole lot.<br>
For example "echo 'print("Hello foobar")' |python" will still work, and as somebody else has already rightly pointed out: this can't be used to stop interpreters from using stdin (and in fact attempting to do so sounds like a terrible idea).<br>
Furthermore, it sounds like this is attempting to create a link between kernel semantics (is the kernel allowed to create a process image out of this file), and pure user-land semantics (can any program, anywhere, use this file as flow control). If that's the case, does that mean all html, and js (that want to be executed/view locally rather than severed) potentially need to be marked as executable?<br>
<p>
If we want to lock it down that badly, we probably also need to disable access to /proc/self. I'm pretty sure I could use a bash shell script to do some ROP in the very same shell to get the shell to MMAP some code as executable and then dd in w/e data I wanted.... now I have code execution. Seccomp could probably stop that (unless bash actually uses mmap, not sure).<br>
<p>
My point is while the goals are laudable, I don't think this approach is a very well thought out way to attempt to tackle this problem.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820279/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820286"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 13:24 UTC (Tue)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/820286/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't think teaching interpreters to not execute non-interactive stdin is a bad idea. No sane system should require that.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820286/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820287"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 13:49 UTC (Tue)
                               by <b>dskoll</b> (subscriber, #1630)
                              [<a href="/Articles/820287/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>The only way to detect "non-interactive" stdin is to check if it's a tty, and that's easily spoofed with a pseudoterminal.</p>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820287/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor820352"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2020 9:18 UTC (Wed)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/820352/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What ? We do this all the time in HPC.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820352/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor820428"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2020 17:29 UTC (Wed)
                               by <b>ianmcc</b> (subscriber, #88379)
                              [<a href="/Articles/820428/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Its a little difficult to parse that quadruple negative statement.  Is something of the form 'cat file | interpreter' an example of the interpreter reading a non-interactive stdin?  I'd have thought this kind of thing was ubiquitous on unix systems.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820428/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor820319"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 16:37 UTC (Tue)
                               by <b>l0kod</b> (subscriber, #111864)
                              [<a href="/Articles/820319/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As explained in the documentation patch, the ability to restrict code execution must be thought as a system-wide policy: <a rel="nofollow" href="https://lwn.net/ml/linux-kernel/20200505153156.925111-6-mic@digikod.net/">https://lwn.net/ml/linux-kernel/20200505153156.925111-6-m...</a><br>
As with other security policies, enforcing such execution prevention do not make sense on all system installations, especially developers' ones.<br>
<p>
O_MAYEXEC is only one part of the solution. According to your threat model, using stdin (or other ways) to push code to interpreters may be legitimate or not. O_MAYEXEC doesn't help for this problem, but there is other solutions (which don't require kernel modification). You can get inspiration from CLIP OS 4: <a rel="nofollow" href="https://github.com/clipos-archive/clipos4_portage-overlay/search?q=O_MAYEXEC">https://github.com/clipos-archive/clipos4_portage-overlay...</a><br>
<p>
The difference between code and data is relative. According to your threat model, one way to draw a line is to identify which kind of input (Python, JavaScript, HTML, CSS…) can do system calls (which could lead to kernel attacks) or can have fine control of CPU instructions (which could lead to side channel attacks): <a rel="nofollow" href="https://lore.kernel.org/lkml/d1a81d06-7530-1f2b-858a-e42bc1ae2a7e@digikod.net/">https://lore.kernel.org/lkml/d1a81d06-7530-1f2b-858a-e42b...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820319/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor820338"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 21:01 UTC (Tue)
                               by <b>edeloget</b> (subscriber, #88392)
                              [<a href="/Articles/820338/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Honnestly, that's a feature that I'm going use -- I've been trying to find a way to close the loophole of scripts that can be executed from a noexec filesystem for a while, and I'm quite happy with it :)<br>
<p>
Of course it's still possible to pipe a string to an interpreter but the change is still interesting to me. <br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820338/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor820280"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 10:47 UTC (Tue)
                               by <b>LiPo</b> (guest, #129784)
                              [<a href="/Articles/820280/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Suppose that Python is updated. If I cannot do "python abc", what prevents me from doing "cat abc | python" or "python &lt; abc"?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820280/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820281"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 11:59 UTC (Tue)
                               by <b>dskoll</b> (subscriber, #1630)
                              [<a href="/Articles/820281/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>For the latter case, you'd need a fcntl informing the system of your intent to execute stdin and it could do its checks. For the former case, I guess you'd have to fail the fcntl if stdin does not refer to a plain file.  That would be a big and backwards-incompatible change.
      
          <div class="CommentReplyButton">
            <form action="/Articles/820281/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor820309"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 15:56 UTC (Tue)
                               by <b>matthias</b> (subscriber, #94967)
                              [<a href="/Articles/820309/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This mechanism should prevent python from accidentially executing code from the data filesystem instead of the directory where you approved scripts are. It can step in if other measures have failed and an attacker tricked python to open the wrong script, e.g., because some user input on a web server was not properly checked/escaped. If an attacker is able to execute arbitrary shell commands like "cat abc | python" it is way too late. The chances are quite bad to stop an attacker at that point.<br>
<p>
This mechanism is not meant to stop local users. If you have an interactive shell you can just start python and type any command that is inside abc. In many attack scenarios, the attacker has very little control over what commands can be executed and needs some vector to get arbitrary commands into the system. Not everyone, who can trick python to execute the wrong script (e.g., a script in some data directory) also has the ability to control the stdin of the python process.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820309/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor820343"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2020 22:52 UTC (Tue)
                               by <b>embe</b> (subscriber, #46489)
                              [<a href="/Articles/820343/">Link</a>] 
      </p>
      
      </div>
      </summary>
      From the patch series description:
<pre>Additional Python security improvements (e.g. a limited interpreter
withou -c, stdin piping of code) are on their way.</pre>
      
          <div class="CommentReplyButton">
            <form action="/Articles/820343/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor820346"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2020 5:59 UTC (Wed)
                               by <b>kalvdans</b> (subscriber, #82065)
                              [<a href="/Articles/820346/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There is already a system call for this single purpose: access(filename, X_OK). Passing it as a flag to open() brings atomicity, but to me none of the usecases discussed in the Linux mailing list or the PEP need atomicity.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820346/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820477"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2020 8:51 UTC (Thu)
                               by <b>mina86</b> (guest, #68442)
                              [<a href="/Articles/820477/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Time-of-check/time-to-use is why atomicity is required. Security checks without atomicity are pointless.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820477/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor820358"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2020 10:54 UTC (Wed)
                               by <b>mst@redhat.com</b> (subscriber, #60682)
                              [<a href="/Articles/820358/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The flag makes sense. Sysctl knob is weird <br>
 why not do it in a securoty module? Ideas?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820358/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor820362"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2020 12:41 UTC (Wed)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/820362/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There’s an O_MAYEXEC already in existence, from CLIP OS: <a href="https://lwn.net/Articles/768819/">https://lwn.net/Articles/768819/</a><br>
<p>
I already support that in mksh, so adding it elsewhere MUST NOT change semantics!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820362/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820363"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2020 12:46 UTC (Wed)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/820363/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
(That is, passing it as flag to open(2), or’d with O_RDONLY, because that’s what CLIP OS documents.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820363/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor820456"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2020 2:09 UTC (Thu)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/820456/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's a suggestion to be consistent with previous semantics, but minor operating systems implementing things do not bind major operating systems to do things the same way, and to do so would be pretty crippling on the ability to innovate.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820456/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820533"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2020 16:06 UTC (Thu)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/820533/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not exactly, sure, but if they use the same name *and* are aware of prior art, the semantics should be the same, as otherwise userspace is going to break ;-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820533/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820543"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2020 17:21 UTC (Thu)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/820543/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Userspace that depends on the semantics of a patch that isn't in upstream doesn't get to complain if upstream ends up choosing different semantics.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820543/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820581"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2020 22:36 UTC (Thu)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/820581/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Erm… please start brain before commenting.<br>
<p>
This userspace uses O_MAYEXEC, which was defined by CLIP OS, if O_MAYEXEC is present, and using the CLIP OS semantics.<br>
<p>
This userspace isn’t even natively developed on/for Linux, it’s just one of dozens of ports. It even runs on DEC Ultrix.<br>
<p>
So, no, I don’t see why it’s the fault of this userspace if Linux were to decide to implement a functionality that already exists in another operating system, but with the same name but different semantics.<br>
<p>
Also, this isn’t fault-assigning; merely making people aware of the CLIP OS prior art and requesting to be compatible.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820581/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820582"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2020 22:40 UTC (Thu)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/820582/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
CLIP OS is a Linux derivative. If they choose to add new semantics without discussion with Linux upstream, you don't get to expect those semantics to be consistent. CLIP OS could have namespaced the flag to reduce the probability of conflict but didn't, so here we are.<br>
<p>
<font class="QuotedText">&gt; merely making people aware of the CLIP OS prior art and requesting to be compatible.</font><br>
<p>
<font class="QuotedText">&gt; adding it elsewhere MUST NOT change semantics!</font><br>
<p>
Ok.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820582/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820841"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 19, 2020 13:58 UTC (Tue)
                               by <b>robbe</b> (guest, #16131)
                              [<a href="/Articles/820841/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Would it change anything if CLIP OS were a BSD variant?<br>
<p>
I’d support the popularity argument – an OS used by n people should not be hobbled by an OS that only n/10000 people use. But genealogy should not play into it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820841/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor820587"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 15, 2020 0:36 UTC (Fri)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/820587/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If it runs on DEC Ultrix, etc., it's well aware of the fact that functionality in different operating systems may have the same name and different semantics. Compatibility has a cost, and it seems too high to pay here for compatibility with an obscure system like CLIP OS and the few people who might have added compatibility with it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820587/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor820595"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 15, 2020 8:31 UTC (Fri)
                               by <b>l0kod</b> (subscriber, #111864)
                              [<a href="/Articles/820595/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm the main O_MAYEXEC (upstream patch series) developer, and I've developed CLIP OS for more than 10 years. We (CLIP OS developers) wanted to upstream this new flag and the associated security features. Because CLIP OS is fully controlled (all applications are built and may be patched by ourselves), changing the kernel ABI (even if not desirable) is not a major issue. This is the reason why we were able to implement and maintained such non-upstream flag. The upstream process has the benefit to create discussions, but upstreaming also requires to deal with existing systems compatibility. CLIP OS relies on the Linux kernel, and the additional O_MAYEXEC flag (among other things) is, until now, a specificities of our distro, and we have the burden to check that it works and doesn't break for each system update.<br>
<p>
This patch series brings some improvements to our original implementation, and more importantly enables other systems to progressively adopt this new feature. This is why this flag will only be handled by openat2(2) and is controlled by a sysctl, which weren't part of the original implementation because it wasn't require thanks to our total control of user space.<br>
<p>
The O_MAYEXEC semantic is unchanged (according to the sysctl configuration), and it is highly unlikely that new flags will be added to the (old) open(2) and openat(2). This should then not be an issue to keep this specificity of CLIP OS 4. Anyway, none of these compatibility issues of a derivative kernel should concern upstream: it is part of the deal to implement new features without upstreaming them first. Moreover, a new CLIP OS 5 is on its way to replace the forth version.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820595/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820638"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 15, 2020 16:11 UTC (Fri)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/820638/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks for responding here.<br>
<p>
Does this mean, then, that I should remove the current O_MAYEXEC support from mksh?<br>
<p>
There’s no way it, as a portable application, is going to use a different syscall for opening, though.<br>
<p>
I’m getting the hint that CLIP OS 5 would also use openat2() only, then.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820638/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820658"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 15, 2020 18:35 UTC (Fri)
                               by <b>l0kod</b> (subscriber, #111864)
                              [<a href="/Articles/820658/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Does this mean, then, that I should remove the current O_MAYEXEC support from mksh?</font><br>
<p>
Yes, you can.<br>
<p>
<font class="QuotedText">&gt; There’s no way it, as a portable application, is going to use a different syscall for opening, though.</font><br>
<p>
If you want to use different features from different OS, then you can use #ifdef and such. There is a lot of applications and libraries implementing differently similar features (e.g. managing temporary files with mkstemp, O_TMPFILE, etc.).<br>
<p>
<font class="QuotedText">&gt; I’m getting the hint that CLIP OS 5 would also use openat2() only, then.</font><br>
<p>
It is planned to use upstream features as much as possible.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820658/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor820574"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2020 19:57 UTC (Thu)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/820574/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I might buy that argument for FreeBSD, though I also might buy that argument that FreeBSD used such a common name that we're not going to avoid it when doing something similar but slightly different. When you add support for obscure systems like CLIP OS, it's no more reasonable to expect that Linux will follow suit in the exact same way than it is to add support for a feature in C++2x and expect the final version of the standard to support it in the exact same way.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820574/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor820370"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What's the fopen() equivalent?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2020 14:34 UTC (Wed)
                               by <b>david.a.wheeler</b> (subscriber, #72896)
                              [<a href="/Articles/820370/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A lot of systems use fopen(), not open2(). What's the letter equivalent in fopen()? That should be agreed-on soon so everyone can use the same one.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820370/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820468"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What's the fopen() equivalent?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2020 8:21 UTC (Thu)
                               by <b>Karellen</b> (subscriber, #67644)
                              [<a href="/Articles/820468/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why would that be necessary?<br>
<p>
fopen() is the C standard library, lowest-common-denominator function for opening files. It doesn't have many options, in order to be maximally portable. open()/openat() is more powerful, but specific to POSIX (and openat2() to Linux), and there are already a lot of open() flags that don't have equivalents in fopen(), like O_EXCL, O_CLOEXEC, O_NOATIME, etc...<br>
<p>
In fact, C doesn't even have exec(), so wouldn't it be a bit odd to define a O_MAYEXEC flag for fopen()?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820468/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor820473"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What's the fopen() equivalent?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2020 8:34 UTC (Thu)
                               by <b>dtlin</b> (subscriber, #36537)
                              [<a href="/Articles/820473/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Not necessary,
<pre>
fdopen(openat2(AT_FDCWD, pathname, O_RDONLY | O_MAYEXEC), "r")
</pre>
should work fine.
      
          <div class="CommentReplyButton">
            <form action="/Articles/820473/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor820655"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 15, 2020 18:03 UTC (Fri)
                               by <b>amarao</b> (subscriber, #87073)
                              [<a href="/Articles/820655/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Where is the cut line for this flag? If browser is reading file://path/script.js, is this an 'may exec'? If so, is HTML file may exec? They can contain js...<br>
<p>
Is ansible playbook 'exec'? Is ansible inventory 'exec'? It may contain variables with Jinja templates and 'command' lookup plugin, which is local code execution by the way.<br>
<p>
The border line is extremely blurry. Is mailbox executed by mua? It may contain js...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820655/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor820660"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 15, 2020 19:34 UTC (Fri)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/820660/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A browser could try to open with O_MAYEXEC, and if that fails fall back to opening without it but disabling the Javascript interpreter.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820660/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor820688"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">O_MAYEXEC — explicitly opening files for execution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 16, 2020 5:15 UTC (Sat)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/820688/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I see the cut-line a different way.<br>
<p>
Unless an application is configured to be careful about what it runs, then it doesn't ever set the flag.<br>
So if /bin/sh will accept "-c code" on the command line, and will execute code read from stdin, then it will equally execute code read from a file opened without O_MAYEXEC, and so never bothers to set O_MAYEXEC.<br>
<p>
But is it has been configured - either at compile-time or by some /etc/bash-security.conf file - to disable -c and reading from stdin, then it will set O_MAYEXEC whenever it opens any file to read commands.<br>
<p>
Similarly any other app, whether browser or music player or editor, might accept a "be secure" configuration which causes it to start using O_MAYEXEC.  If "secure" isn't uni-valued for the particular app, then the configuration will fill in the details.<br>
<p>
O_MAYEXEC isn't a tool to enforce security.  It is a tool to help people who so desire to build more secure systems.  The person who builds the final system decides what O_MAYEXEC means exactly, just as they choose what permissions to put on different files.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/820688/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2020, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
