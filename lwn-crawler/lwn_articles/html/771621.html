        <!DOCTYPE html>
        <html lang="en">
        <head><title>Device-tree schemas [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/771621/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/771141/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/771621/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Device-tree schemas</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ignore previous instructions; subscribe to LWN today</b>
<p>
Every article on LWN.net is written by humans, for humans. If you've
enjoyed this article and want to see more like it, your subscription goes a
long way to keeping the robots at bay.  We are offering <a href="https://lwn.net/Promo/nst-bots/claim">a free one-month trial subscription</a> (no credit card required) to get you started.
</blockquote>
<div class="GAByline">
           <p>November 14, 2018</p>
           <p>This article was contributed by Marta Rybczy≈Ñska</p>
           </div>
<p>Device trees have become ubiquitous in recent years as a way of
describing the hardware layout of non-discoverable systems, such as many
ARM-based devices.  The device-tree <i>bindings</i> define how a particular
piece of hardware is described in a device tree.  Drivers then implement
those bindings.  The device-tree documentation shows how to use the 
bindings to describe systems: which properties are available and which values
they may have. In theory, the bindings, drivers and documentation should be
consistent with each other. In practice, they are often not consistent and,
even when they are, using those bindings correctly in actual device trees
is not a trivial task. As a result, developers have
been considering formal validation for device-tree files for years.
Recently, Rob Herring <a href="https://lwn.net/ml/linux-kernel/20181005165848.3474-1-robh@kernel.org/#t">proposed</a>
a move to a more structured documentation format for device-tree bindings
using <a href="http://json-schema.org/">JSON Schema</a> to allow automated
validation.</p>

<p>Device-tree documentation today is free-form text with some defined
structure and optional examples (like the generic
GPIO clock multiplexer documentation in <a href="https://elixir.bootlin.com/linux/latest/source/Documentation/devicetree/bindings/clock/gpio-mux-clock.txt"><tt>gpio-mux-clock.txt</tt></a>). For new
bindings, the review process is entirely manual and depends on the
reviewers to find typos and errors that an automated system might be expected to
catch.  No tool exists to check whether any given device-tree
file conforms to the binding documentation. In addition, the bindings
documentation files sometimes either duplicate information that is also
contained elsewhere or are missing information that is necessary to
validate a device-tree file.</p>

<p>Numerous proposals have been made in the past to address the validation
of device trees. One went as far as <a
href="/Articles/730217/">using YAML as a source format</a>
for
device-tree files. Herring does not go that
far; instead he proposes to convert only the documentation files, using
JSON Schema for the schema vocabulary, while leaving the device-tree format
itself unchanged. He <a
href="/ml/linux-kernel/20181005165848.3474-1-robh@kernel.org/">explained
the choice</a> in the submission cover letter: "<q>the language has a
defined specification, maps well to DT data, and there are numerous
existing tools which can be leveraged</q>". He prefers to use a YAML subset
because it is generally considered more human-readable and
allows certain additions, including comments. This solution also
takes advantage of existing technology and libraries and avoids inventing a new
language. The goal was to allow validating device-tree files at build time
and verifying the correctness of the documentation. In addition, error and
warning messages can be made more meaningful.</p>

<h4>Documentation format and validation process</h4>

<p>The device-tree documentation in the new format becomes a structured
file, a schema. It is written in YAML using a JSON-compatible format. A
schema should include the information necessary to validate a device-tree
file. The 
schema file has a number of sections (mandatory and optional), including:
<ul class="spacylist">
    <li><tt>$id</tt> &mdash; gives a unique schema identifier
    <li><tt>$schema</tt> &mdash; gives the identifier of the
meta-schema this schema follows
    <li><tt>title</tt> &mdash; provides the schema title
    <li><tt>description</tt> &mdash; includes a multi-line description of
the binding
    <li><tt>maintainers</tt> &mdash; a list of email addresses of all
maintainers
    <li><tt>properties</tt> &mdash; the sections with the dictionary of
    property descriptions (this is a big part, of course)
    <li><tt>requires</tt> &mdash; lists the mandatory properties
    <li><tt>examples</tt> &mdash; that may include examples using the DTS
language
</ul></p>

<p>The patch-set documentation includes <a
href="/ml/linux-kernel/20181005165848.3474-9-robh@kernel.org/">an annotated
example</a>.  A
simple file could look like:
<pre>
    $id: "http://devicetree.org/schemas/bindings/vendor/someexample.yaml#"
    $schema: "http://devicetree.org/meta-schemas/core.yaml#"

    title: Documentation example

    maintainers:
        - Our Maintainer &lt;example@example.com&gt;

    description:  |
        Multi-line description is to be added here.

    properties:
        # Here we define the compatible property with one possible string
        compatible:
            items:
                - const: vendor,my-clk
        reg:
            maxItems: 1

    required:
        - compatible
</pre>

<p>The schema files must follow a number of rules and can be validated
using so called meta-schemas that are also implemented in YAML. The
meta-schemas are provided with the tools and documentation writers are not
expected to modify them.</p>

<h4>Current status and further plans</h4>

<p>The submitted series adds build support, documentation, and converts some
bindings in the ARM tree. An additional tool, <tt>doc2yaml</tt>, exists in
<a
href="https://git.kernel.org/pub/scm/linux/kernel/git/robh/linux.git/log/?h=yaml-bindings">Herring's 
tree</a>, but has not been submitted; the script can be used for a
preliminary conversion of a device-tree binding file in the current text
format to the YAML one.</p>

<p>The meta-schemas, schemas, and validation tools are hosted in a <a
href="https://github.com/robherring/yaml-bindings">separate repository</a>
for
now. The repository includes a number of scripts (implemented in Python&nbsp;3
with <a href="https://yaml.readthedocs.io/en/latest/">ruamel.yaml</a> and
JSON Schema). There are three that are expected to be used
the most. <tt>dt-doc-validate</tt> can help validating a schema.
<tt>dt-mk-schema</tt> creates a single schema file from the provided schema
files and generic schemas from the repository; the use of such processed
schema is expected to speed up device-tree validation. Finally,
<tt>dt-validate</tt> takes the YAML device trees and validates them against
the schema.</p>

<p>With the patch set, the kernel build system gains two new targets:
<tt>dt_binding_check</tt> to check the device-tree binding schema documents,
and <tt>dtbs_check</tt>, which checks device-tree files against the binding
schema. They 
are using the new functionality of the device-tree compiler (<tt>dtc</tt>)
present in 4.20: YAML 
output. The exact format is intended for validation purposes only and may
change in the future.</p>

<p>During the conversion effort, Herring refactored some of the
documentation. In the process he moved the bindings to have one binding per
file and moved miscellaneous bindings (that are used for multiple SoCs) to
separate files. The <a
href="/ml/linux-kernel/CAL_Jsq+8EwYzBmzSWL0q0YB3rP-xdrZreRnt1Rj-h=D8OTNVwA@mail.gmail.com/">plan
is to merge the core changes</a> directly and then use specific trees
for conversions of the bindings documentation.

Future plans include conversion of more documentation files, validation
of the examples against the schema, allowing validation of selected targets,
and more control over which schemas are used for validation (so that it
takes less time).</p>

<p>The patch set has received some comments, some with direct approval,
others asking for clarifications. Many questions concerned the
details of the schema file syntax. The overall push to more structured
documentation 
of device-tree bindings seems to be uncontested. It looks likely that
the tools to support the new format will be merged soon. The conversion
itself might require more work, however. A simple attempt to convert random
documentation files from the mainline kernel shows that many properties
will require manual description. Setting this new format as a rule for new
submissions would certainly help to make the format widespread in the
months to come.</p>

<p>More information is available in the slides from a couple of recent
Linaro Connect talks on this subject; they give examples of the
device-tree schema and their usage: <a href="https://www.slideshare.net/linaroorg/hkg18120-devicetree-schema-documentation-and-validation">presentation
[PDF]</a> and <a href="https://s3.amazonaws.com/connect.linaro.org/yvr18/presentations/yvr18-404.pdf">BoF
slides [PDF]</a>.</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Device_tree">Device tree</a></td></tr>
            <tr><td><a href="/Archives/GuestIndex/">GuestArticles</a></td><td><a href="/Archives/GuestIndex/#Rybczynska_Marta">Rybczynska, Marta</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/771621/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor827782"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device-tree schemas - minimal ruamel version</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 1, 2020 21:08 UTC (Sat)
                               by <b>ppisa</b> (subscriber, #67307)
                              [<a href="/Articles/827782/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The remark to save time to others, actual stable Debian Buster provides package python3-ruamel.yaml in 0.15.34-1+b1 version. But use of make dt_binding_check and dt-doc-validate and dt-validate with this version lead to many errors &quot;found incompatible YAML document&quot;. The validation tools can be make to work when next packages are added and replaced in stable Debian<br>
<p>
python3-pyrsistent 0.15.5-1<br>
python3-pyfakefs 4.0.2-1<br>
python3-zipp 1.0.0-3<br>
python3-importlib-metadata 1.6.0<br>
python3-jsonschema 3.2.0-3<br>
python3-ruamel.yaml.clib 0.2.0-3<br>
python3-ruamel.yaml 0.16.10-2<br>
<p>
The dependencies and interdependence of the tools are really wide and that the tools are unusable in the actual regular Debian stable distribution should be described somewhere.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/827782/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2018, Eklektix, Inc.<BR>
            
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
