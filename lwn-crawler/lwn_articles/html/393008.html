        <!DOCTYPE html>
        <html lang="en">
        <head><title>LSM stacking (again) [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/393008/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/392445/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/393008/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>LSM stacking (again)</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ready to give LWN a try?</b>
<p>
With a subscription to LWN, you can stay current with what is happening in the Linux and free-software community and take advantage of subscriber-only site features.  We are pleased to offer you <b><a href="https://lwn.net/Promo/nst-trial/claim">a free trial subscription</a></b>, no credit card required, so that you can see for yourself.  Please, join us!
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>June 23, 2010</br>
           </div>
<p>
Kees Cook is back with another <a href="/Articles/393010/">proposal</a> for
a kernel change that would, at least in his mind, provide more security,
this time by restricting the <tt>ptrace()</tt> system call.
But, like his earlier <a href="http://lwn.net/Articles/390323/">symbolic
link patch</a>, this one is not being particularly well-received on linux-kernel.
It has, however, sparked some discussion of a topic that seems to recur
with some frequency in that venue: stacking Linux security modules (LSMs).
</p>

<p>
Cook's patch is fairly straightforward; it creates a sysctl called
<tt>ptrace_scope</tt> that defaults to zero, which chooses the existing
behavior.  If it is set to one, though, it only allows <tt>ptrace()</tt> to
be called on descendants of the tracing process.  The idea is to stop a
vulnerability in one program (Pidgin, say) from being used to trace another
program (like Firefox or GPG-agent), which would allow extracting credentials or other
sensitive information.  Like the previous symlink patch, it is based on a
patch that has long been in the <a
href="http://www.grsecurity.net/">grsecurity</a> kernel. 
</p>

<p>
As with the previous proposal, Alan Cox was quick to <a
href="/Articles/393015/">suggest</a> that it be put into an LSM:
<div class="BigQuote">
So NAK. If you want to use bits of grsecurity then please just write
yourselves a grsecurity kernel module that uses the security hooks
properly and stop messing up the core code. It's all really quite simple,
the [infrastructure] is there, so use it.
</div>
</p>

<p>
But, one problem with that plan is that LSMs do not stack.  One can
have SELinux, Smack, and TOMOYO enabled in a kernel, but only
one&mdash;chosen at boot time&mdash;can be active.  There have been <a
href="http://lwn.net/Articles/368730/">discussions</a> and <a
href="http://lwn.net/Articles/114588/">proposals</a> for LSM stacking (or
chaining) along the way, but nothing has ever been merged.  So, two
"specialized" LSMs cannot do their separate jobs in the kernel and users
will have to choose between them.
</p>

<p>
For "full-featured" solutions, like SELinux, that isn't really a problem,
as users can find or create policies to handle their security
requirements.  In addition, James Morris <a href="/Articles/393018/">points
out</a> that SELinux has a boolean, <tt>allow_ptrace</tt>, to do what
Cook is trying to do: "<q>You don't need to write any policy, just set
it [allow_ptrace] to 0</q>".  But, for those that don't want to use
SELinux, that's no solution.  As Ted Ts'o <a href="/Articles/393130/">puts
it</a>:
<div class="BigQuote">
i think we really need to have stacked LSM's, because there is a large set
of people who will never use SELinux.  Every few years, I take another 
look at SELinux, my head explodes with the (IMHO unneeded complexity),
and I go away again...
<p>
Yet I would really like a number of features such as this ptrace scope idea ---
which I think is a useful feature, and it may be that stacking is the only
way we can resolve this debate.   The SELinux people will never believe that
their system is too complicated, and I don't like using things that are impossible
for me to understand or configure, and that doesn't seem likely to change anytime
in the near future.
</div>
</p>

<p>
Others were also favorably disposed toward combining LSMs, though the
consensus seems to be for chaining LSMs in the security core rather than
stacking, as was done with SELinux and Linux capabilities
(i.e. <tt>security/commoncap.c</tt>).  In the stacking model, each LSM
is responsible for calling out to any other secondary LSMs for each
security 
operation, whereas chaining is "<q>just a walk over a list of
security_operations</q>" calling each LSM's version from the core, as  
Eric 
W. Biederman <a href="/Articles/393133/">described</a>.  But it's not as easy as it might seem at
first glance, as Serge E. Hallyn, who proposed a stacking mechanism in
2004, <a href="/Articles/393147/">points out</a>:
<div class="BigQuote">
The general answer tends to be "generic stacking doesn't work, LSMs
need to know about each other."  But even for that (as evidenced by
the selinux+commoncap experience with stacking) is hairy, and more
to the point it probably does not scale when we have 5-10 small
LSMs.  I.e. LSM 1 wants to prevent some action while LSM 2 requires
that action to succeed so that it can properly prevent another
action.  Concrete examples are buried in the stacker discussions
on the lsm list from 2004-2005.
</div>
</p>

<p>
It seems that there may be some discussion of LSM stacking/chaining at the
<a
href="https://security.wiki.kernel.org/index.php/LinuxSecuritySummit2010">Linux
security summit</a>, as part of Cook's presentation on "widely used, but
out-of-tree" security solutions, but perhaps also in a "beer BOF" that
Hallyn is proposing.  

<p>
The way forward for both of Cook's recent proposals
looks to be as an LSM and, to that end, he has posted the <a
href="http://lwn.net/Articles/393012/">Yama LSM</a>, which incorporates the
symlink protections and <tt>ptrace()</tt> limitations that he
previously posted.  In addition, it adds the ability to restrict hard links
such that they cannot be created for files that are either sensitive
(e.g. setuid) or those that are not readable and writable by the link
creator.  Each of these measures can be enabled separately by sysctls in
<tt>/proc/sys/kernel/yama/</tt>. 
</p>

<p>
While "Yama" might make one start looking for completions of an acronym
("Yet Another ..."), it is actually named for a <a href="http://en.wikipedia.org/wiki/Yama">deity</a>: "<q>Yama is roughly the 'lord of
death/underworld' in Buddhist and Hindu tradition, kind of over-seeing
the rehabilitation of impure entities</q>", Cook said.  Given the number
of NAKs that his recent patch proposals have received, 
calling Yama the "<q>NAKed Access Control
system</q>", shows a bit of a sense of humor about the situation.
DAC, MAC, RBAC, and others would now be joined by NAC if Yama gets merged.
</p>

<p>
So far, discussion of Yama has been fairly light, and without any major
complaints.  While some are rather skeptical of the protections that Cook
has been proposing, they are much less likely to care if they live in an
LSM, rather than "<q>junk randomly spewed [all] over the tree</q>",
as Cox <a href="/Articles/393156/">put it</a>.  

<p>
Once these simpler security
tasks are encapsulated into an LSM, Morris <a
href="/Articles/393159/">said</a>,
the kernel hackers "<q>can evaluate the possible need for some form of 
stacking or a security library API</q>" to allow these
measures to coexist with SELinux, AppArmor, and others.  Given the fairly
broad support for the LSM approach, it would seem that Yama, or some
descendant, could make it into the mainline.  Whether that translates
to some kind of general mechanism for combining LSMs in interesting ways
remains to be seen&mdash;it should be worth watching, stay tuned.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-Security_modules">Security/Security modules</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Linux_Security_Modules_LSM">Linux Security Modules (LSM)</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/393008/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor393420"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 4:46 UTC (Thu)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/393420/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't think stacking modules is actually a good idea. It way over complicates practical system security. I also think that the assertion that SELinux isn't used needs some clarification and may be false. As a user and administrator of Linux systems everything has come with selinux on and enforcing for many years now. I have not had a problem with this, the few times I needed to run chcon or change the policy I can count on one hand and have not required more than a few lines generated by audit2allow. <br>
<p>
The take-up by individual developers to write policies for their code instead of the distributers and the understanding level of the full policy amongst anyone who isn't responsible for writing policies full time might be low but I don't think that selinux has failed at all in penetrating the marketplace and in being a useful tool that all take advantage of.  I think that the set of people that aren't using selinux or another comprehensive LSM module are fairly low. The people who are disabling selinux are just very vocal and uninterested in actually solving their security policy problem, whatever it happens to be. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393420/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393441"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 7:32 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/393441/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
note that by 'everything' you must mean redhat/fedora<br>
<p>
ubuntu currently ships with apparmor as it's default LSM<br>
<p>
that knocks a huge hole through your assertian<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393441/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393555"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 15:13 UTC (Thu)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/393555/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Maybe that was a bit hyperbolic, I didn't mean to suggest that there weren't other competitive security frameworks in production use. What I wanted to point out is that there are many millions of deployed systems with selinux on by default and most people are happy with selinux if they are even aware that it exists. A small, vocal number have trouble and disable it instead of figuring out how to solve their problem but I think that's a small minority and I'm not sure what reasonable change would satisfy them. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393555/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393938"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 27, 2010 15:59 UTC (Sun)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/393938/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The millions of deployed systems have people who don't need to touch the SELinux configuration. The people who are dissatisfied with SELinux are those who use it until they have to install something that requires they change the policy; then they look at the hundreds of thousands of lines of policy and say 'life is too short'.<br>
<p>
This is even true in areas such as massive stockbroking servers, where they really do care a good bit about security. Not even there do they care enough to make SELinux work with them: what in a simpler system might be a small possibility that a config fixup might break something, in a system of the complexity of shipped SELinux policies becomes a *large* possibility in these people's eyes. So they always turn SELinux off. And I think they're right.<br>
<p>
Probably nowhere outside the military would people care enough to fix such problems. Of course, that's where SELinux emerged from: and it's probably a good fit for there.<br>
<p>
If we want a security framework we can configure ourselves without driving ourselves insane -- if we occasionally have demands not met by our distributors -- then something simpler, something *comprehensible* is needed.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393938/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393952"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 27, 2010 18:00 UTC (Sun)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/393952/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I agree, many people run selinux systems without incident and of the few admins who do run into a need to make changes disable it instead. I don't think it is only miliary wonks who can work with it, in my environment I made a concerted effort to just make the appropriate policy changes when the need arrised. I found in my experience that the few changes I needed were not really that hard to make. <br>
<p>
A few times I needed to make a local policy to allow an app to make syscalls it otherwise wasn't allowed to do, iterations of audit2allow made short work of it. On another instance I needed to grep through the existing security context list to find a suitable policy as one already existed and I was just a chcon away from my app working.  I haven't had problems with third party apps because they tend not to come with policies so just pick up the default. <br>
<p>
I don't think selinux is bad but there does not seem to be the amount of shared knowledge and lore that would allow people to eaisly solve problems when they come up. You can find some help via google or serverfault but the quality is sometimes poor and the most common recommendation is to turn selinux off rather than use the tools that come with to actually understand and fix the problem. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393952/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor393455"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 8:04 UTC (Thu)
                               by <b>mjthayer</b> (guest, #39183)
                              [<a href="/Articles/393455/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
My personal problem with SELinux is that it tries to solve all problems with one solution (which seems to rather run against what many would call the "*NIX tradition").  I think that having individual components attacking individual issues that SELinux addresses (off the top of my head, sandboxing and controlled privilege escallation, but I'm definitely no security expert) might have the potential to be a lot simpler.<br>
<p>
On the other hand, SELinux is there now, and has the advantage that it is reasonably transparent to the developer, so they don't really need to understand much about how SELinux policy works when they write their application.  At the worst, if it is a third-party product, some poor person working on the installer has to worry about that.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393455/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor393471"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 9:26 UTC (Thu)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/393471/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Stacked security modules are common. Just look at your /etc/pam.d, and it works just fine.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393471/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393553"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 14:57 UTC (Thu)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/393553/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The difference in complexity is massive though. To be able to effectively stack LSM modules you'd need the equivalent of a Pam config for each hook point. You cant guarantee that a coarser grained policy is going to make sense. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393553/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393554"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 15:05 UTC (Thu)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/393554/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why?<br>
<p>
I see that we can broadly divide LSM hooks into: filesystem, network, CPU resources, misc.<br>
<p>
So we can specify: "First use AppArmor to check filesystem access, but use SeLinux to check security labels on network packets".<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393554/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393575"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 16:26 UTC (Thu)
                               by <b>bronson</b> (subscriber, #4806)
                              [<a href="/Articles/393575/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So and AppArmor and SELinux and Smack and Tomoyo would need to be written with all possible permutations in mind?  That sounds absolutely hellish to analyze and test.  Remember, we're talking about security here -- failure is far worse than a kernel panic.<br>
<p>
Maybe it would be possible if all projects split their code into completely isolated modules: AppArmor-Network, AppArmor-Filesystem, etc.  No interaction allowed between the Network and Filesystem modules.  But I don't think that would meet SELinux's needs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393575/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393583"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 16:54 UTC (Thu)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/393583/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>A safer variation on the same theme would be to write the stacking such that each LSM only gets to check accesses that other loaded LSMs have permitted; for example "check everything with AppArmor. If AppArmor permits it, fall through to SELinux. If SELinux permits it, fall through to Yama."
<p>If you then want to have AppArmor handle all the filesystem stuff, while SELinux only deals with networking, you have to design your AppArmor and SELinux policies to do this, and you've hopefully thought about the failure modes of doing so. If Clueless CrazyAdmin uses off-the-shelf SELinux and AppArmor policies, they get only the accesses that both LSMs believe are safe.
<p>In practice, such a stacking method makes stacking full-fledged security modules like SELinux and Smack together rather pointless; where you benefit is with "boutique" LSMs like Yama, which aim to prevent a limited set of security flaws - you can stack Yama and SELinux, and get Yama covering everything, while SELinux only protects that part of the system that you've written policy for.
      
          <div class="CommentReplyButton">
            <form action="/Articles/393583/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor393602"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 17:41 UTC (Thu)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/393602/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"So and AppArmor and SELinux and Smack and Tomoyo would need to be written with all possible permutations in mind?"<br>
<p>
Why would AppArmor need to know anything about SELinux? <br>
<p>
A special stacking-driver should think like: "Oh, we have a file request. Let's see: - we need to pass it to AppArmor first. Done, result is OK. Then we need to pass it to Yama, result is OK. So we can perform the action".<br>
<p>
At no point AppArmor needs to know that after it returns 'OK' further checks will be carried out.<br>
<p>
"That sounds absolutely hellish to analyze and test. Remember, we're talking about security here -- failure is far worse than a kernel panic."<br>
<p>
Whose who need NSA certification can go and make love with SELinux.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393602/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor393765"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 25, 2010 14:01 UTC (Fri)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/393765/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You're using PAM as your example? Seriously?<br>
<p>
It is /way/ too easy to screw up PAM configuration and get something that doesn't work, or, worse something which gives every appearance of working but turns out to inadvertently let anyone into service X with root privilges by providing a blank username and password.<br>
<p>
If PAM is the standard to which stacked modules will be held, they're never going to get into the Linux kernel.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393765/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393771"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 25, 2010 14:09 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/393771/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But the alternative is no access control at all. Is it better?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393771/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393979"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 28, 2010 1:54 UTC (Mon)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/393979/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That is a false dichotomy if I ever heard one. The alternative to stackable LSM is the current state, several comprehensive security frameworks, not a lack of access permissions.  It's unfortunate that this approach starves out small single purpose access control modules but any controll which is worthwhile will probably get picked up by one or more frameworks eventually. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393979/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393980"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 28, 2010 2:16 UTC (Mon)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/393980/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Quote: any controll which is worthwhile will probably get picked up by one or more frameworks eventually<br>
<p>
If you believe that this is the case you should have no objection to LSM stacking as you will only want to use these major frameworks that have picked things up from the small players anyway.<br>
<p>
the rest of us who are interested in multiple small solutions that we can understand will be your beta testers for these small modules before they can get picked up.<br>
<p>
if the only way to try something new is to either abandon all protection from anything else, or wait until the idea gets picked up in the big framework (without anyone being able to test it until then) you have very little testing of new things<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393980/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393982"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 28, 2010 4:36 UTC (Mon)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/393982/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Your arguments do not convince me that the kernel developers are wrong in rejecting stackable LSM. What you describe, kernel hackers making their own new modules to test different security ideas, is already happening in the real world and is the reason we are having this conversation.  You don't need this change to support testing, it's not clear where exactly it would be useful. Not just useful but it is not clear that a stackable approach would be better than just having a working security system, whichever one you like. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393982/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor394138"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 29, 2010 12:54 UTC (Tue)
                               by <b>mpr22</b> (subscriber, #60784)
                              [<a href="/Articles/394138/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>My perspective is that we're in a "pick one" scenario, with the options being roughly:</p>
<ul>
<li>The kernel team provides LSM stacking.</li>
<li>Someone writes an LSM which implements "LSM stacking" by some godawful collection of shims.</li>
<li>Someone writes a mindblowingly generic LSM in which everything is possible but nothing is easy. World+dog are happy up until they want to do something that conflicts with their distro defaults, at which point they meet Pain.</li>
<li>End users get stuck with the choice of either putting up with what the "big boys" want to implement in their LSMs, or using a "boutique" LSM that covers a particular case but doesn't really handle general security well enough.</li>
</ul>
      
          <div class="CommentReplyButton">
            <form action="/Articles/394138/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor393984"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 28, 2010 5:47 UTC (Mon)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/393984/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And if you like two different tiny LSMs, and they get picked up by different security frameworks (each rejecting the LSM that the other accepted), I guess you can just suffer.<br>
<p>
I think I prefer stacking, at least restrictive stacking.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393984/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor393461"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 8:31 UTC (Thu)
                               by <b>TRS-80</b> (guest, #1804)
                              [<a href="/Articles/393461/">Link</a>] 
      </p>
      
      </div>
      </summary>
      What about allowing multiple LSMs to be loaded, with the limitation that they can't overlap in functionality? This allows multiple specialised LSMs to be loaded, but avoids the complexity of them having to interact with each other.
      
          <div class="CommentReplyButton">
            <form action="/Articles/393461/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor393558"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM chaining (&quot;stacking&quot;) is a good idea</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 15:14 UTC (Thu)
                               by <b>dwheeler</b> (guest, #1216)
                              [<a href="/Articles/393558/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <p>
I think it is a *good* idea to implement what this article calls "LSM chaining" (I called it <a href="http://www.dwheeler.com/misc/stacker.c">LSM stacking when I wrote such an implementation for the Linux kernel</a>).  The worries about interference are overblown.  I would expect that typical use would involve one "big" module (like SELinux) that covers the general case, plus zero or more "small" modules that forbid or restrict certain specific actions.  If it's cumulatively restrictive, many of the problems of figuring out what's okay to combine are quite easy.
</p>
<p>
Sure, a bad configuration/implementation can mess up security... but NOT having this capability makes it impossible to easily implement security configurations that you DO want.
And PAM shows that you CAN reasonably combine modules to produce useful effects.
</p>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393558/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393708"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM chaining (&quot;stacking&quot;) is a good idea</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 23:34 UTC (Thu)
                               by <b>cesarb</b> (subscriber, #6266)
                              [<a href="/Articles/393708/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; If it's cumulatively restrictive, many of the problems of figuring out what's okay to combine are quite easy.</font><br>
<p>
Adding restrictions is not always OK. There is always the risk of creating something like the "sendmail capabilities bug" (<a href="http://userweb.kernel.org/~morgan/sendmail-capabilities-war-story.html">http://userweb.kernel.org/~morgan/sendmail-capabilities-w...</a>).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393708/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor393939"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM chaining (&quot;stacking&quot;) is a good idea</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 27, 2010 16:00 UTC (Sun)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/393939/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, David mentioned that in the very next paragraph. His point stands, I think.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393939/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor393562"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 24, 2010 15:34 UTC (Thu)
                               by <b>MisterIO</b> (guest, #36192)
                              [<a href="/Articles/393562/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
IMO there should be only a limited set of combinations allowed, that is those LSMs whose functionality doesn't overlap at all. That way you wouldn't need any stacking, you could just allow each LSM to work on its own, without any interaction.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/393562/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor393751"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSM stacking (again)</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 25, 2010 11:38 UTC (Fri)
                               by <b>jengelh</b> (subscriber, #33263)
                              [<a href="/Articles/393751/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Dear Editor,
Yama could also be just the transcription of &#23665; &#12304;&#12420;&#12414;&#12305;, due to the hurdle it takes to master the topic of LSM security... ;-)
      
          <div class="CommentReplyButton">
            <form action="/Articles/393751/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2010, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
