        <!DOCTYPE html>
        <html lang="en">
        <head><title>Looking at reiser4 [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/99232/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/98509/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/99232/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Looking at reiser4</h1>
<div class="Byline">[Posted August 25, 2004 by corbet]
               <p>
               </div>
</div>
<div class="ArticleText">
The reiser4 filesystem came one step closer to inclusion when it was added
to <a href="/Articles/98658/">2.6.8.1-mm2</a>.  This filesystem was covered
here <a href="/Articles/41652/">in July, 2003</a>; those interested in a
lengthy writeup with lots of details and weird artwork can find it at <a
href="http://www.namesys.com/">namesys.com</a>.  In short, reiser4's claims
include very high performance, high-level transactional capability,
enhanced security, and a flexible plugin architecture which should make it
possible to do truly different and interesting things.
<p>
Actually playing with reiser4 involves getting a recent -mm kernel (or
downloading it separately and applying it to another kernel).  The tools for
building and checking reiser4 filesystems can be found <a
href="ftp://ftp.namesys.com/pub/reiser4progs/">over here</a>.  There is a
shareable library ("libaal") which must be built first, followed by the
"reiser4progs" package.  If the reiser4progs configuration process tells
you that you lack the proper version of libaal, it probably means you
forgot to run <tt>ldconfig</tt> between the two steps.
<p>

We ran some very simple tests using the only benchmark that really matters:
working with the kernel source tree.  The first step was to look at the
simple usage of space; reiser4 claims to be more efficient in that regard.
This table indicates how much space was used (in KB) in various points in
the kernel build process:
<p>
<center>
<table cellspacing=3>
<tr class="Odd"><th rowspan=2>Filesystem</th>
    <th colspan=3>Space usage</th></tr>
<tr class="Odd"><th>Empty</th><th>New kernel tree</th><th>Built kernel tree</th></tr>
<tr><td>reiser4</td>
    <td align="right">188</td>
    <td align="right">206,000</td>
    <td align="right">659,000</td></tr>
<tr><td>ext3</td>
    <td align="right">32,800</td>
    <td align="right">271,000</td>
    <td align="right">727,000</td></tr>
</table>
</center>
<p>
An empty ext3 filesystem has a fair amount of overhead (almost 33MB on a
2GB partition) that is not seen on reiser4; the reason is that reiser4 does
not need to pre-allocate any inode tables.  That saves some space; it also
means that reiser4 filesystems will never run out of inodes.  Reiser4 is
also clearly more efficient in its file layout; an unbuilt kernel tree takes
about 15% less space than on ext3.
<p>
The next step was a set of highly unscientific timing tests involving
various tasks: untarring a kernel, building that kernel, <a
href="/Articles/99240/">grepping dirty words</a> out of the kernel source,
and two <tt>find</tt> commands: one which 
tests on file names only, and one requiring a <tt>stat()</tt> of each
file.  The tests were run on some bleeding-edge hardware: an otherwise
unused 4GB IDE 
disk on a dual Pentium-450 system.  The filesystem was unmounted between
tests to clear its pages out of 
the cache.  Here's the results; two times are presented: elapsed and
system. 
<p>

<center>
<table cellspacing=3>
<tr class="Odd">
    <th rowspan=2>Filesystem</th>
    <th colspan=5>Test</th></tr>
<tr class="Odd">
    <th>Untar</th>
    <th>Build</th>
    <th>Grep</th>
    <th>find (name)</th>
    <th>find (stat)</th>
</tr>
<tr>
    <td>reiser4</td>
    <td align="right">67/41</td>
    <td align="right">1583/386</td>
    <td align="right">78/12</td>
    <td align="right">12.5/1.3</td>
    <td align="right">15.2/4.0</td>
</tr>
<tr>
    <td>ext3</td>
    <td align="right">55/24</td>
    <td align="right">1400/217</td>
    <td align="right">62/8</td>
    <td align="right">10.4/1.1</td>
    <td align="right">12.1/2.5</td>
</tr>

</table>
</center>
<p>
Anybody who tries to draw any real conclusions from the above results
should probably think again.  That said, it would seem that reiser4's claim
to being the fastest Linux filesystem remains unproven.  Incidentally,
here's another quote from the reiser4 configuration help text:
<p>
<div class="BigQuote">
	If using a kernel made by a distro that thinks they are our
        competitor (sigh) rather than made by Linus, always check each
        release to make sure they have not turned this on to make us look
        slow as was done once in the past.
</div>
<p>
This text describes a debugging option; that option was <i>not</i> enabled
for these tests.
<p>

Meanwhile, the inclusion of reiser4 into -mm has, as desired, increased the
number of developers looking at the code.  Many of them are not entirely
happy with what they see.  The first problem is that reiser4 will fail
horribly with 4K kernel stacks; it seems that quite a few large data
structures are kept on the stack.  The reiser4 hackers will be looking at
reworking memory allocation to get around that particular problem.
<p>

Rik van Riel was the first to <a href="/Articles/99255/">stumble across</a>
the <tt>sys_reiser4()</tt> system call.  The code to implement
<tt>sys_reiser4()</tt> is present (and built) in -mm, but the actual call
is not added to the system call table.  A patch comes with the source to
make that addition, however.
<p>
According to the documentation:
<p>
<div class="BigQuote">
	A new system call sys_reiser4() will be implemented to support
	applications that don't have to be fooled into thinking that they
	are using POSIX. Through this entry point a richer set of semantics
	will access the same files that are also accessible using POSIX
	calls....   Reiser4() will implement all features
	necessary to access ACLs as files/directories rather than as
	something neither file nor directory. These include opening and
	closing transactions, performing a sequence of I/Os in one system
	call, and accessing files without use of file descriptors
	(necessary for efficient small I/O). Reiser4 will use a syntax
	suitable for evolving into Reiser5() syntax with its set theoretic
	naming. 
</div>
<p>
This syntax, it seems, is implemented via a yacc-generated parser, which is
duly stuffed into the kernel.  As Rik notes, this approach is likely to be
controversial, even before people start thinking about what the new
operations actually do.

<p>
Reiser4 blurs the distinction between files and directories as part of Hans
Reiser's general view of how filesystems should be used.  For example,
extended attributes, according to Hans, should not exist in their own
namespace; they should just look like more files.  With the right plugins,
it should also be possible to do things like treat a <tt>tar</tt> archive
as a directory tree and move around within it.  There are, it seems,
some immediate problems with this idea.  As Christoph Hellwig <a
href="/Articles/99258/">pointed out</a>, reiser4 allows an open
with the <tt>O_DIRECTORY</tt> flag to succeed even if the target is not a
directory.  That defeats the use of <tt>O_DIRECTORY</tt> as a way of
avoiding race conditions and security holes, and is unlikely to go over
well.  Al Viro <a href="/Articles/99260/">noted</a> some severe locking
problems (leading to easy denial of service attacks) with the
file-as-directory implementation as well.
<p>

Reiser4, it seems, may have a bit of a rough road on its way into the
kernel.  Hans's <a href="/Articles/99302/">approach to PR</a> is unlikely
to help in this regard, though it should be noted that Linus <a
href="/Articles/99303/">likes</a> some of the reiser4 features.  
One hopes that reiser4  will get into the kernel eventually.  It would surely be a
mistake to believe that the optimal set of filesystem semantics has been
achieved.  The reiser4 project is arguably the place where the most
thinking is happening about where filesystems should go in the future.  If
Linux is unwilling to host the results of that work (after the obvious
problems are fixed), it may eventually find itself trying to catch up with
some other kernel which proves to be more accepting.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems-Reiser4">Filesystems/Reiser4</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#sys_reiser4">sys_reiser4()</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/99232/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor99319"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Looking at reiser4</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2004 3:52 UTC (Thu)
                               by <b>StevenCole</b> (guest, #3068)
                              [<a href="/Articles/99319/">Link</a>] 
      </p>
      
      </div>
      </summary>
      In the lkml thread "silent semantic changes with reiser4",
<br><tt>
Linus Torvalds wrote:</tt>
<br><pre>
So look at what Andrew said, again: his top choice would be (b). Let's see 
what that was again, shall we?

> b) accept the reiser4-only extensions with a view to turning them into
>    kernel-wide extensions at some time in the future, so all filesystems
>    will offer the extensions (as much as poss) or

In other words, if reiserfs does something special, we should make 
standard interfaces for doing that special thing, so that everybody can 
do it without stepping on other peoples toes.
<p></pre>
Andrew Morton's other options were 
<tt>a) accept as-is, </tt>and <tt>c) reject.</tt>
<p>
It looks good for reiser4 that Andrew and Linus seem to be favoring
option b).
      
          <div class="CommentReplyButton">
            <form action="/Articles/99319/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor99323"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">33 MB overhead with ext3</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2004 4:14 UTC (Thu)
                               by <b>jvotaw</b> (subscriber, #3678)
                              [<a href="/Articles/99323/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      I thought the ~33 MB used on a fresh ext3 filesystem was mostly because of the journal (default size of 32 MB on that size of filesystem), not pre-allocated inode tables.<br>
<p>
Apologies if I'm wrong, or too ignorant to see that these two are the same thing, or ...<br>
<p>
-Joel<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99323/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor99332"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">33 MB overhead with ext3</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2004 7:02 UTC (Thu)
                               by <b>dmantione</b> (guest, #4640)
                              [<a href="/Articles/99332/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      Does it matter? Reiserfs does use a journal as well. <br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99332/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor99389"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">33 MB overhead with ext3</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2004 12:28 UTC (Thu)
                               by <b>mtk77</b> (guest, #6040)
                              [<a href="/Articles/99389/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      As with inodes, so with journals.  reiserfs4 doesn't preallocate the journal either.  (*Disclaimer* this as I understand it.)<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99389/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor99421"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">33 MB overhead with ext3</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2004 14:31 UTC (Thu)
                               by <b>erich</b> (guest, #7127)
                              [<a href="/Articles/99421/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      I do not understand why preallocating the journal or inode tables is considered a bad thing.<br>
In the rare cases where one wants to store single big files on a hard disc, neither ext3 or reiserfs with default options is the best choice.<br>
<p>
If the journal is allocated when creating the filesystem it probably is placed at the beginning which usually is the faster area of the disc, isn't it? Also it is contiguous, which should increase performance, too.<br>
(why is using a swap partition better than using a swap file? similar reasons)<br>
<p>
But i'm not an expert at all. I just dislike things that are taken for better without giving reasons to do so.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99421/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor99608"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">swapfiles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2004 14:59 UTC (Fri)
                               by <b>Luyseyal</b> (guest, #15693)
                              [<a href="/Articles/99608/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Actually, I read awhile back that swap files are now just as fast as swap partitions due to some VFS magic.<br>
<p>
-l<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99608/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor99431"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">33 MB overhead with ext3</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2004 15:11 UTC (Thu)
                               by <b>meuh</b> (guest, #22042)
                              [<a href="/Articles/99431/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Reiserfs is not a journalised filesystem.<br>
It's an atomic one, so there's no need for a journal.<br>
<p>
Or I don't understand Hans posts :)<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99431/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor107751"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">33 MB overhead with ext3</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 22, 2004 15:43 UTC (Fri)
                               by <b>pont</b> (guest, #25575)
                              [<a href="/Articles/107751/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt;Reiserfs is not a journalised filesystem.</font><br>
<font class="QuotedText">&gt;It's an atomic one, so there's no need for a journal.</font><br>
&gt;<br>
<font class="QuotedText">&gt;Or I don't understand Hans posts :)</font><br>
<p>
An atomic filesystem means a transaction is completed or not completed, not half completed 3/4 completed, etc. etc, To make a filesystem atomic we use logs meta-data logging as in Reiser3 or wandering logs as in Reiser4.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/107751/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor99344"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Testing on old hardware is flawed</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2004 9:40 UTC (Thu)
                               by <b>hensema</b> (guest, #980)
                              [<a href="/Articles/99344/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      Please don't test filesystems on old hardware. Current hardware has totally different cpu-speed/disk-speed ratios, while both the speed of the cpu and disk have risen tremendiously.<br>
<p>
Reiserfs 4 has been written for modern hardware. It has no place on old hardware. And since there are no conversion tools available, there is no viable upgrade path anyway.<br>
<p>
It would be really interesting to benchmark again on a &gt; 2 Ghz machine with a disk which does &gt; 40 MB/sec, in at least 512 MB of ram. Such a machine would be at the low end where reiser4 installations will occur (not because reiser4 won't work on older hardware, but just because most installations will occur on new hardware).<br>
<p>
One of reiser4's problems on older machines is the high cpu usage. On modern hardware this problem will be less visible, since cpu power has outgrown disk speed by an order of magnutude.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99344/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor99370"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Testing on old hardware is flawed</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2004 11:35 UTC (Thu)
                               by <b>Fats</b> (guest, #14882)
                              [<a href="/Articles/99370/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      What you are actually saying is that reiserfs is more optimized for benchmarks then for real live. In real live you want to have the fastest disk access possible with the least CPU usage. For example on mail servers (with virus filters) you don't want the filesystem take away precious CPU time from the main task.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99370/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor99374"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Testing on old hardware is flawed</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2004 11:47 UTC (Thu)
                               by <b>hensema</b> (guest, #980)
                              [<a href="/Articles/99374/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      No, what I'm saying is that a disk is dog slow compared to a CPU. It pays to invest some extra CPU cycles to prevent unnescesary disk seeks. Packing data more tightly on disk helps too.<br>
<p>
On a slow CPU with a relatively fast disk this doesn't work. Here you can affort to do some extra seeks or waste some space on disk. Therefore, reiser4 is optimized for current and future systems and won't give optimal performance on older systems like the one used for the little lwn.net benchmark.<br>
<p>
Also, CPU usage is generally part of a good benchmark. It's even part of really bad ones, like untarring a kernel :-)<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99374/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor99467"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Testing on old hardware is flawed</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2004 17:12 UTC (Thu)
                               by <b>NAR</b> (subscriber, #1313)
                              [<a href="/Articles/99467/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      I'm not sure that the CPU speed/disk speed ratio differs that much between the lwn.net test machine and the test machine you asked for. From your reasing I'd think reiser4 should be <b>faster</b> on old machines because there the disk is <b>really</b> slow. However, I might be wrong.
<p>
<center>Bye,NAR</center>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99467/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor99509"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Testing on old hardware is flawed</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2004 21:22 UTC (Thu)
                               by <b>hensema</b> (guest, #980)
                              [<a href="/Articles/99509/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      No, on old machines the disk is actually relatively fast. In absolute figures the disk is slow, maybe 10 MB/sec or slightly less. But current processors are more than 10-20 times faster while disks are only 4-5 times faster. And that's measured by throughput. Seeks are barely any faster than 4 years ago (they are mostly limited by the rotational speed of the platters).<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99509/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor100704"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Testing on old hardware is flawed</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 3, 2004 10:19 UTC (Fri)
                               by <b>gc</b> (guest, #24112)
                              [<a href="/Articles/100704/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Recent CPUs have very high frequencies but the counterpart is that they need more clock cycles to perform the same instructions. If you compare a P4-3GHz with a P3-300MHz, the clock ticks needed to execute a typical series of instructions is 3 to 4 times larger, hence the CPU power is overally "only" 3 times higher. I think your figures concerning the increase of CPU power are wrong.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/100704/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor99373"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Testing on old hardware is flawed</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2004 11:47 UTC (Thu)
                               by <b>bpearlmutter</b> (subscriber, #14693)
                              [<a href="/Articles/99373/">Link</a>] 
      </p>
      
      </div>
      </summary>
      No, that is not what he is saying at all.
<p>
Sometimes there is a tradeoff between thinking about where and how to put stuff on disk (CPU) and actual disk access.  On a system like a mail server, you might expect the disk to be the bottleneck, with well below 100% CPU usage---at least, during periods when data is actually being moved on/off disk.  This is precisely where, as the CPU/disk speed disparity grows, it makes sense to spend more CPU to optimise (reduce) actual disk access.
<p>
I don't know if reiserfs4 succeeds in this, but if it does it would be of particular advantage on something like a mail/news server.  And, it would not be properly benchmarked if the CPU/disk speed disparity were unrealistically low.
<pre>
Barak A. Pearlmutter &lt;barak@cs.may.ie&gt;
 Hamilton Institute, NUI Maynooth, Co. Kildare, Ireland
 <a href="http://www-bcl.cs.may.ie/~barak/">http://www-bcl.cs.may.ie/~barak/</a>
</pre>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99373/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor99605"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Testing on old hardware is flawed</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2004 14:53 UTC (Fri)
                               by <b>jeremiah</b> (subscriber, #1221)
                              [<a href="/Articles/99605/">Link</a>] 
      </p>
      
      </div>
      </summary>
      On our DB server, we have lots of extra CPU cycles to burn and our Drives are constantly maxed out. I would gladly give up 25% - 50% of my CPU if it ment I got that much or more of an I/O imporovement from my filesystem.<br>
<p>
I think this is just one of those place where the server side of Linux differs from the Desktop side of linux. Or more clearly (I hope ) is that the  Mail server differs from the DB server side of things. RFS4 seems to be addressing high disk usage servers. <br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99605/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor99625"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Looking at reiser4</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2004 16:07 UTC (Fri)
                               by <b>pimlott</b> (guest, #1535)
                              [<a href="/Articles/99625/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>reiser4 allows an open with the O_DIRECTORY flag to succeed even if the target is not a directory. That defeats the use of O_DIRECTORY as a way of avoiding race conditions and security holes</blockquote>

<p>

That claim was not substantiated in the discussion (unless I missed it?) or by my brief google search.  It is not obvious to me, and I would have hoped for an explanation from LWN.  Anyone?
      
          <div class="CommentReplyButton">
            <form action="/Articles/99625/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor99748"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Looking at reiser4</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2004 2:29 UTC (Sat)
                               by <b>sbergman27</b> (guest, #10767)
                              [<a href="/Articles/99748/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      I've been following the "Reiser4 plugins" thread on the reiserfs mailing list and ran across a very interesting post by Nikita Danilov, namesys's "Senior Scientist" according to the "developers" page at namesys.  <br>
<p>
<a href="http://tinyurl.com/63uys">http://tinyurl.com/63uys</a><br>
<p>
It seems that Hans is being less than honest about reiser4's performance.  The phases of the mongo benchmark in which reiser4 performs poorly were simply excluded from the test, by order of Hans Reiser. (To see those results, go to namesys.com's front page and click on : "Reiser4 is the fastest filesystem and here are the benchmarks."<br>
<p>
I just ran a preliminary mongo test on my own, rather average hardware, using the parameters from the 1st mongo test listed, and sure enough, ext3 (no htree, date=order) beats reiser4 handily in all 3 phases that were skipped in the publicized benchmark. (Although Nikita only mentions  OVERWRITE and MODIFY, APPEND is also excluded.)<br>
<p>
In the APPEND phase, ext3 is 2.75 times faster than reiser4.  In fact, adding all the wall clock times together, ext3 handily beats reiser4 by 22% on THE WHOLE benchmark.  No wonder Hans wanted that information suppressed.<br>
<p>
Makes one wonder just how much Hans' assertions can be trusted.<br>
<p>
The kernel developers are wise to insist that reiser4's code go through "the usual process" before being included in the Linus vanilla kernel.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99748/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor99753"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Looking at reiser4</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2004 2:58 UTC (Sat)
                               by <b>sbergman27</b> (guest, #10767)
                              [<a href="/Articles/99753/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Of course, I meant "data=ordered".<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99753/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor99879"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Looking at reiser4</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2004 5:49 UTC (Mon)
                               by <b>hansreiser</b> (guest, #24323)
                              [<a href="/Articles/99879/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Nikita is no longer the senior scientist, he went to work for a competitor before making his remarks.<br>
<p>
You might want to look at the followups to Nikita's remarks.  There was more honest disagreement about the design and significance of those phases than he portrayed.  Those phases were not in the benchmark that I wrote originally, and I think a lot more work needed to be done for those phases to be properly done.  It is however true that they reflect an area where reiser4 allocation policies need more work, and why we need to finish the online repacker.  We should have invested more time into that aspect of the benchmark, optimized for it a bit (it is quite improvable), made it more meaningful, and put it on the website.  There are so many things we need to invest more time into....<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99879/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor99878"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Looking at reiser4</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2004 5:37 UTC (Mon)
                               by <b>hansreiser</b> (guest, #24323)
                              [<a href="/Articles/99878/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      this test seems to have been performed using a tarball that was not created on reiser4.  Filesystems with sorted directories are very sensitive to whether a tarball was created on them or some other filesystem, and it makes a big difference if the readdir order is the same for both packing and unpacking.  If the readdir order is different, it affects every test after that.  His use of 8-10 year old hardware is also different from what we designed for: reiser4 does like to use a big CPU.<br>
<p>
I suppose I should ask if he tested on the same partition for both filesystems, or gave ext3 the outside of the platter which is faster.<br>
<p>
He really should do what I always do when testing products, and that is allow the makers to comment before publishing results.  Everyone makes mistakes like these.<br>
<p>
I of course tried emailing lwn but got no response.<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/99878/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor99907"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Looking at reiser4</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2004 12:37 UTC (Mon)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/99907/">Link</a>] 
      </p>
      
      </div>
      </summary>
      1) The exact same partition was used for all tests - I know better than to make that sort of mistake.
<p>
2) You sent mail to me personally on the weekend.  Occasionally I have to actually take a bit of time with my kids, and I might just fail to respond to weekend mail on that same weekend.  You will get your response.
      
          <div class="CommentReplyButton">
            <form action="/Articles/99907/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor102344"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Looking at reiser4</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 16, 2004 3:34 UTC (Thu)
                               by <b>pm101</b> (guest, #3011)
                              [<a href="/Articles/102344/">Link</a>] 
      </p>
      
      </div>
      </summary>
      a) I think using a tarball created on a different filesystem is perfectly fair. If you use an installer, or a program other than tar, you're not guaranteed to have the files in your perfect presorted order in the archive. I would argue having files in a more-or-less random order is a much more fair test than having them in an order optimized for the FS. Either way, looking at the present, most of the tarballs I open were created by someone else, and not by me, and so will not come from ReiserFS. <br>
<p>
b) I'm not sure whether the use of 8-10 year old hardware is a problem, or even accurate. In 1996, the Pentium/150 was introduced. Dual P3-450 is a bit more modern, and a single P3-450 would probably be close to the mode computer used out there today in the real world (as opposed to the uberpumped computer most nerds would use). Either way, the 4GB hard drive is much, much, much more dated than the CPU: the P3-450 was introduced in 1998. 4GB drives were common in 1995. Having a drive over 50% older than the CPU probably more than compensates for any increasing gap between the speeds of the two. Either way, whether we want the disk or the CPU hosed depends on application. <br>
<p>
c) I think it would be a better idea, in the future, to allow reviewees comment on reviews prior to publishing. Constructive suggestion. Wish it was phrased more constructively. I don't understand why you're so antagonistic with everyone -- it's really not helping your business. <br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/102344/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor100576"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Looking at reiser4</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 2, 2004 16:11 UTC (Thu)
                               by <b>leandro</b> (guest, #1460)
                              [<a href="/Articles/100576/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Anyone besides me thinking that if we want richer filesystems we should go for a fully relational database as a data storage engine in the kernel, something like a lower-level Gnome Storage but D compliant?  Perhaps wed need a microkernel, but so what.
      
          <div class="CommentReplyButton">
            <form action="/Articles/100576/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor102694"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Looking at reiser4</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 18, 2004 22:43 UTC (Sat)
                               by <b>walters</b> (subscriber, #7396)
                              [<a href="/Articles/102694/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Why does it need to be in the kernel?  And what in the world is "D compliant"?<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/102694/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor128408"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Looking at reiser4</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 20, 2005 19:27 UTC (Sun)
                               by <b>leandro</b> (guest, #1460)
                              [<a href="/Articles/128408/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>> <i>Why does it need to be in the kernel?</i></blockquote>

<p>It depends on what's one trying to accomplish.  My own view is that we should use something like the Hurd, a multi-server microkernel, and then we could have only basic relational technology in the kernel so that we could have a consistent, relational view of data everywhere; and then features for database applications and the like could be userland.  But for now we're stuck with monolithic kernels.</p>

<blockquote>> <i>what in the world is "D compliant"</i></blockquote>

<p>Like in Date and Darwen's Tutorial D, D being the definition of a relational data access language.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/128408/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2004, Eklektix, Inc.<BR>
            
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
