        <!DOCTYPE html>
        <html lang="en">
        <head><title>Ext4 data corruption hits the stable kernels [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/954770/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/955133/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/954770/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Ext4 data corruption hits the stable kernels</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Please consider subscribing to LWN</b>
<p>
Subscriptions are the lifeblood of LWN.net.  If you appreciate this
content and would like to see more of it, your subscription will
help to ensure that LWN continues to thrive.  Please visit
<a href="/Promo/nst-nag1/subscribe">this page</a> to join up and keep LWN on
the net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>December 14, 2023</br>
           </div>
The kernel's stable-update process is intended to produce kernels that are,
well, stable; when that promise is lived up to, users can update to newer
stable updates without fear.  By any account, a bug that corrupts data on
ext4 filesystems constitutes a failure to hold to that promise.  As is so
often the case, this problem is the result of a chain of failures in a
system that works well most of the time.
<p>
For many people, the first notice of this problem came in the form of <a
href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1057843">this
Debian bug report</a> stating that the 6.1.64 kernel, which had been rolled
into the planned Debian 12.3 release, was exhibiting data-corruption
problems.  Debian developers quickly <a href="/Articles/954284/">put that
release on hold</a> while investigating the problem, which was good as far
as it went, but
many Debian users update their systems often rather than waiting for the
point releases.  They may have gotten buggy
kernels as a result.  The bug is likely to have hit users of other
fast-moving distributions and those who install their own kernels as well. 

<p>
As it happens, this bug had been found during the two-day comment period
for the 6.1.64 kernel release (among others); Daniel Diaz <a
href="/ml/linux-kernel/81a11ebe-ea47-4e21-b5eb-536b1a723168@linaro.org/">reported</a>
the problem, which affected the planned 5.10.202 and 5.15.140 releases as
well, in the 5.15.140 discussion thread on November&nbsp;24.  Diaz had
bisected the problem and reported the problematic commit, which was quickly
removed from the 5.10.202 and 5.15.140 patch sets prior to the release of
those kernels; for unknown reasons, almost certainly a simple mistake, the
problematic patch remained in the 6.1.64 set, and was released with that
kernel.
<p>
The patch in question was written by Jan Kara, who did not manage to track
down the specific problem until December&nbsp;5, by which time 6.1.65, also
buggy, had also been released.  One might say that this
shows a lack of urgency but, in Kara's defense, the patch clearly worked in
the mainline and had been (most people thought) removed from the stable
updates.  Once he figured it out, he quickly <a
href="/ml/linux-kernel/20231205122122.dfhhoaswsfscuhc3@quack3/">raised the
alarm</a>:
<p>
<blockquote class="bq">
	So all stable kernels that have 91562895f803 ("ext4: properly sync
	file size update after O_SYNC direct IO") before 6.5 are corrupting
	data - I've noticed at least 6.1 is still carrying the problematic
	commit. Greg, please take out the commit from all stable kernels
	before 6.5 as soon as possible, we'll figure out proper backport
	once user data are not being corrupted anymore.
</blockquote>
<p>
The <a href="https://git.kernel.org/linus/91562895f803">patch in
question</a> is a fix for a different ext4 bug, where a direct I/O
operation could, after a badly timed crash, result in an incorrect file
size.  Kara's fix for the problem was applied to 6.7-rc1, and is by all
appearances correct; there have been no reports of corruption problems on
current mainline kernels.
<p>
Unfortunately, that patch depended on <a
href="https://git.kernel.org/linus/936e114a245b6">a different patch</a>
from Christoph Hellwig that first appeared in 6.5-rc1.  That patch made a
subtle change in how the file position in an open file was updated after a
direct I/O operation, causing that update to happen a bit later than
before.  That patch, too, is correct.  But Kara's patch, in the absence of
Hellwig's earlier patch, was not.  The file position of a file under direct
I/O was not updated properly, causing subsequent writes to end up in the
wrong place and corrupting the file.
<p>
It is worth noting that, as <a href="/Articles/954841/">Kara later
clarified</a>, a specific sequence of operations is required to hit this
particular bug.  It may well be that no real-world application, other than
the test suite that revealed it, was affected.
<p>
Once the problem was identified, Greg Kroah-Hartman <a
href="/ml/linux-kernel/2023120643-evade-legal-ee74@gregkh/">responded</a>
that a fixed update would be produced.  Interestingly, Kroah-Hartman did
not remove the problematic patch as Kara had requested; instead, he
backported Hellwig's prerequisite patch to 6.1.x as well.  Arguably this
was a riskier approach, but it did have the advantage of preserving the
ext4 fix that was the objective of Kara's patch.  The newly backported
patch appeared in the <a
href="/ml/linux-kernel/2023120858-implant-detonate-edbc@gregkh/">6.1.66
stable update</a> that appeared, with no special fanfare, on
December&nbsp;8 — 15&nbsp;days after the buggy 6.1.64 update.
<p>
There are clearly (at least) two things that went wrong here.  One of those
was the decision to backport Kara's patch without addressing its dependency
on Hellwig's 6.5 change.  That kind of dependency can be difficult to
notice in kernel code, though.  There were no API changes that would have
allowed a compiler to raise an error.  Perhaps if a language like Rust were
in use, and if the iomap abstractions were written tightly enough that this
sort of semantic change was reflected in the API, the problem would not
have escaped notice.  But even Rust is unable to guarantee a lack of logic
errors.
<p>
The other mistake, of course, was releasing 6.1.64 with the bug in it.
This error has led to a new round of complaints from some about the kernel
community's lack of testing infrastructure.  While there is no doubt that
kernel testing could stand significant improvement, it must be pointed out
that this bug was, in fact, caught and identified by testing, and reported
on the list, before the release was made.  The problem was that, while the
buggy backport was removed from 5.10.202 and 5.15.140, it was not taken out
of 6.1.64.
<p>
One can certainly try to figure out how that went wrong in the hopes of
preventing a similar episode in the future.  It's hard to look past the
fact that Kroah-Hartman received a report that 6.1.64 had a problem, but
failed to act on it.  That said, the report was made in response to the
5.15.140-rc1 posting; had there been a separate report made in response to
6.1.64-rc1 as well, it might have been more difficult to overlook.  The
kernel community's lack of a proper issue-tracking system certainly will
not have helped here.  In the end, though, the truth of the matter is that,
even in 2023, stable kernel updates are made by humans, and humans
occasionally make mistakes.
<p>
Even one file-corruption bug is too many, of course, and this is not the
first bug of this type that has hit the stable updates.  That has
predictably led to calls for the stable update process to be far more
selective in the patches that are backported.  The problem with that idea,
of course, is that it is expensive to implement (and volunteers to do the
work are scarce), and it tends to be reactive, only backporting fixes after
somebody has been bitten by a bug.
<p>
The small team of developers working on the stable updates has decided,
instead, to backport as many fixes as possible.  The claim, seemingly
backed up by studies done by the Android team, is that this approach gets
fixes to users before the problems they fix (such as security
vulnerabilities) make themselves known.  Arguably, the end result is kernels
with fewer problems overall, even though the backporting process may
occasionally introduce one, as happened here.  But it does lead to more
churn in the stable updates than many users would like.
<p>
Ways to improve the situation are clear; they mostly involve more testing
of stable releases and more eyes on the patches that land there.  That
requires the contribution of resources — machines, software, and people —
to the effort.  In the end, the best way to get better stable kernel
updates is to help make them better.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_model-Stable_tree">Development model/Stable tree</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems-ext4">Filesystems/ext4</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/954770/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor955197"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2023 17:06 UTC (Thu)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/955197/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The process issue I see is that Daniel Diaz did not have the authority to block the release of 6.1.64 until the test failure was addressed. If Daniel has been able to flag 6.1.64 as unreleasable in a way that had required Greg to do some action (even if only removing the flag) the problem would have been adverted.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955197/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955202"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2023 17:19 UTC (Thu)
                               by <b>koverstreet</b> (subscriber, #4296)
                              [<a href="/Articles/955202/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
More broadly, the process at every step of the way seems to be biased in favor of getting every possible fix backported as quickly as possible, with few opportunities to slow things down so work can be double checked.<br>
<p>
Perhaps this does in fact make sense for driver code, where many bugs are security issues and the impact of a buggy patch tends to be at most a kernel panic. But for filesystems, where the fraction of bugs that are security bugs is lower, and where we can _corrupt data_ if we screw up - I'm not so sure we've struck the right balance.<br>
<p>
I'll be asking for some changes to the stable kernel process for bcachefs in the near future, I think. We certainly at least need to make sure the same testing and QA process is in place for stable kernels as we have for mainline.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955202/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955357"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 16:23 UTC (Fri)
                               by <b>mcgrof</b> (subscriber, #25917)
                              [<a href="/Articles/955357/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is the way.<br>
<p>
It took a while to develop but we have the automation infrastructure in place for this for any filesystem with kdevops. I realize you also have your own automation too with ktest for bcachefs, and Ted has xfstests-bld but at the time I started kdevops it was not cloud agnostic and ext4 focused. So automation software for filesystem testing is now readily available.<br>
<p>
What we don't have, as we mentioned at the last LSFMM is volunteers doing the testing for for filesystems other than XFS and it was clear at LSFMM that this is welcomed. So let us use this as a calling for new volunteers to help test, LSFMM is perhaps not the most ideal place to look for volunteers as people are already busy with their own thing. For XFS we have now fortunately changed things for the better. Long ago we ran into a similar issue with XFS and so we asked stable folks to not apply patches automatically and we'd deal with them ourselves precisely because of this. These auto patches don't apply for XFS, but it left a gap on stable patches for a while, but now thanks to the remarkable work by Leah Rumancik and Chandan Babu and Amir Goldstein we have this now covered, for details refer to Amir's talk at LSFMM about the increase stable patches after they hopped on board.<br>
<p>
I have asked companies for resources in terms of server resources and Samsung has provided and helped here with bare metal. Oracle stepped up with OCI instances too. No other cloud provider has come to step up to help. If you are a cloud provider and would like to help with this please let us know.<br>
<p>
If you are a new developer interested in learning filesystem development and want to help with this with testing and backporting patches please let us know.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955357/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955382"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 18:30 UTC (Fri)
                               by <b>koverstreet</b> (subscriber, #4296)
                              [<a href="/Articles/955382/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I've been asking/begging for more machines for ktestci for _years_ too; it's running on two 80 core Arm machines in Finland leased from Hetzner, and could be scaled up to 10 or 20 in an hour or so if someone would fork out for machines - and then we could give all the fs developers access.<br>
<p>
The CI and dashboard is _done_, but everyone is penny wise and pound foolish.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955382/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955409"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 22:20 UTC (Fri)
                               by <b>himi</b> (subscriber, #340)
                              [<a href="/Articles/955409/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How many, and what kind of machines would be useful for this, and what kind of additional resources would it need (storage, network, etc)?<br>
<p>
My organisation runs an in-house semi-private cloud, I could talk to my managers about donating some resources for this. It's all x86, currently fairly old hardware (sandybridge and broadwell, mostly), but there's a fair number of them, and upgrades are planned.<br>
<p>
I recognise it might be more useful for you to have cash that can be used to scale your current deployment, of course, but hardware is easier for me to offer than cash (or rather, my employers cash already invested in this hardware ;-)<br>
<p>
If your use case wouldn't benefit from this, are there other kernel testing projects that might benefit?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955409/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor955204"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2023 17:32 UTC (Thu)
                               by <b>mrchapp</b> (guest, #128908)
                              [<a href="/Articles/955204/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      Just a quick note that Naresh <a href="https://lore.kernel.org/stable/CA+G9fYsk_5WxkeQHqh_5McrkOBGW+4yF81=TdrNyPQOSZxz7Rg@mail.gmail.com/">did reply to the 6.1 RC</a> stating that the failure was there.


      
          <div class="CommentReplyButton">
            <form action="/Articles/955204/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955207"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2023 17:37 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/955207/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Ah yes, I'd missed that somehow; that should have made the problem harder to overlook.


      
          <div class="CommentReplyButton">
            <form action="/Articles/955207/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955239"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2023 22:26 UTC (Thu)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/955239/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That is why I do not believe the problem to be a lack of resource. The process should ensure that the feedback from the QA people cannot be ignored inadvertently. Think about the purpose of the  'QA passed' stickers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955239/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor955284"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 12:05 UTC (Fri)
                               by <b>jezuch</b> (subscriber, #52988)
                              [<a href="/Articles/955284/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
On the other hand, we now have two data points suggesting that this message was easy to miss<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955284/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor955282"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 11:29 UTC (Fri)
                               by <b>aabc</b> (subscriber, #55202)
                              [<a href="/Articles/955282/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So the review process is only for the show and not really working.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955282/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor957261"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 9, 2024 18:09 UTC (Tue)
                               by <b>florianfainelli</b> (subscriber, #61952)
                              [<a href="/Articles/957261/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There are plenty of examples where people have reported build failures, or other functional issues and the offending patches were eventually dropped. Though once in a while there are also examples of problems being reported and the offending patches still making it through. I would guesstimate that 99% of the time the patches are dropped as requested and about 1% of the time they still go through without eliciting a response.<br>
<p>
Usually when the auto selection happens and emails are sent out there is a way for the authors and everyone in the development chain of said patch to chime in and say yay or nay. Then there is the stable candidate where the list of patches is there and for every one to see and comment. And then there is the actual testing from the various folks helping with stable testing.<br>
<p>
The fact is that very few people tend do review the list of patches being proposed, most likely because they already are drowned in an ocean of patches to review or respond to. Even if they do review, their area of expertise is fundamentally limited and the scope of stable is huge, so being able to get expert review on all of those patches is virtually impossible. Delegating to the authors/reviewers/subsystem maintainers would work, but adds to their existing work load.<br>
<p>
If we did have a sort of tool like Gerrit, that would require *each* stable patch to be voted positively by the author/reviewer(s)/subsystem maintainer(s) and we would increase the confidence level in the patches being adequate, but we would lose on the pace at which stable kernels come up.<br>
<p>
Very few organizations do monetize stable kernels and their testing, because the kernel is just a commodity, like many things these days, it just has to work, and work with a cost of ownership approaching zero.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/957261/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor955268"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 8:42 UTC (Fri)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/955268/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wonder if some more specialized software that handled flagging of releases as problematic or bugs as blockers rather than email based workflows would prevent the accidental release of known bad versions.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955268/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955273"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 9:39 UTC (Fri)
                               by <b>ebee_matteo</b> (subscriber, #165284)
                              [<a href="/Articles/955273/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, it works for hundred of thousands of other projects :-)<br>
<p>
I understand that kernel development is somewhat special, but sometimes I get the feeling a lot of kernel hackers *want* to think they are special.<br>
<p>
Spoiler alert: they are not.<br>
<p>
And sometimes you need to accept that you might have to adapt your workflow to the tool rather than the tool to your workflow.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955273/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor955361"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 16:17 UTC (Fri)
                               by <b>atnot</b> (subscriber, #124910)
                              [<a href="/Articles/955361/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is the thing that I kind of personally find most frustrating about kernel development. It's not that the forges are the end-all of software development, or that there aren't legitimate reasons to like the properites of email. It's that there seems to be no consensus on the need to then actually build something better, to adopt the tooling that is created, or that there is even a problem at all.<br>
<p>
It's hard to believe sometimes that this is the same community that git grew out of. It feels like today the response would have been "all of these version control systems aren't really working for us. Let's just not do version control. I have my own perl script for it anyway".<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955361/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955374"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 16:51 UTC (Fri)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/955374/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Git didn't grow out of this community. Linus said "Let there be git" and there was ...<br>
<p>
Now that Linus has recognised email doesn't seem to be working, there may be another revelation ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955374/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955375"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Git</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 16:58 UTC (Fri)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/955375/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      That doesn't really match my view of reality at all.  Git grew out of years of kernel development experience and a lot of lessons learned (and ideas taken from) BitKeeper.  Its evolution from the beginning was driven by how the community used it.  It is definitely a product of the community.


      
          <div class="CommentReplyButton">
            <form action="/Articles/955375/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955377"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Git</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 17:38 UTC (Fri)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/955377/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes ... but (who wrote BitKeeper?) BK was "sold" to Linus. Then when it went pear-shaped, Linus wrote git in a week or so.<br>
<p>
I agree the community was heavily involved in the *evolution* of BK / Git, but both BK and Git were the creation of one person (for each).<br>
<p>
Prediction is difficult, especially about the future, but let me predict that Linus will come up with some great idea (isn't that what he does very well? :-), quite possibly implement the basics in an afternoon (I exaggerate a LITTLE), and the community will jump on board and evolve it.<br>
<p>
Like pretty much all successful projects, it will need only one or two people to drive it to start with - more will probably kill it.<br>
<p>
Cheers,<br>
Wol <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955377/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955412"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Git</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 22:47 UTC (Fri)
                               by <b>himi</b> (subscriber, #340)
                              [<a href="/Articles/955412/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
From my memory of the time (and some brief research to confirm a few things), BitKeeper grew out of ideas that Larry McVoy had while working at Sun on TeamWare (so much CamelCase . . .) - it didn't just appear out of nowhere. And while it was McVoy's baby I don't think it was the product of one person, and it definitely didn't spring fully-formed from McVoy's brow - it was under development by his team for a while before it was even raised as a possibility for kernel use.<br>
<p>
The basics of git kind of did spring fully-formed from Linus's brow, but only kind of, and only because those basics really are quite basic - content addressable storage and a basic "filesystem" on top of that. The fact that it was vaguely usable soon after is more a statement about the people who were using it than about the tool itself. And the long history of git being a usability nightmare shows that even really strong basic foundations don't necessarily solve the really hard problems.<br>
<p>
The organisational challenges the kernel development team are going through aren't the kind of thing that a quick hack can do much for, even a quick hack implementing a brilliant idea. It's only partly a technical problem - the bulk of the challenge is social, and I'm sure we're all aware of the issues that arise when you try to use technology to solve social challenges.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955412/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955505"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Git</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2023 8:27 UTC (Mon)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/955505/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Interesting but the "myth of the lone inventor" makes much better stories. Movies even!<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955505/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor955519"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Git</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2023 14:22 UTC (Mon)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/955519/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not even sure lmc worked on Teamware. I think he worked on some other SCCS tooling within Sun, predating TeamWare. Wikipedia suggests SCCS merge tool. TeamWare was a DVCS which was based around tracking and merging different instances of SCCS based SCS. TeamWare basically added its meta-data on top, with per-file changes managed by SCCS - driven by TeamWare. <br>
<p>
I'd say BitKeeper - and hence git - took a lot of inspiration from TeamWare, the work flow is basically there  ("bringover"/pull a remote repo, work on it, "bringover" again and merge updates, and push back when ready). I wouldn't say lmc created the ideas of TeamWare though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955519/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor955269"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 9:12 UTC (Fri)
                               by <b>amacater</b> (subscriber, #790)
                              [<a href="/Articles/955269/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Debian package is currently in stable-proposed-updates and should be pushed out in the run to stable later in the day at 1352 UTC as Version              : 6.1.67-1<br>
<p>
Anyone in a tearing hurry can get it from your nearest mirror by editing your /etc/apt/sources.list accordingly or wait a couple of hours.<br>
<p>
This is an update of the single kernel image package - it's NOT a full point release so no new media - but if you<br>
install with previous media then the new package will be installed as part of the normal installation process.<br>
<p>
Thanks to all involved (again) and also for the coverage here by Jon which is invaluable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955269/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955285"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 12:26 UTC (Fri)
                               by <b>MarcB</b> (subscriber, #101804)
                              [<a href="/Articles/955285/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Note that 6.1.66-1 already has the fix.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955285/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955383"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 18:33 UTC (Fri)
                               by <b>smcv</b> (subscriber, #53363)
                              [<a href="/Articles/955383/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, 6.1.66 has the fix for the ext4 data corruption. Unfortunately, it also introduces a regression for users of (some? all?) wifi hardware, and that additional regression is what is fixed in 6.1.67.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955383/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor955278"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 10:56 UTC (Fri)
                               by <b>rankincj</b> (guest, #4865)
                              [<a href="/Articles/955278/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So which currently supported mainline kernels are still affected by this?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955278/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955281"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 11:27 UTC (Fri)
                               by <b>danielthompson</b> (subscriber, #97243)
                              [<a href="/Articles/955281/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't think any mainline kernel was affected. It was only present in the two 6.1 LTS versions mentioned above.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955281/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955286"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 12:51 UTC (Fri)
                               by <b>rankincj</b> (guest, #4865)
                              [<a href="/Articles/955286/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The quote is:<br>
<span class="QuotedText">&gt; So all stable kernels that have 91562895f803 ("ext4: properly sync file size update after O_SYNC direct IO") before 6.5 are corrupting data</span><br>
<p>
Could this mean that 6.4.16 is also affected?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955286/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955363"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 16:04 UTC (Fri)
                               by <b>danielthompson</b> (subscriber, #97243)
                              [<a href="/Articles/955363/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
v6.4.16 is not a currently supported kernel... but, for what it's worth, v6.4.16 should not contain 91562895f803 ("ext4: properly sync file size update after O_SYNC direct IO") because it was released a month before the patch was posted to LKML.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955363/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955451"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 17, 2023 0:25 UTC (Sun)
                               by <b>rankincj</b> (guest, #4865)
                              [<a href="/Articles/955451/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
OK, thanks. My old machine currently running 6.4.16 is therefore unaffected by this as I try to upgrade it. (And where 6.5.13 locks up shortly after booting, even after applying the "randomize layout" patch to include/net/neighbour.h.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955451/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor955289"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 13:48 UTC (Fri)
                               by <b>rrolls</b> (subscriber, #151126)
                              [<a href="/Articles/955289/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The first I'd heard of this was when I did a routine `apt update` and saw the message that the release value had changed from 12.2 to 12.4. That immediately raised suspicions, so I went straight to debian.org to see what was up.<br>
<p>
This kind of thing is exactly why my informal policy is to turn off all automatic updates, manually check for updates now and then and only install them once there's been no changes for a week or so. An update is often* followed quickly by another one to address something the first update has broken, so once there's been some quiet, it's far less likely that something disastrous has happened.<br>
<p>
(*Not so much in Debian itself, as they do a fantastic job of preventing problems even getting out at all. The statement is more true of various other software vendors, but I apply the same approach to everything I can.)<br>
<p>
My other informal policy is to update my systems at separate times. My desktop first, since that's where a problem is most likely to be noticed and least likely to cause severe trouble; my secondary (backup) home server a while later, then my primary home server a while after that. Those two servers are kept almost identical to each other, so the "nuclear option" of totally wiping the drives of one of them and copying everything across from the other is always available.<br>
<p>
Now in terms of distros, I notice this article only mentions Debian. I assume it was a case of bad timing, then, that the broken kernel version came out right as Debian were about to release 12.3. Out of curiosity, did this bug end up in any other distro?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955289/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955420"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2023 4:29 UTC (Sat)
                               by <b>ahippo</b> (subscriber, #154692)
                              [<a href="/Articles/955420/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Out of curiosity, did this bug end up in any other distro?</span><br>
<p>
I know at least Gentoo was affected to some extent.<br>
Luckily, 6.1.64 and 6.1.65 were never marked "stable" in Gentoo sense,<br>
so only people using ~testing could have got these.<br>
<p>
A related bug report [1] for reference.<br>
<p>
[1] <a href="https://bugs.gentoo.org/919675">https://bugs.gentoo.org/919675</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955420/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955589"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2023 15:57 UTC (Mon)
                               by <b>csigler</b> (subscriber, #1224)
                              [<a href="/Articles/955589/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As I mentioned in another article's comments, I have linux-lts installed on my boxes, all of which run Arch. I keep it around in case the current doesn't boot, which never happens anymore :)<br>
<p>
6.1.64 and .65 upgpkg's were released on Nov 28th and Dec 3rd, respectively. So anyone using Arch running LTS as their everyday kernel would have been bitten.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955589/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955592"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2023 16:03 UTC (Mon)
                               by <b>csigler</b> (subscriber, #1224)
                              [<a href="/Articles/955592/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sorry, *IF* they ran pacman to upgrade their LTS kernel during the period between  Nov 28th and Dec 8th when upgpkg to 6.1.66 was released, then rebooted into the new kernel. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955592/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor955338"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 14:31 UTC (Fri)
                               by <b>yannsionneau</b> (subscriber, #85943)
                              [<a href="/Articles/955338/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Making mistakes like cherry-picking a commit and forgetting a dependency is hard to avoid.<br>
Mistakes happen.<br>
The first questions that raises, to me, are:<br>
1/ what tests are run on the kernel by Greg/Linus *before* releasing a version?<br>
2/ what tests are run by Debian *before* releasing a new kernel package version?<br>
<p>
It seems that in this case just running the LTP testsuite would have directly spotted the issue.<br>
A very basic syscall test (preadv03) instantaneously finds the issue.<br>
<p>
I know it's easy to rewrite the history when you already have the answer. But I wonder if maybe the testsuite run before releasing could be improved. Because there are at least some testsuite run, ... right?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955338/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955422"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2023 5:24 UTC (Sat)
                               by <b>wtarreau</b> (subscriber, #51152)
                              [<a href="/Articles/955422/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; I know it's easy to rewrite the history when you already have the answer. </span><br>
<p>
I totally agree with you, that's a bit what I discussed in the other thread on the same issue elsewhere on lwn.<br>
<p>
Regarding the tests, apparently there were around 910 kernels built and booted on various archs by 17 people. That's a lot by any CI metric. And the CI worked, since the problem was spotted before the release, so no extra tests are necessary to avoid this in the future.<br>
<p>
The problem was clearly just a misunderstanding: <a href="https://lore.kernel.org/stable/2023112502-supernova-copier-7615@gregkh/">https://lore.kernel.org/stable/2023112502-supernova-copie...</a><br>
<p>
It was reported that 5.10, 5.15 and 6.1 were broken, and Greg overlooked 6.1 there and responded "OK I'll drop it 5.10 and 5.15", maybe because the bisect was started on 5.15, making it possible to understand that only 5.15 and lower were affected. Sh*t happens, that's all, we're still using humans in this chain and the day there are no more, we won't necessarily have more reliable alternatives.<br>
<p>
Is the process broken ? Not necessarily, particularly if we count the number of successfully backported fixes between two such issues happen. I'd rather say that it's hard to make it work better. Here in this chain this was a collective failure, because nobody stepped up in the thread to say "Hey Greg, be careful, it must also be dropped from 6.1", starting from the reporter, and anyone in this thread. So yes, it's easy to point the finger and to rewrite history, but the issue was publicly visible BEFORE the release and nobody spotted it. Let's not hold a single person responsible for this, and no need to try to invent new complex processes that expect to make this harder to happen and that will at the same time prevent releases from being issued in a timely manner at all.<br>
<p>
It's clear that all those complaining are often also the ones who wouldn't do 10% of that thankless job themselves and would complain to all those passing them the patches in the first place.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955422/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor957263"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 9, 2024 18:15 UTC (Tue)
                               by <b>florianfainelli</b> (subscriber, #61952)
                              [<a href="/Articles/957263/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; It's clear that all those complaining are often also the ones who wouldn't do 10% of that thankless job themselves and would complain to all those passing them the patches in the first place.</span><br>
<p>
Completely agree with that. I think this does point to an actual issue that has been pointed out by Greg himself for many years: he needs help with stable kernels. Maybe not the kind of help that most people think about which is having more testing (that is always welcome of course), but helping with the actual maintenance and process of collecting tester feedback, looking for what passes/fails and make a decision on that.<br>
<p>
Given how long Greg has done that, this should be a rotating job, one week is Greg, the next is Sasha, the next is someone else etc.<br>
<p>
It does not look like email is the best way to go about giving feedback here, if we had a tool with the ability to vote for stable patches globally (all passed for me) as well as individually, we could easily get a consistent view of the quality of the stable candidate. All it takes to *not* get a release candidate out of the door and start a conversation is the downvoting of a single patch. This happens over email today, might be time to change it.<br>
<p>
No, I am not volunteering to write that tool :D<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/957263/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor955373"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2023 17:18 UTC (Fri)
                               by <b>honschu</b> (subscriber, #61008)
                              [<a href="/Articles/955373/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One could establish a new rule: Final releases (both mainline and stable) need to pass tests!<br>
<p>
Test farms are already in place for rc kernels, as well as for stable releases. Linaro, for instance, has a great setup. However, release maintainers need a robust way to be notified.<br>
<p>
So why not turn this need into a necessity?<br>
<p>
Consider the Linux Foundation. They have all the major tech companies under their umbrella; it should be easy for them to harness massive computing power to conduct parallel testing in a very short time. Imagine a full test completed in less than 10 minutes, enabling a release maintainer to easily trigger that test process for upcoming releases and ultimately receive a clear result: 'passed' or 'missed'.<br>
<p>
Any objections?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955373/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955442"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ext4 data corruption hits the stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2023 19:55 UTC (Sat)
                               by <b>wtarreau</b> (subscriber, #51152)
                              [<a href="/Articles/955442/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Did you read the thread ? That's exactly what happened, tests were run and spotted the problem, the patches were dropped, except that due a misunderstanding one was left in 6.1.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955442/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor955415"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Oh please</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2023 1:14 UTC (Sat)
                               by <b>Subsentient</b> (guest, #142918)
                              [<a href="/Articles/955415/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Don't act like this is a rare event. I've used Linux since I was 13 years old. I've watched the kernel first slowly and then rapidly decline in reliability.<br>
<p>
I'm so tired of broken point releases. I have several machines, none of them that unique or interesting, most are just Intel or AMD desktops.<br>
<p>
It seems like stable kernel updates break core functionality on one if not multiple of them more and more frequently.<br>
<p>
What's almost worse, new drivers for new hardware have been getting less and less reliable as well, even for years-old hardware.<br>
<p>
I don't know what's going on in Linus-land. But I know I've seen more and more regressions, bugs, poor quality drivers, and unbootable kernels than I have at any point up until now.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955415/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955427"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Oh please</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2023 10:09 UTC (Sat)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/955427/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;I've watched the kernel first slowly and then rapidly decline in reliability.</span><br>
<p>
I'm sorry, in my reality the exact opposite is happening.<br>
<p>
Kernel crashes and other kernel bugs that affect me almost don't happen in my work enviromnent. The last problem I can think of is a crash in a crappy wifi driver almost two years ago.<br>
Yeah and then you could maybe count this ext4 problem here, although I was not really affected because it was fixed quickly.<br>
<p>
That has been much different over 20 years ago.<br>
The kernel now includes a huge test set and a huge amount of debugging functionality (e.g. lockdep). This has almost all been added in the last 20 years. And it has improved the quality of the kernel by a significant amount.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955427/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955443"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Oh please</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2023 20:02 UTC (Sat)
                               by <b>wtarreau</b> (subscriber, #51152)
                              [<a href="/Articles/955443/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; &gt;I've watched the kernel first slowly and then rapidly decline in reliability.</span><br>
<p>
<span class="QuotedText">&gt; I'm sorry, in my reality the exact opposite is happening.</span><br>
<p>
I totally agree with you. 20 years ago it was very common to see a machine freeze or crash randomly, and we would experiment with lots of out-of-tree patches to try to work around the supposed issue.<br>
<p>
Nowadays you can easily deploy a .1 or .2, lazily avoid to upgrade it for years and see it continue to run. The kernel has become extremely stable nowadays, and since somewhere around kernel 3.x-4.x, most likely where many testers started to report their successes or failures, it's not rare to find a machine with more than 1000 days uptime. When you find that on a completely idle system, you can say "OK it's not doing anything", but I've seen this on exposed servers (not reasonable but still), and file servers (even more common).<br>
<p>
And I'd say that the single fact that there are 2 LWN articles about the same failed patch is a great indication about the extreme rarity of such a problem nowadays!<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955443/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor955454"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The more reliable a service is, the more alarm when it is unavailable</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 17, 2023 1:39 UTC (Sun)
                               by <b>mcassaniti</b> (subscriber, #83878)
                              [<a href="/Articles/955454/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For a lot of us our utility providers (water, gas, electricity) provide a service that barely ever is off-line, even for scheduled maintenance. When one of these services is unavailable due to an emergency outage the panic about when it will be back and how long it takes is noteworthy.<br>
<p>
What does this have to do with stable kernels? The better we get as a community at providing stable anything without regressions/errors/bugs the more alarm when it goes wrong. It doesn't matter about the %99.99... of the time the team gets these things right, all that gets noticed is what is left. The more 9's the more the alarm.<br>
<p>
I can't thank the community enough across all projects for the thankless amount of work they put into making our software ecosystem great. I have a very stable and reliable desktop experience thanks to all of you. You're human and you'll get it wrong sometimes but you'll fix it and move on. Which one matters more?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955454/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955460"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The more reliable a service is, the more alarm when it is unavailable</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 17, 2023 12:38 UTC (Sun)
                               by <b>wtarreau</b> (subscriber, #51152)
                              [<a href="/Articles/955460/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That's a very wise view, thanks for your positivism!<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955460/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor955508"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The more reliable a service is, the more alarm when it is unavailable</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2023 11:19 UTC (Mon)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/955508/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <p>On top of that, the better any project is at avoiding bugs, the less prepared people are for the effects of a bug. If data corruption due to kernel bugs is a monthly thing, you have better backups, more practice checking whether you need to restore from backup, and so on; if data corruption due to kernel bugs is a "doesn't happen" thing, you get lazy about backups, you don't have experience checking backups against primary copy and so on.
<p>Plus if you have a common class of bug that recurs, people learn to not tickle that class of bug; I've seen, for example, users who always shut down their system via the menus, and then power it up again, instead of using "reboot" options, because they got trained that "reboot" didn't reliably work on the systems they used, whereas power down was visibly working. They would never find a "reboot" bug, because they never rebooted per-se; they always shut down, and then pressed the button to power it back up.
<p>So, one reason the stable kernels appear less stable is simply that the kernel devs have become good at not having similar bugs over and over again - which means you never get trained to avoid that class of bug, and you aren't prepared for it when it happens, because it's a "once-in-a-lifetime" event, and not a "must be Tuesday" event.



      
          <div class="CommentReplyButton">
            <form action="/Articles/955508/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955515"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The more reliable a service is, the more alarm when it is unavailable</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2023 13:20 UTC (Mon)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/955515/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is similar to Health &amp; Safety - I would always teach people to be aware of hazards, and how to deal with said hazards.<br>
<p>
Trying to make sure there are no H&amp;S-relevant accidents, will actually make matters much worse. If everybody is trained in dealing with accidents, then firstly accidents are less likely, because people will be more aware, and secondly they will be less serious because everybody knows what to do.<br>
<p>
The trouble is when a minor incident runs away into a major accident because everyone is running around like headless chickens with no idea what to do.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955515/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor955710"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The more reliable a service is, the more alarm when it is unavailable</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 19, 2023 22:21 UTC (Tue)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/955710/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So… the alternative would be to follow Torvalds’ releases, assuming any stable-series Linux kernel’s fixes will have shown up in those first (other than the fixes inserted by distributors, of course).<br>
<p>
But, how realistic is it to do that on, say, a Debian bullseye that was released with 5.10?<br>
<p>
How tied to the kernel if not version then generation are various utilities that are compiled against 5.10’s headers?<br>
<p>
Sure, there is the compatibility guarantees of to not break userspace, but what about stuff tightly bound to the kernel? Things like, oh I don’t know, ifupdown/iproute2, udev, procfs/sysfs consumers in general, LUKS/LVM/dmsetup, WLAN, FUSE, X11? The thinkpad out-of-tree module and thinkfan, perhaps? I think people with systemd will have even worse trouble…<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955710/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955730"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The more reliable a service is, the more alarm when it is unavailable</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2023 6:35 UTC (Wed)
                               by <b>donald.buczek</b> (subscriber, #112892)
                              [<a href="/Articles/955730/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
From experience: You won't have any trouble with incompatibilities between elder userspace and newer kernels.<br>
<p>
You will have trouble (need to resolve) missconfiguration when you use `make olddefconfig` to go from one mainline release to the next. That's not bullet-proof, because config systematics and dependencies sometimes change between releases. Silly, easy to resolve example:  We just lost CONFIG_UNIX, because it went from tristate to binary and "m" was converted to "n" by `make olddefconfig`. Without CONFIG_UNIX, systemd doesn't get far.<br>
<p>
You will hit bugs introduced by each new mainline release. At least, if you roll your kernel out to a lot of different systems and use a lot of kernel features in non-standard ways. If you just have a single machine with a distro userspace, you will probably hit less bugs than we do.<br>
<p>
OTOH, we hit bugs with stable releases as well and I got the feeling, the frequency is ever increasing. If you analyze a bug and figure out, that the bad patch was auto-selected by some heuristics and wasn't needed at all, you start to doubt that "stable" is still worth its name. I'm really considering to abandon stable releases and follow mainline instead. Probably not yet, but it's not unthinkable. But that's not because mainline is good, its because stable gets worse. I wish there was less speed and more quality in the development of Linux.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955730/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955747"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The more reliable a service is, the more alarm when it is unavailable</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2023 14:09 UTC (Wed)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/955747/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Oh okay, good point, so diff the old and new .config file first.<br>
<p>
And yes, the “not because” and desire for deceleration is why I was asking in the first place.<br>
<p>
I’ll see what the distro continues to give me for a while, but it’s good to have options. Thanks for sharing your experience.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955747/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor955740"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The more reliable a service is, the more alarm when it is unavailable</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2023 11:32 UTC (Wed)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/955740/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <p>From experience, anything in-tree is fine as you upgrade the kernel (as long as you get Kconfig correct for the new kernel), but not necessarily happy with a downgrade; I have taken systems from a 4.x kernel to a 5.x kernel with no userspace changes, including X11, iproute2, udev, wpa-supplicant, FUSE and others.
<p>systemd is similarly great at coping on newer kernels than it was built for. The only thing I've ever had problems with were out-of-tree modules (which needed updates for the new kernel), and a vendor binary that had to be run as <tt>root</tt> and that expected to be able to find what it wanted to find in <tt>/dev/kmem</tt> (or possibly <tt>/dev/mem</tt> - it's been a while) and didn't cope with the newer kernel.
<p>I have, however, switched a Debian Stretch system from 4.9 to 6.1 without any difficulty - and I run Debian Stretch containers very happily on my 6.6.6 kernel.


      
          <div class="CommentReplyButton">
            <form action="/Articles/955740/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor955749"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The more reliable a service is, the more alarm when it is unavailable</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2023 14:13 UTC (Wed)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/955749/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks to you too for sharing your experience.<br>
<p>
No systemd here.<br>
<p>
Containers aren’t sufficient… I run Debian sarge (3.1) chroots for building packages, as a common baseline, and I recently found the debian/eol Docker containers and while the slink (2.1) one doesn’t work without extra hassles (privileged container), the potato (2.2) one does.<br>
<p>
But systems that actually need to boot, set up networking including WLAN, etc. need a bit more kernel↔userspace compatibility, which is why I was asking. That stretch data point is *very* useful.<br>
<p>
I think I’ll stick with Debian bullseye for a while (LTS, ELTS), but it’s good to have options and know about them.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/955749/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor957056"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The more reliable a service is, the more alarm when it is unavailable</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 6, 2024 11:41 UTC (Sat)
                               by <b>sammythesnake</b> (guest, #17693)
                              [<a href="/Articles/957056/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm curious what you might be using Debian 2.1 (Slink) for, given that it turns 25 this year and has had no security updates since since last century(!)...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/957056/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor957069"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The more reliable a service is, the more alarm when it is unavailable</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 6, 2024 21:36 UTC (Sat)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/957069/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I run CI-style build testing (and testsuite running) for code of mine that’s supposed to be portable, across a wide array of OSes (if possible) and versions, to see if it really works everywhere.<br>
<p>
You might say to forget about GNU/Linux systems that old, but I have found real portability issues by building things on strange systems, with strange compilers, etc. so I personally think there is worth in it (beyond the obvious bragging credits).<br>
<p>
Yes, I doubt I would find a slink in production. A lenny probably.<br>
<p>
But e.g. someone dug out BOW (4.4BSD on Windows) recently, and with some minor changes, things work well there, and it’s so much better than e.g. Cygwin…<br>
<p>
Others are cutting down systems or even writing new Unix-ish systems from scratch (Google Fuchsia, or the rust-y Maestro that recently made news, or even just classics like Haiku and Syllable OS and even Jehanne/Plan 9), and I like for stuff to run on those systems as well.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/957069/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2023, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
