        <!DOCTYPE html>
        <html lang="en">
        <head><title>The rest of the 5.0 merge window [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/776034/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/775923/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/776034/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>The rest of the 5.0 merge window</h1>
</div>
<div class="ArticleText">
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>January 7, 2019</br>
           </div>
Linus Torvalds <a href="/Articles/776102/">released 5.0-rc1</a> on
January&nbsp;6, closing the merge window for this development cycle and
confirming that the next release will indeed be called "5.0".  At that
point, 10,843 non-merge change sets had been pulled into the mainline, about
2,100 since <a href="/Articles/775698/">last week's summary</a> was
written.  Those 
2,100 patches included a number of significant changes, though, including
some new 
system-call semantics that may yet prove to create problems for existing
user-space code. 
<p>
The most significant changes merged in the last week include:
<p>
<h4>Architecture-specific</h4>
<p>
<ul class="spacylist">

<li> The C-SKY architecture has gained support for CPU hotplugging, ftrace,
     and perf.
</ul>

<p><blockquote class="ad">
<b><tt>$ sudo subscribe today</tt></b>
<p>
Subscribe today and elevate your LWN privileges. You’ll have
access to all of LWN’s high-quality articles as soon as they’re
published, and help support LWN in the process.  <a href="https://lwn.net/Promo/nst-sudo/claim">Act now</a> and you can start with a free trial subscription.
</blockquote>
<p>
<h4>Core kernel</h4>
<p>
<ul class="spacylist">

<li> There is a new "dynamic events" interface to the tracing subsystem.
     It unifies the three distinct interfaces (for kprobes, uprobes, and
     synthetic events) into a single control file.  See <a
     href="/ml/linux-kernel/154140838606.17322.15294184388075458777.stgit@devbox/">this
     patch posting</a> for a brief overview of how this interface works.


</ul>


<p>
<h4>Hardware support</h4>
<p>
<ul class="spacylist">

<li> <b>Miscellaneous</b>:
     NVIDIA Tegra20 external memory controllers,
     Qualcomm PM8916 watchdog timers,
     TQ-Systems TQMX86 watchdog timers,
     MediaTek Command-Queue DMA controllers,
     UniPhier MIO DMA controllers,
     Raspberry Pi touchscreens,
     Amlogic Meson PCIe host controllers, and
     Socionext UniPhier PCIe controllers.
<li> <b>Pin control</b>:
     NXP IMX8QXP pin controllers,
     Mediatek MT6797 and MT7629 pin controllers,
     Actions Semi S700 pin controllers, and
     Renesas RZ/A2 GPIO and pin controllers.
<li> Support for high-resolution mouse scroll wheels has been significantly
     improved. 

</ul>

<p>
<h4>Security</h4>
<p>
<ul class="spacylist">

<li> A small piece of the secure-boot lockdown patch set has landed in the
     form of additional control over the <tt>kexec_load_file()</tt> system
     call.  There is a new keyring (called <tt>.platform</tt>) for keys
     provided by the platform; it cannot be updated by a running system.
     Keys in this ring can be used to control which images may be run via
     <tt>kexec_load_file()</tt>.  It has also become possible for security
     modules to prevent calls to <tt>kexec_load()</tt>, which cannot be
     verified in the same manner.
<li> The secure computing (seccomp) mechanism <a
     href="/Articles/756233/">can now defer policy decisions to user
     space</a>.  See <a href="/Articles/776035/#userspace">this new
     documentation</a> for details on the final version of the API.
<li> The fscrypt filesystem encryption subsystem has gained support for
     the Adiantum encryption mode (which was added earlier in the merge
     window).
<li> The semantics of the <a
     href="http://man7.org/linux/man-pages/man2/mincore.2.html"><tt>mincore()</tt></a>
     system call have changed; see below for details.
</ul>

<p>
<h4>Internal kernel</h4>
<p>
<ul class="spacylist">

<li> The venerable <tt>access_ok()</tt> function, which verifies that
     an address lies within the user-space region, has lost its first
     argument.  This argument was either <tt>VERIFY_READ</tt> or
     <tt>VERIFY_WRITE</tt> depending on the type of access, but no
     implementation of <tt>access_ok()</tt> actually used that
     information.  The new prototype is:
<p>
<pre>
    int access_ok(void *address, int len);
</pre>
<p>
     <a
     href="https://git.kernel.org/linus/96d4f267e40f9509e8a66e2b39e8b95655617693">The
     patch implementing this change</a> ended up modifying over 600 files.
     There have also been several follow-up patches fixing various issues
     created by this change. 

</ul>

<p>
<h4>Changing mincore()</h4>
<p>
The <tt>mincore()</tt> system call is used to determine which pages in a
virtual address-space range are currently resident in the page cache; the
idea is to allow an application to learn which of its pages can be accessed
without incurring page faults.  As Torvalds notes in <a
href="https://git.kernel.org/linus/574823bfab82d9d8fa47f422778043fbb4b4f50e">this
commit</a>, the intended semantics of this call have always been
"<q>somewhat unclear</q>", but its behavior all along has been to
indicate which pages are resident in the cache, regardless of whether the
calling process has ever tried to access those pages.  In other words,
<tt>mincore()</tt> would reveal the presence of pages faulted in by other
processes running in the system.
<p>
Naturally, it turns out that if you can observe aspects of the system state
that are the result of other process's activity, you can use that
information to extract information that should be hidden.  Daniel Gruss et
al. have recently <a href="https://arxiv.org/pdf/1901.01161.pdf">released a
paper [PDF]</a> showing how <tt>mincore()</tt> can be exploited in just
this manner.  In response, Jiri Kosina posted <a
href="/ml/linux-kernel/nycvar.YFH.7.76.1901051817390.16954@cbobk.fhfr.pm/">a
patch</a> allowing system administrators to turn <tt>mincore()</tt> into a
privileged system call by way of a sysctl knob, but Torvalds <a
href="/ml/linux-kernel/CAHk-=wicks2BEwm1BhdvEj_P3yawmvQuG3NOnjhdrUDEtTGizw@mail.gmail.com/">wasn't
pleased</a> with that approach.  He responded with <a
href="/ml/linux-kernel/CAHk-=wif_9nvNHJiyxHzJ80_WUb0P7CXNBvXkjZz-r1u0ozp7g@mail.gmail.com/">a
patch</a> restricting the information returned by <tt>mincore()</tt> to
anonymous pages and a small subset of file pages.
<p>
After Jann Horn <a
href="/ml/linux-kernel/CAG48ez2jAp9xkPXQmVXm0PqNrFGscg9BufQRem2UD8FGX-YzPw@mail.gmail.com/">pointed
out</a> that restricting the query to the calling process's page tables
reduces the attack surface considerably, though, Torvalds decided to change
his approach.  As a result, the patch that was committed adds no new knobs,
but does unconditionally restrict <tt>mincore()</tt> to pages that are
actually mapped by the calling process — pages that said process has
accessed at some point.  That makes it much harder to use
<tt>mincore()</tt> to observe what other processes are doing; as Torvalds
<a
href="/ml/linux-kernel/CAHk-=whL4sZiM=JcdQAYQvHm7h7xEtVUh+gYGYhoSk4vi38tXg@mail.gmail.com/">pointed
out</a>, though, such observation is still theoretically possible, but
harder.
<p>
So the easy attack is closed, but that additional security may come at the
cost of creating problems for user space.  As Torvalds noted in the changelog:
<p>
<div class="BigQuote">
	NOTE! This is a real semantic change, and it is for example known
	to change the output of "fincore", since that program literally
	does a mmap without populating it, and then doing "mincore()" on
	that mapping that doesn't actually have any pages in it.
<p>
	I'm hoping that nobody actually has any workflow that cares, and the
	info leak is real.
</div>
<p>
If the change breaks code in the wild, it may have to be reverted and some
other solution found; for this reason, this patch has not been marked for
inclusion into the stable kernels.  For those out there who have code that
uses <tt>mincore()</tt>, now would be a good time to test the new semantics
to ensure that things still work as expected.
<p>
A couple of significant things were <i>not</i> merged before the merge
window closed, including <a href="/Articles/775872/">the controversial
fs-verity patch set</a>.  Also missing again is <a
href="/Articles/759499/">the new filesystem mounting API</a>, though some
of the precursor patches did go in toward the end of the merge window.
Unless something surprising happens, the feature set for this cycle is
complete and the 5.0 kernel is now in the stabilization phase, with a final
release expected in late February.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-5.0">Releases/5.0</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/776034/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor776560"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 5.0 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 11, 2019 21:44 UTC (Fri)
                               by <b>HIGHGuY</b> (subscriber, #62277)
                              [<a href="/Articles/776560/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Does the mincore really restrict things?<br>
If one can time how long it takes to access a page, I’m sure you can differentiate between in memory, soft page fault and hard page fault.<br>
<p>
If so, madv_willneed/dontneed, readahead and friends, can all help leak this information.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/776560/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777441"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 5.0 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2019 9:03 UTC (Thu)
                               by <b>polyp</b> (guest, #53146)
                              [<a href="/Articles/777441/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As I understood it unpatched mincore could be used to check the cache presence of pages that are not accessible by the calling process, i.e. would cause a segfault if accessed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777441/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2019, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
