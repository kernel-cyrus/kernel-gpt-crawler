        <!DOCTYPE html>
        <html lang="en">
        <head><title>Why RISC-V doesn't (yet) support KVM [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/856685/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/856790/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/856685/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Why RISC-V doesn't (yet) support KVM</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Please consider subscribing to LWN</b>
<p>
Subscriptions are the lifeblood of LWN.net.  If you appreciate this
content and would like to see more of it, your subscription will
help to ensure that LWN continues to thrive.  Please visit
<a href="/Promo/nst-nag1/subscribe">this page</a> to join up and keep LWN on
the net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>May 20, 2021</br>
           </div>
The <a href="https://riscv.org/">RISC-V</a> CPU architecture has been
gaining prominence for some years; its relatively open nature makes it an
attractive platform on which a number of companies have built products.
Linux supports
RISC-V well, but there is one gaping hole: there is no support for
virtualization with <a
href="https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine">KVM</a>,
despite the fact that a high-quality 
implementation exists.  A recent attempt to add that support is shining
some light on a part of the ecosystem that, it seems, does not work quite
as well as one would like.
<p>
Linux supports a number of virtualization mechanisms, but KVM
is generally seen as the native solution.  It provides a standard interface
across systems, but much of KVM is necessarily architecture-specific, since
the mechanisms for supporting virtualization vary from one processor to the
next.  Thus, architectures that support KVM generally have a <tt>kvm</tt>
directory nestled in with the rest of the architecture-specific code.
<p>
Given that, some eyebrows were raised when Anup Patel's <a
href="/ml/linux-kernel/20210519033553.1110536-1-anup.patel@wdc.com/">patch
series adding RISC-V KVM support</a> deposited the architecture-specific
code into the staging directory instead.  Staging is normally used for device
drivers that do not meet the kernel's standards for code quality; if all
goes well they are improved and eventually "graduate" out of the staging
directory.  It is not usually a place for architecture support.  So staging
maintainer Greg Kroah-Hartman was <a
href="/ml/linux-kernel/YKSa48cejI1Lax+%2F@kroah.com/">quick to ask</a> why
things were being done that way.
<p>
The answer comes down to the patch-acceptance policy for RISC-V code, found
in <a
href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/riscv/patch-acceptance.rst">Documentation/riscv/patch-acceptance.rst</a>,
which reads:
<p>
<blockquote class="bq">
	We'll only accept patches for new modules or extensions if the
	specifications for those modules or extensions are listed as being
	"Frozen" or "Ratified" by the RISC-V Foundation.  (Developers may,
	of course, maintain their own Linux kernel trees that contain code
	for any draft extensions that they wish.)
</blockquote>
<p>
Virtualization for RISC-V is described by the <a
href="https://github.com/riscv/riscv-isa-manual/blob/master/src/hypervisor.tex">hypervisor
extension</a> specification.  As Patel <a
href="/ml/linux-kernel/CAAhSdy18qySXbUdrEsUe-KtbtuEoYrys0TcmsV2UkEA2=7UQzw@mail.gmail.com/">explained</a>,
that extension has not yet been approved:
<p>
<blockquote class="bq">
	The KVM RISC-V patches have been sitting on the lists for almost 2
	years now. The requirements for freezing RISC-V H-extension
	(hypervisor extension) keeps changing and we are not clear when it
	will be frozen. In fact, quite a few people have already
	implemented RISC-V H-extension in hardware as well and KVM RISC-V
	works on real HW as well.
<p>
	Rationale of moving KVM RISC-V to drivers/staging is to continue
	KVM RISC-V development without breaking the Linux RISC-V patch
	acceptance policy until RISC-V H-extension is frozen.
</blockquote>
<p>
It is fair to say that Kroah-Hartman <a
href="/ml/linux-kernel/YKSgcn5gxE%2F4u2bT@kroah.com/">was not
impressed</a>; he stated that circumventing policies in other parts of the
kernel tree is not the purpose of the staging directory,
so the RISC-V KVM code would not be accepted there.  Paolo Bonzini, the
overall maintainer for KVM, <a
href="/ml/linux-kernel/d7d5ad76-aec3-3297-0fac-a9da9b0c3663@redhat.com/">added</a>
that "<q>the RISC-V acceptance policy as is just doesn't work</q>",
as demonstrated by the fact that developers are having to work around it.
This is especially unfortunate here, he said, because the RISC-V KVM
implementation "<q>is also a very good example of how to do things
right</q>".  He <a
href="/ml/linux-kernel/daa30135-8757-8d33-a92e-8db4207168ff@redhat.com/">went
on</a> to suggest that there may be some players out there who benefit from
the slowing down of patches on their way into the kernel.
<p>
Kroah-Hartman <a
href="/ml/linux-kernel/YKUZbb6OK+UYAq+t@kroah.com/">responded</a> that
slowing down the merging of useful code is "<q>horrible</q>" and that
the job of the kernel community is to make hardware work; a policy that
prevents the merging of good code that adds support for existing hardware does
not make sense.  He asked the RISC-V maintainers to explain this policy;
they have yet to answer that question.  Back in April, though, RISC-V
maintainer Palmer Dabbelt <a
href="/ml/linux-kernel/mhng-d64da1be-bacd-4885-aaf2-fea3c763418c@palmerdabbelt-glaptop/">acknowledged</a>
that the acceptance policy is not producing the desired results:
<p>
<blockquote class="bq">
	My goal with the RISC-V stuff has always been getting us to a place
	where we have real shipping products running a software stack that
	is as close as possible to the upstream codebases.  I see that as
	the only way to get the software stack to a point where it can be
	sustainably maintained.  The "only frozen extensions" policy was
	meant to help this by steering vendors towards a common base we
	could support, but in practice it's just not working out.
</blockquote>
<p>
He added that the policy could change, but only when there is a new policy
for patch acceptance in place that everybody agrees to.  Co-maintainer Paul
Walmsley, though, <a
href="/ml/linux-kernel/5b988c4e-25e9-f2b9-b08d-35bc37a245e4@sifive.com/">placed
the blame</a> with RISC-V International's specification process and said
that any fixes should be applied there instead.
<p>
It is not that hard to understand why the RISC-V maintainers might not want
to attempt to support every nonstandard CPU that is out there.  The open
nature of RISC-V makes it relatively easy for anybody to create their own
variant, and supporting them all could become unworkable.  The
counterpoint is, as Kroah-Hartman said, that the kernel's job is to run
on the hardware that is out there.  Blocking support for shipping systems
can only have the effect of pushing those systems toward vendor-supplied
kernels with a lot of out-of-tree code — an unfortunate outcome for what is
supposed to be an open architecture.
<p>
When the subject is support for a feature as fundamental as virtualization,
the question becomes even more urgent.

Hopefully this episode will lead to a rethinking of the patch-acceptance
policies for the RISC-V architecture.  Failing that, Kroah-Hartman has <a
href="/ml/linux-kernel/YKTsyyVYsHVMQC+G@kroah.com/">signaled his
willingness</a> to allow that support into staging if there is truly no
alternative.  So Linux seems likely to gain KVM support for RISC-V in the
relatively near future, even if it's necessary to circumvent the
architecture's maintainers to do it.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Architectures-RISC-V">Architectures/RISC-V</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#KVM">KVM</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Virtualization-KVM">Virtualization/KVM</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/856685/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor856812"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 20, 2021 18:29 UTC (Thu)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/856812/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It seems like a significant number of independent hardware implementations shipping that agree with each other and a proposed document should be a reasonable equivalent to the extension being frozen, with respect to supporting it in the kernel. It describes a practice with consensus behind it, even if the Foundation isn&#x27;t yet willing to encourage that practice.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856812/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor856827"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 20, 2021 21:02 UTC (Thu)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/856827/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<a href="https://lwn.net/ml/linux-kernel/a49a7142-104e-fdaa-4a6a-619505695229@redhat.com/">https://lwn.net/ml/linux-kernel/a49a7142-104e-fdaa-4a6a-6...</a> provides additional context as to how feature creep is delaying the freezing of the hypervisor specification.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856827/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor856829"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 20, 2021 21:36 UTC (Thu)
                               by <b>pdp7pdp7</b> (subscriber, #96517)
                              [<a href="/Articles/856829/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
pbonzini: I am confused about your comment [1] that some people may believe it could be beneficial to slow down merging of RISC-V support upstream.  I am trying to understand who would benefit in that scenario.  Is the theoretical benefit that it could reduce the RISC-V maintainer workload?<br>
<p>
[1] <a href="https://lore.kernel.org/linux-riscv/daa30135-8757-8d33-a92e-8db4207168ff@redhat.com/">https://lore.kernel.org/linux-riscv/daa30135-8757-8d33-a9...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856829/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor856831"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 20, 2021 22:25 UTC (Thu)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/856831/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The patch acceptance policy can become an incentive to game the system:<br>
<p>
1. Company X don&#x27;t have hardware ready that implements an extension<br>
<p>
2. Company X slows down ratification of the extension<br>
<p>
3. Competitors must ship out of tree code to support the extension in Linux<br>
<p>
The conflict of interest is outside Linux, which is what Paul Welmsley alluded to with respect to speeding up the process of ratification, but it affects Linux and the maintainers are caught in the crossfire.<br>
<p>
Looking at the history of the hypervisor extension specification[1], the last significant change was done about one year ago (May 15, 2020). There is no justification at all for the specification not to be frozen yet.<br>
<p>
[1] <a href="https://github.com/riscv/riscv-isa-manual/commits/master/src/hypervisor.tex">https://github.com/riscv/riscv-isa-manual/commits/master/...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856831/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor856835"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 0:09 UTC (Fri)
                               by <b>yootis</b> (subscriber, #4762)
                              [<a href="/Articles/856835/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<p>
So which &quot;company X&quot; is slowing the system down now?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856835/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor856864"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 9:11 UTC (Fri)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/856864/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <p>My understanding is that the slowdown is not a specific company this time - it's getting the <a href="https://github.com/riscv/riscv-plic-spec">PLIC</a> and <a href="https://github.com/riscv/riscv-fast-interrupt">CLIC</a> specifications close enough to done that the RISC-V Foundation can be confident that the Hypervisor extension will not need to be modified to support direct delivery of interrupts to guest IRQ handlers without hypervisor involvement.
      
          <div class="CommentReplyButton">
            <form action="/Articles/856864/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor856874"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 12:08 UTC (Fri)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/856874/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Which is completely useless, since you can always make a subextension.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856874/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor856843"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 1:45 UTC (Fri)
                               by <b>ncm</b> (guest, #165)
                              [<a href="/Articles/856843/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If it&#x27;s not frozen, then by definition it might still change. Are kernel maintainers prepared to support more than one version of RISC-V virtualization?<br>
<p>
To me the worst continuing omission is the B extension, and the worst missing bit of that is the POPCOUNT instruction, which really should be in with the base instructions alongside ADD and AND. I gather some lunatics are agitating to make it optional even in B, which is insane. POPCOUNT has been in or lately added to every production architecture ever, for reasons. (And, no, trap emulation would be much worse than useless.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856843/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor856859"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 7:43 UTC (Fri)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/856859/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Indeed, just give me CLZ/CTZ/POPCOUNT/ROL/ROR/SEXT in the base instruction set and call it a day...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856859/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor856870"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 10:54 UTC (Fri)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/856870/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Are kernel maintainers prepared to support more than one version of RISC-V virtualization?</font>

<p>Why would that be a problem? AMD and Intel use totally different schemes and they both are supported.</p>

<p>And I think <b>being implemented in ASIC which is shipping</b> should be considered “effectively frozen”. I can see how people may implement thousands of different things on FPGA. Supporting these would be a nightmare from practical POV. And FPGA implementation can definitely be changed thus it's not “effectively frozen” anyway. But if something is already in ASIC it couldn't ever be changed (on that specific ASIC) thus I think kernel should support it.</p>

<p>Kernel supports lots of devices (WiFi and others) which only support draft of some spec or another… why RISC-V extensions should be different?</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/856870/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor856908"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 15:11 UTC (Fri)
                               by <b>mss</b> (subscriber, #138799)
                              [<a href="/Articles/856908/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Why would that be a problem? AMD and Intel use totally different schemes and they both are supported.</font><br>
<p>
It&#x27;s a waste of effort to implement what&#x27;s effectively the same thing two different ways.<br>
And these aren&#x27;t trivial things.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856908/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857020"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 23, 2021 7:38 UTC (Sun)
                               by <b>ssmith32</b> (subscriber, #72404)
                              [<a href="/Articles/857020/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It&#x27;s not a waste of effort for the people who are stuck with one implementation or the other: in short, the users of linux. Particularly when that implementation is baked into asic hardware.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857020/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857035"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 23, 2021 11:57 UTC (Sun)
                               by <b>mss</b> (subscriber, #138799)
                              [<a href="/Articles/857035/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
My comment was more about not having two different hardware schemes in the first place (like VMX and SVM for x86).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857035/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor856847"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 4:11 UTC (Fri)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/856847/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It seems like shipping hardware should trump specifications; the Linux kernel already has code for working around quirks in devices&#x27; support for various other specs, so why not do the same for RISC-V and KVM?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856847/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor856850"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 4:43 UTC (Fri)
                               by <b>wsy</b> (subscriber, #121706)
                              [<a href="/Articles/856850/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That&#x27;s why I don&#x27;t like standards made by committees.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856850/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor856861"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 7:59 UTC (Fri)
                               by <b>rwmj</b> (subscriber, #5474)
                              [<a href="/Articles/856861/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It&#x27;s nothing to do with &quot;standards made by committees&quot; (which this is not - some very very smart people worked on this standard).  It&#x27;s about some CPU vendors trying to game things.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856861/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor856942"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 21:40 UTC (Fri)
                               by <b>rgmoore</b> (<b>&#x272D; supporter &#x272D;</b>, #75)
                              [<a href="/Articles/856942/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>Whether the people working on something are smart or not has nothing to do with whether or not it's being done by a committee.  A committee of geniuses working in their element is still a committee.  Committees can be a great way of doing things.  There are any number of famous, successful, and greatly loved projects that were done by committee.  Almost all of the popular translations of the Bible were done by committee, for instance.

<p>I think that points to the big strength and the big danger of committees.  A well run committee can get the minds of all its members working on a problem so they can do something none of them could manage alone.  A poorly run committee puts the minds of its members in opposition, so the group gets less done than any of them could manage alone.  The difference is whether the members can put aside their parochial interests to advance the good of the project.  If they can, the committee can be a huge success.  If they can't the committee will almost surely bog down into infighting.  Vendors trying to game the system are a great example of the weakness of a committee structure; the members are so wrapped up by their own interests that the project as a whole suffers.
      
          <div class="CommentReplyButton">
            <form action="/Articles/856942/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor856968"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 22, 2021 10:41 UTC (Sat)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/856968/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;ll convey your thoughts on this to the NVMe committee, the SCSI committee, the C committee, the SQL committee, the IEEE 754 committee and the USB committee.<br>
<p>
Committees can be bad, but they can also be very, very good.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856968/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor857021"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 23, 2021 7:40 UTC (Sun)
                               by <b>ssmith32</b> (subscriber, #72404)
                              [<a href="/Articles/857021/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What standards do you like that weren&#x27;t done by committee? So do you think the metric system is an epic boondoggle, and we all should be using slugs to measure mass?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857021/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor856863"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">K210 MMU support</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 8:26 UTC (Fri)
                               by <b>geert</b> (subscriber, #98403)
                              [<a href="/Articles/856863/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  The counterpoint is, as Kroah-Hartman said, that the kernel&#x27;s job is to run on the hardware that is out there.</font><br>
<p>
So can we get Canaan Kendryte K210 MMU support in drivers/staging/, too? ;-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856863/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor856938"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2021 18:54 UTC (Fri)
                               by <b>pwsan</b> (subscriber, #56604)
                              [<a href="/Articles/856938/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Jonathan writes:<br>
<p>
<font class="QuotedText">&gt; The counterpoint is, as Kroah-Hartman said, that the kernel&#x27;s job is to run on the hardware that is out there. Blocking support for shipping systems can only have the effect of pushing those systems toward vendor-supplied kernels with a lot of out-of-tree code — an unfortunate outcome for what is supposed to be an open architecture.</font><br>
<p>
<font class="QuotedText">&gt; When the subject is support for a feature as fundamental as virtualization, the question becomes even more urgent. Hopefully this episode will lead to a rethinking of the patch-acceptance policies for the RISC-V architecture. </font><br>
<p>
One of the issues with the proposal to merge KVM support now for RISC-V is that no one has yet been able to identify any shipping systems that support the RISC-V hypervisor extension.  What&#x27;s being proposed, instead, is that we merge support for a hypervisor extension that isn&#x27;t yet part of the RISC-V ISA.  While we certainly understand Anup&#x27;s and Paolo&#x27;s desire to get their code merged upstream as soon as possible, I&#x27;m afraid these important points have been lost, both in the article and in most of the discussion.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856938/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor856966"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 22, 2021 8:19 UTC (Sat)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/856966/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As far as userspace is concerned, the API is only based on ratified specifications. The details of the hypervisor spec is completely hidden within Linux code. At the same time, until KVM is merged into upstream Linux the whole stack (QEMU, kvmtool) has to be developed in a fork, and new kernel features are harder to review. All this is simply *not how Linux is developed*.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856966/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor856982"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 22, 2021 16:37 UTC (Sat)
                               by <b>mfuzzey</b> (subscriber, #57966)
                              [<a href="/Articles/856982/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Is it shipping *systems* or *chips* that don&#x27;t exist yet?<br>
Presumably those developing this feature are testing it on something.<br>
<p>
If the chips exist just no one is selling systems with them yet (presumably the developers having custom prototype boards) then I see no reason not to merge the feature as the chips aren&#x27;t going to change.<br>
<p>
OTOH if no chips exist yet (eg if prototyping is being done on a FPGA) I can see the rational for waiting if there is a real risk that the final hardware is different.<br>
But even in this case does it really matter given that the user space won&#x27;t be affected? Sure the kernel code may have to change for the final hardware but if the prototype hardware never shipped does this matter as there will be no need to support both in the kernel.<br>
<p>
I may be missing something obvious here as I&#x27;m not well versed in RISC V<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/856982/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857022"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 23, 2021 7:44 UTC (Sun)
                               by <b>ssmith32</b> (subscriber, #72404)
                              [<a href="/Articles/857022/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think this was the argument being made here:<br>
<p>
&quot;In fact, quite a few people have already implemented RISC-V H-extension in hardware as well and KVM RISC-V works on real HW as well. &quot;<br>
<p>
And which sounds like the main reason it may end up being merged into stg.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857022/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor857236"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why RISC-V doesn't (yet) support KVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 26, 2021 0:29 UTC (Wed)
                               by <b>pwsan</b> (subscriber, #56604)
                              [<a href="/Articles/857236/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Presumably those developing this feature are testing it on something.</font><br>
<p>
Probably most people are using QEMU to experiment with this, with the instructions and code here:<br>
<p>
<a href="https://github.com/kvm-riscv">https://github.com/kvm-riscv</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857236/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2021, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
