        <!DOCTYPE html>
        <html lang="en">
        <head><title>The last things through the 2.6.26 merge window [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/281029/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/280647/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/281029/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>The last things through the 2.6.26 merge window</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>We're bad at marketing</b>
<p>
We can admit it, marketing is not our strong suit. Our strength is
writing the kind of articles that developers, administrators, and
free-software supporters depend on to know what is going on in the
Linux world. Please <a href="/Promo/nsn-bad/subscribe">subscribe today</a> to help us keep doing that, and so
we donâ€™t have to get good at marketing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>May 5, 2008</br>
           </div>
About 500 changesets were merged after the publication of the <a
href="http://lwn.net/Articles/278965/">first</a> and <a
href="http://lwn.net/Articles/280034/">second</a> 2.6.26 merge window
summaries.  The merge window is now closed; here is the final set of
changes which got in:
<p>
<ul>

<li> New drivers for Solarflare Communications Solarstorm SFC4000
     controller-based Ethernet controllers,
     Hauppauge HVR-1600 TV tuner cards,
     ISP 1760 USB host controllers,
     Cypress c67x00 OTG controllers, and
     Intel PXA 27x USB controllers.

<p>

<li> 8Kb stacks are, once again, the default for the x86 architecture.
     "<q>Out-of-memory situations are less problematic than silent and
     hard to debug stack corruption.</q>"
<p>

<li> The klist type now has the usual-form macros for declaration and 
     initialization: <tt>DEFINE_KLIST()</tt> and <tt>KLIST_INIT()</tt>.
     Two new functions (<tt>klist_add_after()</tt> and
     <tt>klist_add_before()</tt>) can be used to add entries to a klist in
     a specific position.
<p>
<li> As had been planned, <tt>struct class_device</tt> has been removed
     from the driver core, along with all of the associated infrastructure.
     Classes are now implemented with an ordinary <tt>struct device</tt>.
<p>
<li> <tt>kmap_atomic_to_page()</tt> is no longer exported to modules.
<p>
<li> There are some new generic functions for performing 64-bit integer
     division in the kernel:
<p>
<pre>
    u64 div_u64(u64 dividend, u32 divisor);
    u64 div_u64_rem(u64 dividend, u32 divisor, u32 *remainder);
    s64 div_s64(s64 dividend, s32 divisor)
    s64 div_s64_rem(s64 dividend, s32 divisor, s32 *remainder);
</pre>
     Unlike <tt>do_div()</tt>, these functions are explicit about whether
     signed or unsigned math is being done.  The x86-specific
     <tt>div_long_long_rem()</tt> has been removed in favor of these new
     functions.
<p>
<li> There is a new string function:
<p>
<pre>
     bool sysfs_streq(const char *s1, const char *s2);
</pre>
<p>
     It compares the two strings while ignoring an optional trailing
     newline. 
<p>
<li> The prototype for i2c <tt>probe()</tt> methods has changed:
<p>
<pre>
     int (*probe)(struct i2c_client *client, 
                  const struct i2c_device_id *id);
</pre>
<p>
     The new <tt>id</tt> argument supports i2c device name aliasing.
<p>
<li> There is a new configuration (<tt>MODULE_FORCE_LOAD</tt>) which
     controls whether the loading of modules can be forced if the kernel
     thinks something is not right; it defaults to "no."
</ul>
<p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-2.6.26">Releases/2.6.26</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/281029/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor281387"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The last things through the 2.6.26 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 8, 2008 8:06 UTC (Thu)
                               by <b>cventers</b> (guest, #31465)
                              [<a href="/Articles/281387/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
bool sysfs_streq(const char *s1, const char *s2);

Shouldn't such a generic function be named something like streqnl()? 
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/281387/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor281397"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The last things through the 2.6.26 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 8, 2008 9:25 UTC (Thu)
                               by <b>johill</b> (subscriber, #25196)
                              [<a href="/Articles/281397/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
I'd think that the function isn't all that generic, when would you want to use it (outside of
the sysfs braindamage)? Sure, its definition might sound generic, but I wouldn't think you
should use it often anyway.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/281397/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor281450"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The last things through the 2.6.26 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 8, 2008 15:16 UTC (Thu)
                               by <b>jzbiciak</b> (guest, #5246)
                              [<a href="/Articles/281450/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
Hmm... It seems like removing optional trailing newlines early ought to be more general and
robust.  After all, perl has had chomp() for what, a decade or more?
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/281450/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor281466"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The last things through the 2.6.26 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 8, 2008 16:37 UTC (Thu)
                               by <b>bronson</b> (subscriber, #4806)
                              [<a href="/Articles/281466/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
As of this year, I think chop is 20 years old (+/- 1 year).  So this is what the future looks
like...  not very impressive.  I thought we'd all be using CORBA-connected dataflow languages
by now!
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/281466/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor281474"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The last things through the 2.6.26 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 8, 2008 16:47 UTC (Thu)
                               by <b>jzbiciak</b> (guest, #5246)
                              [<a href="/Articles/281474/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
Well, there's chop() and there's chomp().  Methinks chomp() is more appropriate to handle
optional newlines.  :-)
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/281474/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor281535"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">4k/8k stacks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 8, 2008 23:12 UTC (Thu)
                               by <b>kbob</b> (guest, #1770)
                              [<a href="/Articles/281535/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
I'm asking this from a position of ignorance -- I haven't looked at kernel code in a long
time.  But wouldn't it be possible to allocate 4k stacks with guard pages between them, thus
(a) saving memory and (b) generating a loud exception on stack overflow?

Or is there some kind of overhead in leaving holes into the kernel address space that I'm not
aware of?


</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/281535/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor281543"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">4k/8k stacks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 9, 2008 0:48 UTC (Fri)
                               by <b>jmspeex</b> (subscriber, #51639)
                              [<a href="/Articles/281543/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
I believe we're talking non-virtual memory, so an overflow would just end up on the next
physical page with no way to detect it. Or maybe I'm just talking through my ass (I'm not a
kernel dev).
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/281543/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor281546"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">4k/8k stacks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 9, 2008 0:57 UTC (Fri)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/281546/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      All memory is virtual memory when the kernel is running.  But kernel-space addresses are a sort of special case, in that they are mapped as one big page using a single page table entry.  So it's not possible to insert inaccessible guard pages after the kernel stacks - at least, not without dropping the big mapping, which would have a significant performance cost.
      
          <div class="CommentReplyButton">
            <form action="/Articles/281546/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor282465"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">4k/8k stacks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 15, 2008 11:37 UTC (Thu)
                               by <b>cras</b> (guest, #7000)
                              [<a href="/Articles/282465/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
Maybe a small (32bit?) canary at the end of the stack would help a bit? Although if an
overflow 
happens I guess by the time it's noticed the kernel might have crashed already.


</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/282465/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor282495"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">4k/8k stacks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 15, 2008 14:01 UTC (Thu)
                               by <b>mcortese</b> (guest, #52099)
                              [<a href="/Articles/282495/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>Kernel address space maps 1-to-1 to physical memory (at least for less than 1 GiB of RAM).
The argument is 1 page vs. 2 pages of stack.
Having just 1 page of stack plus 1 <em>guard</em> page just doesn't save anything.
      
          <div class="CommentReplyButton">
            <form action="/Articles/282495/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2008, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
