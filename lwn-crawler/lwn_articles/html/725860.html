        <!DOCTYPE html>
        <html lang="en">
        <head><title>Attacking the kernel via its command line [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/725860/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/725472/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/725860/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Attacking the kernel via its command line</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Benefits for LWN subscribers</b>
<p>
The primary benefit from <a href="/Promo/nst-nag5/subscribe">subscribing to LWN</a>
       is helping to keep us publishing, but, beyond that, subscribers get
       immediate access to all site content and access to a number of extra
       site features.  Please sign up today!
</blockquote>
<div class="GAByline">
           <p>June 20, 2017</p>
           <p>This article was contributed by Nur Hussein</p>
           </div>
<p>

The kernel's command line allows the specification of many operating
parameters at boot time.  A silly bug in command-line parsing was reported
by Ilya Matveychikov on May&nbsp;22; it can be exploited to force a stack
buffer overflow with a controlled payload that can overwrite memory. The
bug itself stems from a bounds-checking error that, while simple, has still
been in the Linux kernel source since version 2.6.20. The subsequent
disclosure <a href="http://seclists.org/oss-sec/2017/q2/344">post</a> by
Matveychikov in the oss-security list spawned a discussion on what
constitutes a vulnerability, and what is, instead, merely a bug.</p>

<p>
Many kernel command-line parameters allow the specification of an array of
integer values, using a syntax like:
<p>
<pre>
    foo=1-10
</pre>
<p>
Within the kernel, the result of such a parameter will be the filling of an
array with the values one through ten.  Array parameters are parsed with the <a
href="http://elixir.free-electrons.com/linux/latest/source/lib/cmdline.c#L72"><tt>get_options()</tt></a>
function:
<p>
<pre>
    char *get_options(const char *str, int nints, int *ints);
</pre>
<p>
The <tt>nints</tt> value specifies the maximum number of integer values
that should be placed into the <tt>ints</tt> array.  Unfortunately, nobody
noticed that <tt>get_options()</tt> simply ignores <tt>nints</tt>; if the
command line contains a parameter like <tt>foo=1-1000000</tt>, one-million
entries will be written, regardless of whether the destination array has
the space to hold them.  There are just over 200 <tt>get_options()</tt>
call sites in the 4.12-rc6 kernel; any one of them could be used to
overwrite memory via a hostile command line.
<p>
The example
Matveychikov provided gave a huge range for the <tt>netdev</tt>
parameter, triggering the bug.
The overflow can be demonstrated while booting an affected kernel
using <tt>qemu</tt>:</p> 

<pre>
    qemu-system-x86_64 -no-reboot -no-shutdown -kernel \
        /boot/vmlinuz-4.4.0-66-generic -append "netdev=3735928559-3735999999"
</pre>

<p>The numbers were chosen so that it wrote variants of the
hexadecimal number 0xdeadbeef over and over when overflowing into
memory (3735928559=0xdeadbeef),
demonstrating that a controlled (if restricted) payload is possible. 
Matveychikov's <a href="/Articles/725865/">patch</a> fixing the error was
sent to the linux-kernel and stable lists, but
it was not merged and seems to have slipped through the cracks.
<p>
Indeed, the fate of this patch is instructive in its own right.  Even if
one is not concerned about any potential security implications of this
problem, it 
still seems like a bug worth fixing.  But it disappeared into the
linux-kernel noise, and the one maintainer who seems to have read it, Greg
Kroah-Hartman, <a href="/Articles/725866/">rejected it</a> as a
stable-kernel patch submission that did not follow <a
href="https://static.lwn.net/kerneldoc/process/stable-kernel-rules.html">the
relevant rules</a>.  Nobody has bothered to direct it to a maintainer who
will actually apply it, so the problem remains unfixed.
<p>
<h4>Bug or vulnerability?</h4>
<p>
<p>This isn't the first bounds-checking error to be exploitable via the
kernel command line. Matveychikov points out that this bug is similar to <a
href="https://alephsecurity.com/vulns/aleph-2017023">CVE-2017-1000363</a>,
an overflow of the <tt>parport_nr</tt> array. On the oss-security list,
Simon McVittie <a 
href="http://seclists.org/oss-sec/2017/q2/347">raised</a> the question of
whether there is a realistic way for an attacker to exploit the Linux
kernel boot command line without already having compromised the system.
McVittie asked: "<q>is this a security vulnerability, or
just a bug?</q>"  

<p>Daniel Micay <a
href="http://seclists.org/oss-sec/2017/q2/348">argued strongly</a>
that this bug does not represent 
a security vulnerability, saying that "<q>it's unreasonable to consider
the kernel line untrusted</q>".  After all, as Micay <a
href="http://seclists.org/oss-sec/2017/q2/365">elaborated</a>, there is a
whole host of command-line knobs that allow users to alter
kernel functions. Florian Weimer disagreed, calling it a potential <a
href="http://seclists.org/oss-sec/2017/q2/349">secure boot bypass</a>, "<q>so it matters in some theoretical
sense to some downstreams which carry those Secure Boot patches.</q>"
Kurt Seifried <a
href="http://seclists.org/oss-sec/2017/q2/357">replied</a> that, for the
purposes of CVE assignment, this is a vulnerability. Micay <a
href="http://seclists.org/oss-sec/2017/q2/359">took issue</a> with the fact
that CVEs are assigned to bugs like this at all, calling it
"<q>meaningless Red Hat security theatre</q>".
Seifried <a href="http://seclists.org/oss-sec/2017/q2/362">replied</a> that
CVE assignment has nothing to do with Red Hat, and that
Micay should take up the
issue with the MITRE/CVE Board. 

<p>Is this bug a potential secure-boot bypass? Yes, it is. "Secure boot"
isn't a monolithic piece of code that ends with UEFI, it also relies on
every privileged piece of code down the boot chain to ensure the integrity
of the running operating system. The UEFI portion verifies the bootloader
and kernel, and will happily hand off execution to any program that's
signed, even buggy kernels.  That program is supposed to keep control of
the system, preventing even a root user from performing actions that could
compromise the system; many actions that root can usually perform are often <a
href="/Articles/514985/">disabled</a> when secure boot is in use.
<p>
Thus, secure-boot developers argue, kernel functionality and command-line
parameters need 
to be locked down so that the kernel cannot be modified in ways that will
subvert secure boot. For
example, <a
href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=bf616d21f41174389c6d720ae21bf40f154474c8">this
patch from David Howells</a>, which was merged for the 4.12 kernel,
provides annotations to mark
parameters that affect hardware, which in turn will let the kernel <a
href="/Articles/708179/">lock some of those parameters
down</a>.  Buggy command-line processing that allows the overwriting of
unrelated memory clearly defeats this sort of lockdown; it can, thus, only
be seen as a vulnerability by anybody who is concerned about the use of
command-line (or module) parameters to defeat secure boot.

<p>
The kernel has certainly been getting more secure over the last few years,
with automated tools such as <a
href="/Articles/677764/">fuzzers</a> and efforts like
the <a
href="https://kernsec.org/wiki/index.php/Kernel_Self_Protection_Project">Kernel
Self Protection Project</a> taking a more proactive approach to security.  
Bugs still slip in, of course, and sometimes it can take quite some time
before they 
are found and fixed as well.  When they are found, though, it is important
that those fixes do get merged; letting this one linger helps no one.  
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security">Security</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Linux_kernel">Linux kernel</a></td></tr>
            <tr><td><a href="/Archives/GuestIndex/">GuestArticles</a></td><td><a href="/Archives/GuestIndex/#Hussein_Nur">Hussein, Nur</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/725860/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor726024"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 20, 2017 21:59 UTC (Tue)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726024/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  it also relies on every privileged piece of code down the boot chain to ensure the integrity of the running operating system</font><br>
<p>
Including protecting the integrity of the kernel command-line in the bootloader, and having the kernel verify the integrity of *at least* the base operating system, because the kernel alone doesn't do something useful. It's userspace that makes it do something useful.<br>
<p>
<font class="QuotedText">&gt; Is this bug a potential secure-boot bypass? </font><br>
<p>
Nope, regardless of people misrepresenting it as such, that doesn't change that it's not. No bugs are required to take control of everything via the kernel line, and that includes kernel code execution.<br>
<p>
<font class="QuotedText">&gt; That program is supposed to keep control of the system, preventing even a root user from performing actions that could compromise the system; many actions that root can usually perform are often disabled when secure boot is in use.</font><br>
<p>
This doesn't mean anything if even init wasn't verified. There's not really anything further to compromise. If the kernel contains root with SELinux or whatever else, then protecting the kernel from root has value. I'm not sure what the connection is to secure / verified boot though.<br>
<p>
<font class="QuotedText">&gt; When they are found, though, it is important that those fixes do get merged; letting this one linger helps no one.</font><br>
<p>
Since it doesn't break a meaningful for security boundary for anyone and won't ever be hit in practice, I don't see the point of treating it as a fix worth backporting. It should be fixed, but it's a novelty. Greg has a lot of important patches to backport that aren't yet backported so why waste time on trivialities?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726024/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726028"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 20, 2017 22:11 UTC (Tue)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726028/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And by the way, for the Android (one of the Nexus devices) example where the bootloader had a bug allowing kernel command-line injection, changing the initial root and init is all that's needed to bypass it. Those kernels don't use modules and are perfectly capable of booting from USB, at which point the attacker has full control over the kernel since it's init that's responsible for loading the SELinux policy. There are so many other things that can be messed with like memory layout and the IOMMU though, and there has never been any real attempt to make the kernel line untrusted. There was a more serious effort to start the process of not trusting *module* parameters which makes more sense but is just *barely* a meaningful defense in depth mechanism, not some critical part of enforcing a meaningful security boundary and not something that's sensible to tie to verified boot. It's a false connection being drawn between unrelated features, due to a desperate attempt to give a totally incomplete implementation of verified boot some meaning.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726028/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor726246"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 22, 2017 17:38 UTC (Thu)
                               by <b>pjones</b> (subscriber, #31722)
                              [<a href="/Articles/726246/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;&gt; Is this bug a potential secure-boot bypass?</font><br>
&gt;<br>
<font class="QuotedText">&gt; Nope, regardless of people misrepresenting it as such, that doesn't</font><br>
<font class="QuotedText">&gt; change that it's not. No bugs are required to take control of everything</font><br>
<font class="QuotedText">&gt; via the kernel line, and that includes kernel code execution.</font><br>
<p>
In the Secure Boot context, this doesn't happen to be the case.  The intent is that when SB is enabled, all command line options that would give you a mechanism to break out and effectively use the loaded OS as a bootloader for an untrusted kernel are disabled.<br>
<p>
Since this potentially allows arbitrary untrusted code execution from the kernel's privilege level, it's a real vuln in the context of the Secure Boot threat model. From a practical point of view, that means you can use it to build and install a bootkit that persists across OS reinstalls. So yes, it really is a potential Secure Boot bypass, and yes it does actually matter for normal deployment of normal systems.<br>
<p>
<font class="QuotedText">&gt; This doesn't mean anything if even init wasn't verified. There's</font><br>
<font class="QuotedText">&gt; not really anything further to compromise. If the kernel contains</font><br>
<font class="QuotedText">&gt; root with SELinux or whatever else, then protecting the kernel</font><br>
<font class="QuotedText">&gt; from root has value. I'm not sure what the connection is to</font><br>
<font class="QuotedText">&gt; secure / verified boot though.</font><br>
<p>
What Secure Boot is giving you is the ability to recover from being rooted by an attacker who's actually moderately competent.  This bypasses our ability to ensure that, because you can run untrusted kernel code, and therefore you can use a signed bootloader+kernel to launch untrusted kernel code. You can effectively organize that code as a bootloader for what looks like a normal OS, except with a loader that modifies whatever it wants however it wants. With fairly minimal effort, this means a perpetual back door that remains open across kernel upgrades. With a little more effort you can make that continue being true when you boot new install media.<br>
<p>
There are several different ways you can accomplish that, some more insidious than others, and there are various bells and whistles that are more effort on top of that, including how hard you want to hide that you're doing it. But those are bells and whistles.  Basic exploits of this type have been seen in the wild, and these are what Secure Boot prevents.  And talks at security conferences now regularly include methods to do all of this, with the stipulation that Secure Boot must be disabled.  This bug gives you a mechanism to build it again with Secure Boot enabled. That's what this has to do with Secure Boot.<br>
<p>
What it has to do with "verified boot" or "trusted boot" is nothing at all.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726246/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726250"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 22, 2017 18:00 UTC (Thu)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726250/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; In the Secure Boot context, this doesn't happen to be the case. </font><br>
<p>
Not what secure boot means. You're trying to push a redefinition of a term into one being pushed to market a meaningless non-security feature. Other vendors understand what secure / verified boot actually means:<br>
<p>
<a href="https://www.qualcomm.com/media/documents/files/secure-boot-and-image-authentication-technical-overview.pdf">https://www.qualcomm.com/media/documents/files/secure-boo...</a><br>
<p>
"Secure boot is defined as a boot sequence in which each software image to be executed is authenticated by software that was previously verified"<br>
<p>
Note they don't try to change the definition of a feature implemented across many architectures / platforms.<br>
<p>
<font class="QuotedText">&gt; Since this potentially allows arbitrary untrusted code execution from the kernel's privilege level, it's a real vuln in the context of the Secure Boot threat model.</font><br>
<p>
Not a meaningful threat model and not what secure boot means.<br>
<p>
<font class="QuotedText">&gt; So yes, it really is a potential Secure Boot bypass, and yes it does actually matter for normal deployment of normal systems.</font><br>
<p>
Nope, not a bypass, and nope, you haven't given one example of how it matters.<br>
<p>
<font class="QuotedText">&gt; From a practical point of view, that means you can use it to build and install a bootkit that persists across OS reinstalls. </font><br>
<p>
If the persistent kernel line isn't verified... which is a thoroughly broken implementation of secure / verified boot.<br>
<p>
<font class="QuotedText">&gt; What Secure Boot is giving you is the ability to recover from being rooted by an attacker who's actually moderately competent.</font><br>
<p>
A more complete implementation of secure / verified boot covering the OS makes persistence as root more difficult. Not verifying any of userspace does not.<br>
<p>
<font class="QuotedText">&gt; You can effectively organize that code as a bootloader for what looks like a normal OS, except with a loader that modifies whatever it wants however it wants. With fairly minimal effort, this means a perpetual back door that remains open across kernel upgrades. With a little more effort you can make that continue being true when you boot new install media.</font><br>
<p>
You can still do exactly this if userspace isn't verified. No value is provided for this threat model that you're describing without verifying any of userspace.<br>
<p>
<font class="QuotedText">&gt; There are several different ways you can accomplish that, some more insidious than others, and there are various bells and whistles that are more effort on top of that, including how hard you want to hide that you're doing it. But those are bells and whistles. Basic exploits of this type have been seen in the wild, and these are what Secure Boot prevents. And talks at security conferences now regularly include methods to do all of this, with the stipulation that Secure Boot must be disabled. This bug gives you a mechanism to build it again with Secure Boot enabled. That's what this has to do with Secure Boot.</font><br>
<p>
Nope, you're totally wrong. Maybe you should learn some security basics before trying to explain things in a condescending to someone that has a far better grasp on it than you do. If you read what I and other people had written about it, you already would have learned why your view on it isn't correct. Not sure why you're responding without reading first.<br>
<p>
<font class="QuotedText">&gt; What it has to do with "verified boot" or "trusted boot" is nothing at all.</font><br>
<p>
Secure boot and verified boot are synonyms. You're trying to redefine a long lived industry term to include an orthogonal feature not directly related to it, and to reduce the scope to a nearly worthless implementation. If you want to have a new term for your company's attempt at security features, make a new term for it without a widespread existing definition.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726250/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726262"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 22, 2017 19:53 UTC (Thu)
                               by <b>pjones</b> (subscriber, #31722)
                              [<a href="/Articles/726262/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Not what secure boot means. You're trying to push a redefinition</font><br>
<font class="QuotedText">&gt; of a term into one being pushed to market a meaningless non-security</font><br>
<font class="QuotedText">&gt; feature. Other vendors understand what secure / verified boot</font><br>
<font class="QuotedText">&gt; actually means: &lt;2016 qualcomm presentation url here&gt;</font><br>
<p>
I'm sorry that Qualcomm has tricked you, with this 2016 presentation, into thinking when others are talking about Secure Boot they mean some generic concept.  I do not, and neither do others in the quoted article and thread that you seem to so vehemently believe are wrong about (apparently) everything.<br>
<p>
The rest of us are having a discussion about the "Secure Boot" term that has been used by basically all the client and server system firmware and bootloader developers across many OSes and companies to refer to one single feature and the ecosystem around it, and that feature has been deployed and supported for *years* now. If you want there to be some generic version that has some more generalized or more hardcore feature set, be my guest, but call it something else if you want people to understand you. Likewise, others likely will not speak in your own personal argot to describe the world they're in.<br>
<p>
You can feel free to keep saying otherwise, but it just makes communication with you more difficult.  That plus a persistent tone of "no no you're all wrong and biased against me" makes for a quite convincing rhetorical style.<br>
<p>
<font class="QuotedText">&gt; If you read what I and other people had written about it, you already</font><br>
<font class="QuotedText">&gt; would have learned why your view on it isn't correct.</font><br>
<p>
Not the case. Suffice it to say that as somebody who has spent much time working on these issues, in open source code where everyone can see, I do not agree with your point of view, and find your arguments against what we've done utterly uncompelling in light of a very simple fact: it prevents the actual exploits in the wild.<br>
<p>
With that said, and since I see that Florian and Kurt already tried to explain this to you, and you simply refused to listen to anything they said, I think we're done talking.  You're clearly not ready to have a civil discussion or try to understand anyone else's point of view, much less the actual technical details.<br>
<p>
<font class="QuotedText">&gt; Not sure why you're responding without reading first.</font><br>
<p>
Same.  Have a nice life.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726262/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726267"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 22, 2017 20:06 UTC (Thu)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726267/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I'm sorry that Qualcomm has tricked you, with this 2016 presentation, into thinking when others are talking about Secure Boot they mean some generic concept. I do not, and neither do others in the quoted article and thread that you seem to so vehemently believe are wrong about (apparently) everything.</font><br>
<p>
If you want much older documentation with vendors using the term secure boot... you can have that.<br>
<p>
<font class="QuotedText">&gt; The rest of us are having a discussion about the "Secure Boot" term that has been used by basically all the client and server system firmware and bootloader developers across many OSes and companies to refer to one single feature and the ecosystem around it, and that feature has been deployed and supported for *years* now. If you want there to be some generic version that has some more generalized or more hardcore feature set, be my guest, but call it something else if you want people to understand you. Likewise, others likely will not speak in your own personal argot to describe the world they're in.</font><br>
<p>
You're the one using a generic term in a niche way. How much market share does desktop Linux have? And by the way, not all desktop and server distributions are interested in an incomplete implementation of secure / verified boot or redefining the term that way.<br>
<p>
<font class="QuotedText">&gt; Not the case. Suffice it to say that as somebody who has spent much time working on these issues, in open source code where everyone can see, I do not agree with your point of view, and find your arguments against what we've done utterly uncompelling in light of a very simple fact: it prevents the actual exploits in the wild.</font><br>
<p>
It is the case. You're stuck in the bubble of cargo cult security land with apparently no experience with systems using meaningful verified boot which are far more common than the entirety of desktop Linux.<br>
<p>
It doesn't prevent actual exploits, and you've been unable to provide any example of that. You made a false claim that this level of incomplete secure / verified boot implementation prevented making a rootkit hiding itself from the rest of the OS.<br>
<p>
<font class="QuotedText">&gt; With that said, and since I see that Florian and Kurt already tried to explain this to you, and you simply refused to listen to anything they said, I think we're done talking. You're clearly not ready to have a civil discussion or try to understand anyone else's point of view, much less the actual technical details.</font><br>
<p>
You're only interested in pushing marketing drivel and cargo cult security. They didn't try to explain anything. All of you have refused to engage in a technical discussion. You only make arguments from authority and inaccurate claims that you cannot defend.<br>
<p>
<font class="QuotedText">&gt; Same. Have a nice life.</font><br>
<p>
Have a nice time keeping the information security industry dishonest.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726267/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor726268"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 22, 2017 20:15 UTC (Thu)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726268/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I'm sorry that Qualcomm has tricked you, with this 2016 presentation, into thinking when others are talking about Secure Boot they mean some generic concept. I do not, and neither do others in the quoted article and thread that you seem to so vehemently believe are wrong about (apparently) everything.</font><br>
<p>
Here's a data sheet talking about Qualcomm Secure Boot from 2007, if it makes you happier. If you'd like, I can give you documentation from multiple vendors from even earlier.<br>
<p>
<a href="https://www.mobileread.com/forums/attachment.php?attachmentid=147810&amp;d=1460580132">https://www.mobileread.com/forums/attachment.php?attachme...</a><br>
<p>
I'm quite familiar with what desktop Linux distributions are doing, but I don't live in a bubble where those are the only secure / verified boot implementations and they don't get to define generic terms. Elsewhere, there are meaningful implementations that have been shipping for a long time and cover not only the firmware, bootloaders and kernel but also userspace. In the case of iOS, beyond that, but in a weaker way. You would have known that if you had read what I wrote.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726268/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor726035"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 20, 2017 23:39 UTC (Tue)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726035/">Link</a>] (22 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Since a proper verified boot implementation (which is more than verifying the boot chain and kernel) can be done *without* taking away control the user at runtime, it's not just dubious to tie them together but actively harmful since it needlessly makes a great security feature less practical by forcing it to be used with another feature...<br>
<p>
I really don't see the logic here. The purpose of verified boot is to prevent an attacker from persisting privileged code / trusted data (forcing them to exploit the OS again) or even persisting any code and non-user-configuration/data at all. It also improves physical physical security by doing that as a secondary benefit, particularly if authenticated encryption is used for all user data. It can do that without restricting uncontained root. It can do that alongside that feature too, and there's a bit of synergy there, but it's not particularly strongly connected...<br>
<p>
It would have been nice to have a fair and well researched article on this. Unfortunately, a decision was made to push a point of view and leave out entire aspects of the story. Not why I subscribed to lwn. You make it seem like I'm arguing against verified boot being useful when really the context that I'm coming from is that verified boot is important and can and should be properly implemented as done on Android, ChromeOS, CoreOS, etc.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726035/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726036"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 0:32 UTC (Wed)
                               by <b>walters</b> (subscriber, #7396)
                              [<a href="/Articles/726036/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I recently wrote a blog on this topic: <a href="https://blog.verbum.org/2017/06/12/on-dm-verity-and-operating-systems/">https://blog.verbum.org/2017/06/12/on-dm-verity-and-opera...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726036/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726037"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 0:52 UTC (Wed)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726037/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
FWIW, iOS style third party code signing could be used even with the ability to install third party apps. Android has app code signing but doesn't force everything to have an extra Google signature, but a variant of Android could technically do that, i.e. manual approval for third party apps. It doesn't mean that much on iOS since there are ways to bypass it and the review is very superficial, but it can be done better.<br>
<p>
Another issue with code Android is /data/dalvik-cache, since if there's non-preoptimized app code it gets dynamically compiled and used from there. CopperheadOS deals with by preoptimizing all the base system app code / system_server / frameworks and updating it all as part of over-the-air OS updates rather than relying on out-of-band app updates (alongside fully disabling JIT compilation to use full AOT compilation, but that's not related to verified boot). That lets it fully disable execution from /data for the base system without a performance hit (similarly, dynamic code generation / execution in memory and via the file system is disallowed, but that's less tied to verified boot).<br>
<p>
There's a lot of trust in the userdata partition for things that are *not* code too, like cached package manager data tracking some properties about installed apps. Introducing verified boot to an existing system is a whole process. For Android, it's useful already, but it's not as powerful as it seems (for now).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726037/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor726038"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 0:49 UTC (Wed)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/726038/">Link</a>] (19 responses)
      </p>
      
      </div>
      </summary>
      I'm not quite sure what point of view you think the article pushes.  The thesis here, which I helped the author express, is based on the clear facts that (1) the developers who have actually done the work to implement secure boot on Linux believe that the system software must remain in control at all times, and (2) command-line and module parameters that could be used to defeat that control must be disabled.  Given that mindset, this bug must be seen as a security bug.  If certain command-line parameters are not safe even for the root user, then certainly a trivial memory-overwrite bug based on command-line parameters cannot be safe.
<p>
You don't have to believe that mindset.  I don't run locked-down kernels on my systems.  But developers whose opinion matters <i>do</i> believe that.  I cannot grasp the concept that reporting on this is to "leave out entire aspects of the story".  This is a story about a command-line parsing bug...
      
          <div class="CommentReplyButton">
            <form action="/Articles/726038/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726039"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 1:03 UTC (Wed)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726039/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; is based on the clear facts</font><br>
<p>
Those aren't clear facts, they're a distortion of reality. You're making claims and refusing to justify them.<br>
<p>
<font class="QuotedText">&gt; the developers who have actually done the work to implement secure boot on Linux believe that the system software must remain in control at all times</font><br>
<p>
So all you have is an argument from authority and the implication that I am not a developer that has worked on verified boot, which is completely false. Distributions like Fedora don't currently have a meaningful secure / verified boot implementation. Unlike others, they haven't done the work to ship the feature.<br>
<p>
The developers that have actually done the work to implement meaningful secure boot on Linux (i.e. Google and others) don't use this cargo cult definition of it.<br>
<p>
<font class="QuotedText">&gt; command-line and module parameters that could be used to defeat that control must be disabled</font><br>
<p>
They still can be with every single one of these bugs fixed.<br>
<p>
<font class="QuotedText">&gt; Given that mindset, this bug must be seen as a security bug.</font><br>
<p>
The logic doesn't follow. It's only a security bug if a meaningful security feature / security boundary is bypassed. In order for that to matter, there would need to be a more complete verified boot implementation and the kernel line would need to be untrusted. The Linux kernel considers it ultimately trusted. There is no code anywhere to change that. The referenced changes about module parameters, etc. do not change that.<br>
<p>
<font class="QuotedText">&gt; You don't have to believe that mindset. I don't run locked-down kernels on my systems. But developers whose opinion matters do believe that. I cannot grasp the concept that reporting on this is to "leave out entire aspects of the story". This is a story about a command-line parsing bug...</font><br>
<p>
<p>
Okay, just an argument from authority then, and no willingness to actually address the issues pointed out with this reasoning.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726039/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726057"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 7:24 UTC (Wed)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/726057/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You're right but you talk too much; so people stop paying attention. <br>
<p>
A picture is worth thousand words. This type of CVE has been pictured many times already. Just re-share one of these pictures and spend your time more productively: <a href="https://www.google.com/search?q=security+gate+fail&amp;tbm=isch">https://www.google.com/search?q=security+gate+fail&amp;tb...</a><br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726057/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor726074"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 12:57 UTC (Wed)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/726074/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      No argument from authority.  Just a simple statement that a point of view exists and is reasonably widely held, and that, <i>from that point of view</i>, this bug is a security issue.
<p>
I understand that you disagree with that point of view.  I have not stated my own position with regard to it, so you do not know where I am coming from.  Neither of us knows what the author of the article believes.  But the fact that "thestinger" reacts like a battered beehive when that point of view is expressed does not make it — or the disagreement over whether this is a security bug ­— go away.
      
          <div class="CommentReplyButton">
            <form action="/Articles/726074/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726076"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 13:14 UTC (Wed)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726076/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; No argument from authority</font><br>
<p>
That's *exactly* what you were doing.<br>
<p>
<font class="QuotedText">&gt; is reasonably widely held</font><br>
<p>
I'm sure where you're getting that data from. It's a very small minority opinion based on off-list talk about it, and there aren't people willing to stand behind it and lay out a justification beyond vague claims.<br>
<p>
<font class="QuotedText">&gt; Neither of us knows what the author of the article believes</font><br>
<p>
The article presents a case and cherry picks supporting information. A security researcher at Google pointed me to it and referred to it as "highly opinionated".<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726076/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726136"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 18:48 UTC (Wed)
                               by <b>rahvin</b> (guest, #16953)
                              [<a href="/Articles/726136/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If those opinions are the ones held by the kernel development team responsible for these features and this discussion is limited to linux than it really doesn't matter what anyone else thinks because the people in charge are the ones that are going to make the decision. <br>
<p>
You're attacking the article for simply reporting that. You're free to disagree and you're still free to try to convince those developers of the error of their ways. None of this changes the fact that the people with control believe a certain way, the article itself makes no claim of whether that's the right path, only that the people in charge believe it is. <br>
<p>
In summary, stop attacking the reporting. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726136/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726176"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 22, 2017 5:28 UTC (Thu)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726176/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; If those opinions are the ones held by the kernel development team responsible for these features and this discussion is limited to linux than it really doesn't matter what anyone else thinks because the people in charge are the ones that are going to make the decision. </font><br>
<p>
They aren't opinions held by kernel developers.<br>
<p>
<font class="QuotedText">&gt; You're attacking the article for simply reporting that. You're free to disagree and you're still free to try to convince those developers of the error of their ways. None of this changes the fact that the people with control believe a certain way, the article itself makes no claim of whether that's the right path, only that the people in charge believe it is. </font><br>
<p>
People in charge of kernel development weren't involved.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726176/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor726040"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 1:15 UTC (Wed)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726040/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I cannot grasp the concept that reporting on this is to "leave out entire aspects of the story". This is a story about a command-line parsing bug...</font><br>
<p>
You might not be able to grasp it, but the article misrepresents my position and reasoning about the issue via omission. It presents it as if I'm arguing against secure / verified boot, and in fact that's the opposite of what's happening. Luckily I can comment here to correct the record about what I said.<br>
<p>
I'm arguing for using critical thinking about whether there's a security impact and the response to that only seems to be making an argument from authority / tradition and pushing a definition of 'secure boot' with the scope narrowed to exactly the current state of the implementation in Fedora / RHEL rather than the reality which is that the feature has a whole scale of possible implementations and the one that's present there is not yet a valuable security feature.<br>
<p>
I'm happy to listen to an explanation of some setup where this could actually have a security impact. I've yet to see that. No attempt was made to present a scenario where it matters. I don't think there is one. I can certainly imagine a theoretical scenario involving code and a distribution that doesn't currently exist... but it requires truly treating the kernel line as untrusted and verifying at least a portion of userspace. If that was truly implemented, this would be a vulnerability in the system doing that. It still wouldn't be a vulnerability in the mainline Linux kernel itself since that would be a bunch of out-of-tree code...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726040/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor726042"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 2:10 UTC (Wed)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726042/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There's a whole spectrum of secure / verified boot:<br>
<p>
1) nothing<br>
2) firmware<br>
3) firmware / bootloaders<br>
4) firmware / bootloaders / kernel<br>
<p>
This is where the distributions being talked about are. I don't think it provides any substantial security properties. Maybe I'm missing something, and if so I'd like to know what...<br>
<p>
5) firmware / bootloaders / kernel / base OS<br>
<p>
This is where it starts becoming useful. At the very least, it's possible to get guarantees like an Android factory reset being guaranteed to wipe away any malware unless verified boot is exploited. That's the primary guaranteed offered by non-hardened Android: all of the fanciness of the hardware root of trust, the late stage bootloader verifying the kernel and the kernel verifying the entire base OS pretty much just adds up to hardened factory resets when done via booting directly into recovery rather than doing it from the OS.<br>
<p>
6) firmware / bootloaders / kernel / base OS / privileged code<br>
<p>
Now an attacker needs to exploit the OS after a reboot to get back privileged code execution.  Can consider this to be granular, since they may be able to persist code with some privileges but not others. At the very least it needs to protect enough code to provide some kind of useful security model despite an attacker controlling all of the unverified state.<br>
<p>
7) firmware / bootloaders / kernel / base OS / privileged code / data trusted by privileged code<br>
<p>
This is iOS, ChromeOS and where Android strives to be, but Android places a lot more trust in persistent state than iOS and ChromeOS. So you could consider Android to be here, but an attacker has so much control via /data/dalvik-cache, etc. They control system_server and privileged apps. That's one of the things CopperheadOS currently fixes to make verified boot stronger, but there's a lot more that can be done.<br>
<p>
8) firmware / bootloaders / kernel / base OS / privileged code / data trusted by privileged code / all code<br>
<p>
iOS is close to being here, but they only do cursory review of the third party code they're signing. It's not same thing as a system where only code from a trusted party is signed.<br>
<p>
9) firmware / bootloaders / kernel / base OS / privileged code / data trusted by privileged code / all code / all data trusted by code<br>
<p>
This would be ChromeOS if it didn't have extensions, apps and Android app support.<br>
<p>
10) everything (no persistent state)<br>
<p>
The ideal is of course not having any persistent state. Everything verified, no way for an attacker to maintain a presence without exploiting the verified boot implementation.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726042/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726043"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 2:20 UTC (Wed)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726043/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; 2) firmware</font><br>
<p>
This can provide value if there's a Trusted Execution Environment with either dedicated storage and/or hardware-bound keys accessible to it but not the OS. It protects data stored there even if the attacker gets control over the OS. It's just that jumping to 3 or 4 but not any further doesn't really add anything compelling...<br>
<p>
<font class="QuotedText">&gt; 4) firmware / bootloaders / kernel</font><br>
<p>
And "kernel" includes verifying the kernel line... unless you make it fully untrusted. It doesn't include protecting the kernel from the OS. That's not really part of verified boot.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726043/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726045"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 2:25 UTC (Wed)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726045/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  It doesn't include protecting the kernel from the OS. That's not really part of verified boot.</font><br>
<p>
At least in the lines below where init and SELinux policies, etc. are verified and cannot be disabled, so protection of the kernel happens via userspace, which must be verified regardless to guarantee anything useful...<br>
<p>
Anyway, it all seems pretty clear to me. I don't see what's missed. Not going to bother trying to explain it further though. I already stated on this on the list and it was just ignored here, so what's the point?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726045/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor726054"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 7:04 UTC (Wed)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/726054/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; This would be ChromeOS if it didn't have extensions, apps and Android app support.</font><br>
<p>
ChromeOS is perfectly usable (and being used) without any of these.<br>
<p>
Granted: leaving security in the hands of the end user is foolish&lt;/troll&gt; but hey, even with this caveat it's still very "real".<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726054/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726056"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 7:07 UTC (Wed)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726056/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; ChromeOS is perfectly usable (and being used) without any of these.</font><br>
<p>
It's certainly usable without them, but since it supports them the verified boot implementation is weakened to support them whether or not you use those features. The user having no extensions is something that depends on persistent state.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726056/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726060"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 7:27 UTC (Wed)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/726060/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Can you elaborate, an example of an attack relying on this "weakening" maybe?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726060/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726061"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 7:36 UTC (Wed)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726061/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The context is the strength of verified boot, which verifies the OS but not persistent state. If an attacker gets root (RCE + LPE) they can modify any persistent state so anything that can be in persistent state (apps, extensions, settings, user media files) is something they can use to persist past a reboot despite verified boot. Since ChromeOS permits unprivileged non OS code, an attacker can persist via that code without a verified boot bypass and then reuse another LPE exploit. If it didn't support extensions and especially the new less well contained Android app support (outside the strong browser renderer sandbox), an attacker couldn't permit code without exploiting verified boot. Alternatively, they could get persistence with something like a persistent media file exploiting something like a thumbnail generation service.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726061/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726062"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 7:37 UTC (Wed)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726062/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; couldn't permit code</font><br>
<p>
s/permit/persist/<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726062/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor726064"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 7:56 UTC (Wed)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/726064/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Pretty sure the persistent partition has existed since the beginning to support user files; it didn't "appear and weaken" the system later.<br>
<p>
So, sorry but I still can't see any security difference between the original ChromeOS design versus the current design used by a paranoid user who says away from apps etc. I'm not saying a persistent partition is good, I'm merely saying the design wasn't weakened by apps unless you use some.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726064/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726065"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 8:02 UTC (Wed)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726065/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; paranoid user who says away from apps</font><br>
<p>
The topic is verified boot, not users exposing themselves to additional attack surface by using new features. In terms of impact on verified boot security, it doesn't matter whether you use the features. It only matters that the verified OS code supports those features via the persistent state. It doesn't support persistent privileged code (i.e. the persistent state is not trusted much) which is why it has a good / useful verified boot implementation, but not a fantastic one.<br>
<p>
Look back at the context:<br>
<p>
<font class="QuotedText">&gt; 9) firmware / bootloaders / kernel / base OS / privileged code / data trusted by privileged code / all code / all data trusted by code</font><br>
<font class="QuotedText">&gt; This would be ChromeOS if it didn't have extensions, apps and Android app support.</font><br>
<p>
I only stated that it would be a stronger implementation of verified boot without any persistent code.<br>
<p>
Persistent data without supporting persistent code would mean an attacker's persistence mechanism doesn't start off with (sandboxed) code execution.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726065/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor726205"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 22, 2017 13:22 UTC (Thu)
                               by <b>walters</b> (subscriber, #7396)
                              [<a href="/Articles/726205/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think what @thestinger is getting at here is that if someone achieved e.g. RCE on ChromeOS, they'd be able to install (malicious) extensions or apps, and those would persist.   These persistent extensions/apps can have greater privileges than was possible on the original ChromeOS that simply didn't have that functionality.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726205/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726206"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 22, 2017 13:36 UTC (Thu)
                               by <b>thestinger</b> (guest, #91827)
                              [<a href="/Articles/726206/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Since the attacker gained root with RCE + LPE, they control all of the persistent OS state. On Android, they can persist via /data/dalvik-cache which provides code execution as system_server and base system apps with special privileges granted via being located in /system/priv-app or their signatures. CopperheadOS disables /data/dalvik-cache usage for code and instead uses full pre-compilation for all of the base system. An attacker can still persist via a regular unprivileged app and they can grant their app all of the privileges available to third party apps including those that require explicit user consent. They aren't limited to regular permissions, since they can also make it an accessibility service and a device manager. There's also a lot of other highly trusted OS state. The intention in CopperheadOS is to chip away at all of that.<br>
<p>
The unfortunate reality of verified boot is that you can't improve it via settings. There cannot simply be a setting to disable attack surface or to implement more user control because an attacker that has gained root access can change any setting, install any app, grant any dynamic privilege that's possible to set for third party code, etc.<br>
<p>
Now that ChromeOS is gaining Android app support (currently in the Beta channel), that all applies to ChromeOS within the Android userspace container. An attacker would need a kernel exploit to get at the non-Android OS, but they'll have control as system_server since it's just standard Android with /data/dalvik-cache and that gives them a huge amount of attack surface since it's near root (in this case, user namespace root, but that still exposes most kernel attack surface).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726206/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor726067"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 10:11 UTC (Wed)
                               by <b>cpitrat</b> (subscriber, #116459)
                              [<a href="/Articles/726067/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It looks like some parts of the kernel would benefit from unit testing ! All the code that doesn't interact with hardware (like implementations of lists, trees, string methods ... that's a lot of code in the end) could easily be unit tested and should have 100% coverage.<br>
<p>
Moreover, static analysis is able to detect unused parameter which would have highlighted this bug.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726067/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726085"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 14:12 UTC (Wed)
                               by <b>gregkh</b> (subscriber, #8)
                              [<a href="/Articles/726085/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What type of static analysis rule would have caught this issue?  If you know of one, please write it so we can ensure it never happens again.<br>
<p>
Also, unit tests are great to have we gladly accept patches that add them.  Some code, like the resource management logic, does have them, and they are invaluable in testing changes in those areas of the kernel.  Please send us more!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726085/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726088"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 14:31 UTC (Wed)
                               by <b>cplaplante</b> (subscriber, #107196)
                              [<a href="/Articles/726088/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I am somewhat surprised that Coverity didn't catch this - <a href="https://scan.coverity.com/projects/linux">https://scan.coverity.com/projects/linux</a>. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726088/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor726082"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 14:10 UTC (Wed)
                               by <b>gregkh</b> (subscriber, #8)
                              [<a href="/Articles/726082/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Note, I want this patch to be merged, and asked the author to submit it properly, they way any other kernel patch needs to be submitted.  They never did so from what I could tell, which is why it never got merged :(<br>
<p>
Maybe someone has the time to pick it up and do this for them?  I know I don't at the moment...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726082/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor726095"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 15:18 UTC (Wed)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/726095/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I sent it to Andrew and it's in -mm now.
      
          <div class="CommentReplyButton">
            <form action="/Articles/726095/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor726115"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Attacking the kernel via its command line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2017 15:53 UTC (Wed)
                               by <b>vegard</b> (subscriber, #52330)
                              [<a href="/Articles/726115/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Bugs still slip in</font><br>
<p>
Understatement of the year ;-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/726115/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2017, Eklektix, Inc.<BR>
            
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
