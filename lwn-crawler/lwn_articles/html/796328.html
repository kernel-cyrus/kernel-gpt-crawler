        <!DOCTYPE html>
        <html lang="en">
        <head><title>Reconsidering unprivileged BPF [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/796328/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/796319/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/796328/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Reconsidering unprivileged BPF</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>August 16, 2019</br>
           </div>
The BPF virtual machine within the kernel has seen a great deal of work
over the last few years; as that has happened, its use has expanded to many
different kernel subsystems.  One of the objectives of that work in the
past has been 
to make it safe to allow unprivileged users to load at least some types of
BPF programs into the kernel.  A recent discussion has made it clear,
though, that the goal of opening up BPF to unprivileged users has been
abandoned as unachievable, and that further work in that direction will not
be accepted by 
the BPF maintainer.
<p>
The BPF verifier goes to great lengths to ensure that any BPF program
presented to the kernel is safe to run.  Memory accesses are checked,
execution is simulated to ensure that the program will terminate in a
bounded period of time, and so on.  Many of these checks are useful to
ensure that all programs are safe and free of certain types of bugs, but
others are aimed specifically at containing a 
potentially hostile program â€” an obvious necessity if the kernel is to
accept BPF programs from unprivileged users.
<p>
Much of this work was <a href="/Articles/660331/">done in 2015</a> for the
4.4 kernel; in particular, a great deal of effort went into preventing BPF
programs from leaking kernel pointer values to user space.  Those pointers
could be highly useful to an attacker who is trying to figure out where
specific data structures or code are to be found on a target system, so
making them easily available to unprivileged processes is clearly a bad
idea.  "<a href="https://git.kernel.org/linus/4f3446bb809f">Constant
blinding</a>" was added for 4.7.  In essence, this mechanism will
exclusive-OR constant values in programs with a random number (repeating
the operation at run time when the values are actually used), preventing
an attacker from sneaking in unverified BPF code disguised as
constants.  Other patches have been aimed at preventing
speculative-execution attacks by BPF programs.
<p>
After all that work, though, there is still only one place where unprivileged
users can, administrator willing, load BPF programs: as filters on open
sockets.  In 2015, BPF maintainer Alexei Starovoitov <a
href="/Articles/660080/">declared</a> that "<q>I think it is time to
liberate eBPF from CAP_SYS_ADMIN</q>".  Nearly four years later, that
has not happened, and the work that has been done more recently has been
focused instead on 
giving administrators more control over who can load BPF programs; see the
(unmerged) <a href="/Articles/792124/"><tt>/dev/bpf</tt> effort</a> for one
example.
<p>
While Starovoitov has stopped working on unprivileged BPF, others have
still been putting some thought in that direction.  Andy Lutomirski
recently <a
href="/ml/linux-kernel/cover.1565040372.git.luto@kernel.org/">posted a set
of patches</a> intended to make BPF a bit more suitable for this use case.
It implements access permissions for BPF maps, adds a way to mark specific BPF
functions as requiring privilege, and allows the loading of all
types of programs by unprivileged users.  "<q>This doesn't let you *run*
the programs except in test mode, so it should be safe.  Famous last
words.</q>"  These patches have received no comments.
<p>
In the ongoing discussion about the <tt>/dev/bpf</tt> work, though,
Starovoitov made the perhaps surprising <a
href="/ml/netdev/20190806011134.p5baub5l3t5fkmou@ast-mbp/">statement</a>
that "<q>unprivileged bpf is actually something that can be
deprecated</q>".  Lutomirski, unsurprisingly, <a
href="/ml/netdev/CALCETrXEHL3+NAY6P6vUj7Pvd9ZpZsYC6VCLXOaNxb90a_POGw@mail.gmail.com/">didn't
like that idea</a>:
<p>
<div class="BigQuote">
	I hope not.  There are a couple setsockopt uses right now, and and
	seccomp will surely want it someday.  And the bpf-inside-container
	use case really is unprivileged bpf -- containers are, in many
	(most?)  cases, explicitly not trusted by the host.
</div>
<p>
Starovoitov <a
href="/ml/netdev/20190813215823.3sfbakzzjjykyng2@ast-mbp/">responded</a>
that "<q>Linux has become a single-user system</q>" where anybody who
can run any code at all can break out of containment and obtain root
privileges.  The whole idea of unprivileged BPF, he said, has been a
mistake:
<p>
<div class="BigQuote">
	When we say 'unprivileged bpf' we really mean arbitrary malicious
	bpf program.  It's been a constant source of pain. The constant
	blinding, randomization, verifier speculative analysis, all spectre
	v1, v2, v4 mitigations are simply not worth it. It's a lot of
	complex kernel code without users.  There is not a single use case
	to allow arbitrary malicious bpf program to be loaded and executed.
</div>
<p>
Lutomirski <a
href="/ml/netdev/CALCETrUkqUprujww26VxHwkdXQ3DWJH8nnL2VBYpK2EU0oX_YA@mail.gmail.com/">responded</a>
(more than once) that some use cases do exist.  He mentioned
<tt>seccomp()</tt>, which still uses the old "classic BPF" language rather
than the "extended BPF" that has been the target of development work in
recent years; there are developers now who would like to have extended BPF
features available in <tt>seccomp()</tt> filters.  Per-user systemd
instances are another example; systemd makes use of BPF now and
could benefit from making that functionality available to unprivileged
users as well.  There might well be others if the kernel were able to
support them, he said: "<q>There aren't major
unprivileged eBPF users because the kernel support isn't there</q>".
<p>
Starovoitov <a
href="/ml/netdev/20190814220545.co5pucyo5jk3weiv@ast-mbp.dhcp.thefacebook.com/">made
it clear</a> that he was not impressed, though: "<q>I'm afraid these
proposals won't go anywhere</q>".  He reiterated his claim that there
are no known use cases for unprivileged BPF.  What he would like to see,
instead, is "less privileged BPF" where, for example, a process could be
given a new <tt>CAP_BPF</tt> capability (or access to a <tt>/dev/bpf</tt>
file) that would allow the loading of BPF programs without opening the door
to other privileged operations.  That, he said, would improve the safety of
applications that actually exist without the need to expend effort
supporting the unprivileged use case which, he claims, does not exist.
<p>
And that is the impasse at which the conversation stands now.  At its core,
it's a fundamental difference of opinion over whether a Linux system can
ever be truly hardened against an unprivileged user.  If the answer is
"no", then there is little point in maintaining a lot of complex code in
the BPF subsystem to try to effect that hardening.  Accepting that answer,
though, is tantamount to saying that the Linux privilege model just doesn't
work in the end: the combination of software bugs and hardware
vulnerabilities will always undermine it, so we might as well just give up.
That would be a discouraging 
conclusion to say the least.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#BPF-Unprivileged">BPF/Unprivileged</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Linux_kernel-BPF">Linux kernel/BPF</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/796328/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor796470"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 16, 2019 16:15 UTC (Fri)
                               by <b>quotemstr</b> (subscriber, #45331)
                              [<a href="/Articles/796470/">Link</a>] (35 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The sort of sweeping and unsupported declarations one sees here are not productive in the context of the development of a general-purpose kernel used by a variety of projects in very different ways. In particular, it's *obviously* not true that Linux is a "single-user system", and asserting that there are "no" use cases for unprivileged BPF is an argument from personal incredulity. Something has gone wrong when individuals can block progress on the basis of such easily falsified misapprehensions.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796470/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796488"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 16, 2019 20:23 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796488/">Link</a>] (32 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; In particular, it's *obviously* not true that Linux is a "single-user system"</font><br>
Is it? It's not at all obvious to me. If any user that can run arbitrary code can break out of containment then Linux is not a multiuser system. At best users are just a way to isolate well-meaning code from accidentally breaking unrelated stuff.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796488/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796490"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 16, 2019 20:59 UTC (Fri)
                               by <b>quotemstr</b> (subscriber, #45331)
                              [<a href="/Articles/796490/">Link</a>] (24 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
At least on Android (the OS I hack on), app sandboxes (implemented with user isolation with extra SELinux safeguards) are hard security boundaries, not just nice-to-have guardrails. Any ability for an app to break out of its isolation and affect another app would be a massive security bug. In this sense, Android is definitely a multi-user Linux system. (Android also has a higher-level concept of multiple "profiles" for different human users, but that's not the functionality under discussion.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796490/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796495"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 16, 2019 22:49 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796495/">Link</a>] (23 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Android tries to sandbox apps, but the amount of root exploits is kinda awful. So I'd say it fails here.<br>
<p>
However, Android seems to be coping with this decently well by making the base system integrity harder to breach (dm-verity, tamper eFuses, and so on) so that exploits can't be persistent.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796495/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796503"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 0:21 UTC (Sat)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/796503/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A lot of get-root exploits involve compromising the kernel. Would you advocate stopping trying to enforce the user/kernel security boundary because there have been a lot of compromises there?<br>
<p>
"We have had a lot of bugs enforcing this security boundary, so let's give up" doesn't seem compelling to me as a stand-alone argument.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796503/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796504"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 1:25 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796504/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; A lot of get-root exploits involve compromising the kernel. Would you advocate stopping trying to enforce the user/kernel security boundary because there have been a lot of compromises there?</font><br>
User/kernel boundary helps to prevent accidental crashes caused by well-meaning but malfunctioning applications. So it has value.<br>
<p>
<font class="QuotedText">&gt; "We have had a lot of bugs enforcing this security boundary, so let's give up" doesn't seem compelling to me as a stand-alone argument.</font><br>
It does to me. Linux has been failing since the very beginning to provide an actually secure multi-user environment.<br>
<p>
Instead of trying to patch the leaking dam it makes sense to switch to something different - like micro-VMs, immutable verified base systems, etc.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796504/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796510"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 6:26 UTC (Sat)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/796510/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; User/kernel boundary helps to prevent accidental crashes caused by well-meaning but malfunctioning applications. So it has value.</font><br>
<p>
But you'd be OK with unprivileged kernel module loading, unprivileged write access to /proc/sys/kernel, etc? They won't get triggered accidentally.<br>
<p>
Micro-VMs aren't perfectly secure either. There have been plenty of hypervisor bugs, some hardware-assisted. If the "We have had a lot of bugs enforcing this security boundary, so let's give up" argument works stand-alone, it applies to hypervisors too.<br>
<p>
I think a somewhat stronger argument that's akin to yours is, "it would be most effective to focus on securing the single most favourable containment approach and forget about the rest" and then argue that, say, hypervisors should be that approach. However I think that argument has some big problems too. We really want secure containers to be nestable, so e.g. you can run a Web browser in a container and it can put its content processes into their own containers ... and HVM hypervisors don't nest well. (Seriously, nested VT-x looks like a nightmare and if I was looking for hardware security bugs I'd be all over it.) There's also an argument, which I believe holds sway at Google and elsewhere, that using multiple different containment mechanisms at the same time is very valuable, perhaps because collecting two or more zero-day container escapes at the same time is a lot harder than just finding one.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796510/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796511"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 6:57 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796511/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  But you'd be OK with unprivileged kernel module loading, unprivileged write access to /proc/sys/kernel, etc? They won't get triggered accidentally.</font><br>
Honestly? Yes. Just make it a bit inconvenient to trigger by accident. Heck, it's pretty much what I have right now since I'm using passwordless sudo on my computer.<br>
<p>
<font class="QuotedText">&gt; Micro-VMs aren't perfectly secure either. There have been plenty of hypervisor bugs, some hardware-assisted. </font><br>
There are probably two orders of magnitude less critical hypervisor bugs compared to Linux root exploits. <br>
<p>
And just subjectively, it feels like VMs are a solvable problem. Ultimately a simple VM has a fairly small exposed security perimeter and it can be written in a safe language (see: Firecracker). It's also easier to protect against side-channel leaks by partitioning hardware more rigidly compared to regular Linux. Add to this memory encryption keys and I start to feel pretty confident.<br>
<p>
<font class="QuotedText">&gt; If the "We have had a lot of bugs enforcing this security boundary, so let's give up" argument works stand-alone, it applies to hypervisors too.</font><br>
Correct. It's just that VMs have not yet been proven by practice to be totally hopeless.<br>
<p>
<font class="QuotedText">&gt; I think a somewhat stronger argument that's akin to yours is, "it would be most effective to focus on securing the single most favourable containment approach and forget about the rest" and then argue that, say, hypervisors should be that approach.</font><br>
Not quite. I'm saying that focusing undue amount of resources to make one layer of security slower and more complicated is a bad idea.<br>
<p>
In the context of this article, unprivileged BPF requires a ton of complicated mechanisms that have non-zero maintenance cost to make them safe in the context of a fully-secured kernel having no other vulnerabilities. Except that such kernel doesn't exist. It's kinda like trying to install a bank vault door to protect from home intruders, while leaving windows wide open.<br>
<p>
That's why I like the proposed solution - slap CAP_BPF on /dev/bpf and declare that the mission is accomplished.<br>
<p>
<font class="QuotedText">&gt; We really want secure containers to be nestable, so e.g. you can run a Web browser in a container and it can put its content processes into their own containers ... and HVM hypervisors don't nest well. (Seriously, nested VT-x looks like a nightmare and if I was looking for hardware security bugs I'd be all over it.)</font><br>
Yep. Most cloud computing providers don't offer nesting because of that (I think only Google Cloud started offering it recently). And while nesting would be perfect, it might be enough to give ability for VMs to create sibling VMs. I know that some people are working on standardizing API for just that.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796511/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796512"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 7:13 UTC (Sat)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/796512/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It's just that VMs have not yet been proven by practice to be totally hopeless.</font><br>
<p>
Maybe we just have to disagree on what "hopeless" means.<br>
<p>
To me, if escaping a container means using an expensive zero-day exploit that will likely be detected and patched before it can be used many times, that's actually quite good security, and two such layers is very good security.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796512/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor796537"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 21:15 UTC (Sat)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/796537/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; VM has a fairly small exposed security perimeter and it can be written in a safe language (see: Firecracker). </font><br>
<p>
The userspace part of a VM is usually secured with cgroups, SELinux, namespaces etc. If it uses a safer language than C, then that of course helps, but exploiting a QEMU vulnerability is but the first step. I wouldn't be surprised if any interested big guys didn't even bother and went straight for a KVM or Xen 0day.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796537/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor796553"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2019 8:22 UTC (Sun)
                               by <b>mm7323</b> (subscriber, #87386)
                              [<a href="/Articles/796553/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
And just subjectively, it feels like VMs are a solvable problem. Ultimately a simple VM has a fairly small exposed security perimeter and it can be written in a safe language (see: Firecracker).
</blockquote>
<P>Wasn't that one of the hopes or promises of the JVM?  Strong types, GC memory and a tight sandbox with the majority of the runtime written in Java itself.</p>
<P>And yet we've had plenty of sandbox exploits and escapes over the years.</p>
<P>I guess in future we may hope to have learnt from previous mistakes.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/796553/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796556"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2019 8:45 UTC (Sun)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796556/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
JVM has never been simple. Its sandbox model is also braindead - it's kinda like Unix, you give certain parts of _code_ extra privileges. This code then has to validate the data it gets and do something privileged in turn, with most of permissions being controlled through a coarse-grained model (kinda like capabilities in Linux).<br>
<p>
No wonder it has failed.<br>
<p>
Modern approaches to sandboxes use true capability-based security instead, and so far they are pretty resilient.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796556/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor796521"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 12:27 UTC (Sat)
                               by <b>quotemstr</b> (subscriber, #45331)
                              [<a href="/Articles/796521/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
User isolation protects billions of app processes every day. Just turning off this isolation, running as the same uid, and relying on dm-verity (which protects against *different* threats) would cause users real pain and invalidate essential security guarantees. The position you're trying to advance is absurd and contradicts everyday experience. You can't just sit there and claim that a mechanism that anyone can see actually works is in fact an impossibility.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796521/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796530"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 18:24 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796530/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Again, I'm not proposing to remove user separation. They work fine as a way to prevent accidental errors. I'm saying that it makes no sense behaving as if user separation is a reliable security system.<br>
<p>
In the context of this thread, just add CAP_BPF and if somebody wants to use them in unprivileged process then let them do it. The process using CAP_BPF will be able to spy on kernel data and make it easier to exploit it. But heck, it's likely already possible and if you're allowing to run unconfined code then it's game over.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796530/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796532"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 18:43 UTC (Sat)
                               by <b>quotemstr</b> (subscriber, #45331)
                              [<a href="/Articles/796532/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I'm saying that it makes no sense behaving as if user separation is a reliable security system.</font><br>
<p>
"Behaving as if user separation is a security boundary" does make sense, because user separation does create a security boundary. <br>
It enforces security invariants that people care a lot about. What you're writing here is nonsense. It's as if you're doubling down on a claim that the moon is made of cheese. User security is not a porous and optional thing. This isn't a matter of perspective or opinion: what you're saying is obviously untrue as a matter of factual reality. If *anything* is a security boundary, user separation is a security boundary.<br>
<p>
Maybe you think user separation shouldn't be a security boundary. Claiming that user separation has never been a security boundary will not achieve your goals.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796532/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796533"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 19:01 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796533/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; What you're writing here is nonsense.</font><br>
<p>
CVE-2019-13272<br>
CVE-2019-12456<br>
CVE-2019-12454<br>
CVE-2019-11487<br>
CVE-2019-8956<br>
CVE-2019-8912<br>
CVE-2019-3896<br>
CVE-2018-20669<br>
...<br>
<p>
If you're depending on user separation to run unconfined code and be safe then you're simply deluding yourself.<br>
<p>
<font class="QuotedText">&gt; Maybe you think user separation shouldn't be a security boundary. Claiming that user separation has never been a security boundary will not achieve your goals.</font><br>
You can't read, can you? I'm advocating for leaving the user security as is and not investing into making more "unprivileged" stuff.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796533/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796534"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 19:16 UTC (Sat)
                               by <b>quotemstr</b> (subscriber, #45331)
                              [<a href="/Articles/796534/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  CVE-BLAH-BLAH</font><br>
<p>
Bugs do not invalidate architectures. If they did, the kernel-user boundary wouldn't be a security boundary, the hypervisor-guest boundary wouldn't be a security boundary, TLS wouldn't be cryptography, and door locks wouldn't be access controls, What you're writing here is simply nonsense...<br>
<p>
<font class="QuotedText">&gt;  I'm advocating...not investing into making more "unprivileged" stuff</font><br>
<p>
... and worse, you're making technical recommendations based on this nonsense. Maybe the Linux kernel has too many bugs for your needs and you'd be happier with something like seL4. But what you wrote above ("At best users are just a way to isolate well-meaning code from accidentally breaking unrelated stuff.") is painfully incorrect and discordant with everyday experience, and if you're going to triple-down on it, it's not worth engaging with you.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796534/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796535"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 19:47 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796535/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Bugs do not invalidate architectures.</font><br>
Unending and unendable litany of bugs does. There is zero hope that Linux will ever be free from local exploits.<br>
<p>
<font class="QuotedText">&gt; If they did, the kernel-user boundary wouldn't be a security boundary, the hypervisor-guest boundary wouldn't be a security boundary, TLS wouldn't be cryptography, </font><br>
Hypervisors don't have dozens of critical vulnerabilities each year, year after year, with no end in sight. Ditto for TLS libraries.<br>
<p>
<font class="QuotedText">&gt; and door locks wouldn't be access controls</font><br>
I can pick most regular door locks in minutes. They are exactly like Linux users - a mild inconvenience that can't be relied to keep stuff secure on its own.<br>
<p>
<font class="QuotedText">&gt; What you're writing here is simply nonsense...</font><br>
And you're just deluding yourself.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796535/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796539"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 22:08 UTC (Sat)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/796539/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; There is zero hope that Linux will ever be free from local exploits.</font><br>
<p>
I also have zero hope that HVM will be free from local exploits.<br>
<p>
<font class="QuotedText">&gt; Hypervisors don't have dozens of critical vulnerabilities each year, year after year, with no end in sight.</font><br>
<p>
There is no justification for choosing an arbitrary number of bugs per year as the threshold for when a security boundary is worth having.<br>
<p>
A much more useful question is, how difficult is it to acquire a usable zero-day container escape? Even if dozens of those appear per year, any given attacker may still struggle to get their hands on one --- and then only be able to use it for a short time.<br>
<p>
<font class="QuotedText">&gt; I can pick most regular door locks in minutes. They are exactly like Linux users - a mild inconvenience that can't be relied to keep stuff secure on its own.</font><br>
<p>
So you tell people not to bother with door locks?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796539/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796540"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 22:20 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796540/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I also have zero hope that HVM will be free from local exploits.</font><br>
Why not?<br>
<p>
<font class="QuotedText">&gt; There is no justification for choosing an arbitrary number of bugs per year as the threshold for when a security boundary is worth having.</font><br>
Why not? That's how safety assessments work in engineering and other areas.<br>
<p>
Building a house in a 1000-year flood area is OK, building a house in a 100-year flood area is questionable and building it in a 10-year flood area is just idiocy.<br>
<p>
<font class="QuotedText">&gt; A much more useful question is, how difficult is it to acquire a usable zero-day container escape? Even if dozens of those appear per year, any given attacker may still struggle to get their hands on one --- and then only be able to use it for a short time.</font><br>
However, in case of something like AWS if they allow co-hosting of different accounts' containers on one host then it's going to be a game over for them. A single unpatched vulnerability will allow attackers to spread laterally within minutes.<br>
<p>
<font class="QuotedText">&gt; So you tell people not to bother with door locks?</font><br>
I'm telling people not to bother installing bank vault locks on a regular front door.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796540/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796557"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2019 9:38 UTC (Sun)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/796557/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Why not?</font><br>
<p>
Because the hardware interface HVMs support, on x86 at least, is extremely complicated.<br>
<p>
<font class="QuotedText">&gt; Why not? That's how safety assessments work in engineering and other areas. Building a house in a 1000-year flood area is OK, building a house in a 100-year flood area is questionable and building it in a 10-year flood area is just idiocy.</font><br>
<p>
I don't think it's useful to make analogies between the weather and malicious attacks on computer systems. The exploit market and the exploit-patch-update cycle have no analogue in structural engineering. <br>
<p>
<font class="QuotedText">&gt; However, in case of something like AWS if they allow co-hosting of different accounts' containers on one host then it's going to be a game over for them. A single unpatched vulnerability will allow attackers to spread laterally within minutes.</font><br>
<p>
Right, so a large-attack-surface kernel-namespace-container multi-tenancy configuration probably isn't a good idea for them, which is probably why they don't do it.<br>
<p>
However there are other situations where kernel-enforced security boundaries are used today that you're apparently recommending be abandoned. One example discussed in comments here is Android application containment by user. I assume you also recommend browsers stop using kernel namespaces to sandbox Web content processes and use HVMs instead. Do I have to explain why that would be crazy?<br>
<p>
One reason browser sandboxes are pretty effective is a rapid exploit-patch-update cycle which means the useful lifetime of each bug is relatively short. They're also effective because those sandboxes are so restrictive; most operations (network I/O etc) can't be done directly inside the sandbox, but must be done via IPC to a broker. That architecture can also be used to run more traditional containers, e.g. Nabla containers ... <a href="https://lwn.net/Articles/773976/">https://lwn.net/Articles/773976/</a>.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796557/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796572"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2019 19:34 UTC (Sun)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796572/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Because the hardware interface HVMs support, on x86 at least, is extremely complicated.</font><br>
Uhm... No? The VT-x itself is simple. It does get more complicated when you're doing IOMMU to expose devices to guests.<br>
<p>
The first version of KVM back in 2.6.21 (?) days was something like 2000 lines of code. Then it started accreting functionality...<br>
<p>
<font class="QuotedText">&gt; However there are other situations where kernel-enforced security boundaries are used today that you're apparently recommending be abandoned. </font><br>
Please, do stop misrepresenting my words.<br>
<p>
<font class="QuotedText">&gt; One example discussed in comments here is Android application containment by user.</font><br>
Which is leaky as hell (see my previous comments about Android jailbreaks). It's kept alive by statically analyzing applications in Google Store and banning bad ones.<br>
<p>
<font class="QuotedText">&gt; I assume you also recommend browsers stop using kernel namespaces to sandbox Web content processes and use HVMs instead. Do I have to explain why that would be crazy?</font><br>
Actually, I wouldn't mind that at all. Howerver, browsers are doing the next best thing to it - they are sealing the renderer processes in hermetically sealed "containers", making sure that they can communicate with the world through only a few well defended channels.<br>
<p>
This is exactly what I want. I don't want MORE functionality being exposed to untrusted code, I want less of it (no "unprivileged" BPF).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796572/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796575"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2019 22:03 UTC (Sun)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/796575/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The VT-x itself is simple.</font><br>
<p>
The actual VT-x feature set is not the main problem. The problem is that x86 CPUs have a large and steadily growing set of features that need explicit hypervisor support before guests can use them. For example, rr users need access to performance counters and CPUID faulting, which require hypervisor support. CET and PKU require hypervisor support. x86 has loads of MSRs that it would be useful to virtualize.<br>
<p>
<font class="QuotedText">&gt; Please, do stop misrepresenting my words.</font><br>
<p>
Earlier in the thread you wrote "Instead of trying to patch the leaking dam it makes sense to switch to something different". In this context the "leaking dam" includes both user/root separation and confinement based on kernel namespaces, right? Then isn't your recommendation to not "patch the leaking dam" tantamount to abandoning those "leaking dams" as security boundaries?<br>
<p>
<font class="QuotedText">&gt; &gt; I assume you also recommend browsers stop using kernel namespaces to sandbox Web content processes and use HVMs instead.</font><br>
<font class="QuotedText">&gt; Actually, I wouldn't mind that at all.</font><br>
<p>
The two main strikes against it are the HVM nesting problem --- which means that in practice it would actually not work for a lot of users --- and that it would be considerably less efficient, especially in terms of memory, at a time when browsers are dramatically increasing the number of Web content processes for security.<br>
<p>
<font class="QuotedText">&gt; Howerver, browsers are doing the next best thing to it - they are sealing the renderer processes in hermetically sealed "containers", making sure that they can communicate with the world through only a few well defended channels.</font><br>
<p>
Nabla containers do essentially the same thing, how do you feel about them?<br>
<p>
These approaches depend on Linux kernel namespaces, which you have characterized as a leaking dam we should stop trying to patch. So do you recommend long-term dependence on Linux kernel namespaces as a security boundary, or not?<br>
<p>
<font class="QuotedText">&gt; I don't want MORE functionality being exposed to untrusted code, I want less of it (no "unprivileged" BPF).</font><br>
<p>
FWIW I wouldn't argue for introducing unprivileged eBPF. I would argue for not removing unprivileged classic-BPF, and I wonder how many of the security issues with unprivileged eBPF actually already exist for classic-BPF...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796575/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor797638"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2019 19:01 UTC (Wed)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/797638/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The actual VT-x feature set is not the main problem. The problem is that x86 CPUs have a large and steadily growing set of features that need explicit hypervisor support before guests can use them. For example, rr users need access to performance counters and CPUID faulting, which require hypervisor support. CET and PKU require hypervisor support. x86 has loads of MSRs that it would be useful to virtualize.</font><br>
Well, then perhaps this should stay in the realm of raw hardware for power users. <br>
<p>
<font class="QuotedText">&gt; Earlier in the thread you wrote "Instead of trying to patch the leaking dam it makes sense to switch to something different". In this context the "leaking dam" includes both user/root separation and confinement based on kernel namespaces, right?</font><br>
Correct. Kernel namespaces are useless. Sandboxes that limit the kernel interface (seccomp) are not useless.<br>
<p>
<font class="QuotedText">&gt; The two main strikes against it are the HVM nesting problem --- which means that in practice it would actually not work for a lot of users --- and that it would be considerably less efficient, especially in terms of memory, at a time when browsers are dramatically increasing the number of Web content processes for security.</font><br>
Browser sandboxes so far seem to be getting better, so perhaps full VMs for them won't be needed. But I'm personally willing to take a performance hit if it provides more security for browsers.<br>
<p>
<font class="QuotedText">&gt; Nabla containers do essentially the same thing, how do you feel about them?</font><br>
So they are basically lightweight VMs, with user/kernel protection used instead of a full hypervisor. I'm not sure I trust it because of the side channels. HVMs can fairly easily segregate resources into non-intersecting partitions, not so with Linux.<br>
<p>
<font class="QuotedText">&gt; I would argue for not removing unprivileged classic-BPF, and I wonder how many of the security issues with unprivileged eBPF actually already exist for classic-BPF...</font><br>
I don't particularly care about it either way. As long as new "protection" mechanisms are not required.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/797638/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor796541"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 22:31 UTC (Sat)
                               by <b>scientes</b> (guest, #83068)
                              [<a href="/Articles/796541/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think he is right that Linux is largely a single-user system now-a-days. And if you want more security the direction is less kernel code, and a more microkernel architecture. BFP is the opposite of that direction.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796541/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796567"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2019 16:34 UTC (Sun)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/796567/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Linux is largely a single *local* user system. Almost all Linux systems in use today try to disguise from that user that their primary function is to run arbitrary code over the internet on behalf of an unlimited number of anonymous remote tenants. If you want more security, maybe the answer is less of *that*.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796567/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796798"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 21, 2019 5:33 UTC (Wed)
                               by <b>mtaht</b> (subscriber, #11087)
                              [<a href="/Articles/796798/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
+1000000000.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796798/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor796498"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 16, 2019 23:56 UTC (Fri)
                               by <b>Freeaqingme</b> (subscriber, #103259)
                              [<a href="/Articles/796498/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; If any user that can run arbitrary code can break out of containment then Linux is not a multiuser system.</font><br>
<p>
I could, perhaps, agree with that statement, but I wonder about the premise it's based on. 'Containers' that do not utilize user namespaces have been declared inherently insecure by its maintainer, suggesting that unprivileged containers - those utilizing user namespaces - are secure. As such, I don't think that "arbitrary code can break out of containment" is a given.<br>
<p>
I won't dispute the fact that it happens occasionally but those cases are swiftly dealt with and are no indication of intended behavior.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796498/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796499"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 0:04 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796499/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In practice containers are used to make sure applications run in a consistent environment. Unprivileged containers are used just like unprivileged apps, to make sure a misbehaving app won't accidentally destroy something. But they're not resilient enough against determined malicious attacks.<br>
<p>
For example, I don't think that there are (serious) cloud computing provider that mix containers from different users inside one VM. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796499/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796501"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 0:14 UTC (Sat)
                               by <b>Freeaqingme</b> (subscriber, #103259)
                              [<a href="/Articles/796501/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  For example, I don't think that there are (serious) cloud computing provider that mix containers from different users inside one VM. </font><br>
<p>
But that doesn't mean containers are inherently insecure. I think it's a best-practice to implement _at least_ two barriers for every kind of attack vector.<br>
<p>
That's for example also the reason people run an application as unprivileged user, maybe use something like seccomp, and still choose to also use AppArmor (or Selinux). That's not because either one of those measures is inherently insecure, it's rather that if one of them contains a flaw there's still plenty of alternate barriers that need to be crossed too.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796501/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796505"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 1:39 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796505/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
SELinux in Android doesn't really add any more security. It's instead used to make sure that applications do not use unapproved kernel APIs.<br>
<p>
The actual security is being provided by dm-verity and the secure boot process.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796505/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor796506"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 1:41 UTC (Sat)
                               by <b>luto</b> (subscriber, #39314)
                              [<a href="/Articles/796506/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sandstorm was serious, and it did exactly this.  As far as I know, there was a single bug discovered that would have been accessible in the Sandstorm sandbox. (And Meltdown and Spectre.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796506/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796507"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 1:54 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/796507/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This might be because of "The Uncatchable Joe" effect.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796507/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor796578"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 19, 2019 0:38 UTC (Mon)
                               by <b>ssmith32</b> (subscriber, #72404)
                              [<a href="/Articles/796578/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;If any user that can run arbitrary code can break out of containment then Linux is not a multiuser system</font><br>
<p>
I don't see how that could possibly be accurate, the security of a multi-user system is orthogonal to whether it supports multiple users. Now if you had said Linux is not a *secure multi user system, that could very well be more accurate. And would have provoked a much more useful discussion than all the people talking past each other in this thread.<br>
<p>
Multiple users are deploying kubernetes pods on single linux systems every day. Multiple users are logging into linux systems every day. And, I suspect, as an added bonus! many errors have been found due to the multiple user support on Linux.<br>
<p>
Even the article above illustrates the problem of talking in these silly hyperboles. If the maintainer of eBPF thinks that the complexity of maintaining additional code to enhance the security of the non admin capability use case is not worth it, I think the discussion would have proceeded much more efficiently if they just said that, instead of making a bunch of over the top statements. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796578/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor796543"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2019 0:27 UTC (Sun)
                               by <b>zenaan</b> (guest, #3778)
                              [<a href="/Articles/796543/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Something has gone wrong when individuals can block progress on the basis of such easily falsified misapprehensions.</font><br>
<p>
Easy solution, brah, walk the talk, get coding and demonstrate the solution ye desire :)<br>
<p>
As in, seriously, the do-ocracy is about doing it, not complaining that -others- are not doing it. And that's no matter -what- the arguments the other person uses - it's their life, their time and attention, their skillset, and NONE of that is yours, or ours, to command!<br>
<p>
Folks (and I've been guilty in the past) need to get off their entitlement horses - ditch that insidious Neo-Marxist crapthink already.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796543/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796544"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2019 0:34 UTC (Sun)
                               by <b>quotemstr</b> (subscriber, #45331)
                              [<a href="/Articles/796544/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Believe me, I'm with you on the do-ocracy bit. The problem is that it's easy to get discouraged when one's solution is vetoed before even being presented. This whole thread is about proposing an unprivileged BPF extension (a "do"ing) and someone shooting it down.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796544/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor796502"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 0:18 UTC (Sat)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/796502/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This article is confusing because it uses "BPF" all over the place without distinguishing "classic BPF" from "eBPF". Unprivileged "classic BPF" is very heavily used and I assume (hope!) that there is no interest in making that go away.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796502/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796518"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 11:06 UTC (Sat)
                               by <b>ken</b> (subscriber, #625)
                              [<a href="/Articles/796518/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
where is that used ?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796518/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796522"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 13:51 UTC (Sat)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/796522/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Seccomp-bpf filters for sandboxes mainly. rr uses seccomp-bpf too.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796522/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796523"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 13:52 UTC (Sat)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/796523/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
People may use it for sockets too (where it was originally deployed).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796523/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor796528"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 17:22 UTC (Sat)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/796528/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Apologies if you found it confusing.  I gave up on maintaining a distinction between "BPF" and "eBPF" a while back.  In terms of attention and development activity, they are the same; "classic BPF" doesn't extend much beyond seccomp anymore.
<p>
FWIW, the one reference in the article to classic BPF used that term.
      
          <div class="CommentReplyButton">
            <form action="/Articles/796528/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor796538"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reconsidering unprivileged BPF</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2019 22:03 UTC (Sat)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/796538/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; In terms of attention and development activity, they are the same</font><br>
<p>
OK, but there is a lot of usage of seccomp-bpf, and telling people that "unprivileged BPF is going away" is going to freak those people out.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/796538/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2019, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
