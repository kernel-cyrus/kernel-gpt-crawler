        <!DOCTYPE html>
        <html lang="en">
        <head><title>5.4 Merge window, part 2 [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/800500/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/800603/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/800500/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>5.4 Merge window, part 2</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Benefits for LWN subscribers</b>
<p>
The primary benefit from <a href="/Promo/nst-nag5/subscribe">subscribing to LWN</a>
       is helping to keep us publishing, but, beyond that, subscribers get
       immediate access to all site content and access to a number of extra
       site features.  Please sign up today!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>September 30, 2019</br>
           </div>
The <a href="/Articles/800945/">release</a> of the 5.4-rc1 kernel and the closing of the merge window for
this development cycle came one day later than would have normally been
expected.  By that time, 12,554 non-merge changesets had been pulled
into the mainline repository; that's nearly 2,900 since <a
href="/Articles/799425/">the first-week summary</a> was written.  That
relatively small number of changes belies the amount of interesting change
that arrived late in the merge window, though.
<p>
Changes merged in the second half of the merge window include:
<p>
<h4>Architecture-specific</h4>
<p>
<ul class="spacylist">

<li> The PowerPC architecture has gained support for an "ultravisor", which
     is an especially privileged layer of software charged with keeping the
     hypervisor in line.  See <a
     href="https://git.kernel.org/linus/250c6c31228d">this document</a> for
     details. 

</ul>

<p>
<h4>Core kernel</h4>
<p>
<ul class="spacylist">

<li> There is a new operation, <tt>IORING_OP_TIMEOUT</tt>, that can be
     requested from the <a href="/Articles/776703/">io_uring
     subsystem</a>.  It will cause the calling process to be woken after the
     specified timeout period; see <a
     href="https://git.kernel.org/linus/5262f567987d">this commit</a> for
     details. 

</ul>

<p>
<h4>Filesystems and block layer</h4>
<p>
<ul class="spacylist">

<li> The dm-verity subsystem can now validate the root hash of a volume
     using a trusted key in the kernel keyring.
<li> The new dm-clone target makes a copy of an existing read-only device.
     "<q>The main use case of dm-clone is to clone a potentially remote,
     high-latency, read-only, archival-type block device into a writable,
     fast, primary-type device for fast, low-latency I/O</q>".  More
     information can be found in <a
     href="https://git.kernel.org/linus/7431b7835f55">this commit</a>.
<li> The F2FS filesystem has gained support for case-independent file-name
     lookups.  See <a href="https://git.kernel.org/linus/2c2eb7a300cd">this
     commit</a> for some details.
<li> The new "virtiofs" filesystem allows a host to export filesystems
     efficiently to guest systems.  See <a
     href="https://git.kernel.org/linus/2d1d25d0a224">this document</a> and
     <a href="https://git.kernel.org/linus/a62a8ef9d97d">this commit
     message</a> for more information.
<li> It's not in 5.4 but worth a mention anyway: Samsung has <a
     href="/ml/linux-kernel/042701d57747$0e200320$2a600960$@samsung.com/">decided</a>
     to upstream its internal "sdfat" filesystem; this is a newer
     implementation of exFAT that, it is said, has fewer code-quality
     problems and more features.  So the exFAT implementation added to the
     staging tree earlier in the merge window probably has a short life
     expectancy, at least in its current form.
</ul>

<p>
<h4>Hardware support</h4>
<p>
<ul class="spacylist">

<li> <b>Clock</b>:
     Marvell Armada AP CPU clock controllers,
     MediaTek MT6779 clock controllers,
     Ingenic JZ47xx TCU clocks and interrupt controllers, and
     Amlogic Meson virtual realtime clocks.

<li> <b>Miscellaneous</b>:
     Freescale FlexTimer alarm timers,
     Macronix raw NAND controllers,
     Creative SB0540 infrared receivers,
     Intel Merrifield Basin Cove power-management ICs,
     NXP IMX7ULP watchdog timers, and
     Spreadtrum pulse-width modulators.
<li> <b>PCI</b>:     
     Amazon Annapurna Labs PCIe controllers and
     NVIDIA Tegra194 PCIe controllers.

</ul>

<p>
<h4>Memory management</h4>
<p>
<ul class="spacylist">

<li> It is now possible to use transparent huge pages for read-only
     file-mapped virtual memory areas.  In practice, for now, this feature
     only works with executable text sections; an <a
     href="http://man7.org/linux/man-pages/man2/madvise.2.html"><tt>madvise()</tt></a>
     call is required to turn it on.  See <a
     href="https://git.kernel.org/linus/99cb0dbd47a1">this commit</a> for a
     bit of detail.
<li> There are two new <tt>madvise()</tt> commands to force the kernel to
     reclaim specific pages.  <a
     href="https://git.kernel.org/linus/9c276cc65a58"><tt>MADV_COLD</tt></a>
     moves the indicated pages to the inactive list, essentially marking
     them unused and suitable targets for page reclaim.  A stronger variant
     is <a
     href="https://git.kernel.org/linus/1a4e58cce84e"><tt>MADV_PAGEOUT</tt></a>,
     which causes the pages to be reclaimed immediately.
<li> When we last looked at <a href="/Articles/790985/">this
     memory-management performance-regression problem</a>, there was
     pressure to revert a change reverting a performance-related patch.
     That revert was reverted for 5.3-rc5; now the revert of the revert has
     been reverted for 5.4.  So the original revert is now in place, and a
     couple of different patches addressing the original problem have been
     merged.  See <a
     href="https://git.kernel.org/linus/edf445ad7c8d">this changelog</a>
     for some more information, along with <a
     href="/ml/linux-kernel/CAHk-=wgba5zOJtGBFCBP3Oc1m4ma+AR+80s=hy=BbvNr3GqEmA@mail.gmail.com/">Linus
     Torvalds's reasoning</a> for bypassing the memory-management
     developers and applying these patches directly.
</ul>

<p>
<h4>Security-related</h4>
<p>
<ul class="spacylist">

<li> The integrity-measurement (IMA) subsystem has gained support for verifying
     signatures appended to files.  It has not, however, gained much in the
     way of documentation for this feature; what is available can be found
     in <a href="https://git.kernel.org/linus/9044d627fd18">this
     commit</a>.
<li> After years of work and controversy, the <a
     href="/Articles/791863/">kernel lockdown patch set</a> has been merged
     in the form of a Linux security module.     
<li> In a last-minute move that, seemingly, is responsible for the one-day
     delay in the release of 5.4-rc1, Torvalds <a
     href="/ml/linux-kernel/CAHk-=wi0vxLmwEBn2Xgu7hZ0U8z2kN4sgCax+57ZJMVo3huDaQ@mail.gmail.com/">decided</a>
     to merge <a href="https://git.kernel.org/linus/50ee7529ec45">an
     entropy-collection mechanism</a> for random-number generation based on
     the <a href="/Articles/642166/">"jitter entropy" idea</a>.  The
     purpose here is to address the <a href="/Articles/800509/">boot-time
     entropy issues</a> that can cause a system to hang during boot in some
     situations.  This may not be the ultimate form of the solution:
     <p>
     <div class="BigQuote">
	I'm not saying my patch is going to be the last word on the
	issue. I'm _personally_ ok with it and believe it's not crazy, and
	if it then makes serious people go "Eww" and send some improvements
	to it, then it has served its purpose.
     </div>
     <p>
     Torvalds was clear, though, that he wants to see some sort of solution
     to the boot-time entropy problem in 5.4.
</ul>

<p>
<h4>Internal kernel changes</h4>
<p>
<ul class="spacylist">

<li> The build system will now refuse to proceed if the gold linker is
     detected.  There are a few problems that make gold unsuitable for
     kernel building; see <a
     href="https://git.kernel.org/linus/75959d44f9dc">this commit</a> for
     details.
<li> Support for <a href="/Articles/760045/">kernel symbol namespaces</a>
     has been added, providing a way to bring some order to the many
     thousands of exported symbols.
<li> The <tt>checkpatch.pl</tt> tool will now warn about invalid commit IDs
     in changelogs.
</ul>
<p>

The development community will now focus on stabilizing this work over the
next 7-8 weeks, leading to an expected 5.4 release in the second half of
November.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-5.4">Releases/5.4</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/800500/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor800968"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.4 Merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2019 9:02 UTC (Tue)
                               by <b>meyert</b> (subscriber, #32097)
                              [<a href="/Articles/800968/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But who controls the ultravisor?! :-D<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/800968/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor800969"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.4 Merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2019 9:11 UTC (Tue)
                               by <b>gevaerts</b> (subscriber, #21521)
                              [<a href="/Articles/800969/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The metavisor, of course!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/800969/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor800973"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.4 Merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2019 11:10 UTC (Tue)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/800973/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ah no. It's ultravisors all the way down.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/800973/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor800972"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.4 Merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2019 10:48 UTC (Tue)
                               by <b>tkreagan</b> (subscriber, #4548)
                              [<a href="/Articles/800972/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
turtlevisor.  then systemd under that.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/800972/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor801339"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.4 Merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2019 21:34 UTC (Fri)
                               by <b>mtaht</b> (subscriber, #11087)
                              [<a href="/Articles/801339/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"turtlevisor" made me blow coffee through my nose. thx!<br>
<p>
I've been a lonely advocate of a rethink of how we do cpu architectures for a long time, and have called for more hardware support of features essential<br>
to faster context and privilege switching along the lines of what the mill<br>
proposed ( <a href="https://millcomputing.com/docs/security/">https://millcomputing.com/docs/security/</a>  ) <br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/801339/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor800981"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.4 Merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2019 12:55 UTC (Tue)
                               by <b>ncultra</b> (<b>&#x272D; supporter &#x272D;</b>, #121511)
                              [<a href="/Articles/800981/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Two key pieces of the design appear problematic from the start. <br>
<p>
The "ultravisor" inherits (receives, accepts?) a virtual machine from KVM. At that point, if KVM (and therefore Linux and QEMU) is untrusted, this is "shutting the barn door after all the animals have escaped." I don't doubt that the "ultravisor" would be able to monitor the hypercalls made by the compromised virtual machine from that point onward, encrypt and decrypt its virtual storage, etc., but to what effect, if the guest has already been compromised?<br>
<p>
All I/O made by a "secure" virtual machine is virtual I/O. virtio through QEMU is has a history of vulnerabilities, and involves QEMU having shared mappings with the virtual machine. This is problematic. It would be more secure to pass physical device functions directly to the virtual machine and to NOT allow virtual I/O from the secure virtual machine.<br>
<p>
It seems as though this is a rube-goldberg-like fix for shared processor and memory side-channel attacks dressed up like a new feature.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/800981/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor801185"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.4 Merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 3, 2019 2:19 UTC (Thu)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/801185/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There's a verification step which presumably uses digital signatures or some other mechanism to ensure that the new guest is in a known good state.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/801185/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor801277"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.4 Merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2019 8:23 UTC (Fri)
                               by <b>linuxram</b> (guest, #22157)
                              [<a href="/Articles/801277/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Correct. When the Ultravisor moves the pages of the VM from normal memory to secure memory,  the ultravisor first checks the integrity of the content.  If the check fails, it fails the VM.   NOTE:  The normal memory is in Hypervisor's control and secure memory is in Ultravisor's control.  Hypervisor cannot access secure memory.<br>
<p>
Here are some presentations that will explain the architecture better.<br>
<p>
<a href="https://www.youtube.com/watch?v=pKh_mPPo9X4">https://www.youtube.com/watch?v=pKh_mPPo9X4</a><br>
<a href="https://static.sched.com/hosted_files/openpowerna19/45/OpenPOWER_NA_Final%20%282%29.pdf">https://static.sched.com/hosted_files/openpowerna19/45/Op...</a><br>
<a href="https://www.youtube.com/watch?v=l4jccqc14Vc">https://www.youtube.com/watch?v=l4jccqc14Vc</a><br>
<a href="https://static.sched.com/hosted_files/kvmforum2018/57/SVM_Edinburg_v3.pdf">https://static.sched.com/hosted_files/kvmforum2018/57/SVM...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/801277/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2019, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
