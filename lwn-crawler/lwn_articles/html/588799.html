        <!DOCTYPE html>
        <html lang="en">
        <head><title>Tracing unsigned modules [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/588799/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/588623/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/588799/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Tracing unsigned modules</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>We're bad at marketing</b>
<p>
We can admit it, marketing is not our strong suit. Our strength is
writing the kind of articles that developers, administrators, and
free-software supporters depend on to know what is going on in the
Linux world. Please <a href="/Promo/nsn-bad/subscribe">subscribe today</a> to help us keep doing that, and so
we don’t have to get good at marketing.
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>March 5, 2014</br>
           </div>
<p>
The reuse of one of the "tainted kernel" flags by the signed-module loading
code has led to a problem using tracepoints in unsigned kernel modules.  The
problem is fairly easily fixed, but there was opposition to doing so, at
least until a "valid" use case could be found.  Kernel hackers are not
particularly interested in helping out-of-tree modules, and fixing the
problem was seen that way—at first, anyway.
</p>

<p>
Loadable kernel modules have been part of the kernel landscape for nearly
20 years (kernel 1.2 in 1995), but have only recently gained the ability to
be verified by a cryptographic signature, so that only "approved" modules
can be loaded.  Red Hat kernels have had the feature for some time, though
it was
implemented differently than what eventually <a
href="/Articles/515007/">ended up in 
the kernel</a>.  Basically, the kernel builder can specify a key to be used
to sign modules; the private key gets stored (or discarded after signing),
while the public key is built into the kernel.
</p>

<p>
There are several kernel configuration parameters that govern module
signing: <tt>CONFIG_MODULE_SIG</tt> controls whether the code to do
signature checking is enabled at all, while
<tt>CONFIG_MODULE_SIG_FORCE</tt> determines 
whether <i>all</i> modules must be signed.  If
<tt>CONFIG_MODULE_SIG_FORCE</tt> is not 
turned on (and the corresponding kernel boot parameter
<tt>module.sig_enforce</tt> is not present), then modules without
signatures or those using keys not available to the kernel will still be
loaded. In that case, though, the kernel will be marked as tainted.

<p>
The taint flag used, though, is the same as that used when the user does a
<tt>modprobe&nbsp;--force</tt> to force the loading of a module built for a
different kernel version: <tt>TAINT_FORCED_MODULE</tt>.  Force-loading a
module is fairly dangerous and can lead to kernel crashes due to
incompatibilities between the module's view of memory layout and the
kernel's.  That can lead to crashes that the kernel developers are not
interested in spending time on.  So, force-loading a module taints the
kernel to allow those bug reports to be quickly skipped over.

<p>
But loading an unsigned module is not likely to lead to a kernel crash (or
at least, not because it is unsigned), so using the
<tt>TAINT_FORCED_MODULE</tt> flag in that case is not particularly fair.
The tracepoint code discriminates against force-loaded modules because
enabling tracepoints in mismatched modules could easily lead to a system
crash.   The tracepoint code does allow <tt>TAINT_CRAP</tt>
(modules built from the staging tree) and <tt>TAINT_OOT_MODULE</tt> (out-of-tree
 modules) specifically, but tracepoints in the modules get silently
 disabled if there is 
any other 
taint flag.

<p>
 Mathieu Desnoyers <a href="/Articles/588804/">posted an RFC patch</a> to
 change that situation.  It added a new <tt>TAINT_UNSIGNED_MODULE</tt> flag
 that got set when those modules were loaded.  It also changed the test in
 the tracepoint code to allow tracing for the new taint type.  It drew an
 <a href="/Articles/588905/">immediate NAK</a> from Ingo Molnar, who did
 not find Desnoyers's use case at all compelling: "<q>External modules should strive to get out of the 'crap' and
'felony law breaker' categories and we should not make it
easier for them to linger in a broken state.</q>"
</p>

<p>
But the situation is not as simple as Molnar seems to think.  There are
distribution kernels that turn on signature checking, but allow users to
decide whether to require signatures by using <tt>module.sig_enforce</tt>.
Since 
it is the distribution's key that is stored in the kernel image, strict
enforcement would mean that only modules built by the distribution could be
loaded.  That leaves out a wide variety of modules that a user might want
to load: modules under development, back-ported modules from later kernels,
existing modules being debugged, and so on. 
</p>

<p>
Module maintainer Rusty Russell was <a href="/Articles/588911/">fairly
unimpressed</a> with the arguments given in favor of the change, at least
at first, noting that 
the kernel configuration made it clear that users needed to arrange to sign
their own modules: "<q>Then you didn't do that.  You broke it, you get to
keep both pieces.</q>"  That's not exactly the case, though, since
<tt>CONFIG_MODULE_SIG_FORCE</tt> was <i>not</i> set (nor was
<tt>module.sig_enforce</tt> passed on the kernel command line), so users
aren't actually required to arrange for signing.  But Russell was looking
for "<q>an actual valid use case</q>".
</p>

<p>
The problem essentially boils down to the fact that the kernel is lying
when it uses <tt>TAINT_FORCED_MODULE</tt> for a module that, in fact,
hasn't been forced.  Steven Rostedt <a href="/Articles/588923/">tried to
make that clear</a>: "<q>Why the hell are we setting
a FORCED_MODULE flag when no module was forced????</q>".  He also <a
href="/Articles/588924/">noted</a> that he is often the one to get bug
reports from folks whose tracepoints aren't showing up because they didn't
sign their module.  As he pointed out, it is a silent failure and the
linkage between signed modules and tracepoints is not particularly obvious.
</p>

<p>
Johannes Berg was eventually <a href="/Articles/588926/">able to supply</a>
the kind 
of use case Russell was looking for, though. In his message, he summarized
the case for unsigned modules
nicely:
<div class="BigQuote">
The mere existence of a configuration to allow unsigned modules would
indicate that there are valid use cases for that (and rebuilding a
module or such for development would seem to be one of them), so why
would tracing be impacted, particularly for development.
</div>
</p>

<p>
Berg also provided another reason for loading unsigned modules: backported
kernel modules from <a href="https://backports.wiki.kernel.org/">the
kernel.org wiki</a> to support hardware (presumably, in his case, wireless
network 
hardware) features not present in the distribution-supplied drivers.  He
was quite unhappy to hear those kinds of drivers, which "<q>typically only diverge
from upstream by a few patches</q>", characterized as crap or
law-breaking. 
</p>

<p>
Berg's use case was enough for Russell to agree to the change and to add it
to his pending tree.  We should
see Desnoyers's 
<a href="/Articles/588803/">final patch</a>, which has some cosmetic
changes from the RFC, in 3.15.  At that point, the kernel will be able to
distinguish between these two different kinds of taint and users will be
able to trace modules they have loaded, signed or unsigned.
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_model-Loadable_modules">Development model/Loadable modules</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Modules-Signed">Modules/Signed</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/588799/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor589608"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 6, 2014 6:40 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/589608/">Link</a>] (25 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
it seems to me that backported, development, etc drivers are exactly the sort of thing that you want to have set the taint flag, for exactly the same reason as the forced modules, you don't have confidence that these modules will properly interface with the rest of the kernel (data structures, locks, etc)<br>
<p>
It seems like what's needed is a way to tell the tracepoint mechanism to ignore it's checks and just do what you are telling it to do.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589608/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor589623"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 6, 2014 9:05 UTC (Thu)
                               by <b>iq-0</b> (subscriber, #36655)
                              [<a href="/Articles/589623/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So you're effectively reasoning that because, because something wasn't in the original source tree, it would be tainting the kernel?<br>
<p>
There is nothing "magical" about the original source tree that makes it better than any later changes, fixes or development done against that specific kernel.<br>
<p>
If anyone wants to know if something out-of-original-build-tree gets loaded, fine. If you want to call that "tainted", fine (it would just be a different form of "taint" than was the original meaning). But that should be no indication whatsoever that something is crap (unwanted, bad, ..), and thus should be excluded from the normal kernel tracing infrastructure and such.<br>
It would just mean: There is more code active than was in the original build tree, just so you know.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589623/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor589645"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 6, 2014 11:20 UTC (Thu)
                               by <b>vonbrand</b> (subscriber, #4458)
                              [<a href="/Articles/589645/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <p>The taint flag was introduced to mark unavailable source code (binary-only drivers) or unsupported situations (kernel Oops, forcing certain operations). Out-of-tree source certainly qualifies as "not supported by the vanilla kernel crowd," they have their plates full enough already to have to chase down, configure, compile, and test external code.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/589645/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor589690"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 6, 2014 14:34 UTC (Thu)
                               by <b>iq-0</b> (subscriber, #36655)
                              [<a href="/Articles/589690/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sure, fine. But we're not talking about "is it supported" or not. It currently means disable key debugging infrastructure.<br>
<p>
That might be fine when people are loading stuff that they can't possibly understand (binary blobs e.g.) and when a kernel bug has been triggered in the past.<br>
But when one loads a normal module (backported fixes, out-of-tree open source module that is pacifically for that kernel) than you only want to mention that "out-of-tree code" has been loaded. The stacktraces don't become more wrong than any in-tree code would make them.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589690/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor589693"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 6, 2014 14:39 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/589693/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
so is the fix to change the kernel tainting? or to make it so that you can override the disabling of key debugging infrastructure?<br>
<p>
It seems to me that the latter is the correct way to go. No matter what you do, these debugging hooks can cause grief if the modules is mismatched enough, and they also may work even with badly mismatched modules.<br>
<p>
so give a warning "this may crash your system, based on Taint flag X, are you sure you want to do this", but allow it to be done.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589693/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor590583"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2014 18:10 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/590583/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The use case that instantly jumps to mind here is somebody trying to DEVELOP a driver module.<br>
<p>
They're using the disstro-supplied, signed, kernel. They're rebuilding the module they're developing.<br>
<p>
They are now STUFFED because that combo disables debugging!!!<br>
<p>
(Why they don't want to build their own kernel I don't know, but surely there are valid circumstances ...)<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/590583/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor589634"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 6, 2014 10:38 UTC (Thu)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/589634/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <p>Those modules are tainted with TAINT_OOT_MODULE. "OOT" means "Out-Of-Tree". If there's a bug and we see that taint we usually do say, "Can you reproduce that bug without the module that caused the OOT taint?". If they can't then we ignore it.</p>

<p>
But it is far from the reason that forced modules are tainted. A module that is forced is usually one that the checksums found an incompatibility between the module and the running kernel. Something is there that can break. This means it can be <b>anything</b>, and we don't care if it breaks for you. As the tracing infrastructure is very intrusive, bad kernel structures can cause the tracing code to corrupt the rest of the kernel, hence why we don't allow it to work with tainted modules.</p>

<p>
You are also missing the point completely. The bug here is that unsigned modules <b>even from the same kernel tree</b> will cause the force flag to be set. Try it. Build a kernel with the following:</p>
<ul>
<li>CONFIG_MODULE_SIG=y</li>
<li># CONFIG_MODULE_SIG_FORCE is not set</li>
<li># CONFIG_MODULE_SIG_ALL is not set</li>
</ul>
<p>
And all your modules will be marked as FORCED, and the tracepoints in those modules will appear in the /sys/kernel/debug/tracing/events directory, but if you activate them, they wont do anything. Seems silly to let a random config break tracing, doesn't it?
      
          <div class="CommentReplyButton">
            <form action="/Articles/589634/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor589686"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 6, 2014 14:03 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/589686/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Seems silly to let a random config break tracing, doesn't it?</font><br>
<p>
I agree, I just think the problem is in the tracing refusing to do what the admin asked rather than in the tainting.<br>
<p>
The problem as I see it is that OOT means that you really don't know what it is. It may have exactly the same problems as a Forced module, but you don't know because you aren't checking (and as I understand it, _can't_ check to prove that it's correct or not for the generic case)<br>
<p>
and this module isn't limited in what it can do, once it's loaded in kernelspace, it can go and muck with anything, anywhere in the kernel, so it can cause problems anywhere.<br>
<p>
the kernel devs will do what they do with _any_ tainted kernel report, they will ask why it's tainted and if the problem can be reproduced without the tainting. It doesn't matter if it's tained for OOT, Forced, nvidia, or anything else.<br>
<p>
The 'why is this tainted' question will discover what's going on with far better detail than you can ever hope to encode in an enumerated set of flags.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589686/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor589764"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 6, 2014 17:11 UTC (Thu)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/589764/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
OK, I see what you're saying. We are implementing policy here by not letting an admin enable tracing when they force a module. You are saying we should allow them to still do tracing but because they "forced" the module, if it crashes the system it's their own damn fault. If you don't want it to crash, then don't force modules to load that were not built for the current kernel.<br>
<p>
To put it another way, you are saying to let tracing crash like anything else could crash if a module is forced.<br>
<p>
Hmm, you do have a point. We could just make it so that the only taint that fails to load tracepoints is the TAINT_PROPRIETARY_MODULE. And that one fails because of political reasons, not technical ones*.<br>
<p>
* Some people may argue that the political reasons cause technical ones.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589764/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor589799"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 6, 2014 19:58 UTC (Thu)
                               by <b>johill</b> (subscriber, #25196)
                              [<a href="/Articles/589799/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's a bit unnerving to be quoted in an LWN article, I try to hide in the shadows most of the time, but here we are ;-)<br>
<p>
The original discussion didn't really quite capture it all, I think there really are two aspects to this.<br>
<p>
The first is that it's quite odd that a (seemingly valid) kernel configuration can result in every single module that you load being loaded as though it was forced, which is what the kernel does before the patch. I'm not sure why this part should be controversial since it just adds more detailed information ("tainted because of missing signature") up front.<br>
<p>
The second aspect is about the tracing policy, which says that tracing is disabled for code that's tainted in certain ways (most ways, really, except a few). Since we start from the premise that unsigned modules aren't all that bad (otherwise we could just refuse loading them alltogether, or disallow the configuration that results in this), then to me at least it is strange to argue that tracing should be disabled for such modules.<br>
<p>
The whole out-of-tree modules thing is actually a bit of a strawman, because the same happens for in-tree modules, but it's a case where it's even easier to end up with unsigned modules, and it's certainly not an uncommon thing to do (particularly with backports, which is something that some of us have to routinely support).<br>
<p>
Now with the second aspect the other question is why tracing is disabled for certain taints to start with - after all we could argue that if the tracing code crashes for you when you have a tainted kernel then you're on your own. As I understand it Steven did this to not even run into the crashing situations (since tracing accesses the ringbuffer in low-level ways), but I would agree that you could argue for an override for allowing that to be overridden.<br>
<p>
I tend to think that those aspects are quite unrelated though, and the bulk of the patch is really about the first aspect ("unsigned != forced") even if the reason for it was related to tracing.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589799/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor589865"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 7, 2014 3:28 UTC (Fri)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/589865/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  To put it another way, you are saying to let tracing crash like anything else could crash if a module is forced.</font><br>
<p>
exactly, by forcing the module, the admin is saying that they know better than the kernel that this really is what they want to do (and sometimes they may even be right :-) so we should continue to feed the admin rope when they demand it, which is a pretty standard option in the kernel.<br>
<p>
<font class="QuotedText">&gt; Hmm, you do have a point. We could just make it so that the only taint that fails to load tracepoints is the TAINT_PROPRIETARY_MODULE. And that one fails because of political reasons, not technical ones*.</font><br>
<p>
I'm not sure why we even need that?<br>
<p>
What is it that we are trying to prevent by blocking tracing?<br>
<p>
If we are trying to prevent crashing, we're already past that point.<br>
<p>
If we are trying to make life harder for users of proprietary modules, I don't think there is really agreement on this.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589865/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor589906"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 7, 2014 13:46 UTC (Fri)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/589906/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; If we are trying to make life harder for users of proprietary modules,</font><br>
<p>
That's just an added bonus but not the rational here.<br>
<p>
The tracing code was written under the GPLv2. For it to work in a module, a lot of its code must be compiled in from the headers. The tracing headers are not just structures. The majority of the tracing C code is "magically" created via the tracing headers at the location of their use. If a proprietary module uses this tracing code, their is no question that this module is now a derived work of the tracing code, as the tracing code is now embedded inside the module. This is a clear straight forward infraction of the license that the code was written for.<br>
<p>
As one of the major authors of the tracing code, I do not want my work being used by proprietary modules. Period!<br>
<p>
Note, those are the modules that Ingo was calling "crap" and "felony law breakers".<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589906/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor589978"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 7, 2014 21:01 UTC (Fri)
                               by <b>vonbrand</b> (subscriber, #4458)
                              [<a href="/Articles/589978/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <p>Any actual courtroom precedent that #including a header file when compiling makes the binary (let alone the source) a derivative of said header file? Until that shows up, this is completely in the air. And I'd be surprised if it didn't end up as a point to be decided on the number of lines used that way compared to the whole.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/589978/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor589981"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 7, 2014 21:20 UTC (Fri)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/589981/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Take a look at include/trace/ftrace.h, include/trace/define_trace.h and include/linux/tracepoint.h and tell me what you think. You'll find that these are far from "normal headers".<br>
<p>
Also, to make tracepoints work in a module, you must also have the following code in a .c file.<br>
<p>
#define CREATE_TRACE_POINTS<br>
#include &lt;trace/events/foo.h&gt;<br>
<p>
This then does a lot of macro magic to produce a lot of code. This is not a simple interface as headers normally are. It is real code that is created, and we can see it in the module binary.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589981/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor589986"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 7, 2014 21:31 UTC (Fri)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/589986/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; And I'd be surprised if it didn't end up as a point to be decided on the number of lines used that way compared to the whole.</font><br>
<p>
And I'd be surprised if that actually worked. I guess singing Happy Birthday in a full feature length movie, wouldn't cause any copyright issues. I mean, that song is just a very small part of the whole (movie).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589986/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor589995"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 8, 2014 0:51 UTC (Sat)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/589995/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Nope[1]. The "Happy Birthday" song is pretty widely enforced even in movies.<br>
<p>
[1]<a href="http://arstechnica.com/tech-policy/2014/02/happy-birthday-copyright-defense-those-words-and-text-are-ours/">http://arstechnica.com/tech-policy/2014/02/happy-birthday...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589995/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor589996"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 8, 2014 1:40 UTC (Sat)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/589996/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thank you for proving my point.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/589996/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor590067"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 8, 2014 23:47 UTC (Sat)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/590067/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yet again we have proof that even the mildest sarcasm just doesn't work on the Internet. :)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/590067/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor590585"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">And I'd be surprised if it didn't end up as a point to be decided on the number of lines used that way compared to the whole.</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2014 18:19 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/590585/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Except it doesn't work that way round you are thinking.<br>
<p>
If I publish an anthology of poems, for each work I "borrow" I am infringing 100% of it. The court couldn't care less that it only forms 1% (or less) of my work ...<br>
<p>
Here we have some GPL2 code, a clearly defined work, and anything using it is using 100% of it ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/590585/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor590007"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 8, 2014 4:00 UTC (Sat)
                               by <b>rusty</b> (guest, #26)
                              [<a href="/Articles/590007/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The bug here is that unsigned modules even from the same kernel tree will </font><br>
<font class="QuotedText">&gt; cause the force flag to be set. Try it. Build a kernel with the following:</font><br>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt;   CONFIG_MODULE_SIG=y</font><br>
<font class="QuotedText">&gt;   # CONFIG_MODULE_SIG_FORCE is not set</font><br>
<font class="QuotedText">&gt;   # CONFIG_MODULE_SIG_ALL is not set</font><br>
<p>
That's the point.  CONFIG_MODULE_SIG_ALL's help says:<br>
<p>
      Sign all modules during make modules_install. Without this option,<br>
      modules must be signed manually, using the scripts/sign-file tool.<br>
<p>
ie. You didn't read that, and didn't sign your modules manually.  This is an option for distributions to do their own special stuff.  As quoted in the article: "you broke it, you get to keep both pieces".<br>
<p>
Hope that helps,<br>
Rusty.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/590007/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor590028"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 8, 2014 13:54 UTC (Sat)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/590028/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Sign all modules during make modules_install. Without this option, modules must be signed manually, using the scripts/sign-file tool.</font><br>
<p>
That doesn't say: "Or your unsigned modules will not work as expected"<br>
<p>
I think your "you broke it, you get to keep both pieces" is quite off.<br>
<p>
I mean really. WTF does not signing a module have to do with breaking other parts of the kernel. That help message to me just says that I need to sign my module manually if I want it part of the "trusted" group. It doesn't say that parts of the module will not work because it wasn't signed.<br>
<p>
Even if someone read that, it doesn't convey, HEY SIGN YOUR MODULE, OR WHEN YOU LOAD IT YOU WILL BE TOTALLY FSCKED AND WE WONT EVEN TELL YOU SOMETHING WENT BAD.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/590028/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor590068"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 9, 2014 0:07 UTC (Sun)
                               by <b>rusty</b> (guest, #26)
                              [<a href="/Articles/590068/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I can see this is personally offensive for you, so I'll stop responding so that you have time to heal.<br>
<p>
Cheers,<br>
Rusty.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/590068/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor590102"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 9, 2014 14:07 UTC (Sun)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/590102/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No this isn't personally offensive to me. I just like my CAPS LOCK key. Believe me, as many people who know me, it takes a hell of a lot to offend me :-)<br>
<p>
I'm just trying to point out (perhaps loudly) that it's not broken. It's a valid config that you said "hey you broke it, you keep the pieces". Where the config is just talking about the signing of modules. No where does it say that the module will not work as expected because of it.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/590102/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor590117"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 9, 2014 21:42 UTC (Sun)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/590117/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
the modules work, it's just tracing that is blocked. And I think that blocking tracing because it _may_ cause problems is a bad idea, warn that it may be a problem and get confirmation from the admin, possibly, but then allow it because it's no more likely to break the system than loading the tainted module was.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/590117/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor590143"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 10, 2014 12:25 UTC (Mon)
                               by <b>cesarb</b> (subscriber, #6266)
                              [<a href="/Articles/590143/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's different.<br>
<p>
Backported, development, etc. modules, as long as they're compiled with the exact same compiler, headers, config options, etc., should interface properly with the rest of the kernel.<br>
<p>
With forced modules, on the other hand, you have an ABI mismatch. You could have different-sized data structures, function parameters in a different order, inlined functions behaving completely different, and so on.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/590143/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor590199"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 10, 2014 18:11 UTC (Mon)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/590199/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Backported, development, etc. modules, as long as they're compiled with the exact same compiler, headers, config options, etc., should interface properly with the rest of the kernel.</font><br>
<p>
That's a lot of fiddly things to get right to be safe.<br>
<p>
and how many people would know that their compiler package wasn't updated in some way since the kernel was compiled?<br>
<p>
<font class="QuotedText">&gt; With forced modules, on the other hand, you have an ABI mismatch. You could have different-sized data structures, function parameters in a different order, inlined functions behaving completely different, and so on.</font><br>
<p>
But if you know that the the ABI didn't change (or at least that the module in question doesn't use any of the changed bits), then you are safe as well.<br>
<p>
So I still argue that it's the exact same type of risk, and the admin is telling you that they know that this is the right thing to do, no matter what the potential risk.<br>
<p>
At that point, you should give the admin some more rope and believe them (but not trust them, thus the tainting of the kernel to save time on analyzing bugs)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/590199/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor590593"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tracing unsigned modules</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2014 18:50 UTC (Thu)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/590593/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is an extremely idiotic decision. <br>
<p>
First, there are open source out-of-tree modules that can't be integrated because of a conflicting license. OpenAFS being the most inconic example (and ZFS-on-Linux too). This decision means that they can't be used without a complete recompilation of the kernel (boo!).<br>
<p>
Then there's the question of development - we're writing our own filesystem based on Ceph, and we really want to use stock distro kernels to avoid maintaining tons of virtual machines for Amazon EC2. That change would make it impossible to trace these modules (and we use tracing in production to gather diagnostics!).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/590593/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2014, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
