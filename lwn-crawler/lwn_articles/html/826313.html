        <!DOCTYPE html>
        <html lang="en">
        <head><title>Emulating Windows system calls, take 2 [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/826313/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/826300/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/826313/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Emulating Windows system calls, take 2</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Benefits for LWN subscribers</b>
<p>
The primary benefit from <a href="/Promo/nst-nag5/subscribe">subscribing to LWN</a>
       is helping to keep us publishing, but, beyond that, subscribers get
       immediate access to all site content and access to a number of extra
       site features.  Please sign up today!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>July 17, 2020</br>
           </div>
Back in June, LWN <a href="/Articles/824380/">covered a patch set</a>
adding a mechanism intended to help systems like <a
href="https://winehq.org/">Wine</a> emulate Windows system calls on a Linux
system.  That patch set got a lot of attention and comments, with the
result that its form has changed considerably.  Gabriel Krisman Bertazi has
now posted <a
href="/ml/linux-kernel/20200712044516.2347844-1-krisman@collabora.com/">a
new patch set</a> that takes a different approach to solving the same problem.
<p>
As a reminder, the intent of this work is to enable the running of Windows
binaries that call directly into the Windows kernel without going through
the Windows API.  Those system calls must somehow be trapped and emulated
for the program to run correctly; this must be done without modifying the
Windows program itself, lest Wine run afoul of the cheat-detection
mechanisms built into many of those programs.  The  previous attempt added
a new <a
href="https://man7.org/linux/man-pages/man2/mmap.2.html"><tt>mmap()</tt></a>
flag that would mark regions of the program's address 
space as unable to make direct system calls.  That was coupled with a new
<a
href="https://man7.org/linux/man-pages/man2/seccomp.2.html"><tt>seccomp()</tt></a>
mode that would trap system calls made from the marked range(s).  There
were a number of concerns raised about this approach, starting with the
fact that using <tt>seccomp()</tt> might cause some developers to think
that it could be used as a security mechanism, which is not the case.
<p>
The new patch set has thus moved away from <tt>seccomp()</tt> and uses
<tt><a
href="https://man7.org/linux/man-pages/man2/prctl.2.html">prctl()</a></tt>
instead, following one of the suggestions that was made in response to the
first attempt.  Specifically, a program wanting to enable system-call trapping
and emulation would make a call to:
<p>
<pre>
    prctl(PR_SET_SYSCALL_USER_DISPATCH, operation, start, end, selector);
</pre>
<p>
Where <tt>operation</tt> is either <tt>PR_SYS_DISPATCH_ON</tt> or
<tt>PR_SYS_DISPATCH_OFF</tt>.  In the former case, system-call trapping
will be enabled; in the latter it is turned off.  The <tt>start</tt> and
<tt>end</tt> addresses indicate a range of memory from which system calls
will not be trapped, even when it is enabled; that is the place to put the
code that performs the system-call emulation.  The <tt>selector</tt>
argument is a pointer to a byte in memory that provides another mechanism
to toggle system-call trapping.
<p>
When this feature is enabled with <tt>PR_SYS_DISPATCH_ON</tt>, the kernel
sets a flag (<tt>_TIF_SYSCALL_USER_DISPATCH</tt>) in the process's task
structure.  This flag is tested whenever the process makes a system call.
If it is set, a further check is made to the memory pointed to by the
provided <tt>selector</tt>; if the value stored there is
<tt>PR_SYS_DISPATCH_OFF</tt>, the system call will be executed normally.
If, instead, that location holds <tt>PR_SYS_DISPATCH_ON</tt>, the kernel
will deliver a <tt>SIGSYS</tt> signal to the process.
<p>
The signal handler can then examine the register set at the time of the
trap; that will indicate which system call was being made and its
arguments.  That call can be emulated in the handler; once the handler
returns, the process will resume after the trapped system call.  This
handler must be placed in the special system-calls-allowed region of memory
or things will not work well, even in the unlikely case that the handler
makes no system calls of its own.  In Linux, returning from a signal
handler involves the special <a
href="https://man7.org/linux/man-pages/man2/sigreturn.2.html"><tt>sigreturn()</tt></a>
system call, which must be able to execute without trapping (recursively) into
the handler.
<p>
The special <tt>selector</tt> variable allows trapping to be quickly
enabled and disabled without the need to call into the kernel every time.
For a system like Wine, which moves frequently between Windows and
Linux-native code, that should result in a measurable performance
improvement.
<p>
The initial implementation of this mechanism received a lot of comments on
the mailing list.  This time, comments are limited to <a
href="/ml/linux-kernel/202007131715.5598282C@keescook/">one from Kees
Cook</a>, who said that it "<q>looks great</q>".  So the way would
seem to be clear for this feature to get into the mainline in the
relatively near future.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#System_calls">System calls</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/826313/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor826391"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2020 16:46 UTC (Fri)
                               by <b>tnemeth</b> (subscriber, #37648)
                              [<a href="/Articles/826391/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Are kernel developpers knowingly avoiding the implementation of a skin / personality mechanism ?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826391/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826393"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2020 17:55 UTC (Fri)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/826393/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Arguably, this *is* (part of) a skin / personality system, in much the same way as FUSE is (part of) a filesystem.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826393/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826397"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2020 18:34 UTC (Fri)
                               by <b>tnemeth</b> (subscriber, #37648)
                              [<a href="/Articles/826397/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Without a clear design it only looks like a kludge / dirty hack for just one single use case. Xenomai has this kind of feature (native, posix, ...). It could be a nice place to start looking for a similar architecture and do things &quot;right&quot; (IMHO: I&#x27;m not sure if I&#x27;m right here myself, not knowing the details :) ).<br>
<p>
Even if I&#x27;m not a particular fan of being able to run what I think is a bunch of ugly Windows applications, I do recognize that some (like my children) would like to play Windows games and I would much prefer running them under Linux than under Windows itself. I&#x27;m clearly afraid of security implications of such a mechanism.<br>
<p>
But if we go there, then why not add syscall support for other OSes like MacOS, Haiku, whateverOS...<br>
<p>
So it is a, not-full-fledged, hiding its name, part of a skin mechanism. Sorry :) I like clear views, clear APIs... and grumbling a lot.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826397/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826400"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2020 19:38 UTC (Fri)
                               by <b>krisman</b> (subscriber, #102057)
                              [<a href="/Articles/826400/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Without a clear design it only looks like a kludge / dirty hack for</font><br>
<font class="QuotedText">&gt; just one single use case. Xenomai has this kind of feature (native,</font><br>
<font class="QuotedText">&gt; posix, ...). It could be a nice place to start looking for a similar</font><br>
<font class="QuotedText">&gt; architecture and do things &quot;right&quot; (IMHO: I&#x27;m not sure if I&#x27;m right</font><br>
<font class="QuotedText">&gt; ahere myself, not knowing the details :) ).</font><br>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt; Even if I&#x27;m not a particular fan of being able to run what I think is a</font><br>
<font class="QuotedText">&gt; bunch of ugly Windows applications, I do recognize that some (like my</font><br>
<font class="QuotedText">&gt; children) would like to play Windows games and I would much prefer</font><br>
<font class="QuotedText">&gt; running them under Linux than under Windows itself. I&#x27;m clearly afraid</font><br>
<font class="QuotedText">&gt; of security implications of such a mechanism.</font><br>
<p>
Can you forward any specific security concerns that are not already mitigated to the original thread?  We definitely want to have a good look at any security implications of this feature.  I expect that most issues would be mitigated by making it unable to cross fork/exec boundaries.<br>
<p>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt; But if we go there, then why not add syscall support for other OSes like</font><br>
<font class="QuotedText">&gt; MacOS, Haiku, whateverOS...add specific support for any platform in the kernel.</font><br>
<p>
The goal is to provide an infrastructure for emulation in userspace.  This means exactly that we don&#x27;t need to go adding support for whateverOS in the kernel. :)<br>
<p>
<font class="QuotedText">&gt; So it is a, not-full-fledged, hiding its name, part of a skin</font><br>
<font class="QuotedText">&gt; mechanism. Sorry :) I like clear views, clear APIs... and grumbling a</font><br>
<font class="QuotedText">&gt; lot.</font><br>
<p>
We try to solve most emulation issues in userspace, unless it really needs to be in the kernel (i.e. the stuff in personality(2)).  I&#x27;d say to not expect a generic skin interface beyond specific features to solve pain points for userspace emulation.<br>
<p>
But, saying we are hiding it is not fair. In fact, I called it a personality mechanism in my first submission, but we dropped that name to avoid confusion.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826400/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826413"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2020 21:49 UTC (Fri)
                               by <b>tnemeth</b> (subscriber, #37648)
                              [<a href="/Articles/826413/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &gt; I&#x27;m clearly afraid of security implications of such a mechanism.</font><br>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt; Can you forward any specific security concerns that are not already mitigated to the original</font><br>
<font class="QuotedText">&gt; thread? We definitely want to have a good look at any security implications of this feature. I</font><br>
<font class="QuotedText">&gt; expect that most issues would be mitigated by making it unable to cross fork/exec boundaries.</font><br>
<p>
    Of course not. This is just a /personnal fear/. I have a profound distrust in anything that runs<br>
    under Windows. Not that I trust blindingly softwares that runs on Linux, but I&#x27;ve seen so many<br>
    malware hidden in documents, images and vulnerabilities even in windows softwares made by<br>
    &quot;security&quot; teams (last time I had been affected was with Cisco Webex) that I can imagine that<br>
    some ways will be explored to gain access to a Linux system through faulty Windows<br>
    programs.<br>
<p>
<p>
<font class="QuotedText">&gt; The goal is to provide an infrastructure for emulation in userspace. This means exactly that we</font><br>
<font class="QuotedText">&gt; don&#x27;t need to go adding support for whateverOS in the kernel. :)</font><br>
<p>
    It&#x27;s, indeed, better out of the kernel. So a fuse-like API for personalities :)<br>
<p>
<p>
<font class="QuotedText">&gt; But, saying we are hiding it is not fair. In fact, I called it a personality mechanism in my first</font><br>
<font class="QuotedText">&gt; submission, but we dropped that name to avoid confusion.</font><br>
<p>
    I&#x27;m sorry, I didn&#x27;t mean to be unfair. I missed that point (I do not follow LKML anymore).<br>
<p>
    Thank you for clearing my mind :)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826413/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826432"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 18, 2020 17:45 UTC (Sat)
                               by <b>smcv</b> (subscriber, #53363)
                              [<a href="/Articles/826432/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I have a profound distrust in anything that runs under Windows. Not that I trust blindingly softwares that runs on Linux, but I&#x27;ve seen so many malware hidden in documents, images and vulnerabilities even in windows softwares made by &quot;security&quot; teams</font><br>
<p>
Wine is already not a security mechanism. If you want to run Windows software with lower privilege than your normal login account, you&#x27;ll need to run Wine in a less-privileged environment using container namespaces, LSMs and/or seccomp (for example a Flatpak, Snap or Docker container), as a separate uid, or in a virtual machine.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826432/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor826557"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2020 20:03 UTC (Mon)
                               by <b>plugwash</b> (subscriber, #29694)
                              [<a href="/Articles/826557/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It&#x27;s, indeed, better out of the kernel. So a fuse-like API for personalities :)</font><br>
<p>
This leads to the question that if a &quot;personality&quot; is going to be implemented in userland should it be implemented in the same process as the foreign code or a separate process.<br>
<p>
There are pros to both approaches.<br>
<p>
Pros of same process:<br>
<p>
* The performance cost of switching context between processes is avoided.<br>
* The emulation code can easily access data belonging to the foreign code through pointers <br>
* For a foreign platform (like windows) where the &quot;normal&quot; interface is defined as a library ABI, not a syscall ABI most calls don&#x27;t have to go through the emulation process at all.<br>
<p>
Pros of separate process<br>
<p>
* The foreign code cannot deliberately or accidentally mess with the emulation code.<br>
* The foreign code can use the address space however it needs (wine has to use some fairly dirty tricks to allow non-relocatable windows binaries to be loaded in the required location)<br>
* There is no need for a special mechanism to switch back and forth between regular syscall mode and foreign syscall mode.<br>
* The system could potentially be used for security sandboxing as well as foreign code support.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826557/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor826846"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2020 13:51 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/826846/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Can you forward any specific security concerns that are not already mitigated to the original thread? We definitely want to have a good look at any security implications of this feature. I expect that most issues would be mitigated by making it unable to cross fork/exec boundaries.</font><br>
<p>
Quite. This has no more security implications than a signal handler (to which it is very similar), so as long as it takes the same approach (reset signal handlers on address space reset at exec() time) we should be fine. Sure, if you use this mechanism *wrong* all sorts of things can happen, but the same is true of signal handlers and indeed of general bugs in code. The implications are no worse, except that making a mistake here is more likely to be obvious because it will probably break the program&#x27;s use of lots of syscalls at once :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826846/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor826571"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2020 13:28 UTC (Tue)
                               by <b>Funcan</b> (subscriber, #44209)
                              [<a href="/Articles/826571/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;d say that they&#x27;re implementing &#x27;personalities&#x27; the same way they did containers - provide the facilities known needed right now, and let anybody built a &#x27;product&#x27; around them - adding new feature as needed. This allows multiple parallel efforts at producing a &#x27;product&#x27; and iteration, rather than trying to design everything in advance, which history suggests works badly.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826571/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826848"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2020 13:53 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/826848/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Threads were added the same way, and the result was eventually a best-in-class threading implementation which does not fill the kernel with complexity related to one specific threading model. Seems like a good approach to me too (though if you&#x27;d asked me back in the year 2000 when LinuxThreads was the only threading implementation out there, I might have said something different!)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826848/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826904"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2020 21:02 UTC (Thu)
                               by <b>BenHutchings</b> (subscriber, #37955)
                              [<a href="/Articles/826904/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is not what happened with threads. The kernel APIs that supported LinuxThreads were not sufficient to build a compliant POSIX threads implementation. The New POSIX Threads Library (NPTL) that eventually replaced LinuxThreads required additional kernel APIs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826904/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826999"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 24, 2020 22:08 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/826999/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It did -- but this wasn&#x27;t done the way (say) Solaris did it, by piling the entire threading abstraction into the kernel and complicating the bejeezus out of everything. Instead we got away with a few relatively simple and noninvasive things: thread groups, a bit of tweaking to signal handling (which was painful, sure, but much less painful than almost everything else around signal handling already was and is), futexes, and some nice souping up to PID allocation so you could have silly numbers of them.<br>
<p>
(And a good few of those abstractions were, I vaguely recall, there *already*, and used by LinuxThreads: tgids, for instance. I&#x27;m sure futexes were new for NPTL though.)<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826999/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor828516"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2020 15:50 UTC (Tue)
                               by <b>Ericson2314</b> (guest, #139248)
                              [<a href="/Articles/828516/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think there should be both. This is a *dynamic* way to control the meaning of syscalls, personalities area *static* way.<br>
<p>
In general, it&#x27;s not good to force the use of dynamic solutions to static needs, even though the dynamic one is strictly more expressive. It&#x27;s good to be static where possible because it better conveys intent, is simpler to reason about, especially w.r.t. security, and can be better optimized.<br>
<p>
I think Linux should have this and personalities. For example, there could be a native personality, a Windows personality (via Kernel module, let&#x27;s say), and a way to disjoint-union (sum) personalities via name-spacing (e.g. a tag big) somewhere in memory or registers. Then Wine can use this in combination with the native+windows union personality, and the trampoline just neeeds to set the Windows-or-Linux bit, letting the kernel do the rest.<br>
<p>
I separately want personalities to revive Capsicum/CloudABI on Linux. And the dynamic mechanism alone is a dubious way to do something as security-critical as that.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/828516/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor828560"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2020 18:15 UTC (Tue)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/828560/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <p>Note that <a href="https://elixir.bootlin.com/linux/latest/source/include/uapi/linux/personality.h">personalities already exist</a> in Linux, as a kernel-side concept.
<p>It looks like the only non-Linux personality that hasn't bitrotted to the point of removal is https://elixir.bootlin.com/linux/latest/source/arch/alpha/kernel/osf_sys.c
      
          <div class="CommentReplyButton">
            <form action="/Articles/828560/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor828571"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2020 19:50 UTC (Tue)
                               by <b>Ericson2314</b> (guest, #139248)
                              [<a href="/Articles/828571/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks for letting me know!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/828571/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor828562"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2020 19:06 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/828562/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The problem with classic personalities is that they are very shallow. They can be used to adapt syscalls, but little else.<br>
<p>
Fully emulating Windows requires much more infrastructure. Windows has completely different synchronization primitives, different IO stack (IOCP!), and a different thread and process model.<br>
<p>
You need a LOT of code to emulate all of this. You can put it into the kernel (and there were projects that basically put Wine into kernel mode), but the chances of it getting merged are nil.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/828562/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor828570"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2020 19:50 UTC (Tue)
                               by <b>Ericson2314</b> (guest, #139248)
                              [<a href="/Articles/828570/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes absolutely agreed. Being able to do &quot;deep&quot; stuff would basically require &quot;composition over configuration&quot;, so an exokernel, to reign in the complexity. Great idea, but Linux absolutely is not that.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/828570/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor828572"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2020 19:51 UTC (Tue)
                               by <b>Ericson2314</b> (guest, #139248)
                              [<a href="/Articles/828572/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That&#x27;s why I brought up Capsicum / CloudABI. It&#x27;s about the most interesting thing that can be done that is &quot;shallow&quot;.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/828572/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor841564"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 2, 2021 10:50 UTC (Sat)
                               by <b>ras</b> (subscriber, #33059)
                              [<a href="/Articles/841564/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is a very late comment I guess, buts that&#x27;s mostly because I still don&#x27;t know what is being proposed.<br>
<p>
<font class="QuotedText">&gt; The problem with classic personalities is that they are very shallow. They can be used to adapt syscalls, but little else.</font><br>
<p>
I presume that means the design of personality API forces you to place the code in the kernel.  &quot;The code&quot; is something using Linux to emulate the foreign syscall.  I can tell you with reasonable authority[0] that&#x27;s true.<br>
<p>
Surprisingly the code doesn&#x27;t care where it lives.  In fact it mostly doesn&#x27;t change.  Even if the code was a kernel module moving to user space.  I know that because I&#x27;ve done it [1].<br>
<p>
I can also tell you from the maintainer of the said code&#x27;s perspective, user space is the nicer place to be.  Far, far, far nicer.  To paint the picture, the kernel code I maintained has to do syscall&#x27;s in some way.  Why syscall&#x27;s?  Because they are the only interface in the kernel that&#x27;s stable, and life&#x27;s far too short spend it migrating out of tree code to each kernel version.  But getting to syscall table was mission bloody impossible.  The mechanism I inherited was unwinding the kernel stack, disassembling return addresses until you found the code that dispatched to you, then extract the pointer to the syscall table from the previous instruction.  (Sorry if I wrecked your meal.)  This is of course not easy to port between kernel versions either, but at least you are porting just one obnoxious thing.<br>
<p>
Turns out there is only one real challenge to moving it to user space.  That is getting the kernel to deliver the syscall to some user space trampoline address.   That ends up in being one of two challenges.  The first kind is when the syscall mechanism is what the Linux kernel uses.  In that case is becomes &#x27;redirect any syscall outside of the trampoline range to the trampoline&#x27;.  This case is covered in the article.<br>
<p>
The 2nd kind is when the syscall mechanism is not what the kernel uses.  A software interrupt is the obvious way, but the x86 / amd64 designers in particular have displayed commendable imaginative flair in this area.  However, in every case I&#x27;ve seen the mechanism is illegal to do in user space, so either the kernel handles it, or it&#x27;s SIGSEGV.  So all you have to do is arrange for that mechanism (whatever it is) to boomerang to an address in the trampoline, with minimal overhead.<br>
<p>
Handling the second case doesn&#x27;t seem hard: a standardised API like syscall_trap(SYSCALL_TRAP_INT80, trampoline_trap, trampoline_begin, trampoline_end, flags), a kernel module for each SYSCALL_TRAP_??? mechanism.  Job done.<br>
<p>
How the proposed mechanism do this is a bit of a mystery.  I guess I should look at the code.<br>
<p>
[0] <a href="http://ibcs64.sourceforge.net/">http://ibcs64.sourceforge.net/</a><br>
[1] http://ibcs-us.sourceforge.net/<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/841564/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor826403"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2020 19:42 UTC (Fri)
                               by <b>TheGopher</b> (subscriber, #59256)
                              [<a href="/Articles/826403/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So this provides a clear path for Microsoft to move to the linux kernel, right or left?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826403/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826434"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 18, 2020 23:00 UTC (Sat)
                               by <b>clump</b> (subscriber, #27801)
                              [<a href="/Articles/826434/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It might be fun if Microsoft used Linux more. Linux is already well-represented in Azure workloads. That said, &quot;the cloud&quot; is where operating systems are often viewed as commodities. <br>
<p>
I have an Android phone because it uses Linux. I can&#x27;t say I&#x27;m happy with it. Android is a privacy nightmare, has abysmal security, and keeps internals away from the user. Not very Linux-like.<br>
<p>
Microsoft could do more with Linux but if the experience turns out like Android, I wouldn&#x27;t be interested.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826434/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826436"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2020 1:24 UTC (Sun)
                               by <b>ncm</b> (guest, #165)
                              [<a href="/Articles/826436/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Maybe it is a good time to start watching efforts to make a platform to run Postmarket or Mobian phone OSes, such as Librem 5 and, especially, PinePhone, and maybe to participate in getting them ready for wider use, or set up recurring donations.<br>
<p>
You might start with reducing dependence on Signal, moving to the Matrix/Element end-to-end encrypted message infrastructure, which has proven to be more portable to different platforms. <br>
<p>
Maybe pre-order a PinePhone for $200. (Hint: if you do, make sure the phone is the only thing in the shopping cart. Order other stuff separately.)<br>
<p>
I have no affiliaton with Pine or Purism, besides outstanding orders.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826436/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826437"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2020 2:45 UTC (Sun)
                               by <b>gus3</b> (guest, #61103)
                              [<a href="/Articles/826437/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Something tells me you&#x27;re spamming. Your comment has nothing to do with the article, or the topic of the thread.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826437/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826442"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2020 9:38 UTC (Sun)
                               by <b>ldearquer</b> (guest, #137451)
                              [<a href="/Articles/826442/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
To me it certainly looks connected to the comment it replies to...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826442/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826459"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2020 23:17 UTC (Sun)
                               by <b>ncm</b> (guest, #165)
                              [<a href="/Articles/826459/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Indeed, it is a response directly to the comment that it is a response to.<br>
<p>
Topics do drift. That is not a bug.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826459/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826480"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2020 13:12 UTC (Mon)
                               by <b>clump</b> (subscriber, #27801)
                              [<a href="/Articles/826480/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Your comment was also quite useful in reminding myself and others that the mobile phone situation isn&#x27;t hopeless. We can and should support development efforts that are more respectful toward users. The PinePhone in particular looks nice.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826480/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor826555"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2020 19:52 UTC (Mon)
                               by <b>Jandar</b> (subscriber, #85683)
                              [<a href="/Articles/826555/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Something tells me you&#x27;re spamming. Your comment has nothing to do with the article, or the topic of the thread.</font><br>
<p>
The parent-post said:<br>
<font class="QuotedText">&gt; Android is a privacy nightmare, has abysmal security, and keeps internals away from the user. Not very Linux-like.</font><br>
<p>
So talking about non-Android Linux phones is very on topic.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826555/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826556"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2020 19:53 UTC (Mon)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/826556/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The article is about emulating Windows system calls, so non-Android Linux phones are nothing but offtopic.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826556/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826570"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2020 11:33 UTC (Tue)
                               by <b>Jandar</b> (subscriber, #85683)
                              [<a href="/Articles/826570/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The article is about emulating Windows system calls, so non-Android Linux phones are nothing but offtopic.</font><br>
<p>
So either Android and non-Android Linux phones are off topic (regarding the article). But not the criticized post had started to write about them but the parent-post and reacting to existing topics in a discussion can&#x27;t be off topic relating to the discussion. It can be off topic regarding the parent article but calling a direct response to something mentioned in another comment &quot;spamming&quot; is dishonest.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826570/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor826446"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2020 12:06 UTC (Sun)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/826446/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Uh, Android has massively better security by any standard that I can think of than mainstream Linux does. Extensive custom SELinux rules, a per-app permission system, every app runs in its own Unix uid... you couldn&#x27;t do this to desktop Linux without rewriting everything.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826446/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826452"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2020 19:29 UTC (Sun)
                               by <b>clump</b> (subscriber, #27801)
                              [<a href="/Articles/826452/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I respectfully disagree. Security features are nice, but you have only to look at &quot;all permissions&quot; for nearly any application installed by default on Android. Look at Google Play Services, which includes the following mandatory permissions:<br>
<p>
&quot;disable your screen lock&quot;<br>
&quot;have full network access&quot;<br>
&quot;record audio&quot;<br>
&quot;access location in the background&quot;<br>
&quot;take pictures and videos&quot;<br>
&quot;reroute outgoing calls&quot;<br>
<p>
I can&#x27;t remove these permissions. I can&#x27;t audit their use. I can&#x27;t examine the source code. Not my idea of secure, private, or user-respecting. <br>
<p>
If pointing out issues with Google Play Services is too easy, look at &quot;all permissions&quot; for other apps. There is also the matter of Android&#x27;s exploit track record, and all of the well-documented issues with applications served from the official Google Play Store. <br>
<p>
My point is that Android uses Linux but offers none of its benefits.<br>
<p>
<p>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826452/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826473"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2020 12:35 UTC (Mon)
                               by <b>nim-nim</b> (subscriber, #34454)
                              [<a href="/Articles/826473/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
All the &quot;privacy&quot; initiatives Google sponsored in the past years have been trying to protect Android and Chrome data both from &quot;evil&quot; telco operators/ FSB / CIA / whatever and &quot;evil&quot; users. Google documents will not call it that way, but they will dismiss any actual user control because of straw-men like social engineering… The truth is the only power Google wants to give users is the power to do things Google agrees with.<br>
<p>
You can not understand Android or Chrome security choices if you do not acknowledge they are extensions of Google IT, and the user is outside the target security perimeter.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826473/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor826809"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2020 10:22 UTC (Thu)
                               by <b>domenpk</b> (guest, #12382)
                              [<a href="/Articles/826809/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What you write is valid criticism, but it&#x27;s not a comparison in any sort of way.<br>
<p>
What&#x27;s the permission system on common Linux desktop like? Most &quot;apps&quot; are running under same UID, have access to all the data users actually care about, many peripherals etc.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826809/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826845"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2020 13:59 UTC (Thu)
                               by <b>clump</b> (subscriber, #27801)
                              [<a href="/Articles/826845/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You&#x27;re right about typical distributions. However the security features of Android are useless if the user has no choice but to accept all or none of an application&#x27;s permissions. Some Android applications allow users to disable some permissions, while some applications fail to function at all unless you accept everything. Worst of all you have no choice whatsoever about which applications can use networking. <br>
<p>
Android&#x27;s additional security features are meaningless in practice. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826845/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826852"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2020 14:47 UTC (Thu)
                               by <b>pizza</b> (subscriber, #46)
                              [<a href="/Articles/826852/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Android&#x27;s additional security features are meaningless in practice. </font><br>
<p>
Incorrect.<br>
<p>
Android completely isolates applications from each other.  One application cannot see/access the data of another.<br>
<p>
<font class="QuotedText">&gt; However the security features of Android are useless if the user has no choice but to accept all or none of an application&#x27;s permissions. </font><br>
<p>
That sounds like a problem brought on by using proprietary software, not the underlying permission/security model.<br>
<p>
Android&#x27;s model requires those permissions to be explicitly stated and granted, which is a huge step forward from the free-range model of a traditional desktop environment (Linux or Windows or whatever)  -- where applications have carte blanche to do pretty much whatever they want -- including audio, video, networking, and access to every file the user has.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826852/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826854"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2020 16:20 UTC (Thu)
                               by <b>clump</b> (subscriber, #27801)
                              [<a href="/Articles/826854/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Android completely isolates applications from each other. One application cannot see/access the data of another.</font><br>
<p>
Unless the storage permission is required which makes the external storage a free-for-all.  I trust you&#x27;d agree that there&#x27;s plenty of valuable application and user data on the external storage.<br>
<p>
Great points about a traditional desktop environment. An exploit or hostile application shouldn&#x27;t allow the compromise of a user&#x27;s entire home directory by default. We can and should do better. <br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826854/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor826569"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2020 9:36 UTC (Tue)
                               by <b>rvolgers</b> (guest, #63218)
                              [<a href="/Articles/826569/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not really, as the proposed mechanism clearly puts the emulated system calls at a performance disadvantage vs native Linux system calls.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826569/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor826414"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2020 22:42 UTC (Fri)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/826414/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This sounds great for its intended use-case. Unfortunately rr (or any other ptracer) won&#x27;t be able to use it as-is for our syscall interception, because the SIGSYS signal would trigger a ptrace trap which would kill performance. I guess that would be fixable with more kernel API work.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826414/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor826415"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2020 23:21 UTC (Fri)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/826415/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
*ahem*. I had one or two comments on it too :-P<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826415/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor826433"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 18, 2020 20:40 UTC (Sat)
                               by <b>meyert</b> (subscriber, #32097)
                              [<a href="/Articles/826433/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This could probably replace the current UML mechanism, not sure if something is gained so...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826433/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor826443"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2020 10:22 UTC (Sun)
                               by <b>pebolle</b> (guest, #35204)
                              [<a href="/Articles/826443/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The selector argument is a pointer to a byte in memory that provides another mechanism to toggle system-call trapping. </font><br>
<p>
This tripped me over the first time I read it. It&#x27;s a few paragraphs later that one learns that it&#x27;s not &quot;another&quot; mechanism but actually the last step in this implementation of syscall trapping.  So something like:<br>
<p>
&quot;The selector argument is a pointer to a variable that is used by the kernel to check whether system-calls should actually be trapped.&quot;<br>
<p>
might be less confusing.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826443/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826447"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2020 15:28 UTC (Sun)
                               by <b>pebolle</b> (guest, #35204)
                              [<a href="/Articles/826447/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Except my proposal now misses that the selector is optional. Which the article also does, knowing Jon&#x27;s writing probably on purpose, to keep things readable.<br>
<p>
Is that optional selector enough to call the interface complicated?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826447/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor826448"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2020 15:25 UTC (Sun)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/826448/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Does wine support WSL2 ?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826448/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor826450"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2020 18:17 UTC (Sun)
                               by <b>quotemstr</b> (subscriber, #45331)
                              [<a href="/Articles/826450/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
WLS2 is just a VM.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/826450/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor827045"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2020 1:18 UTC (Mon)
                               by <b>jeremy</b> (guest, #95247)
                              [<a href="/Articles/827045/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; As a reminder, the intent of this work is to enable the running of Windows binaries that call directly into the Windows kernel without going through the Windows API.</font><br>
<p>
I think you meant to say &quot;Linux kernel&quot; here?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/827045/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor827046"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2020 1:29 UTC (Mon)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/827046/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No, the binaries call directly into the Windows kernel. The goal is to be able to intercept those calls in order to run the binaries on Linux.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/827046/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor827052"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2020 4:18 UTC (Mon)
                               by <b>jeremy</b> (guest, #95247)
                              [<a href="/Articles/827052/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks, it looks like I clearly misread the article. Not only that, but I evidently didn’t read the guideline in the comment posting section saying:<br>
<p>
<font class="QuotedText">&gt; Please do NOT post typos in the article as comments, send them to lwn@lwn.net instead.</font><br>
<p>
That’s a double whammy on me for my first ever LWN comment. Please excuse me while I crawl inside my shame cube...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/827052/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor827642"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Emulating Windows system calls, take 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 31, 2020 8:03 UTC (Fri)
                               by <b>jezuch</b> (subscriber, #52988)
                              [<a href="/Articles/827642/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You&#x27;re a subscriber so I guess it&#x27;s forgiven ;) (also, this was IMO a genuine question im quest of understanding, not a typo report)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/827642/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2020, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
