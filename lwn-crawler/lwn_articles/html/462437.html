        <!DOCTYPE html>
        <html lang="en">
        <head><title>Securely deleting files from ext4 filesystems [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/462437/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/461866/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/462437/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Securely deleting files from ext4 filesystems</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>LWN.net needs you!</b>
<p>
Without subscribers, LWN would simply not exist.  Please consider
       <a href="/Promo/nst-nag2/subscribe">signing up for a subscription</a> and helping
       to keep LWN publishing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>October 11, 2011</br>
           </div>
Deleting a file is sufficient to make it go away as far as the directory
structure is concerned; that important, not-backed-up document is gone
before the careless user has even removed a repentant finger from the
"enter" key.  On the underlying storage device, though, parts or all of the
doomed file can live on indefinitely.  A suitably determined person
can often recover data from a file that was thought to be deleted and
gone.  In some situations, this persistence of data can be most unwelcome.
Paper shredders exist for situations where recovery of a "deleted" paper
document is undesirable; there is clear value in a similar functionality
for filesystem-based files.
<p>
A look at the <tt>chattr</tt> man page indicates that "secure delete"
functionality can be enabled for a file by setting the right attribute
flag.  The only problem is that most filesystems do not actually honor that
flag; it's a sort of empty security theater.  Even the TSA does a better job.  The
<a href="/Articles/462398/">ext4 
secure delete patch set</a> from Allison Henderson may fill that particular
gap for the ext4 filesystem, but a few things will need to be fixed up
first.
<p>
The core part of the patch is relatively straightforward: if part or all of
a file is being deleted, the relevant blocks will be overwritten
synchronously as part of the operation.  By default, the blocks are
overwritten with zeroes, but there is an option to use random bytes from
the kernel's entropy pool instead.  A bit of care must be taken when the
file involved contains holes - it wouldn't do to overwrite blocks that
don't exist.  There is also some logic to take advantage of the "secure
discard" feature supported by some devices (solid-state disks, primarily)
if that feature is available.  Secure discard handles the deletion
internally to the device - perhaps just by marking the relevant blocks
unreadable until something else overwrites them - eliminating the need to
perform extra I/O from the kernel.
<p>
The job does not stop there, though.  The very existence of the file - or
information contained in its name - could be sensitive as well.  So the
secure delete code must also clear out the directory entry associated with
the file (if it is being deleted, as opposed to just truncated,
obviously).  Associated metadata - extended attributes, access control
lists, etc - must also be cleaned out in this way.
<p>
Then there is the little issue of the journal.  At any given time, the
journal could contain any number of blocks from the deleted file, possibly
in several versions.  Clearly, sanitizing the journal is also required, but
it must be done carefully: clearing journal blocks before the associated
transaction has been committed could result in a corrupted filesystem
and/or the inability to recover properly from a crash.  So the first thing
that must happen is a synchronous journal flush.
<p>
Once any outstanding transactions have been cleared, the (now old and
unneeded) data in the journal can be cleaned up.  The only problem is that
the journal does not maintain any association between its internal blocks
and the files they belong to in the filesystem.  The patch addresses that
problem by adding a new data structure mapping between journal blocks and
file blocks; the secure deletion code then traverses that structure in
search of blocks in need of overwriting.
<p>
The journal cleanup code drew some complaints from developers; the first
problem is that directory and metadata blocks are not cleared from the
journal.  The deeper complaint, though, was that it represented an
excessive mixing of the two layers; the filesystem really should not have
an overly deep understanding of how the journal works.  The end result is
that some of this cleanup work is likely to move into the jbd2 journaling
layer; as an added benefit, other filesystems should then be able to take
advantage of it as well.
<p>
Darrick Wong also <a href="/Articles/462440/">pointed out</a> that this
block mapping is not, itself, written to the journal; if the system were to
crash before the journal could be cleaned, that cleanup would not happen
after a reboot.  He suggested that filesystems should mark blocks in need
of secure deletion when they are first added to a journal transaction; the
journal code could take care of things from then on.  It seems like a
cleaner solution, but there is, naturally, a catch.
<p>
That catch is that there is no way to create a file with the "secure
delete" attribute set; that attribute must be added after the fact.  One
would assume that users would ask for secure delete before actually writing
any data to the file, but associated information (the file name, for
example) must exist before the file can be so marked.  So the journal may
well contain blocks for "secure delete" files that will not be marked for
overwriting.  There is no way to fix that within the existing POSIX API.
<p>
Darrick suggested a few ways to deal with this problem.  One is to just
give up and tell developers that, if even the name of the file is
important, they should create that file under a temporary name, set the
"secure delete" attribute, then rename the file to its real name.  An
alternative would be to mark the blocks for <i>all</i> newly-created files
as needing overwriting; that would eliminate the race to get the attribute
set at the cost of slowing down all file creation operations.  Or, he said,
the journal could track the mapping between blocks and files, much as
Allison's patch does.  One other option would be to mark the entire
filesystem as needing secure delete; that feature, evidently, is already in
the works, but enabling it will have an obvious performance cost.
<p>
The end result is that there are a few details to be worked out yet.  The
feature seems useful, though, for users who are concerned about data from
their files hanging around after the files themselves have been deleted.
Perhaps, around the 3.3 kernel or thereafter, "<tt>chattr&nbsp;+s</tt>" on
ext4 will be more than bad security theater.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems-ext4">Filesystems/ext4</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-Security_technologies">Security/Security technologies</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/462437/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor462861"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 2:45 UTC (Thu)
                               by <b>lemmings</b> (guest, #53618)
                              [<a href="/Articles/462861/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Perhaps it would be better to just remove the feature given that it has never worked and that it is impossible to make it work in all situations (sector remapping, most SSDs, old sectors, network block devices).<br>
<p>
It would be much better for distributions to "standardise" on an easy to use encrypted store for applications.<br>
<p>
Something like a more generic version of AegisFS which Nokia made for the N9/N950 could be ideal:<br>
<p>
<a href="http://harmattan-dev.nokia.com/docs/library/html/guide/html/Developer_Library_Developing_for_Harmattan_Harmattan_security_Security_guide_Using_Harmattan_security_features.html#Protecting_the_server.27s_data_store_transparently">http://harmattan-dev.nokia.com/docs/library/html/guide/ht...</a><br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/462861/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor462871"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 4:08 UTC (Thu)
                               by <b>idupree</b> (guest, #71169)
                              [<a href="/Articles/462871/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Do you have more information on AegisFS?  I could tell from your link and Google that it's a FUSE filesystem that cryptographically hides data, and that it has an (unrelated?) affinity with .zip files.  If the documentation doesn't say it does everything that this ext4 secure-delete feature does for you, then it probably doesn't.<br>
<p>
This deletion feature already goes beyond what you get from using either of two popular Linux crypto filesystems:<br>
<p>
If you use LUKS/dm-crypt and you "rm" a file.  If you securely delete it then no one can ever read it (except by physical surgery on the hard drive or other copies of the data).  If you plainly delete it, the data persists, and if someone breaks your encryption* then they might still be able to read it. (*via live system compromise, or someone guessing your encryption password, or your mind having a fit of remorse (or coercion) and wanting to read the data even though your company or past self wanted it deleted, etc.)<br>
<p>
If you use eCryptfs, it currently doesn't even attempt to hide the filenames.  ( <a href="http://ecryptfs.sourceforge.net/ecryptfs-faq.html#filename-enc">http://ecryptfs.sourceforge.net/ecryptfs-faq.html#filenam...</a> ).  This article's secure delete does attempt to delete the filenames.  I don't see anything about secure deletion in this eCryptfs FAQ either, so relying on eCryptfs may also have the same risks I described under LUKS/dm-crypt.<br>
<p>
Even a single pass of overwriting with zeroes, even on a drive with sector remapping, would prevent casual electronic attacks: someone would have to physically obtain and open the drive to get the data out.  (Or the drive could have firmware bugs. Alas. Is this common?)  Neither layers that stack under the filesystem (dm-crypt) or over (eCryptfs; maybe AegisFS) quite have the ability to make a file impossible for root-with-all-the-passwords to access again (well, dm-crypt can do it by removing the whole filesystem at once...).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/462871/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor462881"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 4:29 UTC (Thu)
                               by <b>idupree</b> (guest, #71169)
                              [<a href="/Articles/462881/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Actually, perhaps eCryptfs allows encrypting filenames now; that FAQ looks out of date.  I am trying to find if there is a current, authoritative or thorough, source of documentation.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/462881/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463014"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 16:58 UTC (Thu)
                               by <b>bronson</b> (subscriber, #4806)
                              [<a href="/Articles/463014/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Maybe the FAQ meant "shared encryption of filenames is a planned feature?"
<p>
Filenames are definitely encrypted:
<pre>
6iunrlZi-dPSMlPILVYHNzf6  hmHIsA,bJvYNyeZHLfsymDqJ  w-n3rfYuKwJ-tzutdvQFHptg
aMZxjk4YBpJ9RduR24WILNZL  JwXaP3iCGg6qnvRy,tACFneM  wyLevtLXq4lPaJ6lQY42TO2b
atquOpNlClvXb-ebMwIN2Unq  ObCNzE4DugID75tRzXh9nw-x  XhpFHg8UPto8c8GbAitAgcnN
dy3BqGdPF,IZxDIZY9Flvg96  WjwZb6kosJEaMepnDYuJKmat  yYAxEsFk-33ftNf5c97exIwU
</pre>
File sizes and directory structure, however, are not.  They can still leak a fair amount of information.  For me that's no big deal...  I don't mind too much if someone figures out where I store my financial documents as long as they can't read the names and numbers.
      
          <div class="CommentReplyButton">
            <form action="/Articles/463014/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor462888"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 5:02 UTC (Thu)
                               by <b>lemmings</b> (guest, #53618)
                              [<a href="/Articles/462888/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Unfortunately there is not much in the way of docs available. The source code is at:<br>
<p>
<a href="http://meego.gitorious.org/meego-platform-security/aegis-crypto">http://meego.gitorious.org/meego-platform-security/aegis-...</a><br>
<p>
ecryptfs could work great for applications with a little bit of magic to provide a C library which would mount a ecryptfs directory into the process's name space (using unshare(2)). Would need to figure out how to do key management though.. Not sure if there is a freedesktop.org standard yet..<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/462888/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor462903"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 7:09 UTC (Thu)
                               by <b>djwong</b> (subscriber, #23506)
                              [<a href="/Articles/462903/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The use of the adverb "securely" is a bit unfortunate.  As you point out, ext4 can't control the behavior of the underlying hardware, which means that it can't guarantee that the deletion is actually secure.  You might have a SCSI bus analyzer that records every write sent to the drive, in which case ext4 tells you that the deletion is "secure" ... but someone else can easily reconstruct the file.<br>
<p>
A better name would be "make this file difficult to recover or undelete at the /dev/sdX block device interface level" delete, but that's clunky.  I suspect that this attribute is sort of an opposite to chattr +u, if you will.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/462903/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor462874"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What about shred(1)?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 3:57 UTC (Thu)
                               by <b>pr1268</b> (subscriber, #24648)
                              [<a href="/Articles/462874/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <p>Does this mean that using <tt>shred -u</tt> on files on an Ext4 FS are in vain?</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/462874/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor462902"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What about shred(1)?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 6:56 UTC (Thu)
                               by <b>djwong</b> (subscriber, #23506)
                              [<a href="/Articles/462902/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That depends -- if only the file contents are precious, then shred will securely wipe the data blocks, since with the default mount options, file data doesn't go through the journal.  If you're using data=journal mode, you can always write $JOURNAL_SIZE amount of data to fill up the journal thereby overwriting anything that was in it.  If, however, the metadata was also precious, then yes, shred alone might not have been sufficient.  Though it isn't difficult to change most of the fields in an inode/extent tree/attributes from userspace.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/462902/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor462908"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What about shred(1)?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 7:34 UTC (Thu)
                               by <b>lemmings</b> (guest, #53618)
                              [<a href="/Articles/462908/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes and no.<br>
<p>
With a magnetic hard disk, the writes from shred will overwrite the sectors which contain the data. There is a risk though of copies of the data being left on the platter in the event of bad sector remapping though.<br>
<p>
With a SSD, the writes from shred will be to new flash segments. With flash memory, erases and writes are separate operations. A SSD keeps a number of pre-erased segments around which are used to hold new writes whilst the old segments are erased in the background.<br>
<p>
At a higher level, depending on what applications manipulate the data, you may also have to watch out for deleted temporary copies of your file. A FS defiling tool (or at a minimum dd if=/dev/zero of=crud; shred -u crud) can help remove those traces.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/462908/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor462927"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What about shred(1)?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 8:57 UTC (Thu)
                               by <b>mjthayer</b> (guest, #39183)
                              [<a href="/Articles/462927/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; A FS defiling tool (or at a minimum dd if=/dev/zero of=crud; shred -u crud) can help remove those traces.</font><br>
<p>
Even better if that is build deeper into the filesystem, especially so that it can use the build-in capabilities of SSD drives.  Or then again, perhaps not - from the article, "Secure discard handles the deletion internally to the device - perhaps just by marking the relevant blocks unreadable until something else overwrites them - eliminating the need to perform extra I/O from the kernel."  Doesn't sound quite as safe as immediately overwriting the space.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/462927/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463085"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What about shred(1)?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 14, 2011 2:41 UTC (Fri)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/463085/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      An SSD <i>might</i> not securely delete the contents when requested.
<p>
On the other hand, it will almost <i>certainly</i> not delete the data if you attempt to delete by overwriting, because of wear leveling.
<p>
So going with secure delete/TRIM which will <i>probably</i> work, against overwriting which will probably <i>not</i> work, the choice is clear.
      
          <div class="CommentReplyButton">
            <form action="/Articles/463085/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463088"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What about shred(1)?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 14, 2011 3:02 UTC (Fri)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/463088/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The choice is clear, yes, use full-disk encryption...Tools like shred are probably not worth your time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463088/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463332"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">key management</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2011 14:19 UTC (Mon)
                               by <b>jpnp</b> (guest, #63341)
                              [<a href="/Articles/463332/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So now you've exchanged a media wiping problem for a key management problem, hardly a panacea.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463332/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463405"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">key management</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2011 21:50 UTC (Mon)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/463405/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Maybe not a panacea but a far more understandable and tractable problem.<br>
<p>
The alternative is storing everything in the clear and then making bad assumptions about how the underlying technology works so that you can try and fail to wipe the data when required because you don't really control or understand the underlying storage.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463405/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor463026"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What about shred(1)?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 18:09 UTC (Thu)
                               by <b>arjan</b> (subscriber, #36785)
                              [<a href="/Articles/463026/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I for one would not be surprised if magnetic disks start to do much more aggressive remapping for the non-bad-sector case to help performance(benchmarks) just in order to compete with SSD's...<br>
so I'd be rather hesitant to declare this "SSD only".<br>
<p>
And then there's caches on magnetic disks.. sometimes these are battery/capacitor backed... but they could be flash as well.<br>
<p>
The paranoid better encrypt in the higher levels. <br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463026/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor462880"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 4:31 UTC (Thu)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/462880/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wonder about the option to overwrite with random bytes rather than zeroes.  Does anyone seriously believe that on any modern storage medium you can recover data overwritten once with zeroes?<br>
<p>
See, among other sources, <a href="http://web.archive.org/web/20090616233917/http://sansforensics.wordpress.com/2009/01/15/overwriting-hard-drive-data/">http://web.archive.org/web/20090616233917/http://sansfore...</a> and <a href="https://www.infosecisland.com/blogview/16130-The-Urban-Legend-of-Multipass-Hard-Disk-Overwrite.html">https://www.infosecisland.com/blogview/16130-The-Urban-Le...</a> .  I've also previously seen substantial prizes offered for the demonstrated ability to recover data from a drive overwritten once with zeroes, none of them ever awarded.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/462880/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463056"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 21:20 UTC (Thu)
                               by <b>sciurus</b> (guest, #58832)
                              [<a href="/Articles/463056/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      It'a also worth citing Craig Wright, Dave Kleiman and Shyaam Sundhar R.S.'s <a href="http://www.springerlink.com/content/408263ql11460147/">Overwriting Hard Drive Data: The Great Wiping Controversy</a>
      
          <div class="CommentReplyButton">
            <form action="/Articles/463056/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463078"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 14, 2011 0:38 UTC (Fri)
                               by <b>njs</b> (guest, #40338)
                              [<a href="/Articles/463078/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Non-paywalled version: <a href="http://www.vidarholen.net/~vidar/overwriting_hard_drive_data.pdf">http://www.vidarholen.net/~vidar/overwriting_hard_drive_d...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463078/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463261"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 16, 2011 3:04 UTC (Sun)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/463261/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>I don't think I'd cite that paper.  It is poorly written, from the disorganized presentation of thoughts to the poor grammar (I lost count of the sentences with no verb).  That makes it hard to detect the theoretical basis for prior data not being recoverable.

<p>Maybe that doesn't matter because the paper also reports empirical results, with numerical conclusions of the probability of recovering prior data that are insignificantly small.  However, amazingly, the paper does not describe the method.  I.e. it does not say how the investigators attempted to recover the data.  (Maybe that is embedded in the ungrammatical and to me unintelligible sentence, "both drive skew and the bit was read.").

<p>One thing the paper sort of hints at is the reason I believe the conclusion -- that you can't recover prior data from an overwritten disk -- is true.  In the quest for greater density of current data, disk drive engineers have squeezed out whatever redundancy used to allow a drive to store both the current data and some of the prior data.

      
          <div class="CommentReplyButton">
            <form action="/Articles/463261/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor462911"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 7:53 UTC (Thu)
                               by <b>lolando</b> (guest, #7139)
                              [<a href="/Articles/462911/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Pardon me for a naïve question, but this "secure delete" will only delete/wipe/overwrite the current version of a file, right?  I won't even pretend I know whether a write to a currently existing file may end up using an entirely different set of blocks (so the later secure won't touch the initial set), but assuming the file shrinks in the meantime, an I right in guessing that the blocks between the previous EOF and the new EOF will be untouched?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/462911/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor462958"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 12:14 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/462958/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Ext4 will normally overwrite blocks (btrfs, instead, is copy-on-write).  The idea behind this patch set is that any blocks released from the file (as in the truncate case you mention) will be cleared/randomized by the filesystem code.
      
          <div class="CommentReplyButton">
            <form action="/Articles/462958/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor462968"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 13:11 UTC (Thu)
                               by <b>abatters</b> (<b>&#x272D; supporter &#x272D;</b>, #6932)
                              [<a href="/Articles/462968/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Don't forget to shred your swap space also.  And the slocate database.  And the recently used files list.  And your backups.  And ...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/462968/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463044"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2011 19:56 UTC (Thu)
                               by <b>NAR</b> (subscriber, #1313)
                              [<a href="/Articles/463044/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And the temporary .swp files created by vim. And ~/.bash_history. And ...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463044/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor463810"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Securely deleting files from ext4 filesystems</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 20, 2011 6:34 UTC (Thu)
                               by <b>kevinm</b> (guest, #69913)
                              [<a href="/Articles/463810/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Under the UNIX way of understanding the universe, the name of a file belongs to the directory that the file is in, not the file itself.  After all, a file may have many names.<br>
<p>
The logical conclusion of this is that the "secure delete" setting of the file itself should not affect whether the filename is securely deleted; rather, it is the setting of the +S flag on the directory containing the name that should matter.<br>
<p>
Attributes of the file refer to the contents of the file.  Attributes of the directory refer to the contents of the directory (the filenames in that directory).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463810/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2011, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
