        <!DOCTYPE html>
        <html lang="en">
        <head><title>TuxOnIce: in from the cold? [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/333007/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/332294/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/333007/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>TuxOnIce: in from the cold?</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>May 13, 2009</br>
           </div>
<p>
As flamewars go, the recent linux-kernel thread about <a
href="http://tuxonice.org/">TuxOnIce</a> was pretty tame.  Likely weary of
heated discussions in the past, the participants
mostly swore off the flames with a bid to work together on Linux
hibernation (i.e. suspend to disk).  But, there still seems to be an
impediment to that collaboration.  The long out-of-tree history for
TuxOnIce, combined with lead developer Nigel Cunningham's inability or
unwillingness to work with the community means that TuxOnIce could have a
bumpy road into the kernel&mdash;if it ever gets there at all.
</p>

<p>
TuxOnIce, formerly known as suspend2 and swsusp2, is a longstanding out-of-tree
solution for hibernation.  It has an enthusiastic user community along with
some features not available in swsusp, which is the current mainline
hibernation code.  Some of the advantages claimed by TuxOnIce are support
for multiple swap devices or regular files as the suspend image
destination, better performance via compressed images and other techniques,
saving nearly all of the contents of memory including caches, etc.  But its
vocal users say that the biggest advantage is that TuxOnIce just works for
many&mdash;some of 
whom cannot get the current mainline mechanisms to work.

<p>
Much of the recent mainline hibernation work, generally done by Rafael
Wysocki and Pavel Machek, has focused on uswsusp, which moves the bulk of
the suspend work to user space.  So, the kernel already contains two
mechanisms for doing hibernation, leaving no real chance for a third to be
added. 
</p>

<p>
There are clear disagreements about how much and which parts should be in
the kernel versus in user space.  Machek seems to think that nearly all of
the task can be handled in user space, while Cunningham is in favor of the
advantages&mdash;performance and being able to take advantage of in-kernel
interfaces&mdash;of an all kernel approach.  Wysocki is somewhere in the
middle, <a href="/Articles/333144/">outlining</a> some of the advantages
he sees in the in-kernel solution:
<div class="BigQuote">
One benefit is that we need not anything in the initrd for hibernation to work.
Another one is that we can get superior performance, for obvious reasons
(less copying of data, faster I/O).   Yet another is simpler configuration and
no need to maintain a separate set of user space tools.  I probably could
find more.
</div>
</p>

<p>
A bigger disconnect, though, is how to
proceed.  Cunningham would like to see TuxOnIce merged whole as a parallel
alternative to swsusp, with an eye to eventually replacing and removing swsusp.
Machek and Wysocki are not terribly interested in replacing swsusp, they
would rather see incremental improvements&mdash;many coming from the
TuxOnIce code&mdash;proposed and merged.  On the one hand,
Cunningham has an entire subsystem that he would like to see merged, while
the swsusp folks have a subsystem&mdash;used by most distributions for
hibernation&mdash;to maintain.
</p>

<p>
Cunningham recently posted an <a href="http://lwn.net/Articles/332036/">RFC for
merging TuxOnIce</a> "<q>with a view to seeking to get it
merged, perhaps in 2.6.31 or .32 (depending upon what needs work before
it can be merged) and the willingness of those who matter</q>".  That
was met with a <a href="/Articles/333063/">somewhat heated reply</a> by
Machek.  But Wysocki was quick to <a href="/Articles/333065/">step in to
try to avoid the flames</a>:
<div class="BigQuote">
Actually, I see advantages of working together versus fighting flame wars.
Please stop that, I'm not going to take part in it this time.
</div>
</p>

<p>
After Cunningham agreed, the discussion turned to <i>how</i> to work
together,
which is where it seems to have hit an impasse.  Wysocki and Cunningham, at
least, see some clear advantages in the TuxOnIce code, but, contrary to
Cunningham's wishes, having it merged wholesale is likely not in the
cards.  Cunningham <a href="/Articles/333085/">describes</a> his plan as
follows: 
<div class="BigQuote">
I'd like to see use have all three [swsusp, uswsusp, and TuxOnIce] for one
or two releases of vanilla, 
just to give time to work out any issues that haven't been foreseen.
Once we're all that there are confident there are no regressions with
TuxOnIce, I'd remove swsusp. That's my ideal plan of attack.
</div>
</p>

<p>
Not surprisingly, Wysocki and Machek see things differently.  Machek is <a
href="/Articles/333089/">not 
opposed</a> to bringing some of TuxOnIce into the mainline: "<q>If we are
talking about improving mainline to allow tuxonice 
functionality... then yes, that sounds reasonable.</q>"  Wysocki lays
out an <a href="/Articles/333090/">alternative plan</a> that is much more
in keeping with traditional kernel development strategies:
<div class="BigQuote">
So this is an idea to replace our current hibernation implementation with
TuxOnIce.
<p>
Which unfortunately I don't agree with.
<p>
I think we can get _one_ implementation out of the three, presumably keeping
the user space interface that will keep the current s2disk binaries happy, by
merging TuxOnIce code _gradually_.  No "all at once" approach, please.
<p>
And by "merging" I mean _exactly_ that.  Not adding new code and throwing
away the old one.
</div>
</p>


<p>
But, as Cunningham continues pushing for help in getting TuxOnIce merged
alongside swsusp, Wysocki <a href="/Articles/333104/">points out</a> that
it requires a great deal of 
review to get a huge  (10,000+ lines of code) set of patches accepted:
"<q>That would take lot of work and we'd also have to ask many other
busy people 
to do a lot of work for us</q>".  Cunningham seems to be  
under the misapprehension that kernel hackers will be willing to merge a
subsystem that duplicates another without a clear overriding reason.
Easing what he sees as a necessary 
transition from swsusp to TuxOnIce is not likely to be that compelling.  
</p>

<p>
It is clearly frustrating for Cunningham to have a working solution but be
unable to get it into the kernel.  But it is a direct result of working out
of the tree and then trying to present a solution when the kernel has gone
in a different direction.  It is a common mistake that folks make when
dealing with the kernel community.  Ray Lee provides a nice <a
href="/Articles/333106/">answer</a> to Cunningham's frustrations, which
points to IBM's device mapper contribution that suffered from a similar
reaction.  Lee notes that Wysocki has offered extremely valuable
assistance:
<div class="BigQuote">
He's offering to be the social glue between your code and the forms
that are accepted and followed here on LKML. Taking things apart from
the whole, finding the pieces that are non-controversial or easily
argued for, getting them merged upstream with a user, and then moving
on to the rest.
<p>
This way, the external TuxOnIce patch set shrinks and shrinks, until
it's eventually gone, with all functionality merged into the kernel in
one form or another.
<p>
Is your code better than uswsusp? Almost certainly. This isn't about
that. This is about making your code better than what it is today, by
going through the existing review-and-merge process.
</div>
</p>

<p>
At one point, Cunningham <a href="/Articles/333122/">pointed</a> to the
SL*B memory allocators as an 
example of parallel 
implementations that are all available in the mainline.  Various folks
responded that memory allocators are fairly self-contained, unlike
TuxOnIce.  Furthermore, 
as Pekka Enberg <a href="/Articles/333125/">notes</a>: "<q>Yes, so
please don't make the same mistake we did. Once you have 
multiple implementations in the kernel, it's extremely hard to get rid
of them.</q>"
</p>

<p>
There has been a bit of discussion about the technical aspects of the
TuxOnIce patch, mostly centering on the way that it frees up memory to
allow enough space to create a suspend image, while still adding the
contents of that memory to the suspend image.  By relying on existing
kernel behavior, which is
not necessarily guaranteed for the future, TuxOnIce can save nearly all of
the memory contents, whereas swsusp dumps caches and the like to create
enough memory to build the suspend image.  That means that performance after a
resume operation may be impacted as those caches are refilled.  Overall,
though, the main focus of the discussion has been the way forward; so far,
there has been little progress on that front.
</p>

<p>
This is not the first time that TuxOnIce has gotten to this point.  In its
earlier guise as swsusp2, Cunningham made several attempts to get it into
the mainline.  In March of 2004, Andrew Morton <a
href="/Articles/75971/">asked that it be broken down</a> into smaller, more
easily digested, chunks.  The <a href="/Articles/113555/">same thing</a>
happened again near the end of 2004 when Cunningham proposed adding swsusp2
in one big code ball.  It doesn't end there, either, between then and now
the same request has been made; at this point one might guess that
Cunningham simply isn't willing to do things that way.
</p>

<p>
There is a real danger that the TuxOnIce features that its users like could
be lost&mdash;or 
remain out-of-tree&mdash;if something doesn't give.  Either Cunningham has
to recognize that the only plausible way to get TuxOnIce into the kernel is
via the normal kernel development path, or someone else has to pick it up
and start that process themselves.  With no one (other than Cunningham)
pushing for its inclusion, there simply is no other way for it to get into
the mainline.
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_model">Development model</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Software_suspend">Software suspend</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/333007/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor333250"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TuxOnIce: in from the cold?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2009 14:41 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/333250/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
But it is a direct result of working out of the tree and then trying to present a solution when the kernel has gone in a different direction.
</blockquote>

This disagrees with my memory of those old threads, which had Pavel <i>creating</i> uswsusp after Nigel proposed inclusion of what was then suspend2.
      
          <div class="CommentReplyButton">
            <form action="/Articles/333250/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor333373"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TuxOnIce: in from the cold?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 15, 2009 9:49 UTC (Fri)
                               by <b>hppnq</b> (guest, #14462)
                              [<a href="/Articles/333373/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Exactly. 
<p>
I still do not suspend, by the way. Or resume, rather. People who want to try TuxOnIce can probably find packages for their distribution, it seems. Maybe I should give it a try.

      
          <div class="CommentReplyButton">
            <form action="/Articles/333373/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor333485"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TuxOnIce: in from the cold?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 16, 2009 12:30 UTC (Sat)
                               by <b>bredelings</b> (subscriber, #53082)
                              [<a href="/Articles/333485/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Um, yeah...  Not only does suspend-to-disk still not work on my (recent Ubuntu) machine, my impression was that it was even less functional during the last push for TuxOnIce inclusion.  LWN seems to have decided that the real issue is whether or not external patches are willing to follow the LK method of adding things... instead of whether or not a certain kernel subsystem maintainer is taking a "I got here first, so you have to do things MY way" approach.  And LWN may be right.  But it seems that perhaps the real hero is Wysocki for being so willing and able to work with both parties.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/333485/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor334092"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">why uswsusp?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2009 15:16 UTC (Thu)
                               by <b>quartz</b> (guest, #37351)
                              [<a href="/Articles/334092/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Same here, resume and suspend don't work.  The article doesn't explain why we have uswsusp at all, instead of THAT having been merged into the old swsusp.  did it work worse than swsusp?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/334092/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor334512"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">why uswsusp?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 25, 2009 11:11 UTC (Mon)
                               by <b>forthy</b> (guest, #1525)
                              [<a href="/Articles/334512/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>I've more or less the same problems - we have a broken suspend system
in the kernel, and an apparently much better system outside. Please dump
the two non-working in-kernel systems, and replace them by the working
one. And don't allow the maintainers of the broken systems that never get
fixed to block the road.</p>

<p>Policies are often useful, but they aren't the law. Some parts have to
be rewritten from scratch, or otherwise solved quite differently, so
incremental change is not possible. If such a non-incremental change is
impossible to Linux, it will eventually die a slow death - like Windows,
which resists such changes for quite different reasons.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/334512/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor334163"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The article isn't fair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2009 20:32 UTC (Thu)
                               by <b>huaz</b> (guest, #10168)
                              [<a href="/Articles/334163/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I've been watching LKML for many years.<br>
<p>
It's not just that Nigel won't work with the communities. It's that he is frustrated that a superior solution is blocked because of one maintainer, Pavel.<br>
<p>
Pavel was the original swsusp maintainer, and over the years he has not been able to make suspend-to-disk work reliably no matter how he sweet-plays the situation.<br>
<p>
Rafael later joined, and he is better (both in professionalism and personality). But the fact remains: the in-kernel solution sucks.<br>
<p>
Each time this topic came up, Pavel says "we can also do it (in user space, blahblah), but it's all vaporware.<br>
<p>
There is no way IMO to improve it unless one of the following happens:<br>
1. Find a better maintainer who is not so hooked up with the current code<br>
2. Linus himself actually uses and cares about this feature<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/334163/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor334184"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The article isn't fair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 21, 2009 22:14 UTC (Thu)
                               by <b>johill</b> (subscriber, #25196)
                              [<a href="/Articles/334184/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yet sadly, Rafael still listens to what Pavel says years later.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/334184/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2009, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
