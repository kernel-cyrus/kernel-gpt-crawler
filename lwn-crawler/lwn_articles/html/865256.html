        <!DOCTYPE html>
        <html lang="en">
        <head><title>memfd_secret() in 5.14 [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/865256/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/865310/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/865256/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>memfd_secret() in 5.14</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>LWN.net needs you!</b>
<p>
Without subscribers, LWN would simply not exist.  Please consider
       <a href="/Promo/nst-nag2/subscribe">signing up for a subscription</a> and helping
       to keep LWN publishing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>August 6, 2021</br>
           </div>
The <tt>memfd_secret()</tt> system call has, in one form or another, been
covered here since February 2020.  <a href="/Articles/812325/">In the
beginning</a>, it was a  flag to <a
href="https://man7.org/linux/man-pages/man2/memfd_create.2.html"><tt>memfd_create()</tt></a>,
but its functionality was later moved to a separate system call.  There
have been many changes during this feature's development, but its core
purpose remains the 
same: allow a user-space process to create a range of memory that is
inaccessible to anybody else — kernel included.  That memory can be used to
store cryptographic keys or any other data that must not be exposed to
others.  This new system call was finally merged for the upcoming 5.14
release; what follows is a look at the form this call will take in the
mainline kernel.
<p>
The prototype for <tt>memfd_secret()</tt> is:
<p>
<pre>
    int memfd_secret(unsigned int flags);
</pre>
<p>
The only allowed flag is <tt>O_CLOEXEC</tt>, which causes the area to be
removed when the calling process calls <a
href="https://man7.org/linux/man-pages/man2/execve.2.html"><tt>execve()</tt></a>.
The secret area <i>will</i> be available to children after a
fork, though.  The return value from <tt>memfd_secret()</tt> will be a file
descriptor attached to the newly created secret memory area.
<p>
At this point, the process can't actually access that memory, which doesn't
even have a size yet.  A call must be made to <a
href="https://man7.org/linux/man-pages/man2/truncate.2.html"><tt>ftruncate()</tt></a>
to set the size of the area, then <a
href="https://man7.org/linux/man-pages/man2/mmap.2.html"><tt>mmap()</tt></a>
is used to map that "file" into the owning process's address space.
The pages allocated to populate that mapping will be removed from the
kernel's direct map, and specially marked to prevent them from being mapped
back in by mistake.
Thereafter, the memory is accessible to that process, but to nobody else,
not even the kernel.  The memory is thus about as well protected as it can get,
which is good, but there are some consequences as well.  Pointers to the
secret-memory region cannot be used in system calls, for example; this
memory is also inaccessible to DMA operations.
<p>
<a
href="/ml/linux-kernel/1572171452-7958-1-git-send-email-rppt@kernel.org/">The
first public posting of this work</a> happened in October 2019.  A number
of changes have been made over the nearly two years that this system call has
been under development — beyond the shift to a separate system call (<a
href="/ml/linux-kernel/20200720092435.17469-1-rppt@kernel.org/">in July
2020</a>), which was done because this functionality was deemed to have little
in common with ordinary memfds.  For example, the ability to reserve a
dedicated range of memory for <tt>memfd_secret()</tt> was added in the <a
href="/ml/linux-kernel/20200727162935.31714-1-rppt@kernel.org/">version-2
posting</a> later in July 2020, only to be removed in <a
href="/ml/linux-kernel/20200916073539.3552-1-rppt@kernel.org/">version&nbsp;5</a>
in September.
<p>
Early versions of the patch set included a flag to require the removal of
the pages in the secret area from the
kernel's direct map.  Doing so has the advantage of making the memory
inaccessible to the kernel (and to anybody who might be able to compromise
the kernel), but there were fears that breaking up the 1GB pages used
for the direct mapping would degrade performance.  Those fears have
subsided over time, though; performance with 2MB pages is not much
different than with 1GB pages.  So that option disappeared in <a
href="/ml/linux-kernel/20200818141554.13945-1-rppt@kernel.org/">version&nbsp;4</a>
in August 2020, and direct-map removal became the rule.
<p>
<a href="/ml/linux-kernel/20201110151444.20662-1-rppt@kernel.org/">Version
8</a>, posted in November,  added a couple of changes.  Rather than
allocating arbitrary kernel 
memory, <a href="/Articles/486301/">CMA</a> was used as the memory pool for
<tt>memfd_secret()</tt>.  Another change, which created a bit of
controversy over the life of the patch, disables hibernation when a secret
memory area is active.  The purpose is to prevent the secret data from
being written to persistent storage, but some users may become disgruntled
if they find that they can no longer hibernate their systems.  That
notwithstanding, this behavior was part of the version that went into 5.14.
<p>
Since the beginning, <tt>memfd_secret()</tt> has supported a flag
requesting uncached mappings — memory that bypasses the
memory caches — for the secret area. 
This feature makes the area even more secure by eliminating copies in the
caches (which could be exfiltrated via Spectre vulnerabilities), but
setting memory to be uncached will drastically reduce 
performance. The caches exist for a reason, after all.  
Andy Lutomirski repeatedly <a 
href="/ml/linux-kernel/CALCETrXr-9ABs7rzXcCrh1VXn-15AfpwjA6bQA7aU9Ta7DR+bw@mail.gmail.com/">opposed</a>
making uncached mappings available, objecting to the performance cost and
more; Rapoport finally <a 
href="/ml/linux-kernel/20201124092919.GI8537@kernel.org/">agreed to remove
it</a>.  <a
href="/ml/linux-kernel/20201124092556.12009-1-rppt@kernel.org/">Version&nbsp;11</a>
removed that feature, leading to the current state where there are no flags
that are specific to this system call.
<p>
In <a
href="/ml/linux-kernel/20210208084920.2884-1-rppt@kernel.org/">version
17</a> (February 2021), <tt>memfd_secret()</tt> was disabled by default and
a command-line option (<tt>secretmem_enable=</tt>) was added to enable it
at boot time.  This decision was made out of fears that system performance
could be degraded by breaking up the direct map and locking secret-area memory in
RAM, so the feature is unavailable unless the system administrator turns it
on.  This version also ended the use of CMA for memory allocations.
<p>
And that leads to what is essentially the current state of
<tt>memfd_secret()</tt>.  It took 23&nbsp;versions to get there, which
seems like a lot, but that is often the nature of memory-management
changes.  Once 5.14 comes out, we'll see how big the user community is for
this feature, and what changes will be deemed necessary.  For now, though,
this work would appear to have finally reached a successful conclusion.
For the curious, <a
href="/ml/linux-mm/20210729082900.1581359-1-rppt@kernel.org/">this draft
man page</a> has a few more details.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Memory_management-Address-space_isolation">Memory management/Address-space isolation</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-5.14">Releases/5.14</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#System_calls-memfd_secret">System calls/memfd_secret()</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/865256/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor865487"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 6, 2021 16:41 UTC (Fri)
                               by <b>ericonr</b> (guest, #151527)
                              [<a href="/Articles/865487/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Another change, which created a bit of controversy over the life of the patch, disables hibernation when a secret memory area is active. The purpose is to prevent the secret data from being written to persistent storage, but some users may become disgruntled if they find that they can no longer hibernate their systems. That notwithstanding, this behavior was part of the version that went into 5.14. </font><br>
<p>
Is there going to be an easy way to query what program is blocking things (maybe some new procps functionality, if it can be found from /proc/$PID/maps)?<br>
<p>
The intersection of people who will enable the functionality and those who hibernate their computers seems like it would be small (I take hibernation as &quot;trusting the kernel a lot&quot;, at least in my head), so this is unlikely to be an actual issue, but if/when it does happen, it&#x27;d be nice if people weren&#x27;t stuck.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865487/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865490"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 6, 2021 17:07 UTC (Fri)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/865490/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It&#x27;s a nice idea to have such secret memory where applications (e.g. browsers) can store sensitive data.<br>
But if that feature breaks hibernation, I don&#x27;t see how distributions could enable it by default. It will never experience widespread use then, even if most users don&#x27;t actually use hibernation.<br>
<p>
If the hibernation image is encrypted, then I don&#x27;t see why memfd_secret() should disable hibernation.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865490/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865526"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 0:34 UTC (Sat)
                               by <b>ericonr</b> (guest, #151527)
                              [<a href="/Articles/865526/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, the article mentions hiding things even from the kernel. Hibernation would break that neatly. Someone with a local account could probably run `systemctl hibernate`, and try to obtain the secret some time after the kernel remaps that piece of memory via a local kernel exploit.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865526/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865540"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 6:29 UTC (Sat)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/865540/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;and try to obtain the secret some time after the kernel remaps that piece of memory via a local &gt;kernel exploit.</font><br>
<p>
Yes, well. But only during the memory restore time window. After that the kernel would hopefully remove the pages from its mapping again.<br>
<p>
But is memfd_secret() safe against kernel level privilege escalations anyway?<br>
Why couldn&#x27;t an attacker inject code to remap the areas?<br>
So if you gain random code execution rights in the kernel, it&#x27;s game over. With and without hibernation.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865540/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865544"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 7:16 UTC (Sat)
                               by <b>david.hildenbrand</b> (subscriber, #108299)
                              [<a href="/Articles/865544/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I was told that even exposing secretmem pages for a very short time in the direct map, for example when hibernating, is a security risk. As one example. other CPUs could expose that data.<br>
<p>
It‘s the same reasoning that blocks these pages to be movable: migration code would have to temporarily map them. One approach discussed is using temporary per-cpu page tables for page migration.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865544/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor865545"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 7:23 UTC (Sat)
                               by <b>david.hildenbrand</b> (subscriber, #108299)
                              [<a href="/Articles/865545/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I‘d like to note that secretmem does not protect against kernel exploits or against root in most setups getting hold of that data. Once you‘re already in the kernel, you might just be able to remap the pages. Once you‘re root, you can trigger kexec or kdump to expose the data. Further, if all memory isn‘t getting cleared during reboot (e.g., in most VMs) you might be able to reboot and extract that data.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865545/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865546"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 8:10 UTC (Sat)
                               by <b>randomguy3</b> (subscriber, #71063)
                              [<a href="/Articles/865546/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Which leads me to wonder: what does it protect against?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865546/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865557"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 10:59 UTC (Sat)
                               by <b>david.hildenbrand</b> (subscriber, #108299)
                              [<a href="/Articles/865557/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
IIUC, the „easy“ ways to access this data (/proc/kcore), application BUGs (e.g., accidentally using the secretmem area as a sending buffer) and kernel/CPU BUGs. When disabling other features (e.g., kdump) and extending other features (e.g., clearing all secretmem areas before kexec or before reboots) we can make it even harder for root to still read secretmem in the future. But it might be hard to get rid of all (kdb?) such ways for root to still read that memory.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865557/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor865654"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 12:59 UTC (Mon)
                               by <b>hkario</b> (subscriber, #94864)
                              [<a href="/Articles/865654/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
application bugs: you can&#x27;t use that memory in syscalls<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865654/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor865512"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 6, 2021 19:45 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/865512/">Link</a>] (54 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Gah. Hibernation. Can the secret memory be augmented to be dropped on hibernation? So that applications will get SIGBUS on future accesses.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865512/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865513"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 6, 2021 19:53 UTC (Fri)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/865513/">Link</a>] (50 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;So that applications will get SIGBUS on future accesses.</font><br>
<p>
That will probably crash the application. Even if it was equipped to handle SIGBUS, what could the application possibly do? The data is gone. Therefore it wouldn&#x27;t help the widespread adoption to put critical data into secret memory areas.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865513/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865520"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 6, 2021 21:21 UTC (Fri)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865520/">Link</a>] (43 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; The data is gone.</font>

<p>But is it irrevocably gone?</p>

<p>I don't think you are supposed to keep your only copy of secret keys there.</p>

<p>If that's something like Netflix decryption key, though, then you, probably, can request another one from Netflix.</p>

<p>This may or may not be useful, but storing stuff in a hibernation file would just make the whole excercise pointless: why hide data from kernel if attacker can just request a hibernation and pull it from the file?</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/865520/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865543"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 6:35 UTC (Sat)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/865543/">Link</a>] (42 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;but storing stuff in a hibernation file would just make the whole excercise pointless</font><br>
<p>
I don&#x27;t think so. Hibernation files should be encrypted anyway, if there&#x27;s any chance of sensitive data being handled on the machine.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865543/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865548"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 8:40 UTC (Sat)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865548/">Link</a>] (41 responses)
      </p>
      
      </div>
      </summary>
      <p>Usually it's encrypted with the key which can be found in kernel memory somewhere and if we are protecting app from the kernel then it's assumed that whole kernel-visible memory is readable to the attacker.</p>

<p>It's probably possible to create a different hibernation scheme where some entity external to the kernel copies the whole RAM to disk and encrypts everything, but that wouldn't be usual hibernation module anyway and it wouldn't be affected by kernel options at all.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/865548/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865552"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 9:35 UTC (Sat)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/865552/">Link</a>] (40 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;Usually it&#x27;s encrypted with the key which can be found in kernel memory somewhere</font><br>
<p>
I use the kernel key management for disk + swap (hibernate) encryption.<br>
Doesn&#x27;t that wipe the key cache (after some timeout)?<br>
<p>
I understand that hibernation reduces the security of memfd_secret().<br>
However disabling hibernation or killing random apps does completely destroy the UX and it will prevent the widespread adoption of this security feature.<br>
Let the user decide whether the risk of having an (encrypted) hibernation image is Ok or not.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865552/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865553"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 9:46 UTC (Sat)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865553/">Link</a>] (39 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt;  Let the user decide whether the risk of having an (encrypted) hibernation image is Ok or not.</font>

<p>How many times should we do the same mistake again and again? It doesn't work with security. <a href="https://en.wikipedia.org/wiki/Dancing_pigs">Dancing pigs</a> effect is very well known by now.</p>

<p>Case to the point:</p>

<font class="QuotedText">&gt; I use the kernel key management for disk + swap (hibernate) encryption.
Doesn't that wipe the key cache (after some timeout)?</font>

<p>You don't even <b>know</b> how the whole thing works yet presume to be able to do the right choice. Most users know even less than you. They only know that “no security” knob gives them dancing pigs and the other one doesn't. Thus they would choose the “no security” knob 10 times out of 10.</p>

<font class="QuotedText">&gt; However disabling hibernation or killing random apps does completely destroy the UX and it will prevent the widespread adoption of this security feature.</font>

<p>That's fine. Unused feature doesn't waste any resources and can even be removed, eventually. “Security theatre” feature <b>does</b> waste the resources without providing any benefits. Thankfully Linux kernel is not developed by a corporation which would perceive security buzzwords more important than actual security thus they are not introducing features for press-releases, but for actual use.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/865553/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865555"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 10:06 UTC (Sat)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/865555/">Link</a>] (38 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;You don&#x27;t even know how the whole thing works yet presume to be able to do the right choice.</font><br>
<p>
Well, you&#x27;re mixing two completely unrelated scenarios here.<br>
I didn&#x27;t base my &quot;choice&quot; on whether the keys are wiped from kernel memory or not.<br>
I don&#x27;t care, if there are keys in kernel memory.<br>
<p>
But I do care, if hibernation stops working as soon as some random app starts using memfd_secret(). Yes, I know that for now that can&#x27;t happen, as long as I don&#x27;t enable that feature on the kernel command line. But that&#x27;s exactly my point the whole time: This feature won&#x27;t experience widespread use. Exactly because:<br>
<p>
<font class="QuotedText">&gt;Thus they would choose the “no security” knob 10 times out of 10.</font><br>
<p>
They also will press the &quot;more security&quot; button 0 times out of 10.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865555/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865556"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 10:23 UTC (Sat)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865556/">Link</a>] (37 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; They also will press the "more security" button 0 times out of 10.</font>

<p>Indeed. That's why the only way to introduce new security feature is with “more security” choice being the only option. Users pick “more security” option quite easily if the alternative is not mere knob, but patch to the kernel, recompilation and other hassle of such level.</p>

<font class="QuotedText">&gt; This feature won't experience widespread use.</font>

<p>Why do you think so? I would expect that DRM-providers would adopt it quickly. Then VPNs and remote access apps would demand it. Then, eventually, Chrome and Firefox would join the crowd.</p>

<p>At that point it would become a moot point if you want to use hibernation or not: you system wouldn't be much useful if you would choose the hibernation. Although I expect that the ability to empty that security memory before hibernation would be adopted instead, but maybe not. I'm not really sure how useful hibernation is today. I don't use it thus I don't care.</p>

<font class="QuotedText">&gt; I don't care, if there are keys in kernel memory.<br></br>

But I do care, if hibernation stops working as soon as some random app starts using memfd_secret().</font>

<p>And that's exactly and precisely why hibernation shouldn't be allowed to be used when memfd_secret is used. You don't care about security of memfd_secret() — and other users feel the same. Which means application developers couldn't rely on it. And if application developers couldn't rely on it then why is it there in the first place?</p>




      
          <div class="CommentReplyButton">
            <form action="/Articles/865556/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865559"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 14:47 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/865559/">Link</a>] (36 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I&#x27;m not really sure how useful hibernation is today. I don&#x27;t use it thus I don&#x27;t care.</font><br>
<p>
Well, on my (Windows) laptop, it&#x27;s configured to hibernate every time I close the lid.<br>
<p>
You do NOT want to put a sleeping laptop into a laptop bag. It could set the bag alight. It could fry the laptop. It could crash the OS and lose you all your work ...<br>
<p>
Just because you don&#x27;t have a laptop doesn&#x27;t mean other people don&#x27;t have any use for hibernation.<br>
<p>
What we need is not asking people do you want secrets (or whatever). We need to put the choice to them and say &quot;hibernation or secrets? Which is most important to YOU?&quot;. If they don&#x27;t understand secrets, I&#x27;ll guess they choose hibernation. Then the secrets app will crash. Fine - it&#x27;ll make them investigate and maybe secrets IS more important.<br>
<p>
But just because YOU have no use for hibernation ... as far as I&#x27;m concerned *I* have no use for secrets. My employer may disagree ... :-)<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865559/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865561"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 15:01 UTC (Sat)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865561/">Link</a>] (35 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; You do NOT want to put a sleeping laptop into a laptop bag.</font>

<p>Why not?</p>

<font class="QuotedText">&gt; It could set the bag alight. It could fry the laptop. It could crash the OS and lose you all your work ...</font>

<p>How is that related to hibernation? If your OS is buggy then yes, all that can happen. With or without hibernation. In fact in my experience (back when I still tried to make hibernation work) “crash the OS and lose you all your work” was something which happened with hibernation 10 times more often than with suspend.</p>

<font class="QuotedText">&gt;  Just because you don't have a laptop doesn't mean other people don't have any use for hibernation.</font>

<p>Who said I don't own a laptop? I own quite a few of them. With Linux, ChromeOS and Windows. Although Windows is not used very often, but even it works just fine without hibernation. I disabled it after finding few times my Windows partition being inaccessible from Linux.</p>

<font class="QuotedText">&gt; But just because YOU have no use for hibernation ... as far as I'm concerned *I* have no use for secrets. My employer may disagree ... :-)</font>

<p>And your employer would, eventually, win.</p>

<font class="QuotedText">&gt; Then the secrets app will crash.</font>

<p>Or it may refuse to even start. Which also valid option and much easier to support.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/865561/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865562"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 15:26 UTC (Sat)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/865562/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;Or it may refuse to even start. Which also valid option</font><br>
<p>
Refusing to start, to crash or refusing to do other things (e.g. hibernate) is not really a valid option from UX perspective.<br>
<p>
Programmers often tend to assume that it&#x27;s valid to do such things. &quot;Somebody else will care and clean up after me. Let the user just restart the app. etc...&quot;. But it&#x27;s *not* Ok. People will get frustrated by broken software that crashes or doesn&#x27;t work as expected. (as in: what the user(!) expects)<br>
Users don&#x27;t use software for the sake of software, but rather to get actual work done.<br>
<p>
I cannot enable memfd_secret(), because I use hibernation.<br>
Distributions cannot enable memfd_secret() by default either, because they have users using hibernation.<br>
Therefore it&#x27;s a turn-on-by-user security feature. Which is very bad, because people tend to not turn on such features out of fear of breaking something.<br>
<p>
memfd_secret() is a useful feature. Even with (encrypted) hibernation. So (at least!) give me the choice to enable it, please. But I&#x27;d rather like to see it enabled by default. Even with unencrypted hibernation.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865562/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865565"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 15:51 UTC (Sat)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865565/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Users don't use software for the sake of software, but rather to get actual work done.</font>

<p>True. And they would upgrade (or downgrade) to a certain version of OS or disable hibernation if that's needed to do their work.<p>

<font class="QuotedText">&gt; So (at least!) give me the choice to enable it, please.</font>

<p>Why? If I understand correctly that feature wasn't designed simply because someone was bored. And the people who developed it want to ensure kernel would never see or access these pages. They most certainly don't want to see that information stored or HDD or SSD, encrypted or not. Or else feature would be useless for them.</p>

<p>Why do you think making feature for some bystander is more important than making it useful for people who developed it in the first place?</p>

<font class="QuotedText">&gt; But it's *not* Ok. People will get frustrated by broken software that crashes or doesn't work as expected. (as in: what the user(!) expects)</font>

<p>If that's not Ok then why are OSes and applications developed around that paradigm (MacOS and Windows, Android and ChromeOS) are so much more popular than platforms which are “correct from UX perspective” ones?</p>

<p>Think about it. And no answer “they are popular because most users are secret masochists” is wrong.</p>




      
          <div class="CommentReplyButton">
            <form action="/Articles/865565/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor865570"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 16:17 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/865570/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; memfd_secret() is a useful feature. Even with (encrypted) hibernation. So (at least!) give me the choice to enable it, please. But I&#x27;d rather like to see it enabled by default. Even with unencrypted hibernation.</font><br>
<p>
Just make it point out to the user - with strong warnings - that it will disable hibernation. You want it, fine. It just needs to be an either/or choice.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865570/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865571"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 16:26 UTC (Sat)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865571/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Isn't it how it's done today?


      
          <div class="CommentReplyButton">
            <form action="/Articles/865571/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor865563"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 15:31 UTC (Sat)
                               by <b>LtWorf</b> (subscriber, #124958)
                              [<a href="/Articles/865563/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A suspended macbook will wake itself up every once in a while.<br>
<p>
A software bug that makes it not suspend again, paired with a faulty temperature sensor might cause fire.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865563/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865564"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 15:35 UTC (Sat)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865564/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <p>What would prevent it from doing that if it's hibernated? How would you even know it went to hibernation when you requested it?</p>

<p>The fact that some OSes are buggy and need hibernation to make you feel safe doesn't mean all of them are like that.</p>

<p>ChromeOS doesn't support hibernation at all yet I never seen or heard about it causing fire. Have you heard about such cases?</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/865564/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865567"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 16:10 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/865567/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; What would prevent it from doing that if it&#x27;s hibernated?</font><br>
<p>
Because a hibernated laptop is SWITCHED OFF!<br>
<p>
A sleeping laptop is still running, still burning battery, and will die after (some definition of) a few hours. Potentially losing your work. As mentioned, potentially waking up and causing a fire. Etc etc.<br>
<p>
A hibernated laptop is switched off and doesn&#x27;t wake until you press the power switch, or wake-on-lan, or some EXTERNAL event causes it to fire up.<br>
<p>
That&#x27;s another reason for wanting to hibernate. If I don&#x27;t have access to a charger, and don&#x27;t need my laptop, I DON&#x27;T want it burning battery!!!<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865567/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865569"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 16:22 UTC (Sat)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865569/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Because a hibernated laptop is SWITCHED OFF!</font>

<p>And how do you know it's actually switched off? Many (most?) modern laptops have all these LEDs (power, suspend, mic off and so on) software driven.</p>

<p>Thus, in the end, you have to trust your software anyway.</p>

<font class="QuotedText">&gt; As mentioned, potentially waking up and causing a fire.</font>

<p>Have you ever heard about EFI wakeup alarm clock? Your hibernated (and even, presumably, switched off) device can do that perfectly fine, too.</p>

<font class="QuotedText">&gt; A hibernated laptop is switched off and doesn't wake until you press the power switch, or wake-on-lan, or some EXTERNAL event causes it to fire up.</font>

<p>Who told you that? I don't even know how long ago we had systems which couldn't wake up on their own volition.</p>

<font class="QuotedText">&gt; If I don't have access to a charger, and don't need my laptop, I DON'T want it burning battery!!!</font>

<p>Power it off if it's really need to go to sleep for a few days. That's really rare need in today's world, though.</p>

<p>You would save much more power since after wake up there wouldn't be a browser with moder web pages which insist on draining your battery as fast as they can (LWN is rare exception).</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/865569/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865573"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 17:41 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/865573/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Power it off if it&#x27;s really need to go to sleep for a few days. That&#x27;s really rare need in today&#x27;s world, though.</font><br>
<p>
Is it? Once again you&#x27;re assuming everyone is the same as you.<br>
<p>
It is NORMAL for me (living in a first world country) to have no access to mains power for several days at a time. Yes it&#x27;s my choice. But if I can&#x27;t recharge my laptop for a week, I want to save as much battery as I can, and that includes not having it wasting power sleeping.<br>
<p>
(And while one person can&#x27;t make much difference, why should I want to waste power? If EVERYBODY saved just a few watts here and there - and had the &quot;let&#x27;s save it&quot; mindset), we might make a dent in global warming :-)<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865573/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor865582"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 0:45 UTC (Sun)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/865582/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Because a hibernated laptop is SWITCHED OFF!</font><br>
<p>
Modern hardware has basically the same set of wakeup events when powered down as it does when suspended. The embedded controller is powered and can turn the machine back on whenever it feels like it. Unless you actually pull the battery, &quot;Switched off&quot; doesn&#x27;t mean what you think it means - the only meaningful distinction between suspend and off is whether or not the RAM is in self-refresh.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865582/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865595"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 9:57 UTC (Sun)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/865595/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yup. And as I understand it, that&#x27;s the difference between sleep and hibernate. Hibernate also means ram-refresh is OFF.<br>
<p>
Which, when you&#x27;re off-grid and battery life is critical, is important.<br>
<p>
And I don&#x27;t know which, in general, uses more battery. Rebooting? or restoring from hibernate? My gut feel is hibernate is likely to use less battery, because it doesn&#x27;&#x27;t go through the (possibly) long start up sequence before getting to a usable system.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865595/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865609"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 17:25 UTC (Sun)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/865609/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That&#x27;s relevant in terms of how long a device can keep state, but not relevant to whether it&#x27;ll catch fire in your bag.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865609/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor865646"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 9:30 UTC (Mon)
                               by <b>chris_se</b> (subscriber, #99706)
                              [<a href="/Articles/865646/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; As mentioned, potentially waking up and causing a fire.</font><br>
<p>
Any device with a Lithium-Ion battery can catch fire, whether it&#x27;s drawing power or not. And even if your device is shut down (not even hibernating), you could also trigger your power button accidentally. (Hasn&#x27;t happened to me with a laptop yet, but has happened countless times with my cell phone, causing it to reboot.)<br>
<p>
Was there a risk 30 years ago when there was no thermal throttling and no thermal cutoffs in devices, especially CPUs? Sure. Is there a non-zero risk that any device that contains energy storage catches fire? Absolutely. But hardware has come a long way since then to mitigate those risks and I think this concern is overblown. Heck, even 15 years ago with my then laptop I had a couple of times when it didn&#x27;t even enter sleep (stochastic bugs in hardware and/or the kernel) and I didn&#x27;t check before putting it into the bag because I was in a hurry. And while the inside of the bag got warm to the touch (at most 40C), nothing got really hot, the laptop throttled down and just drained its battery much quicker than in suspend mode, causing it to shut off and causing me some inconvenience.<br>
<p>
Millions of people put their laptop in sleep mode in their bags daily, and I&#x27;ve yet to see an epidemic of cases where laptops catch fire due to this. The data just doesn&#x27;t bear out that this is an issue that one should be concerned about. Your device catching fire because the manufacturer did a bad job with that specific model is by far a much likelier outcome than it catching fire due to being stuffed into a bag in suspend mode.<br>
<p>
I&#x27;m not against hibernate, and I think that hibernating laptops is a very legitimate use case, especially if you want to leave it off (without draining battery) for a significant amount of time. But please don&#x27;t argue for your position with fear-mongering against other legitimate ways of using your own device.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865646/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor865568"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 16:13 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/865568/">Link</a>] (21 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &gt; But just because YOU have no use for hibernation ... as far as I&#x27;m concerned *I* have no use for secrets. My employer may disagree ... :-)</font><br>
<p>
<font class="QuotedText">&gt; And your employer would, eventually, win.</font><br>
<p>
Does your employer really have all that power? Are you their slave? Over here, that&#x27;s ILLEGAL.<br>
<p>
(hint - it&#x27;s MY laptop. And as far as my wife&#x27;s laptop goes, there IS NO employer involved)<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865568/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865574"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 19:22 UTC (Sat)
                               by <b>mpr22</b> (subscriber, #60784)
                              [<a href="/Articles/865574/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
&quot;Do not put company data on any device that is not the company&#x27;s&quot; and &quot;do not put software that is not company approved on any device that is the company&#x27;s&quot; are not illegal in any part of the United Kingdom of Great Britain and Northern Ireland to the best of my knowledge.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865574/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865577"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 21:35 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/865577/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No they aren&#x27;t.<br>
<p>
But if the company DEMANDS that I put company data on *my* laptop, and the company DEMANDS that company data is not put on any unsecured device, that combo will land the company in serious trouble if they insist!<br>
<p>
They are demanding that I put company approved security software on a personal device. That falls foul of both employment law and the Computer Fraud And Abuse Act or whatever it&#x27;s called.<br>
<p>
And actually, my employer has just fallen foul of that combo this last week. No foul intent on either side, but they&#x27;ve supplied me with a company laptop that requires 2FA. That requires the authentication software to be installed on a secured mobile, and I refused point-blank to secure my personal mobile. Actually, the company had supplied me with a company mobile, but I was having problems setting it up, so they just had to accept that I was unable to log in to the corporate network. The equipment they&#x27;d supplied didn&#x27;t work, and if I didn&#x27;t want to use my equipment instead, there was nothing they could do about it. (They were happy about me using my personal phone, I wasn&#x27;t!)<br>
<p>
(If I choose not to secure my personal phone, that is down to me. I also choose to actively avoid putting anything sensitive on said phone, so I have no problem with that. And I also choose not to put any sensitive data on Google, so losing my phone won&#x27;t compromise what isn&#x27;t there to be compromised.)<br>
<p>
You&#x27;re making the same mistake as Khim - you&#x27;re assuming everything is work, and work over-rides everything. It doesn&#x27;t - what I do in my personal time with my personal kit is down to me, which is why I often find myself without electric - I go &quot;off grid&quot;. From choice.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865577/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865580"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 21:56 UTC (Sat)
                               by <b>mpr22</b> (subscriber, #60784)
                              [<a href="/Articles/865580/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; You&#x27;re making the same mistake as Khim - you&#x27;re assuming everything is work, and work over-rides everything.</font><br>
<p>
Mostly, I&#x27;m assuming that if my employer wanted me to run a specific secure build of an operating system, they would provide the equipment to run it on.<br>
<p>
Like, I have to run a 2FA app on my phone to use the company VPN, but I wasn&#x27;t asked to install a special build or security profile or anything (and if they did, I would say &quot;give me a company phone then, because you&#x27;re not putting fancy nonsense on my personal device&quot;).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865580/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865596"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 10:24 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865596/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <p>And here, again, you are not looking on large picture but specifically on your own company in your own tiny corner of the world.</p>

<p>Look outside, please. What usually happens is not that companies demand you to do something to your hardware. No, absolutely not. It's <b>always</b> your choice. You may follow <a href="https://en.wikipedia.org/wiki/Bring_your_own_device">BYOD</a> route or not. If you wouldn't lock down your hardware and wouldn't install company software — that's fine, too. You would just have no access to VPN and would only be able to read mail while physically in office.</p>

<p>But, of course, at the end of the year your performance would be compared to performance of people who are not this finicky and if your KPI would be not sufficient… you would get smaller bonus or may even be fired.</p>

<p><b>That</b> is how it usually works and <b>that</b> is how 90% of devices end up bound to the companies policies. Yes, there are some outliers and there would always be, probably, some expensive toys for freedom-lovers who are ready to pay for the privilege. But they would just not matter much for the big picture and can be, usually, ignored.</p>

<p>That is what I have meant and <b>that</b> is what is happening today. You may not like the fact that the overwhelming majority of phones are locked devices and laptops are slowly drifting in that direction, too — but that's just what objectively happens. Independently of our wishes.</p>

<p>I don't like it, too. But I, unlike Wol, can see a bit farther than the end of my own nose and can see what and why happens because of that change.</p>






      
          <div class="CommentReplyButton">
            <form action="/Articles/865596/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865602"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 16:03 UTC (Sun)
                               by <b>anselm</b> (subscriber, #2796)
                              [<a href="/Articles/865602/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <p>
Personally I would not be prepared to work for an employer who is unwilling to provide me with a suitable computer and phone to use for company business. The IT job market being what it is these days, paying for decent tools is a prerequisite for companies that want to attract (and keep) top-quality talent – and compared to a software developer's compensation, the price of even very good hardware is virtually negligible, so putting off potential applicants by requiring them to supply their own work equipment at their own expense (and then insisting on controlling what software is installed on that equipment and how it is configured) doesn't even make good business sense.
</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/865602/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865606"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 16:55 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865606/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Personally I would not be prepared to work for an employer who is unwilling to provide me with a suitable computer and phone to use for company business.</font>

<p>They probably can. If you are really fussy. But it's often just easier for both user and company when you only need one phone and one laptop to travel somewhere.</p>

<font class="QuotedText">&gt; The IT job market being what it is these days, paying for decent tools is a prerequisite for companies that want to attract (and keep) top-quality talent – and compared to a software developer's compensation, the price of even very good hardware is virtually negligible, so putting off potential applicants by requiring them to supply their own work equipment at their own expense (and then insisting on controlling what software is installed on that equipment and how it is configured) doesn't even make good business sense.</font>

<p>Who said anything about IT job market? It's <b>tiny</b>. Various estimates put number of software developers worldwide between 20 and 30 million. But there are half-billion of laptops in use and many billions of smartphones. Simple math shows that the software developers are tiny, almost negligible percentage of all users.</p>

<p>Yes, there are shortage of software developers and yes, because of that they can enjoy luxury of being treated differently. But majority of people are not in that position. They couldn't really play “oh, I want to do whatever I want with the device I own — and you have to bend over backward to accommodate my wishes” games. If accountant or a simple clerk would try that game — they would be fired and someone else would take their place. It's not that hard.</p>

<p>And the needs of <b>these</b> people are what drives the development of software and hardware. Most of them <b>want</b> to have locked down device — if that would bring more money for food and other spendure.</p>

<p>Just ask your friends who are <b>not</b> a software developers.</p>

<p>And if that's what they want then Industry would provide that. And kernel development, today, is part of the Industry. It doesn't matter if you like that or not — it's just the fact.</p>




      
          <div class="CommentReplyButton">
            <form action="/Articles/865606/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865640"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 23:54 UTC (Sun)
                               by <b>anselm</b> (subscriber, #2796)
                              [<a href="/Articles/865640/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <blockquote><em>Just ask your friends who are not a software developers.</em></blockquote>
<p>
Guess what, my friends who are not software developers usually <em>also</em> have company laptops and phones – and like it that way. After all it's a lot easier to ignore or switch off the company phone outside business hours, over the weekend, or during your vacation than your own phone, especially given that with such an arrangement your boss and colleagues don't need to know your private phone number, which is none of their business.
</p>
<p>
From a company POV, apart from the recruitment issues mentioned earlier, my friends' employers' IT operations and support people presumably prefer dealing with mostly-uniform hardware from known suppliers (including on-site support contracts, and having spares on hand if a machine breaks) and a common standardised software and UI setup, and definitely don't want the security nightmare of employees maintaining VPN connections into the company from their own machines that are also independently connected to the public Internet for non-company stuff (because of course they don't want to route all their employees' Netflix traffic through the company VPN, either). Many companies tend to figure out eventually that giving people centrally-maintained company hardware to use on the job is cheaper in the long run than dealing with the ongoing hassle and expense of getting people's random privately-bought computers to work properly (and securely) on the company's network. The lucky ones do so before the first malware infestation of the company's network via an employee's BYOD computer.
</p>








      
          <div class="CommentReplyButton">
            <form action="/Articles/865640/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865643"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 7:51 UTC (Mon)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865643/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Guess what, my friends who are not software developers usually <i>also</i> have company laptops and phones – and like it that way.</font>

<p>Interesting. So you have certainly managed to avoid the trend. Because statistic doesn't support your words at all: <a href="https://techjury.net/blog/byod/#gref">87% of businesses are dependent on their employee’s ability to access mobile business apps from their smartphone and 67% of employees use personal devices at work</a>.</p>

<p>I would guess this percentage is smaller in US and EU and bigger in third-world countries (almost all my friends from Egypt, Iran and Russia don't know about BYOD or any such fancy acronyms because no one ever thought about providing them with company smartphone and very rarely they got a company-provided laptop), but <a href="https://www.bitglass.com/press-releases/2018-byod-report-mobile-security-threats">Bitglass, the Next-Gen CASB company, is based in Silicon Valley with offices worldwide</a> — and it observes what I observe and not what you and Wol are observing.</p>

<p>And while your words <b>sound convincing</b> — they don't explain why things you observe and independent statistic observes don't match.</p>

<p>Because statistic very clearly shows that use of personal devices for work purposes is growing, not shrinking and the mitigation strategy chosen by the Industry is to make them… “less pesonal”, I guess: make sure bootloader is locked or security enclaves are installed (things like Intel SGX are developed for that purpose) and so on.</p>

<p>Add to that the fact that states (not just China or Iran, but also EU and US) increasingly want to ensure that nefarious sites they want to ban remain inaccessible to the most of the population — and you can easily imagine where all that is going.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/865643/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865645"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 9:15 UTC (Mon)
                               by <b>anselm</b> (subscriber, #2796)
                              [<a href="/Articles/865645/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>
There can also be regulatory-environment issues that work against BYOD. Here in Germany (as in the rest of the EU) there are very strict personal-data protection requirements that need to factor into companies' risk assessments. Many companies reasonably conclude that having customer or client data stored on (or even accessible from) employee-owned hardware is not a Good Idea, due to compliance issues and the increased risk of data breaches and associated fines/bad PR.
</p>
<p>
(The article you cite looks interesting but the statistics it quotes seem fishy in various respects. It is also tainted by the fact that the author himself seems to be a big fan of BYOD. I probably wouldn't want to lean on it too heavily for support.)
</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/865645/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor865649"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 10:32 UTC (Mon)
                               by <b>kleptog</b> (subscriber, #1183)
                              [<a href="/Articles/865649/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The statistics are interesting, but I wonder if they&#x27;re skewed by many companies having people log in remotely via Citrix or just using an online website or some such. Then sure, users can use any computer they like, it doesn&#x27;t matter. Similarly, if the phone is only used for phone calls and no actual data is stored I can imagine the &quot;using own phone for work&quot; is doable.<br>
<p>
The GDPR basically makes storing company data on uncontrolled personal computers a non-starter for most businesses. But remote access gives the user a controlled system, and web-browsers promise not to cache data fetched via TLS.<br>
<p>
They can of course say you have to bring your own device otherwise they won&#x27;t hire you. On the flip side, they&#x27;re not allowed to just randomly add monitoring to your personal device and if anything goes wrong (like your home laptop gets hacked) you as employee bear no liability. Which is why companies often hand out laptops anyway because as owner they have many more possibilities to secure the device.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865649/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor865605"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 16:32 UTC (Sun)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/865605/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I don&#x27;t like it, too. But I, unlike Wol, can see a bit farther than the end of my own nose and can see what and why happens because of that change.</font><br>
<p>
You probably don&#x27;t have to look that far to find plenty of posts by me where I see what is happening, and indeed, I rail against people who are blind to the realities of life. After all, there are plenty of occasions - on LWN - where I rail *against* this blind belief in some thing called &quot;freedom&quot;.<br>
<p>
But thanks for making me look like RMS. Thanks for making me look like a person who actually DOES BELIEVE in personal choice. This whole thread is because you&#x27;re advocating TAKING AWAY OTHER PEOPLES&#x27; CHOICE.<br>
<p>
So on a site full of people dedicated to Freedom, and Choice, thanks for making me look good!<br>
<p>
I believe Fascism is defined as &quot;Rule By Corporation&quot;. If you want to actively help that, that&#x27;s down to you. As soon as we lose the WILL to defend freedom, we lose the war. Personally, I don&#x27;t want to be a corporate slave.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865605/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865607"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 17:19 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865607/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; This whole thread is because you're advocating TAKING AWAY OTHER PEOPLES' CHOICE.</font>

<p>Seriously? You think I <b>want</b> to see people who don't have a choice? I don't.</p>

<p>But if people don't care about fighting for that choice (doesn't matter if that's because of ignorance or because they don't really want to have choice in the first place) then it would be taken from it.</p>

<p>I'm only discussing the implications.</p>

<font class="QuotedText">&gt; As soon as we lose the WILL to defend freedom, we lose the war.</font>

<p>Who are these mythical “we”? 2½ geeks? They don't really matter much in the grand theme of things. The majority of people? They don't care and thus it's not even worth discussing if war would be lost or not. We can can only discuss how and when that loss would happen.</p>

<font class="QuotedText">&gt; But thanks for making me look like RMS. Thanks for making me look like a person who actually DOES BELIEVE in personal choice.</font>

<p>He is also a person who went from someone whose voice was important to someone who is ostracized and [almost] kicked out from his own organization, don't forget that.</p>

<p>It's only matter of time when both his and yours opinions would become irrelevant.</p>

<p>Mine don't matter much, too, I freely admit that. But at least I don't pretend that I can do things which I can not, really, do.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/865607/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor865575"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 20:09 UTC (Sat)
                               by <b>sjj</b> (guest, #2020)
                              [<a href="/Articles/865575/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why are you shouting? <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865575/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865579"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 21:47 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/865579/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;m emphasizing it.<br>
<p>
I&#x27;m guessing they&#x27;re reading it as &quot;new comments&quot;, and losing context (I do the same :-(<br>
<p>
But unfortunately Khim does seem to have the attitude &quot;if I can&#x27;t see a use for it, it&#x27;s useless&quot;, and I do get wound up if people appear not to be reading what I actually wrote - if I write *my* laptop, I don&#x27;t mean &quot;the laptop my company gave me&quot;. I can be a grumpy old man :-)<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865579/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865594"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 10:10 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865594/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; But unfortunately Khim does seem to have the attitude "if I can't see a use for it, it's useless"</font>

<p>Can, you, <b>please</b> stop ascribing your own faults to others. Because the <b>only</b> guy who does that her is named Wol, not Khim and not mpr22.</p>

<p>When I wrote that <a href="https://lwn.net/Articles/865569/">that's really rare need in today's world, though</a> what was your answer? Something like “<i>here we have millions of people who need to do that</i>” or “<i>there are half-billion people who have no choice</i>”? Note. It was <a href="https://lwn.net/Articles/865573/">It is NORMAL for me (living in a first world country) to have no access to mains power for several days at a time.</a></p>

<p>Yeah, precisely and <b>exactly</b> “<i>if I can't see a use for it, it's useless</i>”… but where have others used such thinking?</p>

<font class="QuotedText">&gt; if I write *my* laptop</font>

<p>…then you talk about one specific laptop. Not about other billion laptops. And then you use that anecdote to justify something? Puhlease.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/865594/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865598"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 12:09 UTC (Sun)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/865598/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
 &gt; &gt; But unfortunately Khim does seem to have the attitude &quot;if I can&#x27;t see a use for it, it&#x27;s useless&quot;<br>
<p>
<font class="QuotedText">&gt; Can, you, please stop ascribing your own faults to others. Because the only guy who does that her is named Wol, not Khim and not mpr22.</font><br>
<p>
<font class="QuotedText">&gt; When I wrote that that&#x27;s really rare need in today&#x27;s world, though what was your answer? Something like “here we have millions of people who need to do that” or “there are half-billion people who have no choice”? Note. It was It is NORMAL for me (living in a first world country) to have no access to mains power for several days at a time.</font><br>
<p>
Please look at the words below. They are *YOUR* words, not mine!<br>
<p>
<font class="QuotedText">&gt; Indeed. That&#x27;s why the only way to introduce new security feature is with “more security” choice being the only option. Users pick “more security” option quite easily if the alternative is not mere knob, but patch to the kernel, recompilation and other hassle of such level.</font><br>
<p>
Given the choice of &quot;security or hibernate&quot;, I don&#x27;t give a monkeys what you choose. I *DO*, however, give a monkeys if you disable my preferred choice in favour of an option *I* have no use for. (And while, as a gentoo user, your alternative is easy for me, many others would find that difficult and it is precisely those people we want to attract!)<br>
<p>
<p>
Oh - and as for BYOD, I have no problem with that, either. As long as the company gives me decent recompense. But as I said to mpr22 (I think he got the wrong end of the stick), under UK law you are NOT allowed to tamper with someone else&#x27;s device without (informed) consent. And saying &quot;let us tamper with your computer or get sacked&quot; does not count as informed consent - it&#x27;s called &quot;unfair dismissal&quot;, which can be VERY expensive, let alone the (I believe) 5-year jail sentence that goes along with hacking the employee&#x27;s personal computer.<br>
<p>
It&#x27;s quite common on LWN for people to confuse a computer&#x27;s OWNER with a computer&#x27;s USER. That&#x27;s very important when talking about peoples&#x27; rights. If I&#x27;m the *owner* I have every right to disable (or enforce) this security feature. If I&#x27;m just a USER then that changes the dynamics. But don&#x27;t treat the owner as if they&#x27;re a &quot;mere user&quot;. And as I said elsewhere, I can be a &quot;grumpy old man&quot;. I do not like being what I can, and can not, do with MY OWN computer.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865598/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865599"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 12:44 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865599/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; And saying "let us tamper with your computer or get sacked" does not count as informed consent - it's called "unfair dismissal", which can be VERY expensive, let alone the (I believe) 5-year jail sentence that goes along with hacking the employee's personal computer.</font>

<p>Can you give me the list of companies which were fined for that? And who got the jail sentence?</p>

<p>I think you still are living in the imaginary world where law means a lot more than it does in reality. PJ lived there for a few years. She have <a href="http://www.groklaw.net/article.php?story=20130818120421175">got an epiphany</a> eight years ago. You still live in a delusion.</p>

<p>In a world where <a href="https://www.politico.com/news/2021/08/03/eviction-moratorium-biden-502312">Supreme Court decision is easily ignored</a> talking about what's written in this or that law is pointless.</p>

<p>And if you think that it's “just the insanity on the other side of the pond” then here is how <a href="https://www.atlanticcouncil.org/blogs/energysource/the-principle-of-solidarity-opal-nord-stream-and-the-shadow-over-gazprom/">princple of solidarity</a> trumps the actual laws.</p>

<p>The only thing that matter is how laws are actually treated in real world. And not even how they are interpreted by courts but by how they are, then, applied by police and other government institutions.</p>

<font class="QuotedText">&gt; If I'm the *owner* I have every right to disable (or enforce) this security feature.</font>

<p>For a next few years, sure, you would have such right. Maybe even longer — for a devices not connected to the network.</p>

<font class="QuotedText">&gt; But don't treat the owner as if they're a "mere user". And as I said elsewhere, I can be a "grumpy old man". I do not like being what I can, and can not, do with MY OWN computer.</font>

<p>That's nice way if putting it. But who said there are enough people like you to matter? Heck, who said you would have the right to do that in the future? Once upon time land was treated like that, too. And buildings. You owned it — you could do whatever you want with it. Can kill the trespasser or change building shape in any way you like.</p>

<p>Today it's not true (violate any of bazillion related laws and you can easily be prosecuted for what you do on your own land with your own property) and as world becomes more and more connected laptops will follow (phones are already there, more-or-less).</p>

<p>I'm just looking of how the world behaves and make the appropriate decision based on that.</p>

<p>You, on the other hand, start with your likes and dislikes and then act as if they matter one jot.</p>

<p>No, they <b>only</b> matter when others <b>allow</b> them to matter. And that happens in rarer and rarer cases.</p>

<p>At some point your ability of doing what you want (and not what others think you should want) would be cancelled. And no, becoming  a “grumpy old man” wouldn't save you. Unless you have some hypersonic missiles stashed under your bed and could <b>actually</b> protect your choice of life you would do as others would decide.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/865599/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865603"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 16:07 UTC (Sun)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/865603/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &gt; And saying &quot;let us tamper with your computer or get sacked&quot; does not count as informed consent - it&#x27;s called &quot;unfair dismissal&quot;, which can be VERY expensive, let alone the (I believe) 5-year jail sentence that goes along with hacking the employee&#x27;s personal computer.</font><br>
<p>
<font class="QuotedText">&gt; Can you give me the list of companies which were fined for that? And who got the jail sentence?</font><br>
<p>
I&#x27;m not aware of any hacking occurring. Because the employee who did it would be liable for the jail sentence. Probably at the employer&#x27;s expense.<br>
<p>
As for fines, it&#x27;s damages, not fines. It&#x27;s actually pretty easy to take your employer to an Employment Tribunal. There have been plenty of cases of that. And in a case like this it would be a slam-dunk with serious damages. Unlike in America, in Europe mistreating your employees can really hurt. Employees can easily walk away from cases like this with two or three years salary in damages. To say nothing of the hit the company takes defending the case.<br>
<p>
Cheers,<br>
Wik<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865603/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865604"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 16:28 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865604/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Unlike in America, in Europe mistreating your employees can really hurt</font>

<p>Where do you see “mistreatment”? Nobody forces you to do anything. It's entirely up to you to install VPN (and other company-provided software) or not.</p>

<p>And KPI are objective, too: reaction time, number of closed tickets and so on. If you fail to deliver — why should you get the appropriate bonus? It's not called “bonus” for nothing. You have to earn it.</p>

<font class="QuotedText">&gt; Employees can easily walk away from cases like this with two or three years salary in damages. To say nothing of the hit the company takes defending the case.</font>

<p>These are pure words at this point. I have friends both in UK and continental EU and it's really not hard to give people who misbehave 2x-3x less money.</p>

<p>As long as salary is the same and on paper there are no problems Employment Tribunal can do nothing. For added safety you may organize additional income to come in form of dividends or stocks (I don't think you can get stock options in EU, but that's not a big deal if your accountants are proficient enough).</p>

<p>Again: it really feels as if you live in the imaginary world where laws like these are perceived as something to follow and not an obstacle to overcome.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/865604/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor866962"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 21, 2021 0:24 UTC (Sat)
                               by <b>HenrikH</b> (subscriber, #31152)
                              [<a href="/Articles/866962/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How can the salary be both &quot;the same&quot; and &quot;2x-3x less&quot; at the same time?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/866962/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor865600"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 13:07 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865600/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>Answered the part where you, at least, admit that other people exist and may even, gasp, have desires different from yours.</p>

<font class="QuotedText">&gt; And while, as a gentoo user, your alternative is easy for me, many others would find that difficult and it is precisely those people we want to attract!</font>

<p>The majority of people are perfectly happy to live without hibernation and without the ability to change kernel options. They value the ability to pay with their phone in a shops or watch movies on Netflix <b>much</b> more than any software freedoms — otherwise devices of type <i>jail made cool, designed to sever fools from their freedom</i> wouldn't have outnumbered all others by count of 10-to-1 (and soon 100-to-1, I suspect).</p>

<p>Ok. Can you explain what kind of people you want to attract, why do you think I want to attract these same people, too, and why are you sure they even exist (except for the ones who have <b>already</b> switched to OpenBSD and Gentoo)?</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/865600/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor865523"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 6, 2021 22:24 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/865523/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Crashing the app is fine. We can also do something like send a signal to prepare the app for impending shutdown and/or after the restore.<br>
<p>
As a reaction, the application can re-obtain the secret from whence it came: security co-processor, web service, password prompt, etc.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865523/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor866855"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 20, 2021 7:14 UTC (Fri)
                               by <b>ncm</b> (guest, #165)
                              [<a href="/Articles/866855/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Far be it from me to agree with Cyberax, he is actually correct here. It is always permissible for an app to die while waking up from hibernation if its state cannot be restored and it cannot cope with that.  I do not expect my ssh sessions to survive hibernation, and would expect ssh-agent to forget its keys.<br>
<p>
If such an app has some way not to shut down, but to ask for its secrets to be restored instead, and continue, that might be better sometimes. But in no case does a need to clear secrets first mean hibernation must be disabled.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/866855/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor866961"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 21, 2021 0:22 UTC (Sat)
                               by <b>alopatindev</b> (guest, #153807)
                              [<a href="/Articles/866961/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; send a signal to prepare the app for impending shutdown and/or after the restore</font><br>
<p>
I like this idea. I wonder how multithreaded app should handle this signal though. Which thread is supposed to handle the signal: the main one, the random one, all of them?<br>
<p>
Another question: do I understand correctly that the protected memory can&#x27;t even be written to swap in case if the system is about to run OOM? (Or else I guess it would not make much sense to disable just hibernation, without disabling ordinary swapping).<br>
<p>
And another completely unrelated idea: how about (at least optionally) zeroing protected memory (by kernel) before completely releasing it? I know that apps suppose to do that, but it&#x27;s so easy to implement it incorrectly, that I personally would be happy if kernel simply would not allow to leak incorrectly released memory with sensitive data.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/866961/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor866967"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 21, 2021 1:17 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/866967/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I like this idea. I wonder how multithreaded app should handle this signal though. Which thread is supposed to handle the signal: the main one, the random one, all of them?</font><br>
<p>
Typically in a multithreaded app you will have a slim signal handler that sets some kind of a global flag that is processed &quot;soon&quot; by whatever thread that cares about it.<br>
<p>
<font class="QuotedText">&gt; Another question: do I understand correctly that the protected memory can&#x27;t even be written to swap in case if the system is about to run OOM? (Or else I guess it would not make much sense to disable just hibernation, without disabling ordinary swapping).</font><br>
<p>
Protected memory is realistically going to be used for stuff like encryption keys, so it&#x27;s unlikely that it&#x27;s going to make any measurable impact on OOM.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/866967/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor866996"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 21, 2021 13:44 UTC (Sat)
                               by <b>alopatindev</b> (guest, #153807)
                              [<a href="/Articles/866996/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Protected memory is realistically going to be used for stuff like encryption keys, so it&#x27;s unlikely that it&#x27;s going to make any measurable impact on OOM.</font><br>
<p>
I was thinking the same, thanks for clarification!<br>
<p>
<font class="QuotedText">&gt; Typically in a multithreaded app you will have a slim signal handler that sets some kind of a global flag that is processed &quot;soon&quot; by whatever thread that cares about it.</font><br>
<p>
Cool but I worry about this &quot;soon&quot;. Are there any risks for (multithreaded) app devs with this solution, that they might run into some stability issues that are hard to debug?<br>
<p>
How about this approach:<br>
- add some flag (or more likely some sync primitive) in the kernel that allows reading/writing to the protected memory by a process (the flag is controlled by some additional syscall for instance)<br>
- when the flag is set — the kernel is disallowed to hibernate (the hibernation will be postponed until all such flags are reset)<br>
- when the flag is reset — the app is disallowed to write to the protected memory (it will always get SIGBUS in this case)<br>
- when all the flags are reset by all processes and the hibernation is started, since the processes are suspended, all the protected memories become allowed to be written by the kernel (but not to be read!), the memories will be zeroed out (by the kernel) and released and the flags will no longer be allowed to set (syscall will return error)<br>
- as soon as apps wake up and they try to set the flag — they get errors, so they fully release the protected memory and call memfd_secret again.<br>
<p>
Perhaps this would solve this hibernation without sacrificing security and apps stability at the same time?<br>
<p>
What do you think: is that feasible and will it really improve anything for app devs? Thanks.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/866996/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor867035"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 22, 2021 11:28 UTC (Sun)
                               by <b>alopatindev</b> (guest, #153807)
                              [<a href="/Articles/867035/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;ll clarify what I mean by potential &quot;stability issues&quot; in case of implementing the signalling idea: suppose that process reads the global flag and acknowledges that it can read/write the protected memory. But just before it starts reading/writing, the flag gets updated and now the process crashes after attempting to read/write.<br>
<p>
I guess there&#x27;s no way to guarantee process stability with this design. Is that right?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867035/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor865528"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 2:09 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/865528/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hmm... If there&#x27;s a way to get the list of processes that hold secret data, then this is not necessary. User-space can just SIGKILL them before hibernating.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865528/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865539"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 6:22 UTC (Sat)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/865539/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Killing applications before hibernating defeats the whole purpose of hibernation.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865539/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865541"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 6:23 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/865541/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, refusing to hibernate also defeats its whole purpose.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865541/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor865532"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 3:04 UTC (Sat)
                               by <b>brchrisman</b> (subscriber, #71769)
                              [<a href="/Articles/865532/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Seems like there could be semantics giving the application warning that its memfd is going to be transitioned to open/accessible and that it should remove or encrypt its data and then back.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865532/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor865560"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 14:26 UTC (Sat)
                               by <b>jhoblitt</b> (subscriber, #77733)
                              [<a href="/Articles/865560/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;m not clear as to what type of threat this feature is designed to protect against. What is the threat model? It doesn&#x27;t sound like it protects against CPU side channel attacks. Presumably, a compromised kernel would allow the pages to be simply remapped. The data is in ram, various levels of caches and exposed on buses so it doesn&#x27;t defend against physical hardware/firmware compromise. Are memfd regions included in core dumps? I suppose it could prevent data from disclosure via kernel information leaks?  I do not understand how page mapping works in a VM guest kernel but I&#x27;m guessing this doesn&#x27;t help protect memory against a compromised VMM either?  Are there any known kernel vulnerabilities that allowed reading of memory this feature would have mitigated?<br>
<p>
Is it theoretically possible project process pages against a compromised kernel without hardware support?  <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865560/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865566"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2021 15:54 UTC (Sat)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865566/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Is it theoretically possible project process pages against a compromised kernel without hardware support?</font>

<p>You certainly can do that on a system with a hypervisor (although would need some cooperation with said hypervisor).</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/865566/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865704"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 16:06 UTC (Mon)
                               by <b>jhoblitt</b> (subscriber, #77733)
                              [<a href="/Articles/865704/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In the case of a guest kernel, it isn&#x27;t surprising if the host kernel provided protection features, but I think it is likely theoretically impossible to protect processes within a guest against the compromise of the host kernel without special hardware support that protects the guest kernel memory itself against the host kernel.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865704/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865763"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 20:57 UTC (Mon)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865763/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>That special hardware, though, may be yet another hypervisor. Although not sure how feasible that would be, but the idea sounds interesting: essentially a microkernel which is basically does MMU and IOMMU — and that's it.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/865763/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor865650"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 11:03 UTC (Mon)
                               by <b>sandsmark</b> (guest, #62172)
                              [<a href="/Articles/865650/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I just assumed it was for DRM purposes (the Netflix type).<br>
<p>
I. e. try to stop the user from inspecting the code running running on their machine (for example the Widevine module loaded in Firefox or Chrome).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865650/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865764"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 20:59 UTC (Mon)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865764/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <p>Use it for DRM is complete no-brainer and you can be 100% sure it would be, eventually, used for that.</p>

<p>But I don't think it's just DRM, there are more interesting applications if you consider hypervisors, at least.</p>




      
          <div class="CommentReplyButton">
            <form action="/Articles/865764/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865769"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 21:06 UTC (Mon)
                               by <b>jhoblitt</b> (subscriber, #77733)
                              [<a href="/Articles/865769/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Who would use it for DRM? Android? Something like Widevine couldn&#x27;t require it until something like a decade from now. rhel7/centos7, which is still widely deployed on business workstations, is using a kernel from 2013.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865769/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865770"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 21:19 UTC (Mon)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865770/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Something like Widevine couldn't require it until something like a decade from now.</font>

<p>Why? When Android and ChromeOS would be updated it can use it. Android usually takes longer, but not decade, more like 1-2 years.</p>

<p>The fact that this may break someone on desktop Linux is not a big deal for Google: Linux users are not their primary customers (e.g. Google Drive still have no Linux client).</p>

<p>Also: remember that Widevine is not-all-or-nothing: there are three levels of support. Would be easy to push devices without <code>memfd_secret</code> into tier2 or 3.</p>

<font class="QuotedText">&gt; rhel7/centos7, which is still widely deployed on business workstations, is using a kernel from 2013.</font>

<p>Not even close. If you would look on just a version number, then RHEL uses ancient kernel, but if you look on the list of features it supports… it carries tons of stuff backported from “latest and greatest”. If <code>memfd_secret</code> would be useful it will be backported, too, no problem.</p>





      
          <div class="CommentReplyButton">
            <form action="/Articles/865770/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865772"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 21:33 UTC (Mon)
                               by <b>jhoblitt</b> (subscriber, #77733)
                              [<a href="/Articles/865772/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;m not seeing a compelling use case for a feature that doesn&#x27;t really provide much security... especially for the DRM use case where the administrator of the system is probably considered the primary threat.  <br>
<p>
In particular, android already has keystore (which supports TEE).  Why would android apps bother to support a feature which will not be supported on the majority of devices for years (~1/2 of the android population is still &lt;= 9) and provides inferior security to an already universal feature (since 4) which takes advantage of hardware isolation where supported?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865772/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865774"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 21:41 UTC (Mon)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/865774/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Because existing feature doesn't provide the same level of protection?</font>

<p>Keystore does offer certain protections and may, probably, make sure you can't talk to Netflix directly, but it can not ensure that uncompressed video wouldn't be accessible to the rest of the system. <code>memfd_secret</code> can offer such ability.</p>

<p>And widevine doesn't come with apps in Android world, rather, it's something your device vendor provides. Thus the fact that old devices don't have it is not a big deal — very often they don't have the means to play 4K HDR video anyway, thus can safely be demoted to tier 2 or 3.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/865774/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865776"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 22:18 UTC (Mon)
                               by <b>excors</b> (subscriber, #95769)
                              [<a href="/Articles/865776/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Keystore does offer certain protections and may, probably, make sure you can&#x27;t talk to Netflix directly, but it can not ensure that uncompressed video wouldn&#x27;t be accessible to the rest of the system. memfd_secret can offer such ability.</font><br>
<p>
The TEE can (and does) do that - the decrypted bitstream and the decoded pixels are stored in RAM that&#x27;s made inaccessible to the kernel, and the GPU won&#x27;t render those pixels onto a kernel-accessible buffer or send them to a display that&#x27;s not protected by HDCP etc. Since that hardware support already exists and seems to be quite widespread on Android, it would be a step backwards to start relying on the kernel to enforce the security boundary.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865776/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor865780"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 23:18 UTC (Mon)
                               by <b>jhoblitt</b> (subscriber, #77733)
                              [<a href="/Articles/865780/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
`memfd_secret()` seems to be trying to do the impossible and project the memory of a process from the kernel in software.  It is not a replacement for a TEE but in fairness would be much easier to use. For the specific case of DRM, which is trying allow a 3rd party to restrict the functionality of an end-users device to prevent copying, it is completely unsuitable. (This is also ignoring the fundamental flaw of DRM in that data has be unencrypted somewhere to be displayed and will always be vulnerable to copying.) A loadable module should be able to find and remap the pages to allow them to be dumped.  The system call could equally be modified to copy the data or simply remap it to `memfd_create()`.<br>
<p>
DRM isn&#x27;t a use case I think the kernel should bother to accommodate.  I&#x27;m much more interested in functionality that protects &quot;my&quot; private keys.  A good test would be how is luks, gpg/gpg-agent, ssh-agent, openssl, etc. going to use this?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865780/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor865787"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2021 0:47 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/865787/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It&#x27;ll be useful for VPN session keys, access tokens for hardware TPMs, session cookies for sudo and other similar ephemeral but important credentials.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865787/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor865695"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 15:12 UTC (Mon)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/865695/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Is it theoretically possible project process pages against a compromised kernel without hardware support?</font><br>
<p>
*With* hardware support, you can use SGX or an equivalent technology. This sort of thing is increasingly available on consumer-grade hardware. But without hardware support, somebody has to have access to those pages (either the kernel or a hypervisor), because that&#x27;s just The Way CPUs Work (TM). Of course, there&#x27;s always the option of running on the bare metal with no kernel, but that&#x27;s probably not what you had in mind.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865695/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865705"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 16:10 UTC (Mon)
                               by <b>jhoblitt</b> (subscriber, #77733)
                              [<a href="/Articles/865705/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That is pretty much where I was going with the line of inquiry.  If this is a security feature which is relatively easy to bypass, and there are by CPU instructions to create protected ephemeral memory regions (and TPMs to protect cryptographic keys at rest) how likely is it to see use in the wild?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865705/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865814"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2021 8:53 UTC (Tue)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/865814/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; which is relatively easy to bypass</font><br>
<p>
Well... I don&#x27;t know about that. You have to have arbitrary kernelspace code execution, which is supposed to be impossible even for root (assuming, for the sake of argument, that the kernel has been locked down and won&#x27;t load arbitrary modules). If that is &quot;relatively easy,&quot; then it means you have found a serious security vulnerability, regardless of whether memfd_secret() is in use or not, and regardless of whether the attacker is root or not.<br>
<p>
In particular, this syscall defends against &quot;simple&quot; buffer overreads where the kernel is tricked into copying a bunch of random kernel-visible memory into an attacker-visible buffer, but without arbitrary code execution. That is also supposed to be impossible, of course, but constructing an overread attack is probably easier than constructing an ACE attack. In this sense, then, it can be thought of as a form of defense in depth, where we try to make attacks more difficult to construct, rather than trying to provide absolute guarantees of security.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865814/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor865584"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 4:33 UTC (Sun)
                               by <b>malor</b> (guest, #2973)
                              [<a href="/Articles/865584/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      If this feature breaks hibernation, I don't see any way it can realistically roll out or be accepted, ever.  You're in effect shooting everyone using a laptop in the head.  <p>

Maybe the Linux devs don't care about laptops, but the people owning laptops do.  No matter how wonderful this is for a server, they absolutely need to figure out how to make hibernation work safely.  Without that, it's a nonstarter for <i>exactly the people that mostly need it</i>, regular users that want extra protection for their cryptographic secrets. <p>

If hibernation isn't fixed, all 23 versions of this code strike me as a waste of everyone's time.  They might as well have worked on Yet Another Roguelike instead, for all the actual uptake it will get in the real world by real distributions. 







      
          <div class="CommentReplyButton">
            <form action="/Articles/865584/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865586"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 5:21 UTC (Sun)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/865586/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Does hibernation still work these days? I thought it was broken by the secure boot patches.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865586/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865790"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2021 1:34 UTC (Tue)
                               by <b>calumapplepie</b> (guest, #143655)
                              [<a href="/Articles/865790/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Nope.  Works like a charm.<br>
<p>
Bit finnicky, though.  You might remember me, I was talking about running a kernel bisect in #debian-next for a while, to figure out when hibernate-to-swapfile broke. Of course, while I was testing kernels to see where I should put the bisection bounds, it magically started working.  On every one of the QEMU images I had created, including the ones that I had just found to not work.<br>
<p>
Of course, when was the last time you read a story with charms that were completely explained, logical, and infallible?  Sounds like a boring story to me, and I sure am glad that hibernation isn&#x27;t like that!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865790/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865792"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2021 1:51 UTC (Tue)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/865792/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hmm, I wonder how the kernel knows the hibernation image is trustworthy. Normally that requires a trust chain from Microsoft to the thing being loaded, but with hibernation there can be none since only code running on the machine can sign the hibernation image.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865792/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865817"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2021 8:59 UTC (Tue)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/865817/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Secure boot checks the signature on the thing that receives control from UEFI (e.g. GRUB). It doesn&#x27;t know or care about the fact that GRUB hands control over to the Linux kernel, much less what RAM image the Linux kernel subsequently decides to load up.<br>
<p>
Otherwise, this chain of attestation would never end. You&#x27;d have to sign the kernel, and systemd, and GNOME, and Firefox, and...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865817/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor865587"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 8:12 UTC (Sun)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/865587/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Linux on laptops is probably a statistically insignificant minority of all Linux deployment. Number of people using hibernation is even smaller.<br>
I think biggest deployments of Linux - mobile phones and cloud servers - do not use hibernation. No problem in accepting memfd_secure() for them.<br>
<p>
I&#x27;ve written this comment on a laptop running Linux, but I&#x27;m aware of wider perspective. Incidentally, I haven&#x27;t had need to use hibernation for past half a decade or so.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865587/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865593"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 9:23 UTC (Sun)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/865593/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Some clouds are starting to use hibernation. E.g. EC2: <a href="https://aws.amazon.com/ru/about-aws/whats-new/2017/11/amazon-ec2-spot-lets-you-pause-and-resume-your-workloads/">https://aws.amazon.com/ru/about-aws/whats-new/2017/11/ama...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865593/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor865597"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2021 11:01 UTC (Sun)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/865597/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That&#x27;s true for guest, but there&#x27;s the other half – actual hypervisors running on bare metal. I bet they do not hibernate.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865597/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor865651"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2021 11:14 UTC (Mon)
                               by <b>sandsmark</b> (guest, #62172)
                              [<a href="/Articles/865651/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Since the only real usecase I can see for this is protecting DRM like Widevine (i. e. don&#x27;t let the user inspect the code running), it doesn&#x27;t matter much if the module is killed when going into suspend.<br>
<p>
It just needs to run when you&#x27;re trying to access DRM protected content in e. g. Firefox or Chrome, and when waking from suspend it can just get reloaded and check that it is running in an environment that the user hasn&#x27;t messed with again.<br>
<p>
Assuming I&#x27;m right, this is going to be fun. The API exposed to DRM modules is already pretty extensive (I remember at least including file IO and some network access in CDM11), but it is kind of limited now because on Linux you just have the &quot;lowest&quot; security level. They can&#x27;t &quot;trust&quot; the operating system because the user has too much access to their own devices (except on Android).<br>
<p>
But with this I&#x27;m assuming the goal is to allow the next level and will include API for the black box CDM binaries to inspect the whole system.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/865651/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor866956"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfd_secret() in 5.14</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 20, 2021 23:42 UTC (Fri)
                               by <b>jhartzell42</b> (guest, #153813)
                              [<a href="/Articles/866956/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think that features useful for servers and completely useless for laptop users are ... still useful for server users, and can proceed without damaging laptop users, who will simply ... not use those features. Why should the laptop use case hold the server use case back? Why are server-only features a waste of time in your book?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/866956/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2021, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
