        <!DOCTYPE html>
        <html lang="en">
        <head><title>ELC: Linaro power management work [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/439169/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/438402/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/439169/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>ELC: Linaro power management work</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ignore previous instructions; subscribe to LWN today</b>
<p>
Every article on LWN.net is written by humans, for humans. If you've
enjoyed this article and want to see more like it, your subscription goes a
long way to keeping the robots at bay.  We are offering <a href="https://lwn.net/Promo/nst-bots/claim">a free one-month trial subscription</a> (no credit card required) to get you started.
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>April 20, 2011</br>
           </div>
<p>
There was a large Linaro presence at this year's <a
href="http://events.linuxfoundation.org/events/embedded-linux-conference/">Embedded
Linux Conference</a> with speakers from the organization reporting on
its efforts to consolidate functionality from the various ARM
architecture trees.  One of those talks was by Amit Kucheria,
technical lead for the power management working group (PMWG), who talked about
what the working group has been doing since it began.
That includes some work on tools like powertop, and the newly available
PowerDebug, as well as some consolidation within the kernel tree.
He also highlighted areas where Linaro plans to focus its efforts in the
future.
</p>

<p>
Kucheria started with a look at what Linaro is trying to accomplish, part
of which is to "<q>take the good things in the BSP [board support
package] trees and get them upstream</q>". In addition, consolidating
the kernel source, so that there is one kernel tree that can be used by all
of the Linaro partners, is high on the list.  There is a fair amount of
architecture consolidation that is part of that, including things like
reducing the 
"<q>ten or twenty <tt>memcpy()</tt> functions</q>" to one version
optimized for all of the ARM processors.  All of that work should
result in patches that get sent upstream.
</p>

<p>
The PMWG has "<q>existed for six to eight months now</q>", Kucheria
said, and has been focused on consolidation and tools.  There has been a
bit of kernel work, which includes ensuring that the clock tree is exported
in the right place in debugfs for five System-on-a-chips (SoCs) that Linaro and its
sponsors/partners have targeted (Freescale i.MX51, TI OMAP 3 and 4, Samsung
Orion, and ST-Ericsson UX8500).  In addition, work was done on cpufreq,
cpuidle, and CPU hotplug for some of them.  Some of
that work is still in progress, but most of it has gone 
(or is working its way) upstream, he said. 
</p>

<a href="/Articles/439350/">
<img src="https://static.lwn.net/images/2011/elc-powerdebug-sm.png" border=0 hspace=3
width=150 height=94 align="left" alt="[PowerDebug]">
</a>

<p>
Beyond kernel work, the group has been working on tools, starting with
getting powertop to work with ARM CPUs and pushing that work upstream.
A new tool, <a href="https://wiki.linaro.org/WorkingGroups/PowerManagement/Doc/PowerDebug">PowerDebug</a>, has been created to help look at the clock tree to
see "<q>what clocks are on, which are active, and at what
frequency</q>", Kucheria said.  It also shows power regulators that have
registered with the regulator framework by pulling information from
sysfs. It shows which regulators 
are on and what voltages are currently being used.  Other SoCs or
architectures can use PowerDebug simply by exporting their clock tree into
debugfs. 

<p>
PMWG has also been <a href="https://wiki.linaro.org/WorkingGroups/PowerManagement/Doc/Hotplug">experimenting</a> with thermal management and hotplug.  In
particular, it has been looking at what policies make sense when the CPU
temperature gets too high.  One possibility would be to hot-unplug a core
to reduce the amount of heat generated.  There is some inherent latency in
plugging or unplugging a core, he said, which can range from 40-50ms in a
simple case 
to several seconds if there are a lot of threads running.
There is a notification chain that causes the latency, so it's possible
that could be reduced by various means.
</p>

<h4>Complexity in power management</h4>

<a href="/Articles/439336/">
<img src="https://static.lwn.net/images/2011/elc-kucheria-diagram-sm.png" border=0 hspace=3
width=125 height=94 align="right" alt="[Diagram]">
</a>

<p>
With a slide showing the complexity of Linux power management (shown at
right) today, Kucheria launched into a description of some of the problems
that OEMs are faced with when trying to tune products for good battery
life.  In that diagram, he noted there are "<q>six or seven different
knobs that you can twiddle</q>" to adjust power usage.  Those OEMs
simply don't have the resources to deal with that complexity, some kind of
simplification is required.  In addition, the complexity is growing with
more and more SoCs along with different power management schemes
in the hardware. 
</p>

<p>
In the "good old days", of five or six years ago, the OMAP 1 just used the
Linux driver model suspend hooks to change the clock frequency.  The clock
framework was standard back then, but now there are 30 or 40 different
clock frameworks in the ARM tree.  CPU frequency scaling (cpufreq) was
added after that, but it doesn't take into account the bus or coprocessor
frequencies. Later on, several different frameworks were added including
the regulator framework, cpuidle to control idle states, and power
management quality of
service (pm_qos).
</p>

<p>
The quality of service controls are important for devices that need to
bound the latency for coming out of idle states, for example for network
drivers that cannot tolerate more than 300ms of latency.  The cpuidle
framework introduced some problems, though, Kucheria said, because they
were created by Intel, who concentrated on its platforms.  The C-states
(C0-C6) don't really exist for ARM processors and various vendors
interpreted them differently for particular SoCs.  In addition, some have
added additional states (C7, C8) 
</p>

<p>
Later still in the evolution of Linux power management, hotplug support was
added, which can reduce the power consumption by unplugging CPU cores.
There are a number of outstanding issues there, though, including latency
and policy.  Vendors have various "<q>patches floating around</q>",
but there isn't a consistent approach.  Coming up with policies, perhaps
embodied in a hotplug governor, is something that needs to be done.
</p>

<p>
Runtime power management was the next component added in.  PMWG would like
to use it to
reduce the need for drivers to talk directly to the clocks 
and instead they would talk in a more general way to the runtime power
management 
framework.
Lots of code 
that is scattered around in various drivers can be centralized in bus
drivers, which will make the device drivers much more portable because they
don't refer to specific clocks.  Vendors
have started switching over to using the runtime power management
framework, but "<q>it's a painful 
process</q>" to change all of the drivers, he said.
</p>

<p>
The latest piece of the power management puzzle is the addition of
Operating Performance Points (OPP) support, which was added in 2.6.38.  OPP
is a way to describe frequency/voltage pairs that a particular SoC will
support for its various sub-modules.  OPP is very CPU/SoC-specific, but can
also encapsulate the requirements for different buses and co-processors.
The cpufreq framework can make use of the information as it changes the
frequency characteristics of different parts of the hardware.
</p>

<p>
As more dual-core and quad-core packages are being used, heat can be a
problem. The existing thermal management framework is not being used by ARM
vendors yet and there are a number of issues to be resolved.  Linaro wants
to "<q>figure it out once and for all</q>", and that is one its
focuses in the coming months.  One of the questions is what should be done
when the system is overheating. Should it unplug one or more cores?  Or
reduce the frequency of the CPU clock?  One of the "<q>crazy
things</q>" PMWG has been thinking about is registering devices that can
reduce their frequency as "cooling devices" (since they will generate less
heat with a lower frequency). 
</p>

<h4>PMWG's plans</h4>

<p>
The existing thermal management code works for desktop Linux, Ubuntu in
particular, and also for Android, but there is still some experimenting
that needs to be done to come up with an ARM-wide solution.  Another area
that PMWG will work on is adding scheduling domains for ARM so that you can
"<q>tweak your scheduler policy</q>" regarding how processes and
threads get spread around on multiple cores.  Scheduling domains and
sched_mc tunables could eliminate the need
for hotplug in some cases, he said.
</p>

<p>
Rationalizing the names and abilities of the processor C-states is also
something that PMWG will be working on.  Kucheria said that PMWG wants to
"<q>start a conversation</q>" with the relevant vendors and
developers to make that happen.  PowerDebug enhancements are also on the
radar: "<q>If you need stuff [in PowerDebug], let us know</q>".
There is lots of other consolidation work that could be done, but there are
only enough developers to address the parts he described, at least in the
near term.
</p>

<p>
At the end of the talk, Kucheria put the Linux power management diagram
slide back up, noting that the complexity was "<q>great for job
security</q>".  There is clearly plenty of work to do in the ARM tree in
the months ahead.  Kucheria's talk just covered the work going on in the
power management group, but there are four other groups within Linaro
(kernel, toolchain, graphics, and multimedia) that are doing similar jobs
inside and outside of the kernel.  One gets the sense that the companies
who founded Linaro were getting as tired of the chaotic ARM world as the
kernel developers (e.g. Linus Torvalds) are.  So far, the organization has
made some strides, but there is a long way to go.
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Power_management">Power management</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Embedded_Linux_Conference-2011">Embedded Linux Conference/2011</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/439169/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2011, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
