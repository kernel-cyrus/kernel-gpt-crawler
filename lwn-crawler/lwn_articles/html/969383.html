        <!DOCTYPE html>
        <html lang="en">
        <head><title>A tale of two troublesome drivers [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/969383/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/969443/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/969383/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>A tale of two troublesome drivers</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>We're bad at marketing</b>
<p>
We can admit it, marketing is not our strong suit. Our strength is
writing the kind of articles that developers, administrators, and
free-software supporters depend on to know what is going on in the
Linux world. Please <a href="/Promo/nsn-bad/subscribe">subscribe today</a> to help us keep doing that, and so
we donâ€™t have to get good at marketing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>April 12, 2024</br>
           </div>
The kernel project merges dozens of drivers with every development cycle,
and almost every one of those drivers is entirely uncontroversial.
Occasionally, though, a driver submission raises wider questions, leading
to lengthy discussion and, perhaps, opposition.  That is currently the case
with two separate drivers, both with ties to the networking subsystem.  One
of them is hung up on questions of whether (and how) all device
functionality should be made available to user space, while the other has
run into turbulence because it drives a device that is unobtainable outside
of a single company.
<p>
<h4>mlx5ctl and fwctl</h4>
<p>
The mlx5ctl driver is not a new problem; it was <a
href="/Articles/955001/">covered here</a> in December 2023.  In short: this
driver implements a transport channel allowing user space to query and
manipulate parameters on an mlx5 device (which provides a range of
networking, RDMA, and InfiniBand functionality), crucially without any
understanding of those parameters on the kernel's part.  Proponents say
that this driver is needed to provide users with the access needed to
configure and debug their hardware, especially on locked-down systems where
other methods of talking directly to the hardware are unavailable.
Opponents see it as a way of circumventing the normal development process
that governs how device parameters are exported to user space.
<p>
Saeed Mahameed posted <a
href="/ml/linux-kernel/20240207072435.14182-1-saeed@kernel.org/">a new
version of the mlx5ctl patch series</a> at the beginning of February,
saying: "<q>We continue to think that mlx5ctl is reasonable and aligned
with the greater kernel community values</q>".  Christoph Hellwig <a
href="/ml/linux-kernel/Zcx53N8lQjkpEu94@infradead.org/">responded</a> with
an ack and a complaint about the "<q>subsystem maintainer overreach</q>"
that has blocked the merging of this driver.  Networking maintainer Jakub
Kicinski <a
href="/ml/linux-kernel/20240214074832.713ca16a@kernel.org/">agreed</a> that
"<q>overreach is unfortunate</q>", but also maintained the position that
this driver should not be merged: "<q>We have a clear rule against opaque
user space to FW [firmware] interfaces</q>".  Beyond that, there was not a
lot of other discussion on the submission at that time.
<p>
At the beginning of March, though, Jason Gunthorpe posted <a
href="/ml/linux-kernel/20240304160237.GA2909161@nvidia.com/">a proposal</a>
for a new subsystem called "fwctl" that would be the home for drivers like
mlx5ctl.  Modern devices, he wrote, tend to come with a large set of
tunable parameters controlling many aspects of their functionality; these
parameters need to be made accessible by user space if users are to be able
to use their hardware.
<p>
<blockquote class="bq">
	fwctl's purpose is to define a common set of limited rules,
	described below, that allow user space to securely construct and
	execute RPCs inside device FW.  The rules serve as an
	agreement between the operating system and FW on how to correctly
	design the RPC interface. As a uAPI the subsystem provides a thin
	layer of discovery and a generic uAPI to deliver the RPCs and
	collect the response. It supports a system of user space libraries
	and tools which will use this interface to control the device.
</blockquote>
<p>
The proposal goes into some detail on the types of functionality that will
be made available via fwctl interfaces.  It also covers the functionality
that <i>cannot</i> be provided, including the ability to DMA to arbitrary
memory, manipulate kernel memory or subsystems outside of the driver
itself, or provide functionality, such as sending a network packet, that
should be handled by another subsystem.
<p>
As before, the primary opposition (to both mlx5ctl and fwctl) came from
Kicinski.  He <a
href="/ml/linux-kernel/20240322135826.1c4655e2@kernel.org/">described</a>
the justification for this work as "<q>smoke and mirrors</q>", saying it
was a way for manufacturers to "<q>hide as much as possible of what you
consider your proprietary advantage in the 'AI gold rush'</q>".  Complex
hardware, he <a
href="/ml/linux-kernel/20240322152924.64be7ec4@kernel.org/">said</a>, does
not need a backdoor to talk to the firmware without the kernel's mediation;
he cited the network interfaces used at Meta (his employer) as an example.
He <a
href="/ml/linux-kernel/20240322154027.5555780a@kernel.org/">questioned</a>
whether the restrictions on fwctl drivers would be enforced, and said that
the conversation did not appear to be going anywhere useful:
<p>
<blockquote class="bq">
	Or should we go for another loop of me talking about openness and
	building common abstractions, and vendors saying how their way of
	doing basic configuration is so very special, and this is just for
	debug and security and because others.
	<p>
	There's absolutely no willingness to try and build a common interface
	here.
</blockquote>
<p>
Kicinski has repeatedly said that this functionality should be provided via
an API like <a
href="https://docs.kernel.org/networking/devlink/">devlink</a>, where
parameters are exposed after a community review that is, among other
things, intended to force consistency between hardware from different
manufacturers.  He <a
href="/ml/linux-kernel/20240403170149.7d2b8f2b@kernel.org/">complained</a>
that his offer to quickly review proposed devlink knobs had been ignored by
the vendors looking for interfaces like fwctl.
<p>
On the other side, David Ahern <a
href="/ml/linux-kernel/1cd2a70c-17b8-4421-b70b-3c0199a84a6a@kernel.org/">asserted</a>
that fwctl <i>is</i> the common interface that Kicinski is looking for.
Gunthorpe <a
href="/ml/linux-kernel/20240402184055.GP946323@nvidia.com/">said</a> that
all complex devices require hardware-specific tooling to configure them to
the customer's needs.  The only reason Meta does not need such tools is
that, as a large customer, it is able to receive its hardware preconfigured
from the vendor; smaller customers do not receive that level of service.
Vendors have been providing these tools for years, he said; fwctl is just a
way to provide a common interface for them.
<p>
The problem with the devlink approach, Gunthorpe <a
href="/ml/linux-kernel/20240404122338.GI1723999@nvidia.com/">added</a>, is
that, beyond the slow and painful nature of the process, it is guaranteed
to fail.  To be useful, an interface must be able to work with all of the
parameters provided by the device:
<p>
<blockquote class="bq">
	As far as configuration/provisioning goes, it is really all or
	nothing.
<p>
	If a specific site can configure only 90% of the stuff required
	because you will NAK the missing 10% it then it is still not usable
	and is a wasted effort for everyone.
<p>
	You have never shown that there is a path to 100% with your
	approach to devlink. In fact I believe you've said flat out that
	100% is not achievable.
</blockquote>
<p>
Kicinski <a href="/ml/linux-kernel/20240404074850.19ecd52e@kernel.org/">was
not receptive</a> to this argument, though, calling many of the knobs
"<q>hacks and lazy workarounds</q>".
<p>
As of this writing, this discussion does not appear to be any closer to a
resolution than it was in December.  The positions taken have only hardened
over time.  In the end, the fate of this driver (or for a future fwctl
subsystem) may well depend on whether Linus Torvalds is willing to allow a
networking maintainer to block the merging of a driver that is, by most
accounts, independent of the networking subsystem.
<p>
<h4>A network interface for one</h4>
<p>
At the beginning of April, Alexander Duyck posted <a
href="/ml/netdev/171217454226.1598374.8971335637623132496.stgit@ahduyck-xeon-server.home.arpa/">a
driver called "fbnic"</a> for a custom network interface card that is used
only within Meta.  That prompted <a
href="/ml/netdev/Zg6Q8Re0TlkDkrkr@nanopsycho/">an immediate question</a>
from Jiri Pirko, who wondered why the community needs a driver for a device
that nobody is able to acquire.  Duyck <a
href="/ml/netdev/CAKgT0Uf8sJK-x2nZqVBqMkDLvgM2P=UHZRfXBtfy=hv7T_B=TA@mail.gmail.com/">responded</a>
that upstreaming the driver would make maintenance easier, that it would
make it easier to introduce new networking features implemented in the
driver, and that the company might someday open some of the hardware
information as well.  Pirko <a
href="/ml/netdev/Zg7JDL2WOaIf3dxI@nanopsycho/">was unimpressed</a> and said
that the driver should not be merged.
<p>
Duyck <a
href="/ml/netdev/CAKgT0Ufgm9-znbnxg3M3wQ-A13W5JDaJJL0yXy3_QaEacw9ykQ@mail.gmail.com/">called</a>
this reasoning "<q>arbitrary and capricious</q>".  The driver will have a
lot of users at Meta, he said.  There have been other proprietary devices
added to the kernel in the past; the <a
href="https://docs.kernel.org/networking/device_drivers/ethernet/intel/idpf.html">Intel
IDPF driver</a> was mentioned as an example elsewhere in the conversation.
Drivers also often show up for devices that are not yet for sale, and may
never make it to the market.  To reject the driver, he said, is an
accusation of "<q>some lack of good faith</q>" from Meta.
<p>
Kicinski <a href="/ml/netdev/20240404132548.3229f6c8@kernel.org/">tried to
redirect the discussion</a> somewhat, saying that he did not want to be in
the position of judging the "good faith" of companies.  The community, he
said, had to make its decision based on the interest of the project and the
broader user base.  He did not say, then, whether he thought the driver
should be merged or not.  Others, though, such as <a
href="/ml/netdev/660f22c56a0a2_442282088b@john.notmuch/">John
Fastabend</a> and <a
href="/ml/netdev/678f49b06a06d4f6b5d8ee37ad1f4de804c7751d.camel@redhat.com/">Paolo
Abeni</a>, argued that fbnic appeared to be good code, and that in any case
it is only a network-interface driver with no potential to harm the rest of
the kernel, so there is no reason to keep it
out.
<p>
Gunthorpe, while not arguing against the merging of fbnic, <a
href="/ml/netdev/20240405122646.GA166551@nvidia.com/">raised some
concerns</a>.  There is a strong feeling that code should not be merged
solely for the purpose of supporting proprietary user-space code, he said,
and "<q>this submission is clearly blurring that line</q>".  That could, he
<a href="/ml/netdev/20240405190209.GJ5383@nvidia.com/">said</a>, lead to
problems in the future as more features are added to the driver.
<p>
There was a brief turn in the conversation when Andrew Lunn <a
href="/ml/netdev/d0bd66c7-13d2-40a3-8d7d-055ac0234271@lunn.ch/">referred</a>
to the mlx5ctl discussion and asked Duyck to show that a separate
firmware-tuning driver would not be required for this device.  Kicinski <a
href="/ml/netdev/20240404083752.5c81d369@kernel.org/">said</a> that showing
that would not change anybody's mind.  Ahern <a
href="/ml/netdev/a1e5ccd3-1a9b-4d78-8216-2274e1222bb8@kernel.org/">suggested</a>
that, in the future, when "<q>the inevitable production problems</q>" show
up, a separate, mlx5ctl-like driver may well become necessary.
<p>
Perhaps the biggest concern, though, was <a
href="/ml/netdev/20240404165000.47ce17e6@kernel.org/">expressed</a> by
Kicinski: what happens if changes elsewhere in the kernel break the driver,
creating a regression for its users?  Since the community as a whole cannot
test the driver, such breaks could be hard to avoid and even harder to fix;
that could lead to kernel changes being reverted.  In such a situation, a
private driver like fbnic could impede kernel development in general.
<p>
For that reason, though Kicinski eventually <a
href="/ml/netdev/20240409135142.692ed5d9@kernel.org/">concluded</a> that
"<q>there's broad support for merging the driver</q>", he also said that
there needs to be a slightly different set of rules governing drivers for
private devices.  These would include "<q>weaker 'no regression'
guarantees</q>" and an expectation that the driver maintainers will
participate actively in efforts to refactor subsystem interfaces.  In the
absence of such participation, a driver for a private device could be
removed from the kernel.  Pirko eventually <a
href="/ml/netdev/ZhasUvIMdewdM3KI@nanopsycho/">agreed</a> that, if the
driver were to be marked as belonging to this new regime (which would have
to be documented), it "<q>would be ok to let this in</q>".
<p>
So the fbnic driver seems likely to be merged in the end.  The same may
eventually be true of mlx5ctl in some form as well.  The Linux kernel did
not get to the position it is in by refusing to let users access the full
capabilities of their hardware, and it seems unlikely to adopt such a
policy now.  A more difficult prospect, though, is to guess how many more
lengthy discussions will be required to reach that decision.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_model-Driver_merging">Development model/Driver merging</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Device_drivers">Device drivers</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/969383/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor969634"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A tale of two troublesome drivers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 16:53 UTC (Fri)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/969634/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; If a specific site can configure only 90% of the stuff required because you will NAK the missing 10% it then it is still not usable and is a wasted effort for everyone.</span><br>
<p>
Am I understanding this argument correctly? It sounds as if they're saying "devlink satisfies all of our technical requirements, but we can't use it for political reasons." If so, that seems like a very poor argument for adding a second configuration interface. What makes you think you won't run into exactly the same political issues with the new interface?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969634/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969638"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A tale of two troublesome drivers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 17:20 UTC (Fri)
                               by <b>pizza</b> (subscriber, #46)
                              [<a href="/Articles/969638/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Am I understanding this argument correctly? It sounds as if they're saying "devlink satisfies all of our technical requirements, but we can't use it for political reasons."</span><br>
<p>
It's more like "devlink's politics prevent it from satisfying all of our technical requirements"<br>
<p>
("technical requirements" meaning "users can configure all necessary features of the device")<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969638/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969639"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A tale of two troublesome drivers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 17:24 UTC (Fri)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/969639/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That's really not much better. devlink's politics are LKML's politics, and fwctl's politics will also be LKML's politics. You cannot specify the politics of an interface by writing code.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969639/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969648"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A tale of two troublesome drivers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 20:00 UTC (Fri)
                               by <b>pizza</b> (subscriber, #46)
                              [<a href="/Articles/969648/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The point being, if what gets merged doesn't allow for all necessary features of the device to be configured, it _still_ needs a secondary configuration mechanism/path for the rest, or the result is not fit for purpose and won't actually be used by anyone.<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969648/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor969650"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">devlink v. fwctl</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 20:03 UTC (Fri)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/969650/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      The difference is that, while devlink parameters are subject to review with the intent of having them work the same way across devices, fwctl parameters are whatever the firmware provides and aren't discussed on the mailing list at all.  They probably do not appear in the driver code.
So I would not expect fwctl to have the same difficulties (and neither do its proponents).


      
          <div class="CommentReplyButton">
            <form action="/Articles/969650/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969654"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">devlink v. fwctl</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 21:15 UTC (Fri)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/969654/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; So I would not expect fwctl to have the same difficulties (and neither do its proponents). </span><br>
<p>
I expect it to have a whole different set of difficulties and to eventually get kicked out by Linus. Not because this couldn't work, but because this is exactly the sort of "give an inch" which idiots at hardware companies abuse until it's intolerable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969654/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969665"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">devlink v. fwctl</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 23:24 UTC (Fri)
                               by <b>jgg</b> (subscriber, #55211)
                              [<a href="/Articles/969665/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wonder what intolerable would be? Lots of examples of this kind of interface in the kernel now..<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969665/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969759"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">devlink v. fwctl</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2024 3:45 UTC (Sun)
                               by <b>lutchann</b> (subscriber, #8872)
                              [<a href="/Articles/969759/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I assume "abuse" here means implementing functionality in a proprietary fashion through fwctl that clearly should be done with an existing generic interface, solely for the purpose of lock-in.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969759/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969769"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">devlink v. fwctl</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2024 10:15 UTC (Sun)
                               by <b>intelfx</b> (subscriber, #130118)
                              [<a href="/Articles/969769/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; solely for the purpose of lock-in</span><br>
<p>
Might also be for the purpose of "ship now, think later" (aka cost-cutting). The rest of your comment is on point.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969769/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor969657"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">devlink v. fwctl</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 21:46 UTC (Fri)
                               by <b>Binary-Eater</b> (subscriber, #159553)
                              [<a href="/Articles/969657/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think the problem is that devlink is specific for configuring netdev-class devices.<br>
<p>
<a href="https://www.kernel.org/doc/html/latest/networking/devlink/">https://www.kernel.org/doc/html/latest/networking/devlink/</a><br>
<p>
I think the problem the fwctl subsystem is trying to solve is that for multi-class devices, such as a chip that can do both Infiniband and netdev work, devlink cannot contain Infiniband or other class device related parameters. For example, you could not propose common GPU parameters to devlink. It is more subject to the unification of network type devices than commonality among devices of various applications. I think fwctl would likely audit FW parameters being supported in the transport rather than being an arbitrary transport but use a model of acceptance and then unify rather than trying to unify upfront. Just my personal interpretation.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969657/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor969666"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">devlink v. fwctl</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 23:41 UTC (Fri)
                               by <b>jgg</b> (subscriber, #55211)
                              [<a href="/Articles/969666/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, the configuration stuff that has made such a ruckus is much like, say, EFI variables stored in BIOS flash. Do a "ls /sys/firmware/efi/efivars/" for example. How fully accessing a similar set of variables in a PCI device flash deserves such a discussion is really :(<br>
<p>
You can see examples of what "works across all devices" looks like - eg look at the discussion about max_io_eqs and how it doesn't converge because it isn't clear if the mlx5 HW notion of EQ really translates to other devices. Another different kind of device, idpf, wanting to do SFs needs a different set of knobs. So "common" becomes a set of 3 configurables that maybe no device will implement all of, or nothing is agreed and nobody gets anything.<br>
<p>
It is a common story of trying to tease out commonality in micro details from devices that were never designed to be common at all, sort of a rorschach test.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969666/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor969635"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Two driver rule</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 16:54 UTC (Fri)
                               by <b>nickodell</b> (subscriber, #125165)
                              [<a href="/Articles/969635/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;Others are more cautious focusing on blast radius and referring to the "two driver rule" (Daniel, Paolo)?</span><br>
<p>
What is the two driver rule?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969635/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969641"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Two driver rule</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 17:42 UTC (Fri)
                               by <b>moorray</b> (subscriber, #54145)
                              [<a href="/Articles/969641/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"Two driver rule" is requiring two independent drivers to implement any major core stack feature before kernel merges it. But unclear whether such rules exists in practice or what the origins are. To some extent it's covered here: <a href="https://lore.kernel.org/all/20240408080420.7a6dad61@kernel.org/">https://lore.kernel.org/all/20240408080420.7a6dad61@kerne...</a><br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969641/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969645"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Two driver rule</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 18:50 UTC (Fri)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/969645/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It is common in the industry to require two independent implementation of a specification before<br>
making it a standard.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969645/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969653"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Two driver rule</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2024 20:45 UTC (Fri)
                               by <b>WolfWings</b> (subscriber, #56790)
                              [<a href="/Articles/969653/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <p>See also: Why "<a href="https://www.w3.org/TR/webdatabase/">Web SQL</a>" got discontinued mis-standards process: Every single implementation ended up just picking SQLite because it worked well enough, and W3C dropped things like a hot potato because that's not a standard, that's just a shim layer for SQLite embedding.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/969653/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969692"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SQLite is the only logical choice</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 13, 2024 13:50 UTC (Sat)
                               by <b>DemiMarie</b> (subscriber, #164188)
                              [<a href="/Articles/969692/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thereâ€™s no good reason to not use SQLite in an application like that, unless one has extreme performance needs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969692/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969699"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SQLite is the only logical choice</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 13, 2024 14:29 UTC (Sat)
                               by <b>geofft</b> (subscriber, #59789)
                              [<a href="/Articles/969699/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The specific problem was that it gave you a fairly raw interface to SQLite, to the point that upgrading SQLite would have broken existing applications by parsing queries differently or even fixing bugs. I think one of the browser vendors was shipping a decade-old copy of SQLite, which is not something browser vendors feel particularly great about doing.<br>
<p>
There is a polyfill which uses a wasn build of SQLite, which allows individual websites to upgrade or accept the risk of old versions as they prefer.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969699/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor969697"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Two driver rule</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 13, 2024 14:07 UTC (Sat)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/969697/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So the replacement is Wasm SQLite?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969697/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969762"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Two driver rule</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2024 5:57 UTC (Sun)
                               by <b>WolfWings</b> (subscriber, #56790)
                              [<a href="/Articles/969762/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>If you explicitly need to parse an SQLite database? Yes, you'd need a WASM compile of SQLite, but that doesn't help you with storing data in the browser.</p>

<p>If you mean "What standard did they go with?" then that's <a href="https://caniuse.com/indexeddb">IndexedDB</a> which they changed the basic theory of to get folks to do their own ideas instead of raw naked SQL which resulted in everyone doing SQLite.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/969762/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor969681"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">fbnic Hardware Programming Interface Documentation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 13, 2024 9:04 UTC (Sat)
                               by <b>kalvdans</b> (subscriber, #82065)
                              [<a href="/Articles/969681/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Since the community as a whole cannot test the driver, such breaks could be hard to avoid and even harder to fix</span><br>
<p>
If Meta could link to the documentation / register-map of their device, anyone could evaluate whether the code is correct or not. One could even write a simulated model of the device to test the kernel without access to the hardware.<br>
<p>
I would like if all drivers had a link to the hardware documentation on the top of the source code file.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969681/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor971193"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">fbnic Hardware Programming Interface Documentation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 25, 2024 17:33 UTC (Thu)
                               by <b>sammythesnake</b> (guest, #17693)
                              [<a href="/Articles/971193/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It would seem fair to me that meta could (IMHO, *should*) be required as a condition of including this driver, to provide this documentation, simulation, and appropriate tests.<br>
<p>
Armed with this, any kernel changes that would require changes to this code could be done without access to the hardware and validated against the simulation+tests. In any case where the simulation+tests did not catch problems, then the only ones who miss out are Meta, who are thereby given incentive to ensure quality/coverage of what they provide.<br>
<p>
I think that would seem like a win-win for everyone concerned, no...?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/971193/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor969680"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TCP Offload engines</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 13, 2024 9:05 UTC (Sat)
                               by <b>garloff</b> (subscriber, #319)
                              [<a href="/Articles/969680/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The discussion reminds me a bit on the controversy of TCP offload engines, that were not allowed into the kernel.<br>
They would have circumvented the kernel's networking stack to a significant degree, which was undesired, as networking would have become very much dependent on specific hardware and proprietary firmware implementations for users of that functionality.<br>
It was rejected in the end. Instead, common ground was built with checksumming offload, tcp segmentation offload and some of the other things that `ethtool -k` exposes.<br>
I believe that was a win for everyone except for hardware vendors that would have preferred the lock-in of course.<br>
<p>
Applying that to mlx5ctl: If it exposes things that will be and need be hardware specific, we should probably allow it.<br>
If it exposes things that should be done generically (affecting different hardware of the same class), we should force a generic approach. Generic debugging settings, generic filtering capabilities, ...<br>
<p>
This is an arms race: We have devices these days that have the functionality and complexity of operating systems. They might control more of your computer's operation than you might realize. (I'm thinking of SmartNICs and DPUs here.)<br>
Them being proprietary does remove a lot of the transparency and control that open source operating systems brought us.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969680/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor969701"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TCP Offload engines</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 13, 2024 14:45 UTC (Sat)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/969701/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; This is an arms race: We have devices these days that have the functionality and complexity of operating systems. They might control more of your computer's operation than you might realize. (I'm thinking of SmartNICs and DPUs here.)</span><br>
Them being proprietary does remove a lot of the transparency and control that open source operating systems brought us.<br>
<p>
Not sure what "arms race" means exactly in this context but yeah, "devices" have been running operating systems for a long time now. I put "devices" in quotes because there have been micro-controllers running operating systems on the CPU and GPU chips themselves for a long time too. I think that "race" is pretty much over by now, we have been in the "Distributed System on Chip" era for a very long time already.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969701/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor971618"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TCP Offload engines</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 30, 2024 3:35 UTC (Tue)
                               by <b>fest3er</b> (guest, #60379)
                              [<a href="/Articles/971618/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Kind-of like the DEC-20 that had a PDP-11 handling I/O?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/971618/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor969725"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TCP Offload engines</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 13, 2024 19:25 UTC (Sat)
                               by <b>jgg</b> (subscriber, #55211)
                              [<a href="/Articles/969725/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
TCP offload was not rejected from the kernel, it was rejected from netdev and rejected to use the standard sockets API.<br>
<p>
TCP offload hardware is operated through the RDMA stack instead.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/969725/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2024, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
