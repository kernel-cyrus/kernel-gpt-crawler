        <!DOCTYPE html>
        <html lang="en">
        <head><title>Kernel documentation update [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/705224/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/704819/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/705224/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Kernel documentation update</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>We're bad at marketing</b>
<p>
We can admit it, marketing is not our strong suit. Our strength is
writing the kind of articles that developers, administrators, and
free-software supporters depend on to know what is going on in the
Linux world. Please <a href="/Promo/nsn-bad/subscribe">subscribe today</a> to help us keep doing that, and so
we don’t have to get good at marketing.
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>November 2, 2016</br>
           <hr>
<a href="/Articles/KernelSummit2016/">2016 Kernel Summit</a>
</div>
<p>
The kernel's documentation "subsystem" has undergone some changes over the
past few releases as we <a href="/Articles/704613/">reported on</a> in late
October.  The author of that report and the kernel's documentation
maintainer, Jonathan Corbet, gave a presentation at this year's Kernel
Summit to describe some of those changes.  He was joined by  Mauro Carvalho
Chehab, who has done much of the work (along with Daniel Vetter,  Jani
Nikula, and Markus Heiser) to make it all happen.
</p>

<a href="/Articles/705305/">
<img src="https://static.lwn.net/images/2016/ks-corbet-sm.jpg" border=0 hspace=5 align="left"
alt="[Jonathan Corbet]" title="Jonathan Corbet" width=225 height=280>
</a>

<p>
Corbet started by noting the <a href="/Articles/696633/">4.8-rc1 release
announcement</a>, where Linus Torvalds highlighted that "<q>over 20% of
the patch is documentation updates, due to conversion of the drm and
media documentation from docbook to the Sphinx doc format</q>".   Those
changes were unusual in that documentation changes have never been anywhere
near that large in previous merge windows.
</p>

<p>
Corbet set out on the Sphinx transition with
several goals.  The first was to 
eliminate the hand-rolled DocBook-based toolchain that was being used to
generate the documentation.  At a Kernel Summit a few years ago, he asked
kernel developers 
how many had gotten the toolchain set up and less than half indicated that
they had.  In the end, it is simply "the wrong way to go"; the kernel
project should not be developing its own tools for creating documentation,
it should use something that is developed and maintained by others.
</p>

<p>
Another goal was to have integrated documentation with nice output
formatted in multiple ways.  But, he wanted to be able to do that without a
complicated markup language and a bunch of toolchain dependencies.  Beyond
that, he wanted to clean up the 
<tt>Documentation</tt> directory so that it "doesn't look like my
daughter's bedroom", he said, complete with a photo of said messy bedroom.  All of
that will make it easier for developers to write documentation, which
should, in theory, lead to better documentation.
</p>

<p>
So, starting in the 4.7 cycle, the documentation began being switched to
use the
<a href="http://www.sphinx-doc.org/en/1.4.8/">Sphinx documentation
generator</a>, which uses the <a
href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> markup
language.   There are, he said, LWN articles about the <a
href="/Articles/692704/">history of the change</a> and <a
href="/Articles/692705/">how it all works</a>.  In addition, the kernel
documentation now has a <a
href="https://www.kernel.org/doc/html/latest/kernel-documentation.html">Linux
Kernel Documentation book</a> that describes how to build (and write)
documentation for the kernel.
</p>

<h4>Open questions</h4>
<p>
There are, of course, some open questions.  The organization of the
documentation tree leaves a lot to be desired.  It used to have around 300
files in the top-level directory, but he has slowly been moving things
around.  One move that he has been nervous about is the
<tt>SubmittingPatches</tt> file, which is being incorporated into the <a
href="http://static.lwn.net/kerneldoc/process/index.html">development-process
book</a>.  Chehab has submitted a patch to move the file and leave a
three-line file pointing to the new location in its place, but Corbet is
worried about dangling references to the file.  He asked if there were
objections to making that move.
</p>

<p>
At that point, Torvalds said with a grin: "No one in this room has ever
read anything in the <tt>Documentation</tt> directory."  He said it was
really up to the users of the kernel and its documentation to decide if the
move made sense.  There were murmurs of disagreement in the room and Darren
Hart said: "I do use it, read it, and cite it by section."  He said that he
liked what had been done so far, especially that he could now cite sections
by URL.
</p>

<p>
That last piece is thanks to kernel.org maintainer Konstantin Ryabitsev, who built the
documentation from the tree and <a
href="https://www.kernel.org/doc/html/latest/index.html">put it up at
kernel.org</a>, Corbet said.  Furthermore, a look at mailing list postings
shows that the documentation is cited rather frequently.  "So they may not
read it, but they tell everyone else to read it", he said.  Based on the
reaction in the room, it
appears that no one is "too upset" with moving <tt>SubmittingPatches</tt>,
so he will leave that patch in for 4.10.  The goal is to eventually have a top-level
<tt>Documentation</tt> directory that looks like all of the others in the kernel tree.
</p>

<p>
Olof Johansson asked about having stub files pointing to the proper place,
as was done for <tt>SubmittingPatches</tt>.  Corbet replied that he has
done that for some of the more important files, but not for every one.  David
Howells also cautioned against moving <tt>memory-barriers.txt</tt>.  Corbet
said that when he had broached the subject with Paul McKenney, he was told
to "keep away", so he plans to work with McKenney on that down the road.
</p>

<p>
For something perhaps a bit more controversial, Corbet noted that there is
only one directory in the top-level kernel directory that is capitalized:
<tt>Documentation</tt>.  Since part of the reorganization will be
adding more subdirectories, thus lengthening the path names for files of
interest—in addition to an already-long top-level name—it has led some to ask
that he consider renaming the directory to <tt>doc</tt> .
</p>

<p>
That immediately led to discussion of tab-key-based auto-completion, as
well as bikeshedding over a new name.  But, as was also pointed out, those
names are often used in places (e.g. email) where auto-completion does not
work.  H. Peter Anvin noted that files like <tt>README</tt> are capitalized
in part to help newbies, who will often be attracted to those files because
their names stand out.  

<p>
After some more discussion, it was suggested that Corbet
call for a vote, which he did.  Roughly half of those assembled voted
against, while about the same voted for the change.  That made it obvious there was
"no clear consensus" on the question, so things would stay the way they
are.  Shuah Khan was glad to hear that; she voted against changing the name
because of the large number of blog posts and other types of information
that she and others have written that would suddenly become outdated.
</p>

<h4>Adding complications</h4>

<p>
Moving to another topic, Corbet said he had set out to get to something
simpler and the community had accomplished that, but now things have
started to get more complicated 
again.  A change that was made for 4.9 meant that LaTeX is required to
build the HTML version of the documentation.  He will be pushing to get
that particular problem fixed.  

<p>
There are number of files that some want to
pre-process to get them into the Sphinx format.  There was a request to add
a Sphinx directive that would run an arbitrary shell command as part of the
documentation build process, but he rejected that particular mechanism.  It
has also been suggested that the <tt>MAINTAINERS</tt> file be processed
into the Sphinx format.
</p>

<a href="/Articles/705305/">
<img src="https://static.lwn.net/images/2016/ks-chehab-sm.jpg" border=0 hspace=5 align="right"
alt="[Mauro Carvalho Chehab]" title="Mauro Carvalho Chehab" width=214 height=280>
</a>

<p>
Since the media subsystem is where some of the push for pre-processing is
coming from, he asked Chehab to explain what he would like to do there.
Chehab has a patch that takes the ABI files from the media subsystem to
convert them into the Sphinx format, which allows creating documentation
that is sorted and arranged in various ways.  That is useful for
distributions and others, he said; "it adds value" to the documentation.
</p>

<p>
For the <tt>MAINTAINERS</tt> file, it would be nice if interested users
could find out where they can get the latest development tree for a
subsystem, which could be added into the information already there.  It
makes it easier for users if it is part of the documentation and it "comes
almost for free", he said.
</p>

<p>
Corbet said that a decision will need to be made about how much more
complicated the documentation toolchain should be allowed to get.  Nikula
has suggested that any changes made for the kernel should be upstreamed
into Sphinx.  While that is a nice idea, Corbet said, some of the changes
are pretty kernel-specific so it may be hard to convince the Sphinx
developers to accept them.
</p>

<p>
Another area of disagreement is about what to do with old and obsolete
documentation, much of which has not even seen typo fixes in the Git era.
For example, some instructions from Larry McVoy in 1996 on how to manually
bisect a problem in the 1.3 kernel seem like they are past their prime.  We
don't keep old code around, Corbet said, so we should do the same with documentation.
</p>

<p>
Torvalds wryly noted that pull requests that remove lines from the kernel
get high priority.  But he had a different complaint as well: "Can we get
rid of PDF in the kernel source?"  It is, he said, "binary crap" and those files are
simply PDF versions of the SVG files sitting right next to them.
</p>

<p>
Chehab said that the media subsystem needed some PDF files for the DocBook
version of its documentation.  Those may not be needed for Sphinx, he
said.  There are roughly ten PDF files that showed up recently, Torvalds
said.   Those files are not editable and have no reason to be in the kernel source.
</p>

<p>
Image files are similar, Torvalds said after a question from Corbet.  A
binary file that no one can edit should not be in the tree, Torvalds said.
He suggested putting them on a web site, but that there is a reason the
kernel tree is called a <i>source</i> tree.   It was agreed that solutions
could be found to have images with the documentation without requiring binary
images in the kernel tree.
</p>

<p>
Rafael Wysocki asked that Corbet consult with him before moving any files
in the power management part of the documentation tree.  That is standard
operating procedure, Corbet said.  He will let the appropriate maintainer
know what he is planning to do and won't do it over the objection of that maintainer.
</p>

<p>
Another request came from Hannes Reinecke, who would like to see the return
values of kernel functions get added into the documentation.  Right now,
some free-form text could be added to the kerneldoc comments associated
with the function, Corbet said, and something more structured could be worked
out later.  But, in order to get a full list of the return values, the
entire set of kernel functions needs to be annotated, David Woodhouse said,
so that return values from functions that are called can be
incorporated into the list.  But it was suggested that even just annotating the
leaf functions (those that call no others) would be a good place to start.
At that point, things kind of wound down; Corbet and Chehab left the stage
in favor of Batman.
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Documentation">Documentation</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Kernel_Summit-2016">Kernel Summit/2016</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/705224/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor705461"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel documentation update</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 3, 2016 13:47 UTC (Thu)
                               by <b>jani</b> (subscriber, #74547)
                              [<a href="/Articles/705461/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Nikula has suggested that any changes made for the kernel should be upstreamed into Sphinx.</font><br>
<font class="QuotedText">&gt; While that is a nice idea, Corbet said, some of the changes are pretty kernel-specific so it may</font><br>
<font class="QuotedText">&gt; be hard to convince the Sphinx developers to accept them.</font><br>
<p>
Mostly I think we should make the Sphinx extensions we develop generic, generally usable outside the kernel, and contribute them to the sphinx contrib repo. Expose them to more users and developers, and hopefully offload the maintenance a bit. Having them merged as part of the Sphinx builtin extensions would indeed be very hard.<br>
<p>
To make the extensions generic, we should take a step back from the kernel specific POV. This is what I'm after. Look at the problem, figure out what the solution is that solves similar problems outside the kernel as a Sphinx extension, possibly adapting the kernel documentation to the generic problem, instead of writing ad hoc, completely kernel specific perl scripts and shelling out to them from Sphinx.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/705461/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor705597"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel documentation update</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 3, 2016 22:27 UTC (Thu)
                               by <b>gerdesj</b> (subscriber, #5446)
                              [<a href="/Articles/705597/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's funny how hard it is to get "Documentation" of any sophistication to actually work for everyone involved.  Something like this:<br>
<p>
"At that point, Torvalds said with a grin: "No one in this room has ever read anything in the Documentation directory." He said it was really up to the users of the kernel and its documentation to decide if the move made sense. There were murmurs of disagreement in the room and Darren Hart said: "I do use it, read it, and cite it by section." He said that he liked what had been done so far, especially that he could now cite sections by URL."<br>
<p>
... has been heard pretty much everywhere when "the docs" are mentioned in relation to anything from a little project through an entire multi-national organisation's operation and beyond.  People have been writing stuff down for millennia and yet a large bunch of some of the world's most intelligent and talented individuals who can mentally deal with hugely complex data structures and massive wodges of source code struggle to effectively document it or even agree on what it should look like.<br>
<p>
Could I humbly suggest that /usr/src/linux/Documentation simply contain a single file called README that contains a short note and a URL?  A fully tooled up Mediawiki with restricted write access and a decent cadre of moderators/maintainers can be a formidable documentation repository.<br>
<p>
Thankfully the head of docs is a journo, respected by all and able to put a word or two together, so there is hope that the cat herding will eventually lead to something really useful for everyone.<br>
<p>
Cheers<br>
Jon<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/705597/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2016, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
