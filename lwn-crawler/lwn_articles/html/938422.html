        <!DOCTYPE html>
        <html lang="en">
        <head><title>Much ado about SBAT [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/938422/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/938713/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/938422/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Much ado about SBAT</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Benefits for LWN subscribers</b>
<p>
The primary benefit from <a href="/Promo/nst-nag5/subscribe">subscribing to LWN</a>
       is helping to keep us publishing, but, beyond that, subscribers get
       immediate access to all site content and access to a number of extra
       site features.  Please sign up today!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>July 20, 2023</br>
           </div>
Sometimes, the shortest patches lead to the longest threads; for a case in
point, see <a
href="/ml/linux-kernel/20230711154449.1378385-1-eesposit@redhat.com/">this
three-line change</a> posted by Emanuele Giuseppe Esposito.  The purpose of
this change is to improve the security of locked-down systems by adding a
"revocation number" to the kernel image.  But, as the discussion revealed,
both the cost and the value of this feature are seen differently across the
kernel-development community.
<p>
The patch in question adds three lines to the kernel's x86 makefile, the
end result of which is to add a new ELF section to the kernel executable,
called "<tt>.sbat</tt>", containing these two lines of text:
<p>
<pre>
    sbat,1,SBAT Version,sbat,1,https://github.com/rhboot/shim/blob/main/SBAT.md
    linux,1,The Linux Developers,linux,$(KERNELVERSION),https://linux.org"
</pre>
<p>
Where <tt>$(KERNELVERSION)</tt> is replaced with the current kernel version
number.  The first line describes the section as conforming to
version&nbsp;1 of the <a
href="https://github.com/rhboot/shim/blob/main/SBAT.md">UEFI Secure Boot
Advanced Targeting (SBAT) specification</a>.  The second line is the one
that matters; it identifies the executable component as "<tt>linux</tt>",
with version number&nbsp;1 (also called the "generation number"); the rest
of the line is just documentation.
<p>
The purpose of the SBAT entry is to give the bootloader a way to know
whether the given executable is safe to run.  Since we are dealing with
secure boot, that executable should already be signed by a key known to the
system, but it is possible that a security vulnerability has been found in
that binary since it was signed.  To protect against that possibility, the
bootloader will contain a minimum acceptable generation number; if the
generation found in the SBAT section is below that number, the bootloader
will refuse to boot it.  Whenever a vulnerability that will lead to a
secure-boot compromise is fixed, the minimum generation will be
incremented, with the effect of immediately blocking the loading of any
vulnerable versions of the code.
<p>
The SBAT idea is not new; it has been supported by the GRUB bootloader
since the 2.06 release.  The developers of <a
href="https://0pointer.de/blog/brave-new-trusted-boot-world.html">the
unified kernel image concept</a> are implementing ways to load a kernel
directly, without using a separate bootloader; as a part of this work, they
want to add SBAT checks for the kernel image itself.  The addition of SBAT
version number to the build is a necessary part of this scheme.
<p>
The secure boot mechanism already contains ways to prevent the loading of
old, vulnerable images through explicit revocation.  There is just one
little problem: given the diversity of the software used in the Linux world
— and the large number of releases of each — the revocation lists quickly
grow larger than the low-level firmware implementing secure boot can
handle.  SBAT is an attempt to overcome that problem by creating a single
number that can be used to determine whether a given image is safe to boot. 
<p>
<h4>Generation-number management</h4>
<p>
Much of the above was not really explained in the patch posting, which led
to a number of questions on the list.  Other signs of inattention (the
inclusion of a linux.org URL, for example) also raised red flags.  It is
fair to say that this idea did not get the reception that its backers were
hoping for.
<p>
At its core, the disagreement was over the management of that version
number: how often would it change, and who would be responsible for
deciding when it should be changed?  Greg Kroah-Hartman <a
href="/ml/linux-kernel/2023071229-dusk-repacking-da3a@gregkh/">suggested</a>
that the kernel's version number, which is already included in the image,
could be used instead, but Luca Boccassi <a
href="/ml/linux-kernel/CAMw=ZnSmZTBs+bJsQ_Y2CVO8K3OTuHOZDKW4cbxKpGbo4Vgs7Q@mail.gmail.com/">replied</a>
that the version number would not work, since there are too many of them
for the system to track.  In other words, kernel-version numbers present
the same problem that revocation lists do — the problem that SBAT was
developed to work around.
<p>
Kroah-Hartman later <a
href="/ml/linux-kernel/2023071233-empirical-overturn-744c@gregkh/">asked</a>
a number of questions about how the decision to update the generation
number would be made, who would make it, who would change the number in the
kernel, and so on.  He suggested looking at past kernel history to come up
with an idea of how many times that number would have changed over time.
Boccassi's <a
href="/ml/linux-kernel/CAMw=ZnRRviBNi_LK9VOSUV9PNHe3jurUcLfgLpbTOsp_eE4WyA@mail.gmail.com/">answers</a>
were not seen as entirely satisfactory; he said that the decision would be
made by: "<q>most likely those who understand the problem space</q>".  He
suggested that the kernel project makes "<q>3 releases a year</q>", and
that generation-number changes would be no more frequent than that.
Kroah-Hartman <a
href="/ml/linux-kernel/2023071350-specked-botanist-6ba8@gregkh/">replied</a>
that he does "<q>a release or two a week across multiple stable kernel
versions</q>", rather more than three per year, and repeated his process
questions.
<p>
Boccassi called the stable releases "<q>irrelevant for the case at
hand</q>" and said that the process questions didn't matter: "<q>the
question here was about mechanism and storage. And it already works btw,
it's just the kernel that's lagging behind, as usual</q>".  Kroah-Hartman
<a href="/ml/linux-kernel/2023071552-quilt-tranquil-b7bf@gregkh/">was not
moved</a>:
<p>
<blockquote class="bq">
	To think that "let's add a security canary to the kernel image" is
	anything other than a process issue shows a lack of understanding
	about exactly how the kernel is released, how the existing kernel
	security response team works, and who does any of this work.  To
	ignore that means that there is no way in the world this can ever
	be accepted.
</blockquote>
<p>
Daniel P. Berrangé did <a
href="/ml/linux-kernel/ZLUIViihakhyPV1N@redhat.com/">make an attempt</a> to
address the process-related questions, saying that generation-number
increments would be tied to CVE numbers and would likely be infrequent.  He
also acknowledged that there are some open questions with regard to how
backports to the stable releases would be handled. Kroah-Hartman <a
href="/ml/linux-kernel/2023071723-paging-despite-7094@gregkh/">responded</a>
that most security-relevant kernel bugs are never assigned CVE numbers, and
that he knows of many example of bugs that could be used to break secure
boot.  He also admonished: "<q>as the person running the stable releases,
you BETTER be working with me to try to figure this all out</q>".
<p>
One might not think that the management of a simple number would be so
hard.  But the question of when it should be incremented is not trivial.
As Kroah-Hartman and others pointed out, the kernel project is fixing bugs
that may have security implications almost every day.  Nobody knows how
often exactly, because monitoring the patch stream for possible security
issues is a task that nobody has the resources to keep up with for any
extended period of time.  It is probably safe to say, though, that almost
every mainline kernel release has at least one fix for a bug that could be
used to attack secure boot.  So perhaps the generation number would simply
need to increment for each release.
<p>
There is a worse problem, though, in that almost nobody runs mainline
releases; instead, most users are running kernels derived from the stable
updates.  It is far from clear how the mainline generation-number updates
should be backported to the stable releases, which happen much more
frequently than mainline releases.  Each stable release may have a subset
of the fixes that were identified as needing generation-number increments
in the mainline; how should the generation number be calculated in such
cases?  If a given fix is not applicable to a specific kernel release,
should that number be incremented anyway — thus causing older binaries to
fail to boot, even though they lack the vulnerability in question?
<p>
<h4>Letting distributors do it</h4>
<p>
For these reasons and more, it was occasionally suggested that, if such a
generation number is to be a part of a kernel build, it should be created
and managed by the distributors who are building the kernels.  As Ard
Biesheuvel <a href="/ml/linux-kernel/ZK%2F9MlTh435FP5Ji@gambale.home/">put
it</a>:
<p>
<blockquote class="bq">
	Therefore, I don't think it makes sense for the upstream kernel
	source to carry a revocation index. It is ultimately up to the
	owner of the signing key to decide which value gets signed along
	with the image, and this is fundamentally part of the
	configure/build/release workflow.  No distro builds and signs the
	upstream sources unmodified, so each signed release is a fork
	anyway, making an upstream revocation index almost meaningless.
</blockquote>
<p>
Boccassi's <a
href="/ml/linux-kernel/CAMw=ZnRQ0qNg0hT27DWvfZ1DH3dLdu0U7zYN8HvJDx7NPVy_pQ@mail.gmail.com/">reply</a>,
after describing the linux-kernel list as "<q>an open sewer</q>", dismissed
this idea as unworkable:
<p>
<blockquote class="bq">
	The 'owner of the signing key' is not good enough, because there
	are many of those - as you know, the kernel is signed by each
	distro. But the key here is that the revocation is _global_ (again:
	global means it applies to everyone using shim signed by 3rd party
	CA), so each distro storing their own id defeats the purpose of
	that.
</blockquote>
<p>
If this global number is not stored in the mainline kernel source, he said,
somebody would have to maintain an external registry to somehow map
generation numbers to points in the kernel's development history.
<p>
Paolo Bonzini, though, <a
href="/ml/linux-kernel/df7941b9-11ea-9abd-e070-4e9926aecdc3@redhat.com/">thought</a>
that even a distributor-managed generation number is unworkable: "<q>I'm
quite positive that a revocation index attached to the kernel image cannot
really work as a concept, not even if it is managed by the distro</q>".
That led to <a
href="/ml/linux-kernel/CAMw=ZnTSyeL4x1o_GVKNsZdCUe2D2H53quK-TSFhOkuONjC73A@mail.gmail.com/">another
missive</a> from Boccassi stating that the mechanism has been shown to work
elsewhere, and that "<q>the kernel is not special in any way</q>":
<p>
<blockquote class="bq">
	 The only thing that matters is if, given a bug, somebody either
	 observed it being used as a secure boot bypass by bad actors in
	 the wild, or was bothered enough to write down a self-contained,
	 real and fully working proof of concept for secure boot bypass. If
	 yes, then somebody will send the one-liner to bump the generation
	 id, and a new sbat policy will be deployed. If no, then most
	 likely nobody will care, and that's fine, and I expect that's what
	 will happen most of the time.
</blockquote>
<p>
It is not clear that this approach will satisfy the developers who see the
whole mechanism as a sort of security theater.
<p>
As of this writing, the discussion appears to be at an impasse, with little
mutual understanding between the participants.  The proponents of the SBAT
mechanism see a way of addressing their revocation problems that only needs
an occasional one-line kernel patch to maintain.  Longtime kernel
developers, though, see a raft of unresolved process issues and strongly
doubt that a single integer value can describe the security status of the
huge variety of kernels in the wild.  The kernel is more complicated that
that, as is the security environment it operates in; any sort of global
revocation mechanism may have to be as well.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-UEFI_secure_boot">Security/UEFI secure boot</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/938422/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor938748"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 15:44 UTC (Thu)
                               by <b>rwmj</b> (subscriber, #5474)
                              [<a href="/Articles/938748/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <p>I just want to emphasize that Emanuele (who works on my team) clearly signposted this as an RFC, both in the heading and in the first paragraph, where he wrote:</p>

<p><q><i>
*Important*: this is just an RFC, as I am not expert in this area and
I don't know what's the best way to achieve this.</i></q></p>

<p>
So I don't think he deserved the disparaging comments that he got in that thread.
</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/938748/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938756"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 16:29 UTC (Thu)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938756/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Indeed, the behavior of certain kernel maintainers, who ought to know better, was simply appalling and uncalled for.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938756/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938796"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 21:34 UTC (Thu)
                               by <b>Paf</b> (subscriber, #91811)
                              [<a href="/Articles/938796/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This wasn't even half baked, and the article quotes several messages where those proposing it basically say "it's fine, why do you care?".  They care because as proposed it's obviously just going to become security theatre.  The proposal entirely ignores *the hard parts* of having a validation/invalidation/vulnerability number like this, the things that would have to be done *to make this actually matter rather than be a checkbox feature*.  Showing up and getting mad that people care about that ... well, yeah.  Dunno what else to say.<br>
<p>
The patch as is absolutely trivial.  And absolutely without value.  The process is what would make this useful as something more than words.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938796/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938804"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 23:50 UTC (Thu)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938804/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; This wasn't even half baked</span><br>
<p>
And that's why it was titled as 'RFC' and start with: "*Important*: this is just an RFC, as I am not expert in this area and<br>
I don't know what's the best way to achieve this."<br>
<p>
<span class="QuotedText">&gt; They care because as proposed it's obviously just going to become security theatre.</span><br>
<p>
If you think secure boot is 'security theatre' you can do that, you have every right to be wrong at your own expenses. However, this doesn't affect you nor anybody else who doesn't care about the use case, as it's just one line in a makefile that somebody else will look after.<br>
<p>
<span class="QuotedText">&gt; The proposal entirely ignores *the hard parts* of having a validation/invalidation/vulnerability number like this, the things that would have to be done *to make this actually matter rather than be a checkbox feature*. Showing up and getting mad that people care about that ... well, yeah. Dunno what else to say.</span><br>
<p>
Except of course the 'proposal' already exists and functions for other boot components, along with a process to manage it, and it evidently works, so the other thing to say would have been "maybe I should do the bare minimum research and inform myself before commenting on things I do not know"<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938804/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938806"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Please.</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 0:30 UTC (Fri)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/938806/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Please stop here; surely you can find a way to make your points without engaging in personal attacks against the people who disagree with you?
<p>
Or, to put it another way: if you truly dislike the "open sewer" of the linux-kernel mailing list (to use your words), please refrain from peeing in the LWN comment stream.



      
          <div class="CommentReplyButton">
            <form action="/Articles/938806/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor938918"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 20:37 UTC (Fri)
                               by <b>rgmoore</b> (<b>&#x272D; supporter &#x272D;</b>, #75)
                              [<a href="/Articles/938918/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>And that's why it was titled as 'RFC' and start with: "*Important*: this is just an RFC, as I am not expert in this area and
I don't know what's the best way to achieve this."</blockquote>

<p>Sure, but remember what RFC stands for: request for comments.  If someone starts out by admitting they're not an expert and asks for help in achieving their goals, it behooves them to listen to the people who are experts when they point out problems with the proposal.  That doesn't seem to be what happened here.  Instead, the people asking for opinions on their proposal decided to argue with the experts whose opinions they had solicited.


      
          <div class="CommentReplyButton">
            <form action="/Articles/938918/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938967"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 10:37 UTC (Sat)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938967/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Replying to a thread after a moderator has said "stop here" is not really good practice<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938967/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor939242"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2023 22:00 UTC (Tue)
                               by <b>SLi</b> (subscriber, #53131)
                              [<a href="/Articles/939242/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I read that comment as saying it to you, not to everyone. And perhaps also as saying it only about you communicating in a certain way.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939242/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor938776"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 18:09 UTC (Thu)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/938776/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why didn't you review it internally before sending out a poor quality RFC?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938776/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938782"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 18:56 UTC (Thu)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938782/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There was nothing 'poor quality' about it<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938782/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938784"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 18:59 UTC (Thu)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/938784/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Given that both Vitaly and Emmanuel have described it as such, you should probably stop defending it as not-such.<br>
<p>
eg <a href="https://lwn.net/ml/linux-kernel/87wmz33j36.fsf@redhat.com/">https://lwn.net/ml/linux-kernel/87wmz33j36.fsf@redhat.com/</a><br>
<p>
Annoying the people who have to apply your patch is not a good start.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938784/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938788"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 19:16 UTC (Thu)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938788/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There is no such description in the mail you quoted. The reality is that the lkml once again lived up to its standards of being an open sewer. There are people there who are lost causes, but there are also those who ought to know better.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938788/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938790"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 19:33 UTC (Thu)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/938790/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Once again you critique the mote in their brother's eye without noticing the beam in your own.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938790/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor939520"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2023 15:22 UTC (Fri)
                               by <b>jschrod</b> (subscriber, #1646)
                              [<a href="/Articles/939520/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Then, please stop using the same kind of communication here. Your tone is unwanted.<br>
<p>
It doesn't help soliciting favorable sympathies either.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939520/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor938789"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 19:39 UTC (Thu)
                               by <b>Lionel_Debroux</b> (subscriber, #30014)
                              [<a href="/Articles/938789/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
FWIW, I did not feel annoyed by the explicit "(This is not yet ready)" which starts the first message of <a href="https://github.com/memtest86plus/memtest86plus/pull/34">https://github.com/memtest86plus/memtest86plus/pull/34</a> , and it looks pretty clear that the other maintainers weren't either.<br>
<p>
Yes, I'm aware that memtest86+ isn't a general-purpose OS, and that as such, SB bypasses should be very few and very far between, and therefore, SBAT update handling - if ever needed - shall be a non-issue. The Linux kernel is in a different situation, I fully understand it.<br>
However... there is significant contrast between the way this memtest86+ PR went, and the way this LKML thread (which I did not read entirely) went. Enough that one could argue that there may have been a nicer way to handle the situation on LKML, perhaps ?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938789/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor938823"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 6:07 UTC (Fri)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/938823/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
To be honest it's much more annoying when you get poor quality patches with three internal Reviewed-by.<br>
<p>
I don't think the disconnect between the kernel developers and the proposers of the SBAT mechanism could have been bridged by internal discussions.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938823/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor939577"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2023 1:06 UTC (Sat)
                               by <b>milesrout</b> (subscriber, #126894)
                              [<a href="/Articles/939577/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I am not going to spend the time to read through the thread. But it is clear even from the small snippets quoted in the article that he approached the issue with a very bad attitude. <br>
<p>
<span class="QuotedText">&gt;Boccassi called the stable releases ""irrelevant for the case at hand"" and said that the process questions didn't matter: ""the question here was about mechanism and storage. And it already works btw, it's just the kernel that's lagging behind, as usual"". </span><br>
<p>
<span class="QuotedText">&gt;Boccassi's answers were not seen as entirely satisfactory; he said that the decision would be made by: ""most likely those who understand the problem space"".</span><br>
<p>
You can't openly display a dismissive and rude attitude to a project and expect to be received with smiles and praises.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939577/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor939703"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 31, 2023 7:16 UTC (Mon)
                               by <b>idrys</b> (subscriber, #4347)
                              [<a href="/Articles/939703/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Please note that you're mixing up two different people here: Emmanuele, who sent the initial RFC, and Luca, whom you're quoting here. The comments from the latter do not imply anything about the attitude of the former...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939703/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor938750"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How does SBAT get updated?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 15:59 UTC (Thu)
                               by <b>nickodell</b> (subscriber, #125165)
                              [<a href="/Articles/938750/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How does the list of revoked versions get updated? To clarify, I'm not asking a process question here. When a vendor decides to revoke e.g. version 10, how does that get sent out to each devices revocation database? Presumably it can't be a part of the signed image itself, because the old versions of each signed image won't have the new revocations. Is it a trust-on-first-use approach?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938750/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938753"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How does SBAT get updated?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 16:12 UTC (Thu)
                               by <b>danpb</b> (subscriber, #4831)
                              [<a href="/Articles/938753/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
According to the walkthrough example in:<br>
<p>
  <a href="https://github.com/rhboot/shim/blob/main/SBAT.example.md">https://github.com/rhboot/shim/blob/main/SBAT.example.md</a><br>
<p>
the UEFI CA has responsibility of updating the global SBAT revokation list used for policy enforcement. The SBAT mechanism is intended as a way to replace the current global DBX revokation list (which contains hashes or certs), and updates of DBX are issued from the UEFI CA. The DBX updates can get onto actual machines in a variety of ways - either when the UEFI firmware update is delivered, or separately via fwupd simply updating the DBX data on its own. Conceptually SBAT would be delivered the same way in the long term.<br>
<p>
So while it isn't stated explicitly, but my interpretation is that the vendors update the SBAT record in their signed binaries as needed, and inform the UEFI CA of the issues fixed, and the UEFI CA can then periodically decide to issue updated SBAT revokation list.   AFAICT though, none of this has actually happened in practice yet. I see Fedora grub EFI binaries getting updated SBAT, but not sign of revokations of the old versions, though its possible I'm just not looking hard enough.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938753/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938827"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How does SBAT get updated?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 7:39 UTC (Fri)
                               by <b>juliank</b> (guest, #45896)
                              [<a href="/Articles/938827/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Revocations are hard-coded in the shim, there isn't a mechanism to distribute SBAT revocations out-of-band yet, which is very much in progress. There are two levels of revocations, latest and previous (which probably should be renamed policy, default or something). The default revocations revoke components two levels behind basically, such that if the new boot loader fails, you can still recover with the old one (then after you verified it works, you can `mokutil --set-sbat-policy latest` to force the latest SBAT.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938827/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938838"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How does SBAT get updated?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 8:58 UTC (Fri)
                               by <b>james</b> (subscriber, #1325)
                              [<a href="/Articles/938838/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      Is there a process to prevent roll-back of the shim?


      
          <div class="CommentReplyButton">
            <form action="/Articles/938838/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938840"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How does SBAT get updated?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 9:09 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938840/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
DBX - and yes the UEFI spec should support all of this natively, but that moves at glacier speed<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938840/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor939459"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How does SBAT get updated?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2023 3:54 UTC (Fri)
                               by <b>jacmet</b> (subscriber, #19734)
                              [<a href="/Articles/939459/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So does this mean that an effective SBAT update requires:<br>
<p>
1: bugfix in kernel and new release with incremented SBAT number<br>
2: updated distribution kernel release based on that with updated SBAT number<br>
3: updated SBAT rollback info in shim and new shim release<br>
4: updated shim distribution binary signed by Microsoft<br>
5: updates installed on end machines<br>
<p>
That seems like a fairly heavy/slow process to me.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939459/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor939460"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How does SBAT get updated?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2023 3:58 UTC (Fri)
                               by <b>jacmet</b> (subscriber, #19734)
                              [<a href="/Articles/939460/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Plus the DBX update to blacklist the old shim. This presumably means there will be a lot of shim updates, doesn't that lead to the same DBX capacity problems as blacklisting the kernels directly?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939460/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor939470"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How does SBAT get updated?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2023 8:24 UTC (Fri)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/939470/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The number of signed shims is *way* lower than the number of kernels, but it's also viable for sbat updates to be delivered out of band and for shim to pay attention to those (eg, just store the SBAT in a boot services-only variable, provide a MOK method for an authenticated physically present user to delete them in order to restore to factory state and permit rollback, have the components in the boot chain compare the next component against whatever's present, have updates to that gated through shim and ensure that they're only moving things forward and (if desired) are signed by the distro who owns that shim)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939470/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor939529"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How does SBAT get updated?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2023 16:59 UTC (Fri)
                               by <b>wtarreau</b> (subscriber, #51152)
                              [<a href="/Articles/939529/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
plus adding to that that sometimes complex fixes for such issues will not flow as fast into older kernels, you will end up with an unclear period where you need to support older branches with their older unfixed version and newer ones as well. That's where it derived into "maybe we could have one number per branch" and then this becomes even more complicated.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939529/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor938755"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 16:25 UTC (Thu)
                               by <b>gray_-_wolf</b> (subscriber, #131074)
                              [<a href="/Articles/938755/">Link</a>] (29 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One thing (well, out of many, but it is the one I want to ask about) is how does the single number in the upstream kernel (let's pretend stables are not a thing now) play together with distributions doing their own builds with their own set of configurations.  Would for example debian kernel, that does have some CONFIG_FOO=n be invalidated and unbootable if upstream kernel increased the SBAT number due to vulnerability only present when CONFIG_FOO=y?  My understanding (based on skimming the thread) is yes, is it that correct assertion?  Since it does not seem to make much sense.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938755/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938757"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 16:30 UTC (Thu)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938757/">Link</a>] (28 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is explicitly covered in the protocol and described in the example:<br>
<p>
<a href="https://github.com/rhboot/shim/blob/main/SBAT.example.md">https://github.com/rhboot/shim/blob/main/SBAT.example.md</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938757/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938760"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 16:49 UTC (Thu)
                               by <b>gray_-_wolf</b> (subscriber, #131074)
                              [<a href="/Articles/938760/">Link</a>] (27 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So if I get it right, fedora would produce kernels with something like:<br>
<p>
sbat,1<br>
linux,1<br>
linux.fedora,1<br>
<p>
And if there is problem with CONFIG_FOO=y, linux wound bump the number to 2, so fedora would produce<br>
<p>
sbat,1<br>
linux,2<br>
linux.fedora,2<br>
<p>
While debian<br>
<p>
sbat,1<br>
linux,2<br>
linux.debian,1<br>
<p>
And `the UEFI CA issues an update to SBAT` would be:<br>
<p>
sbat,1<br>
linux,2<br>
linux.debian,1<br>
linux.fedora,2<br>
<p>
Is that correct?  That seems like it will be... fun to keep up to date, I guess?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938760/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938762"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 16:58 UTC (Thu)
                               by <b>WolfWings</b> (subscriber, #56790)
                              [<a href="/Articles/938762/">Link</a>] (20 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
linux.fedora wouldn't update their number unless they made changes to their patches or configuration settings.<br>
<p>
If linux.fedora's changes were the cause of a vulnerability, then linux.fedora's number would increment entirely independently of linux in your example case.<br>
<p>
When you carry forward upstreams SBAT lines you can benefit from their generation epochs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938762/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938801"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 23:01 UTC (Thu)
                               by <b>cquike</b> (subscriber, #107549)
                              [<a href="/Articles/938801/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What happens if the distribution option CONFIG_FOO=n actually "disables" the vulnerability? The distribution kernel in that case is not affected but still the SBAT data in the firmware would say that that linux,1, for instance, is vulnerable and the system will not boot, which IMHO is the wrong behaviour.<br>
Is that understanding correct? <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938801/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938805"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 23:52 UTC (Thu)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938805/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sure, there's a number of hypothetical corner cases that one might imagine where a revocation that doesn't affect everybody might go out. Likelihood is low enough that it's not really worth worrying about. There are more important aspects to optimize for.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938805/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938848"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 10:19 UTC (Fri)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/938848/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That there is a security hole in some experimental or niche code not included in most distros' kernels seems a nigh certainty, not hypothetical.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938848/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938903"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 15:39 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938903/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If it's certain, can you point to any occasion where any of that has been used to exploit a system?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938903/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938925"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 20:45 UTC (Fri)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/938925/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Eleven days ago, CVE-2023-32250 and CVE-2023-32254 were issued on bugs in the Linux kernel's ksmbd, an in-kernel SMB server. At the end of June, CVE-2023-3338 was issued on a bug in the DECNet implementation. Actively exploited, I don't know, but I'm sure there are.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938925/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938929"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 20:53 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938929/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How are those related to UEFI?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938929/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938931"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 21:23 UTC (Fri)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/938931/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you're able to trigger them locally you could overwrite kernel state and kexec into a backdoored kernel (or even Windows) without violating any secure boot controls.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938931/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938964"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 9:00 UTC (Sat)
                               by <b>WolfWings</b> (subscriber, #56790)
                              [<a href="/Articles/938964/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I feel like that's a core disconnect here honestly.<br>
<p>
The RFC was expecting that "once you hit /init it's no longer relevant" which would indeed exclude the supermajority of CVEs from ever increment the counter.<br>
<p>
But the reality is this: Secure Boot carries forward long past the boot phase into userspace, and if that has a vulnerability that allows sufficient escalation then to the user it is functionally identical to any other secure boot compromise:<br>
<p>
Suddenly the OS isn't the one you signed keys and did all the security hoopla for.<br>
<p>
Which yes, means that the SBAT scope for "the ENTIRE kernel" includes parts WAY outside of the "boot" portion of things. It also ends up including everything callable from userspace including second-tier stuff like NFS that requires networking and filesystems first, etc.<br>
<p>
Maybe a more narrowly defined initial record for 'linux-pre-init' as a component name or something instead that's just the UEFI-stub-to-/init codepath fits what the initial submission expected for a rarely-changing codepath.<br>
<p>
But the full 'linux' meta-component would have to update it's counter rather frequently so X-1 fallback would be woefully insufficient and result in 'functionally bricked' systems for various degrees of brickage.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938964/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938968"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 10:39 UTC (Sat)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938968/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There is already such a boundary, and it's what we are largely focusing on right now: ExitBootServices. It provides a clear boundary, and what comes before is clearly and unequivocably 'high value', so in my view it's a great starting point for this.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938968/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor939347"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2023 4:37 UTC (Thu)
                               by <b>WolfWings</b> (subscriber, #56790)
                              [<a href="/Articles/939347/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And reading the threads on LKML I think that was the disconnect at the time of this article at least.<br>
<p>
Took me a'while to realize that, the kernel devs were largely approaching it as "Okay, it's named linux, so you mean the whole kernel then?" thus my suggestion to make it more clearly just the early-boot region that the epoch is covering with a more verbose and narrowly defined name. I think it was causing cognitive overload at times in attempting to use the shortest possible component name.<br>
<p>
Coming back with "Any security flaw in the codepath from initial execution up until UEFI ExitBootServices is called" possibly with the modifier "...that allows unsigned code to be executed." as a recurring phrase for "What increments the epoch?" instead of variants on "Whatever those in charge decide." might have had a better cooling effect, and kept the scope much more narrowly defined. Requiring it to only be of concern for signed code would also mean for example unsigned-module mode might be entirely out of scope, etc.<br>
<p>
But this is my years of dealing with PCI-DSS/HIPPA/etc compliance audits coming to the fore: Defining the scope as narrowly as possible is a huge part of passing security audits in the real world, and that seems to apply to keeping the epoch number from skyrocketing and becoming real-world-worthless.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939347/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor939025"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 24, 2023 8:41 UTC (Mon)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/939025/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you can trigger a bug relatively reliably during or after boot - be it by network, by crafted filesystem exploit, by some startup script, etc. - you get control. It doesn't matter how much you've locked down the firmware.<br>
<p>
I'm pretty sure we've had some articles recently containing discussions about the impossibility of securing filesystems from bugs and exploits, and the need to restrict which user-provided FSes the kernel will mount...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939025/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor938944"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 0:36 UTC (Sat)
                               by <b>geofft</b> (subscriber, #59789)
                              [<a href="/Articles/938944/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think for the most part people aren't interested in building exploits for these because Secure Boot attacks are pretty low value - especially because, at least as of last time I checked, there's a signed Ubuntu shim/GRUB which is happy to load arbitrary kernels. (I actually have a laptop running an old version of Debian with Ubuntu's signed shim/GRUB...) But it would be pretty easy to automate the process of turning root -&gt; ring 0 escalations (which are much more common than non-root -&gt; ring 0 escalations!) into bypasses of kernel_lockdown(7), if that would be interesting to anyone.<br>
<p>
Specifically - I think this conversation would be more productive if you could define what exactly counts as an exploit that SBAT should protect against / that would merit bumping the SBAT generation number. My understanding of Secure Boot is there are two ways to think about this:<br>
<p>
1) An attacker should not be able to produce a bootable system image using other people's signed kernels/bootloaders/shims/etc. that gets them arbitrary code execution in ring 0 before ExitBootServices() has been called.<br>
<p>
2) An attacker should not be able to produce a bootable system image using other people's signed kernels/bootloaders/shims/etc. that gets them arbitrary code execution in ring 0 at any time.<br>
<p>
The second one is what kernel_lockdown(7) is meant to protect against. But that's a more stringent policy than I think is really possible to achieve at least in the MS UEFI ecosystem. As mentioned, there are the Ubuntu shim/GRUB binaries, and also Windows itself hasn't been treating root -&gt; ring 0 as a security issue (see e.g. <a href="http://www.github.com/ionescu007/r0ak">http://www.github.com/ionescu007/r0ak</a> which is a worked example of a driver allowing kernel read/write).<br>
<p>
If the second definition is what you're actually trying to solve (and I might be out of date here and maybe the Ubuntu shims are now revoked?), it would be worth clearly documenting that, and then people can start producing those exploits. The ksmbd vulnerability mentioned in a sibling comment could quite easily be weaponized. But also a whole lot of other things that have the benefit of starting from a privileged position, like root in the initramfs, are interesting too.<br>
<p>
If you're going for the first definition, I think it's worth documenting that too, because there's relatively code that runs before ExitBootServices() - there is some attacker-controlled stuff (command line parsing, initrd loading but not mounting), so an exploit isn't out of the question, but there's very little of it. And that might help the kernel folks get more comfortable with the idea of maintaining a generation number.<br>
<p>
Or maybe you're going for some other definition which is not obvious to someone who does pay attention to Secure Boot, which means it'll be even less obvious to the average LKML reviewer.<br>
<p>
(Or maybe the practical threat model here is that you want to make sure that attackers can't run code even in ring 3 as root, which means you can't trust the MS UEFI ecosystem and you have to sign all your own kernels/UKIs with your own key that you enroll yourself in DB and KEK... at which point you want to maintain the SBAT generation on your own and not trust anyone else to do it!)<br>
<p>
To be clear - I am absolutely on board with criticizing the LKML crowd's refusal acknowledge what sort of bugs are security bugs and treatment of e.g. adding support for a new PlayStation controller's buttons as an "All users must upgrade." stable release that datacenter sysadmins need to care about just as much as they care about remote code execution in kernelspace. But I think that not clearly defining the security goals of SBAT / Secure Boot and saying you're only interested in vulnerabilities with known exploits risks making essentially the same mistake. It's silly to say that a vulnerability with a PoC that gets arbitrary code execution doesn't matter to you because nobody has constructed an exploit against your particular use case: they clearly could, and the only people who benefit from the obscurity are black hat attackers. A bug doesn't become unexploitable by refusing to mention the CVE in the commit message; neither does a bug become unexploitable by pointing out that there are no public exploits.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938944/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor938830"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 7:43 UTC (Fri)
                               by <b>juliank</b> (guest, #45896)
                              [<a href="/Articles/938830/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Notably even if a vendor was bumped before, the bump of the generic linux entry would cause the per-vendor revocations to go away as they become obsolete. Hence why it's not an ever growing list and works a lot better than dbx.<br>
<p>
so if you had revocations<br>
<p>
linux.fedora,2<br>
linux.debian,2<br>
<p>
and linux,1 was the latest SBAT<br>
<p>
linux gets an update, we drop the linux.&lt;anything&gt; and only insert the linux one:<br>
<p>
linux,2<br>
<p>
Then fedora gets another issue and we have<br>
<p>
linux,2<br>
linux.fedora,3<br>
<p>
Then linux gets another issue and we have<br>
<p>
linux,3<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938830/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938847"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 10:13 UTC (Fri)
                               by <b>gray_-_wolf</b> (subscriber, #131074)
                              [<a href="/Articles/938847/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What if fedora decides to fix a bug A as 3 while linux bug B as the same 3?  They might very well do it by accident.  How is this going to be prevented?  Or, how (if ever) will the numbers be reconciled (there are many distributions, so I assume it will happen sooner or later)?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938847/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938851"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 10:36 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938851/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That's why revocations are centralized, and managing generation IDs also needs to be centralized, rather than have everyone do it on their own<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938851/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938860"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 13:11 UTC (Fri)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/938860/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How exactly would centralisation solve the problem presented by gray_-_wolf?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938860/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938905"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 15:39 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938905/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Because everybody will know what the upstream product gen ID is<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938905/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938979"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 16:32 UTC (Sat)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/938979/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ok, so let's assume everybody is at gen 42. Now, two new vulnerabilities gets published, CVE-2025-001 and CVE-2025-002.<br>
Fedora backports the fix for 001 in their kernel. Arch backports fix for 002. They need to get new generation ID for their patched kernels, so they ask central authority.<br>
<p>
What gen numbers they will get in answer?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938979/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938980"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 16:53 UTC (Sat)
                               by <b>excors</b> (subscriber, #95769)
                              [<a href="/Articles/938980/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That sounds easy: the central authority decides on a total order for vulnerabilities. If they pick 001&lt;002, then they say you can sign as gen 43 if you're not vulnerable to 001, and you can sign as gen 44 if you're vulnerable to neither 001 nor 002. Arch will need to fix 001 (or determine they were never vulnerable to it, e.g. if it was a Fedora-specific issue) so they can sign as a new generation, before gen 42 gets revoked.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938980/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor940426"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 4, 2023 8:43 UTC (Fri)
                               by <b>ghane</b> (guest, #1805)
                              [<a href="/Articles/940426/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
My understanding is that Google does this, releasing two checkpoints every month for certified Android.<br>
<p>
Assume there are two sets of exploits, set A (which Google feels Handset OEMs can fix by themselves quickly) and set B (which need blobs from Qualcomm, etc).  These are called (eg) 01 July 2023 and 05 July 2023 (the 1 and 5 are constant).<br>
<p>
If you fix set A, you roll out the update, and claim "1 July 2023".  You then have time to talk to upstream chip manufacturors, and at some time roll out "5 July 2023".  <br>
<p>
You cannot claim 1 Aug 2023, (or any future version) however, till 5 July 2023 has been included.  <br>
<p>
So from a user (and app developer) point of view, any "1" date means you are no more than 1 month behind that month, and a "5" means that you are current till that month.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/940426/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor938810"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 1:13 UTC (Fri)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/938810/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It is entirely possible that Linus or somebody else explicitly decides that this is out of scope for Linux (which, after all, is "just" a kernel, not a full OS) and then we *only* have linux.fedora, linux.debian, etc. Each distro would then be responsible for bumping the number as applicable, regardless of whose "fault" the vulnerability is. They are already in a position to do that anyway, since most of them already track kernel vulnerabilities in order to provide timely security updates.<br>
<p>
(I have no idea if the standard allows that, but if the standard is unwilling or unable to accommodate Linux, then any standard-conforming hardware will become effectively unsalable to datacenters and Android manufacturers, so I imagine they would find a way to make it work if it currently does not. Worst case, we would just have linux,1 forever and there would never be a linux,2.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938810/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938833"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 8:35 UTC (Fri)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/938833/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Worst case, we would just have linux,1 forever and there would never be a linux,2</span><br>
<p>
At that point we could certainly talk about security theatre though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938833/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor938841"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 9:12 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938841/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No, there would still be a global gen id, it would just be much more painful to maintain. I'll let you figure out how pleased distribution maintainers would be with upstream maintainers if that were to happen - not that I am under any illusion they care one bit.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938841/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938952"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 3:16 UTC (Sat)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/938952/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, in this hypothetical (which I should stress has not actually happened (yet)), it would be a discussion between the distros and whoever is pro-SBAT. Frankly, I'm having a hard time imagining, say, Debian wanting to spend a lot of time on something like this, so it's possible they give SBAT a "no" as well. I suppose it's possible that the SBAT people try to write off the "uncooperative" distros, but I should like to think that there is enough Debian in datacenters to give hardware manufacturers pause about that course of action.<br>
<p>
Ultimately, the problem here is that somebody has to bell the cat, and at least historically in the FOSS community, things usually work out best if the person belling the cat is the person who actually wants the cat to wear a bell in the first place. The alternative just leads to the Nebraska problem,[1] which would be very bad in this case as it could leave a large amount of hardware suddenly unbootable.<br>
<p>
[1]: <a href="https://xkcd.com/2347/">https://xkcd.com/2347/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938952/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938957"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 4:59 UTC (Sat)
                               by <b>plugwash</b> (subscriber, #29694)
                              [<a href="/Articles/938957/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm no expert, but my understanding is that the underlying issues are.<br>
<p>
1. If we want our Linux distros to keep booting out of the box on new computers, then we have to play along with the secure boot "ecosystem", which is ultimately controlled by Microsoft.<br>
2. UEFI has very limited space for storing revocations, a single revocation incident consumed around half the availble revocation space. It's not at all clear to me what MS would do if revocation space ran out, but it may well not be nice for Linux.<br>
<p>
So it was determined that a more efficient revocation scheme was needed, one that could basically say "any version of software package "x" that is older (in security fix terms) than "y" is vulnerable rather than having to revoke images individually.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938957/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor938969"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 10:44 UTC (Sat)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938969/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; I'm having a hard time imagining, say, Debian wanting to spend a lot of time on something like this, so it's possible they give SBAT a "no" as well.</span><br>
<p>
No, Debian is involved too. Not only myself, but the maintainers of the bootloader stack are not only fully aware but also actively working on this, both downstream and upstream in the Shim community.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938969/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor938754"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 16:55 UTC (Thu)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/938754/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The idea of "no single serial number can possibly work" has been around since the first distributed versioning system was invented, umpteen years ago.<br>
<p>
Thus if I had to boil the kernel version down to a single integer, I'd use the number of minutes since 2023-07-01, or something along these lines.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938754/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938770"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 17:35 UTC (Thu)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/938770/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A constantly-updating number would imply that every kernel gets revoked as soon as the next release happens (if not sooner). The folks running old, but supported kernels would probably not appreciate that.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938770/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938777"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 18:25 UTC (Thu)
                               by <b>excors</b> (subscriber, #95769)
                              [<a href="/Articles/938777/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As far as I can tell, installing a new kernel would not automatically revoke older generations - revocations are applied by the system administrator (like <a href="https://support.microsoft.com/en-gb/topic/microsoft-guidance-for-applying-secure-boot-dbx-update-kb4575994-e3b9e4cb-a330-b3ba-a602-15083965d9ca">https://support.microsoft.com/en-gb/topic/microsoft-guida...</a>) or through Windows Update etc. (This differs from other anti-rollback mechanisms which simply refuse to install or boot an update if its generation number is lower than the one previously installed, like <a href="https://android.googlesource.com/platform/external/avb/+/master/README.md#Rollback-Protection">https://android.googlesource.com/platform/external/avb/+/...</a>)<br>
<p>
I presume the process is that someone identifies a serious bug that can be used to undermine Secure Boot, they make sure it's fixed on all interesting branches, they mark the current point in time, they get everyone who signs kernels to promise they're never going to sign any kernel without that bug fix, then they ask Microsoft to revoke all versions before that point. In that case, I don't think it makes a fundamental difference whether the point is identified by e.g. last CommitDate in minutes since epoch, or by a global generation number that was incremented at the same time as the bug was fixed on all branches. The latter just means the coordination between all the parties is recorded in the kernel repository, whereas the former means the kernel developers don't have any involvement and the coordination happens in some less-visible external forum and there's more chance of mistakes.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938777/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938778"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 19:41 UTC (Thu)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/938778/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
On the other hand, with a time-based scheme you can simply say "you can't boot kernels older than a month" and be done with it, no process required, formal or otherwise.<br>
<p>
Also, my impression is that many of those fixes are applied more-or-less silently, so nobody is going to start a formal process that points a big fat red arrow at a particular hole. <br>
<p>
Also², what happens when two of these formal processes run in parallel, or the resolution of one of them overtakes the other? Resolving these questions, plus then running the formal process itself whenever that's required (who decides?), is going to cost a nontrivial amount of work time = money.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938778/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938795"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 20:32 UTC (Thu)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938795/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That is obviously not really feasible. The timestamp is irrelevant, what matters is whether there is an observed vulnerability or not.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938795/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938821"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 6:05 UTC (Fri)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/938821/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Of course it's feasible. Grab the top commit's timestamp, convert to minutes, add to SBAT record, compile, install, boot, verify it's working, tell your boot loader not to allow booting any kernels with a lower number. Done.<br>
<p>
The question is whether you can reliably capture all relevant security violations with that. Well, no you can't, not reliably. I know that. The point is that there does not seem to be a way to reliably increment the number every time a problem is found *and* make sure that all those fixes are back- and crossported (otherwise the increment won't mean anything) *and* not point big fat red arrows at security problems, which would happen if the same commit increments the number in the SBAT. (And if it doesn't you wouldn't know what to backport in order to keep the guarantee.)<br>
<p>
So if there's a choice between a zero-precent solution (not do the SBAT thing at all), a 100% solution that is costly and nobody is going to implement,  and a 95% solution that doesn't really cost anything, I advocate for the latter.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938821/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938842"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 9:16 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938842/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No, it is not sensible, because the revocation would have to be incremented and deployed every month for no reason at all, which is just silly busywork. The stable backport issue is a made up strawman - it doesn't matter from which branch or which version number it has, either it's vulnerable to the identified issue or it isn't. If it's vulnerable it stops booting until fixed and bumped, it's as simple as that.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938842/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor939008"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2023 21:03 UTC (Sun)
                               by <b>danielthompson</b> (subscriber, #97243)
                              [<a href="/Articles/939008/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Where does the busy work come from?<br>
<p>
"the revocation would have to be incremented" means updating the minimum accepted generation number (revoking everything older than *this* number), right? If so, there is no good reason to update the minimum accepted generation number simply because an upstream component increases a time-based generation number.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939008/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor938953"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 3:27 UTC (Sat)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/938953/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
To my understanding, no, you can't do that. Or at least, you can't do that, assuming that I'm understanding your proposal correctly:<br>
<p>
1. Revoke all old kernels, scoped to some organization, so the IT department can just tell everyone "you have to use the latest release, no exceptions." This is what I think you are proposing, and it makes logical sense.<br>
2. Revoke all old kernels, globally, and everyone using SBAT enforcement is forced to comply. This is how the technology is meant to be used (at least as far as I can tell), and it is ridiculous, so presumably not what you meant.<br>
<p>
In short, these version numbers are not (apparently) intended for enforcing generic IT policies, and you cannot just "roll your own" SBAT policy (at least as far as I have been able to determine). They are intended as a more efficient means of global certificate/signature revocation, and are inherently unscoped. See <a href="https://github.com/rhboot/shim/blob/main/SBAT.md">https://github.com/rhboot/shim/blob/main/SBAT.md</a> for more discussion of motivations etc.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938953/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938954"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 3:32 UTC (Sat)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/938954/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; and you cannot just "roll your own" SBAT policy (at least as far as I have been able to determine).</span><br>
<p>
To be more explicit: I believe that this is impossible, because I believe that your SBAT policy would have to be signed by one of the keys that your firmware trusts, and the keys that your firmware trusts are the same as the keys that everybody else's firmware trusts, so if you could just make up and sign an arbitrary policy, you could trivially bypass the whole scheme.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938954/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938959"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 6:10 UTC (Sat)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/938959/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's absolutely possible for enterprises to enroll their own keys (and to have their own keys enrolled at the VAR step of device provisioning), and any such enterprise could impose their own policy.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938959/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor938791"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 20:00 UTC (Thu)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/938791/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A Modest Proposal: simply grep the entire kernel and git log at build time for strings of the form "CVE-(\d+)-(\d+)", numify them ($0 * 100000 + $1), and use the maximum.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938791/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938792"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 20:12 UTC (Thu)
                               by <b>geofft</b> (subscriber, #59789)
                              [<a href="/Articles/938792/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That would work a lot better if the kernel did not have an unwritten policy of deliberately not mentioning CVEs or exploitability in commit messages.<br>
<p>
See, for instance, the commit message fixing StackRot, a vulnerability so significant it got a cutesy name and not just a CVE: <a href="https://git.kernel.org/linus/9471f1f2f502">https://git.kernel.org/linus/9471f1f2f502</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938792/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938799"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 21:46 UTC (Thu)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/938799/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; That would work a lot better if the kernel did not have an unwritten policy of deliberately not mentioning CVEs or exploitability in commit messages.</span><br>
<p>
Yes, this remains a troublesome approach.  A lot of other security efforts in the kernel have improved including the reception of hardening patches and maybe Rust will help in the future.  Hopefully at some point they stop actively hiding it when they are aware of the issue ahead of time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938799/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938803"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 23:43 UTC (Thu)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938803/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's downright irresponsible, and gives bad actors a head start.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938803/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor938808"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 0:46 UTC (Fri)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/938808/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The decision about whether to name a vulnerability is the security researcher's decision, and does not reflect a finding of significance (who would have the authority to make such a finding, anyway?)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938808/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor938772"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 18:06 UTC (Thu)
                               by <b>caliloo</b> (subscriber, #50055)
                              [<a href="/Articles/938772/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What I see from what’s reported is a solution used in another context (that of proprietary OS editors I suppose) trying to be applied to the kernel development context. I don’t see how it would possibly work unless tackled at the distributor level, and even then… Only the final shipper of binary to a machine can take the responsibility of bricking a device because it doesn’t have the right version number.<br>
<p>
To think that having a number maintained at the root of development is a solution is to be ignorant of how dev is done with Linux and Linux distros imho.<br>
<p>
Software is a socio technical construct, especially when it comes to security, and to only focus on the technical for such a thing is the patch author mistake. It’s doubtful that the socio side of this patch can be made to work with the proposed technical form. I understand the reaction of the maintainers, although perhaps not the form of their refusal.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938772/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938798"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2023 21:37 UTC (Thu)
                               by <b>Paf</b> (subscriber, #91811)
                              [<a href="/Articles/938798/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is well said.  The social part - how and when this is updated, since there is clearly not a straightforward technical way to decide that - is what gives this actual value.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938798/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor938834"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 8:43 UTC (Fri)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/938834/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I would argue that it is even a technical problem.<br>
<p>
It is a fact that a security vulnerability's affected versions are usually of the form<br>
<p>
introduced in version x and fixed in version x+n<br>
<p>
introduction backported to version x-1.k and fixed in version x-1.k+m<br>
<p>
(repeat that second one as often as necessary)<br>
<p>
How is that tree structure of development and release branches with LTS supposed to be mapped to a single monotonically increasing integer?<br>
<p>
Not to mention downstream patches.<br>
<p>
And then there is the reality that out of all the possible combination of CONFIG options the vast majority only ever affect a subset.<br>
<p>
Not sure how broken secure boot is exactly in terms of being able to defeat it by bugs in any random subsystem of the payload it boots but even if you remove all the combinations of CONFIG options that make no difference it would lead to a lot of false positives being blocked.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938834/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor938807"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 0:56 UTC (Fri)
                               by <b>DemiMarie</b> (subscriber, #164188)
                              [<a href="/Articles/938807/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      To me, the only reasonable approach is to have a counter that is bumped by 1 at each kernel release.  If the version in the kernel image is less than the version in the firmware, the firmware refuses to boot the kernel.  Otherwise, the counter gets set to the version in the kernel image.


      
          <div class="CommentReplyButton">
            <form action="/Articles/938807/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938813"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 2:06 UTC (Fri)
                               by <b>geofft</b> (subscriber, #59789)
                              [<a href="/Articles/938813/">Link</a>] 
      </p>
      
      </div>
      </summary>
      This is basically what <a href="https://www.chromium.org/developers/design-documents/tpm-usage/#rollback-prevention">Chrome OS's rollback prevention</a> does, with the side feature that a physically present user can boot into recovery mode (which allows recovering the device itself, but destroys user data encryption keys). It seems like a new firmware version can raise the minimum kernel version, but it's not automatically updated simply by booting a new kernel.
<p>
<a href="https://android.googlesource.com/platform/external/avb/+/master/README.md#Rollback-Protection">Android seems to use</a> a manually-incremented number like the SBAT generation.




      
          <div class="CommentReplyButton">
            <form action="/Articles/938813/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor938826"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 7:56 UTC (Fri)
                               by <b>Lionel_Debroux</b> (subscriber, #30014)
                              [<a href="/Articles/938826/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Given that most kernel releases contain known and explicit, known and concealed or unknown security fixes, and certainly nobody wants to go through the trouble of trying to find whether every patch fixes a vulnerability which specifically allows bypassing Secure Boot... yeah, a counter which is bumped by 1 at "every" set of synchronized stable kernel releases (say, excluding e.g. brown paper bag releases containing a single build error fix, as occurs once in a while) - for instance, the recent 6.4.2, 6.3.12, 6.1.38, and 5.15.120 releases, <a href="https://lwn.net/Articles/937400/">https://lwn.net/Articles/937400/</a> - seems like a straightforward, easy, and reasonably honest way to update the SBAT.<br>
As for distributors who chose to maintain versions not based on a mainline LTS (Red Hat, etc.)... well, tough luck for them ?<br>
<p>
Incrementing the SBAT counter's value by 1 at "every" set of stable kernel releases will cause that value to grow to 3 digits after a couple years or so, but... one might argue that it's life when sets of stable kernel releases are being produced every few days, representing backports from a subset of 10-15K commits per ~70 day period, hundreds of which are probably security-relevant, and who knows how many of these specifically enable Secure Boot bypass.<br>
By virtue of slower release cycles, the SBAT counters of Windows or macOS, even if those were also incremented upon every release, would have slower progression. A simplistic look such as "Oh, the Linux SBAT counter value is much higher than that of Windows, therefore Linux security is trash" is, well, simplistic, and I really hope that people blurting out such stupidities is not a worry of anyone participating in that or this thread.<br>
<p>
Anyway, there was no need for the LKML thread to turn out this way, and help pile on the sewer reputation of part of this messaging conduit...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938826/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor938836"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 8:45 UTC (Fri)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/938836/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That sounds like a good way to make people stop applying firmware updates to avoid breaking their systems.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938836/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor938843"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 9:19 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938843/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That requires a constant churn that is not good for anybody, nor serve any purpose.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938843/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938988"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2023 0:28 UTC (Sun)
                               by <b>DemiMarie</b> (subscriber, #164188)
                              [<a href="/Articles/938988/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Updating whenever a new stable release comes out is the solution that is supported by upstream.  The “constant churn” you are referring to is an inevitable consequence of upstream trying to support every Linux user out there.  One can, of course, choose not to follow upstream’s recommendation, but then upstream is not responsible for any security problems one’s systems may have.<br>
<p>
My understanding is that grsecurity does a good job of keeping pace with upstream kernel patches, but I suspect they release equally often.  I am not aware of Red Hat or SUSE being able to keep up with the endless stream of security issues.  Android has a simpler problem because their kernel configuration is smaller.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938988/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor938857"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 12:10 UTC (Fri)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/938857/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This doesn't work with the multiple release tracks and cadences of the kernel. Should every set of stable releases come with a "must apply" patch to bump the mainline integer (because mainline being behind stable's counter seems…wrong)?<br>
<p>
There's also the unfortunate case of "commit X is not vuln, X+1 is because a bug is introduced, X+2 fixes it". If there are SBAT bumps in between, the old X commit is marked as vulnerable unnecessarily. In fact, I think this convinces me that the integer should be under the distributor control with some central registry of "please use at least X when fixing issue Y (and also fix all older issues too)" to help with coordination of things.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938857/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor938817"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 3:03 UTC (Fri)
                               by <b>shironeko</b> (subscriber, #159952)
                              [<a href="/Articles/938817/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
if this feature truly is so great, why not just maintain the number out-of-tree? it's just a number right?<br>
<p>
after all the distro pick up this magical number and be free of secure-boot rollbacks, I'm sure there will be a swarm of people pushing mainline to adopt it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938817/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor938820"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 5:30 UTC (Fri)
                               by <b>champtar</b> (subscriber, #128673)
                              [<a href="/Articles/938820/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
On server HW, can you rollback / bypass the revocation DB ? Motherboard dies, get replaced by a new one that prevent the perfectly working OS to boot, is the only option to disable SB ?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938820/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor938837"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 8:57 UTC (Fri)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/938837/">Link</a>] (22 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So, this seems to be an attempt to:<br>
<p>
1. Map every release of a bootable artifact to a monotonically increasing generation number, such that every increase of the generation indicates that prior generations have a serious security flaw<br>
<p>
2. Introduce hierarchy into the artifact labels to which the generation numbers are associated, to ease assignment management.<br>
<p>
The definition of a security issue seems to be unspecified, and the root of the argument here (?). Every Linux kernel release surely has security fixes, so surely every release would have its own generation number, rendering the whole scheme largely moot? <br>
<p>
The requirements for being a "product" worthy of being signed and being able to make use of "Secure Boot" by default (not having to install own keys, etc.) are of course at the whim of Microsoft, as ever. Thanks again to everyone for literally giving Microsoft the keys to being able to boot Linux.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938837/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938844"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 9:25 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938844/">Link</a>] (21 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Every Linux kernel release surely has security fixes, so surely every release would have its own generation number, rendering the whole scheme largely moot?</span><br>
<p>
No, things that apply to this will be few and far between<br>
<p>
<span class="QuotedText">&gt; Thanks again to everyone for literally giving Microsoft the keys to being able to boot Linux.</span><br>
<p>
Did you just step out of a time machine from roundabout 2010 or so?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938844/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938845"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 9:49 UTC (Fri)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/938845/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That claim seems disputed by everyone in the know; potential security faults are regularly fixed. The policy of when to upgrade besides the extremes of every version or never is quite ill-defined and the core of the debate here.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938845/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938846"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 9:59 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938846/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How many kernel-driven active firmware security bypasses are you seeing in the wild right now?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938846/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938852"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 10:42 UTC (Fri)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/938852/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Secure Boot purports to only let you run signed code.<br>
<p>
Ergo, any kernel execution bug is a secure boot bypass.<br>
<p>
The idea that it has to be "actively exploited" only makes it clear that it's security theater.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938852/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938854"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 11:02 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938854/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Secure Boot purports to only let you run signed code.</span><br>
<span class="QuotedText">&gt; Ergo, any kernel execution bug is a secure boot bypass.</span><br>
<p>
Most definitely not, it's not a code integrity mechanism. There only a few real use cases of full code integrity deployed using Linux that I am aware of, and none of them even use UEFI.<br>
<p>
<span class="QuotedText">&gt; The idea that it has to be "actively exploited" only makes it clear that it's security theater.</span><br>
<p>
Yep, 'boothole' and 'blacklotus' are definitely just 'theater', nothing to worry about<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938854/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938858"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 13:11 UTC (Fri)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/938858/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't know, if I want to write a rootkit I'll probably exploit a random vulnerability rather than try and thwart the signing. So if revocations are restricted to the latter, it will be security theater. That's my point. Maybe for bootloaders it's good enough, but not for something that receives as much untrusted code and data as a general purpose OS.<br>
<p>
<span class="QuotedText">&gt;  Yep, 'boothole' and 'blacklotus' are definitely just 'theater', nothing to worry about</span><br>
<p>
It's exactly because they're worrisome, that the SBAT number should be bumped for any vulnerability, no matter if actively exploited ot not.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938858/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor938945"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 0:53 UTC (Sat)
                               by <b>geofft</b> (subscriber, #59789)
                              [<a href="/Articles/938945/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;  Yep, 'boothole' and 'blacklotus' are definitely just 'theater', nothing to worry about</span><br>
<p>
I would, in fact, argue that anyone who cares about responding to boothole and batondrop but not ordinary privilege escalation vulnerabilities is performing security theater! What actual use cases consider either of these a danger that should not consider local privilege escalation a danger?<br>
<p>
If your goal is to protect against in-the-wild exploits and not vulnerabilities (which lines up with mentioning blacklotus the exploit not batondrop the vulnerability), that's maybe reasonable - but you can't do that with SBAT, because whether an exploit exists isn't a property of the binary being executed, it's a property of the rest of the world. That's why everyone's asking about vulnerabilities, because those are a property of the binary being executed. If an exploit gets developed today for a bug in kernel 5.0 that's fixed in kernel 5.1, you can't go back in time and make the SBAT data of 5.0 and 5.1 different.<br>
<p>
And there is already a mechanism for handling this, namely DBX. If that gets out of hand, then the only thing you can really do is to label every kernel version with some different metadata and have a mechanism for telling the firmware what the last unexploited kernel version is, which is a thing that not only has been proposed a few times in response to this proposal but is actually implemented in the real world for Chromebooks.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938945/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938949"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 1:40 UTC (Sat)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/938949/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One of the distinctions is ease of identification - the earlier in the boot chain you can compromise trust, the less obvious it's going to be to a user. It also increases your ability to subvert aspects of measured boot (although black lotus failed to do this, even though technically possible), and so I'd argue that there is a greater risk. I've got a bunch of thoughts here that I'll try to write up.<br>
<p>
dbx is a limited resource, and flagging every single individual image as revoked isn't viable - the easy solution is to force everyone to migrate to new kernel signing keys and then revoke all the old shims, but even that's a lot of entries. So having a centralised way to say "We believe that kernels with this property should be considered insecure in this particular fashion" and then have agents that can be trusted to enforce that policy is extremely useful from a maintainability perspective, but I also take your point that in the current porposal a vulnerability that was fixed (perhaps inadvertently) between 6.0 and 6.1 and is then later actively exploited in 6.0 is going to mean either point releases for 6.1 for no reason other than bumping SBAT or revoking kernels that don't have the vulnerability. The goal of the "single number" approach is, to my understanding, largely to make it easier for vendors to make assertions that they're shipping backports that fix the vulnerability, but maybe there's another approach that doesn't require this. I'll think about it some.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938949/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938950"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 2:14 UTC (Sat)
                               by <b>geofft</b> (subscriber, #59789)
                              [<a href="/Articles/938950/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The 2009 "Security impact ratings considered harmful" paper which I very slightly coauthored <a href="https://www.usenix.org/legacy/event/hotos09/tech/full_papers/arnold/arnold_html/">https://www.usenix.org/legacy/event/hotos09/tech/full_pap...</a> has a little bit of an analysis of how long it takes between the commit fixing a bug and the assignment of a CVE. There is a sizable long tail of CVE assignment well after the bug fix - the paper reports 14% of vulnerabilities had more than eight weeks of "impact delay", and you can see on the graph several vulnerabilities with a year or more of impact delay. So I think it will not be unusual to discover that an issue fixed in a released kernel had security impact. (After all, security bugs are just normal bugs....)<br>
<p>
It'd be interesting to see this data for newer kernel versions.<br>
<p>
Re ease of identification - the thing I'm imagining isn't (just) attacking the user's running OS, it's setting up a bootkit that boots a normal Linux kernel with literally any lockdown-integrity vulnerability (i.e. any kernel code execution bug, even if only exploitable by root) with a tiny initrd that immediately exploits it, does whatever nefarious thing it wants to do, and chainloads the real OS. It's true that this is likely to break measured boot, but I think it's basically as undiscoverable as any other bootkit: kernels boot pretty fast when you're not interested in hardware or userspace.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938950/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938951"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 2:24 UTC (Sat)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/938951/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
kexec doesn't hand over enough state to make it easy to perform a seamless handoff of (eg) graphics, so you'd need to jump through some hoops to avoid graphical artifacts or interruption of the boot splash in the process. I agree that how obvious this is is going to vary. But as we move towards initramfs being part of the signed payload, the initramfs→kexec approach becomes harder and you need to actually leave additional filesystem artifacts around.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938951/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor940404"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 3, 2023 23:15 UTC (Thu)
                               by <b>Kamilion</b> (subscriber, #42576)
                              [<a href="/Articles/940404/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
... I get graphical corruption of plymouth and knocked out of graphical boot to read two or three `quiet`-unsuppressed kernel warning messages already.<br>
<p>
RETBleed: WARNING: Spectre V2 mitigation leaves CPU vulnerable to RETBleed attacks, data leaks possible!<br>
[drm:vmw_host_printf [vmwgfx]] *ERROR* Failed to send host log message.<br>
systemd[1]: Invalid DMI field header.<br>
<p>
<p>
I don't get the vmwgfx error outside of virtualbox, obviously.<br>
(And this is a Skylake Xeon-Scalable Gold!)<br>
<p>
I don't think I have a single system that can boot from firmware to desktop *without* plymouth choking somewhere. My ryzens exhibit similar but not identical "unsuppressed messages breaking graphical boot while `quiet` is asserted" issues.<br>
<p>
I honestly got so sick of it I dropped `quiet` and defaulted my ubuntu spin to `verbose`.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/940404/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor938961"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2023 7:52 UTC (Sat)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/938961/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; If an exploit gets developed today for a bug in kernel 5.0 that's fixed in kernel 5.1, you can't go back in time and make the SBAT data of 5.0 and 5.1 different</span><br>
<p>
except when the SBAT number is time- or release-based and thus incremented as a matter of fact.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938961/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor938853"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 10:48 UTC (Fri)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/938853/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; No, things that apply to this will be few and far between</span><br>
<p>
So what will it apply to then? As per my comment: "The definition of a security issue seems to be unspecified"<br>
<p>
<span class="QuotedText">&gt; Did you just step out of a time machine from roundabout 2010 or so?</span><br>
<p>
It was a bad idea to give MS the keys to booting PCs in 2010. It's a bad idea still.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938853/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938855"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 11:15 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938855/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; So what will it apply to then? As per my comment: "The definition of a security issue seems to be unspecified"</span><br>
<p>
To what the people managing the revocations want it to apply to. Exactly how DBX revocations are applied to binaries that people managing DBX revocations want it to apply to.<br>
<p>
<span class="QuotedText">&gt; It was a bad idea to give MS the keys to booting PCs in 2010. It's a bad idea still.</span><br>
<p>
Except for the tiny problem that nobody else wanted to touch it with a barge pole, of course, because managing a CA is hard and expensive work, and being in charge of security for the ecosystem multiplies that costs by a few orders of magnitude, it turns out. But none of this is news in any way and has been well know for more than a decade.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938855/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor938862"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 13:41 UTC (Fri)
                               by <b>gray_-_wolf</b> (subscriber, #131074)
                              [<a href="/Articles/938862/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; It was a bad idea to give MS the keys to booting PCs in 2010. It's a bad idea still.</span><br>
<p>
On all motherboards I ever had that supported secure boot, it was possible to enroll my own keys.  Not sure however if that is usually possible or if I just had good luck while picking the HW.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938862/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938864"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 13:53 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/938864/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's a feature mandated by the Windows Logo certification. Because you know, Microsoft bad or something.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938864/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938865"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 14:01 UTC (Fri)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/938865/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Only on x86 hardware, not on ARM hardware sold by Microsoft. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938865/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938900"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 15:16 UTC (Fri)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/938900/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Iirc, not on arm hardware supplied with Windows ...<br>
<p>
So you can't replace Windows with linux unless you have a bootloader signed by MS ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938900/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938901"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 15:33 UTC (Fri)
                               by <b>pizza</b> (subscriber, #46)
                              [<a href="/Articles/938901/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;  Iirc, not on arm hardware supplied with Windows ...</span><br>
<p>
Most consumer-focused ARM hardware is heavily locked down.  Windows/Microsoft makes up a tiny portion of the market.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938901/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor938912"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 19:16 UTC (Fri)
                               by <b>nijhof</b> (subscriber, #4034)
                              [<a href="/Articles/938912/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You seem to have an idea of what issues this should be used for. So could you please list the 5 most recent issues that would have required a version bump?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938912/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor938920"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 20:11 UTC (Fri)
                               by <b>pjones</b> (subscriber, #31722)
                              [<a href="/Articles/938920/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The two that spring to mind, where in the past we've had to rotate signing keys as a result, are CVE-2019-20908 and CVE-2020-15780.  Both of them let you inject ACPI tables during boot, which in turn lets you run unsigned code in the kernel.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/938920/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor939231"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel memory corruption is a secure boot bypass</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2023 19:35 UTC (Tue)
                               by <b>DemiMarie</b> (subscriber, #164188)
                              [<a href="/Articles/939231/">Link</a>] 
      </p>
      
      </div>
      </summary>
      There are also many, <i>many</i> privilege escalation vulnerabilities with the same result.  That’s why forbidding kernel downgrades within a stable release series really is the only answer that can be supported upstream.  The attack surface of the upstream kernel is just too broad to be able to do otherwise.  Downstreams can shrink the attack surface massively by disabling kernel features not in use and by preventing unsigned privileged userspace code from running, but upstream cannot do either.



      
          <div class="CommentReplyButton">
            <form action="/Articles/939231/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor938859"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Use git revisions</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2023 12:51 UTC (Fri)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/938859/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Suppose for the sake of argument that a given vulnerability has a particular commit abcde which "fixes" it.  This need not be the exact commit fixing the bug, as long as you can say that all kernel versions descended from it are free of the vulnerability.  (That implies that the vuln hasn't been somehow reintroduced in a later revision; if that happened, you'd need to pick a newer commit as the "fix".)
<p>
Then to be sure of booting a non-vulnerable kernel you need to pick one which is a descendent of commit abcde.  The kernel build process can list all git revisions which are ancestors of the head commit and bake them into a binary blob which goes alongside the kernel image, similar to what happens for an initial ramdisk (initrd).  Like an initrd, the data is loaded into memory on first boot but freed later.  Then the kernel command line can have
<code>linux ancestor=abcde</code>
If the kernel isn't descended from that commit it will refuse to boot.
<p>
You still need to decide a sensible 'ancestor', but that is a matter of policy and can be an individual decision, not something a Linux kernel maintainer has to declare or increment.  For those who prefer a time-based approach there could be a kernel parameter to insist the current build is newer than a certain timestamp -- based on git revision time rather than build time.  And you could specify multiple 'ancestor' commits if needed.
<p>
If you don't want to carry around a big binary blob listing all git revisions, it's possible a Bloom filter could be used to get a more compact representation, at the cost of some false positives.  Personally I could live with that, but security people may not like the idea.




      
          <div class="CommentReplyButton">
            <form action="/Articles/938859/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor939968"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Use git revisions</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 1, 2023 17:50 UTC (Tue)
                               by <b>florianfainelli</b> (subscriber, #61952)
                              [<a href="/Articles/939968/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; If the kernel isn't descended from that commit it will refuse to boot. </span><br>
<p>
That decision cannot be left to the kernel however, otherwise you are breaking secure boot. Your proposal has merit but could also be somewhat difficult to manage. If said "fix" is applied to a stable branch, then the commit ID would be different (different ancestry), so then you have an explosion of commit IDs to track. Add to that whatever patches the distro may be applying and this becomes unmanageable. Hence the "unique number" which is simpler to track.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939968/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor941758"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Use git revisions</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 16, 2023 15:48 UTC (Wed)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/941758/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I imagine that all the usual kernel signing requirements would continue to apply.  So you wouldn't be able to make a custom patched kernel that ignores the <code>ancestor</code> parameter.  Nor would you be able to boot an older, signed kernel, since it would check that parameter when starting and refuse to continue.  So I think my proposal preserves the security properties of secure boot.
<p>
You are right that you'd need a selection of commit ids to deal with cherry-picking.  That is still more manageable and flexible than a global magic number.



      
          <div class="CommentReplyButton">
            <form action="/Articles/941758/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor939027"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 24, 2023 10:03 UTC (Mon)
                               by <b>wtarreau</b> (subscriber, #51152)
                              [<a href="/Articles/939027/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What I found in this thread is that despite being marked "RFC", the proponents didn't seem to give any consideration to the maintainers' point of view. Each and every argument trying to explain why it didn't fit the model was simply dismissed or rejected. This is clearly the reason why the "RFC" aspect was quickly ignored, because in practice it didn't work like an RFC but as a forced push attempt, based sometimes on misinformed facts (e.g. "you do 3 releases a year"). In fact I think it got attention because it was marked RFC, but otherwise it could also have been completely ignored as well and it wouldn't have made that much noise.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939027/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor939427"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2023 15:09 UTC (Thu)
                               by <b>kmeyer</b> (subscriber, #50720)
                              [<a href="/Articles/939427/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There seem to be a number of difficult conceptual and process issues here but the biggest impediment by far seems to be the attitude and communication style of SBAT's advocate bluca (Luca Boccassi) in the comments here.  They seem actively hostile to the kernel community and more broadly to anyone who has any question at all about how the scheme will work.  This is unfortunate.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/939427/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor939431"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Much ado about SBAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2023 15:37 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/939431/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Regardless of the applicability of this statement, I don't think that calling people out by name is going to help the situation or make the discussion more positive.  I'd prefer if we could avoid doing that...?


      
          <div class="CommentReplyButton">
            <form action="/Articles/939431/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2023, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
