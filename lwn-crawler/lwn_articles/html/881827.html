        <!DOCTYPE html>
        <html lang="en">
        <head><title>Resurrecting fbdev [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/881827/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/881306/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/881827/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Resurrecting fbdev</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Benefits for LWN subscribers</b>
<p>
The primary benefit from <a href="/Promo/nst-nag5/subscribe">subscribing to LWN</a>
       is helping to keep us publishing, but, beyond that, subscribers get
       immediate access to all site content and access to a number of extra
       site features.  Please sign up today!
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>January 19, 2022</br>
           </div>
<p>
The Linux framebuffer device (fbdev) subsystem has long languished in
something of a purgatory; it was listed as "orphaned" in the
<tt>MAINTAINERS</tt> file and saw fairly minimal maintenance, mostly driven
by developers working elsewhere in the kernel graphics stack.  That all
changed, in an eye-opening way, on January&nbsp;17, when Linus Torvalds
merged a <a
href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=3c750c7b614322a4ab50be0d57a76addb598d51d">change</a>
to make Helge Deller the new maintainer of the subsystem.  But it turns out
that the problems in fbdev run deep, at least according to much of the rest
of the kernel graphics community.  By seeming to take on the maintainer role in order to
revert the removal of some buggy features from fbdev, Deller has created
something of a controversy.
</p>

<p>
Part of the concern within the graphics community is the accelerated timeline that these events
played out on.  Deller <a
href="/ml/linux-kernel/YeG8ydoJNWWkGrTb@ls3530/">posted</a> his intention
to take over maintenance of the framebuffer on Friday, January&nbsp;14,
which <a
href="/ml/linux-kernel/CAMuHMdWNzDb--Ud1DzGyoqWsgFU9m8YZ6fa1TqfBWtg4pkd==A@mail.gmail.com/">received
an ack</a> from Geert Uytterhoeven later that day.  Two days later, before
any other responses had come in, Deller sent a <a
href="/ml/linux-kernel/YeRyfaesC2kxkgZC@ls3530/">pull request</a> to
Torvalds to add Deller as the fbdev maintainer, which was promptly picked
up. On January&nbsp;19, Deller <a 
href="/ml/linux-kernel/20220119110839.33187-1-deller@gmx.de/">posted</a>
reversions of two patch sets that removed scrolling acceleration from
fbdev.  In the meantime, those reversions had already been made in Deller's
brand new <a
href="https://git.kernel.org/pub/scm/linux/kernel/git/deller/linux-fbdev.git">fbdev
Git tree</a>. 
</p>

<p>
The patch sets that were being targeted for reversion had been posted and merged some
time ago.  Daniel Vetter <a
href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=39aead8373b3c20bb5965c024dfb51a94e526151">disabled
accelerated scrolling for the framebuffer console</a> (fbcon) back at the end of
2020.  At the time, he added a "todo" item to garbage collect the code that
supported that accelerated scrolling.  Claudio Suarez <a
href="/ml/linux-kernel/YVXTYqszZix9TxjJ%40gineta.localdomain/">posted a
patch</a> completing that todo item in September&nbsp;2021, which was <a
href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=b3ec8cdf457e5e63d396fe1346cc788cf7c1b578">committed</a>
in October.  On January&nbsp;13, shortly before deciding to take on maintenance of fbdev,
Deller <a
href="/ml/dri-devel/feea8303-2b83-fc36-972c-4fc8ad723bde@gmx.de/">asked
for a reversion</a> of the latter patch (or parts of it).
</p>

<p>
Once Monday January&nbsp;17 rolled around, Vetter and others noticed the
flurry of activity that had occurred over the weekend and weighed in.
Vetter <a
href="/ml/linux-kernel/CAKMK7uGdJckdM+fg+576iJXsqzCOUg20etPBMwRLB9U7GcG01Q@mail.gmail.com/">suggested</a>
that it might have been premature to make a maintainer change "<q>without even bothering
to get any input from the people who've been maintaining it
before</q>".  In particular, he was concerned about moving fbdev and
fbcon to a tree separate from the DRM tree; the subsystem may have been
marked as orphaned but the situation is more complicated than that:
<blockquote class="bq">
Because the status isn't entirely correct, fbdev core code and fbcon and
all that has been maintained, but in bugfixes only mode. And there's very
solid&amp;important reasons to keep merging these patches through a drm tree,
because that's where all the driver development happens, and hence also
all the testing (e.g. the drm test suite has some fbdev tests - the only
automated ones that exist to my knowledge - and we run them in CI
[continuous integration]). So
moving that into an obscure new tree which isn't even in linux-next yet is
no good at all.
<p>
Now fbdev driver bugfixes is indeed practically orphaned and I very much
welcome anyone stepping up for that, but the simplest approach there would
be to just get drm-misc commit rights and push the oddball bugfix in there
directly. 
</blockquote>
</p>

<p>
Beyond that, Jani Nikula was <a
href="/ml/linux-kernel/87o84a63hy.fsf@intel.com/">taken aback</a> by the
whirlwind pace of the changes.  In particular, he was not happy to see the
reversions being made in the new fbdev tree almost immediately, even though
the objection was only made a few days earlier. "<q>I'm heavily in favor
of maintainers who are open, transparent, 
collaborative, who seek consensus through discussion, and only put their
foot down when required.</q>"  Deller <a
href="/ml/linux-kernel/60fad896-235c-7602-39d1-14691282ebf6@gmx.de/">said</a>
that he had just started going through the backlog of patches;
"<q>nothing has been pushed yet</q>". He said that Nikula should
simply ignore the state of the fbdev tree at this point.
</p>

<p>
In response
to Vetter, Deller <a
href="/ml/linux-kernel/c80ed72c-2eb4-16dd-a7ad-57e9dde59ba1@gmx.de/">said</a>
that having a separate tree was not important.  He listed four goals for
maintaining fbdev going forward:
<blockquote class="bq">
<ol type="a" class="spacylist">
<li>to get fixes which were posted to fbdev mailing list applied if they are useful &amp; correct,
<li>to include new drivers (for old hardware) if they arrive (probably
happens rarely but there can be). 
   I know of at least one driver which won't be able to support DRM....
   Of course, if the hardware is capable to support DRM, it should be written for DRM and not applied for fbdev.
<li>reintroduce the state where fbcon is fast on fbdev. This is important for non-DRM machines,
   either when run on native hardware or in an emulator.
<li>not break DRM development
</ol>
</blockquote>
</p>

<p>
Vetter <a
href="/ml/linux-kernel/CAKMK7uHVHn9apB6YYbLSwu+adEB2Fqp4FM0z582zf4F-v3_GnQ@mail.gmail.com/">pointed</a>
Deller to the <a
href="https://drm.pages.freedesktop.org/maintainer-tools/getting-started.html">documentation</a>
for coming up to speed on DRM development and 
for getting <a
href="https://drm.pages.freedesktop.org/maintainer-tools/commit-access.html#drm-misc">commit
rights in the drm-misc tree</a>, which is the proper path for fbdev
fixes, he said. After that:
<blockquote class="bq">
I think once we've set that up and got it
going we can look at the bigger items. Some of them are fairly
low-hanging fruit, but the past 5+ years absolutely no one bothered to
step up and sort them out. Other problem areas in fbdev are extremely
hard to fix properly, without only doing minimal security-fixes only
support, so fair warning there. I think a good starting point would be
to read the patches and discussions for some of the things you've
reverted in your tree.
<p>
Anyway I hope this gets you started, and hopefully after a minor
detour: Welcome to dri-devel, we're happy to take any help we can get,
there's lots to do!
</blockquote>
</p>

<p>
Deller eventually <a
href="/ml/linux-kernel/4009cf14-2bb0-a63a-1936-4ac4d757777a@gmx.de/">decided
to keep the fbdev tree</a>, though he does <a
href="/ml/linux-kernel/bf2a45c4-5f48-24e6-213f-562e59505f3d@gmx.de/">plan
to coordinate</a> with the rest of the graphics development community:
<blockquote class="bq">
I'm not planning to push code to fbdev/fbcon without having discussed everything
on dri-devel. Everything which somehow would affect DRM needs to be discussed on
dri-devel and then - after agreement - either pushed via the fbdev git tree or
the drm-misc tree.
</blockquote>
</p>

<p>
It is clear there are differences of opinion on how to proceed.  The
hardware-accelerated scrolling that was removed was dependent on the 2D
<a href="https://en.wikipedia.org/wiki/Bit_blit">bit-blit</a>
acceleration features of older hardware.  But the code that used it in the
fbdev drivers was apparently rather buggy; over the years, syzbot
repeatedly found problems in that code, which is why it was eventually
removed.  The DRM subsystem <a
href="https://blog.ffwll.ch/2018/08/no-2d-in-drm.html">does not have
support for 2D acceleration</a>, and will not, due to some serious technical
difficulties in doing so.
</p>

<p>
On the other hand, Deller and others have graphics hardware that uses the
fbdev drivers and, formerly, had reasonable performance using the
hardware-accelerated scrolling.  That scrolling performance went away when
the code was removed, and they would like to get it back.  But reverting the removals
simply brings back the buggy code.  From the perspective of the DRM
developers, the right way forward is to create DRM-based drivers for these
devices, but Deller and others disagree.
</p>

<p>
The larger issue is how the transition has been handled, Vetter <a
href="/ml/linux-kernel/CAKMK7uEb53iu_HxYSnFZ59j=vXQdMvTWT7xosEo85XkAwzDMnA@mail.gmail.com/">said</a>
in the reversion thread:
<blockquote class="bq">
The other side is that being a maintainer is about collaboration, and
this entire fbdev maintainership takeover has been a demonstration of
anything but that. [...] This entire affair of rushing in a maintainer
change over the w/e [weekend] and then being greeted by a lot of wtf mails next
Monday does leave a rather sour aftertaste. Plus that thread shows a
lot of misunderstandings of what's all been going on and what drm can
and cannot do by Helge, which doesn't improve the entire "we need
fbdev back" argument.
</blockquote>
</p>

<p>
Vetter strongly believes that if the removed features are to return, the fbdev code needs to be
modernized to a point "<q>where we can still
tell distros that enabling it is an ok thing to do and not just a CVE
subscription</q>".  In addition, he believes there is a more
straightforward path toward improving the scrolling behavior without
bringing back all of the problems that syzbot has found:
<blockquote class="bq">
Also wrt the issue at hand of "fbcon scrolling": The way to actually
do that with some speed is to render into a fully cached shadow buffer
and upload changed areas with a timer. Not with hw accelerated
scrolling, at least not if we just don't have full scale development
teams for each driver because creating 2d accel that doesn't suck is
really hard. drm fbdev compat helpers give you that shadow buffer for
free (well you got to set some options).
</blockquote>
</p>

<p>
But Deller <a
href="/ml/linux-kernel/408c5dbd-a915-e3fc-fafb-738f6badc91a@gmx.de/">sees
things differently</a>;  there are existing drivers that need the support
that was removed.  He intends to try to restore that support, while also
presumably fixing whatever problems syzbot or others find:
<blockquote class="bq">
But in addition fbdev/fbcon is the kernel framework for nearly
all existing graphic cards which are not (yet) supported by DRM.
They need fbdev/fbcon to show their text console and maybe a simple X server.
If you break fbdev for those cards, they are completely stuck.
Hopefully those drivers will be ported to DRM, but that's currently
not easily possible (or they would be so slow that they are [unusable]).
</blockquote>
</p>

<p>
The DRM developers seem skeptical that the problems already identified can
be addressed, but it would seem that they should be giving Deller some time
to do so.  The "orphaned" status of fbdev was perhaps not the right choice,
though it is clear that the DRM community believed any change to that
status would come by way of discussion and agreement, rather than via a
surprise weekend takeover.  Be that as it may, a new maintainer for a
long-unloved part of the kernel should be seen as a good thing.  We will
have to wait to see how it all works out.
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_model-Maintainers">Development model/Maintainers</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Device_drivers-Graphics">Device drivers/Graphics</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/881827/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor881870"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 3:49 UTC (Thu)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/881870/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      <p>Making fbcon render asynchronously from a shadow buffer should be the top priority here. To demonstrate a point:</p>
<pre>~ $ time find /usr/share
[~140k lines snipped]
# on a vt, backed by radeondrmfb and a very fast CPU
real 1m4.837s	user 0m0.128s	sys 0m31.975s

# xfce4-terminal, which according to actual science is one of the slowest X11 terms:
# https://lwn.net/Articles/751763/
real 0m0.873s	user 0m0.192s	sys 0m0.199s</pre>
<p>A bare-bones fbcon is almost 75x slower than a (imho) somewhat bloated terminal emulator that happens to have a simple redraw-throttling optimisation - that's the kind of thing that leads to cargo-cult boot optimisation guides telling people to disable all kernel and init output to shave off a few centiseconds.</p>
























      
          <div class="CommentReplyButton">
            <form action="/Articles/881870/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor881889"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 9:12 UTC (Thu)
                               by <b>blackwood</b> (guest, #44174)
                              [<a href="/Articles/881889/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The problem with fbcon is that people want two things from it, which aren&#x27;t very compatible:<br>
<p>
Either a fast console because they don&#x27;t want to run bloated X or something like that, or because boot times or whatever. Those people want the shadow buffered fbcon and redraw limiting. Because all the people capable of writing high performance graphics are busy hacking on wayland (not even X anymore), there&#x27;s just not many folks who care enough to push the kernel console forward.<br>
<p>
The others want the dumbest possible console which can be slow, but should try the hardest to get an oops to the screen when the kernel is on fire. In that case you do not want shadow buffering, and the dumber and more immediate the code is, the better. This also means the least amount of hw touching, so definitely no acceleration or anything.<br>
<p>
You can&#x27;t  really have it both ways, at least not without some solid effort by a pile of people.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/881889/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor881901"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 11:29 UTC (Thu)
                               by <b>Karellen</b> (subscriber, #67644)
                              [<a href="/Articles/881901/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>You can't really have it both ways, at least not without some solid effort by a pile of people.</blockquote>

<p>I guess the answer would be two separate modules, fbcon_basic and fbcon_fast, and you pick which one you want at either kernel build time, or build both and pick at initrd creation time?</p>

<p>But I suppose that falls under "some solid effort by a pile of people".</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/881901/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882000"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 18:32 UTC (Thu)
                               by <b>JoeBuck</b> (subscriber, #2330)
                              [<a href="/Articles/882000/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Or on a panic, do a switch to dumb mode and print raw, but this needs to work in the face of unknown kernel corruption.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882000/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882014"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 21:42 UTC (Thu)
                               by <b>MrWim</b> (subscriber, #47432)
                              [<a href="/Articles/882014/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; work in the face of unknown kernel corruption.</font><br>
<p>
I quite like the scheme described here: <a href="https://apenwarr.ca/log/20190216">https://apenwarr.ca/log/20190216</a> . The kmsg buffer is at a fixed location in memory, so you can write there which should be reliable even in the face of significant kernel memory corruption. On the next boot the kernel checks if there are valid messages there and preserves them so you can see what went wrong. It&#x27;s beautiful in its simplicity.<br>
<p>
The patches were posted upstream, but it never went anywhere.<br>
<p>
<a href="https://lore.kernel.org/lkml/1331617001-20906-1-git-send-email-apenwarr@gmail.com/">https://lore.kernel.org/lkml/1331617001-20906-1-git-send-...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882014/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882133"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 21, 2022 18:29 UTC (Fri)
                               by <b>bnorris</b> (subscriber, #92090)
                              [<a href="/Articles/882133/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You mean something like this?<br>
<p>
<a href="https://www.kernel.org/doc/html/latest/admin-guide/ramoops.html">https://www.kernel.org/doc/html/latest/admin-guide/ramoop...</a><br>
<p>
That&#x27;s been upstream for quite a while, and it works just fine. Chrome OS uses it heavily for field crash logging. Despite its naming, it can be configured to dump logs to RAM even on non-crashes.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882133/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor881984"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 16:22 UTC (Thu)
                               by <b>ibukanov</b> (guest, #3942)
                              [<a href="/Articles/881984/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If one needs absolutely reliable way to print kernel errors, then just output it to a serial port or log it over network if  the former is not available. The modern graphics hardware is way too complex to allow for the dumbest frame buffer to be reliable. Probability of if not hardware bugs but at least quirks is just too high.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/881984/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor881985"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 18:22 UTC (Thu)
                               by <b>gnoutchd</b> (subscriber, #121472)
                              [<a href="/Articles/881985/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Whatever became of <a href="https://www.freedesktop.org/wiki/Software/kmscon/">kmscon</a>?  Putting the "smart" console in userspace sounds like a solution, no?  Should people be thinking about converting hw-accelerated fbdev drivers into kmscon backends, or somesuch?








      
          <div class="CommentReplyButton">
            <form action="/Articles/881985/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882012"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 20:57 UTC (Thu)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/882012/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I agree; putting the simplest possible thing in kernel space and all the complexity into userspace seems like the right answer here. Keep a terminal up-to-date, and render it to a framebuffer based on a frame rate (e.g. vsync).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882012/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882033"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 23:09 UTC (Thu)
                               by <b>blackwood</b> (guest, #44174)
                              [<a href="/Articles/882033/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It stalled for a few years, but a few folks from rh and suse have picked up the pieces again. We have simpledrm now merged, which means firmware fbdev drivers (efifb, vesafb, ...) aren&#x27;t needed anymore, and you can have a pure kms world.<br>
<p>
Next step is to get some kernel console on top of drm landed, for (emergency) logging. This should probably wait for the remaining console_lock rework so that we don&#x27;t have to maintain our own kthread for offloading.<br>
<p>
At that point all the pieces are in places for distros to ditch CONFIG_VT and fbcon and use kmscon for non-graphical shell logins on the local machine. Apparently logind/seatd already can do all the vt switching without CONFIG_VT (since that&#x27;s needed for all the additional seats anyway), so that part is covered.<br>
<p>
It might all actually happen this decade!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882033/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor881993"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 19:08 UTC (Thu)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/881993/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Right now we have neither:<br>
<p>
When things are working normally, the console&#x27;s only function is as blinkenlights so people know their boot hasn&#x27;t frozen. It&#x27;s also a significant bottleneck as shown (restoring hwaccel would only hide this symptom) and as an interactive terminal it&#x27;s pretty bad too. There&#x27;s no reason to have &quot;every frame a painting&quot; here.<br>
<p>
When things aren&#x27;t working, the console is useless because it scrolls far too fast for an operator at the terminal to read it all (restoring hwaccel would only make this worse), and fbcon scrollback rarely works at the best of times so any important output that scrolls offscreen is lost. There are already half a dozen ways to get organic-readable boot output, this part doesn&#x27;t need further fixing.<br>
<p>
It&#x27;s basically the atime thing all over again.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/881993/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882048"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 21, 2022 8:49 UTC (Fri)
                               by <b>geert</b> (subscriber, #98403)
                              [<a href="/Articles/882048/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; fbcon scrollback rarely works</font><br>
<p>
Fbcon scrollback was removed in v5.9 (<a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=50145474f6ef">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/...</a>).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882048/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882054"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 21, 2022 11:51 UTC (Fri)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/882054/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      I hope it will be restored. This breaks <a href="https://salsa.debian.org/consolation-team/consolation/">consolation</a>



      
          <div class="CommentReplyButton">
            <form action="/Articles/882054/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882058"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 21, 2022 12:11 UTC (Fri)
                               by <b>geert</b> (subscriber, #98403)
                              [<a href="/Articles/882058/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wasn&#x27;t aware of that.  So this should be reported as as userspace regression.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882058/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882214"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 22, 2022 16:55 UTC (Sat)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/882214/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It&#x27;s been years, isn&#x27;t that too long to claim regression?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882214/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882262"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2022 20:39 UTC (Sun)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/882262/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Everyone knew it was a regression when it was done. shift-page up is a documented user interface. The IOCTL is documented. consolation already existed. It is never too late to do the right thing.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882262/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor882187"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 22, 2022 8:28 UTC (Sat)
                               by <b>tdz</b> (subscriber, #58733)
                              [<a href="/Articles/882187/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hi, could you please link a bug report for this problem?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882187/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882188"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 22, 2022 9:25 UTC (Sat)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/882188/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Is it what you want ?<br>
<a href="https://bugs.debian.org/988039">https://bugs.debian.org/988039</a><br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882188/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882203"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 22, 2022 16:24 UTC (Sat)
                               by <b>tdz</b> (subscriber, #58733)
                              [<a href="/Articles/882203/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks a lot.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882203/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor881881"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 6:17 UTC (Thu)
                               by <b>error27</b> (subscriber, #8346)
                              [<a href="/Articles/881881/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The fbdev subsystem has needed a maintainer for a years.  It&#x27;s a super frustrating subsystem because when you report bugs the attitude is &quot;Yeah.  Fbdev is a known root exploit so who cares if it crashes a bit?&quot;<br>
<p>
For example, here are some bugs I reported back in 2014.<br>
<a href="https://marc.info/?l=kernel-janitors&amp;m=139060309806888&amp;w=2">https://marc.info/?l=kernel-janitors&amp;m=13906030980688...</a><br>
<p>
Here is the fix for that from last December but it still has not been applied.  I asked George Kennedy to wait for a bit and resend it through Andrew Morton.<br>
<a href="https://lkml.org/lkml/2021/12/7/1040">https://lkml.org/lkml/2021/12/7/1040</a><br>
<p>
On the other hand, I really don&#x27;t want the accelerated scrolling patch to be revived.  The main problem with fbdev is all the crashing and the memory corruption bugs.  Memory corruption bugs confuse syzbot so instead of showing up as one bug, it shows up as dozens of crazy bugs in random parts of the kernel.  It&#x27;s horrible and we spent a long time fixing it.  Let&#x27;s not go backwards.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/881881/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor881888"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 9:05 UTC (Thu)
                               by <b>blackwood</b> (guest, #44174)
                              [<a href="/Articles/881888/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
From drm side we do care a bit about fbdev, but it&#x27;s extremely limited to just the core code, fbcon, and the handful of firmware drivers that run before drm drivers take over.<br>
<p>
So yeah any driver patches for something like cirrusfb tend to get ingored. Run the drm/cirrus driver instead, if that blows up there will be people who take a look.<br>
<p>
The thing _is_ a root exploit pretty much end-to-end :-/<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/881888/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor881895"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 10:56 UTC (Thu)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/881895/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The thing _is_ a root exploit pretty much end-to-end :-/</font><br>
<p>
If this is the case, there is nothing Deller can do to make it worse.<br>
Since KMS made all but impossible to use the VGA console, all systems are running fbdev now.<br>
I for one, am happy there is a new maintainer that see fbdev as something else as a liability.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/881895/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor882977"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2022 3:23 UTC (Fri)
                               by <b>HelloWorld</b> (guest, #56129)
                              [<a href="/Articles/882977/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; If this is the case, there is nothing Deller can do to make it worse.</font><br>
<p>
Of course there is. He can make people think that using fbdev is a reasonable idea because, after all, it is being maintained now! Or he can delay the removal of that code.<br>
<p>
This whole situation is very unfortunate. Just let it die already.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/882977/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor881897"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 10:56 UTC (Thu)
                               by <b>error27</b> (subscriber, #8346)
                              [<a href="/Articles/881897/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Huh...  I know that patching fbdev is a waste of time, but sometimes code annoys me so much that I just fix it anyway.  I just looked at my outbox and I discovered that *none* of my fbdev patches from 2021 were applied.<br>
<p>
I sent four patches to fbdev in 2021.  In one case, the original author fixed his bug before me so that&#x27;s fine.  In another case, my patch was Acked but not applied.  And for the remaining two patches I was just ignored.  There is no other subsystem right now that&#x27;s as bad as that.<br>
<p>
It&#x27;s such a discouraging thing because newbies are like:<br>
<p>
Step 1: Find an easy bug<br>
Step 2: Fbdev hasn&#x27;t applied bugfixes for years so it has the most obvious bugs<br>
Step 3: Send a patch<br>
Step 4: Wait for feedback before going further<br>
Step 5: Die of old age<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/881897/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor881893"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 9:37 UTC (Thu)
                               by <b>shiftee</b> (subscriber, #110711)
                              [<a href="/Articles/881893/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Easier to ask for forgiveness than permission<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/881893/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor881959"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Resurrecting fbdev</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 20, 2022 15:05 UTC (Thu)
                               by <b>daenzer</b> (subscriber, #7050)
                              [<a href="/Articles/881959/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
&quot;The DRM subsystem does not have support for 2D acceleration&quot; is not correct. The linked article is specifically about a generic 2D acceleration UAPI, which fbdev doesn&#x27;t have either (because it&#x27;s basically impossible to define a sensible one).<br>
<p>
A DRM driver can however implement the same fbdev acceleration hooks as a native fbdev driver can, and some DRM drivers actually did. Many DRM drivers haven&#x27;t done this because the HW is more complex than a traditional 2D accelerator and cannot safely be used under all circumstances where fbdev acceleration hooks can get called.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/881959/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2022, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
