        <!DOCTYPE html>
        <html lang="en">
        <head><title>TALPA strides forward [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/295568/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/294986/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/295568/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>TALPA strides forward</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>LWN.net needs you!</b>
<p>
Without subscribers, LWN would simply not exist.  Please consider
       <a href="/Promo/nst-nag2/subscribe">signing up for a subscription</a> and helping
       to keep LWN publishing.
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>August 27, 2008</br>
           </div>
<p>
When last we left TALPA, it was <a
href="http://lwn.net/Articles/292872/">still floundering around without a
solid threat model</a>, but over the last several weeks that part has
changed.  Eric Paris <a href="http://lwn.net/Articles/293835/">proposed</a>
a fairly straightforward&mdash;though still somewhat
controversial&mdash;model for the threats that TALPA is supposed to
handle.  With that in place, there is at least a framework for kernel
hackers to evaluate different
ways to solve the problem, while also keeping in mind other potential uses.  
</p>

<p>
It seems almost tautological, but anti-virus scanning is supposed
to, well, scan files.  In particular, they scan for known
malware and block access to files when 
they are found to be infected.  For better or worse, scanning files is seen
as an 
essential security mechanism by many, so TALPA is trying to provide a means
to that end.  Paris describes it this way:
<div class="BigQuote">
This is a file scanner.  There may be all
sorts of marketing material or general beliefs that they provide
security against all sorts of wide and varied threats (and they do),
but in all reality the only threats they provide any help against are
those that can be found by scanning files.  Simple as that.  Some may
argue this isn't "good" security and I'm not going to make a strong
argument to the contrary, I can stand here for days and show cases where
this is highly useful but no one can provide a threat model more than to
say, "we attempt to locate files which may be harmful somewhere in the
digital ecosystem and try to deny access to that data."
</div>

<p>
All of the various scenarios where active processes can infect files with
malware or actively try to avoid scanning can be ignored under this model.
While this looks like "security theater" to some, it avoids the endless
what-ifs that were bogging down earlier discussions.  It may not be a
threat model
that appeals to many of the kernel hackers, but it is one that they can
work with.
</p>

<p>
To many kernel developers&mdash;used to efficiency at nearly any
cost&mdash;time 
consuming filesystem scans seem ludicrous, especially since they only
"solve" a subset of the malware problem.  But the fact remains that Linux
users, particularly in "enterprise" environments, believe they need this
kind of scanning and are willing to pay for products that provide it.  The
current methods used by anti-virus vendors to do the scanning are
problematic at best, causing users to run kernels tainted with binary
modules.  With a threat model&mdash;however limited&mdash;in place, work
can proceed 
to find the right way to add this functionality into the kernel.
</p>

<p>
Paris is <a href="/Articles/295671/">narrowing in</a> on a design that
calls out to user space, both synchronously and asynchronously depending on
the operation.  File access might go something like this:
<ul>
<li><tt>open()</tt> - causes interested user-space programs to be notified
asynchronously; anti-virus scanners might kick off a scan if needed</li>
<li><tt>read()/mmap()</tt> - causes a synchronous user-space
notification, which 
allows anti-virus scanners to block access until scanning is complete; if
malware is found, cause the read/mmap to return an error</li>
<li><tt>write()</tt> - whenever the modification time (mtime) of a file is
updated, asynchronously notify user space; this would allow anti-virus
scanners to re-scan the data as desired
<li><tt>close()</tt> - asynchronous user-space notification; another place
where anti-virus scanners could re-scan if the file has been dirtied
</ul> 
</p>

<p>
Where and how to store the current scanning status of a file is still an
open question.  Various proposals have been discussed, starting with a
non-persistent flag in the in-memory inode of a file.  While simple, that
would cause a lot of unnecessary additional scanning as inodes drop out
of the cache.  Persistent storage of the scanned status of a file
alleviates that problem, but runs into another: how do you handle multiple
anti-virus products (or, more generally, scanners of various sorts); whose
status gets stored with the inode?
</p>

<p>
For this reason, user-space scanners will need to keep their own database
of information about which inodes have been scanned.  For anti-virus
scanners, they will also want to keep information about which version of
the virus database was used.  Depending on the application, that
could be stored in extended attributes (xattrs) of the file or in some
other application-specific database.  In any case, it is not a problem for
the kernel, as Ted Ts'o <a href="/Articles/295695/">points out</a>:
<div class="BigQuote">
I'm just arguing that there should be absolutely *no* support in the
kernel for solving this particular problem, since the question of
whether a file has been scanned with a particular version of the virus
DB is purely a userspace problem.
</div>
</p>

<p>
It is important to keep the scanned status out of kernel purview in order
to ensure that policy decisions are not handled by the kernel itself.  This
is in keeping with the longstanding kernel development principle that user
space should make all policy decisions.  This allows new applications to
come along, ones that were perhaps never envisioned when the feature was
being designed.  For example, Alan Cox <a
href="/Articles/295696/">describes</a> another reason that the state of the
file with respect to scanning should be kept in user space:
<div class="BigQuote">
This is another application layer matter. At the end of the day why does
the kernel care where this data is kept. For all we know someone might
want to centralise it or even distribute it between nodes on a clustered
file system.
</div>
</p>

<p>
The latest TALPA design includes an in-memory clean/dirty flag that can
short circuit the blocking read notification (when clean).  That flag gets
set to dirty whenever there is an mtime modification.  This optimizes the
common case of reading a file that hasn't changed.  Further optimizations
are possible down the line as Paris mentions:
<div class="BigQuote">
If some general xattr namespace is agreed upon for such a thing someday
a patch may be acceptable to clear that namespace on mtime update, but I
don't plan to do that at this time since comparing the timestamp in the
xattr vs mtime should be good enough.
</div>
</p>

<p>
Various other uses for the kinds of hooks proposed for TALPA have also come up
in the discussion. Hierarchical storage management, where data is
transparently moved between different kinds of media, might be able to use
the blocking read mechanism. File indexing applications and intrusion
detection systems could use the mtime change notification as well.  This is
a perfect example of kernel development in action; after a rough start,
the TALPA folks have done a much better job working <i>with</i> the
community. 
</p>

<p>
Some might argue that the kernel development process is somehow suboptimal,
but it is the only way to get things into Linux.  As the earlier adventures
of TALPA would indicate, flouting kernel tradition is likely to go
nowhere.  While it is still a long way from being included&mdash;pesky
things like working code are still needed&mdash;it is clearly on a path to
get there some day, in one form or another.
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-Security_technologies">Security/Security technologies</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Talpa">Talpa</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/295568/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor295869"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 1:48 UTC (Thu)
                               by <b>jwb</b> (guest, #15467)
                              [<a href="/Articles/295869/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I certainly hope this never gets anywhere near to being included in the Debian kernel package.  If this junk somehow, by some miracle of bad judgment, gets included in a release kernel, I hope the distributors have the food sense to rip it out.<br>
<p>
The best solution is for distros which cater to the ignorant, like RHEL and SLES, to patch this crap into their private trees.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295869/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295876"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 4:45 UTC (Thu)
                               by <b>jzbiciak</b> (guest, #5246)
                              [<a href="/Articles/295876/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If an actual virus scanner is included in the kernel, sure.  But the hooks themselves sound reasonable for other purposes, such as hierarchical storage management.  I wouldn't throw the baby out with the bathwater.<br>
<p>
I do agree, though, that scanning Samba shares for Windows viruses sounds like a userspace problem.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295876/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295884"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 6:42 UTC (Thu)
                               by <b>drag</b> (guest, #31333)
                              [<a href="/Articles/295884/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes. <br>
<p>
Look, ignore all the 'windoze' and 'ignorant users' for now.<br>
<p>
What this allows to do is active scanning of files. Not necessarily for viruses, but for any reason you can think of.<br>
<p>
-------------<br>
Now we have Clamav, right? Well Clamav is a passive scanning program. Meaning it can only scan files that we direct at it to scan. <br>
<p>
A active scanner, on the other hand, is designed so that it deals with files on a automated manner based on file system events. <br>
<p>
This is all that they want to do, at this point. On a given file system event, pause the access, and alert a third party to the event, redirect data as necessary, and then allow or deny access based on that third party.<br>
<p>
Virus scanning, at this point, doesn't even enter into it. The criteria or data logging facilities can be used for anything.<br>
<p>
It's a bit of a solution in search of a problem, but I wouldn't be suprised if somebody comes up with something clever to do with it. It's a bit like extended acls... sure for most functions you can figure out how to do a decent job with rwx/ugo, but you'll run into situations were the older access controls won't work effectively without a lot of kludges.<br>
<p>
At the very least when setting up a Windows network file server/web server/email server/etc you can vastly improve performance and security by only scanning files as they change, real-time, instead of periodically scanning the entire share. Instead of stumbling onto a virus a hour after it's been written to your server you can have a 'ok' chance of intercepting it and logging the machine.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295884/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295890"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 6:54 UTC (Thu)
                               by <b>drag</b> (guest, #31333)
                              [<a href="/Articles/295890/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ok.. Here is one application.<br>
<p>
How about tying a revision control system into it, something like 'git'? Instead of just having formal commits, you can have smaller revisions of secondary importance of each and every time you write to a file. <br>
<p>
Maybe make it so that it's possible that you could colaberate with other people real-time... so that you could have your local copy, but have it alert you if a file your writing too has already been changed by another person. So that way you would not rely on a central server or system to keep a 'fence' or whatever.. you just write a file and notifications are sent out quickly.<br>
<p>
Something.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295890/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295915"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 10:29 UTC (Thu)
                               by <b>NAR</b> (subscriber, #1313)
                              [<a href="/Articles/295915/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I believe the filesystem used by ClearCase does something similar.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295915/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295975"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 15:50 UTC (Thu)
                               by <b>pflugstad</b> (subscriber, #224)
                              [<a href="/Articles/295975/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Clearcase requires explicit check-in/out else others won't see your changes.
At least if you're in different views.  And if multiple people are working
in the same view, you should be shot.
      
          <div class="CommentReplyButton">
            <form action="/Articles/295975/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295978"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 16:01 UTC (Thu)
                               by <b>NAR</b> (subscriber, #1313)
                              [<a href="/Articles/295978/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I meant the <I>you could have your local copy, but have it alert you if a file your writing too has already been changed by another person</I> part - the dynamic view in ClearCase lets me have a local copy (as long as I've checked out the file) and will alert at checkin that the file was changed. The other (not checked out) files are automatically updated (i.e. <I>colaberate with other people real-time</I>).
<P>
On the other hand, even vim alerts me, if an opened file is changed on the disk...
      
          <div class="CommentReplyButton">
            <form action="/Articles/295978/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor295919"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 10:55 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/295919/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That job is surely better done with FUSE.<br>
<p>
Just about the only thing TALPA can do that FUSE can't is run over areas <br>
of the system, like /usr or /, where frequent transitions to a userspace <br>
filesystem would be damaging to performance.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295919/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296087"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 23:51 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/296087/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
the problem with fuse is the performance<br>
<p>
but also, unless fuse implements similar hooks you would need to have a fuse layer for each scanner tool, and that will make the performance problems even worse.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296087/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor296306"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SCM in the filesystem?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 31, 2008 2:40 UTC (Sun)
                               by <b>vonbrand</b> (subscriber, #4458)
                              [<a href="/Articles/296306/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <p>
Sure, at first sight the idea of "each change is a commit" sounds sensible, but if you have ever worked with some kind of fine-grained (local like <code>RCS</code>, or distributed like <code>git</code>) SCM, you soon discover that commits must record <em>meaningful</em> changes. Not each time I decide to save a file in the editor "just in case" (or, much worse, that the editor decides that there have been enough changes to write out a snapshot) does make sense as a meaningful point in history. Most commits are coordinated changes to several files (something of which you are painfully aware when using <code>RCS</code>).
      
          <div class="CommentReplyButton">
            <form action="/Articles/296306/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor325416"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SCM in the filesystem?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 25, 2009 18:17 UTC (Wed)
                               by <b>mrshiny</b> (subscriber, #4266)
                              [<a href="/Articles/325416/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It would be useful to automatically put /etc under source control using a tool like this.  Every save in /etc IS a commit on my system.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/325416/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor295889"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 6:49 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/295889/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
another thing these hooks could be used for is backup programs.<br>
<p>
today they have to check timestamps, inode numbers, and file checksums to try and figure out what files have changed since the last time they looked.<br>
<p>
if the tags are stored persistantly these hooks would give another mechanism<br>
<p>
however, alerting when mtime changes is not good enough, compilers are running into problems where they aren't recompiling everything they need to becouse the systems are getting fast enough that the timestamp before and after a change may be the same.<br>
<p>
alerting any time that the mtime would be changed, even if it changes to the same value that it was before can work, but you can't count on the mtime changing every time a file is modified.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295889/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295902"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 9:00 UTC (Thu)
                               by <b>evgeny</b> (subscriber, #774)
                              [<a href="/Articles/295902/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; compilers are running into problems</font><br>
<p>
I believe it's `make' that runs into the problem.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295902/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295904"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 9:16 UTC (Thu)
                               by <b>liljencrantz</b> (guest, #28458)
                              [<a href="/Articles/295904/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sure, many other build systems, like scons, allow you to use file checksums instead of mtime, for determining if a file has been modified. But once your project gets big enough, that is slow. The largest project I've used scons contained a few megabytes of source code, and scons would take a noticable amount of time checking the dependencies. So it's not only make.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295904/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295914"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 10:30 UTC (Thu)
                               by <b>rvfh</b> (guest, #31018)
                              [<a href="/Articles/295914/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Looking at mtime should be enough, provided that we look for any change in it and not just for it to be greater that than of another file.<br>
<p>
Let me explain: the time maybe wrong a one machine causing the mtime go backwards, like when editing a file that's on a build server share, but it is very unlikely that the mtime will be exactly the same as it was before edition.<br>
<p>
It is quicker to check mtime for a change than checksuming the whole file.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295914/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor297026"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 4, 2008 20:27 UTC (Thu)
                               by <b>renox</b> (guest, #23785)
                              [<a href="/Articles/297026/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Mmm, in this case a version number attribute associated with each file would be better (if only because SW developers would be less likely to compare mtime of different files), though it may be a bit costly to maintain especially on CPU with don't have an atomic increase instruction.. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/297026/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor295920"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 10:57 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/295920/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And the right solution to this is finer-grained timestamps.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295920/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295922"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 11:05 UTC (Thu)
                               by <b>evgeny</b> (subscriber, #774)
                              [<a href="/Articles/295922/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm not sure. Consider distributed compilation farms (here "distributed" may refer to either filesystem and/or compiler; or just an NFS-mounted volume in the simplest case). Then maintaining nanosecond-accuracy time sync between several computers is needed, which is not trivial.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295922/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295936"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 11:58 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/295936/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
NTP can already report jitter and offset values. Maybe what we need is a <br>
way to have those values *reduce* the precision of the kernel-provided <br>
nsec timestamps, so that you get timestamps as accurate as possible for <br>
your timebase, but no more accurate? (Of course, if the jitter changes a <br>
lot, interesting things may happen, but that's quite rare.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295936/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295979"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 16:01 UTC (Thu)
                               by <b>bfields</b> (subscriber, #19510)
                              [<a href="/Articles/295979/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Note that no linux filesystem has time resolution better than a jiffy.  (The on-disc format may use nanoseconds, but the mtime/ctime/atime aren't updated using a nanosecond-precision time source.)
      
          <div class="CommentReplyButton">
            <form action="/Articles/295979/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor296015"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 18:43 UTC (Thu)
                               by <b>SEJeff</b> (guest, #51588)
                              [<a href="/Articles/296015/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"""Then maintaining nanosecond-accuracy time sync between several computers is needed, which is not trivial."""<br>
<p>
It is actually really easy if you are not using Cisco switches. The latency of the switches makes a big difference.<br>
<p>
Use ptpd from the linux hosts:<br>
<a href="http://ptpd.sourceforge.net/">http://ptpd.sourceforge.net/</a><br>
<p>
It will allow you to keep nanosecond time sync of all machines in a lan using multicast.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296015/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor296083"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 23:41 UTC (Thu)
                               by <b>njs</b> (guest, #40338)
                              [<a href="/Articles/296083/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No, you just need a cleverer algorithm -- like someone mentioned above, you should look for changed timestamps rather than simply "future" timestamps (because clocks get set back all the time, but it's extraordinarily unlikely that a second edit will come along at exactly the moment when the old timestamp is repeated).  Then to fix the quickly-repeated-edits problem, if the timestamp is within 2*resolution of the current time (for some conservative definition of resolution), don't write that timestamp down in your cache.  Easy and safe, and causes hardly any speed degradation.<br>
<p>
(High-quality VCS's already do this; I first learned the trick from bzr, dunno if any other popular ones have picked it up.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296083/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296094"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2008 0:08 UTC (Fri)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/296094/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
remember that the notification goes out while the file is still open.<br>
<p>
so a program writes to a file, the scanner gets notified, scans the file, notes the mtime, the program writes to the file again.<br>
<p>
on a fast machine it's very possible that this can all take place in a short enough time that the mtime does not change<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296094/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296105"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2008 0:35 UTC (Fri)
                               by <b>njs</b> (guest, #40338)
                              [<a href="/Articles/296105/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;so a program writes to a file, the scanner gets notified, scans the file, notes the mtime, the program writes to the file again.</font><br>
<p>
and the scanner gets notified again, and scans the file again, yes.<br>
<p>
All the things you say are true, but I'm afraid I don't understand why you are saying them here (i.e., I'm missing your point somewhere)?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296105/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296109"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2008 0:47 UTC (Fri)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/296109/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
if the scanner is only notified when mtime changes, then if the mtime doesn't change no notification will be sent out.<br>
<p>
I posted a proposal for a slightly different approach where instead of using mtime and a single 'clean' bit I suggested stealing a chunk of xattr namespace and have the kernel clear this namespace when the file was dirtied.<br>
<p>
this would let a scanner set a placeholder in the namespace to indicate that it was looking at the file, then when it was done it could check to see if the placeholder was still there, if so the file didn't change while it was being scanned and it's safe to mark it as scanned, if the placeholder is not there then you know the file changed and the scan you just did is worthless. <br>
<p>
by using a chunk of namespace you can also support multiple scanners (without them needing to know anything about each other)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296109/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296137"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2008 7:46 UTC (Fri)
                               by <b>njs</b> (guest, #40338)
                              [<a href="/Articles/296137/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Oh, I see.  Sure.  I was reading quickly and just assumed that anyone talking about "notify when the mtime changes" actually meant, "hook into the kernel's poke-that-file's-mtime routine so it sends a notification", whether the resulting mtime was modified or not.<br>
<p>
(In practice I'm pretty sure that the mtime *would* always be updated, though, because in linux, in-memory inodes always get nanosecond-accurate timestamps.  The extra resolution gets stripped away by the filesystem driver when the metadata gets pushed out to disk, but the actual data structures used in the core kernel don't care about that.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296137/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296194"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2008 16:45 UTC (Fri)
                               by <b>bfields</b> (subscriber, #19510)
                              [<a href="/Articles/296194/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>In practice I'm pretty sure that the mtime *would* always be updated, though, because in linux, in-memory inodes always get nanosecond-accurate timestamps.</blockquote>

<p>That's not true.  On a recent kernel try running a simple test program, that does e.g., write, stat, usleep(x), write, stat. You'll see that on ext2/ext3 "x" has to be at least a million (a second) before you see a difference in the two stats, and that on something like xfs, it has to be at least a thousand to ten thousand (a few milliseconds--the time resolution used is actually jiffies).

<p>(On older kernels I think the ext2/3 behavior might look like xfs's; that was fixed because of problems with unexpected changes in timestamps (due to lost nanoseconds field) when an inode got flushed out of cache and then read back.)
      
          <div class="CommentReplyButton">
            <form action="/Articles/296194/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296256"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2008 1:47 UTC (Sat)
                               by <b>njs</b> (guest, #40338)
                              [<a href="/Articles/296256/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I was aware of the issues with confusing timestamp changes, but didn't realize it had been changed.  Thanks.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296256/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor295913"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 10:27 UTC (Thu)
                               by <b>rvfh</b> (guest, #31018)
                              [<a href="/Articles/295913/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It usually takes me more than a second to compile-modify-compile, and I don't believe a file should change twice during a compilation. I would think the latter a bug.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295913/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor295916"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Wasn't LSM invented for this?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 10:34 UTC (Thu)
                               by <b>NAR</b> (subscriber, #1313)
                              [<a href="/Articles/295916/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't know much about the kernel security, but doesn't the LSM provide these hooks already?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295916/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296101"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Wasn't LSM invented for this?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2008 0:22 UTC (Fri)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/296101/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
no, LSM can approve or deny access, but it doesn't have hooks to do notification on status change from clean-&gt;dirty, it also doesn't have the ability to record the results of a scan so that the file doesn't need to be scanned on access<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296101/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor295940"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Threat Model</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 12:47 UTC (Thu)
                               by <b>skitching</b> (guest, #36856)
                              [<a href="/Articles/295940/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
People have been very scathing about the need for providing traditional windows-style virus-checking on Linux.<br>
<p>
I would certainly agree that "privilege escalation" problems are less common on Linux, and that the correct way to deal with these is through architectural fixes rather than trying to block programs that exploit a flaw. However it seems (in my uninformed view) that there are a large number of security issues that do not rely on privilege escalation at all.<br>
<p>
Case 1: A user visits an evil webpage. That webpage then exploits some browser flaw to drop a .so file on the local system and modify the user's .bashrc file to specify that file in LD_PRELOAD or similar.<br>
<p>
Case 2: A user downloads and runs a trojaned "game" of some sort that has been emailed to them. Yes they shouldn't, but there are more and more "innocent" users of Linux these days.<br>
<p>
<p>
Even without privilege escalation, an attack of this sort can do significant damage, including:<br>
* sending spam (when that user is logged in)<br>
* capturing user private data<br>
<p>
Won't a "virus scanning" solution help here, where the traditional Linux security approach will not?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295940/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor295980"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Threat Model</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 16:47 UTC (Thu)
                               by <b>bfields</b> (subscriber, #19510)
                              [<a href="/Articles/295980/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>Case 1: A user visits an evil webpage. That webpage then exploits some browser flaw to drop a .so file on the local system and modify the user's .bashrc file to specify that file in LD_PRELOAD or similar.</blockquote>

<p>Would you rather fix this with a browser patch, or with a scanner that, with great effort, tries to identify a few specific examples of such exploits?

<blockquote>Case 2: A user downloads and runs a trojaned "game" of some sort that has been emailed to them. Yes they shouldn't, but there are more and more "innocent" users of Linux these days.</blockquote>

<p>Again, do you want to get in the business of cataloging every single trojaned game, or would you rather, say, give users trusted game sources, or better tools for sandboxing the games they run?

<p>"Do both" is one possible answer, but I worry whether the obvious incentives for short-term bandaids may reduce the incentives for longer-term solutions.
      
          <div class="CommentReplyButton">
            <form action="/Articles/295980/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296002"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Threat Model</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 18:07 UTC (Thu)
                               by <b>bronson</b> (subscriber, #4806)
                              [<a href="/Articles/296002/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Remember the Sony rootkit.  Such a scanner would necessarily be large and very complex...  and quite flawed.  There's a very good chance that someone would arrange a successful attack against the scanner itself.<br>
<p>
Adding more layers of software is unlikely to ever reduce your attack surface.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296002/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor295997"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 18:26 UTC (Thu)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/295997/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The main problem I see with this is that it makes every untrusted file write a probable denial of service. If you can find a plain-text string that the scanner will reject, you can probably defeat fail2ban trivially by getting ssh to log that somebody tried to log in as {the reject string}, which means that the log file now contains a virus and can't be read by most programs. Or if you email a brand-new virus to root before the mailer is ready to reject it, and the system is using mail spools, all of root's mail is in a file containing a virus (once the description files get updated). If you get a virus into a backup, the backup becomes likely impossible to restore. If you post a virus to a web form that puts it into a database, the database may stop working.<br>
<p>
The assumption that, if a region of a file is unexpectedly blocked from being read, important system tools won't misbehave in exploitable ways is highly optimistic, considering that this currently only happens when the system has major hardware issues. I wouldn't be too surprised to hear about systems with scanning set up turning out to be vulnerable to a variety of attacks which cause the system to be unable to process security updates.<br>
<p>
In the Windows world, there are relatively few important helper processes, because services tend to be monolithic, so there's a relatively clear distinction between what should be prevented from using virus-infected files and what should be able to help clean them up. The UNIX world just isn't like that, making it unlikely that people will be able to have non-trivial policies that don't create security issues themselves.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/295997/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296043"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 20:11 UTC (Thu)
                               by <b>oak</b> (guest, #2786)
                              [<a href="/Articles/296043/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And if attacker knows that a widely used scanner has a security/DOS issue, <br>
he only needs to get a suitable file to the target machine through any <br>
channel (mail, browser cache, cookie etc).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296043/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor296063"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2008 21:56 UTC (Thu)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/296063/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I completely agree with you.<br>
<p>
I will go even farther: <br>
Suppose someone write a malware that include code from e.g. glibc. <br>
The antivirus vendor dutifully add that to the malware database,<br>
and all the Linux box get DOSed when they update their malware<br>
database.<br>
<p>
TALPA is a poorly thought out thread model that create more threats.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296063/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor296360"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 1, 2008 14:50 UTC (Mon)
                               by <b>kleptog</b> (subscriber, #1183)
                              [<a href="/Articles/296360/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
These arn't hypothetical problems either. On the postgresql lists there are regularly reports of people complaining that tables spontaneously vanish or worse, the transaction logs suddenly can't be written out. The cause is invariably that some antivirus has blocked the writes and uninstalling it fixes all the problems.<br>
<p>
There's enough safeguards to prevent data loss in most cases, but once the scanner starts violating write-order guarentees, the shit will really hit the fan.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296360/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296424"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 1, 2008 19:07 UTC (Mon)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/296424/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Wow. This highlights the need to be able to exclude stuff from antivirus <br>
scanning if anything does: what kind of idiot scans an RDBMS's data for <br>
viruses? This is as silly as searching a filesystem's *metadata* for <br>
viruses and banning only part of a metadata write if it thinks it finds <br>
one: instant disaster...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296424/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296441"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 1, 2008 21:10 UTC (Mon)
                               by <b>kleptog</b> (subscriber, #1183)
                              [<a href="/Articles/296441/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I suppose popular antivirus software comes with tables of stuff not to scan. Can you imagine the news if an antivirus product killed an Oracle installaion by helpfully renaming a datafile that looked suspicous.<br>
<p>
Generally you can configure the software to exclude certain directories from scanning, but the default is always scan everything unless told otherwise. On the whole violating FS semantics for some silly scanning software seems insane.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296441/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296454"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 1, 2008 22:03 UTC (Mon)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/296454/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Oh, I agree, but the existence of horrible things like Oracle*Mail <br>
indicates that if you think you have to scan everything that might, say, <br>
contain email that might be read by people using vulnerable clients, you <br>
have to add a virus scanner *inside the database* as well, to scan <br>
everything going to and from tables.<br>
<p>
Likewise you have to add a scanner inside everything else that maintains <br>
structured/transactioned data storage.<br>
<p>
Even discounting the security-brokenness of 'excluding the bad software', <br>
this obviously will not scale.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296454/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor296113"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2008 1:21 UTC (Fri)
                               by <b>njs</b> (guest, #40338)
                              [<a href="/Articles/296113/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Eric Paris proposed a fairly straightforwardthough still somewhat controversialmodel for the threats that TALPA is supposed to handle.</font>
<p>
It sounds like the threat model TALPA is designed for is actually a social engineering attack: AV vendors using "marketing" to convince companies to install poorly-engineered kernel-kluging software, with predictable results on reliability, support load, etc.
<p>
A cleaner approach would be to patch IT managers to be more resistant to this class of marketing attacks, but given the difficulty of field-upgrading such units and the poor success of previous attempts to fix this problem (non-<strike>execu</strike>acceptable gift policies, administrator phone number randomization, etc.), the threat mitigation provided by TALPA may represent a reasonable medium-term compromise.
      
          <div class="CommentReplyButton">
            <form action="/Articles/296113/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296262"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">TALPA strides forward</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2008 5:02 UTC (Sat)
                               by <b>flewellyn</b> (subscriber, #5047)
                              [<a href="/Articles/296262/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p><i>A cleaner approach would be to patch IT managers to be more resistant to this class of marketing attacks, but given the difficulty of field-upgrading such units and the poor success of previous attempts to fix this problem (non-execuacceptable gift policies, administrator phone number randomization, etc.),</i></p>

Okay, I just snorted water from laughing so hard.
      
          <div class="CommentReplyButton">
            <form action="/Articles/296262/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor296324"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">inotify?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 31, 2008 15:58 UTC (Sun)
                               by <b>liamh</b> (guest, #4872)
                              [<a href="/Articles/296324/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A quick scan of the events monitored makes it seem like an overlap of functionality with inotify.  As far as the hooks in the kernel are concerned, would it make more sense to use inotify, augmented appropriately if needed?<br>
<p>
Liam<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296324/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296486"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">inotify?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 2, 2008 7:42 UTC (Tue)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/296486/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
short answer, inotify doesn't scale.<br>
<p>
inotify works fairly well if you have a small set of files or directories that you want to look for changes in, but it doesn't work if you want to find out about changes throughout the filesystem<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296486/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296634"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">inotify?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 3, 2008 2:40 UTC (Wed)
                               by <b>liamh</b> (guest, #4872)
                              [<a href="/Articles/296634/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
OK.  Then wouldn't it make sense to make this effort be an inotify next generation (robust and scalable) project, thereby avoiding the issue of the eventual application(s)?  I use inotify now for something which has nothing to do with virus scanning, and I can imagine other applications as well, so perhaps there is a need for this anyway, quite apart from the scanners.  It seems like a bad idea to have two independent partially overlapping subsystems in the kernel.<br>
<p>
Liam<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296634/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296649"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">inotify?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 3, 2008 8:21 UTC (Wed)
                               by <b>njs</b> (guest, #40338)
                              [<a href="/Articles/296649/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There's been talk of such things (OS X has a similar scalable mixed kernel/user-space notification service that it uses for things like indexing), and it absolutely should be created for Linux -- but TALPA has requirements well beyond that.  Blocking read(2) until some other userspace process has woken up and okay'ed things is *way* outside the scope of an inotify-alike!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296649/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor296763"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">inotify?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 3, 2008 18:51 UTC (Wed)
                               by <b>jlokier</b> (guest, #52227)
                              [<a href="/Articles/296763/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Actually it's not so far away from inotify.<br>
<p>
We have leases in fcntl() F_SETLEASE, they go alongside dnotify in fcntl() F_NOTIFY.<br>
<p>
inotify could similarly benefit from an an ilease extension, as well as further scalability improvements.  (inotify was designed to improve on dnotify in many ways including scalability; it's a shame it stopped half way).<br>
<p>
That's blocking readers right there.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/296763/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2008, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
