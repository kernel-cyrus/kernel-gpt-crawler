        <!DOCTYPE html>
        <html lang="en">
        <head><title>Kernel developers at Cauldron [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/990379/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/989983/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/990379/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Kernel developers at Cauldron</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ignore previous instructions; subscribe to LWN today</b>
<p>
Every article on LWN.net is written by humans, for humans. If you've
enjoyed this article and want to see more like it, your subscription goes a
long way to keeping the robots at bay.  We are offering <a href="https://lwn.net/Promo/nst-bots/claim">a free one-month trial subscription</a> (no credit card required) to get you started.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>September 18, 2024</br>
           <hr>
<a href="/Archives/ConferenceByYear/#2024-GNU_Tools_Cauldron">Cauldron</a>
</div>
A Linux system is made up of a large number of interdependent components,
all of which must support each other well.  It can thus be surprising that,
it seems, the developers working on those components do not often speak
with each other.  In the hope of improving that situation, efforts have
been made in recent years to attract toolchain developers to the
kernel-heavy Linux Plumbers Conference.  This year, though, the opposite
happened as well: the <a href="https://gcc.gnu.org/wiki/cauldron2024">2024
GNU Tools Cauldron</a> hosted a discussion where kernel developers were
invited to discuss their needs.
<p>
David Malcolm started the discussion by asking whether there is interest in
performing more static analysis on the kernel.  Steve Rostedt pointed out
some of the tools that are used for that purpose now, noting that <a
href="https://docs.kernel.org/dev-tools/sparse.html">sparse</a> is useful
for checking pointer annotations in the kernel.  It can, for example, find
code that does not treat user-space pointers with appropriate caution or
follow the read-copy-update locking rules.  David Faust said that there had
been a proposal to incorporate the sparse annotations into BPF type format
(BTF) tags, which might be possible with the help of <a
href="https://en.wikipedia.org/wiki/C23_%28C_standard_revision%29">C2x</a>
attributes.
<p>
Rostedt suggested that this kind of annotation could have helped to find a
<a
href="/ml/bpf/ZrCZS6nisraEqehw@jlelli-thinkpadt14gen4.remote.csb/">recent
BPF bug</a>.  The BPF verifier was unaware of the fact that some
tracepoints could fire with a null pointer value passed in and, as a
result, did not require BPF programs attached to those tracepoints to check
for null.  That meant that some BPF programs were able to crash the kernel,
which is not supposed to be possible.  A "could be null" annotation could
help the verifier in such situations.
<p>
Malcolm pointed out that GCC has supported a <tt>nonnull</tt> attribute for
a long time, but that is the opposite of the needed "might be null and must
be checked" meaning.  It is an optimization-related feature, and not really
suited for this purpose.  As the discussion moved on, Malcolm said that he
had created <a href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=106358">a
tracker bug</a> on using GCC to run static analysis on the kernel.
<p>
José Marchesi brought up the topic of the struct layout randomization GCC
plugin that can be used to build the kernel.  There is a problem, in that
the randomization happens after the creation of debug data; if a
structure's layout is reordered, the debug information will be incorrect.
Clang, instead, orders the work correctly and does not have this problem.
Segher Boessenkool asserted that the plugin is simply broken, and Sam James
said that the plugin situation in general is "a mess".  There is evidently
a fix in circulation that depends on a new plugin hook for GCC.  But I
pointed out that the kernel project would like to move away from GCC
plugins entirely in favor of having the necessary features supported
directly by the compiler.  Fixing the plugin would be welcome, but
replacing it with a proper implementation would be better.
<p>
There was some discussion about the value of struct layout randomization in
general, with some calling it "security through obscurity".  Rostedt,
though, defended the technique as a useful way to limit the effectiveness
of exploits.  Bradley Kuhn said that there are some "serious licensing
issues" around some of the GCC plugins used by the kernel, with some users
getting "aggressive emails" from the original author of some of that work.
It would be far better, he said, to rewrite that functionality from
scratch, built into the compiler.
<p>
It was also mentioned that layout reordering could also be used to optimize
structures, eliminating internal holes.  Boessenkool pointed out that this
would violate the standard, which requires the address of a structure to be
equal to the address of its first element.  That seems like a price that
some users would be willing to pay for a useful (and optional) feature,
though.  This part of the discussion concluded that struct layout
reordering would be useful to have in GCC, but nobody said that they would
work to actually implement it.
<p>
Next on the list was the unwinding of user-space stacks in the kernel,
possibly by making use of <a href="/Articles/940686/">SFrame</a> data.
There is interest in possibly moving the kernel over to SFrame from the <a
href="/Articles/728339/">ORC</a> format used by the kernel now, Rostedt
said.  User-space unwinding would be useful for the generation of profiles
that include both the user and kernel sides of the equation.  It would be
implemented by setting a task flag in the kernel saying that a user-space
stack trace is needed; that trace would be generated just prior to
returning to user space from the kernel.
<p>
Creating that trace would require access to user-space SFrame data from
within the kernel, though.  That, in turn, could require the addition of a
system call for user space to provide that data.  To complicate things, the
SFrame situation could change rapidly over time, especially in processes
running a just-in-time compiler.  So perhaps the SFrame data would be
stored in a memory region that is shared between the kernel and user space,
eliminating the need to make a system call every time something changes.
<p>
The final topic that was discussed was a desire to obtain hints from the
compiler about functions that do not return or which contain jump tables.
As Josh Poimboeuf explained, this information is needed to make the
kernel's <tt>objtool</tt> utility work properly on 64-bit Arm systems;
that, in turn, is needed to support live patching.  Indu Bhagat said that
this information could be useful for some control-flow-integrity
applications as well.  The discussion wandered inconclusively for a while
after that, with no clear solution identified.
<p>
The session did not manage to address half of the potential subjects that
had been listed at the beginning.  It did show, though, that there is value
in getting groups of developers to talk with each other about their needs
and wishes.  The discussion will continue at the <a
href="https://lpc.events/event/18/sessions/180/#20240918">Linux Plumbers
Conference</a> in Vienna and, presumably, at future events as well.
<p>
[ Thanks to the Linux Foundation, LWN's travel sponsor, for supporting our
travel to this event. ]<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_tools">Development tools</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#GNU_Tools_Cauldron-2024">GNU Tools Cauldron/2024</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/990379/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor990745"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct address = first element address is relied on for pseudo-OO</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 18, 2024 15:00 UTC (Wed)
                               by <b>smcv</b> (subscriber, #53363)
                              [<a href="/Articles/990745/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Boessenkool pointed out that [reordering structs] would violate the standard, which requires the address of a structure to be equal to the address of its first element</span><br>
<p>
Keeping the first element at this position is necessary for the pseudo-object-orientation convention where a subclass struct starts with its superclass (as used in GLib and CPython among others), which is one of the few places where C allows aliasing between distinct types (aliasing is allowed if one type starts with the other):<br>
<p>
/* superclass */<br>
struct Vehicle { ... };<br>
<p>
/* subclass */<br>
struct Bicycle {<br>
    struct Vehicle parent;<br>
    struct Wheel *wheels[2];<br>
}<br>
<p>
struct Vehicle *vehicle = ...;<br>
<p>
if (my_object_system_is_a(vehicle, TYPE_BICYCLE)) {<br>
    struct Bicycle *bike = (struct Bicycle *) vehicle;<br>
    if (!bike-&gt;wheels[0]) {<br>
        warning("your front wheel has been stolen");<br>
    }<br>
}<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/990745/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor990774"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct address = first element address is relied on for pseudo-OO</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 18, 2024 22:10 UTC (Wed)
                               by <b>arsen</b> (subscriber, #161285)
                              [<a href="/Articles/990774/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
that doesn't matter in the case that we were discussing at cauldron since the struct randomization linux wants requires opting in on each struct (except for "vtable-y" structs consisting of purely function pointers).<br>
<p>
plus, this is kernel specific, so any arguments based on the C standard is moot IMO<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/990774/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor990858"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct address = first element address is relied on for pseudo-OO</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 19, 2024 11:54 UTC (Thu)
                               by <b>segher</b> (subscriber, #109337)
                              [<a href="/Articles/990858/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It is required for that yes, and for many other things.  It is hard to make a usefully defined struct layout without such guarantees, and this isn’t even considering the multiple full percents of performance loss reordering like this would cause!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/990858/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor990864"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct address = first element address is relied on for pseudo-OO</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 19, 2024 12:12 UTC (Thu)
                               by <b>segher</b> (subscriber, #109337)
                              [<a href="/Articles/990864/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yup, exactly, and a lot of code depends on this, sometimes implicitly or unexpectedly, and much more than how much code depends on the “compiled member order” to be the same as the source member order” in general!<br>
<p>
The kernel does a lot of similar trickery as well…<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/990864/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor993207"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 7, 2024 22:56 UTC (Mon)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/993207/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>Yup, exactly, and a lot of code depends on this, sometimes implicitly or unexpectedly, and much more than how much code depends on the “compiled member order” to be the same as the source member order” in general!</blockquote>

That's actually the motivation for the Rust compiler's nightly/experimental <code>-Z randomize-layout</code> flag... "Accessing those through avenues the compiler can't fix-up risks walking toward  forcing C++-style <em>de facto</em> ABI stabilization on the default Rust ABI, so we're pushing back against <a rel="nofollow" href="https://www.hyrumslaw.com/">Hyrum's Law</a>".

<p>If I remember correctly, the reason it's not on by default is because, while it doesn't apply to <code>#[repr(C)]</code> types, it's still no less at odds with reproducible builds.







      
          <div class="CommentReplyButton">
            <form action="/Articles/993207/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor993208"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 7, 2024 23:07 UTC (Mon)
                               by <b>segher</b> (subscriber, #109337)
                              [<a href="/Articles/993208/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No, this is something very different.<br>
<p>
There is a lot of code that depends on the actual semantics of C.  Not imagined semantics, or<br>
observed behaviour from some single single run on a single implementation: actual,<br>
guaranteed semantics.  Very useful semantics as well, in many ways.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/993208/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor993357"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2024 1:50 UTC (Wed)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/993357/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Of course. There's a reason one of the purposes of using #[repr(C)] in Rust is to turn off automatic struct packing.<br>
<p>
My point is that, with Rust's native ABI, "code [that] depends on this, sometimes implicitly or unexpectedly" is defined as broken and exempt from the stability promise, so they implemented a tool to help your test suite figure out if your code does.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/993357/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor993458"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2024 14:05 UTC (Wed)
                               by <b>segher</b> (subscriber, #109337)
                              [<a href="/Articles/993458/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
At least as long as you keep saying "sometimes" in there anyone sane will consider this utmost fallacy.  Sorry.<br>
<p>
It is a language ***guarantee***.  Users can depend on such things!<br>
<p>
(And making a language with even fewer guarantees is not the way forward imo, but that is a different discussion).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/993458/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor993555"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 10, 2024 8:51 UTC (Thu)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/993555/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Figuring out when your code assumes something is guaranteed that is in fact not guaranteed but just happens to be the same in your test runs is important though.<br>
<p>
And if you guarantee absolutely everything your code will become very brittle in the face of changes the world forces on others (e.g. if you guarantee something that won't hold on a new CPU architecture or with some new network protocol or crypto cipher) and it will be hard to perform any kind of optimizations on it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/993555/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor993603"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 10, 2024 12:06 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/993603/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; And if you guarantee absolutely everything your code will become very brittle in the face of changes the world forces on others</span><br>
<p>
As always, I think the wrong language is being used ... <br>
<p>
What developers used to do - maybe still should - is stick a bunch of "assert"s just after your function is called (to document your pre-requisites), and a similar bunch of asserts just before a return to document your post-requisites (call those guarantees if you like).<br>
<p>
Effectively you're saying "this is what I need to function correctly, this is what I guarantee if everything works as designed". To what extent that's massively comprehensive is down to you, but if somebody then comes and says "your function left this data structure in a mess", you can then go back and say "where's the assert that checks what you want?". If it's not in your code, "not your problem". If it is in your code, where the **** did it get corrupted?<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/993603/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor993688"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 10, 2024 18:55 UTC (Thu)
                               by <b>segher</b> (subscriber, #109337)
                              [<a href="/Articles/993688/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yup.  But here we specifically are talking about a language guarantee, which any developer will trust to be implemented correctly by the compiler (or the rest of the system) (except in the very exceptional cases where there is a bug of course, and finding it then can be interesting!)<br>
<p>
This is *the* core thing a compiler does.  Not trusting compiler developers to do their job is very offensive.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/993688/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor993720"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 11, 2024 7:56 UTC (Fri)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/993720/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not trusting them with things where they might make a mistake would be fine but you can't exactly check everything with asserts every time it comes up. Do you always check booleans to see if they are either True or False? Do you check every value for correct alignment? Do you check the order of fields in every struct to see if it is the expected order? That just doesn't make sense.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/993720/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor993727"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 11, 2024 9:08 UTC (Fri)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/993727/">Link</a>] 
      </p>
      
      </div>
      </summary>
      The "Sometimes" is purely a matter of four things:

<ol>
<li>You used <code>unsafe</code> and raw pointer access to circumvent their attempts to reliably give you an error message.</li>
<li>You ignored the docs for <code>unsafe</code> that told you that's not a supported mode of operation. (In the same way that you <em>can</em> write a kernel extension by writing bytes to <code>dev/kmem</code> but it's not supported.)</li>
<li>You didn't test the resulting code under Miri (Rust's Undefined Behaviour sanitizer built on their execution engine for running <code>const fn</code> in initializers).</li>
<li>They can't randomize the memory layout thoroughly enough to ensure your invalid code breaks outside of Miri without either making reproducible builds impossible or making performance un-competitive with C and C++.</li>
</ol>

You're well into "bringing a lawsuit against the park security guard for preventing you from climbing the fence to walk in front of the roller-coaster" territory.




      
          <div class="CommentReplyButton">
            <form action="/Articles/993727/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor990769"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definition of struct</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 18, 2024 18:06 UTC (Wed)
                               by <b>rweikusat2</b> (subscriber, #117920)
                              [<a href="/Articles/990769/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A structure type is defined as<br>
<p>
[...] a sequentially allocated nonempty set of member objects<br>
<p>
ie, it's not just the first defined element which has to be allocated first but also, the second has to be allocated second and so on. Some people would doubtlessly argue sequentially doesn't mean the sequence used by compiled code has to correspond to the sequence used on the source code in any way. OTOH, this would render the sequentially meaningless as different members have to be allocated one after another and hence, I don't think that's a valid argument.<br>
<p>
Real world code, eg, the Linux networking stack, also frequently uses C structs to represent protocol-defined structures like IP or TCP headers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/990769/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor990772"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definition of struct</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 18, 2024 20:04 UTC (Wed)
                               by <b>garyguo</b> (subscriber, #173367)
                              [<a href="/Articles/990772/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There is even a more clear explanation about this later at 6.7.2.1.13<br>
<p>
<span class="QuotedText">&gt; Within a structure object, the non-bit-field members and the units in which bit-fields</span><br>
<span class="QuotedText">&gt; reside have addresses that increase in the order in which they are declared. A pointer to a</span><br>
<span class="QuotedText">&gt; structure object, suitably converted, points to its initial member (or if that member is a</span><br>
<span class="QuotedText">&gt; bit-field, then to the unit in which it resides), and vice versa. There may be unnamed</span><br>
<span class="QuotedText">&gt; padding within a structure object, but not at its beginning.</span><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/990772/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor990801"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definition of struct</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 19, 2024 6:20 UTC (Thu)
                               by <b>riking</b> (subscriber, #95706)
                              [<a href="/Articles/990801/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The desire for the bug-crunching of struct layout randomization being in tension with the guaranteed layout algorithm of the major implementations is why Rust gained -Zrandomize-layout relatively quickly.<br>
<p>
Responding to some of the article text: Using struct layout randomization for security is wishful thinking. An attacker with an arbitrary read primitive can probe until they get enough information to figure out whether this kernel is the Fedora randomization or the Debian randomization or [...] and specialize the attack from there.<br>
The primary value of struct layout randomization is bug hunting, figuring out where encapsulation boundaries are being punched to do code crimes without permission, and also catching out-of-bounds writes that just happen to land inside the struct.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/990801/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor990850"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definition of struct</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 19, 2024 9:35 UTC (Thu)
                               by <b>rweikusat2</b> (subscriber, #117920)
                              [<a href="/Articles/990850/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Responding to some of the article text: Using struct layout randomization for security is wishful thinking. </span><br>
<p>
That's especially true because this is about compile-time reshuffling of struct members: For every individual binary, the struct layout will always remain fixed. It's just no longer possible to deduce it from reading the source. This has a strong smell of the old "It's insecure, because everyone can read the source!" argument to it, ie, that the problem is not that the code has exploitable bugs but that people who aren't very good at understanding machine code can perhaps find them.<br>
<p>
Given enough time, we'll doubtlessly see array indexing randomization as well and someone will claim to be convinced that this simply must be good for something. After all, it's going to be much more complicated than just mapping the array index 1 to the second element of the array!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/990850/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor992039"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definition of struct</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 27, 2024 15:21 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/992039/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's still valuable for distros that have users build the kernel themselves, perhaps from a distro-provided .config or an augmented version thereof. (Yes, maybe there aren't many of us, but they include every user of several whole distros, like gentoo.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/992039/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor990773"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">I wonder who would that be</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 18, 2024 22:04 UTC (Wed)
                               by <b>intelfx</b> (subscriber, #130118)
                              [<a href="/Articles/990773/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;  Bradley Kuhn said that there are some "serious licensing issues" around GCC plugins, with some users getting "aggressive emails" from the original author of some of that work</span><br>
<p>
Let me guess: the grsecurity guy?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/990773/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor990776"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Length of a feather</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 18, 2024 22:35 UTC (Wed)
                               by <b>sam_c</b> (subscriber, #139836)
                              [<a href="/Articles/990776/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wish we'd had more time to discuss the other (important!) topics, but I felt the session was productive. I think for future years, we should see about finding a way to allow longer BoFs on request. The session was only an hour and felt like it could've easily been twice that.<br>
<p>
On the upside, I think SFrames and the infra around them got a lot of thrashing out both in the corridors and Indu's talk and some progress is going forward there.<br>
<p>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/990776/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor990860"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Length of a feather</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 19, 2024 12:04 UTC (Thu)
                               by <b>segher</b> (subscriber, #109337)
                              [<a href="/Articles/990860/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There are about equally many BoFs as presentations now, so if we want longer BoFs, we’ll need more rooms.  Or maybe one or more of the BoFs can fit in the third room (the small room).  Or maybe we’ll need to make the Cauldron take four days!<br>
<p>
I guess this is a long way to say “it is not as easy as all that / we do our best” :-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/990860/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor992040"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Length of a feather</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 27, 2024 15:23 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/992040/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'd be surprised if there weren't more empty rooms around in the university :) perhaps some of them also don't have a tradeoff between being impossibly hot or having what sounds like a regiment of tanks driving by drowning out the speaker several times a minute. (I suspect I'm deafer than most attendees, though: maybe most people were fine with it.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/992040/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor992449"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Length of a feather</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2024 13:10 UTC (Tue)
                               by <b>segher</b> (subscriber, #109337)
                              [<a href="/Articles/992449/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That's not the point.  I already said that btw.<br>
<p>
Even with just *two* sessions at a time there already are conflicts where people want to attend two at the same time, or even *have to*.  The organisers have been happy to reschedule things where needed in previous years, but if we would have four rooms, such problems become unavoidable.<br>
<p>
It was not "impossible hot", rather cool even.  I did not notice any noise nuisance, neither directly nor did other people talk about it.<br>
<p>
I'm sure things could work better, but it was done quite well this year.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/992449/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2024, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
