        <!DOCTYPE html>
        <html lang="en">
        <head><title>Implementing eBPF for Windows [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/857215/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/859053/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/857215/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Implementing eBPF for Windows</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>This article brought to you by LWN subscribers</b>
<p>
Subscribers to LWN.net made this article &mdash; and everything that
       surrounds it &mdash; possible.  If you appreciate our content, please
       <a href="/Promo/nst-nag3/subscribe">buy a subscription</a> and make the next
       set of articles possible.
</blockquote>
<div class="GAByline">
           <p>June 10, 2021</p>
           <p>This article was contributed by  Quentin Monnet</p>
           </div>
<p><a href="https://ebpf.io/">Extended BPF (eBPF)</a>, the general-purpose
execution 
engine inside of the Linux kernel, has proved helpful for tracing and
monitoring the system, for processing network packets, or generally for
extending the behavior of the kernel. So helpful, in fact, that developers
working on other operating systems have been watching it. Dave Thaler and
Poorna Gaddehosur, on behalf of Microsoft, <a
href="https://cloudblogs.microsoft.com/opensource/2021/05/10/making-ebpf-work-on-windows/">recently
published an implementation of eBPF for Windows</a>. A Linux feature making
its way to Windows, in itself, deserves attention. Even more so when that
feature has brought new degrees of programmability to the Linux kernel over
the last few years. This makes it especially interesting to look at what the
new project can do, and to ponder how the current ecosystem might evolve as
eBPF begins its journey toward Windows.</p>

<h4>Gearing up with open-source components</h4>

<p>Simply named "eBPF for Windows", the project targets Windows 10 and
Windows Server 2016 (and later). It is not a fork of the Linux code,
presumably to avoid any GPL-related issues. Instead, Windows gets a
different implementation, but not from scratch. Microsoft's project relies
on pre-existing open-source components; it adds the missing pieces along
with the necessary shims to interconnect them and to integrate them with 
Windows internals. It is available from GitHub as <a
href="https://github.com/microsoft/ebpf-for-windows">ebpf-for-windows</a>,
under the MIT license.</p>

<p>One of those components is <a
href="https://github.com/iovisor/ubpf">uBPF</a>, an independent user-space
eBPF interpreter and an x86_64 just-in-time (JIT) compiler for eBPF.
In 2015, which was the early days for eBPF, uBPF was
introduced as a non-GPL implementation of the technology.
 It has seen little activity since then, but
several projects, including <a
href="https://doc.dpdk.org/guides/prog_guide/bpf_lib.html">DPDK</a>, reuse
its code. The Windows project pulls uBPF as a Git submodule, and <a
href="https://github.com/microsoft/ebpf-for-windows/blob/d765bd616dafb33aea19fd62bf0d9230fcd3720a/libs/ubpf/user/ubpf_user.c">literally
does a
<tt>#include</tt> of its code</a> to embed the interpreter and the
JIT compiler. uBPF only supports basic programs; the code in
ebpf-for-windows extends it, for example to implement eBPF maps and their related
helper functions.</p>

<p>The tooling side for handling eBPF programs on Windows should look
familiar to Linux users. The Clang/LLVM back-end remains the main
tool to compile programs written in C into eBPF bytecode
instructions. The <tt>netsh</tt> command-line tool, which offers program management
and introspection similar to some extent to <tt>bpftool</tt>, relies on a shared
library that should provide an API compatible with <a
href="https://github.com/libbpf/libbpf">libbpf</a>, thus ensuring the
portability of loader applications.</p>

<p>The last component used by the project is the <a
href="https://github.com/vbpf/ebpf-verifier">PREVAIL verifier</a>, which is
another
 Git submodule that gets pulled into ebpf-for-windows. PREVAIL was developed as
part of a research project involving VMware Research, and is best described
in the <a
href="https://vbpf.github.io/assets/prevail-paper.pdf">accompanying
publication</a> (note that some of the content is now
out-of-date). Unlike the Linux verifier, it relies on formal methods
to determine the safety of programs. It uses an <a
href="https://wiki.mozilla.org/Abstract_Interpretation">abstract
interpretation</a> layer that aggregates the states after several execution
streams rejoin, meaning that, for example, the states of the registers for
the different branches of an <tt>if</tt>/<tt>else</tt> block are merged
together at the end of that block to avoid producing too many combinations
of paths.
<p>
By contrast, the Linux verifier checks all paths independently:
two consecutive <tt>if</tt>/<tt>else</tt> blocks produce four paths to
explore, rapidly leading to a "path explosion". But the Linux verifier
mitigates this by "pruning" some parts of the paths that are known to be
safe, once they have been reached and validated from another branch.</p>

<p>PREVAIL is <a
href="https://github.com/vbpf/ebpf-verifier#counter-and-artificial-examples">claimed
to be better
at recognizing valid programs</a> than the Linux verifier, including programs with
loops. It also scales better with complexity, and can validate some
programs for which Linux would go over its limit of one-million validated
states, thus would fail verification. However, the Linux verifier
completes validation more quickly when it accepts a program, and consumes less
memory. It is also finely tailored to support all of the features that the
programs can use and their corner cases, while PREVAIL misses checks for
several elements like eBPF-to-eBPF function calls, packet reallocation
(when its size changes), or 32-bit subregister tracking. PREVAIL is under
active development, and Thaler is contributing to it along with the creator and
maintainer, Elazar Gershuni. Together they intend to address some of these
limitations: they recently added support for <a
href="https://github.com/vbpf/ebpf-verifier/commit/fdddca019166e3a8e6eaf6eb7ee4f920dfd50585">checking
termination</a> of eBPF programs.</p>

<h4>Taking marks</h4>

<p>Equipped with these components, eBPF for Windows provides a working eBPF
runtime. But the project is in its infancy. It brings support for <a
href="https://github.com/microsoft/ebpf-for-windows/blob/d724d3b079e771d814ffe2e3ce130a36bde3cd83/libs/api/windows_platform.cpp#L53">two
eBPF hooks</a>: XDP (for fast packet processing) and socket binding
(equivalent to <tt>BPF_CGROUP_INET4_BIND</tt> and other related attach
points on Linux). It implements the most basic <a
href="https://github.com/microsoft/ebpf-for-windows/blob/d724d3b079e771d814ffe2e3ce130a36bde3cd83/include/ebpf_helpers.h#L19">map
types</a>: arrays and hash maps.</p>

<p>The repository contains a few examples. The <a
href="https://github.com/microsoft/ebpf-for-windows/blob/2a928a6c717b2775345b74863858d12b453fa85c/docs/GettingStarted.md#using-ebpf-for-windows">Getting
Started guide</a> explains how to set up an XDP program to <a
href="https://github.com/microsoft/ebpf-for-windows/blob/2a928a6c717b2775345b74863858d12b453fa85c/tests/sample/droppacket.c">drop
UDP packets with an empty payload</a> in order to protect a DNS server
from UDP flood attacks. Another <a
href="https://github.com/microsoft/ebpf-for-windows/blob/2a928a6c717b2775345b74863858d12b453fa85c/tests/sample/bindmonitor.c">sample
program</a> attaches to the hook for socket binding, and <a
href="https://github.com/microsoft/ebpf-for-windows/blob/2a928a6c717b2775345b74863858d12b453fa85c/tests/end_to_end/end_to_end.cpp#L463">can
be configured</a> to enforce a limit on the number of sockets to which
processes can bind. The program increments or decrements per-process
counters (stored in a map) on bind and unbind operations.</p>

<h4>Picking a direction</h4>

<p>These samples are simple, but the project is just getting started: Where
is it heading? The authors made it clear in their blog post that they aim at
providing good compatibility with Linux eBPF:
"<q>The intent is to provide source code compatibility for code that uses
common hooks and helpers that apply across Operating System
ecosystems.</q>"

<p>Some existing hooks and helper functions, of course, are tightly linked
to Linux internals. Some features, like <a
href="/Articles/856005/">direct calls to kernel
functions</a>, will be downright dependent on the operating system. But for
the rest, the objective is to reach some level of parity with Linux, <a
href="https://github.com/microsoft/ebpf-for-windows/issues/206">including
for tracing</a> kernel and user-space functions by reusing, for example,
<a
href="https://docs.microsoft.com/windows-hardware/drivers/devtest/event-tracing-for-windows--etw-">Event
Tracing for Windows</a> or <a
href="https://en.wikipedia.org/wiki/DTrace">DTrace</a>. Tracing user applications can
probably work as they do for Linux.
<p>
Regarding kernel tracing, the two systems do not
have the same internal functions but, at least, through eBPF they should be
able to share a common way and workflow to attach probes. Interestingly,
the authors of the project already have a new hook in mind to <a
href="https://github.com/microsoft/ebpf-for-windows/blob/2a928a6c717b2775345b74863858d12b453fa85c/docs/eBpfFileSystemHookProposal.md">implement
file-system "mini-filters" with eBPF</a> on Windows. It seems likely that
they will add more in the future. In defining a common way to probe a
kernel, perhaps the program hooks themselves will end up as an
implementation detail if the eBPF workflow, tooling, and runtime has the
same capabilities on all systems and constitute the core of that
"interface".</p>

<p>Currently, the disparity in features translates into a number of issues
being opened on the GitHub repository. Contributions to the different
components will also be necessary. The authors have pushed some of their
changes to uBPF and have been contributing to PREVAIL for several months
already. It is worth noting how they <a
href="https://github.com/microsoft/ebpf-for-windows/issues/21">intend to
deal with maps</a>: they would like to reuse the implementation from <a
href="https://github.com/generic-ebpf/generic-ebpf">generic-ebpf</a>, which
is yet another uBPF-based runtime that <a
href="https://papers.freebsd.org/2018/bsdcan/hayakawa-ebpf_implementation_for_freebsd/">targets
FreeBSD in particular</a>.
<p>
Alan Jowett, from Microsoft, <a
href="https://github.com/microsoft/ebpf-for-windows/issues/21#issuecomment-823462378">summarized</a>
the project's
motivation as: "<q>Any code that could be generic should be moved to a
more generic project and pulled in via a sub-module.</q>"
This reads as an intent to upstream everything possible to uBPF,
PREVAIL, and possibly other projects in the future, so as to retain only
the minimal amount of shims in ebpf-for-windows and to make
the generic components reusable by other projects.</p>

<h4>The road ahead</h4>

<p>Ideally, most eBPF programs would behave the same way on Linux and
Windows. Some engineering effort will be necessary to reach that point. By
reimplementing an existing technology, Microsoft saves on the design process,
but it will have to catch up with the specific functionalities. There is
more than a 
simple instruction set to eBPF: it comes with many hooks, maps, helpers,
user space operations, and features like tail calls, function calls, <a
href="https://www.kernel.org/doc/html/latest/bpf/btf.html">BPF type format</a> (BTF) information,
and many others. uBPF lacks most of these. These items may gain support in
time, a fair portion of them should hopefully be generic enough to make
eBPF programs portable. Adding JIT compilers for new architectures should
not be a major issue, <a
href="https://git.dpdk.org/dpdk/tree/lib/bpf/bpf_jit_arm64.c">DPDK has one
for arm64</a> already. Any feature that relies on kernel BTF information
will likely be tied to an operating system, though.</p>

<p>Compatibility for the verifiers is another concern. Of all the design
choices for the Windows implementation, the use of PREVAIL is one of the most
interesting because it already has some advantages over
Linux. It accepts a larger range of valid programs and is less affected by
the path explosion, to the detriment of performance and exhaustiveness of
the checks. As a consequence, some programs may be considered valid only by
Linux, others only on Windows. This should provide an incentive to improve
the Linux verifier, to make it faster on complex sequences, and perhaps help
it validate more programs. Full parity will definitely be a challenge.</p>

<p>One may wonder how important it is to ensure cross-operating-system
compatibility for eBPF. For a start, Microsoft's interest in the technology
would likely be limited if it could not support existing programs.
The company could just as well develop its own solution, without
bothering to integrate external components. Portability will be necessary to
limit ecosystem fragmentation and, more generally, to warrant adoption on
Windows. It will be particularly important at a time when the generic-ebpf project
might benefit from the exposure and regain some activity.  That would provide support
on yet more systems and, since static linking <a
href="/ml/bpf/20210318194036.3521577-1-andrii%40kernel.org/">is
being</a> <a
href="/ml/bpf/20210423181348.1801389-1-andrii%40kernel.org/">introduced</a>
in libbpf, paving the way to the creation of eBPF libraries.</p>

<p>However, the effort cannot come from Microsoft alone. Synchronization
with the existing eBPF community will be essential to make the technology
progress in a way that all systems can support. On Linux, eBPF has been
used in production for some time, at scale, by big players like Facebook,
Google, and Netflix. It has been spreading over the Kubernetes ecosystem
for networking, observability, and security with projects like <a
href="https://cilium.io/">Cilium</a>. There is no way that Linux developers
will put eBPF "on hold" to wait for Windows. Thaler and Gaddehosur are
aware that a lot of communication will be required:</p>

<blockquote class="bq">
We are announcing this now while the project is still relatively early in
development because our goal is to work in collaboration with the robust
eBPF community to make sure that eBPF works great on Windows, and
everywhere else.
</blockquote>

<p>The project has a dedicated Slack channel named <tt>#ebpf-for-windows</tt> on
<a href="https://ebpf.io/slack">https://ebpf.io/slack</a>. <a
href="https://github.com/microsoft/ebpf-for-windows/issues/162">
Regular
meetings</a> are set up until July, at least, to triage and address the GitHub
issues. A dedicated mailing list should follow.</p>

<p>The degree of involvement that will come from Linux developers will be
decisive, but is hard to predict yet. The announcement of eBPF for Windows
is still fresh: there were comments on social networks (enthusiastic
overall, with a few expected mentions of the "embrace, extend, and
extinguish" strategy — Microsoft has a history), but little reaction has emerged
from the Linux world for now.</p>

<h4>The journey is just starting</h4>

<p>The "eBPF for Windows" project is ambitious but, in its early days, it
misses many features supported on Linux: some parity on program types, map
types, helpers, and other items will be required to make it viable. This
could explain the absence of a clear reaction from the Linux developers,
who may be waiting to see if the new implementation lives up to its
promise. To show that it does, the authors will need to catch up with
development to support more complex use cases on Windows. They must also
draw the interest and participation of more contributors, external to
Microsoft, if they want to ensure the success of the project.</p>

<p>If they succeed, developers may eventually benefit from eBPF code blocks
shared as libraries common to the two systems. User-space libraries,
tooling, applications, and compatibility test suites could be extended and
run across several environments. The eBPF ecosystem would then profit from
fresh ideas coming from the Windows world, and friendly competition will
hopefully
lead to performance improvements on both sides. As an optimistic vision for
the long term, assuming a common basis can be found to express equivalent
probes for both systems, eBPF programs might end up as some form of
control-plane API to manage networking and observability on different types
of
nodes. Such interfaces <a
href="https://github.com/cosi-project/community">are starting to emerge</a> in
cloud-native computing, and a cross-environment eBPF would likely play a
role in this.</p>

<p>Of course, there is much to accomplish before that; the project is just
starting. Yet, as it stands, this is already a formidable acknowledgment of
the benefits eBPF brought to Linux and of its potential for the future. The
realization of this potential will depend a lot on the dialogue and
synchronization between the different communities. eBPF has just stepped
outside of its Linux home to venture into the world.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#BPF">BPF</a></td></tr>
            <tr><td><a href="/Archives/GuestIndex/">GuestArticles</a></td><td><a href="/Archives/GuestIndex/#Monnet_Quentin">Monnet, Quentin</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/857215/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor859067"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 10, 2021 22:45 UTC (Thu)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/859067/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Microsoft should do the easy fix and just replace the NT kernel with Linux. This way they&#x27;ll easily be able to run all eBPF they want!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859067/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor859126"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 11, 2021 8:58 UTC (Fri)
                               by <b>amarao</b> (subscriber, #87073)
                              [<a href="/Articles/859126/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I told that story many years ago, and at that time it was a silly linux joke, but as time passes, it become more and more of a daring plan:<br>
<p>
MS starts to commit to the Kernel (already)<br>
MS become a core contributor to Wine.<br>
MS adopts Linux kernel (receiving a good docker/eBPF/nested KVM/etc support)<br>
MS sells Windows X as usual, which become a Linux kernel + Wine + proprietary assets (icons?) for OEMs to be installed on new machines.<br>
<p>
Users notice nothing, geeks are pleased by mass up-streaming of drivers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859126/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor859235"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 11, 2021 21:09 UTC (Fri)
                               by <b>atai</b> (subscriber, #10977)
                              [<a href="/Articles/859235/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
probably unlikely.  Microsoft needs the control of the OS kernel it uses.  It has the money to invest in evolving the NT kernel for new hardware.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859235/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor859296"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 12, 2021 1:16 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/859296/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why? <br>
<p>
NT kernel has a long history, but it&#x27;s severely hobbled by its design. It allows unparalleled backwards compatibility for drivers (I have a driver for a simple PCI device from 1998 that still compiles just fine) but it also imposes a lot of overhead. As a result filesystem performance on NT is a joke, scheduler is bad, memory management is at most adequate. Heck, MSSQL server for Linux works faster on the same hardware as MSSQL on Windows on most benchmarks.<br>
<p>
Even the driver situation is changing. I&#x27;ve recently benchmarked WiFi 6 performance on a couple of devices, and Linux won handily. To people scarred by NDISWrapper this is a bit of a shock.<br>
<p>
Microsoft certainly has money to invest into development of the kernel. But it&#x27;s not always money, it&#x27;s also people. Literally thousands developers work on improving Linux. Microsoft&#x27;s core kernel team is a fraction of that.<br>
<p>
Moreover, the value-add of Microsoft is not in the kernel itself. It&#x27;s in the userland software and more and more in cloud services. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859296/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor859582"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 14, 2021 13:37 UTC (Mon)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/859582/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; As a result filesystem performance on NT is a joke,</font><br>
<p>
Filesystem performance on NT is not impaired by backwards compatibility -- or, rather, backwards compatibility isn&#x27;t the main problem with it. NTFS was widely known as a dog even in the 90s before the backwards-compatibility burden emerged, and it has not got much better: indeed, MS spent a *lot* trying to replace it, overdesigned the replacement, WinFS, which failed (a shame, it was fascinating) and are still stuck with NTFS as a result.<br>
<p>
Backwards compatibility might be a problem as well, but this isn&#x27;t an example of it :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859582/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor859685"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 14, 2021 21:18 UTC (Mon)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/859685/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I have written a couple of filesystems for Windows. Including a simple in-memory one that doesn&#x27;t even touch the persistent storage. It was slower than ext3 on Linux.<br>
<p>
The issue is that for any request except the basic read/write ops Windows needs to create an IRP (I/O Request Packet) that is routed and filtered through multiple layers. So for example, you can attach filters that would change the file names. Or transparently encrypt the data and metadata as it&#x27;s being written. This also makes stuff like ransomware pretty easy to do.<br>
<p>
The downside is that this very abstract system is pretty slow.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859685/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor859890"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 15, 2021 19:07 UTC (Tue)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/859890/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
We had that on Unix once: STREAMS. Powerful, abstract... and slow. It&#x27;s a bit of a shame it didn&#x27;t stick around, but on free-software operating systems you can always just copy the filesystem and hack the source of the copy directly, so this degree of abstraction is fairly pointless.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859890/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor859090"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 11, 2021 3:30 UTC (Fri)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/859090/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The last 30y of NT and Win32 arent going away but it seems like at least half of all new development by MS over the next 10y is going to be out in the open on GitHub which, given their history, is amazeballs. Probably has a lot to do with the software market not being as reliable as renting computer time, but I&#x27;ll take it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859090/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor859120"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 11, 2021 8:20 UTC (Fri)
                               by <b>rsidd</b> (subscriber, #2582)
                              [<a href="/Articles/859120/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      I too find it surreal. But a few things happened over the last 15 years
<UL>
<LI>Microsoft completely missed the boat on mobile internet
<LI>and also on social media
<LI>and streaming and services
<LI>to the extent that, for some years now, people talk about the "big 4" (Amazon, Apple, Facebook, Google) and don't even seem to remember that Microsoft still exists
<LI>The botched acquisition of Nokia, Windows 8, Windows Mobile
<LI>Steve Ballmer was replaced by Satya Nadella.
</UL>
There is a very clear change of direction from Microsoft since Nadella took over, and Microsoft is becoming relevant again, in a good way, at the same time that Google's "Don't be evil" is beginning to sound like a bad joke. 
      
          <div class="CommentReplyButton">
            <form action="/Articles/859120/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor859238"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 11, 2021 21:35 UTC (Fri)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/859238/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>Indeed. Microsoft under Ballmer and Microsoft under Nadella are two radically different companies.</p>

<p>Corporations don't change just because they change CEO (think Apple: it was doing essentially the same things under Jobs as it does under Cook… minor details are different, yet direction is the same).

<p>But when corporations need to change — they often change the CEO to facilitate the change.</p>

<p>And after first decade of XXI century Microsoft needed that change because it missed so many opportunities and it's strategy clearly haven't worked.</p>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859238/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor859328"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 12, 2021 9:10 UTC (Sat)
                               by <b>zorro</b> (subscriber, #45643)
                              [<a href="/Articles/859328/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don&#x27;t know what to think of Microsoft these days. <br>
<p>
On the one hand they are doing great stuff with .NET and C#. But on the other hand they also seem to want to prevent .NET from becoming a credible platform for developing GUI applications that can run on Linux. <br>
<p>
And just when you think EEE is a thing of the past, they pull a stunt like this: <a href="https://medium.com/@keivan/the-day-appget-died-e9a5c96c8b22">https://medium.com/@keivan/the-day-appget-died-e9a5c96c8b22</a><br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859328/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor859125"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 11, 2021 8:46 UTC (Fri)
                               by <b>amarao</b> (subscriber, #87073)
                              [<a href="/Articles/859125/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Looks like the usual Microsoft roadmap:<br>
<p>
Embrace<br>
<font class="QuotedText">&gt; You are here &lt;</font><br>
Extend<br>
Extinguish<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859125/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor859195"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 11, 2021 14:17 UTC (Fri)
                               by <b>anmoch</b> (subscriber, #85760)
                              [<a href="/Articles/859195/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Should we call it eeeBPF then? ;-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859195/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor859247"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 11, 2021 22:23 UTC (Fri)
                               by <b>Paf</b> (subscriber, #91811)
                              [<a href="/Articles/859247/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, just like they did with *checks notes* Wine, and Linux on Azure, and Docker and ...<br>
<p>
It’s not the early 2000s any more.<br>
<p>
They don’t have that power, and they know it and the world knows it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859247/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor859152"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 11, 2021 13:06 UTC (Fri)
                               by <b>kleptog</b> (subscriber, #1183)
                              [<a href="/Articles/859152/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I understand that differences in verifiers might cause an issue, but I wonder whether many useful programs are such that verifiers would disagree about their validity. ISTM that 99.9% of useful eBPF programs are in the class of &quot;easily verified&quot;.<br>
<p>
I don&#x27;t have the impression that the Linux verifier is so limited that it causes lots of people to complain. Sure, it was annoying in the beginning, but is that still so?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859152/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor860165"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementing eBPF for Windows</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 17, 2021 18:37 UTC (Thu)
                               by <b>ecree</b> (guest, #95790)
                              [<a href="/Articles/860165/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Imho PREVAIL is classic academia: it&#x27;s got several fascinating ideas, some of which suggest productive avenues for improving the existing verifier, but ultimately the researchers made it work by limiting the scope of the problem to the part that their approach was good at.  Adding all the rest back in, to make it suitable for production use, will be difficult, because &#x27;the rest&#x27; is precisely the stuff that doesn&#x27;t fit the model.  eBPF verification is about much more than just abstract interpretation.  And, of course, the resource usage is concerning.<br>
<p>
As a piece of research, it&#x27;s very good.  But as a drop-in verifier for production systems it&#x27;s a square peg in a round hole, and I can&#x27;t help but feel that Microsoft used it because it was there and they needed *something*, rather than because it was a good choice.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/860165/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2021, Eklektix, Inc.<BR>
            
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
