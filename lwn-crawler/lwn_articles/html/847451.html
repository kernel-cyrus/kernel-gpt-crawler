        <!DOCTYPE html>
        <html lang="en">
        <head><title>5.12 merge window, part 2 [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/847451/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/847387/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/847451/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>5.12 merge window, part 2</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Benefits for LWN subscribers</b>
<p>
The primary benefit from <a href="/Promo/nst-nag5/subscribe">subscribing to LWN</a>
       is helping to keep us publishing, but, beyond that, subscribers get
       immediate access to all site content and access to a number of extra
       site features.  Please sign up today!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>March 1, 2021</br>
           </div>
The 5.12 merge window closed with the release of <a
href="/ml/linux-kernel/CAHk-=wjUzNbTuRCAv80vyD1dXEEaefdpRi23J+suSaognBoV8A@mail.gmail.com/">5.12-rc1</a>
on February&nbsp;28; this released followed the normal schedule despite the
fact that Linus Torvalds had been without power for the first six days
after 5.11 came out.  At that point, 10,886 non-merge changesets had found
their way into the mainline repository; about 2,000 of those showed up
after <a href="/Articles/847057/">the first-half merge-window summary</a>
was written.  The pace of merging obviously slowed down, but there were
still a number of interesting features to be found in those patches.
<p>

<h4>Architecture-specific</h4>
<p>
<ul class="spacylist">

<li> The RISC-V architecture has gained support for non-uniform memory
     access (NUMA) systems.  This architecture also now supports kprobes,
     uprobes, and per-task stack canaries.

</ul>


<p>
<h4>Core kernel</h4>
<p>
<ul class="spacylist">

<li> The <tt>kcmp()</tt> system call <a href="/Articles/845448/">can now
     be configured into the system</a> independently of the
     checkpoint/restore functionality.

</ul>

<p>
<h4>Filesystems and block I/O</h4>
<p>
<ul class="spacylist">

<li> <a href="/Articles/837566/">ID mapping for mounted filesystems</a>,
     which has seen several proposed implementations over the years,
     has been merged at last.  See <a
     href="https://git.kernel.org/linus/7d6beb71da3c">this merge
     message</a> for more information.  This functionality is currently
     supported by the FAT, ext4, and XFS filesystems.
<li> The NFS client implementation has gained support for "eager writes".
     When this option is enabled (at mount time), file writes are sent
     immediately to the server rather than sitting in the page cache.  This
     can reduce memory pressure on the client, provide immediate
     notification if the filesystem fills up, and can even evidently
     improve throughput for some workloads.
<li> The CIFS ("SMB") filesystem has a couple of new mount options to control the
     caching of file (<tt>acregmax</tt>) and directory (<tt>acdirmax</tt>)
     metadata.
</ul>

<p>
<h4>Hardware support</h4>
<p>
<ul class="spacylist">

<li> <b>Miscellaneous</b>:
     Playstation DualSense gamepads and force-feedback game controllers,
     Nintendo 64 game controllers,
     Nintendo 64 data cartridges,
     Intel Lightning Mountain centralized DMA controllers,
     Compute Express Link  2.0 type-3 memory devices,
     Broadcom VK accelerators,
     Qualcomm MSM8939 and SDX55 interconnect buses,
     Microchip AXI PCIe host bridges,
     Intel LGM SSO LED controllers, and
     Canaan Kendryte K210 reset controllers, pin control units, and clock
     controllers. 
<li> <b>Pin control</b>:
     R-Car V3U pin controllers,
     Allwinner H616 pin controllers, and
     Qualcomm SM8350 and SC8180x pin controllers.

</ul>

<p>
<h4>Miscellaneous</h4>
<p>
<ul class="spacylist">

<li> The user-space perf-events tools have gained a number of new
     features, including the ability to report on instruction latency and a
     new daemon mode for long-running sessions.  See <a
     href="https://git.kernel.org/linus/3a36281a1719">this merge
     changelog</a> for more information.

</ul>


<p>
<h4>Virtualization and containers</h4>
<p>
<ul class="spacylist">

<li> Support for the <a href="https://projectacrn.org/">ACRN</a> hypervisor
     has been added.

</ul>

<p>
<h4>Internal kernel changes</h4>
<p>
<ul class="spacylist">

<li> The build system now can use Clang's <a
     href="https://llvm.org/docs/LinkTimeOptimization.html">link-time
     optimization (LTO)</a> features on the Arm64 and x86 architectures.
     Android 
     builds have been using LTO for a while, but now this capability is in
     the mainline as well.  See <a
     href="https://git.kernel.org/linus/79db4d2293eb">this commit</a> and
     <a href="https://git.kernel.org/linus/dc5723b02e52">this commit</a>
     for (some) more information.
<li> The <tt>EXPORT_UNUSED_SYMBOL()</tt> and <a
     href="/Articles/171838/"><tt>EXPORT_SYMBOL_GPL_FUTURE()</tt></a>
     macros have been removed, since there have been no users of them in
     the kernel for years.
<li> A new memory-debugging tool called "kfence" has been merged; it can
     find a number of types of errors (use-after-free, buffer overflow,
     etc.) and features a low-enough overhead, it seems, to be usable on
     production systems.  See <a
     href="https://git.kernel.org/linus/10efe55f883f">this documentation
     commit</a> for more information.
<li> The core of the io_uring subsystem has been reworked to stop using
     kernel threads; instead, when work must be done in thread context, a
     new thread is forked from the calling process.  This should result in
     no user-visible changes other than, it is hoped, a reduction in bugs
     from the removal of some problematic kernel code.
</ul>
<p>

The 5.12 kernel has now entered the stabilization part of the development
cycle.  Unless something surprising happens, the final 5.12 release can be
expected on April&nbsp;18 or&nbsp;25.  Given that, seemingly, even
record-breaking winter storms are unable to slow down the pace of kernel
development, that something would have to be surprising indeed.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-5.12">Releases/5.12</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/847451/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor847863"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.12 merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2021 9:37 UTC (Tue)
                               by <b>patrakov</b> (subscriber, #97174)
                              [<a href="/Articles/847863/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Is there any reason why Btrfs does not support ID mapping?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/847863/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor847896"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.12 merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2021 15:44 UTC (Tue)
                               by <b>mss</b> (subscriber, #138799)
                              [<a href="/Articles/847896/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Probably nobody simply implemented this support yet.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/847896/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor847982"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.12 merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2021 23:58 UTC (Tue)
                               by <b>brauner</b> (subscriber, #109349)
                              [<a href="/Articles/847982/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The hope is to implement this real soon. A friend of mine and close collaborator has already expressed interest in porting btrfs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/847982/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor847877"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.12 merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2021 12:20 UTC (Tue)
                               by <b>karkhaz</b> (subscriber, #99844)
                              [<a href="/Articles/847877/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; A new memory-debugging tool called &quot;kfence&quot; has been merged; it can find a number of types of errors (use-after-free, buffer overflow, etc.) and features a low-enough overhead to, it seems, be usable on production systems. See this documentation commit for more information.</font><br>
<p>
Cool, looking forward to trying this out! This seems like a fairly low-effort way for testing new stable kernels before deploying them---compile the kernel with KFENCE and run various workloads on a test machine for some days, perhaps with KFENCE_NUM_OBJECTS and KFENCE_SAMPLE_INTERVAL set to much higher values to be able to show bugs up more quickly.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/847877/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor847954"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.12 merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2021 17:58 UTC (Tue)
                               by <b>melver</b> (subscriber, #134990)
                              [<a href="/Articles/847954/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
While KFENCE was designed to be deployed at scale and for our use-cases are looking at KFENCE_SAMPLE_INTERVAL &gt;= 500 milliseconds, I&#x27;m also aware of a KFENCE deployment where they chose KFENCE_SAMPLE_INTERVAL=1 ms (and lower with experimental patches) and very large KFENCE_NUM_OBJECTS (65535 -&gt; 512 MiB) and found bugs that way. For such aggressive configs, see what performance you get, but my guess is that at sample intervals as low as 1 ms, you&#x27;ll want to switch to KFENCE&#x27;s non-static-branch mode with CONFIG_KFENCE_STATIC_KEYS=n.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/847954/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor847893"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.12 merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2021 15:23 UTC (Tue)
                               by <b>alonz</b> (subscriber, #815)
                              [<a href="/Articles/847893/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">
&gt; idmapped mounts will be used in the
<br>&gt;     implementation of portable home directories in
<br>&gt;     systemd-homed.service(8) where they allow users to move their home
<br>&gt;     directory to an external storage device and use it on multiple
<br>&gt;     computers where they are assigned different uids and gids. This
<br>&gt;     effectively makes it possible to assign random uids and gids at
<br>&gt;     login time.
</font>
<p>
I can already see the consternation this will cause with various folks... "<strong>Random</strong> UID? WTF??!?"
<br>
I'm not sure how systems will adapt to such a situation, but (once the bugs are ironed out) I am certain this will aid security, at least slightly.
      
          <div class="CommentReplyButton">
            <form action="/Articles/847893/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor849320"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.12 merge window, part 2</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2021 19:17 UTC (Sun)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/849320/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The NFS client implementation has gained support for &quot;eager writes&quot;.</font><br>
<p>
I&#x27;m slobbering at this. I&#x27;ve always been unhappy at the fact that lazy writeback on NFS clients essentially waits for *two* rounds of writeback (once on the client, then once on the server) and discards any write errors even more badly than lazy writeback on local filesystems already does (-ENOSPC is the big one, but not the only one).<br>
<p>
Time to flip on write=wait everywhere as soon as it&#x27;s supported (I have a mixture of machines where -ENOSPC would mean data loss, and machines on 10GbE where it seems most unlikely that write=wait would incur any slowdowns).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/849320/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2021, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
