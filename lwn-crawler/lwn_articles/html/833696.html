        <!DOCTYPE html>
        <html lang="en">
        <head><title>The ABI status of filesystem formats [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/833696/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/833796/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/833696/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>The ABI status of filesystem formats</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>October 8, 2020</br>
           </div>
One of the key rules of Linux kernel development is that the ABI between
the kernel and user space cannot be broken; any change that breaks
previously working programs will, outside of exceptional circumstances, be
reverted.  The rule seems clear, but there are ambiguities when it comes to
determining just what constitutes the kernel ABI; tracepoints are <a
href="/Articles/799262/#tp">a perennial example</a> of this.  A recent
discussion has 
brought another one of those ambiguities to light: the on-disk format of Linux
filesystems.
<p>
Users reporting kernel regressions will receive a varying amount of
sympathy, depending on where the regression is.  For normal user-space
programs using the system-call API, that sympathy is nearly absolute, and
changes that break things will need to be redone.  This view of the ABI
also extends to the virtual filesystems, such as <tt>/proc</tt> and sysfs,
exported by the kernel.  Changes that break things are deemed a little more
tolerable when they apply to low-level administrative tools; if there is
only one program that is known to use an interface, and that program has
been updated, the change may be allowed.  On the other hand, nobody will
be concerned about changes that break out-of-tree kernel modules; the
interface they 
used is considered to be internal to the kernel and not subject to any
stability guarantee.
<p>
But those are not the only places where user space interfaces with the
kernel.  Consider, for example, <a
href="/ml/linux-kernel/20201005081454.GA493107@localhost/">this regression
report</a> from Josh Triplett.  It seems that <a
href="https://git.kernel.org/linus/e7bfb5c9bb3d">an ext4 filesystem bug
fix</a> merged for 5.9-rc2 breaks the mounting of some ext4 filesystems
that he works with.
<p>
These filesystems are created for some unspecified internal
purpose with an unreleased internal tool.  They are meant to be read-only,
so there will never be any need (or ability) to create new files on them.  As a
space-saving measure, this tool overlays all of the block and inode bitmaps
onto a single block, set to all ones, indicating that all blocks and inodes
are already allocated.  To indicate that this has been done, this tool
marks the filesystem with a special flag
(<tt>EXT4_FEATURE_RO_COMPAT_SHARED_BLOCKS</tt>).  This flag is defined by
the ext4 tools, but is not used by the kernel in any way.  It is placed in
the set of read-only compatibility flags, though, meaning that a kernel that
sees it in a filesystem will know that said filesystem can be safely
mounted, but only in read-only mode.
<p>
Until 5.9-rc2, mainline kernels were happy to mount these filesystems.  The
commit highlighted by Triplett changed that situation by adding some checks
to the mount-time ext4 verifier that ensures that the filesystem
image is valid.  As a result of these new checks, the overlapping bitmaps are
detected, the kernel 
complains, and any attempt to mount the filesystem fails.  Something that
used to work no longer does â€” the definition of a regression.  Triplett
included in his report a small patch that disables the validity check when
the <tt>EXT4_FEATURE_RO_COMPAT_SHARED_BLOCKS</tt> flag is present,
rendering his filesystems mountable again.
<p>
That change is likely to be merged, but it has not brought great joy to the
filesystem developers, who see it as a sign of things going wrong.  XFS
maintainer Darrick Wong <a 
href="/ml/linux-kernel/20201006025110.GJ49559@magnolia/">argued</a> that
"unofficial" filesystem variants should not be supported:
<p>
<div class="BigQuote">
	I disagree; creating undocumented forks of an existing ondisk
	format (especially one that presents as inconsistent metadata to
	regular tools) is creating a ton of pain for future users and
	maintainers when the incompat forks collide with the canonical
	implementation(s).
</div>
<p>
Triplett <a
href="/ml/linux-kernel/20201006050306.GA8098@localhost/">responded</a> that
filesystem images should fall within the realm of the kernel ABI:
<p>
<div class="BigQuote">
	I was generally under the impression that mounting existing root
	filesystems fell under the scope of the kernel&lt;-&gt;userspace or
	kernel&lt;-&gt;existing-system boundary, as defined by what the kernel
	accepts and existing userspace has used successfully, and that
	upgrading the kernel should work with existing userspace and
	systems. If there's some other rule that applies for filesystems,
	I'm not aware of that.
</div>
<p>
Ext4 maintainer Ted Ts'o <a
href="/ml/linux-kernel/20201006133533.GC5797@mit.edu/">said</a> that he 
was not opposed to Triplett's patch, but suggested that further patches to
support this tool might receive a chillier reception.  He then
told the story
of the <tt>make_ext4fs</tt> tool, an independently written ext4
filesystem creator used for years by Android.  It created a long list of
compatibility and corruption problems, he said, that took years to iron
out.  Third-party filesystem tools are prone to such problems, he said:
<p>
<div class="BigQuote">
	As far as I'm concerned, it's not just about on-disk file system
	format, it's also about the official user space tools.  If you
	create a file system which the kernel is happy with, but which
	wasn't created using the official user space tools, file systems
	are so full of state and permutations of how things should be done
	that the opportunities for mischief are huge.
</div>
<p>
Filesystem developers have a certain natural aversion to "mischief", so it
is unsurprising that Ts'o would prefer that these outside tools simply not
exist.  At a minimum, he suggested, future policy should say that
filesystem-image regressions would only need to be addressed for images
that were created and managed by the designated official tools.  He
requested that Triplett find a way to get rid of his custom tool.
<p>
Triplett <a
href="/ml/linux-kernel/20201007080304.GB1112@localhost/">disagreed</a> with
that policy suggestion,
saying that a more reasonable approach would be that any filesystem images
that pass the 
<tt>e2fsck</tt> checker should be supported.  Not all tools that work with
the ext4 format should have to live in the e2fsprogs repository; to say
otherwise, he added, would be tantamount to saying that the FreeBSD kernel,
which has an ext4 filesystem driver, should live in e2fsprogs too.  The
tool in question here, which Triplett finally <a
href="/ml/linux-kernel/20201007201424.GB15049@localhost/">described</a>
late in the conversation, appears equally unsuited to inclusion in the
e2fsprogs repository.  
<p>
Triplett concluded that message with a restatement of his request:
<p>
<div class="BigQuote">
	The *only* thing I'm asking, here, is "don't break things that
	worked".  And after this particular item, I'd be happy to narrow
	that to "don't break things that e2fsck was previously happy with".
</div>
<p>
<a href="/ml/linux-kernel/20201008021017.GD235506@mit.edu/">Ts'o's
response</a> made it clear that he is uninclined to grant that wish; that
would, he said, make it impossible to fix security-related problems related
to invalid filesystem images, of which there are many.  Many of these
invalid images â€” often generated by fuzzing tools or attackers â€” pass
<tt>e2fsck</tt> until the problems are found and fixed.  Grandfathering in
any image that passes <tt>e2fsck</tt> would thus, he said, require invalid
filesystems to be supported forever.  He concluded with some suggestions
for other ways to solve Triplett's problem and requested that Triplett work
more closely with the ext4 developers in the future.

<p>
As of this writing, that is where the discussion has stopped.  Ts'o's
willingness to apply the fix for the immediate problem means that there is
no pressing need to resolve the larger issue of regressions involving
filesystems; that, in turn, means that the issue is likely to come up again
at some point.  The kernel ABI is a large and amorphous thing, and many of
the boundaries are fuzzy at best.  Filesystems are one area where that
boundary has not yet been fully explored; somebody is likely to
inadvertently end up on the wrong side of it sooner or later.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_model-User-space_ABI">Development model/User-space ABI</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems-ext4">Filesystems/ext4</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/833696/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor833811"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 8, 2020 17:46 UTC (Thu)
                               by <b>sbaugh</b> (guest, #103291)
                              [<a href="/Articles/833811/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Triplett&#x27;s library sounds interesting and somewhat-generally-useful, actually. Repeating the description here:<br>
<p>
<font class="QuotedText">&gt;The short version is that I needed a library to rapidly turn</font><br>
<font class="QuotedText">&gt;dynamically-obtained data into a set of disk blocks to be served</font><br>
<font class="QuotedText">&gt;on-the-fly as a software-defined disk, and then mounted on the other</font><br>
<font class="QuotedText">&gt;side of that interface by the Linux kernel. Turns out that&#x27;s *many</font><br>
<font class="QuotedText">&gt;orders of magnitude* faster than any kind of network filesystem like</font><br>
<font class="QuotedText">&gt;NFS. It&#x27;s slightly similar to a vvfat for ext4. The less blocks it can</font><br>
<font class="QuotedText">&gt;generate and account for and cache, the faster it can run, and</font><br>
<font class="QuotedText">&gt;microseconds matter.</font><br>
<p>
It&#x27;s an unusual use case, but it doesn&#x27;t seem like one which is totally unacceptable. I could imagine using it myself. It would be nice to see it upstreamed to e2fsprogs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833811/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833828"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 8, 2020 19:51 UTC (Thu)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/833828/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Agree 100% there. I&#x27;m not sure I would want to push e2fsprogs to support it, but it sounds precisely as something much more useful then author who made this tool thinks.<br>
<p>
I only hope that&#x27;s not something which differentiates the product which he is developing from other such tools and it could be open-sourced and shared.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833828/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor833987"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 11, 2020 21:23 UTC (Sun)
                               by <b>WolfWings</b> (subscriber, #56790)
                              [<a href="/Articles/833987/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
...this seems like they&#x27;re simply using the wrong filesystem entirely. ROMFS has been around since somewhere in the 2.6&#x27;s and compiles down to literally a couple kilobytes of total binary size in most cases.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833987/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor833812"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 8, 2020 18:04 UTC (Thu)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/833812/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
My 2Â¢ (which should not count for much, seeing as I am neither a Linux developer nor someone who regularly works with filesystem images):<br>
<p>
This problem would be a lot easier if ext4 had a formal specification saying &quot;This is what a valid filesystem should look like.&quot; I&#x27;m not really happy with the idea that &quot;valid&quot; just means &quot;something you got from mke2fs(8).&quot; Obviously, people are going to want to do experimental things that are not within the scope of a general-purpose tool like mke2fs. A formal spec would help to delimit the lines between &quot;weird, but supported&quot; and &quot;don&#x27;t do that, or else you&#x27;re on your own.&quot;<br>
<p>
I get the sense that some developers* don&#x27;t like formal specs. A formal spec does not need to be huge or complicated like the C or POSIX standards; it could just be a short description of what e2fsprogs currently expects and supports, in plain and simple language. In fact, I imagine they could take <a href="https://www.kernel.org/doc/html/latest/filesystems/ext4/index.html">https://www.kernel.org/doc/html/latest/filesystems/ext4/i...</a>, sweep it for bugs, ambiguities, or outdated information, and then slap a &quot;this is the formal spec&quot; notice on it. This would not necessarily be easy (ambiguities in particular are hard to find and hard to fix), but it wouldn&#x27;t require convening a huge standards committee or something ridiculous like that.<br>
<p>
* This is not a reference to any individual, and it is especially not a reference to Mr. Ts&#x27;o. I do not know what Mr. Ts&#x27;o thinks of formal specs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833812/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833837"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 8, 2020 20:49 UTC (Thu)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/833837/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Format specification only works for simple data structures. Look on C++: it has formal spec, ISO-approved oneâ€¦ yet discussions about if something is a valid C++ or not is not uncommon.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833837/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833842"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 8, 2020 22:10 UTC (Thu)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/833842/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
C++ is an extreme example. Filesystem formats are vastly simpler than C++. We know how to write formal specifications for quite complicated things.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833842/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor833872"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2020 7:11 UTC (Fri)
                               by <b>bangert</b> (subscriber, #28342)
                              [<a href="/Articles/833872/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A formal spec is not the panacea that one may be inclined to assume. <br>
<p>
The way i see it, the only thing a formal spec does is to force upon (someone) to take ALL discussions about the subject of the article up front. That&#x27;s practically impossible to get right and specifically when done well takes a huge amount of effort. If the developers were forced to do it, it would consume their time for a very long time - if someone else were to do it it would/could have a higher degree of defects.<br>
<p>
You are highly likely to just debate the formal specification instead of the implementation.<br>
<p>
While these objections apply to many situations the extra effort a formal spec introduces is worth it in (some|other) cases.<br>
<p>
And although the conclusion of the article, that this subject will likely be discussed again, may be true, that is not in itself a bad thing (and the article does not say so). <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833872/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833884"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2020 10:33 UTC (Fri)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/833884/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One nice thing about really formal specs (as opposed to careful English specs, which aren&#x27;t really formal) is that for many specification languages you can find (or write) tools that leverage the specs to do useful work. For example, for a language like Alloy, fuzzing and model-checking tools can automatically generate testcases that are valid according to the spec and exercise all or most of the interesting edge cases (including many that the spec authors didn&#x27;t think of).<br>
<p>
You may also be able to prove useful consistency properties from the spec, e.g. that a &quot;valid&quot; filesystem doesn&#x27;t have unaccounted-for blocks, etc.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833884/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833885"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2020 10:35 UTC (Fri)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/833885/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What I meant to add was: if you write formal specifications the right way, you can use these tools to get more value out of the spec, which tilts the cost/benefit tradeoff towards formal specifications.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833885/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor834102"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2020 3:29 UTC (Tue)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/834102/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The way i see it, the only thing a formal spec does is to force upon (someone) to take ALL discussions about the subject of the article up front. </font><br>
<p>
No, you can write a spec that formalizes an implementation. This is how most RFCs are written.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834102/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor833961"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 10, 2020 19:43 UTC (Sat)
                               by <b>error27</b> (subscriber, #8346)
                              [<a href="/Articles/833961/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The problem is that we don&#x27;t care about a spec, we care about &quot;User space used to work and now it doesn&#x27;t.&quot;  So the fix is to program a lot of validation into the kernel so that Josh&#x27;s filesystem never works from square one.  If it never worked to begin with then it can never be broken.  It&#x27;s a lot of work to code this and it doesn&#x27;t necessarily make Josh any happier.<br>
<p>
So probably that approach is a waste of time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833961/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833985"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 11, 2020 19:55 UTC (Sun)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/833985/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; So probably that approach is a waste of time.</font><br>
<p>
I find this remark deeply confusing, so much so that I think I must have misunderstood you.<br>
<p>
I proposed creating a formal spec, and declaring that to be the defining line of &quot;what the kernel is prepared to support.&quot; In response to this, you described what happens if you don&#x27;t have a spec and/or don&#x27;t care about said spec, and then ambiguously said &quot;that approach is a waste of time.&quot;<br>
<p>
It sounds as if you were trying to refute my suggestion, but your argument before this line appears to *agree* with me, because it describes problems that arise when you don&#x27;t have a spec. So, if you could clarify your position, that would help me to understand your argument a lot better.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833985/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834019"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 12, 2020 13:46 UTC (Mon)
                               by <b>error27</b> (subscriber, #8346)
                              [<a href="/Articles/834019/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I didn&#x27;t mean writing a spec is a waste of time.  Specs are good because they encourage rigorous thinking.  I meant it would be very difficult and a waste of time to try detect filesystems like Josh&#x27;s in advance and prevent them from mounting.<br>
<p>
But although specs have their uses, in the kernel, specs cannot work in the way you have said.  The rule is never &quot;You can&#x27;t break the spec.&quot;  The rule is &quot;You can&#x27;t break userspace.&quot;<br>
<p>
Here is an example.  Ten years ago glibc changed memcpy(). <a href="https://lwn.net/Articles/414467/">https://lwn.net/Articles/414467/</a>  The spec said that the new implementation of memcpy() was valid but kernel developers find this attitude rage inducing.  We would never do that in the kernel.  You could theoretically still change memcpy(), but first you would have to fix all the applications that rely on the old behavior.<br>
<p>
In the glibc example, it&#x27;s not the flash developers who suffered, it&#x27;s the regular Linux users.  For the users, they had a program which worked and now it doesn&#x27;t work.  They don&#x27;t care about specs.  As kernel developers we care about users first and the spec second.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834019/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor833827"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 8, 2020 19:45 UTC (Thu)
                               by <b>Yenya</b> (subscriber, #52846)
                              [<a href="/Articles/833827/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There are filesystems which are designed to be read-only, such as ISO9660. Why abuse ext4?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833827/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833833"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 8, 2020 20:19 UTC (Thu)
                               by <b>sfeam</b> (subscriber, #2841)
                              [<a href="/Articles/833833/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
&quot;There are filesystems which are designed to be read-only, such as ISO9660. Why abuse ext4?&quot;<br>
<p>
Choosing a different filesystem might lessen Ts&#x27;o&#x27;s personal stake in the push-back but the same general arguments and principles would apply to any filesystem, right?  The most solid argument Ts&#x27;o raises is that a read-only file system may still be a malware vector if the kernel code handling it fails to consider some edge case or unforeseen content in a data structure.  Any patch to fix that vulnerability could hypothetically break an out-of-tree application that had been relying on the previous behavior.  Is that to be considered a regression or not?  In fact the general argument applies even if the filesystem is not read-only.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833833/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833834"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 8, 2020 20:23 UTC (Thu)
                               by <b>Yenya</b> (subscriber, #52846)
                              [<a href="/Articles/833834/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, a read-only by-design filesystem would not need a bitmap of free blocks and free inodes. And being able to make the r/only filesystem smaller for the same amount of data makes sense, unlike that abuse of ext4.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833834/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor833851"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2020 1:14 UTC (Fri)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/833851/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But that argument even applies to e2fsprogs itself. How do we know there isn&#x27;t some weird combination of flags you can pass to tune2fs or mke2fs which somehow makes an evil filesystem? At that point, you would have to break e2fsprogs backcompat anyway. This is probably a lot less *likely* than the &quot;some third-party tool generates a weird filesystem image&quot; case, but some of those third-party tools are actually rather popular (e.g. the article mentions FreeBSD), and breaking them would also be unfortunate. So I&#x27;m not sure how much sense it makes to draw a bright line around e2fsprogs as the single point of compatibility.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833851/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor833862"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2020 3:45 UTC (Fri)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/833862/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
ISO 9660 has a standard formally specifying it. That means you can decide whether a given file system image is valid, and if the kernel doesnâ€™t work with a valid image, that is clearly a kernel bug. So no, it doesnâ€™t quite have the same general problem as ext4. <br>
<p>
In principle the point still stands: there could be a bug in the kernel code when handling a malformed file system image, and that bug could cause security problems, yet somebody might be relying on the exiting behaviour because they use one of these malformed images. But that seems much less likely with ISO 9660, partly because itâ€™s much simpler than ext4, and partly because itâ€™s understood by many different OSes, so youâ€™d soon find out if your image depended on a Linux-specific quirk. <br>
<p>
I have a CD-ROM thatâ€™s meant to be in ISO 9660 format but many of the filenames contain the / character. Linux does not handle this well. But itâ€™s clearly incorrect by the standard, so you can say this is no bug in Linux. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833862/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833870"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2020 6:38 UTC (Fri)
                               by <b>Yenya</b> (subscriber, #52846)
                              [<a href="/Articles/833870/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, my (rhetorical) question was, why Josh Triplett even decided to use this &quot;optimized&quot; ext4 image instead of going for some filesystem which is read-only by design. Not whether there can arise the same kind of problems with ISO 9660.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833870/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833882"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2020 8:06 UTC (Fri)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/833882/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, I wasn&#x27;t replying to your comment, but to sfeam&#x27;s one.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833882/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor833888"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2020 12:02 UTC (Fri)
                               by <b>eru</b> (subscriber, #2753)
                              [<a href="/Articles/833888/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      &gt;<i>There are filesystems which are designed to be read-only, such as ISO9660. Why abuse ext4?</i>
<p>
Maybe he needed a file system that supports all features expected of a native Linux file system. ISO9660 does not qualify. (But squashfs would? It would also automatically save space).
      
          <div class="CommentReplyButton">
            <form action="/Articles/833888/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833988"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 11, 2020 21:27 UTC (Sun)
                               by <b>WolfWings</b> (subscriber, #56790)
                              [<a href="/Articles/833988/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
SquashFS _requires_ compression, so there&#x27;d be a compression -&gt; decompression layer involved. CRAMFS has a ~256MB total size limit. ROMFS is 32-bit so it&#x27;d run into obstacles around the 4GB mark (or maybe 2GB, I don&#x27;t think it&#x27;s been tested for &gt;2GB total size to my knowledge) but it would be the lightest weight option IMHO.<br>
<p>
But this does boil down to they were abusing an invalid filesystem data structure configuration that was not previously checked. That they were declaring that a particular flag marked the filesystem as such a monstrosity doesn&#x27;t change that they were laying multiple copies of a data structure on top of each other instead of pushing upstream for a proper &quot;read only&quot; flag that did away with those structures entirely is the core invalidity.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833988/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834152"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 13, 2020 15:30 UTC (Tue)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/834152/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What about EROFS? It doesn&#x27;t look very complicated, but it does appear to support most things you might reasonably want to do.<br>
<p>
<a href="https://www.kernel.org/doc/html/latest/filesystems/erofs.html">https://www.kernel.org/doc/html/latest/filesystems/erofs....</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834152/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834566"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 16:19 UTC (Sun)
                               by <b>WolfWings</b> (subscriber, #56790)
                              [<a href="/Articles/834566/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Oh, yup, I&#x27;d missed that one going through the main filesystems, that one looks to nail it and he &quot;ROMFS but a full Linux filesystem&quot; so it&#x27;s just about ideal.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834566/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor834702"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 20, 2020 5:38 UTC (Tue)
                               by <b>eru</b> (subscriber, #2753)
                              [<a href="/Articles/834702/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>Squashfs, unlike cramfs, does not have problematic size limitations: "Files up to 2^64 bytes are supported; file systems can be up to 2^64 bytes" (<a href="https://tldp.org/HOWTO/SquashFS-HOWTO/whatis.html">https://tldp.org/HOWTO/SquashFS-HOWTO/whatis.html</a>).
      
          <div class="CommentReplyButton">
            <form action="/Articles/834702/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor835337"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why ext4?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 26, 2020 20:57 UTC (Mon)
                               by <b>mina86</b> (guest, #68442)
                              [<a href="/Articles/835337/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
FYI, thereâ€™s Rock Ridge extension which adds POSIX semantics to an ISO file-system.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/835337/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor833841"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">make_ext4fs to generate filesystem</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 8, 2020 22:39 UTC (Thu)
                               by <b>jhhaller</b> (guest, #56103)
                              [<a href="/Articles/833841/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wrote an alternate version of this tool at Alcatel-Lucent (twice because the first one got lost). Historically, Unix mkfs could make a filesystem from a list of files and contents, and write that filesystem to a file or device. Most any team generating filesystem images needs such a tool if they want to generate that ISO without needing root access. And, who really wants to give root access to one&#x27;s CI system? We typically used this as a TFTP boot image for embedded Unix systems, and the filesystem was in RAM. That was another story, as the TFTP large block option was required, and no one had implemented a TFTP server with large block support at that time, and the filesystems were typically more than the 64K 512 byte block TFTP transfer size limit.<br>
<p>
It was not hard to slightly modify mke2fs to take a manifest of files (and file of contents for regular files), and use the functions available to mke2fs to write the special files, permissions, directories, and file content to the ISO. I based the manifest loosely on the syntax of the contents of the proto argument of Unix 6th edition mkfs command - <a href="http://man.cat-v.org/unix-6th/8/mkfs">http://man.cat-v.org/unix-6th/8/mkfs</a> - and added options for other file types including both symbolic and hard links. But, by using mke2fs, it at least used the functions built into the filesystem to populate the parts of the filesystem, making corruption significantly less likely. It would make two passes through the internal data model of the manifest, the first time writing inodes, and the second time writing the file contents. I don&#x27;t remember if all-zero blocks were suppressed to support holes, I suspect not, as few files we installed had large all-zero blocks.<br>
<p>
It was just more work than I wanted to do to get approval for releasing the changes externally, and get it accepted into ext4 source code, so it stayed internal. Since we never redistributed the tool externally, there was no need to share it, even though the change was under GPL. Sorry, Google and Ted Ts&#x27;o.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833841/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833858"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">make_ext4fs to generate filesystem</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2020 2:58 UTC (Fri)
                               by <b>djwong</b> (subscriber, #23506)
                              [<a href="/Articles/833858/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah... mke2fs -d takes care of slurping a directory tree into the new filesystem now.<br>
<p>
Also, that&#x27;s a very interesting man page link-- now I&#x27;ve learned where the mkfs.xfs &quot;protofile&quot; format comes from!  The manpage for mkfs.xfs even features a very similar example file.<br>
<p>
Er, thanks!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833858/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833915"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">make_ext4fs to generate filesystem</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2020 15:05 UTC (Fri)
                               by <b>jhhaller</b> (guest, #56103)
                              [<a href="/Articles/833915/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The -d option would still require root access to allow creating device file entries which may not match the host&#x27;s devices.<br>
Setting the correct file ownership is another aspect requiring root access. The protofile addresses both of these issues,<br>
as it overwrites the filesystem owner, permissions, and allows creating device files. I doubt mkfs was originally<br>
concerned with CI systems, but creating filesystem images on a non-native host was likely an early concern.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833915/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834080"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">make_ext4fs to generate filesystem</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 12, 2020 16:36 UTC (Mon)
                               by <b>mebrown</b> (subscriber, #7960)
                              [<a href="/Articles/834080/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The yocto build system has a utility called &#x27;pseudo&#x27;.<br>
<p>
It uses an LD_PRELOAD library such that anything doing a mknod() libc call is saved to a database instead of invoking the underlying mknod() call, and instead just creates a regular placeholder file.<br>
<p>
Then when you run mke2fs, similarly the LD_PRELOAD then hooks stat() such that mke2fs reading the placeholder file actually reads the details from the database instead of the filesystem.<br>
<p>
Seems a little hacky at first, but seems to work well enough in practice.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834080/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor833918"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">make_ext4fs to generate filesystem</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2020 17:40 UTC (Fri)
                               by <b>tytso</b> (subscriber, #9993)
                              [<a href="/Articles/833918/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Interesting.   I didn&#x27;t know about this feature in the 6th edition Unix&#x27;s mkfs.   It&#x27;s not something which the BSD Fast File System supported, and my involvement with Unix started with BSD 4.3.<br>
<p>
Using a proto file so that the system can more easily create device files does make sense, and of course these days we need to have something which supports SELinux attributes as well.   That&#x27;s one of the reasons why contrib/e2fsdroid exists.   (The other is that e2fsdroid uses the Android libsparse file to create an image which omits the all zero blocks and which is compatible with the existing Android image creation tools, and I didn&#x27;t want to drag that into mke2fs as a shared library dependency, since that would make distro installer release engineers.... cranky.)<br>
<p>
Patches to support some kind of proto file which supports SELinux attributes, and which uses the qemu image file creation functions in libext2fs for mke2fs would certainly be gratefully accepted.   If we had that, plus the per-block dedup functionality to create shared blocks file system added, then yes, we could upstream all of that functionality into mke2fs, and allow other embedded systems developers access to e2fsdroid functionality without having to build AOSP....<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833918/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor833920"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">make_ext4fs to generate filesystem</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2020 17:42 UTC (Fri)
                               by <b>tytso</b> (subscriber, #9993)
                              [<a href="/Articles/833920/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sorry:   s/libsparse file/libsparse library/<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/833920/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor834079"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 12, 2020 16:42 UTC (Mon)
                               by <b>ncm</b> (guest, #165)
                              [<a href="/Articles/834079/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I understand the desire to use ext4 for a read-only fs as a need for features maybe not-supported in certain other filesystems.<br>
<p>
I don&#x27;t understand a reluctance to certify e2fsck as the arbiter of what may be mounted as an ext2/3/4 filesystem. If it is discovered that some bit pattern is a security hole, surely e2fsck will be updated to patch up an image that tickles that security hole?<br>
<p>
It seems not necessary to remain bitwise compatible with filesystems that *current* e2fsck would alter, but that older e2fsck would allow. e2fsck should continue to accept non-broken images, and to fix known-broken ones. So, we could accept a future kernel requiring that a file system image that used to mount as-is be fixed by a new e2fsck before it may be mounted. We could even have e2fsck refuse to fix certain old images it finds too confusing, as it might for any damaged image.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834079/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor834376"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The ABI status of filesystem formats</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 15, 2020 11:11 UTC (Thu)
                               by <b>rwmj</b> (subscriber, #5474)
                              [<a href="/Articles/834376/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;m wondering if what Josh really wants is some kind of deduplicating block layer.  I have a (non-upstream) nbdkit allocator for this.  The devil may be in the details however since it may be possible that the bitmaps being combined are not actually identical at the block size level.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834376/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2020, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
