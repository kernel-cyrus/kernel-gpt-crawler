        <!DOCTYPE html>
        <html lang="en">
        <head><title>Old compilers and old bugs [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/842122/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/841993/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/842122/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Old compilers and old bugs</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ready to give LWN a try?</b>
<p>
With a subscription to LWN, you can stay current with what is happening in the Linux and free-software community and take advantage of subscriber-only site features.  We are pleased to offer you <b><a href="https://lwn.net/Promo/nst-trial/claim">a free trial subscription</a></b>, no credit card required, so that you can see for yourself.  Please, join us!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>January 11, 2021</br>
           </div>
The kernel project goes out of its way to facilitate building with older
toolchains.  Building a kernel on a new system can be enough of a challenge
as it is; being forced to install a custom toolchain first would not
improve the situation.  So the kernel
developers try to keep it possible to build the kernel with the toolchains
shipped by most distributors.  There are costs to this policy though, including
an inability to use newer compiler features.  But, as was seen in a recent
episode, building with old compilers can subject developers to old compiler
bugs too.
<p>
On January 5, Russell King <a
href="/ml/linux-kernel/20210105154726.GD1551@shell.armlinux.org.uk/">reported</a>
on a problem he had been chasing for a long time.  Some of his 64-bit Arm
systems running 5.4 or later kernels would, on rare occasion, report a
checksum failure on the ext4 
root filesystem.  It could take up to three months of uptime for the
problem to manifest itself, making it, as King described it,
"<q>unrealistic to bisect</q>".  He had, however, found a way to more
reliably reproduce the failure, making the task of finding out when the
problem was introduced plausible, at least.
<p>
Starting with King's findings, a number of developers working in the Arm
subsystem looked into the issue; 
their efforts seemed to point out <a
href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=22ec71615d82">this
commit</a> as the culprit.  That change, applied in 2019, relaxed the
memory barriers used around I/O accessors, optimizing accesses to I/O
memory.  Reverting this patch made the problem go away.
<p>
Some developers might have applied the revert and called the problem
solved, but that is not what happened here.  Will Deacon, the author of the
patch in question, was convinced of its correctness; if the Arm
architecture is behaving as specified, there should be no need for the
stronger barriers, so something else was going on.  Reverting the patch, in
other words, made the issue go 
away by papering over a real problem somewhere else.
<p>
Where might that "somewhere else" be?  King suggested that it could be
somewhere else in the kernel, in the Arm processor itself, or in the
cache-coherent interconnect that ties together processor clusters and
memory.  He thought that a problem in the hardware was relatively unlikely,
and that the bug thus lurked somewhere within the kernel.  That, naturally,
led to a lot of code examination, especially within the ext4 filesystem.

<p>
Two days later, King <a
href="/ml/linux-kernel/20210107111841.GN1551@shell.armlinux.org.uk/">announced</a>
that the problem had been found; it indeed was an issue within the ext4
filesystem, but not of the variety that had been expected.  A look at the
assembly code generated for <tt>ext4_chksum()</tt> revealed that the
compiler was freeing the function's stack frame prior to the end of the
function itself.  The last line of the function is:
<p>
<pre>
    return *(u32 *)desc.ctx;
</pre>
<p>
Here, <tt>desc</tt> is a local variable, living on the stack.  The compiled
function was resetting the stack pointer above this variable immediately
before fetching <tt>desc.ctx</tt>.  That led to a window of exactly one
instruction where the function was using stack space that had already been
freed.
<p>
This is a compiler bug of the worst type.  The miscompiled code will work
as expected almost every time; there is, after all, no other code trying to
allocate stack space in that one-instruction window.  All bets are off,
though, if an interrupt arrives exactly between the two instructions; then
the stack will be overwritten and the load of <tt>desc.ctx</tt> will be
corrupted, leading to the observed checksum failure.  This is something
that will <i>almost</i> never happen, but when it does things will go badly
wrong.
<p>
This miscompilation was done by GCC 4.9.4, which was released in August
2016 (4.9.0, the major release on which it is based, came out in April
2014).  The relevant bug, though, was <a 
href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=63293">reported</a> in
2014 and fixed in November of that year.  That fix was seemingly
never backported from the (then) under-development 5.x release to 4.9.x, so
the 4.9.4 release did not contain it.  Interestingly, versions of 4.9.4
shipped by distributors like Red Hat, Android, and Linaro all <i>did</i>
have the fix backported, so it only affected developers not using those
versions. The bug lurked there for years until
finally turning up in King's builds.
<p>
One outcome from this episode is a clear illustration of the potential downside of
supporting old toolchains.  A great deal of effort went into tracking down
a bug that had, in fact, been fixed six years ago; that would have not been
necessary if developers were not still using 4.9.x compilers.
<p>
As it happens, GCC 4.9 is the oldest compiler supported by the kernel, but
even that requirement is relatively recent.  <a href="/Articles/748074/">As
of 2018</a>, the kernel still claimed (not entirely truthfully) that it could
be built with GCC&nbsp;3.2, which was released in 2002.  As a result of
discussions held in 2018, the minimum GCC version was moved forward to 4.6;
later it became 4.9.
<p>
Fixing GCC 4.9 to address this bug is out of the question; the GCC
developers have long since moved on from that release.  So, at a minimum,
the oldest version of the compiler that can be used for the arm64
architecture will have to be moved forward to 5.1.  But that immediately
led to the question of whether the oldest version for <i>all</i>
architectures should be moved forward.
<p>
Ted Ts'o was <a href="/ml/linux-kernel/X/c2aqSvYCaB9sR6@mit.edu/">in
favor</a> of that change, but he also pointed out that RHEL&nbsp;7 (and
thus CentOS&nbsp;7) systems are still stuck with GCC&nbsp;4.8.  As Peter
Zijlstra <a
href="/ml/linux-kernel/X/giM+tM3FGVj0Np@hirez.programming.kicks-ass.net/">noted</a>,
though, it is already necessary to install a newer compiler than the
distribution provides to build the kernel on those systems.  Arnd Bergmann
<a
href="/ml/linux-kernel/CAK8P3a2svyz1KXSqSUMVeDqdag4f1VcERH9jpECSLsn-FWvZbw@mail.gmail.com/">said</a>
that the other known users of GCC&nbsp;4.9 were Android and Debian&nbsp;8.
Android has since switched over to Clang to build its kernels, and
Debian&nbsp;8 <a href="https://www.debian.org/News/2020/20200709">went
unsupported</a> at the end of June 2020.  So it would appear that
relatively few users would be inconvenienced by raising the minimum GCC
version to&nbsp;5.1.
<p>
On the other hand, there are some advantages to such a move beyond leaving
an unpleasant bug behind.  Bergmann <a
href="/ml/linux-kernel/CAK8P3a2J8fLjPhyV0XUeuRBdSo6rz1gU4wrQRyfzKQvwhf22ag@mail.gmail.com/">argued</a>
for this change because it would allow compiling the kernel with
<tt>-std=gnu11</tt>, making it possible to rely on bleeding-edge <a
href="https://en.wikipedia.org/wiki/ANSI_C#C11">C11</a> 
features.  Currently, kernel builds use <tt>-std=gnu89</tt>, based on the
rather less shiny <a
href="https://en.wikipedia.org/wiki/ANSI_C#C89">C89</a> standard.  <a
href="/ml/linux-kernel/X/gkMmObbkI4+ip/@hirez.programming.kicks-ass.net/">Zijlstra</a>
and <a
href="/ml/linux-kernel/20210108092655.GA4031@willie-the-truck/">Deacon</a>
both added that moving to 5.1 would allow the removal of a number of
workarounds for GCC&nbsp;4.9 problems.
<p>
Given all that, it seems unlikely that there will be much opposition to
moving the kernel as a whole to the 5.1 minimum version.  That said, Linus
Torvalds <a
href="/ml/linux-kernel/CAHk-=whnKkj5CSbj-uG_MVVUsPZ6ppd_MFhZf_kpXDkh2MAVRA@mail.gmail.com/">is
unconvinced</a> about the value of such a change and may yet need some
convincing.  Even if the shift to 5.1 does not happen right away, the
writing would seem to be on the wall that GCC&nbsp;4.9 will not be
supported indefinitely.  GCC&nbsp;5.1,
released in April 2015, is not the newest thing on the planet either, of
course.  But hopefully it has fewer lurking bugs while simultaneously
making some welcome new features available.  Supporting old toolchains has
its value, but so does occasionally dropping the oldest of them.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Build_system">Build system</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/842122/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor842322"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 11, 2021 22:09 UTC (Mon)
                               by <b>JoeBuck</b> (subscriber, #2330)
                              [<a href="/Articles/842322/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Suggestion: make the patch that relaxed the memory barriers used around I/O accessors conditional: disable it for the ARM platform if the GCC major version is less than 5.  Maybe look for other memory barrier operations and see if they might be affected.<br>
&lt;p&gt;<br>
But a given vendor might have backported the GCC fix to 4.9.  Guess there could be a config option to force it on.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842322/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842323"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 11, 2021 22:24 UTC (Mon)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/842323/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The real bug was in the early release of the stack frame, and had nothing to do with memory barriers.<br>
<p>
The memory barrier probably masked the problem by changing how the compiler ordered its machine code. That doesn&#x27;t mean that adding a memory barrier would fix the same bug in other locations.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842323/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor842324"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 11, 2021 22:34 UTC (Mon)
                               by <b>dxin</b> (guest, #136611)
                              [<a href="/Articles/842324/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Have Android really switched to clang for compiling the kernel? I thought only Google/Pixel made the switch.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842324/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842332"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 0:56 UTC (Tue)
                               by <b>ndesaulniers</b> (subscriber, #110768)
                              [<a href="/Articles/842332/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Android, ChromeOS, google&#x27;s production kernel used in data centers, and OpenMandriva have switched their kernel builds to LLVM.  I plan on providing more info at LinuxConf AU Jan 23; check it out!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842332/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor842336"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 8:12 UTC (Tue)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/842336/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; it would allow compiling the kernel with -std=gnu11, making it possible to rely on bleeding-edge C11 features</font><br>
<p>
bleeding edge features like.... C99 comments! No?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842336/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842338"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 10:25 UTC (Tue)
                               by <b>quietbritishjim</b> (subscriber, #114117)
                              [<a href="/Articles/842338/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think C++/BCPL style comments are supported by the GNU extensions in -std=gnu89 anyway.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842338/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor842456"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2021 8:39 UTC (Wed)
                               by <b>error27</b> (subscriber, #8346)
                              [<a href="/Articles/842456/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
People have started using C99 comments in the kernel.  But it depends on the subsystem.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842456/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor842339"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 10:51 UTC (Tue)
                               by <b>vstinner</b> (subscriber, #42675)
                              [<a href="/Articles/842339/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; on rare occasion, report a checksum failure on the ext4 root filesystem. It could take up to three months of uptime for the problem to manifest itself, making it, as King described it, &quot;unrealistic to bisect&quot;.</font><br>
<p>
I love such thriller story! With the article, the whole issue perfectly makes sense, but I love the puzzle that people had the solve to put pieces altogether.<br>
<p>
I&#x27;m always amazed by developers able to spot in the machine/assembly code that the C code is &quot;miscompiled&quot;. The compiler is not the usual suspect.<br>
<p>
It&#x27;s also &quot;funny&quot; that it&#x27;s still possible to use a variable allocated on the stack after the stack pointer is &quot;reset&quot;. It&#x27;s funny since even if the code is &quot;wrong&quot;, well, it works in practice &quot;most of the time&quot;.<br>
<p>
<font class="QuotedText">&gt; That led to a window of exactly one instruction where the function was using stack space that had already been freed.</font><br>
<p>
How likely is it to get an interruption at a very precise unique instruction? &quot;Unlikely&quot; if I understood correctly, but &quot;it happens&quot; because of the Murphy&#x27;s law ;-)<br>
<p>
--<br>
<p>
Maybe a special kernel debug mode should send signals frequently to make such bug more likely?<br>
<p>
In Python, I wrote functional tests on EINTR handling. The tests use setitimer() to trigger a SIGARLM signal every 100 ms while the test is running, some tests &quot;sleep&quot; for 200 ms and so should get at least one signal.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842339/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842347"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 15:09 UTC (Tue)
                               by <b>eru</b> (subscriber, #2753)
                              [<a href="/Articles/842347/">Link</a>] 
      </p>
      
      </div>
      </summary>
      &gt;<i>It's also "funny" that it's still possible to use a variable allocated on the stack after the stack pointer is "reset". It's funny since even if the code is "wrong", well, it works in practice "most of the time".</i>
<p>
This type of bug is not that unusual, but normally it is caused by a programmer returning a pointer to a local variable from a function. Depending on what the caller does, the buggy code may "work" for a long time, and then blow up, when some unrelated code changes are made, or the compiler is changed. Actually this bug was more common in the past. Nowadays smarter compilers and code analysis tools can usually warn about it.

      
          <div class="CommentReplyButton">
            <form action="/Articles/842347/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor842359"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 15:58 UTC (Tue)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/842359/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It&#x27;s also &quot;funny&quot; that it&#x27;s still possible to use a variable allocated on the stack after the stack pointer is &quot;reset&quot;. It&#x27;s funny since even if the code is &quot;wrong&quot;, well, it works in practice &quot;most of the time&quot;.</font><br>
<p>
For &quot;regular userspace code,&quot; this may be entirely legal depending on how big your stack frames are. But the kernel uses -mno-red-zone to forbid it, precisely because it needs to be interrupt-safe.<br>
<p>
See also this Linus rant (which is the only reason I know these things): <a href="https://lkml.org/lkml/2014/7/24/584">https://lkml.org/lkml/2014/7/24/584</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842359/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842384"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 16:34 UTC (Tue)
                               by <b>eru</b> (subscriber, #2753)
                              [<a href="/Articles/842384/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This &quot;red zone&quot; below the stack frame is architecture and ABI dependent thing. I have seen it only in x86_64. Plain old x86 does not use stack that way. Don&#x27;t know about other architectures. But any C code that depends on the stack below the stack frame of the current function remaining undisturbed is clearly buggy.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842384/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842401"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 20:00 UTC (Tue)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/842401/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I have seen it only in x86_64.</font><br>
<p>
Which is the most popular architecture by far in terms of desktops and servers. Obviously, phones are a different story, but characterizing it as &quot;only&quot; x86_64 sounds a bit odd to me.<br>
<p>
<font class="QuotedText">&gt; But any C code that depends on the stack below the stack frame of the current function remaining undisturbed is clearly buggy.</font><br>
<p>
The C abstract machine has no notion of &quot;below the stack frame,&quot; so this sentence is meaningless.<br>
<p>
Under C, a pointer can point to one of five things:<br>
<p>
1. A static object.<br>
2. An automatic object.<br>
3. A dynamic object.<br>
4. NULL or one-past-the-end-of-an-array.<br>
5. Anything else.<br>
<p>
For cases 1 and 3, the stack frame is obviously irrelevant. Case 2 is only possible while the function is still executing, because when it returns, we immediately transition to case 5 (according to the C abstract machine). And cases 4 and 5 are always illegal to dereference, regardless of whether you have red-zones or not, meaning an optimizing compiler can interpret your code as unreachable and do wacky things even if the arch would have supported it. In fact, it&#x27;s generally illegal to even *have* a case 5 pointer, because all of the operations you can do to create a case 5 pointer are themselves UB.<br>
<p>
Instead, the entire context of this discussion is around *assembler* code, which has (usually) been emitted by a compiler. The compiler is absolutely entitled to use red zoning on archs where it is supported, unless the user instructs it otherwise (with -mno-red-zone). But this has nothing to do with the &quot;bugginess&quot; of the C code it started with. Buggy C code will obviously result in buggy assembler, but there is no reasonable way for C code to cause a red-zoning violation unless it has wandered pretty far into UB territory to begin with. At that point, the C code isn&#x27;t so much buggy as utterly meaningless.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842401/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor842448"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2021 7:15 UTC (Wed)
                               by <b>jem</b> (subscriber, #24231)
                              [<a href="/Articles/842448/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;But any C code that depends on the stack below the stack frame of the current function remaining undisturbed is clearly buggy.</font><br>
<p>
One could argue that variables in the &quot;red zone&quot; *are* part of the stack frame of the function. The compiler writer didn&#x27;t want to waste a clock cycle to decrement the stack pointer, but that is just a technicality. On the other hand, any code that assumes the stack area below the stack pointer is free to use for some other purpose is clearly buggy.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842448/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842466"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2021 9:54 UTC (Wed)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/842466/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; On the other hand, any code that assumes the stack area below the stack pointer is free to use for some other purpose is clearly buggy.</font><br>
<p>
Are you talking about the code that executes a new function, and hence is assuming that that space is free to to use for allocating a new stack frame? Because that&#x27;s exactly what this bug is ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842466/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842495"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2021 14:10 UTC (Wed)
                               by <b>jem</b> (subscriber, #24231)
                              [<a href="/Articles/842495/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The bug is in the compiler. The compiler should know what it is doing, for example only use a red zone in leaf functions. Using a red zone is not a bug in itself. Using a red zone the wrong way is a bug.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842495/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor842418"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 21:07 UTC (Tue)
                               by <b>cesarb</b> (subscriber, #6266)
                              [<a href="/Articles/842418/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Key part of that Linus post:<br>
<p>
<font class="QuotedText">&gt; We do *not* follow the x86-64 ABI wrt redzoning, because we *cannot*: interrupts while in kernel mode *will* use the stack without a redzone.</font><br>
<p>
This is a peculiarity of the x86 architecture (which was kept when AMD extended it to 64 bits): to handle an interrupt, the CPU stores the return address and the processor state (flags) in the stack. Other architectures (including IIRC ARM and MIPS) store them in special registers instead, keeping the stack untouched.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842418/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842573"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2021 17:27 UTC (Wed)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/842573/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not saying that&#x27;s the case, but there&#x27;s a good reason for storing them on the stack - you can nest interrupts. With the other architectures, you need to stash the old values somewhere safe if you want to nest them.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842573/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842587"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2021 19:17 UTC (Wed)
                               by <b>excors</b> (subscriber, #95769)
                              [<a href="/Articles/842587/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
ARM M-Profile (admittedly not very relevant for Linux) is another example that automatically stores interrupt return information (plus a few general-purpose registers) on the stack. I believe it typically has two stacks, one for the RTOS and one for threads(/tasks/processes/etc), where the first interrupt will push onto the current thread stack (which is convenient if the interrupt handler wants to context-switch to another thread) and subsequent nested interrupts will push onto the RTOS stack (which means threads don&#x27;t have to each reserve enough stack space for a hard-to-predict number of nested interrupt contexts).<br>
<p>
(The nesting only allows interrupt handlers to be interrupted by a strictly higher priority interrupt, and there&#x27;s a limited number of priority levels (e.g. I think 8 is common on Cortex-M4), so the nesting can&#x27;t get arbitrarily deep. It&#x27;s useful since you can use high-priority interrupts for real-time tasks, with a guarantee the handler will execute within a certain number of cycles and will never be held up by lower-priority interrupt handlers. That wouldn&#x27;t be possible if the lower-priority handler was required to manually save its state before allowing any nesting.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842587/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor843902"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 25, 2021 19:07 UTC (Mon)
                               by <b>immibis</b> (guest, #105511)
                              [<a href="/Articles/843902/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I believe these architectures typically disable interrupts when entering an interrupt. If you want nested interrupts, save the values on the stack yourself and re-enable interrupts - now you have a chance to skip over the red zone before doing so.<br>
<p>
I&#x27;m not sure how that works with exceptions. I think ARM has a separate register set for &quot;aborts&quot;, so you can nest an abort within an IRQ, but nesting an abort within an abort may cause problems for you - of course, if your abort handler was unable to save the state without causing another abort, you *already* have problems. That&#x27;s basically a triple fault in software. <br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/843902/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor842586"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2021 19:10 UTC (Wed)
                               by <b>jem</b> (subscriber, #24231)
                              [<a href="/Articles/842586/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Note the &quot;while in kernel mode&quot;. The kernel is built with -mno-red-zone. The x86_64 does not use the user mode stack to save anything as a result of an interrupt.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842586/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor842398"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 18:56 UTC (Tue)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/842398/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I&#x27;m always amazed by developers able to spot in the machine/assembly code that the C code is &quot;miscompiled&quot;. The compiler is not the usual suspect.</font><br>
<p>
By the time the compiler becomes the suspect, spotting the miscompiled code is easy compared to the steps before!<br>
<p>
(That said, I know you worked on a ProactorEventLoop that was probably just as nasty as this kind of bug. I found your blog post while trying to figure out somr random hangs that only showed up on Windows and only with Python 3.5. Fortunately the 3.5 EOL meant that *my* bug fixed itself just by waiting a few weeks!).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842398/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor842440"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2021 3:55 UTC (Wed)
                               by <b>plugwash</b> (subscriber, #29694)
                              [<a href="/Articles/842440/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; How likely is it to get an interruption at a very precise unique instruction?</font><br>
Lets try and put an order of magintude on this by making come crude assumptions<br>
<p>
1. the processor executes on-average one instruction per clock cycle (IIRC modern cores can perform more than one instruction per clock sometimes, but they can also have to wait for memory)<br>
2. the processor runs at about 2GHz (seems reasonable for an arm64 core).<br>
3. there is a timer interrupt at 1000Hz.<br>
<p>
Which would give us an assumed hit-rate from timer interrupts alone of 1 in 2 million executions. That sounds frequent enough to cause problems on a frequently executed codepath, but rare enough to be a massive PITA to debug.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842440/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor842340"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 12:07 UTC (Tue)
                               by <b>ncm</b> (guest, #165)
                              [<a href="/Articles/842340/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Much, possibly most of the financial world is well immured in gcc-4.8.x, and shows no inclination ever to hoist themselves out. Many will not use anything newer than 4.8.3, although 4.8.5 is more common, and 4.9.4 has some popularity.<br>
<p>
Few in that world use ARM, yet. But quite a large number of other bugs motivated the later 4.8.x releases, and 4.9. One might expect that there would be a careful catalog of Known Bugs, with means to step around them, and reviews of code to ensure they are not stepped in, but such an expectation would be wholly wrong.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842340/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842349"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 15:12 UTC (Tue)
                               by <b>eru</b> (subscriber, #2753)
                              [<a href="/Articles/842349/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Won&#x27;t they be forced to update the gcc when RHEL7 goes out of support?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842349/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842383"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 16:16 UTC (Tue)
                               by <b>ncm</b> (guest, #165)
                              [<a href="/Articles/842383/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hahahahahaha no.<br>
<p>
Finance people generally *prefer* things that are out of maintenance, because they experience even fewer incoming changes. Any infrastructural bug that seems like it ought to be physically possible to work around reliably is A-OK, if the alternative would involve changing something.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842383/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842386"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 17:35 UTC (Tue)
                               by <b>eru</b> (subscriber, #2753)
                              [<a href="/Articles/842386/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In that case, they probably don&#x27;t care which GCC version is needed to compile newer kernels, because they are not upgrading the kernel anyway.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842386/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842399"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 19:27 UTC (Tue)
                               by <b>jwarnica</b> (subscriber, #27492)
                              [<a href="/Articles/842399/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;m confused by the style of argument presented in the article and again in this chain. &quot;Someone wants to use an obsolete dependency because their world is built on mostly obsolete things? OK, let them!&quot; Now, I also don&#x27;t like the argument in the form of &quot;It compiles with `rm -rf ; git clone`, I don&#x27;t care about anything else&quot; (but that is another point)<br>
<p>
Red Hat (in RHEL vWhatever) or Debian (in vWhatever), or similar, by definition, contains a cohesive set of obsolete (but internally cross compatible) things. If you want to backport a particular patch to your obsolete world, feel free, but then compile it with the included and matching obsolete compiler.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842399/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842409"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 21:06 UTC (Tue)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/842409/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &quot;It compiles with `rm -rf ; git clone`, I don&#x27;t care about anything else&quot;</font><br>
<p>
While this is the extreme end of the spectrum, there is a line that needs to be drawn. I don&#x27;t know how many times bug reports have come down to things like &quot;I have some random path in LD_LIBRARY_PATH because of some other problem I hit months ago&quot; or (just this week) &quot;the build picked up a Python2 tool in a Python3 PYTHONPATH-using environment&quot; that if someone who doesn&#x27;t know how to gather the required information (or even just read error messages) does have their problem solved by doing a clean build or other from-scratch setup is just the best solution. I don&#x27;t even know how to document &quot;make sure that tool X that is found is using Python3, not Python2&quot; in a way that someone who couldn&#x27;t determine that it&#x27;s what&#x27;s happening from the error message anyways would be able to effectively act upon.<br>
<p>
<font class="QuotedText">&gt; &quot;Someone wants to use an obsolete dependency because their world is built on mostly obsolete things? OK, let them!&quot;</font><br>
<p>
Again, there&#x27;s a limit sometimes as to how varied an environment a single project can reliably support. At some point when someone is asking for a 5 year old deployment of tool X to support other tools that came out yesterday and finding issues, well, what is one to do?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842409/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor842407"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 20:31 UTC (Tue)
                               by <b>atai</b> (subscriber, #10977)
                              [<a href="/Articles/842407/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
can gcc people release a new version of gcc 4.9 with the bug fix for this one in discussion?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842407/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor842420"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 21:09 UTC (Tue)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/842420/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
They already have. Six years ago. People haven&#x27;t upgraded.<br>
<p>
The problem isn&#x27;t the code, it&#x27;s peoples&#x27; inertia.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842420/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor842421"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 21:10 UTC (Tue)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/842421/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I mean they *could*, but who is going to get the vendor where the 4.9 is available now to also deploy the update? Making the source tarball isn&#x27;t the end of the story here: anyone using 4.9 today is likely to also need to to go through other EOL pipelines.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842421/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor842431"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 23:16 UTC (Tue)
                               by <b>nivedita76</b> (guest, #121790)
                              [<a href="/Articles/842431/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, RHEL7 is still technically under maintenance support until 2024, and RHEL8 was released &quot;only&quot; 1.5 years ago. It&#x27;s actually a bit weird that full support for 7 ended only a few months after 8 was released. RHEL6 still had full support for two years after 7 was released.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842431/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor842396"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 18:31 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/842396/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ahh... I remember the good ole days of GCC 2.8! <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842396/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor843504"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 22, 2021 0:25 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/843504/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So recent? The one we were stuck on for years and years was 2.7.2.x, various minor version of which were the major version for two years (if you count egcs as a gcc), or more than four if you wait for GCC 2.95 -- itself more or less a well-tested snapshot released because 3.x was taking so long. That wasn&#x27;t out until *2001*, almost seven years to the day after 2.7.2.<br>
<p>
(There is a nice historical timeline at <a href="https://gcc.gnu.org/releases.html">https://gcc.gnu.org/releases.html</a> so you don&#x27;t have to dig around on ancient ftp servers because all the ancient historical digging has already been done for us. It&#x27;s at times like this that I&#x27;m reminded of how old this stuff is, how it was made by a generation that is now fast approaching retirement: I&#x27;m not exactly young any more, old enough to have had no access to computers at all for the first few years of my life -- but when GCC was first released, I was only ten years old, and it had been under development for some years by then. Free software is older than the children of the microcomputer age. For that matter even the *text editors* that a lot of us use are older than we are: both vi and Emacs date back in some form to roughly 1976.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/843504/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor843507"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 22, 2021 0:43 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/843507/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yep, and I also remember GCC 2.96 that didn&#x27;t exist. Though it did ( <a href="https://gcc.gnu.org/gcc-2.96.html">https://gcc.gnu.org/gcc-2.96.html</a> ), we were using it in 2005.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/843507/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor842397"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 18:47 UTC (Tue)
                               by <b>alonz</b> (subscriber, #815)
                              [<a href="/Articles/842397/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I'm surprised that they use GCC at all, and not COBOL...
      
          <div class="CommentReplyButton">
            <form action="/Articles/842397/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor842428"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 12, 2021 22:59 UTC (Tue)
                               by <b>ndesaulniers</b> (subscriber, #110768)
                              [<a href="/Articles/842428/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Will Deacon has just posted a patch to raise the minimum required version of GCC to 5.1 for ARCH=arm64: <a href="https://lore.kernel.org/lkml/20210112224832.10980-1-will@kernel.org/T/#u.">https://lore.kernel.org/lkml/20210112224832.10980-1-will@...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842428/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor843389"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 21, 2021 11:59 UTC (Thu)
                               by <b>Hi-Angel</b> (guest, #110915)
                              [<a href="/Articles/843389/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
and it was applied to arm-next; and then a new discussion about raising gcc level to 5.1 appeared, which at this time seems to have succeeded. So the next merge window may well see gcc version being bumped to 5.1<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/843389/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor842432"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2021 0:04 UTC (Wed)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/842432/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;ve read that some Ada projects, often done with GNAT, require using an exact version of the compiler for the whole existence of the project. On the other hand, part of the reason is that any new patch would be audited on the assembly language level as well as the source code level, making bugs like this much easier to notice. It&#x27;s a very expensive approach, but when crashes might cause a Congressional investigation, hopefully worth the money.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/842432/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor843714"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Old compilers and old bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2021 0:17 UTC (Sun)
                               by <b>david.a.wheeler</b> (subscriber, #72896)
                              [<a href="/Articles/843714/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I&#x27;ve read that some Ada projects, often done with GNAT, require using an exact version of the compiler for the whole existence of the project. On the other hand, part of the reason is that any new patch would be audited on the assembly language level as well as the source code level, making bugs like this much easier to notice. It&#x27;s a very expensive approach, but when crashes might cause a Congressional investigation, hopefully worth the money.</font><br>
<p>
The Ada standard includes &quot;pragma reviewable&quot;, a compiler mechanism specifically to enable reviews of the generated code:<br>
<a href="https://www.adaic.org/resources/add_content/standards/12rm/html/RM-H-3-1.html">https://www.adaic.org/resources/add_content/standards/12r...</a><br>
<p>
It&#x27;s specifically to enable review when you&#x27;re developing high assurance software (software has to be pretty critical to justify this level of review, but if it&#x27;s really critical, this does help counter these kinds of errors).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/843714/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2021, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
