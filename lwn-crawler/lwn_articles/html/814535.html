        <!DOCTYPE html>
        <html lang="en">
        <head><title>Dentry negativity [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/814535/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/814704/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/814535/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Dentry negativity</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ready to give LWN a try?</b>
<p>
With a subscription to LWN, you can stay current with what is happening in the Linux and free-software community and take advantage of subscriber-only site features.  We are pleased to offer you <b><a href="https://lwn.net/Promo/nst-trial/claim">a free trial subscription</a></b>, no credit card required, so that you can see for yourself.  Please, join us!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>March 12, 2020</br>
           </div>
Back in 2017, Waiman Long <a href="/Articles/728085/">posted a patch
set</a> placing limits on the number of "negative dentries" stored by the
kernel.  The better part of three years later, that work continues with,
seemingly, no better prospects for getting into the mainline.  It would be
understandable, though, if many people out there don't really know what
negative dentries are or why kernel developers care about them.  That, at
least, can be fixed, even if the underlying problem seems to be more
difficult.
<p>
A "dentry" in the Linux kernel is the in-memory representation of a
directory entry; it is a way of remembering the resolution of
a given file or directory name
without having to search through the filesystem to find it.  The dentry
cache speeds lookups considerably; keeping dentries for frequently accessed
names like <tt>/tmp</tt>, <tt>/dev/null</tt>, or <tt>/usr/bin/tetris</tt>
saves a lot of filesystem I/O.
<p>
A <i>negative</i> dentry is a little different, though: it is a memory of a
filesystem lookup that failed.  If a user types "<tt>more&nbsp;cowbell</tt>"
and no file named <tt>cowbell</tt> exists, the kernel will create a negative
dentry recording that fact.  Should our hypothetical user, being a stubborn
type, repeat that command, the kernel will encounter the negative dentry
and reward said user — who is unlikely to be grateful, users are like that
— with an even quicker "no such file or directory" error.
<p>
Optimized error messages for fat-fingered commands is a nice benefit from
negative dentries, but their real value lies elsewhere.  It turns out that
lookups on nonexistent files happen frequently, and it's often the same
files that are being looked for.  Shared-library lookups are one example;
it can be instructive to type something like this:
<p>
<pre>
    $ strace -eopenat /usr/bin/echo 'Subscribe to LWN'
</pre>
<p>
On your editor's system, the output looks like:
<p>
<pre>
    openat(AT_FDCWD, "/lib64/libc.so.6", O_RDONLY|O_CLOEXEC) = 3
    openat(AT_FDCWD, "/usr/lib/locale/locale-archive", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
    openat(AT_FDCWD, "/usr/share/locale/locale.alias", O_RDONLY|O_CLOEXEC) = 3
    openat(AT_FDCWD, "/usr/lib/locale/en_US.UTF-8/LC_IDENTIFICATION", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
    openat(AT_FDCWD, "/usr/lib/locale/en_US.utf8/LC_IDENTIFICATION", O_RDONLY|O_CLOEXEC) = 3
    [...]
</pre>
<p>
That simple <tt>echo</tt> command generates 13 failed lookups on a
Fedora&nbsp;31 system; launching <tt>oowriter</tt> creates 68 of them, and
launching <tt>gnucash</tt> generates 277.  For applications like these,
optimizing failed lookups can yield a perceptible improvement in startup
time.  Compilers and language runtimes can also generate a lot of failed
lookups; consider, for example, the handling of C <tt>#include</tt> or
Python <tt>import</tt> statements.  A quick "allmodconfig" kernel build run
on your editor's system caused 52,799,262 failed lookups; that is worth
optimizing. 
<p>
There is one little problem with negative dentries, though: they require
memory.  All of those failed lookups can generate a <i>lot</i> of negative
dentries, to the point that they start to crowd out more useful data.  This
is not a new problem; LWN
<a  href="/Articles/1511/">reported on</a> a complaint about negative
dentries from memory-management developer Andrea Arcangeli — in 2002.  For
the most part, though, the normal shrinker mechanisms that keep the dentry
cache as a whole under control have also sufficed to keep the negative
variety from taking over.
<p>
Long has been working on the cases where normal shrinking doesn't work,
though; he posted <a
href="/ml/linux-kernel/20200226161404.14136-1-longman@redhat.com/">a new
version of his patch set</a> toward the end of February.  As he points out,
the number of positive dentries is limited by the number of files in the
system, but there is no practical limit to the number of files that don't
exist.  As an illustration of what this can mean, Eric Sandeen <a
href="/ml/linux-kernel/0e5124a2-d730-5c41-38fd-2c78d9be4940@redhat.com/">pointed
out</a> some <a
href="https://github.com/nss-dev/nss/blob/317cb06697d5b953d825e050c1d8c1ee0d647010/lib/softoken/sdb.c#L390">code
in the NSS library</a> that deliberately tries to open 10,000 nonexistent
files — every time it starts up — as a timing exercise.  Even without such
pathological examples, though, the number of negative dentries has the
potential to grow without bound.
<p>
Long's patch set adds a new sysctl knob,
<tt>/proc/sys/fs/dentry-dir-max</tt>; if its value is zero (the default),
the system's behavior is unchanged.  If, instead, it is set to a positive
value, the number of negative dentries associated with any given directory
will not be allowed to exceed that value.  The limit on negative dentries
can be no lower than 256 to avoid excessive trimming of dentries.  When the
time comes to clean up excess dentries, the code tries to pick those that
have not been referenced recently, and will reduce the number to 7/8 of the
limit.  A static key is used to prevent this mechanism from slowing down
the system if it is not being used.
<p>
There seems to be no disagreement with the idea of putting firmer limits on
how many negative dentries can exist.  The specific solution chosen here,
though, is a bit more controversial.  Adding new sysctl knobs is always a
bit of a hard sell; as Matthew Wilcox <a
href="/ml/linux-kernel/20200226162954.GC24185@bombadil.infradead.org/">put
it</a>: "<q>A sysctl is just a way of blaming the sysadmin for us not
being very good at programming</q>".  In general, such knobs are
difficult for administrators to discover in the first place, and even
harder for them to set correctly.  How should an administrator know what an
appropriate number of negative dentries for any given directory should be
for their systems and workloads?
<p>
Thus, Wilcox and others argued for some sort of dynamic limit calculated
(and adjusted) by the kernel itself.  Long <a
href="/ml/linux-kernel/12e8d951-fc35-bce0-e96d-f93bccf2bd3a@redhat.com/">responded</a>
with a suggestion that the administrator could control the total amount of
memory used by negative dentries instead of setting a per-directory maximum
count; Wilcox <a
href="/ml/linux-kernel/20200226212844.GD24185@bombadil.infradead.org/">didn't
care</a> how the mechanism worked internally, but insisted that it had to
be self-tuning.
<p>
Dave Chinner, instead, <a
href="/ml/linux-kernel/20200227083029.GL10737@dread.disaster.area/">wondered
about the need</a> for this kind of mechanism at all.  He suggested that
the offending applications should just be confined to a memory control
group; when memory gets tight within the group, the system will reclaim
memory inside that group, including negative dentries.  There is, he said,
already an effective mechanism for limiting the amount of memory used by a
specific application, so there should be no need to add another.
<p>
Long <a
href="/ml/linux-kernel/e9625cae-ee3f-3e58-903d-dabc131c8c9b@redhat.com/">answered</a>
that, while control groups can help, they don't solve the entire problem.
Large numbers of negative dentries can impact the performance of the
program generating them, even if a control group isolates the rest of the
system from the problem.  He also pointed out that daemons often run in the
root control group, where they cannot be constrained in this manner.
<p>
As has happened every time that this patch set has been posted, the
discussion wound down without any sort of conclusion on how things should
proceed.  This patch set seems no closer to the mainline than it was years
ago; a search for control over negative dentries in the kernel will return
a negative result.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Dentry_cache">Dentry cache</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/814535/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor814720"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 12, 2020 22:39 UTC (Thu)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/814720/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; frequently accessed names like /tmp, /dev/null, or /usr/bin/tetris</font><br>
<p>
One of these things is not like the others...<br>
<p>
(Should it be /usr/games/tetris, or is there an actual utility called "tetris" which I have not heard of?)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814720/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814727"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 0:20 UTC (Fri)
                               by <b>Nahor</b> (subscriber, #51583)
                              [<a href="/Articles/814727/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It just means someone is not working as hard as he should... and that he is a bit of a masochist trying to run a very unstable app or an addicted rage-quitter <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814727/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor814752"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 10:52 UTC (Fri)
                               by <b>Sesse</b> (subscriber, #53779)
                              [<a href="/Articles/814752/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It should be /usr/games/gtetrinet!<br>
<p>
(Sadly, gtetrinet seems to be abandoned.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814752/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814756"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 11:36 UTC (Fri)
                               by <b>bahner</b> (guest, #35608)
                              [<a href="/Articles/814756/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No, no. /usr/games/xtris. This is also abandoned, so you need to carry xtris_1.15-9_amd64.deb around with you. It'll fit nicely on a USB stick as it's only 78K[1] big.<br>
<p>
1. -rw-r--r-- 1 bahner bahner 78K okt.  19  2011 /home/bahner/Dokumenter/xtris_1.15-9_amd64.deb<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814756/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814852"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 20:13 UTC (Fri)
                               by <b>Sesse</b> (subscriber, #53779)
                              [<a href="/Articles/814852/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But Tetrinet is the only social contact I have left in these Covid-19 times!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814852/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor814724"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 12, 2020 23:54 UTC (Thu)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/814724/">Link</a>] (24 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The number of negative dentries needed for a directory depends on the directory. A directory like /usr/include or /usr/bin needs a ton of positive and negative dentries to speed up operation. /tmp should hopefully have almost no negative dentries, since programs shouldn't be looking up non-existent files there (to avoid tmpfile vulnerabilities).<br>
<p>
Having a systemwide number of negative dentries seems like it doesn't adapt well to the directory.<br>
<p>
It seems like we need a couple of heuristics:<br>
<p>
1) Negative dentries that have never been used (meaning a second failed lookup never occurred for that entry) are less valuable, and should be the first thing reclaimed.<br>
<p>
2) Negative dentries should perhaps be limited to some proportion of the *positive* dentries in a directory, rather than an absolute number.<br>
<p>
Also, perhaps we could offer userspace a mechanism to say "this file I'm opening, it would really benefit from fast lookup failures if it doesn't exist", versus "I'm opening a file that's unlikely to be checked for often, any negative dentry is of low value", versus the default of not hinting to the kernel. GCC could hint on its include-file lookups, and execvp could hint on its binary lookups, and glibc could hint on its locale lookups.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814724/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814748"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 9:31 UTC (Fri)
                               by <b>cladisch</b> (<b>&#x272D; supporter &#x272D;</b>, #50193)
                              [<a href="/Articles/814748/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Negative dentries should perhaps be limited to some proportion of the *positive* dentries in a directory, rather than an absolute number.</font><br>
<p>
This would break down for mostly-empty directories that can override other directories later in the search path, such as /usr/local/{bin,lib}.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814748/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814750"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 10:15 UTC (Fri)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/814750/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That's an excellent point; that heuristic alone won't work then.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814750/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814755"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 11:32 UTC (Fri)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/814755/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But if a directory is mostly empty, negative dentries could well be a hindrance. One ovbvious heuristic should be that there should not be more negative than positive dentries, because by that point looking for said negative dentry will be more expensive than finding the positive dentry doesn't exist, no?<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814755/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814759"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 11:54 UTC (Fri)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/814759/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ah, true! If you have a tiny number of actual files, you can very quickly rule out the existence of an entry without needing negative dentries. So, that heuristic might work after all.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814759/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814771"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 13:53 UTC (Fri)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/814771/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It doesn't work. There are three states here -- present, not-present and unknown. Failing to find a positive dentry is not the same thing as finding a negative dentry.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814771/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814850"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 19:44 UTC (Fri)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/814850/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You'd have to make the cache more elaborate and complicate invalidation rules, but you could potentially cache the fact that every (positive) dentry in the directory is cached. Seems like it would be more trouble than it's worth, but technically possible.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814850/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor814883"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 6:26 UTC (Sat)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/814883/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Lookups are done in hash, not in per-directory lists.  And if the length of hash chain is affected by the distribution of dentries among the parents, the hash function is badly fucked.  Do you have evidence of such?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814883/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814898"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 11:47 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/814898/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Premature optimisation is the root of all evil ... :-)<br>
<p>
But does that mean - like someone else suggested - that dentries are path-sensitive? Or are they cached by path-name rather than object-name?<br>
<p>
I was thinking rather simplistically, but it sounds like the problem is somewhat horrid :-)<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814898/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814946"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 20:45 UTC (Sat)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/814946/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; But does that mean - like someone else suggested - that dentries are path-sensitive?</font><br>
<p>
lwn.net probably has an article describing this in excessive detail, however...<br>
There is a single global hash table for dentry lookup.  The lookup key is the memory address of the dentry of the containing directory (the parent) and the name within that directory (which might be treated as case-insensitive).  So the actual name lookup process does not notice how many names are currently cached for a particular directory.  But that isn't really the issue.<br>
<p>
We *cannot* decide to disallow negative dentries for some directories as that would interfere with file creation.  To create a new file, we first allocate a dentry and try to populate it via a lookup.  If that fails, then we have a negative dentry which acts as a place holder.  A lock on that dentry will prevent anyone else from acting on the same name (I don't think we currently use that fact as much as we could).<br>
<p>
We do have directories where we *know* that all entries are in the dcache - tmpfs for example and anything else that uses "simple_lookup".  We could set a very short time-to-live for negative dentries in those directories (though we would still want the ttl to be an order of magnitude more than that cost of allocating and freeing a dentry), and we might be able to let a filesystem mark a directory as 'fully-cached'.  I doubt there are many workloads that would really benefit though.<br>
(Here's a crazy idea.  Any directory that hasn't been changed for N seconds gets a 'bloom-filter' attached when a readdir happens.  The bloom filter is given the names of all existing objects in the directory.  When a negative dentry is added that is *not* in the bloom filter, the dentry goes on a separate LRU with a short lifetime - the justification being that repopulating such negative dentries is cheap, requiring only a re-check of the bloom filter.   Would this complexity be worth the benefit.... I doubt it).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814946/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor815136"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 16, 2020 23:59 UTC (Mon)
                               by <b>luto</b> (subscriber, #39314)
                              [<a href="/Articles/815136/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This isn’t necessarily a good idea, but: couldn’t a directory have a no-negative-dentry flag that is ignored for file creation?  That is, for a lookup that isn’t associated with file creation, no negative dentry would be created.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/815136/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor814977"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 15, 2020 15:33 UTC (Sun)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/814977/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Huh?  How the hell could they _not_ be path-sensitive and be of any use?  After all, the same name in different directories usually refers to different objects.  They are hashed by (pointer to parent dentry, name) pairs, and no, we are not doing a hash table per directory, TYVM - _that_ would have a horrible memory footprint for no good reason...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814977/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814979"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 15, 2020 18:06 UTC (Sun)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/814979/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I was thinking that if you were doing a lookup for lib.so, it might have a list of directories where you *wouldn't* find it.<br>
<p>
Or the dentry list was "per directory". If you've got more entries in the negative dentry list than there are in the directory, then it makes sense to ditch the negative dentry list completely because it costs more to search the negatives than the positives - and the other responses I've had here imply that that's not true ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814979/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor814773"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 14:28 UTC (Fri)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/814773/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A lot of people espouse the opinion that the number of negative dentries should be proportional to the number of positive dentries, and there doesn't seem to be a lot of reason why.<br>
<p>
If your search path is /home/josh/lib:/usr/local/lib:/usr/lib:/lib<br>
you're going to want to cache the fact that libiberty.so is not found in the first two, but is in the third. So for this specific lookup case you need twice as many negative as positive dentries.<br>
<p>
If your workload involves a lot of looking for libraries, then this ratio will dominate. If your workload is almost anything else, then some other ratio would be better.<br>
<p>
Right now, our number of negative dentries is really only constrained by the amount of memory in the machine, which is ridiculous. I want to use that memory for caching useful things, not that Tetris is not present in /home/willy/bin.<br>
<p>
This is why I say we need to autotune the number of negative dentries. And once we're autotuning the number of negative dentries, it doesn't matter whether we express that as a fraction of the number of positive dentries, or as an absolute number. Either way, we have a target number of negative dentries and need to adjust the target up or down, depending on how the workload is behaving.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814773/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814780"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 15:07 UTC (Fri)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/814780/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Borrowing a bit from DNSSEC, could the negative entries be represented as a range rather than specific names? Then the maximum number of negative entries—at least for compatible filesystems—would be limited to one more than the number of entries in each directory. The filesystem would need to report the first and last contiguous missing names around the missing entry on lookup. Smaller approximate ranges (with length=1 being the current behavior) could be used where necessary, e.g. network filesystems that aren't set up to report the necessary information. Adjacent or overlapping ranges would be merged in the cache.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814780/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814910"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 13:13 UTC (Sat)
                               by <b>jlayton</b> (subscriber, #31672)
                              [<a href="/Articles/814910/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Doubtful. The names are stored in a hashtable. Representing a range of entries in there would be pretty hard to do. I suppose you could layer on some sort of negative range carveout  mechanism on top of the hashtable, but that sounds a bit nasty.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814910/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor814857"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 20:46 UTC (Fri)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/814857/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  Either way, we have a target number of negative dentries and need to adjust the target up or down, depending on how the workload is behaving.</font><br>
<p>
Is this just a case of having a separate LRU for negative dentries, and then setting a different 'seeks' count for the relevant shrinker?<br>
<p>
(I'm reminded that cache invalidation is one of the three hard problems of computer science, along with naming things).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814857/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814859"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 20:52 UTC (Fri)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/814859/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Since this is a cache of names, it must be a CS-hard problem and thus almost intractable?<br>
<p>
I think we need more than a simple LRU list. If I have my cache sized nicely for compiling the kernel and someone else comes along and uses that program that deliberately opens 50k files that don't exist, I don't want it to compete against the negative dentries that have proven useful in the past. Perhaps we need an LFU. I'm not conversant with the latest techniques in preventing cache pollution.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814859/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814891"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 10:06 UTC (Sat)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/814891/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; and thus almost intractable?</font><br>
<p>
not "almost".<br>
<p>
<font class="QuotedText">&gt; that have proven useful in the past. </font><br>
<p>
Past performance is not indicative of future results.<br>
<p>
This is *exactly* the cache invalidation problem and there is no general solution.<br>
Sometimes you can add RAM so your cache becomes bigger than your working set.<br>
Sometimes you can apply behaviour modification so your working set becomes smaller than your cache.<br>
Sometimes you can slip in a heuristic that helps your use case today, and no-one else notices.<br>
<p>
But there is very little else that can be done.<br>
The dcache already has a "referenced" flag which results in never-referenced dentries having shorter life expectancy.  That sometimes helps, but I suspect it sometimes hurts too.<br>
<p>
We have a few interfaces to allow programs to voluntarily be less demanding on the page cache (so we can apply behaviour modification to code).  Maybe O_PONIES ... sorry, I mean O_NO_NOCACHE for filename lookup that limits the caching of negative entries created for that lookup.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814891/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814895"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 11:13 UTC (Sat)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/814895/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; This is *exactly* the cache invalidation problem and there is no general solution.</font><br>
<p>
My understanding is that "the cache invalidation problem" refers to the difficulty of making sure that nobody has a stale entry (eg TLB invalidation) rather than the difficulty of knowing what to cache. Maybe that just reflects my biases as someone who has no control over what the CPU decides to cache.<br>
<p>
The primary difficulty here is deciding how many negative dentries to allow. How to detect thrashing (a signal to increase the number of dentries allowed) and how to detect underutilisation of the cache (an opportunity to shrink the dcache and give the memory back).<br>
<p>
Do you have any insight into how we might measure the effectiveness of the current cache?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814895/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814939"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 20:23 UTC (Sat)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/814939/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; ... refers to the difficulty of making sure that nobody has a stale entry .... rather than the difficulty of knowing what to cache.</font><br>
<p>
The fact that these two problems might have the same name is certainly delightful.<br>
I would describe "the cache invalidation problem" as "choosing whether to invalidate something, and what, and when".<br>
<p>
<font class="QuotedText">&gt; The primary difficulty here is deciding how many negative dentries to allow. </font><br>
<p>
I think that is a narrow formulation.  If you look at the email that introduced the recent patches you will see two problems:<br>
1/ speed of cleaning up negative dentries  at unmount<br>
2/ speed of freeing up memory used by negative dentries when memory is needed for something else.<br>
<p>
i.e.  the problem is speed.  Reducing the number of negative dentries might help - certainly with 1, probably with 2 - but it is a secondary issue, not a primary one.<br>
Problem 1 could be addressed with some sort of lazy-unmount protocol.  We don't *need* to release all cache memory before reporting success for unmounting a filesystem.  We just need to be sure it can be released (not currently in use) and that it cannot be accessed again.<br>
<p>
Problem 2 could be addressed by optimizing the code (maybe - it's probably quite light weight already ... though I wonder if a negative dentry needs to be linked into the list from its parent - probably not if an alternate way could be provided to invalidate the -&gt;parent pointer when the parent is  freed) or by pruning negative dentries earlier (hence my comment about a shrinker with a different 'seeks' value) or by pruning some other cache - because when you need memory, you don't much care exactly what is sacrificed to provide it.<br>
<p>
<font class="QuotedText">&gt; Do you have any insight into how we might measure the effectiveness of the current cache?</font><br>
<p>
Disable it and try to get some work done.<br>
Any cache provides diminishing returns as it grows beyond the size of the working set, and as the "working set" changes over time, you can only hope for an approximate size.  We have that by applying modest vm pressure.<br>
The best heuristic for "should I provide more pressure on caches" is "am I being asked to apply lots of pressure".  So the more often we need to find free memory, the more memory we should find each time (do we already do that?)<br>
But that needs to be balanced against the risk of creating unnecessary pressure by pruning things that are needed again soon (thrashing).  Maybe there is value in keeping a bloom filter recording identifies of recently pruned objects, and if the hit rate on that suggests we are re-populating objects that were recently removed, we could slow down the pruning.  I suspect there are some circumstances were such a filter would help, but I doubt it would really be useful in general.<br>
<p>
A really big problem with this stuff is that you cannot improve estimates of need without accounting of some sort, and any accounting has a cost - particularly global accounting on a multi-core multi-cache machine.  As the primary problem is speed, you want to make sure that cost is (nearly) invisible.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814939/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor814964"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 15, 2020 7:17 UTC (Sun)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/814964/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; My understanding is that "the cache invalidation problem" refers to the difficulty of making sure that nobody has a stale entry (eg TLB invalidation) rather than the difficulty of knowing what to cache. Maybe that just reflects my biases as someone who has no control over what the CPU decides to cache.</font><br>
<p>
A cache with a poor invalidation strategy is more succinctly known as a "memory leak."<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814964/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor815236"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 17, 2020 20:25 UTC (Tue)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/815236/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The primary difficulty here is deciding how many negative dentries to allow. How to detect thrashing (a signal to increase the number of dentries allowed) and how to detect underutilisation of the cache (an opportunity to shrink the dcache and give the memory back).</font><br>
<p>
Just track the hit rate, hits versus misses versus additions for lookups across the entire cache? If there are many more additions than hits, shrink the cache; if there are many more misses than hits, grow it. (Or something like that.)<br>
<p>
(Downside: this sort of global counter is a cache nightmare, but the figures need only be approximate, so the usual trick of having per-CPU counters occasionally spilled into a global counter should work fine.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/815236/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor814886"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 7:23 UTC (Sat)
                               by <b>mm7323</b> (subscriber, #87386)
                              [<a href="/Articles/814886/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It feels like speeding up path search is a lot of the reason for wanting negative dentries, but at the same time the number of path entries searched before a 'hit' will act as a multiplier for the number of negative dentries needed for an effective cache.<br>
<p>
Since adding system calls for specific cases seems popular these days, how about adding something to resolve path search with a positive cache in the kernel e.g. int pathsearch(const char *filename, char *const path[] /* NULL terminated list of paths */); which returns either the index of the first path where filename exists or -ENOENT etc...<br>
<p>
The cache structure maybe complex, requiring the path list and filename to be combined to a key, but this could then implement a positive cache with one entry per (successful) lookup, as a single system call from userspace (rather than repeated calls to access(), open() or exec() as is typically done for path search now).  Other file system operations would also need to invalidate the cache as needed, possibly in vast swathes depending on how fast vs fine grained invalidation would want to be.<br>
<p>
Such a cache could be made in userspace, using inotify() for invalidation and some sort of daemon with IPC to share the cache between processes (e.g. repeated invocations of gcc looking for includes), but it would probably be a bit racy and not give the full performance benefit.<br>
<p>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814886/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor814913"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 13:36 UTC (Sat)
                               by <b>jlayton</b> (subscriber, #31672)
                              [<a href="/Articles/814913/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; 2) Negative dentries should perhaps be limited to some proportion of the *positive* dentries in a directory, rather than an absolute number.</font><br>
<p>
This idea completely breaks down once you have to deal with (most) network filesystems. NFS (e.g.) won't tell you anything about the number of entries in a directory when you do a LOOKUP, and in any case that info might be invalid the moment the LOOKUP reply leaves the server.<br>
<p>
I just don't see how the number of positive dentries is at all connected to how many negative dentries we should cache per directory.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814913/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor814725"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 12, 2020 23:59 UTC (Thu)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/814725/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;    openat(AT_FDCWD, "/usr/lib/locale/en_US.utf8/LC_IDENTIFICATION", O_RDONLY|O_CLOEXEC) = 3</font><br>
<p>
Tip for faster program startup: set LANG and possibly LC_MESSAGES to your preferred UTF-8 locale, and set most of the other LC_* variables to C. Some of them are useless and should never be used (LC_NAME, LC_TELEPHONE), and some are things you might not want anyway (LC_COLLATE).<br>
<p>
echo for me generates only 6 openat calls, of which only 2 are failed lookups.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814725/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814832"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 16:32 UTC (Fri)
                               by <b>nivedita76</b> (guest, #121790)
                              [<a href="/Articles/814832/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
On my gentoo system, it generates only 3 openat calls, all of which are successful.<br>
<p>
The only failed lookup is<br>
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814832/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor816175"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2020 2:29 UTC (Sat)
                               by <b>Hello71</b> (subscriber, #103412)
                              [<a href="/Articles/816175/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
yeah, seems like corbet's system is misconfigured. /usr/lib64/locale/locale-archive should have all the /usr/lib/locale files already cached, specifically so it is not necessary to go sniffing for them. same with other files, /etc/ld.so.cache caches location of shared libraries. cache invalidation is simple: punt it to the package manager, which must always run ldconfig after changing shared libraries.<br>
<p>
I get 21427 ENOENTs for allmodconfig with a fresh O=, and 8161 with an existing one. less with in-tree builds.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/816175/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor816407"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 1, 2020 12:19 UTC (Wed)
                               by <b>mgedmin</b> (subscriber, #34497)
                              [<a href="/Articles/816407/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Debian stopped building locale-archive back in 2011 because it was causing problems for them (<a href="https://bugs.debian.org/537743">https://bugs.debian.org/537743</a>, <br>
<a href="https://bugs.debian.org/636694">https://bugs.debian.org/636694</a>, <a href="https://bugs.debian.org/638173">https://bugs.debian.org/638173</a>).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/816407/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor814733"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 2:18 UTC (Fri)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/814733/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Dave Chinner, instead, wondered about the need for this kind of mechanism at all. He suggested that the offending applications should just be confined to a memory control group.</font><br>
<p>
Wait, if one application/control groups populates this negative dentry:<br>
<p>
openat(AT_FDCWD, "/lib64/libc.so.6", O_RDONLY|O_CLOEXEC) = 3<br>
<p>
... then no other application/control group would benefit anymore because negative dentries are confined and not shared across control groups? That sounds like a bit too much isolation.<br>
<p>
I guess you could split each dentry and its cost into "shares" for each control group but that could become very complicated very quickly. The eviction policies could be... fun. "Least recently used" - by whom and when?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814733/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814768"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 13:49 UTC (Fri)
                               by <b>Paf</b> (subscriber, #91811)
                              [<a href="/Articles/814768/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No, just memory tracking for the dentries would be divided; they’re still in the regular cache, it’s just that their memory usage is tracked against the limit for that specific control group.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814768/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814884"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 6:48 UTC (Sat)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/814884/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; it’s just that their memory usage is tracked against the limit for that specific control group.</font><br>
<p>
for which "specific" group? A read-only page can be used by any number of groups.<br>
<p>
Apparently there was an attempt to "charge" each memory page to only one group: <a href="https://lwn.net/Articles/443241/">https://lwn.net/Articles/443241/</a> Did this get merged and again: charged to which group?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814884/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor814730"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Program launch seems to be a key factor</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 2:19 UTC (Fri)
                               by <b>gus3</b> (guest, #61103)
                              [<a href="/Articles/814730/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As a user (or even several users) go about the day's work, they launch programs like command shells, web browsers, integrated office suites, and site-specific options such as NEdit or Vivaldi. The positive-negative dentry ratio probably reaches a stable value as the OS stays up. Individual users' files that get opened would impact that ratio very little, even if a regular user has a chroot program that crashes and re-starts every 30 seconds.<br>
<p>
So why not specify the dentry cache as a ratio of positive-to-negative? The dentry cache can be split 2:1 or 3:1 or 50:1, giving positive dentries N positions for every 1 negative dentry position. Calculate the dentry cache size, then split the cache and move forward, with effectively two caches. As lookups get called, the caches get refreshed, both successes and failures. Eventually, the stale entries in each cache become invalidated and ejected, while the survivors continue to speed up performance.<br>
<p>
On a basic desktop system, a 3- or 4-to-1 ratio might suffice for performance. On a particular server like FreeDB, the ratio would probably be very different. But that seems to me to be a basic, yet powerful sysctl tuning knob.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814730/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor814738"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 6:49 UTC (Fri)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/814738/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; A quick "allmodconfig" kernel build run</font><br>
<p>
Heh. "quick" and "strace -f make allmodconfig" are still mutually exclusive for most people out there.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814738/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor814739"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 8:00 UTC (Fri)
                               by <b>bokr</b> (subscriber, #58369)
                              [<a href="/Articles/814739/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
ISTM if a command does something dumb so much that it noticeably<br>
slows down the system, or delivery of its result, the answer is not for<br>
the file system to make the dumb thing faster, but rather to eliminate<br>
the  calls on the file system to do the dumb things (i.e., look for files<br>
known not to be there).<br>
<p>
It sounds like the local file version of going through a fixed mirror list<br>
and chewing doggedly through it in order a to z for every file to be downloaded.<br>
<p>
IME locale data files provide a consistently bad example.<br>
Couldn't systemd run something once per bootup and store a "mirror list"<br>
e.g. in ~/.cache/.../locale_files.d/ as links to do what positive dentry  does (IIUC)<br>
and avoid hitting need for negative dentry at all? <br>
<p>
Maybe glibc could provide a generic jit-able wrapper for abis to self-tune<br>
by re-ordering a vtable of files, so as to learn to get a hit on the first try?<br>
(it would need to store its state changes somewhere like ~/.cache or /var/run/ or?<br>
<p>
Anyway, IMO the file system should not be an enabler for bad app habits.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814739/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814751"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 10:41 UTC (Fri)
                               by <b>hkario</b> (subscriber, #94864)
                              [<a href="/Articles/814751/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
when you have literally thousands upon thousands of applications that exhibit this kind of behaviour, it's far simpler to fix it in one place than in thousands<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814751/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814846"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 19:32 UTC (Fri)
                               by <b>bokr</b> (subscriber, #58369)
                              [<a href="/Articles/814846/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I would agree if it were a "fix," but it is not.<br>
How does that "fix" provide a path to better next versions<br>
of those "thousands upon thousands of apps"? It doesn't.<br>
 <br>
It lets app developers continue with bad design, perhaps<br>
even unwittingly, because the clever file system implementers<br>
have hidden the worst effects of the bad app (or lib used) design.<br>
<p>
It's great to optimize file operations and make bad apps usable, but it<br>
doesn't "fix" them :)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814846/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814854"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 13, 2020 20:33 UTC (Fri)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/814854/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Blaming application developers is futile. As the article shows, even a trivial "hello world" program like /usr/bin/echo goes traipsing all over the filesystem looking for locale files, shared libs, and so on. I very much doubt the actual GNU Coreutils source for echo has any of those lookups in its main(). This is a libc problem. Wearing my sysadmin hat for a moment, I do not want to deal with the flag day that will ensue when libc removes all of those lookups in favor of (something else).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814854/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor815025"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 16, 2020 12:21 UTC (Mon)
                               by <b>hkario</b> (subscriber, #94864)
                              [<a href="/Articles/815025/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
... and the problem with security issues is that developers need more education.<br>
<p>
If only we did find some time in the past 50 years to teach them, we would eliminate them completely! /s<br>
<p>
It's not only libc problem, as the article pointed out there are others that do the same, like NSS, and thus Firefox.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/815025/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor814893"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 10:39 UTC (Sat)
                               by <b>dezgeg</b> (subscriber, #92243)
                              [<a href="/Articles/814893/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; IME locale data files provide a consistently bad example. Couldn't systemd run something once per bootup and store a "mirror list" e.g. in ~/.cache/.../locale_files.d/ as links to do what positive dentry does (IIUC) and avoid hitting need for negative dentry at all?</font><br>
<p>
Glibc can already do that, by the means of the locale-archive database. But as is apparent from the listing in the article, whichever distro is used has not enabled it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814893/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor814905"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 13:00 UTC (Sat)
                               by <b>pr1268</b> (subscriber, #24648)
                              [<a href="/Articles/814905/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <p>How expensive is the management of negative dentries (or dentries in general)?</p>

<p>For example:</p>

<ol>
<li><tt>openat(AT_FDCWD, "cowbell",  O_RDONLY|O_CLOEXEC)</tt> = -1</li>
<li>Kernel adds negative dentry</li>
<li>User types at keyboard <tt>$ <a href="https://youtu.be/cVsQLlk-T0s">touch cowbell</a></tt> (in <tt>FDCWD</tt>)</li>
<li>Kernel adds positive dentry</li>
<li>Kernel removes negative dentry</li>
</ol>

<p>Couldn't this get a little expensive sometime? (I'm unsure what order 4 and 5 would happen.)</p>

<p>And I'm referring to how the kernel does things _now_.</p>

<p>Also, couldn't dentries be set for directory names? (I'm referring to the part about <font class="QuotedText">&quot;... the negative dentries were created by deleting a large directory full of files&quot;</font> blurb of the <a href="https://lwn.net/Articles/1511/">2002 LWN article</a> linked above.)</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/814905/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814919"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 14, 2020 15:39 UTC (Sat)
                               by <b>dezgeg</b> (subscriber, #92243)
                              [<a href="/Articles/814919/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Steps 4. and 5. are just a single step: the existing negative dentry for cowbell is turned into a positive one. All file creations are done this way (regardless of whether the cowbell negative dentry existed in memory due to openat attempt or not).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/814919/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor814966"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 15, 2020 7:34 UTC (Sun)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/814966/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>Just to clarify, are you saying that the kernel is doing this?
<ol>
<li>Check for a matching dentry in the cache.
<li>If the dentry is absent from cache, do a "real" lookup of the path in question.
<li>Now the dentry is definitely in cache, either because it was already there or because the previous step caused it to become cached.
<li>If the cached dentry is positive, open it or fail with EEXIST as appropriate for the state of the O_EXCL flag.
<li>If the cached dentry is negative, change it to positive and mark it dirty.
<li>That's it. Eventually, the cached dentry will get written out to disk, but that's not our problem right now.
</ol>
<p>(Obviously, I have omitted numerous failure modes which we don't need to care about for the purposes of this discussion.)
      
          <div class="CommentReplyButton">
            <form action="/Articles/814966/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor815204"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 17, 2020 15:02 UTC (Tue)
                               by <b>jezuch</b> (subscriber, #52988)
                              [<a href="/Articles/815204/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I noticed the clever product placement. Nicely done! ;)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/815204/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor815384"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 19, 2020 3:08 UTC (Thu)
                               by <b>faramir</b> (subscriber, #2327)
                              [<a href="/Articles/815384/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It seems to me that the number of negative dentries per directory should be in some way based on the actual number of files in the directory (if that is knowable).   The whole point of having negative dentries is to avoid having to search an entire directory just to come up empty.  The cost of doing that search is likely to be dependent on how a particular filesystem does lookups and the number of files in the directory.  In the limit where a directory is empty, I would argue the number of negative dentries allowed should be 0 as doing a full search of an empty directory is likely to be cheap.   The time vs. space tradeoffs of doing lots of failed lookups vs. negative dentry memory use isn't clear to me, but might be to people with more experience in this area.  This may at least give an upper bound on the number of negative dentries which MIGHT be useful.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/815384/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor815665"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 21, 2020 8:25 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/815665/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You've just made the same mistake I did higher up. See Neil Brown's answer to me.<br>
<p>
(Over)Simply put, the *path* name is hashed, and use to look up the table. (I guess that's over-simplistic, but the idea is close enough.) The lookup never goes anywhere near the directory itself.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/815665/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor816049"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 26, 2020 15:25 UTC (Thu)
                               by <b>mtmmtm</b> (guest, #137939)
                              [<a href="/Articles/816049/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I do not agree that there is a need for a negative cache. Having such a cache would be a waste of memory. Doing a lookup into a tree-structure has an almost constant lookup-time O(log n). Adding another negative-cache would just take more time (now you must search in 2 tree:s). My guess is that the wrong data-structure is used (where a lookup is slow). Another thing is that lib-c or similar should not look for non-existing files (it should know exactly what files to open (in a cache?)).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/816049/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor816057"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 26, 2020 15:38 UTC (Thu)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/816057/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For file creation, negative entries are turned into positive entries, so they're not completely useless. They're stored in the same tree here in any case.<br>
<p>
<font class="QuotedText">&gt; Another thing is that lib-c or similar should not look for non-existing files</font><br>
<p>
How would any libc know they don't exist without searching? If you mean for internal things, PATH (and other search mechanisms) are going to be pretty broken if every search "should" hit…<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/816057/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor816387"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Dentry negativity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 31, 2020 19:03 UTC (Tue)
                               by <b>mtmmtm</b> (guest, #137939)
                              [<a href="/Articles/816387/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, for file creation it could work (but it would work even better without it (just one missed hash-lookup)).<br>
There is a hash and rehash-command for updating the hashtable in most shells. I think bash search every directory in PATH if it fails to find the executable in it's hashtable. Sounds like a bad idea to me. Not sure where the hashtable is located, but having ONE hashtable would be most efficient.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/816387/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2020, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
