        <!DOCTYPE html>
        <html lang="en">
        <head><title>Online filesystem scrubbing and repair [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/718800/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/718500/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/718800/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Online filesystem scrubbing and repair</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ready to give LWN a try?</b>
<p>
With a subscription to LWN, you can stay current with what is happening in the Linux and free-software community and take advantage of subscriber-only site features.  We are pleased to offer you <b><a href="https://lwn.net/Promo/nst-trial/claim">a free trial subscription</a></b>, no credit card required, so that you can see for yourself.  Please, join us!
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>April 5, 2017</br>
           <hr>
<a href="/Articles/lsfmm2017/">LSFMM 2017</a>
</div>
<p>
In his traditional LSFMM session to "whinge about various things", Darrick Wong
mostly discussed his recent work on online filesystem repair for XFS, but
also strayed into some other topics.  Online filesystem scrubbing for XFS
was one of those, as was a new <tt>ioctl()</tt> command to determine block
ownership.</p>

<p>
He started with the <a href="/Articles/714985/"><tt>GETFSMAP</tt>
<tt>ioctl()</tt> command</a>, which allows querying a filesystem to
determine how its blocks are being used (which blocks contain data or
metadata and which are free).  He has patches for XFS that are reviewed
and ready 
to go for 4.12.  Ext4 support is out for review.  Chris Mason said that
there are <tt>ioctl()</tt> commands for Btrfs that can be remapped to
<tt>GETFSMAP</tt>. 
</p>

<a href="/Articles/718794/">
<img src="https://static.lwn.net/images/2017/lsfmm-wong-sm.jpg" border=0 hspace=5
align="right" alt="[Darrick Wong]"
title="Darrick Wong" width=280 height=229>
</a>

<p>
Wong then described 
an online scrubbing tool for XFS that he has been working on. 
Right now, it examines the metadata in the filesystem and complains if
there is something that is "clearly insane".  Part two will be posted soon
and will cross-check metadata with other metadata to make sure they are all
in agreement.  The tool will also use <tt>GETFSMAP</tt> to read all file-data
blocks using direct I/O to check to see if any give read errors.
</p>

<p>
Damien Le Moal suggested that the RAID rebuild assist feature of some
storage devices could be used
to either get the data or get a failure quickly.  Wong asked if there was a
way to get a list of LBAs with read errors, but that isn't supported.  Fred
Knight 
said that using RAID rebuild assist will cause the device not to try any
"heroic recovery" and simply return errors.  Wong said that he hasn't done
much work on reading from the device yet as he has been concentrating on
the filesystem side.
</p>

<p>
For online repair for XFS, he has been working on using the reverse mappings to
reconstruct the primary metadata for corrupted filesystems.  He does not
want to use the metadata that is left over because it may be corrupted
too.  There is a problem, though, if you have to recreate the secondary
metadata (e.g. the reverse mapping) because you run into a deadlock
situation. 
</p>

<p>
The deadlock is avoided by freezing the filesystem so there is no access to
the inodes.  Inode by inode, this restriction is relaxed as the reverse
mapping is rebuilt.  The block device is not frozen, just the filesystem,
but he wondered if that was a sane thing to do.  It is not the intended use
case for filesystem freezing, but it seems to work.  That is the only part
of online repair where the filesystem "has to come to a screeching halt",
he said.
</p>

<p>
There is no secondary metadata for directories right now, so the online
repair just moves corrupted directories to <tt>lost+found</tt> or removes
them if they are too corrupted.  XFS doesn't have parent directory pointers
that might be used to help repair directory corruption.
</p>

<p>
There is still no good way to remove open files, Wong said.  He thought it
might be possible to rip the file's pages out of the page cache, replace
the inode operations and mapping fields with dummy values that just return
errors, and to try to put the inode on the orphan list.  Matthew Wilcox asked
if writeback would be done before the pages are removed from the page
cache; Wong said that was an open question.
</p>

<p>
Mason said that Facebook does no online repair.  If a filesystem gets
corrupted, it is taken out of production and restored to a working state
before being returned to service.  Various aspects of the filesystem change
(e.g. latencies) while online repair is in progress, so the company just
does not bother. 
Ted Ts'o said that the cloud world tends to have enough redundancy that
doing online repair isn't really needed, but in other worlds that is not
true.  Wong said that the feature is targeted at users who are willing to
trade "some to a lot of latency" for the ability to not have to take a
volume offline.
</p>

<p>
A way to specify a "desperation" flag in block I/O requests is on his
wish list, Wong said.  Setting that would mean that the block layer should
go read RAID-1 mirrors or invoke stronger error recovery to read a block.
He would like to use that when a block read succeeds but the checksum
doesn't match.
</p>

<p>
He asked the room if anyone was making progress on filesystem freezing
before suspend operations.  Mason said that the use of the work queue
<tt>WQ_FREEZABLE</tt> flag was "all wrong" as described in
a Kernel Summit <a href="/Articles/705269/">session</a>.  The code for the
filesystems had all been cut and 
pasted and was simply wrong.  He had thought that someone was planning to
fix that, but was not sure where that effort had gotten.
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems">Filesystems</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Storage_Filesystem_and_Memory-Management_Summit-2017">Storage, Filesystem, and Memory-Management Summit/2017</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/718800/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor719098"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 5, 2017 23:35 UTC (Wed)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/719098/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
The tool will also use GETFSMAP to read all file-data blocks using direct I/O to check to see if any give read errors
</blockquote>
I hope this respects I/O priorities, so you can run the tool under ionice to run it in idle mode -- both because it's more polite to other users, and because very soon bcache will use these hints to avoid caching the reads on the SSD (for scrubbing, that would blow the entire cache and likely age the SSD significantly).

      
          <div class="CommentReplyButton">
            <form action="/Articles/719098/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor720115"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2017 8:20 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/720115/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't get this. If I remember that article on SSD life a while back, it's only writes that age an SSD. So why would reading the entire device (or not caching the device, and reading everything every time) age the SSD?<br>
<p>
(Oh, and I seem to remember the same article saying that even if you ran continuous read/write passes on an SSD with no break, it would still take several years to kill it.)<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/720115/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor720378"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2017 15:12 UTC (Wed)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/720378/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Because bcache works by caching reads from an underlying block device on another device -- usually one caches rotational storage on a device with faster or near-zero seek time, like an SSD. It tries to detect contiguous reads from the underlying device and avoid caching them, but this is not 100% perfect and cannot kick in at once, but only after a few megabytes of reads have been cached, probably pointlessly -- it is better to note that the rotational block device reads are low priority when they are something like a pvmove (which really *is* low priority): these are assumed to be reads for which seek performance does not matter, and thus recent bcache will not cache them.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/720378/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor720379"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2017 15:14 UTC (Wed)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/720379/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
(Oh, and I seem to remember the same article saying that even if you ran continuous read/write passes on an SSD with no break, it would still take several years to kill it.)
</blockquote>
That's definitely not true of most SSDs. Mine, a fairly expensive Intel one, is rated for several complete device writes per day, every day for five years. However, the device is only 480GiB and it writes at about 500MiB/s, so it only takes a thousand seconds to write to the entire device (though in practice I suspect this would slow drastically due to GC pauses etc). And for many of these SSDs, replacing them means pulling open the machine and messing about on the motherboard -- it's much more risky and worrisome than just swapping a disk would be.
      
          <div class="CommentReplyButton">
            <form action="/Articles/720379/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor720412"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2017 17:17 UTC (Wed)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/720412/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Unless you mean *very* cheap machines with a soldered on eMMC device, modern small machines use M.2 SSDs. Slightly older ones use a 2.5" laptop drive bay.<br>
<p>
Changing a M.2 card is much the same as changing a RAM stick. I suppose that is worrying to some people?<br>
<p>
I think the people worried by it would be exactly as worried as they would be changing out *any* computer hardware.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/720412/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor720791"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 24, 2017 16:39 UTC (Mon)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/720791/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Let's see, is pulling the side of my machine off and unplugging things from the motherboard worrying, given that I have static-shocked machines into destruction by touching the backplate accidentally while plugging in a monitor cable while the case was still on? Yes, yes it bloody well is. (I tried to change a DIMM once, too. The machine never booted again.)<br>
<p>
Not everyone is cut out to deal with hardware, even if it doesn't need desoldering.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/720791/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor720792"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 24, 2017 16:45 UTC (Mon)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/720792/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Have you tried an anti-static wrist strap plugged into a ground?<br>
<p>
Some people have high levels of static electricity around them. Because of their skin moisture, their environment humidity levels, or the kinds of clothes and shoes they wear.<br>
<p>
I don't remember ever zapping anything while I was wearing a strap. I've also got a grounded work pad, for putting the computer and parts on while working on it.<br>
<p>
If you're a naturally staticky person these precautions may be needed. Assuming that you ever want to work on the insides of the PC. Some people know how but have no interest in it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/720792/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor720809"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 24, 2017 21:51 UTC (Mon)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/720809/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Every time I open a machine I try something different. I tried antistatic wrist straps. I tried rubber gloves. I tried rubber-soled shoes. I tried bare feet and tinfoil on the floor running out to something I hoped was grounded. I tried holding onto a hopefully-grounded lump of metal the entire time I was using it (really fun trying to work with one hand). Nothing worked. (But it may be that none of that was grounded. Honestly, except for the shielded and inaccessible earth pins in the power sockets, and I suppose the ground outside, I don't know what in a UK domestic property *is* grounded.)<br>
<p>
I stopped trying to touch hardware about seven or eight years ago. I buy it and never open it again: sliding hotswap drives in is my limit. I'll pay someone who is not made of static electricity to do anything more. (And who doesn't have my terrible coordination and muscle tremors. Plus, you just *know* the machine will go wrong in the summer when I am made of hay fever. Massive sneezes are not compatible with hardware work. Or with software work, really, but you can fake it more easily with software.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/720809/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor720825"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 25, 2017 7:14 UTC (Tue)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/720825/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <p>FWIW, when I worked in a place with an on-site factory that handled ESD-sensitive items (BGA chips for rework), the standard for static handling was two <a href="http://uk.rs-online.com/web/p/esd-safe-mats/7872111/">big RS ESD-safe mats</a> connected to the same earth, and <a href="http://uk.rs-online.com/web/p/reusable-gloves/1304442/">Uvex ESD gloves</a>. You stood in socks on one ESD-safe mat, you put the work item on the bench on the other, both shared an earth so that there was no charge gradient across you, you used the wriststrap to ensure that your body was at the same potential as the mat the work item was on (in case your socks were insulating), and you wore the ESD gloves to reduce the risk further. Kinda expensive for a home setup, though...
<p>The other trick the factory workers all worked to was "cotton work clothes only" - apparently synthetics and wool were more likely to result in you getting zapped when you stepped on the mat than cotton was, and that wasn't a pleasant feeling.
<p>Note that domestic rubber gloves aren't suitable - they tend to be static accumulators, as they don't have the conductive layer to dissipate static charges, and can make the zap worse. Same goes for non-ESD rated rubber-soled shoes - they can cause the static charge to build up where it might otherwise dissipate. It's easy to make your ESD problem worse if you're not using the right kit :-(
      
          <div class="CommentReplyButton">
            <form action="/Articles/720825/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor721065"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 26, 2017 19:46 UTC (Wed)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/721065/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Fascinating! A real belt-and-braces approach, which makes sense when you're dealing with a lot of items that will cost real money if just one worker static-shocks them repeatedly.<br>
<p>
I suspected the rubber gloves were a waste of time, but by that point I was fairly desperate :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/721065/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor721068"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 26, 2017 19:52 UTC (Wed)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/721068/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>The bigger reason to be this cautious was the supply constraint rather than the money - $2,000 chips that you can replace at the drop of a hat are annoying if shocked into an early grave, whereas chips where the next fab run isn't for another 6 months are far more worrying if you start blowing through your allotted supply - it's really problematic if you can't ship product for 3 months because some static took out a chunk of your IC supply.
      
          <div class="CommentReplyButton">
            <form action="/Articles/721068/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor720854"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 25, 2017 13:32 UTC (Tue)
                               by <b>intgr</b> (subscriber, #39733)
                              [<a href="/Articles/720854/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Did all of these incidents take place at the same location? If so, I suspect the grounding/earthing in that building is simply faulty or lacking.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/720854/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor720867"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 25, 2017 14:29 UTC (Tue)
                               by <b>cladisch</b> (<b>&#x272D; supporter &#x272D;</b>, #50193)
                              [<a href="/Articles/720867/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; &hellip; the shielded and inaccessible earth pins in the power sockets &hellip;</font>
<p>Schuko sockets have exposed ground pins. Moving to the Continent is a small price to pay for being properly grounded, isn't it?</p>
<p>
Alternatively, to get access to the earth, just <strike>stick a pin</strike> use an earth bonding plug:
<a href="http://uk.farnell.com/multicomp/070-0012/earth-bonding-plug-uk-1x10mm-studs/dp/1687874">[1]</a>
<a href="http://www.antistat.co.uk/section.php/167/1/plugs-bonding-points-esd">[2]</a>
<a href="http://uk.rs-online.com/web/c/safety-security-esd-control-clean-room/esd-control-clean-room/esd-grounding-accessories/#esid=4294960029&amp;applied-dimensions=4294474356">[3]</a>
<a href="https://www.amazon.co.uk/Anti-Static-Earth-Bonding-Plug-UK-x/dp/B00EYM6D3I">[4]</a>
</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/720867/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor721066"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 26, 2017 19:46 UTC (Wed)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/721066/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That looks very useful indeed (not just for electronics work, too). I had no idea any such thing existed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/721066/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor720922"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 25, 2017 19:57 UTC (Tue)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/720922/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Touch unpainted metal pipe-work going into a radiator. That is likely to work.<br>
<p>
See also intgr's comment.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/720922/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor721067"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 26, 2017 19:52 UTC (Wed)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/721067/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Some modern houses have pretty radiators with a metallic cover (no doubt ungrounded nad painted with electrically insulating paint, for the look of the thing) and with all pipework artfully concealed out of sight and out of reach: it goes into the wall directly behind the radiator, so you can't get at it without dismounting the whole thing.<br>
<p>
It's really pretty: the radiators just hang on the wall, not visibly connected to anything practical like pipework, just a radiator and a thermostatic valve supported as if by magic. It also conceals anything that might be in any way electrically connected to earth and is also a complete bugger to maintain (I just turn the plastic-covered emergency stop valve and call a plumber, who curses a blue streak for some time while trying to figure out how the hell to get at any of the pipework).<br>
<p>
The toilets are even worse: all the piping is actually hidden behind a false wall. Makes dealing with leaks, or even spotting them, a huge pile of fun.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/721067/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor719100"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 6, 2017 0:09 UTC (Thu)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/719100/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; A way to specify a "desperation" flag in block I/O requests is on his wish list, Wong said. </font><br>
<p>
You need more than a flag.  You need an index number.<br>
There might be several ways to retrieve a given block.  By default, some optimal choice is made.<br>
In "desperate" circumstances, you want to iterate through all possible mechanisms in turn.<br>
For example, if you have RAID6, you can read the block directly, construct it from all other data blocks plus parity, from all other data blocks plus Q, or from parity and Q and all-but-2 of the data blocks.  A total of  n possible sources if there are n devices in the array.<br>
For an n-drive RAID1, there are obviously n possible sources too.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/719100/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor719132"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 6, 2017 5:16 UTC (Thu)
                               by <b>fratti</b> (guest, #105722)
                              [<a href="/Articles/719132/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;Ted Ts'o said that the cloud world tends to have enough redundancy that doing online repair isn't really needed, but in other worlds that is not true.</font><br>
<p>
Which worlds would online repair be especially worth having? Any critical system which needs a high uptime guarantee surely would have redundancy. So perhaps a use-case where we cannot afford taking a volume offline until someone fixes the filesystem, but the likeliness of file system corruption is not high enough to justify redundancy, like for example a recorder for security camera footage I guess?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/719132/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor719218"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 6, 2017 17:50 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/719218/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Redundancy may not help here -- if the filesystem is replicated, the same bug may bite both instances in the same way.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/719218/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor719384"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 9, 2017 15:05 UTC (Sun)
                               by <b>jengelh</b> (subscriber, #33263)
                              [<a href="/Articles/719384/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;if the filesystem is replicated, the same bug may bite both instances</font><br>
<p>
But if not the filesystem was replicated, but the files? Like, surely there is a FUSE-fs which does file-level RAID-1 ;-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/719384/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor719627"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 10, 2017 22:30 UTC (Mon)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/719627/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah, that would be secure against this. I think "RAIF" might be the right term :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/719627/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor719633"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 11, 2017 0:14 UTC (Tue)
                               by <b>jengelh</b> (subscriber, #33263)
                              [<a href="/Articles/719633/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<a href="https://www.fsl.cs.sunysb.edu/docs/raif/raif.ps">https://www.fsl.cs.sunysb.edu/docs/raif/raif.ps</a><br>
[From the guys that later brought about Linux's unionfs.]<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/719633/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor719338"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Online filesystem scrubbing and repair</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 8, 2017 9:13 UTC (Sat)
                               by <b>niner</b> (subscriber, #26151)
                              [<a href="/Articles/719338/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Just today I had to reboot to a rescue system to btrfsck my desktop's root file system to fix my btrfs send/receive based backup. It's not that big a deal, but having to reboot sucks. Especially when the machine is also the only source of music :)<br>
<p>
Btw. btrfs send/receive seems to be a very good detector for file system errors.<br>
<p>
At work we of course have redundant failover clusters. But those only help for hardware issues (including faulty storage). When there's a file system error in one of the data volumes, all we can do is to take the service offline for fsck. If it's a major breakage we can restore one of the hourly backups, but the first try will always be to salvage everything.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/719338/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2017, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
