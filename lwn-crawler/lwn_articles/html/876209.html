        <!DOCTYPE html>
        <html lang="en">
        <head><title>What to do in response to a kernel warning [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/876209/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/876364/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/876209/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>What to do in response to a kernel warning</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>LWN.net needs you!</b>
<p>
Without subscribers, LWN would simply not exist.  Please consider
       <a href="/Promo/nst-nag2/subscribe">signing up for a subscription</a> and helping
       to keep LWN publishing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>November 18, 2021</br>
           </div>
The kernel provides a number of macros internally to allow code to generate
warnings when something goes wrong.  It does not, however, provide a lot of
guidance regarding what should happen when a warning is issued.  Alexander
Popov recently posted <a
href="/ml/linux-kernel/20211027233215.306111-1-alex.popov@linux.com/">a
patch series</a> adding an option for the system's response to warnings;
that series seems unlikely to be applied in anything close to its current
form, but it did succeed in provoking a discussion on how warnings should
be handled.
<p>
Warnings are emitted with macros like <tt>WARN()</tt> and
<tt>WARN_ON_ONCE()</tt>.  By default, the warning text is emitted to the
kernel log and execution continues as if the warning had not happened.
There is a sysctl knob (<tt>kernel/panic_on_warn</tt>) that will, instead,
cause the 
system to panic whenever a warning is issued, but there is a lack of options
for system administrators between ignoring the problem and bringing the
system to a complete halt.
<p>
Popov's patch set adds another option in the form of the
<tt>kernel/pkill_on_warn</tt> knob.  If set to a non-zero value, this
parameter instructs the kernel to kill all threads of whatever process is
running whenever a warning happens.  This behavior increases the safety and
security of the system over doing nothing, Popov said, while not being as
disruptive as killing the system outright.  It may kill processes trying to
exploit the system and, in general, prevent a process from running in a
context where something is known to have gone wrong.
<p>

There were a few objections to this option, starting with Linus Torvalds,
who <a
href="/ml/linux-kernel/CAHk-=wg+UMNYrR59Z31MhxMzdUEiZMQ1RF9jQvAb6HGBO5EyEA@mail.gmail.com/">pointed
out</a> that the process that is running when a warning is issued may not have
anything to do with the warning itself.  The problem could have happened in
an interrupt handler, for example, or in a number of other contexts.
"<q>Sending a signal to a random process is just voodoo programming, and
as likely to cause other very odd failures as anything else</q>", he
said.
<p>
Torvalds suggested that a better approach might be to create a new
<tt>/proc</tt> file that will provide information when a system-tainting
event (such as a warning) happens.  A user-space daemon could poll that
file, read the relevant information when a warning is issued, then set
about killing processes itself if that seems like the right thing to do.
Marco Elver <a
href="/ml/linux-kernel/YZEbYmzy64uai7Af@elver.google.com/">added</a> that
there is a tracepoint that could provide the relevant information with just
a bit of work.  Kees Cook <a
href="/ml/linux-kernel/202111151116.933184F716@keescook/">threw together an
implementation</a>, but Popov <a
href="/ml/linux-kernel/59534db5-b251-c0c8-791f-58aca5c00a2b@linux.com/">didn't
like it</a>; that approach would allow a process to continue executing
after the warning happens, he said, and by the time user space gets around
to doing something about the situation, it may be too late.
<p>
James Bottomley <a
href="/ml/linux-kernel/88093da62a4b85f015423cbd1ec2f5ad6eb0c5da.camel@HansenPartnership.com/">argued</a>
that all of the approaches discussed so far were incorrect.  If a warning
happens, he said, the kernel is no longer in a known state, and anything
could happen:
<p>
<blockquote class="bq">
	What WARN means is that an unexpected condition occurred which
	means the kernel itself is in an unknown state.  You can't recover
	from that by killing and restarting random stuff, you have to
	reinitialize to a known state (i.e. reset the system).  Some of the
	reason we do WARN instead of BUG is that we believe the state
	contamination is limited and if you're careful the system can
	continue in a degraded state if the user wants to accept the risk.
</blockquote>
<p>
Thus, he said, the only rational policies are to continue (accepting the
risk that bad things may happen) or kill the system and start over — the
options that the kernel provides now.
<p>
Popov had <a
href="/ml/linux-kernel/77b79f0c-48f2-16dd-1d00-22f3a1b1f5a6@linux.com/">suggested</a>
that the <a href="https://elisa.tech/">ELISA 
project</a>, which is working toward Linux deployments in safety-critical
applications, might support the addition of <tt>pkill_on_warning</tt>.  But
Lukas Bulwahn, who works on the project (but who was careful to say he
doesn't speak for ELISA), <a
href="/ml/linux-kernel/CAKXUXMx5Oi-dNVKB+8E-pdrz+ooELMZf=oT_oGXKFrNWejz=fg@mail.gmail.com/">disagreed</a>.
The right solution, he said, is to kill the system on warnings, but also to
ensure that warnings are only issued in situations where things have truly
gone off the rails:
<p>
<blockquote class="bq">
	Warnings should only be raised when something is not configured as
	the developers expect it or the kernel is put into a state that
	generally is _unexpected_ and has been exposed little to the
	critical thought of the developer, to testing efforts and use in
	other systems in the wild. Warnings should not be used for
	something informative, which still allows the kernel to continue
	running in a proper way in a generally expected environment.
</blockquote>
<p>
He added that being truly safe also requires ensuring that a call to
<tt>panic()</tt> will really stop the system in all situations — something
that is not as easy to demonstrate as one might think.  
A <tt>panic()</tt> call might hang trying to acquire a lock, for example. 
<p>

Christoph Leroy <a
href="/ml/linux-kernel/380a8fd0-d7c3-2487-7cd5-e6fc6e7693d9@csgroup.eu/">said</a>
that warnings should be handled within the kernel so that the system can
keep running as well as it can.  Given that, he continued,
"<q>pkill_on_warning seems dangerous and unrelevant, probably more
dangerous than doing nothing, especially as the WARN may trigger for a
reason which has nothing to do with the running thread</q>".  Popov,
however, <a
href="/ml/linux-kernel/265cd2fd-9a9b-625d-a530-299bb7433edf@linux.com/">disagreed</a>
with the idea that one can expect all warnings to be handled properly
within the kernel:
<p>
<blockquote class="bq">
	There is a very strong push against adding BUG*() to the kernel
	source code. So there are a lot of cases when WARN*() is used for
	severe problems because kernel developers just don't have other
	options.
</blockquote>
<p>
Indeed, his patch would, when the new option is enabled, have warnings
behave in almost the same way as <tt>BUG()</tt> calls, which bring about
the immediate end of the running process by default.  As he noted,
developers run into resistance when they try to add those calls because
their effect is seen as being too severe.
<p>
It's not clear that adding an option to make warnings more severe as well
is the best 
solution to the problem.  A good outcome, in the form of some movement
toward better-defined notion of just what a warning means and what should
happen when one is generated, could yet result from this discussion,
though.  Like many mechanisms in the kernel, the warning macros just sort of
grew in place without any sort of overall design.  Engaging in a bit of
design now that there is a lot of experience with how developers actually
use warnings might lead to a more robust kernel overall.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Warnings">Warnings</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/876209/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor876445"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 18, 2021 22:19 UTC (Thu)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/876445/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In the past, &quot;I can make XScreenSaver crash by doing a weird thing&quot; has been a CVE (because if XScreenSaver crashes, the screen unlocks). If someone could find a semi-reliable way to generate a kernel warning while a specific process is executing, then similar attacks might become possible under a pkill_on_warn policy.<br>
<p>
Hopefully, the move to Wayland will obviate that specific instance of the problem, but in the more general case, how does the kernel know that it&#x27;s safe to kill the currently executing process? You might be causing a security problem instead of remedying it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876445/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor876447"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 18, 2021 22:53 UTC (Thu)
                               by <b>a13xp0p0v</b> (guest, #118926)
                              [<a href="/Articles/876447/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That is the right question.<br>
<p>
In theory, the userspace should be adapted to this kernel behavior.<br>
<p>
In practice, currently, the Linux kernel kills processes on oops. OOM killer kills processes. grsecurity also kills processes.<br>
<p>
pkill_on_warn is simply stopping the process when the first signs of wrong behavior are detected. That complies with the Fail-Fast principle.<br>
Bugs usually don&#x27;t come alone, and a kernel warning may be followed by memory corruption or other negative effects. Real example:<br>
<a href="https://a13xp0p0v.github.io/2020/02/15/CVE-2019-18683.html">https://a13xp0p0v.github.io/2020/02/15/CVE-2019-18683.html</a> <br>
pkill_on_warn would prevent this kernel vulnerability exploit.<br>
<p>
It would also make kernel warning infoleaks less valuable for the attacker. Exploit examples using such infoleaks:<br>
<a href="https://googleprojectzero.blogspot.com/2018/09/a-cache-invalidation-bug-in-linux.html">https://googleprojectzero.blogspot.com/2018/09/a-cache-in...</a><br>
<a href="https://a13xp0p0v.github.io/2021/02/09/CVE-2021-26708.html">https://a13xp0p0v.github.io/2021/02/09/CVE-2021-26708.html</a><br>
<p>
Anyway, this patch provoked a deep discussion.<br>
Maybe one day, the Linux kernel will get a more consistent error handling policy.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876447/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor876464"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 19, 2021 9:21 UTC (Fri)
                               by <b>geert</b> (subscriber, #98403)
                              [<a href="/Articles/876464/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But it doesn&#x27;t Fail-Fast if it kills the wrong thread.  In general, there is no guarantee the bad state that caused the warning is limited to the thread(s) killed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876464/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor876564"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2021 2:38 UTC (Sat)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/876564/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; In practice, currently, the Linux kernel kills processes on oops. OOM killer kills processes. grsecurity also kills processes.</font><br>
<p>
Well...<br>
<p>
1. oops is pretty darned unusual, in my experience.<br>
2. OOM killing is both unusual and at least tries* to target processes that might possibly be responsible for the OOM condition.<br>
3. I have no idea about grsecurity, but it&#x27;s not part of Linus&#x27;s tree, so I frankly don&#x27;t care what it does.<br>
<p>
* There is a difference between trying and succeeding, of course.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876564/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor876448"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 18, 2021 22:59 UTC (Thu)
                               by <b>dambacher</b> (subscriber, #1710)
                              [<a href="/Articles/876448/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
maybe we should taint the affected subsystem on a WARN,<br>
and make security sensible processes aware of this.<br>
they can decide themselves if it is save to continue or not. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876448/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor876455"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 19, 2021 2:51 UTC (Fri)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/876455/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
KVM recently added KVM_BUG_ON, which makes all subsequent ioctls return with EIO.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876455/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor878320"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 10, 2021 20:32 UTC (Fri)
                               by <b>Vipketsh</b> (guest, #134480)
                              [<a href="/Articles/878320/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Translated: they are turning a &quot;potential issue&quot; into &quot;definitely an issue&quot;.  Depending on the situation that can be anything from great to down right bastard.<br>
<p>
If you are some cloud provider with a large number of machines (google, facebook, etc.), you probably have a bunch of redundancy and load balancing in your setup: if one machine goes down for whatever reason, even if just because of a &quot;potential issue&quot;, there are a bunch more available to take over and the load balancing makes sure it happens.  Furthermore the cloud provider probably has engineers available to take a look at the issue in short order and return the machine to operation.  In such a setting taking machines down due to &quot;potential issue&quot; is very well warranted.<br>
<p>
On the other hand if you are using the machine in question as a primary work machine, the last thing you want is for a &quot;potential issue&quot; to take down your system and eat hours of work with it.  In such a scenario chugging along for as long as possible is the desired mode of operation.<br>
<p>
I think google &amp; co. have enough expertise on hand to tweak defaults to whatever makes sense for them while individuals (using Linux as a primary work machine) very often do not.  Thus the only same thing is to keep the defaults to what makes sense for individuals: keep going for as long as possible. <br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/878320/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor876459"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 19, 2021 5:43 UTC (Fri)
                               by <b>developer122</b> (guest, #152928)
                              [<a href="/Articles/876459/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The fundamental problem here is a desire for compartmentalization that simply does not exist.<br>
<p>
It seems there are many different kinds of warn()s that can be triggered in different ways at different times. Some might happen in an interrupt handler, others might be the result of a filesystem or driver problem, and then some other might be the result of something actually triggered by userspace. So not only are warn()s not tagged by probable cause, but tagging them with that may be impossible.<br>
<p>
Warn()s also occur in the shared security boundary of &quot;all of kernel space.&quot; There is not theoretical limit to what state might be contaminated. It might be limited to only what is currently being processed. It might affect the whole subsystem. Or it could lead to corruption to anything else the kernel is doing and possibly take the whole system down. So not only are warn()s not tagged with their probably effects, but it&#x27;s quite possibly impossible to do so.<br>
<p>
Without knowing what caused a warn, and what effects it might have, it is impossible to take any decision more fine-grained than &quot;do nothing&quot; or &quot;reset the system.&quot; You can&#x27;t reliably kill the culprit or avoid the conditions that caused it. You can&#x27;t reliably determine the affected area and pick an appropriate mitigation (flushing a buffer, killing a process, killing a subsystem, or indeed shutting down a totally-compromised system).<br>
<p>
What the kernel devs desire is a system like minix, where the various subsystems are isolated enough that anything bad happening in one is reasonably assured to not have affected the others, and where the components are fine grained enough that one experiencing a problem can be automatically killed without too much cost. This is fundamentally impossible outside of a microkernel.<br>
<p>
I&#x27;m not saying that minix or other microkernels are better, but I am saying that what people desire is just not an option with the design choices that linux has made.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876459/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor876450"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 18, 2021 23:26 UTC (Thu)
                               by <b>xecycle</b> (subscriber, #140261)
                              [<a href="/Articles/876450/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don’t know whether journalctl -k -p warning means the same WARNING?  I’m seeing warnings (and errors) on every boot saying tsc is unstable, switching clocksource to hpet; so if it does mean the same, maybe I cannot boot if this settled on “panic on warning”.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876450/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor876457"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 19, 2021 4:06 UTC (Fri)
                               by <b>a13xp0p0v</b> (guest, #118926)
                              [<a href="/Articles/876457/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No, the output of WARN_ON() in the kernel log looks like that:<br>
<p>
```<br>
WARNING: CPU: 1 PID: 6739 at net/vmw_vsock/virtio_transport_common.c:34<br>
...<br>
CPU: 1 PID: 6739 Comm: racer Tainted: G        W         5.10.11-200.fc33.x86_64 #1<br>
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.13.0-2.fc32 04/01/2014<br>
RIP: 0010:virtio_transport_send_pkt_info+0x14d/0x180 [vmw_vsock_virtio_transport_common]<br>
...<br>
RSP: 0018:ffffc90000d07e10 EFLAGS: 00010246<br>
RAX: 0000000000000000 RBX: ffff888103416ac0 RCX: ffff88811e845b80<br>
RDX: 00000000ffffffff RSI: ffffc90000d07e58 RDI: ffff888103416ac0<br>
RBP: 0000000000000000 R08: 00000000052008af R09: 0000000000000000<br>
R10: 0000000000000126 R11: 0000000000000000 R12: 0000000000000008<br>
R13: ffffc90000d07e58 R14: 0000000000000000 R15: ffff888103416ac0<br>
FS:  00007f2f123d5640(0000) GS:ffff88817bd00000(0000) knlGS:0000000000000000<br>
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033<br>
CR2: 00007f81ffc2a000 CR3: 000000011db96004 CR4: 0000000000370ee0<br>
Call Trace:<br>
  virtio_transport_notify_buffer_size+0x60/0x70 [vmw_vsock_virtio_transport_common]<br>
  vsock_update_buffer_size+0x5f/0x70 [vsock]<br>
  vsock_stream_setsockopt+0x128/0x270 [vsock]<br>
...<br>
```<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876457/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor876458"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 19, 2021 4:25 UTC (Fri)
                               by <b>xecycle</b> (subscriber, #140261)
                              [<a href="/Articles/876458/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks, this way it feels safer to declare the system as broken.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876458/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor876579"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2021 18:44 UTC (Sat)
                               by <b>dullfire</b> (guest, #111432)
                              [<a href="/Articles/876579/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think it would be kind of nice if the kernel had an interface (maybe a character devices) that was poll-able. And on oops, read(2) would return something like<br>
<p>
struct us_oops_event {<br>
    /* time that matches the kernel time stamp in dmesg of the event */<br>
    ktime_t time;<br>
    /* Which thread the oops occurred on */<br>
    pid_t victim;<br>
};<br>
<p>
<p>
After which, userspace can make any decisions: may it knows the pid it question is a specific process, or maybe it just forwards the even+dmesg over the network (if syslog forwarding isn&#x27;t normally setup).<br>
<p>
Anyhow that seems to me like the sanest thing the kernel can do (besides panicking, which is already an option).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876579/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor876595"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 21, 2021 17:54 UTC (Sun)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/876595/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Looking at the WARN_ONs I&#x27;ve experienced here in the last half-decade, I had warnings on boot for about two years because of amdgpu multi-monitor problems which eventually got fixed: but while they were happening, reboot-on-warn would have been precisely the wrong thing to do because the warnings didn&#x27;t actually ever cause anything to go wrong that I could tell. I had warnings on minor bcache gc problems which might cause, at most, a leak of a single bucket (4MiB) which in any case would go away upon the next gc after reboot: there&#x27;s no *way* that sort of thing would ever be worthy of a reboot unless it hit almost every bucket (it didn&#x27;t, it hit one out of ~90k), but a WARN_ON was used because, well, it&#x27;s worthy of a warning, right? In this case the warning was likely used as a &quot;please tell the developer&quot; flag, probably on the grounds that anything less would just be ignored.<br>
<p>
The only warning I ever had that was actually worthwhile was a warning from xfs which was immediately afterwards followed by a verifier failure flipping the affected fs to readonly. This was entirely correct given that it would otherwise have resulted in fs corruption -- but I&#x27;m fairly sure a reboot would not have been preferable to the readonly-flipping it already did (though in the event the affected fs happened to be the rootfs, so there was little else I could do: but that need not have been the case).<br>
<p>
So, so far, here at least, the number of WARNs that should have resulted in a reboot is, uh, 0%.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876595/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor876657"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 22, 2021 16:55 UTC (Mon)
                               by <b>ianmcc</b> (subscriber, #88379)
                              [<a href="/Articles/876657/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Same here - in my previous system I used to get regular warnings (with a dire looking log message) from the NVIDIA proprietary drivers, but it never caused any actual problem, not even any noticeable graphics glitch.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876657/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor876955"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 26, 2021 23:50 UTC (Fri)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/876955/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Another here - my laptop&#x27;s i915 driver spews messages about corrupt EDID data on every boot. It used to be at warning severity but it seems they&#x27;ve downgraded it.<br>
<p>
But graphics drivers aside, I&#x27;ve had actual WARN_ONs recently too, one was a soft lockup timeout because an NFS mount tree went away during a system upgrade. I would rather not have a spontaneous panic/reboot there before I get a chance to ensure the reboot will actually succeed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876955/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor876601"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 22, 2021 11:31 UTC (Mon)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/876601/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is an interesting discussion, however when I read the headline I first thought of explanations similar to the ones the Rust compiler provides, giving the system administrator some guidance on what the warning actually means. That might be a useful thing to have as well.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876601/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor876609"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 22, 2021 15:55 UTC (Mon)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/876609/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Meanwhile, not a single CI engine seems to support warnings. It&#x27;s either red or green and nothing in the middle. At best you get stderr in a different color in the logs (that one one opens when the status is green).<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876609/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor876673"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 22, 2021 19:24 UTC (Mon)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/876673/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Agreed. My request to GitLab is here if anyone wants to &quot;vote&quot;: <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/219574">https://gitlab.com/gitlab-org/gitlab/-/issues/219574</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876673/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor876692"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 23, 2021 4:44 UTC (Tue)
                               by <b>Fowl</b> (subscriber, #65667)
                              [<a href="/Articles/876692/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Microsoft Azure DevOps (horrible name for what used to be &quot;Team Foundation Server&quot;), aka. Microsoft&#x27;s /other/ forge thing, does actually support in it&#x27;s build/release pipelines.<br>
<p>
This page has some screenshots -&gt; <a href="https://github.com/melix-dev/azure-devops-dotnet-warnings#printscreens">https://github.com/melix-dev/azure-devops-dotnet-warnings...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876692/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor876744"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 24, 2021 0:16 UTC (Wed)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/876744/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That&#x27;s because the purpose of a CI system is not to give you a red/green/yellow status indicator. It is to perform a sequence of actions which (usually) culminates either in producing final (tested) artifacts, or in actually pushing those artifacts to production (depending on what your process looks like). &quot;Green&quot; is nothing more than an &quot;I&#x27;m finished&quot; indicator, and &quot;red&quot; means &quot;I was not able to finish.&quot; There&#x27;s no &quot;yellow&quot; state because the process is not allowed to &quot;half-finish.&quot; Either it gives you the final end product/deployment (green), or it doesn&#x27;t (red). Yellow would just end up being green or red but with a different UI indication.<br>
<p>
It&#x27;s also important to bear in mind that you can have more than one CI pipeline for the same underlying codebase. For example, you could have a lenient CI pipeline that &quot;just&quot; pushes nightlies into your staging or QA instance, and then a more stringent pipeline that pushes into prod. You can even have a darklaunch pipeline that works just like the real prod pipeline, except that it never actually pushes anything, so that you can still have advance notice that &quot;this nightly is in staging now, but it won&#x27;t make it into prod when that push happens for real, because it triggered a warning and failed the darklaunch pipeline.&quot;<br>
<p>
The important thing to bear in mind is that it is *not enough* to just surface warnings in a UI somewhere. You need to have a systematic policy for what happens when a warning is triggered. Once such a policy exists, it can be enforced with code, regardless of what the UI looks like. But if there is no policy, you will get developers making ad-hoc judgment calls about whether a given warning is &quot;bad enough&quot; to stall the release for a day, or if we should just push it anyway. As it turns out, humans are pretty bad at making such decisions, especially when the PM wants to get our new feature out yesterday and the warning is in some really hairy subsystem that nobody has properly understood in many years.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876744/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor876746"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 24, 2021 1:07 UTC (Wed)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/876746/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &quot;Green&quot; is nothing more than an &quot;I&#x27;m finished&quot; indicator, and &quot;red&quot; means &quot;I was not able to finish.&quot; There&#x27;s no &quot;yellow&quot; state because the process is not allowed to &quot;half-finish.&quot;</font><br>
<p>
I&#x27;m sorry your CI is so limited. Ours runs tests and publishes dashboards and pass rates. I&#x27;ve seen others automatically track regressions and progressions.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876746/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor876747"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 24, 2021 1:41 UTC (Wed)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/876747/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Agreed. Warnings are good for things like &quot;it should work, but there may be something coming over the horizon&quot;. If it works, it should pass. If it fails, it should block things. However, there *is* a middle state of &quot;things are changing, adapt before it&#x27;s too late&quot; (e.g., deprecation warnings and subsequent removals). If you want to fail on warnings, it&#x27;s usually easy to do something like `-Werror` (however that ends up being spelled for the tool in question). But just blindly continuing on as if nothing is wrong on warnings is also not viable long-term.<br>
<p>
As an example, we test git master with our stuff. Currently we make it block if it fails because git is pretty good and doesn&#x27;t break things much (we&#x27;ve found one regression in 5 years). But if git weren&#x27;t so stable, we&#x27;d *still* want to know if breakages are on their way so at least we could move out of the way of whatever the light ahead of us in the tunnel turns out to be.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876747/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor876695"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What to do in response to a kernel warning</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 23, 2021 10:38 UTC (Tue)
                               by <b>mm7323</b> (subscriber, #87386)
                              [<a href="/Articles/876695/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For the cases where a WARN() can be certainly attributed to some task, perhaps there should be a WARN_ON() variant which takes a struct task_struct e.g. WARN_ON_TASK().  Then some policy may decide to dump, kill or deliver a signal to that process, avoiding the risk of killing something unrelated and risking more harm.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/876695/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2021, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
