        <!DOCTYPE html>
        <html lang="en">
        <head><title>Restricting execution of scripts — the third approach [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/982085/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/982337/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/982085/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Restricting execution of scripts — the third approach</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>This article brought to you by LWN subscribers</b>
<p>
Subscribers to LWN.net made this article &mdash; and everything that
       surrounds it &mdash; possible.  If you appreciate our content, please
       <a href="/Promo/nst-nag3/subscribe">buy a subscription</a> and make the next
       set of articles possible.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>July 19, 2024</br>
           </div>
The kernel will not consent to execute just any file that happens to be
sitting in a filesystem; there are formalities, such as the checking of
execute permission and consulting security policies, to get through first.
On some systems, security policies have been established to limit execution
to specifically approved programs.  But there are files that are not
executed directly by the kernel; these include scripts fed to language
interpreters like Python, Perl, or a shell.  An attacker who is able to get
an interpreter to execute a file may be able to bypass a system's security
policies.  Mickaël Salaün has been working on closing this hole for years;
the <a href="/ml/all/20240704190137.696169-1-mic@digikod.net">latest
attempt</a> takes the form of a new flag to the <a
href="https://man7.org/linux/man-pages/man2/execveat.2.html"><tt>execveat()</tt></a>
system call.
<p>
Imagine a locked-down system containing a file with some hostile Python
code.  There are many ways to try to execute that file, two of which are:
<p>
<pre>
    $ ./bad-stuff.py
    $ python bad-stuff.py
</pre>
<p>
In the first case, the kernel reads the <a
href="https://en.wikipedia.org/wiki/Shebang_(Unix)">shebang line</a> at the
beginning of the file, sees that it is intended to be fed to the Python
interpreter, and executes that interpreter with the file as its standard
input.  Before doing so, though, the kernel will ensure that the file has
the execute-permission bit set and that any security policy in force does
not object — just like it would with any executable file.  In the latter
case, though, the kernel has no way to know that <tt>bad-stuff.py</tt> is
being opened for execution, so none of those checks are made.
<p>
Salaün's objective is to cause both of those commands to have the same
result, be it successfully executing the file or refusing to do so.  His
first attempt, initially <a
href="/ml/linux-kernel/20181212081712.32347-1-mic@digikod.net/">posted</a>
in 2018 and <a href="/Articles/820000/">extensively revised</a> in 2020,
added a new flag (<tt>O_MAYEXEC</tt>) for <tt><a
href="https://man7.org/linux/man-pages/man2/openat2.2.html">openat()</a></tt>
that an interpreter could use to indicate that a file was being opened for
execute access.  The patch series was not entirely well received; among
other things, Salaün was <a
href="/ml/linux-kernel/20200909171316.GW1236603@ZenIV.linux.org.uk/">told</a>
that this functionality really should be implemented as a new system call
instead.  So he <a href="/Articles/832959/">tried that approach</a> next,
adding a system call named <tt>trusted_for()</tt>, which seemed to be
making progress until Linus Torvalds <a
href="/ml/all/CAHk-=wgoC76v-4s0xVr1Xvnx-8xZ8M+LWgyq5qGLA5UBimEXtQ@mail.gmail.com/">refused</a>
to pull it during the 5.18 merge window in 2022; he suggested, instead,
adding a new flag to an existing call.
<p>
Rather than go back to <tt>O_MAYEXEC</tt>, though, Salaün has taken the
approach of adding a flag, <tt>AT_CHECK</tt>, to <tt>execveat()</tt>.  If
that flag is set, <tt>execveat()</tt> will perform all of the checks it
normally would before executing a file, but will not actually execute it;
instead, it returns a status code indicating whether the checks passed or
not.  Language interpreters can use that result to decide whether to
execute a given script file or not.  This implementation has the advantage
of always performing the same checks that would apply to files executed
directly by the kernel, ensuring a more consistent policy.
<p>
Of course, whether to execute a file passed to an interpreter is a policy
decision, and not all systems are the same; if Python abruptly started
refusing to execute arbitrary script files, many users would understandably
become somewhat irate.  One solution that has been employed at times is to
build a special version of every interpreter to load onto restricted
systems, but that makes distribution architects and packagers irate
instead.  As a way of keeping the overall level of irateness down, Salaün
has added a new set of securebits flags (securebits are documented toward
the end of the sprawling <a
href="https://man7.org/linux/man-pages/man7/capabilities.7.html">capabilities
man page</a>):
<p>
<ul class="spacylist">
<li> <tt>SECBIT_SHOULD_EXEC_RESTRICT</tt>: interpreters should only consent
     to execute files that are approved by system policy.  That approval
     may take the form of an explicit allowlist, cryptographic signatures,
     or something else.
<li> <tt>SECBIT_SHOULD_EXEC_CHECK</tt>: interpreters should use the new
     <tt>execveat()</tt> flag to check whether a given file should be
     executed.
</ul>
<p>
There are also <tt>_LOCKED</tt> versions of these bits that prevent them
from being changed in the future.  All of the bits are inherited by child
processes, so if they are (for example) set in a container's init process,
they will be set in every other process running in the container as well.
<p>
The actual semantics of these bits caused a bit of confusion in the ensuing
discussion.  In a normal locked-down mode, both bits would be set to enable
the full set of checks.  Setting only <tt>SECBIT_SHOULD_EXEC_CHECK</tt> can
be useful for logging and tracking down problems, similar to the SELinux
permissive mode.  Setting only <tt>SECBIT_SHOULD_EXEC_RESTRICT</tt>,
instead, leads to a situation where almost nothing can be executed by the
interpreter (though files with shebang lines would still work if the system
otherwise allows them).  Leaving both bits clear results in a system that
works like normal, open systems do now.
<p>
After some discussion, Salaün responded to the confusion by <a
href="/ml/all/20240710.eiKohpa4Phai@digikod.net/">proposing</a> a different
mode of operation.  Rather than a pair of bits telling interpreters that
they should be restricting access, simply instruct interpreter developers
to always perform the <tt>AT_CHECK</tt> check; a different pair of
securebits would instruct the interpreter about which policy to apply:
<p>
<ul class="spacylist">
<li> <tt>SECBIT_EXEC_RESTRICT_FILE</tt>: files can only be executed by
     the interpreter if the <tt>AT_CHECK</tt> call succeeds.  While the
     kernel <i>could</i> interpret this bit, the proposal is still to defer
     this enforcement to user space, and to have the <tt>AT_CHECK</tt> call
     return the same results regardless of the securebits settings.
<li> <tt>SECBIT_EXEC_DENY_INTERACTIVE</tt>: the interpreter should refuse
     to run any "interactive" input that comes from its command line,
     environment variables, configuration files, etc.  Only code that
     exists in an executable file on disk could be run.
</ul>
<p>
Once again, leaving both bits clear results in an open system.  Setting
only <tt>SECBIT_EXEC_RESTRICT_FILE</tt> would prevent the accidental
execution of files, but still puts trust in the users.  Setting only
<tt>SECBIT_EXEC_DENY_INTERACTIVE</tt> would allow any file to be executed,
but could be used as a sort of permissive mode on the way toward locking
down the system entirely, which would be accomplished by setting both bits.
<p>
Early in the discussion, Kees Cook had <a
href="/ml/all/202407041711.B7CD16B2@keescook/">suggested</a> that the
original <tt>O_MAYEXEC</tt> approach may have been better; since it refuses
to open the file if the check failed, there was no way to trick an
interpreter into executing the file anyway.  Later on, though, he <a
href="/ml/all/202407100921.687BE1A6@keescook/">indicated</a> support for
the redefined set of securebits.  The discussion is ongoing, but there does
not appear to be strong opposition to that approach.
<p>
So it looks like the way might finally be clear for this functionality to
enter the kernel, perhaps as soon as the 6.12 development cycle.  But,
then, <tt>trusted_for()</tt> appeared to have reached a consensus until it
ended up blocked at the final stage.  So it is too soon to be holding one's
breath, but the third time may yet prove to be the charm for this feature.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-Language_interpreters">Security/Language interpreters</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/982085/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor982578"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Shebang line passes file name as command line argument</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 14:28 UTC (Fri)
                               by <b>anselm</b> (subscriber, #2796)
                              [<a href="/Articles/982578/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote><em>and executes that interpreter with the file as its standard input</em></blockquote>
<p>
Not quite … the name of the file in question is passed to the interpreter as a command-line argument. Using standard input for this would make it difficult to use the interpreter's standard input for other purposes (e.g., in a pipeline). See the “Interpreter scripts” section of execve(2).
</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/982578/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor982582"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is this another NIH moment?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 14:55 UTC (Fri)
                               by <b>Heretic_Blacksheep</b> (guest, #169992)
                              [<a href="/Articles/982582/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm definitely for closing the interpreter basic file permissions loophole, but I'm wondering if this is another case of Not Invented Here syndrome?  Are there other Unices out there with this kind of security with broad interpreter support already?  Cuz if so, that's yet another cause of developer irateness.  They're going to immediately say "we already do this for OS-W/E, just do what they did!".<br>
<p>
I'm asking, despite using multiple Unices, I'm not aware of any that have such a security feature despite the obviousness of the security loophole.  You can still do this on MacOS, for example, despite all the layers of security it's piled on top of direct file execution.  I don't think Veriexec on NetBSD checks scripts either, just the interpreter, though I haven't tested that assumption ... perhaps I should at some point if I can find a device with hardware old enough...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982582/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982588"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is this another NIH moment?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 15:19 UTC (Fri)
                               by <b>cesarb</b> (subscriber, #6266)
                              [<a href="/Articles/982588/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Are there other Unices out there with this kind of security with broad interpreter support already?</span><br>
<p>
Not a Unix, but AFAIK there's something like that on Windows to disable execution of unsigned PowerShell scripts, much to everyone's annoyance.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982588/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982602"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is this another NIH moment?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 16:38 UTC (Fri)
                               by <b>intelfx</b> (subscriber, #130118)
                              [<a href="/Articles/982602/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; AFAIK there's something like that on Windows to disable execution of unsigned PowerShell scripts, much to everyone's annoyance</span><br>
<p>
This is indeed a thing, but it's built directly into PowerShell, so I'm not sure it qualifies...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982602/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982648"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is this another NIH moment?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 6:40 UTC (Sat)
                               by <b>kaesaecracker</b> (subscriber, #126447)
                              [<a href="/Articles/982648/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
All of the possible ways to do this require a cooperating interpreter, the same way that following the group policy is implemented in powershell. <br>
<p>
I guess the idea is to restrict which interpreters you can run to those that enforce the script policy.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982648/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982657"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is this another NIH moment?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 10:04 UTC (Sat)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/982657/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That is precisely it - this is useful in contexts where you have code integrity checks on any executed binary, so interpreters that do not support this would just not be allowed in the first place<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982657/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor982603"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is this another NIH moment?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 17:04 UTC (Fri)
                               by <b>MarcB</b> (subscriber, #101804)
                              [<a href="/Articles/982603/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; I'm asking, despite using multiple Unices, I'm not aware of any that have such a security feature despite the obviousness of the security loophole.</span><br>
<p>
Likely the niche for this feature is very small, at least outside inherently restricted environments like Android - and if you are on such an environment, you might as well perform the restrictions in the interpreters.<br>
<p>
For this to make any sense, you would also have to disable Perl's "-e" argument and all forms of REPLs - to which the shell is equivalent from a security PoV (unless you turn it into a pure command launcher, maybe with pipes and carefully remove all potentially "cooperative" software from the system).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982603/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982706"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is this another NIH moment?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 3:19 UTC (Sun)
                               by <b>bartoc</b> (guest, #124262)
                              [<a href="/Articles/982706/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The point seems to be to allow interpreters to ask the system to do the check, so that it will always be done the same way as for non-interpreter executables. There's a ton of policy set by LSMs and stuff here, and you can even have the kernel run bpf code to decide what to do, so you do need "help" from the system.<br>
<p>
Also, this is not pointless because "the shell is equivalent to any other interpreter". The policies here can get more restrictive dynamically. Like your shell can launch your web server, which you want to be able to launch perl to interpret CGI scripts, but not a perl REPL or some other random perl script.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982706/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor982612"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is this another NIH moment?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 17:38 UTC (Fri)
                               by <b>shemminger</b> (subscriber, #5739)
                              [<a href="/Articles/982612/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I can think of two similar technologies.  In Windows, Powershell is usually configured to only allow signed scripts.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982612/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982635"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is this another NIH moment?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 21:50 UTC (Fri)
                               by <b>Heretic_Blacksheep</b> (guest, #169992)
                              [<a href="/Articles/982635/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I knew you could do this in Windows which is why I explicitly said Unices.  There are other non-Unix systems that can also do this, but Unix has nearly always had an open policy when it comes to interpreted programs - sometimes to its detriment.<br>
<p>
There are environments where you'd want some scripts to run, but disallow others using the same interpreter so simply disallowing (or not installing) the interpreter isn't helpful.  I just couldn't think of any Unices where this was possible, even those claiming security-first creds.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982635/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982723"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is this another NIH moment?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 11:55 UTC (Sun)
                               by <b>cytochrome</b> (subscriber, #58718)
                              [<a href="/Articles/982723/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Out of curiosity, aside from windows, what are other non-unix operating systems that implement this kind of security measure?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982723/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor984275"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is this another NIH moment?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 1, 2024 16:24 UTC (Thu)
                               by <b>rep_movsd</b> (guest, #100040)
                              [<a href="/Articles/984275/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But Powershell is just one scripting language<br>
What about any program that takes a file and "interprets" it?<br>
<p>
What exactly qualifies as "Script" and "execution"?<br>
The C preprocessor and even "mkdir + find" are Turing complete<br>
<p>
Whats the meaning of "nothing on this path should be allowed to be run" when the meaning of "run" is vague?<br>
<p>
 <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/984275/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor984309"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is this another NIH moment?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 1, 2024 18:16 UTC (Thu)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/984309/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; What about any program that takes a file and "interprets" it?</span><br>
<p>
Such a program either gets enlightened to support this new mechanism to pre-validate any such file or it will not get signed so it won't be allowed to run in the first place<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/984309/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor982615"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Wouldn't it instead be worse ?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 17:58 UTC (Fri)
                               by <b>wtarreau</b> (subscriber, #51152)
                              [<a href="/Articles/982615/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Am I the only one seeing it as an approach that could instead encourage users to have *more* executable files ? I do have a lot of totally insecure seldom-used scripts that do *not* have execute permissions so that I read them with less before executing them using "sh" or "bash". With such a mechanism starting to generalize through distros, I can easily imagine that in a few versions, I'll have to chmod +x all my scripts in order to be able to run them this way. This is *not* what I want, because that would possibly leave exploitable gadgets everywhere at the mercy of an execve().<br>
<p>
And I'm not completely convinced by the benefit of preventing an interpreter from loading a non-executable script, especially when such interpreters also know how to run in interactive mode from a terminal and receive copy-pastes for example.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982615/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982616"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Wouldn't it instead be worse ?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 18:02 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/982616/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The usefulness of this is in systems where there is a system-wide policy governing what can be executed or not, so having more executable files is not a problem, as the policy can cover those as well.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982616/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor982617"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Wouldn't it instead be worse ?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 19:07 UTC (Fri)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/982617/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Aren't those scripts currently execve gadgets currently anyway, since an attacker could just stick "bash" at the beginning of the command line? It seems unlikely that there would be a vulnerability that allows an attack to attempt to execute an arbitrary file, but not interactively and not with any command line arguments. All of the ways I can imagine a system getting confused and being insecure seem to be more likely to lead to executing a program that could be bash with an argument that could be an arbitrary a-x file.<br>
<p>
If you want to make sure your scripts can't be executed directly by the kernel, you could just put "#!/bin/echo" on the first line. If an attacker manages to get the kernel to execute it directly, it'll just print the filename, but bash will happily run it as a script.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982617/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982620"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Wouldn't it instead be worse ?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 19:34 UTC (Fri)
                               by <b>matthias</b> (subscriber, #94967)
                              [<a href="/Articles/982620/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Aren't those scripts currently execve gadgets currently anyway, since an attacker could just stick "bash" at the beginning of the command line?</span><br>
<p>
It is a little bit more complicated than this, as execve does not take a command line. It takes the path to the executable and an array of arguments. So the attacker needs to construct an additional string with the name of the script and generate the array that contains a pointer to that string. But yes, if the attacker is able to execute arbitrary files, you should not expect that this additional hurdle will save you.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982620/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982621"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Wouldn't it instead be worse ?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 20:07 UTC (Fri)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/982621/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Oh, right; I forgot that execve(2) doesn't get the path out of argv[0] like a lot of languages' standard library equivalents do, and that Linux accepts NULL for argv so you aren't forced to generate an array anyway.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982621/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor982627"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">chmod +x malicous-polylot.sh.py</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 20:30 UTC (Fri)
                               by <b>jepler</b> (subscriber, #105975)
                              [<a href="/Articles/982627/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The check as proposed (or at any rate as I understand it) doesn't tell you "this script should be executable by this interpreter", just "this script should be executable by some interpreter"<br>
<p>
now I'm imagining a file that can be interpreted by two different interpreters (say, sh &amp; python). Under the intended interpreter (dash), it's innocuous or even useful; under another interpreter (python) it does something nefarious.<br>
<p>
Writing a nice innocuous-looking malicious polyglot script shall be left as an exercise for the reader.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982627/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982630"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">chmod +x malicous-polylot.sh.py</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2024 20:54 UTC (Fri)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/982630/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That doesn't matter - unless you are sure, you are not allowing that to be executed, period. And yes, in the use cases where this is useful, you will be damn sure of everything you allow, and default to deny. This is not the place for curl | sudo bash<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982630/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor982654"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">chmod +x malicous-polylot.sh.py</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 9:34 UTC (Sat)
                               by <b>matthias</b> (subscriber, #94967)
                              [<a href="/Articles/982654/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Under the intended interpreter (dash), it's innocuous or even useful; under another interpreter (python) it does something nefarious.</span><br>
<p>
The situation is not much different to a traditional backdoor in executables. You have to make sure that such scripts do not exist. This patch is intended in situation where users should not be able to run their own executables. So you have noexec on everything except /usr which mostly contains executables and scripts from the distribution and maybe a few things the admin carefully selected. So the attacker must sneak this script into some distribution, first.<br>
<p>
Still you have a point. I would not think of sh and python, but just two different flavors of sh. A (distribution supplied) script specifically designed to work in bash might not have been tested under csh. And this might lead to unwanted behavior if someone maliciously calls the script with csh.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982654/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982709"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">chmod +x malicous-polylot.sh.py</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 3:36 UTC (Sun)
                               by <b>bartoc</b> (guest, #124262)
                              [<a href="/Articles/982709/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
presumably this will do the normal LSM checks. It's typical for systems running selinux to have quite different sets of things that can be run depending on context, for example the bash launched upon login is fairly unrestricted but if you run a copy of httpd it can't run anything outside what you might expect.<br>
<p>
I wonder how this feature handles security context transitions (such as selinux types), I think this is a good motivation for putting the flag in exec instead of open. I wonder if there will be problems w.r.t. interpreter state not getting wiped out when exec is called; I guess it's something administrators will just have to deal with when writing policy.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982709/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor982644"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementer’s view</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 2:32 UTC (Sat)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/982644/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
tbh, I was okay with O_MAYEXEC but checking Linux-specific flags, doing extra syscalls in hard to define places…<br>
<p>
… I probably won’t care about this.<br>
<p>
I did have O_MAYEXEC support in mksh for a while, as there were OSes that did indeed implement it, but that support was scrapped when it got rejected in Linux.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982644/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982727"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementer’s view</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 13:47 UTC (Sun)
                               by <b>hmh</b> (subscriber, #3838)
                              [<a href="/Articles/982727/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So, strpping away from the O_MAYEXEC flag was actually the NIH ?  :-(<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982727/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982728"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementer’s view</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 13:48 UTC (Sun)
                               by <b>hmh</b> (subscriber, #3838)
                              [<a href="/Articles/982728/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Stepping away. Ugh wish we could edit comments for a few minutes in LWN...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982728/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor984757"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Implementer’s view</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2024 8:23 UTC (Thu)
                               by <b>sammythesnake</b> (guest, #17693)
                              [<a href="/Articles/984757/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I couldn't help reinterpreting your LWN monicker as standing for "holding my head" in the context of this comment :-P<br>
<p>
[picard-facepalm.png] ;-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/984757/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor982663"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 11:53 UTC (Sat)
                               by <b>gray_-_wolf</b> (subscriber, #131074)
                              [<a href="/Articles/982663/">Link</a>] (27 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wonder how this will work regarding transitive checks.  Sure, I understand that ~/bin/some-script.py will have to be executable in order for me to run python ~/bin/some-script.py.  But what about files that are used by this script?  When I check /usr/lib/python3.12/, none of the .py files are executable.  Same goes for the .pyc files.<br>
<p>
I have to admit the idea of .pyc files having executable flag feels weird, but I guess transitive check would be required for this feature to make sense?  So it will require packaging changes (permissions +x) for all distributions that ship any interpreted code and allow some kind of import (python, ruby, php, ...)?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982663/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982670"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 12:59 UTC (Sat)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/982670/">Link</a>] (26 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For this to have any effect the interpreters would have to be completely locked down and all code must be audited.<br>
<p>
- REPL would have to be removed.<br>
- PYTHONPATH-like variables would have to be restricted.<br>
- The use of exec/eval statements would have to be audited or better removed.<br>
- Every monkey-patching would be suspicious and could open holes.<br>
- All code has to be audited for whether it contains an interpreter of some kind. Implementing an interpreter in Python would have to be forbidden.<br>
<p>
And probably a thousand more things.<br>
<p>
Restricting the execution of scripts doesn't make a lot of sense.<br>
Why do this at all?<br>
What actual problem does this solve?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982670/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982675"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 13:35 UTC (Sat)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/982675/">Link</a>] (20 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Restricting the execution of scripts doesn't make a lot of sense.</span><br>
<span class="QuotedText">&gt; Why do this at all?</span><br>
<span class="QuotedText">&gt; What actual problem does this solve?</span><br>
<p>
It doesn't make sense on your laptop perhaps, but there are a lot of cases where not only it makes perfect sense, but the fact that Linux is so hopelessly behind Windows on these security-related matters is a hindrance. This is absolutely needed in cases where code integrity is a must, where "execution is denied by default unless explicitly and specifically allowed by policy" is the desired security model. And yes this exists and is very much real, despite Linux trailing behind other OSes, which is what this change is trying to address. This, coupled with the IPE LSM, will let us catch up quite a bit, providing a platform owner with real and useful means to implement full and comprehensive code integrity.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982675/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982677"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 13:55 UTC (Sat)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/982677/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What problem is being addressed by such a security model?<br>
Can you give an example?<br>
<p>
And where do we draw the line between data and executable code?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982677/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982689"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 16:44 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/982689/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; What problem is being addressed by such a security model?</span><br>
<p>
FLOSS guys seem *O*B*S*S*E*S*S*E*D* with the idea "possession is nine tenths of the law". Guess what, for a LOT of computers, possession &lt;&gt; ownership. Indeed, for many youngsters today, the only "real computer" they possess, may be their employer's.<br>
<p>
<span class="QuotedText">&gt; Can you give an example?</span><br>
<p>
GDPR? HIPAA? All that malarkey?<br>
<p>
In a lot of cases, the USER is not allowed to do things, both for their safety, and for the safety of their employer and colleagues. Bemoan it all you like, it's the world we live in. And Americans may not care about having their lives ruined by imposters, cheats and fraudsters, but us Europeans certainly do.<br>
<p>
And while you may be quite happy with friends and family treating your private information with gay abandon, for a lot of us a promise of "I'll take as good care of it as if it were my own" fills us with dread!<br>
<p>
<span class="QuotedText">&gt;And where do we draw the line between data and executable code?</span><br>
<p>
There I can't help you.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982689/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982692"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 18:15 UTC (Sat)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/982692/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ok, let's ask the question in a different way:<br>
<p>
What additional security do you get, if you forbid the user to do calculations? (= execute a program).<br>
<p>
I mean, if you don't want the user to be able to access some data, protect the data. Don't restrict the ability to run calculations.<br>
If you don't want the user to be able to access the network, firewall it. But don't restrict the ability to do calculations.<br>
Put the user context into a jail/container, if you so desire, to completely isolate the context. But why on earth would it make sense to forbid to run a program?<br>
<p>
I'm also not asking about what nonsense people do. Yes I know that there probably are many people who would like to forbid running programs, because they think it's a great idea.<br>
But I'd rather like to know which real advantage it has to forbid running a program instead of protecting the actual resources.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982692/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982694"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 18:36 UTC (Sat)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/982694/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What makes you think there is a "user" in such environments? What part of "this is not for your laptop" wasn't clear?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982694/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982695"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 18:49 UTC (Sat)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/982695/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;What makes you think there is a "user" in such environments?</span><br>
<p>
Nothing makes me think that.<br>
Please tell me how the environment where it makes sense to restrict the ability to run interpreted code looks like. And what actual thing is protected with that.<br>
That was my question.<br>
<p>
There was no answer, yet.<br>
<p>
But besides that, I think on Linux only the Kernel itself runs without an assigned user, right?<br>
<p>
<span class="QuotedText">&gt;What part of "this is not for your laptop" wasn't clear?</span><br>
<p>
Nothing. I got that part.<br>
I don't want to know what it's *not* for. I would like to learn what this feature is for.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982695/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982697"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 19:04 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/982697/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Please tell me how the environment where it makes sense to restrict the ability to run interpreted code looks like. And what actual thing is protected with that.</span><br>
<p>
Something like Chromebooks or other built-in devices. They might want to use interpreted languages, but they also very much want to limit arbitrary code, and to make exploitation harder. A lot of exploits are limited to an equivalent of several hundred bytes of machine code, so making interpreters unavailable might make them more complicated to write.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982697/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor982698"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 19:36 UTC (Sat)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/982698/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; There was no answer, yet.</span><br>
<p>
The answers are right there, in the cover letter, with existing use cases. Just because something is not for your laptop it doesn't mean it's "useless".<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982698/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982699"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 19:41 UTC (Sat)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/982699/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;Just because something is not for your laptop it doesn't mean it's "useless".</span><br>
<p>
Luca, I would like to ask you to calm down, please.<br>
I have no idea why you have such an aggressive tone all the time. Stop it, please. I was just asking what this is all about, because I didn't understand it.<br>
<p>
I have never said that it was useless.<br>
And I have never talked about my laptop.<br>
<p>
In the meantime, while you were busy attacking me, there were two interesting answers (both basically boiling down to rate-limiting) that I agree with as being useful use cases.<br>
Thanks for these answers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982699/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982717"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 9:18 UTC (Sun)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/982717/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Luca, I would like to ask you to calm down, please.</span><br>
<span class="QuotedText">&gt; I have no idea why you have such an aggressive tone all the time. Stop it, please. I was just asking what this is all about, because I didn't understand it.</span><br>
<p>
mb, please take those blinkers off!!!<br>
<p>
Just because a feature may be of no use to you, doesn't mean it's of no use to other people. In this case, it's clearly of immense use to people who aren't running desktops of one form or another.<br>
<p>
One *obvious* use - kiosks. Those SINGLE PURPOSE machines that aren't supposed to run anything except the one blessed program.<br>
<p>
Servers - where there shouldn't be any code other than that from a formal deployment mechanism, where signing everything is just part of procedure.<br>
<p>
Etc etc. Just stuff you clearly have no interest (and for the most part I don't either) in.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982717/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982719"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 10:26 UTC (Sun)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/982719/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What I said also applies to you, Wol.<br>
Stop it, please.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982719/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor982724"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 13:01 UTC (Sun)
                               by <b>milesrout</b> (subscriber, #126894)
                              [<a href="/Articles/982724/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Good god man you are insufferable sometimes. The guy asks five times for an example of where it is useful and every time you say something dismissivr like "this isnt just for your laptop". <br>
<p>
If you have nothing to actually contribute to a discussion, maybe just don't reply. You are as bad as Cyberax sometimes, seriously...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982724/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982735"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 16:15 UTC (Sun)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/982735/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Folks, we are clearly not getting anywhere here.  Can we just stop throwing mudballs at each other, please?


      
          <div class="CommentReplyButton">
            <form action="/Articles/982735/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor982777"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2024 13:12 UTC (Mon)
                               by <b>Tet</b> (subscriber, #5433)
                              [<a href="/Articles/982777/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <em>One *obvious* use - kiosks. Those SINGLE PURPOSE machines that aren't supposed to run anything except the one blessed program.</em>
<p>
For that particular problem, there are already many, many existing solutions. I'm not taking any particular position on whether or not this proposed change is useful, merely observing that it would be solving something that isn't currently a problem. The same applies to servers where you don't want anything other than what's been explicitly deployed to be run.


      
          <div class="CommentReplyButton">
            <form action="/Articles/982777/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982791"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2024 13:31 UTC (Mon)
                               by <b>pizza</b> (subscriber, #46)
                              [<a href="/Articles/982791/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; merely observing that it would be solving something that isn't currently a problem.</span><br>
<span class="QuotedText">&gt; The same applies to servers where you don't want anything other than what's been explicitly deployed to be run. </span><br>
<p>
Reasonable people disagree about these assertions.<br>
<p>
Hence these (and other) proposals.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982791/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor982729"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 14:02 UTC (Sun)
                               by <b>bluca</b> (subscriber, #118303)
                              [<a href="/Articles/982729/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; I have never said that it was useless.</span><br>
<p>
You mean apart from the comment above I was replying to, where you said it doesn't make sense?<br>
<p>
<span class="QuotedText">&gt; Restricting the execution of scripts doesn't make a lot of sense.</span><br>
<p>
<span class="QuotedText">&gt; while you were busy attacking me</span><br>
<p>
Calling out factually wrong statements based on lack of knowledge of the domains in question is not "attacking you". If you don't want somebody to reply that what you just said it's wrong, don't assert something doesn't make sense in the first place, at least not without first reading the article and the cover letter it links to. Once again, some of the use cases are linked there. This already exists in some different form, reaching the same end result.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982729/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982733"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 14:52 UTC (Sun)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/982733/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Wow. Yes, Luca. You are the hero explaining all the stuff (except you didn't) and I am wrong and stupid.<br>
Thanks a lot for pointing out my factual wrong statements.<br>
<p>
I will be ignoring you from now on.<br>
Here and in all other contexts.<br>
Discussing things with you is a waste of my time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982733/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor982696"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 19:08 UTC (Sat)
                               by <b>malmedal</b> (subscriber, #56172)
                              [<a href="/Articles/982696/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; What additional security do you get, if you forbid the user to do calculations? (= execute a program).</span><br>
 <br>
Rate-limiting. <br>
<p>
For instance a nurse may need access to look up sensitive data of any patient urgently. The hospital may accept the risk that somebody will  copy and paste that info into a mail and send it. But if somebody can write a script and collect all patient data, they will be less accepting. <br>
<p>
Also, some privilege-escalation attacks need many attempts before they succeed. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982696/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor982710"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 3:42 UTC (Sun)
                               by <b>bartoc</b> (guest, #124262)
                              [<a href="/Articles/982710/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's a defense-in-depth feature. The idea is to, for example, have policy that says what you _expect_, like, a crud app or data-base to be able to do (and, the policy for the database backing the crud app is similar to the policy of the crud app itself, and more restrictive than what the database is expected to have access to in-general). This way if there's some exploit someplace it's pretty likely the exploit chain will get broken someplace.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982710/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor982730"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 14:05 UTC (Sun)
                               by <b>hmh</b> (subscriber, #3838)
                              [<a href="/Articles/982730/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Man-Manchine Interfaces and kiosks and single purpose devices for a specific function where their purpose should be very very hard do be subverted while they are in place to perform their original function.<br>
<p>
Network probes.  Intelligent control terminals for some specific apparatus, and even ATMs come to mind.<br>
<p>
Some of those you do away with the entire normal userspace, but often you do require them to still have shells or interpreters installed inside.  Restricting what interpretors can run is an useful defense layer on those.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982730/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor982714"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 7:20 UTC (Sun)
                               by <b>jem</b> (subscriber, #24231)
                              [<a href="/Articles/982714/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Windows PowerShell has been mentioned in the comments. The restrictions on PowerShell scripts were probably  introduced mostly to prevent accidental execution of potentially dangerous scripts, or to mitigate the use of PowerShell by malware. PowerShell scripts can do a lot more than old cmd.exe bat files, and Microsoft wanted to protect their reputation after putting sharp knifes instead of spoons in the hands of their users.<br>
<p>
In my last job, we made it a standard procedure to wrap PowerShell scripts in one-line .cmd files: "PowerShell -ExecutionPolicy Bypass myscript.ps". You can probably prevent this loophole with Group Policy settings, but in our case it worked 99% of the time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982714/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor982684"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 15:36 UTC (Sat)
                               by <b>malmedal</b> (subscriber, #56172)
                              [<a href="/Articles/982684/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; For this to have any effect the interpreters would have to be completely locked down and all code must be audited.</span><br>
 <br>
Yes. But I believe SELinux already has the facilities to do this already, even without this patch. Basically to do this with Python:<br>
<p>
  * Create SELinux context python_t.<br>
  * Lock down the python-executable and all modules and related files so they only can be read by python_t and not the user.<br>
  * Create a  context data_t that allows the script the read and write access it needs to do its job.<br>
  * Set SELinux labels on the script so that when executed it starts in python_t context but is allowed to transition to data_t when it wants.<br>
  * Add a call libselinux.setcon("data_t") to the script at the appropriate place.<br>
  * Now the script can to what it is supposed to.<br>
<p>
(It has been more than ten years since I last touched SELinux, so I may be missing something, but I don't think it is much more complicated than this)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982684/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor982747"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 22:14 UTC (Sun)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/982747/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; For this to have any effect the interpreters would have to be completely locked down and all code must be audited.</span><br>
<p>
Yes.<br>
<p>
<span class="QuotedText">&gt; - REPL would have to be removed.</span><br>
<span class="QuotedText">&gt; - PYTHONPATH-like variables would have to be restricted.</span><br>
<span class="QuotedText">&gt; - The use of exec/eval statements would have to be audited or better removed.</span><br>
<p>
Yes.<br>
<p>
<span class="QuotedText">&gt; - Every monkey-patching would be suspicious and could open holes.</span><br>
<p>
No. Monkey-patching is fine as long as you're replacing blessed code with other blessed code (and the code doing the patching is also blessed).<br>
<p>
<span class="QuotedText">&gt; - All code has to be audited for whether it contains an interpreter of some kind. Implementing an interpreter in Python would have to be forbidden.</span><br>
<p>
Yes.<br>
<p>
<span class="QuotedText">&gt; And probably a thousand more things.</span><br>
<p>
No, because you take an allowlist approach. You do not start with a general-purpose OS and subtract interpreter-like things. Instead, you start with the kernel and some minimal userland that can just about boot, and add things until you run whatever specific software you want to run. Each time you add a thing, you audit it for all of the issues you have described.<br>
<p>
This is expensive, and quite annoying to do correctly. But it is absolutely possible and even practical if you have a very specific use case for the system in question. Containers are frequently built with a less stringent version of this process.<br>
<p>
<span class="QuotedText">&gt; Restricting the execution of scripts doesn't make a lot of sense.</span><br>
<p>
Scripts are code. Restricting the execution of code has been present in Unices since time immemorial.<br>
<p>
<span class="QuotedText">&gt; Why do this at all?</span><br>
<span class="QuotedText">&gt; What actual problem does this solve?</span><br>
<p>
This is explained in the cover letter.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982747/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982755"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 23:57 UTC (Sun)
                               by <b>malmedal</b> (subscriber, #56172)
                              [<a href="/Articles/982755/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Restricting the execution of code has been present in Unices since time immemorial.</span><br>
<p>
Yes, the way things like this were done in time immemorial, was to protect the files that the user shouldn't be able to read or write with group permissions, and then create a setgid launcher to launch the needed programs. Usually you'd also put the user in a chroot.<br>
<p>
I suppose this new way is better in that it does not mess with the group permissions, but on the other hand it is worse in that it requires every interpreter to be modified.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982755/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor982775"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2024 12:46 UTC (Mon)
                               by <b>patrakov</b> (subscriber, #97174)
                              [<a href="/Articles/982775/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; What actual problem does this solve?</span><br>
<p>
Compliance with UK Cyber Essentials, since 2023. Before that, it was OK to run an antivirus. Now, this is permitted only on Windows and MacOS, while all other systems must restrict executable code using digital signatures.<br>
<p>
And this is a prerequisite for taking government contracts. I wonder how CodeThink handled this change in the law. Any insiders here?<br>
<p>
Old requirements (2022): <a href="https://www.ncsc.gov.uk/files/Cyber-Essentials-Requirements-for-Infrastructure-v3-0-January-2022.pdf">https://www.ncsc.gov.uk/files/Cyber-Essentials-Requiremen...</a><br>
<p>
New requirements (2023): <a href="https://www.ncsc.gov.uk/files/Cyber-Essentials-Requirements-for-Infrastructure-v3-1-January-2023.pdf">https://www.ncsc.gov.uk/files/Cyber-Essentials-Requiremen...</a><br>
<p>
There was no new version in 2024.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982775/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982862"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transitive checks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2024 16:39 UTC (Mon)
                               by <b>malmedal</b> (subscriber, #56172)
                              [<a href="/Articles/982862/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Compliance with UK Cyber Essentials, since 2023. </span><br>
<p>
Heh, the document says: "Bespoke and custom components of web applications are out of scope."<br>
<p>
So all you need to do is to hook up <a href="https://xtermjs.org/">https://xtermjs.org/</a> to your shell and disable all forms of access other than via a web-browser :) <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982862/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor982671"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with execveat()</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 13:34 UTC (Sat)
                               by <b>jreiser</b> (subscriber, #11027)
                              [<a href="/Articles/982671/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      &gt; If that flag is set, <tt>execveat()</tt> will perform all of the checks it normally would before executing a file, but will not actually execute it; instead, it returns a status code indicating whether the checks passed or not.
<p>
Several times I have wanted a way to determine "Would this <tt>execveat()</tt> get to the point of no return?" but without actually proceeding to execute.  Of course there are races, but the knowledge still can be useful as a sanity check.
<p>
More generally, it is not too difficult to write a user-mode <tt>execveat()</tt>, so any supposed protection due to "security bits" associated with a <tt>#! interpreter</tt> script can be evaded by invoking the interpreter without the direct aid of the kernel.  The code is small enough to fit into the fragmentation on the last PROT_EXEC page of many PT_LOAD ELF segments, so many programs and shared libraries are vulnerable targets for exploitation.  If a program can create or modify a portion of a file, and apply <tt>mmap(,, PROT_EXEC,,,)</tt> to that portion, then many file-based security barriers can be evaded for any other files.


      
          <div class="CommentReplyButton">
            <form action="/Articles/982671/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982690"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with execveat()</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 17:18 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/982690/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Of course there are races, but the knowledge still can be useful as a sanity check.</span><br>
<p>
Perhaps races can be avoided with fexecve()?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982690/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor982702"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Just execute from stdin</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2024 21:59 UTC (Sat)
                               by <b>stephanlachnit</b> (subscriber, #151361)
                              [<a href="/Articles/982702/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hm, couldn't i just do `python | cat script.py` anyway (+some flags to execute from stdin)? Not sure if you gain that much more security with this...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982702/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982713"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Just execute from stdin</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 5:28 UTC (Sun)
                               by <b>matthias</b> (subscriber, #94967)
                              [<a href="/Articles/982713/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Probably you mean cat script.py | python or simply python &lt; script.py.<br>
<p>
To prevent this, the SECBIT_EXEC_DENY_INTERACTIVE flag is proposed. This flag -- if set --  instructs the interpreter to only run code from disk, i.e. not from the command line and not from stdin. <br>
<p>
Also this is mostly not meant for users that already have full shell access. Users with shell access are usually trusted to some degree, as the shell can pretty much do anything, python can do. And if you do not have shell access it will be much harder to set up pipes and redirect stdin. This can be one line of defense to prevent an attacker from executing arbitrary code, which the attacker might just have uploaded to some web service. There is the noexec mount flag for some reason. Unfortunately, noexec does not prevent the execution of scripts by an interpreter. And this is what is addressed with this patch.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982713/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982725"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Just execute from stdin</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 13:04 UTC (Sun)
                               by <b>milesrout</b> (subscriber, #126894)
                              [<a href="/Articles/982725/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So in other words this is yet more security theatre bloat added to the kernel for "defence in depth". In practice it is such a big complicated API and it is so Linux-specific it will be hardly used anyway.<br>
<p>
Here is an idea: if you don't want people to execute arbitrary code, don't give them access to general purpose computers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982725/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982726"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Just execute from stdin</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 13:26 UTC (Sun)
                               by <b>pizza</b> (subscriber, #46)
                              [<a href="/Articles/982726/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Here is an idea: if you don't want people to execute arbitrary code, don't give them access to general purpose computers.</span><br>
<p>
In case you haven't noticed, *everything* is a general-purpose computer these days.<br>
<p>
The ones that claim not to be are just general-purpose computers locked down via various combinations of "defense in depth" mechanisms.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982726/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982748"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Just execute from stdin</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 22:21 UTC (Sun)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/982748/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In fairness to the OEMs, it is probably cheaper to just manufacture a single SoC for all use cases, than to manufacture a bunch of different dumb chips for a bunch of different dumb use cases. I'm sure there are some use cases that are sufficiently dumb and popular that you really can get away with giving them a dedicated dumb chip, but simple economies of scale would suggest that most dumb use cases are better off using non-dumb hardware.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982748/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor982762"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reduced engineering effort</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2024 9:08 UTC (Mon)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/982762/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>And just as it's simpler for the IC vendors to have a small number of SoCs covering the entire market, it's simpler for the software teams to just use a common general-purpose OS rather than having a special-case OS for every single product class. Writing a program to run on top of Linux is a lot easier than writing something run on bare metal, and thus the resulting product is cheaper than if you had to write for bare metal all the time.


      
          <div class="CommentReplyButton">
            <form action="/Articles/982762/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor982716"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Just execute from stdin</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2024 9:10 UTC (Sun)
                               by <b>hjp</b> (subscriber, #119873)
                              [<a href="/Articles/982716/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You mean `cat script.py | python` (or simpler `python &lt; script.py`). This is what SECBIT_EXEC_DENY_INTERACTIVE is meant to prevent. The Python interpreter wouldn't accept commands from stdin if this flag is set.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982716/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor984278"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Just execute from stdin</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 1, 2024 16:30 UTC (Thu)
                               by <b>rep_movsd</b> (guest, #100040)
                              [<a href="/Articles/984278/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What if I made a fifo and typed stuff into it <br>
<p>
 <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/984278/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor982770"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Shouldn't this be be an SeLinux type problem?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2024 12:13 UTC (Mon)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/982770/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Wouldn't it make more sense to use some kind of labelling solution, and define which contexts are allowed to read in which files?<br>
<p>
I don't see how this SOEXEC thing is that useful, other than in contrived and limited ways..<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/982770/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor983591"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">what is interpretation?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2024 21:45 UTC (Fri)
                               by <b>amarao</b> (subscriber, #87073)
                              [<a href="/Articles/983591/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Which interpreters should be locked? Awk? Sed? Bc? Systemd? Groff? Lynx?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/983591/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor983596"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">what is interpretation?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2024 22:03 UTC (Fri)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/983596/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
all of them<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/983596/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor999489"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Very challenging issue</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 25, 2024 6:06 UTC (Mon)
                               by <b>ultract</b> (guest, #174754)
                              [<a href="/Articles/999489/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Michael is tackling a very challenging issue.<br>
While it’s possible to control unauthorized executable binary (ELF) files through mechanisms like IMA/EVM or mandatory access control (MAC) features,<br>
script files are plain text, and the diverse execution methods of interpreters, combined with their essential role as execution layers in Linux distributions, make complete control difficult.<br>
Of course, it might be possible to manage this using mandatory access control features, but if that were feasible, such discussions likely wouldn't even exist.<br>
In any case, since Michael is neither a maintainer nor a developer for the many interpreters, it’s questionable whether interpreter developers would accept the functionality he wants to integrate into the kernel.<br>
It might be necessary for hardened Linux distributions aimed at specific use cases or workloads, though.<br>
Additionally, vendors with sufficient resources, like Google, would likely port all interpreter-based applications natively, as they do with ChromeOS.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/999489/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2024, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
