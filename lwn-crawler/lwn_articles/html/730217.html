        <!DOCTYPE html>
        <html lang="en">
        <head><title>An alternative device-tree source language [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/730217/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/729755/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/730217/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>An alternative device-tree source language</h1>
</div>
<div class="ArticleText">
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>August 9, 2017</br>
           </div>
Device trees have become, in a relatively short time, the preferred way to
inform the kernel of the available hardware on systems where that hardware
is not discoverable — most ARM systems, among others.  In short, a
device tree is a textual description of a system's hardware that is
compiled to a simple binary format and passed to the kernel by the
bootloader.  The source format for device trees has been established for a
long time — longer than Linux has been using it.  Perhaps it's time for a
change, but a proposal for a new
device-tree source format has generated a fair amount of controversy in the
small corner of the community that concerns itself with such things.
<p>
It may be hard to believe that, as recently as 2011, the use of device
trees for the ARM architecture was controversial.  Over time, though,
device-tree proponents won out; ARM board files are mostly gone and unlamented,
and the kernel source tree contains 2400 or so device-tree files.  The
<a href="http://elinux.org/Device_Tree_Usage">source format for device
trees</a>, though, was never really discussed; the
kernel community simply went with the format that was laid out in
OpenFirmware many years ago.  It was well defined, and there didn't seem to
be any real reason for anybody to seek to change it.
<p>
As a simple example, consider this fragment of the <a
href="/Articles/730224/">Beaglebone Black device tree</a>:
<p>
<pre>
    leds {
	pinctrl-names = "default";
	pinctrl-0 = &lt;&amp;user_leds_s0&gt;;
	compatible = "gpio-leds";

	led2 {
	    label = "beaglebone:green:heartbeat";
	    gpios = &lt;&amp;gpio1 21 GPIO_ACTIVE_HIGH&gt;;
	    linux,default-trigger = "heartbeat";
	    default-state = "off";
	};
    };
</pre>
<p>

This fragment describes the green "heartbeat" LED; it indicates which GPIO
line it 
is connected to and more.  A device-tree source file for a complex
system-on-chip contains a great deal of text like the above.  This
device-tree source (DTS) file will be fed to the compiler (<tt>dtc</tt>) to
generate a binary "device-tree blob" (or DTB) file.  That file, in turn,
will be handed to the kernel when the system boots.
<p>
Pantelis Antoniou recently showed up on the device-tree list with <a
href="/Articles/729156/">a proposal</a> for a new device-tree compiler
called <tt>yamldt</tt>.  It produces the same DTB files as <tt>dtc</tt>,
but the source format is different.  Rather than go with the classic DTS
format, <tt>yamldt</tt> deals with device trees expressed in the <a
href="http://www.yaml.org/">YAML</a> format.  So, the above fragment, in
the new scheme, would look like this:
<p>
<pre>
    leds:
        pinctrl-names: "default"
        pinctrl-0: *user_leds_s0
        compatible: "gpio-leds"
        led2:
            label: "beaglebone:green:heartbeat"
            gpios: [ *gpio1, 21, GPIO_ACTIVE_HIGH ]
            linux,default-trigger: "heartbeat"
            default-state: "off"
</pre>
<p>
Antoniou would appear to have a number of reasons for wanting to make this
change.  The DTS language is used only for device trees; few developers are
familiar with it.  YAML, instead, is ubiquitous and well understood.  DTS
requires its own parser, while YAML parsers exist for almost every language
one can imagine.  Text editors tend to have built-in modes for editing YAML
files.  Simplified YAML can even be easily understood by
low-level code like bootloaders; that, in turn, makes it possible (and
relatively easy) for the
bootloader to edit the device tree on the fly at system boot time.  This
editing is needed to support <a href="/Articles/616859/">device-tree
overlays</a> for dynamic hardware.  "<q>I feel that the reliance on DTS
has been holding progress back in expressing modern hardware</q>", he <a
href="/Articles/730226/">said</a>; switching to a different source language
is his way of addressing that problem.
<p>
Another important issue, though, is validation of device trees.  There are,
in a sense, three components to any device-tree implementation.  The
device-tree "bindings" are a specification of how device trees are to be
expressed; there are over 1000 binding descriptions in the kernel tree.
For example, <a
href="/Articles/730227/">Documentation/devicetree/bindings/leds/common.txt</a>
specifies how all LED devices should be described in a DTS file.  The real
arbiter of what is correct, though, is the code in drivers that interprets
device trees; what happens there may or may not match what the bindings
say.  Then there are the actual DTS files which may not properly match
either the bindings or the driver code.  There would be, as Tom Rini <a
href="/Articles/730364/">pointed out</a>, real value in a
tool that could validate a DTS file 
against the relevant bindings and, maybe someday, also help with the
implementation of device-tree consumer code in the kernel.
<p>
Using YAML for both bindings and device-tree source files holds out the
possibility of that kind of validation.  Each type of device-tree node can
be described in terms of the fields it may (and must) have and the data
types for each; the compiler (or one of the existing YAML schema-checking
tools)  can then ensure that any source file follows the rules.  This kind
of validation has not yet been implemented, and it will not be an easy job
since the bindings files now are not in any sort of machine-readable
format.  But the possibility is there.
<p>
Even so, Antoniou's work would appear to be facing some fairly strong
headwinds.  One of the kernel's device-tree maintainers, Frank Rowand,
<a href="/Articles/730348/">replied</a>:
<p>
<div class="BigQuote">
	Keep in mind one of the reasons Linus says he is very direct is to
	avoid leading a developer on, so that they don't waste a lot of
	time trying to resolve the maintainer's issues instead of realizing
	that the maintainer is saying "no". Please read my current answer
	as being "no, not likely to ever be accepted", not "no, not in the
	current form".
</div>
<p>
Rowand <a href="/Articles/730349/">softened</a> his position a bit after
learning more about the work, but he was not alone in expressing
skepticism.  Perhaps that is not surprising; kernel developers who come in
proposing major changes often get a conservative response at the beginning.
<p>
Some of the developers involved appear to fear the prospect of converting
vast numbers of DTS files into a new format.  That task is not hard —
Antoniou has tested his tools by converting the entire set of in-kernel DTS
files to YAML, then verifying that they compile to the same DTB files — but
it does involve a lot of churn.  Antoniou is not actually proposing such a
change, though; he seems to see YAML as an alternative format, rather than
a replacement for DTS.  But, as Rob Herring (another kernel device-tree
maintainer) <a href="/Articles/730350/">put it</a>: "<q>If YAML solves a
bunch of problems, then of course we'd want to convert DTS files at some
point</q>".
<p>
David Gibson, the <tt>dtc</tt> maintainer, had <a
href="/Articles/730351/">a number of concerns</a>, though he did concede
that, had YAML been well established when <tt>dtc</tt> was written, it
might have been chosen rather than DTS.  But he pointed out that YAML is a more
expressive 
language than DTS; in particular, it can express things that cannot be
rendered into DTB in any straightforward way.  That might, he suggests,
encourage developers to write device trees that cannot be properly
compiled.  He also, like some others, suggested that the YAML source format
does not help much with validation.  Bindings could be put into YAML and
used to validate device trees in the current DTS format.  Antoniou
naturally <a href="/Articles/730354/">disagreed</a>, saying that the
ability to use and track type information in YAML device-tree files will be
an important part of a future validation mechanism.
<p>
As the conversation wound down, Grant Likely <a
href="/Articles/730355/">said</a> that the important contribution in this
work may be the definition of a data model for device-tree data.  That
model needs to exist before any sort of formal validation can be done.  In
the end, that may be the part of this proposal that has the most influence
going forward, though it is hard to tell for sure, since this conversation
didn't reach any firm conclusions.  Like the ARM device-tree conversion
itself, this looks like a topic that will need several iterations on the
mailing lists before some sort of consensus emerges.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Device_tree">Device tree</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/730217/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor730397"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">An alternative device-tree source language</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2017 21:49 UTC (Wed)
                               by <b>creese</b> (subscriber, #32352)
                              [<a href="/Articles/730397/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I thought ARM64 servers had already moved away from device tree toward ACPI. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730397/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730409"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">An alternative device-tree source language</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2017 23:28 UTC (Wed)
                               by <b>daney</b> (guest, #24551)
                              [<a href="/Articles/730409/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I thought ARM64 servers had already moved away from device tree toward ACPI.</font><br>
<p>
They have, but we still have to consider the set of devices running the Linux kernel that are not data-center servers.<br>
<p>
Considering the example from the article, most ACPI based servers probably don't have green LEDs, but for embedded devices that do, device tree is the state-of-the-art way to describe how they are connected.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730409/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor730398"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2017 21:50 UTC (Wed)
                               by <b>shemminger</b> (subscriber, #5739)
                              [<a href="/Articles/730398/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The existing DT format looks a lot like JSON already, why not go that direction?<br>
There are lots of tools for editing and parsing JSON already.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730398/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730400"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2017 21:56 UTC (Wed)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/730400/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      YAML is a superset of JSON as I understand it, so in a sense it <i>is</i> going with JSON...
      
          <div class="CommentReplyButton">
            <form action="/Articles/730400/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730407"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2017 23:14 UTC (Wed)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/730407/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not quite; it's a superset of the *expressiveness* of JSON, but YAML doesn't parse as JSON.<br>
<p>
I do want to see this use a regularized data format. I do think that YAML has a bit too much magic for this purpose, though, such as its handling of strings, and some of the indentation and list corner cases.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730407/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730412"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2017 23:31 UTC (Wed)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/730412/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Comments, * and &amp; references, and merge key (a supplemental specification) support are worth a lot however.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730412/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730445"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 10:58 UTC (Thu)
                               by <b>dbnichol</b> (subscriber, #39622)
                              [<a href="/Articles/730445/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Comments is my #1 reason to prefer YAML over JSON. Every time I find myself writing any non-trivial JSON document I get frustrated that I can't put comments in explaining what's going on. I then have to write another document next to the JSON explaining what's going on in the JSON and hope other people will read it (and that I'll remember to update it the next time I touch the JSON file).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730445/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730447"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 11:09 UTC (Thu)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/730447/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If all you want are comments and you're not coding to a strict spec (i.e., extra keys are allowed), you can add "__comment" fields to JSON, but they're clunky and only fit in around dictionary fields (good luck commenting a large array of integers).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730447/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor731240"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2017 8:10 UTC (Thu)
                               by <b>gowen</b> (guest, #23914)
                              [<a href="/Articles/731240/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote><i>Comments is my #</i></blockquote>
Stopped reading at this point :)
      
          <div class="CommentReplyButton">
            <form action="/Articles/731240/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor730422"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 2:46 UTC (Thu)
                               by <b>Paf</b> (subscriber, #91811)
                              [<a href="/Articles/730422/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think you've misunderstood the meaning of "superset" here.<br>
<p>
Specifically, it means "All JSON is YAML, not all YAML is JSON".  JSON is valid YAML, YAML is not necessarily JSON.<br>
<p>
So YAML is JSON, and other things too.<br>
<p>
Though I agree the other things aren't necessarily things you want.  Less expressiveness can sometimes be a boon.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730422/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730424"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 4:05 UTC (Thu)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/730424/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I was questioning the phrase "in a sense it is going with JSON".<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730424/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor730427"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 5:15 UTC (Thu)
                               by <b>drag</b> (guest, #31333)
                              [<a href="/Articles/730427/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Any good yaml document should be easily convertible to json and visa versa. If you end up with a yaml document that isn't easily converted to json it's a pretty mean thing to do to somebody.<br>
<p>
YAML is nice for smallish configuration files you want easily readable by humans.   But for parsing and dealing with lots of data Json wins hands down.  Even for human readability it gets very easy to get lost when yaml document sizes grow beyond a certain size.<br>
<p>
But either is fine really as long as they are easily convertible to one another. They are actually quite complimentary in practice.  Lots of times when I deal with large amounts of json format I will use 'jq' or some similar tool to shrink what I am dealing with down to the specific hunk I am interested in and then convert to yaml if I need to do hand editing or whatever. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730427/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor730437"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 9:28 UTC (Thu)
                               by <b>jond</b> (subscriber, #37669)
                              [<a href="/Articles/730437/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If human-legibility is a driver, then YAML is a much better choice than JSON, which was "designed" (really, re-purposed) as a data interchange format first and foremost.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730437/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor730475"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not XML?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 13:43 UTC (Thu)
                               by <b>meyert</b> (subscriber, #32097)
                              [<a href="/Articles/730475/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There is also a standard for validation of structures called XSD...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730475/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730633"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not XML?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2017 15:34 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/730633/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I suspect because the kernel developers do not want to be driven completely mad -- and struggling with the unreadability of XML, the even worse unreadability of XSD and the near unavailability of XSD validators that run at sane speeds and actually do what they're supposed to (let alone those that aren't written in Java and don't pull in half the universe)... well, this doesn't seem like a thing very likely to fly very far with people as generally interested in functional minimalism as kernel developers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730633/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor730638"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2017 16:00 UTC (Fri)
                               by <b>BenHutchings</b> (subscriber, #37955)
                              [<a href="/Articles/730638/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
JSON doesn't have 64-bit integers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730638/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730671"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2017 18:26 UTC (Fri)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/730671/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; JSON doesn't have 64-bit integers.</font><br>
<p>
The JSON "number" type has no limitations on the range. All 64-bit integers, both signed and unsigned, can be encoded as JSON numbers. It is true that not all JSON parsers *read* such integers accurately; for example, JavaScript treats all numbers as double-precision floating point, and thus can only handle 53-bit integers without rounding. However, this is a limitation of the parser, not the file format. One needs to be careful when selecting tools to manipulate JSON files to ensure that the full precision of the original data is preserved.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730671/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730730"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not JSON?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 12, 2017 9:51 UTC (Sat)
                               by <b>mbunkus</b> (subscriber, #87248)
                              [<a href="/Articles/730730/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Exactly. A lot of folks assume that JSON's number type is limited the same way JavaScript's is, but that simply isn't true. The JSON spec does not limit it at all. JSON is independent of JavaScript.<br>
<p>
As an example of how wide-spread this false assumption is, look at Qt[1]. Their JSON implementation stores all numbers internally as doubles, losing significant precision for large integer values. This bug has been present for the whole Qt5 lifetime and is still unsolved, making the implementation completely unusable for interfacing with external systems where you do not have control over the data format.<br>
<p>
[1] <a href="https://bugreports.qt.io/browse/QTBUG-28560">https://bugreports.qt.io/browse/QTBUG-28560</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730730/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor730431"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">An alternative device-tree source language</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 7:02 UTC (Thu)
                               by <b>pantoniou</b> (subscriber, #85257)
                              [<a href="/Articles/730431/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Interesting. Didn't know you picked stuff from lists other than the kernel mailing list.<br>
<p>
FYI, things are much further along that what the article describes.<br>
<p>
The most important is that an eBPF based validator based on the YAML schemas posted a couple of years back by robh is almost ready.<br>
<p>
I will follow up with a number of blog entries at our company website in the following weeks explaining things in detail...<br>
<p>
Please feel free to ask questions in this thread.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730431/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor730436"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">An alternative device-tree source language</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 9:23 UTC (Thu)
                               by <b>grawity</b> (subscriber, #80596)
                              [<a href="/Articles/730436/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      If there was a "dts2yaml" tool, wouldn't that improve the situation a bit without requiring to officially add a new format? Validators could just as easily read from a pipe.
      
          <div class="CommentReplyButton">
            <form action="/Articles/730436/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730448"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">An alternative device-tree source language</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 11:17 UTC (Thu)
                               by <b>pantoniou</b> (subscriber, #85257)
                              [<a href="/Articles/730448/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There is one, it's a patch for DTC that outputs YAML instead of DTB.<br>
<p>
Now this converts the generated output file, it does not do anything about the sources.<br>
<p>
Since DTS input is preprocessed and DTC throws away type information while parsing it is hard to do an accurate translation.<br>
Source files are not particularly complicated though, so someone might write a tool that works on a source level and gets most of it right.<br>
<p>
Manual inspection will be needed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730448/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor730518"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">yaml in the bootloader?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 19:06 UTC (Thu)
                               by <b>ukleinek</b> (subscriber, #56625)
                              [<a href="/Articles/730518/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  Simplified YAML can even be easily understood by low-level code like bootloaders;</font><br>
<font class="QuotedText">&gt; that, in turn, makes it possible (and relatively easy) for the bootloader to edit the</font><br>
<font class="QuotedText">&gt; device tree on the fly at system boot time. </font><br>
<p>
That would mean however that the bootloader doesn't only feature a yaml parser, but also a yaml-to-dtb compiler as the kernel expects a compiled device tree, not a source file.<br>
<p>
Also note that U-Boot and barebox are both able to modify the compiled device tree before jumping into Linux. That is for example used to pass kernel parameters, the mac address for an ethernet device, the partitioning of a NAND chip or the available amount of RAM.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730518/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730522"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">yaml in the bootloader?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 19:58 UTC (Thu)
                               by <b>pantoniou</b> (subscriber, #85257)
                              [<a href="/Articles/730522/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Err, no.<br>
<p>
In YAML documents are clearly marked by the --- marker.<br>
<p>
You will never have to edit a YAML file the way that DTB now requires bootloader to modify the blob to pass things like the command line to the kernel, mac addresses etc.<br>
<p>
In YAML you merely paste the new edits.<br>
<p>
So... if you have a boot YAML source that has a chosen node:<br>
<p>
chosen: &amp;chosen<br>
  foo: blargh<br>
<p>
To add a the bootargs to the kernel you append the following the original boot blob.<br>
<p>
---<br>
*chosen:<br>
  bootargs: "linux kernel bootargs"<br>
<p>
So, it's actually so much simpler than editing the DTB.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730522/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor730524"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">yaml in the bootloader?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2017 21:01 UTC (Thu)
                               by <b>ukleinek</b> (subscriber, #56625)
                              [<a href="/Articles/730524/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  You will never have to edit a YAML file the way that DTB now requires</font><br>
<font class="QuotedText">&gt; bootloader to modify the blob to pass things like the command line to</font><br>
<font class="QuotedText">&gt; the kernel, mac addresses etc.</font><br>
<p>
What happens behind the scene isn't that important. Today I can (in barebox) do:<br>
<p>
    # of_property -s eth0 status disabled<br>
<p>
to set the status property that the alias eth0 points to to disabled. Setting bootargs is similar:<br>
<p>
    # global linux.bootargs.tralala="rootwait"<br>
<p>
to append "rootwait" to the kernel parameter list. This works independent of the boot method (dt or atags).<br>
<p>
IMHO this is simple enough and I fail to imagine how this will get better with yaml.<br>
<p>
Sorry, I don't see the downside of the bootloader working with a dtb compared to yaml + yaml-to-dtb compiler.<br>
<p>
Do you argue that the UI gets easier or the backing code? I would doubt both for now. (Also, if you target the backing code, you have to offer real benefits, just changing working code to use a different format because you can isn't very compelling.)<br>
<p>
Best regards<br>
Uwe<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730524/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor730733"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">An alternative device-tree source language</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 12, 2017 13:30 UTC (Sat)
                               by <b>robert_s</b> (subscriber, #42402)
                              [<a href="/Articles/730733/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I have a deep hatred of YAML and the ugly complexity hidden inside it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/730733/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor731310"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">An alternative device-tree source language</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2017 14:07 UTC (Thu)
                               by <b>andy_shev</b> (subscriber, #75870)
                              [<a href="/Articles/731310/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not enough chaos in chaotic device tree world, let's add a bit more...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/731310/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2017, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
