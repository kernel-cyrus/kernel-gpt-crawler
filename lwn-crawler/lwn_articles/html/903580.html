        <!DOCTYPE html>
        <html lang="en">
        <head><title>A security-module hook for user-namespace creation [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/903580/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/903819/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/903580/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>A security-module hook for user-namespace creation</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>August 4, 2022</br>
           </div>
The Linux Security Module (LSM) subsystem works by way of an extensive set
of hooks placed strategically throughout the kernel.  Any specific security
module can attach to the hooks for the behavior it intends to govern and be
consulted whenever a decision needs to be made.  The placement of LSM hooks
often comes with a bit of controversy; developers have been known to object
to the 
performance cost of hooks in hot code paths, and sometimes there are <a
href="/Articles/902466/">misunderstandings</a> over how integration with
LSMs should be handled.  The disagreement over a security hook for the
creation of user namespaces, though, is based on a different sort of
concern.
<p>
User namespaces, which can be created by unprivileged processes, give the
creator complete control over user and group IDs.  Within the namespace,
the creator can run as root, but all interactions with the system are
mapped back to the creator's user and group ID.  They are a fundamental
building block for unprivileged containers.  In theory, user namespaces are
entirely safe; in practice, they have long been accompanied by worries
about the increased attack surface that comes from making formerly
root-only actions available within the namespace.  There have indeed been
vulnerabilities resulting from interactions with user namespaces; see <a
href="/ml/oss-security/nZdp4o4iHdicJfJwEJ-dtJrhs5aDa-cbvA3psbItS3dkwOwxmzwXanoaslI0T5nXjCNz0Cm5csVgCJxDWPWIaKDbF6mxaYch5xJo3QT-8_0%3D%40protonmail.com/">this
report</a> for a recent example.  Whether user namespaces are truly more
prone to vulnerabilities than the rest of the kernel is not clear, though.
<p>
See <a href="/Articles/532593/">this article</a> for more information on
user namespaces.
<p>
As Frederick Lawler notes in <a
href="/ml/linux-kernel/20220801180146.1157914-1-fred@cloudflare.com/">this
patch set</a>, security modules currently have a degree of control over
user-namespace creation, but that control relies on a hook that was not
actually 
intended for access-control decisions.  Among other things, that prevents
any error code from being propagated back to the (presumably frustrated)
user.  The solution is to create a new hook
(<tt>security_create_user_ns()</tt>) that is called prior to the creation
of a new namespace, and which can cause the action to fail if it is not
consistent with the current security policies.
<p>
It is a relatively straightforward patch set, even after adding a self-test
and a hook implementation for SELinux.  Over four revisions, it has seen a
number of tweaks and appears to be at a point where developers in the
security community are happy with it.  There is, of course, an exception;
Eric Biederman <a
href="/ml/linux-kernel/877d45kri4.fsf@email.froward.int.ebiederm.org/">raised
some objections</a> in response to the posting of the third revision in
late July.  One was that blocking access to user namespaces as a way of
reducing attack surface would only be effective if the bulk of the
exploitable bugs in the kernel would be blocked; otherwise, he said,
attackers would simply find a different bug to exploit.
<p>
His larger complaint, though, was essentially an objection to applying any
sort of access control to user namespaces at all.  Over time, he said,
numerous new kernel features have been restricted to the root account
mostly because otherwise they could be used to confuse setuid programs.
That has resulted in more code running as root, which is not good for
security overall.  User namespaces were meant to bring an end to that
trend:
<p>
<blockquote class="bq">
	One of the goals of the user namespace is to avoid more and more
   	code migrating to running as root.  To achieve that goal ordinary
   	application developers need to be able to assume that typically
   	user namespaces will be available on linux.
<p>
   	An assumption that ordinary applications like chromium make today.
<p>
   	Your intentions seem to be to place a capability check so that only
   	root can use user namespaces or something of the sort.  Thus
   	breaking the general availability of user namespaces for ordinary
   	applications on your systems.
</blockquote>
<p>
Biederman concluded with a "Nacked-by" tag indicating rejection of the
patch.
<p>
He was alone in that view, though.  SELinux maintainer Paul Moore <a
href="/ml/linux-kernel/CAHC9VhQXSXWv=+WYwU=Qq0w3rd+zOFPHL5yut1JdV2K=DDRmmg@mail.gmail.com/">answered</a> 
that LSM hooks provide for more than just access control; auditing and
observability are also important use cases for them.  He asserted that
"<q>integrating the LSM into the kernel's namespaces is a natural fit, and
one that is long overdue</q>", and asked Biederman to suggest alternatives
if the proposed hook is truly not acceptable.  Ignat Korchagin (who, like
Lawler, posted from a Cloudflare email address) <a
href="/ml/linux-kernel/CALrw=nGT0kcHh4wyBwUF-Q8+v8DgnyEJM55vfmABwfU67EQn=g@mail.gmail.com/">said</a>
that the real goal was to increase the use of user namespaces by providing
more control over them:
<p>
<blockquote class="bq">
	So in a way, I think this hook allows better adoption of user
	namespaces in the first place and gives distros and other system
	maintainers a reasonable alternative than just providing a global
	"kill" sysctl (which is de-facto is used by many, thus actually
	limiting userspace applications accessing the user namespace
	functionality).
</blockquote>
<p>
Biederman did not respond further, and the conversation wound down.  Moore
<a
href="/ml/linux-kernel/CAHC9VhQw8LR9yJ9UkA-9aPNETQavt25G-GGSs-_ztg6ZpxNzxA@mail.gmail.com/">suggested</a>
that it was time to get the work merged:
<p>
<blockquote class="bq">
	There is the issue of Eric's NACK, but I believe the responses that
	followed his comment sufficiently addressed those concerns and it
	has now been a week with no further comment from Eric; we should
	continue to move forward with this.
</blockquote>
<p>
After the posting of version&nbsp;4 on August&nbsp;1, though, Biederman <a
href="/ml/linux-kernel/87les7cq03.fsf@email.froward.int.ebiederm.org/">made
it clear</a> that he did not believe his concerns had been dealt with.
"<q>Nack Nack Nack</q>".
<p>
What will come next is not entirely clear.  Biederman still has not offered
any sort of alternative approach to the problem, so developers are left
with a somewhat unpleasant choice: either restart from the beginning in
the hopes of finding a solution that Biederman will not try to block, or
simply ignore Biederman and merge the hook anyway.  Since Biederman is
evidently opposed to any sort of access control for user-namespace
creation, the space of mutually acceptable solutions may be small.
Pushing code over a
maintainer's objections is not done lightly in the kernel community, but it
does occasionally happen.  Moore has already <a
href="/ml/linux-kernel/CAHC9VhRpUxyxkPaTz1scGeRm+i4KviQQA7WismOX2q5agzC+DQ@mail.gmail.com/">indicated</a>
that this case may play out that way.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Namespaces-User_namespaces">Namespaces/User namespaces</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-6.1">Releases/6.1</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-Security_modules">Security/Security modules</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/903580/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor903844"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 4, 2022 17:23 UTC (Thu)
                               by <b>developer122</b> (guest, #152928)
                              [<a href="/Articles/903844/">Link</a>] (23 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think it&#x27;s very true that user namespaces, as a generic way of isolating security concerns, are only useful if they are reliably and easily available. I apologize for the crude metaphor, but teens will only use condoms (to prevent a range of undesirable consequences) if they are cheap and easy to obtain.<br>
<p>
To make user namespaces unreliable would *also* fundamentally break the security model and assumptions (of available mitigation) of an enormous number of existing userspace applications.<br>
<p>
This whole exercise is born out of a fear that *some unspecified exploitable code* might still be reachable from inside a namespace, thus we should ban namespaces. That might not be the immediate intent, but that will be the result as some LSMs will ban them outright and many will interfere with their use under various circumstances. No application will be able to count on their availability. <br>
<p>
Userspace applications will instead implement fallback mechanisms to work-around LSMs, many of which will probably involve the system&#x27;s *actual* root.<br>
<p>
If people are concerned about user namespaces being proous, they should be working to improve them directly. Make available new classes of more restricted/isolated user namespace. Implement a tagging system so that objects from a namespace can be marked persona-non-grata, configured by the creating application. Etc. Etc. Address the actual concerns.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903844/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor903846"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 4, 2022 17:24 UTC (Thu)
                               by <b>developer122</b> (guest, #152928)
                              [<a href="/Articles/903846/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
fix: porous*<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903846/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor903847"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 4, 2022 17:27 UTC (Thu)
                               by <b>developer122</b> (guest, #152928)
                              [<a href="/Articles/903847/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If we left it purely up to sysadmins, the open() system call would be privileged.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903847/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor903851"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">open()</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 4, 2022 18:47 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/903851/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Somebody will surely point out that there is an LSM hook for <tt>open()</tt> and has been since LSM was created, so it might as well be me.


      
          <div class="CommentReplyButton">
            <form action="/Articles/903851/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor903848"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 4, 2022 18:40 UTC (Thu)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/903848/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Doesn&#x27;t this argue for eliminating all LSM hooks? Any of them would allow an LSM to prohibit some operation that should not be prohibited. Realistically, LSMs don&#x27;t prohibit things that are needed by userspace applications, or they also prohibit any workarounds those applications would use, and people use LSMs that permit the operations that are used by the applications they want to use.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903848/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor903863"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 4, 2022 20:52 UTC (Thu)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/903863/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  Doesn&#x27;t this argue for eliminating all LSM hooks? </font><br>
<p>
LSM has basically failed to be useful, so yeah. It works only in very specific environments like Android.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903863/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor903873"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 4, 2022 22:13 UTC (Thu)
                               by <b>Paf</b> (subscriber, #91811)
                              [<a href="/Articles/903873/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
“Useful only in restricted environments” isn’t “failed to be useful”, is it?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903873/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor903887"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 1:36 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/903887/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  “Useful only in restricted environments” isn’t “failed to be useful”, is it?</font><br>
<p>
Ok. &quot;Failed to be widely useful&quot;. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903887/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor903910"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 6:40 UTC (Fri)
                               by <b>jrjohansen</b> (subscriber, #75010)
                              [<a href="/Articles/903910/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It is enabled and used by default on Debian, SuSE, Ubuntu, Android and several other distros. There are several CVEs that have been blocked by its use on these distros.. Could it be better used, sure but I would not call that &quot;failed to be widely useful&quot;.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903910/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor903933"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 12:24 UTC (Fri)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/903933/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; There are several CVEs that have been blocked by its use on these distros.</font><br>
<p>
Could you provide one that is convincing ?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903933/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904019"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 17:24 UTC (Fri)
                               by <b>jrjohansen</b> (subscriber, #75010)
                              [<a href="/Articles/904019/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Convincing to who? But just a few examples CVE-2014-7169, CVE-2016-9962, CVE-2017-6074, CVE-2017-7494, CVE-2019-5736. Just how effective the LSM is depends on which LSMs are deployed, and what policies. The LSM is more than just SELinux, smack, etc. There are other modules that can be stacked on top: Yama, safesetid, lockdown, loadpin, landlock, etc.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904019/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904030"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 20:01 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/904030/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; CVE-2014-7169</font><br>
<p>
This doesn&#x27;t prevent the exploit that allows the attacker to run arbirtrary code, but it prevents this arbitrary code from gaining root right away. Assuming no other exploits.<br>
<p>
<font class="QuotedText">&gt; CVE-2017-6074</font><br>
<p>
This is BS. Basically, &quot;you can use SELinux to prohibit loading of modules&quot;. You can also just delete them, it&#x27;s not a mitigation.<br>
<p>
<font class="QuotedText">&gt; CVE-2019-5736</font><br>
<p>
This was the only real non-trivial one from your list, and in this case the proper fix is to use user namespaces.<br>
<p>
All in all, very few exploits are truly prevented by SELinux. It sometimes makes it harder for attacker to gain wider access.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904030/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904054"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 23:50 UTC (Fri)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/904054/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
 &gt; &gt; CVE-2017-6074<br>
<p>
<font class="QuotedText">&gt; This is BS. Basically, &quot;you can use SELinux to prohibit loading of modules&quot;. You can also just delete them, it&#x27;s not a mitigation.</font><br>
<p>
Not having read any of the background stuff but ... how does deleting modules protect against an attacker dropping a module onto your system?<br>
<p>
Mind you, I believe you can also build your kernel with the &quot;load module&quot; code missing, no? Perfect for gentoo users like me :-)<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904054/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904242"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2022 3:13 UTC (Tue)
                               by <b>jrjohansen</b> (subscriber, #75010)
                              [<a href="/Articles/904242/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;&gt; &gt; CVE-2017-6074</font><br>
<font class="QuotedText">&gt;</font><br>
<font class="QuotedText">&gt;&gt; This is BS. Basically, &quot;you can use SELinux to prohibit loading of modules&quot;. You can also just delete them, it&#x27;s not a  mitigation.</font><br>
<font class="QuotedText">&gt;</font><br>
<font class="QuotedText">&gt; Not having read any of the background stuff but ... how does deleting modules protect against an attacker dropping a module onto your system?</font><br>
<font class="QuotedText">&gt;</font><br>
<p>
If the attacker can load or get modules to load, the attacker may be able to exploit a flaw in a module to gain root or even just full kernel privileges. Now you might think if the attack can load a module or get a module to load they are already root, but that isn&#x27;t always the case. They could be a regular user who can get a module to autoload via some action or they could have restricted root privileges (basically sandboxed in some way).<br>
<p>
If the attacker can build and load their built module they can easily gain full kernel privileges, but on systems where they can only trigger module auto-load of existing modules or if the system require signed modules, the attacker will have to resort to exploiting flaws in existing modules.<br>
<p>
<font class="QuotedText">&gt; Mind you, I believe you can also build your kernel with the &quot;load module&quot; code missing, no? Perfect for gentoo users like me :-)</font><br>
<p>
that is an option that does work for those who can use it.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904242/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor904218"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2022 20:03 UTC (Mon)
                               by <b>jrjohansen</b> (subscriber, #75010)
                              [<a href="/Articles/904218/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;&gt; CVE-2014-7169</font><br>
<font class="QuotedText">&gt;</font><br>
<font class="QuotedText">&gt; This doesn&#x27;t prevent the exploit that allows the attacker to run arbirtrary code, but it prevents this arbitrary code from gaining root right away. Assuming no other exploits.</font><br>
<p>
of course it can&#x27;t stop or fix every flaw/CVE in an application, but it did do its job of containing said flaw and prevented it from becoming a root exploit. Yes there could be another way to elevate to root that is always a possibility unless you can mathematically prove otherwise, but it did stop this one.<br>
<p>
<font class="QuotedText">&gt; &gt; CVE-2017-6074</font><br>
<font class="QuotedText">&gt;</font><br>
<font class="QuotedText">&gt; This is BS. Basically, &quot;you can use SELinux to prohibit loading of modules&quot;. You can also just delete them, it&#x27;s not a mitigation.</font><br>
<p>
Yes it is. Sure there are other ways to block modules from loading: building the kernel without module support, lockdown (also an LSM), loadpin (also an LSM). What SELinux brings is context, where some services are still allowed to load modules, because the broader solutions don&#x27;t work for some environments.<br>
<p>
<font class="QuotedText">&gt; &gt; CVE-2019-5736</font><br>
<font class="QuotedText">&gt;</font><br>
<font class="QuotedText">&gt; This was the only real non-trivial one from your list, and in this case the proper fix is to use user namespaces.</font><br>
<p>
The proper fix is always to patch/rewrite the software to remove the vulnerability, that doesn&#x27;t take away from SELinux doing its job here.<br>
<p>
<font class="QuotedText">&gt; All in all, very few exploits are truly prevented by SELinux. It sometimes makes it harder for attacker to gain wider access.</font><br>
<p>
Security is about layers and making it harder for an attacker is a win. No SELinux won&#x27;t fix programs that have exploits in them, but neither do user namespaces.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904218/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor904073"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 6, 2022 12:15 UTC (Sat)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/904073/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Debian conveniently provides links between CVE and packages update, see<br>
<p>
https://security-tracker.debian.org/tracker/CVE-2014-7169<br>
https://security-tracker.debian.org/tracker/CVE-2016-9962<br>
https://security-tracker.debian.org/tracker/CVE-2017-6074<br>
https://security-tracker.debian.org/tracker/CVE-2017-7494<br>
https://security-tracker.debian.org/tracker/CVE-2019-5736<br>
<p>
So all those CVE lead to packages update and all but one lead to a DSA to be issued,<br>
the  exception being a CVE that only affected unstable.<br>
<p>
So as far as Debian is concerned, LSM do not seems to reduce the number of security updates.<br>
<p>
<p>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904073/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904074"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 6, 2022 13:11 UTC (Sat)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/904074/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It would seem odd to not issue a fix just because Debian has a default LSM-using setup since it supports not using an LSM. I don&#x27;t think that is evidence that LSMs don&#x27;t serve a purpose myself. I say that as someone that uses SELinux on Fedora normally, but it broke logging in on one machine recently…so is in Permissive mode until I track down the problem.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904074/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor904076"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 6, 2022 14:28 UTC (Sat)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/904076/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; So as far as Debian is concerned, LSM do not seems to reduce the number of security updates.</font><br>
<p>
This isn&#x27;t the purpose of LSM.  It is to mitigate or reduce the severity of vulnerability for end users. Distributions may choose to downgrade the severity of the issue based on the mitigations available by default however they won&#x27;t be able to negate their responsibility to issue updates regardless.  This isn&#x27;t specific to LSM,  if say, Firefox sandboxing stops a vulnerability from being exploited currently, Mozilla isn&#x27;t going to just ignore the vulnerability, they will still patch it anyway.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904076/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor904216"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2022 19:43 UTC (Mon)
                               by <b>jrjohansen</b> (subscriber, #75010)
                              [<a href="/Articles/904216/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As @rahulsundaram mentions below that isn&#x27;t what the LSM is supposed to do. When vulnerabilities are found you still want to fix them regardless if they are stopped or mitigated by an LSM or any other hardening or security techniques.<br>
<p>
LSMs can however stop, mitigate or contain an exploit reducing severity of a vulnerability, and hence reducing the priority of fixing a given CVE.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904216/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor903899"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 2:49 UTC (Fri)
                               by <b>developer122</b> (guest, #152928)
                              [<a href="/Articles/903899/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You don&#x27;t make unreliable a mechanism you want to encourage users to use. User namespaces are an important security mechanism that right now has universal support. If you make their availability unreliable then people won&#x27;t use them. They&#x27;ll implement workarounds that involve handing out actual root permissions.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903899/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor904038"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 20:39 UTC (Fri)
                               by <b>amarao</b> (subscriber, #87073)
                              [<a href="/Articles/904038/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;m totally fine with audit hooks, if they do not slow down things. I think that arbitrary fails for things which are expected to work is bad. Let&#x27;s say I wrote a code to use with namespaces. I ask kernel to create one. It returned me &#x27;402 payment required&#x27;. What should I do? Exit with code 1? Show &#x27;error: denied&#x27; dialog box and exit after &#x27;OK&#x27;?<br>
<p>
I have a better idea. How about restricting with LSM ability for processes to exit? There is a syscall for that, and by EPERM it, we can forbid crashing software! It&#x27;s going to work no matter what!<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904038/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904285"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2022 17:32 UTC (Tue)
                               by <b>cschaufler</b> (subscriber, #126555)
                              [<a href="/Articles/904285/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hee Hee. There is a legitimate use case for an LSM hook that would prevent a process from successfully terminating. Forensic analysis of a process that did Bad Things and got caught.<br>
<p>
In the early days of X11 clients no one checked error codes because there wasn&#x27;t any notion of what to do if your color map wasn&#x27;t properly loaded or the like. They figured out how to handle errors reasonably. Many early Unix utilities ignored the return from the write() system call. We don&#x27;t much tolerate that any more. Assuming a syscall is never going to fail in an unexpected way isn&#x27;t good programming practice, and never has been. Sure, you can argue that adding an errno to the list a call can return is an API change, but that&#x27;s a stretch. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904285/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor903923"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 10:14 UTC (Fri)
                               by <b>jkbs</b> (subscriber, #107081)
                              [<a href="/Articles/903923/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You can already block user-namespace creation today with an existing LSM hook (cred_prepare) as demonstrated in this blog post:<br>
<p>
<a href="https://blog.cloudflare.com/live-patch-security-vulnerabilities-with-ebpf-lsm/">https://blog.cloudflare.com/live-patch-security-vulnerabi...</a><br>
<p>
The initial intention behind the patch set was to improve the error reporting, so that it is not confusing to the users, as the article here point out.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903923/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor903927"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 11:39 UTC (Fri)
                               by <b>mokki</b> (subscriber, #33200)
                              [<a href="/Articles/903927/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That is how I read it too. I fail to see any valid reason why better error reporting should be nacked.<br>
<p>
And there are likely network visible software (such as sshd/https) that do not currently use namespaces and where pre-emptively blocking them improves security by adding an extra layer.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903927/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor903853"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 4, 2022 19:34 UTC (Thu)
                               by <b>bartoc</b> (guest, #124262)
                              [<a href="/Articles/903853/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It seems more interesting to me to have LSMs enforce that programs _must_ use namespaces rather than restricting them, but I don&#x27;t generally see the problem with having policy that restricts usage for software that isn&#x27;t expecting to use them either.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903853/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor904493"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2022 17:53 UTC (Thu)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/904493/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It&#x27;s a bit ridiculous that they&#x27;re seriously proposing forcing everyone back to relying on setuid binaries to set up sandboxes instead of accepting the reality that this is, quite frankly, insane.<br>
<p>
Security through insecurity! It&#x27;s like grsec never ragequit.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904493/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor905184"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A security-module hook for user-namespace creation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 19, 2022 2:06 UTC (Fri)
                               by <b>cypherpunks2</b> (guest, #152408)
                              [<a href="/Articles/905184/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
They went private, but they&#x27;re still actively developing their patches. They&#x27;re just no longer free.<br>
<p>
The fact is, (unprivileged) user namespaces DO open up an extremely large attack surface area. I manage hundreds of computers in a high-security environment and unprivileged userns is the first thing we shut down. The same is true for many other organizations that operate in an adversarial environment and require higher security than your average Joe.<br>
<p>
Every time there&#x27;s a new CVE (and even more often when a CVE isn&#x27;t obtained), a significant fraction of them are only exploitable if CAP_SYS_ADMIN is available through an unprivileged user namespace. When security is about hard numbers and not a warm fuzzy feeling, limiting access to this unpolished feature drastically reduces the number of successful exploits encountered in the wild.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/905184/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2022, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
