        <!DOCTYPE html>
        <html lang="en">
        <head><title>Transport-level protocols in user space [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/691887/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/691664/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/691887/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Transport-level protocols in user space</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>This article brought to you by LWN subscribers</b>
<p>
Subscribers to LWN.net made this article &mdash; and everything that
       surrounds it &mdash; possible.  If you appreciate our content, please
       <a href="/Promo/nst-nag3/subscribe">buy a subscription</a> and make the next
       set of articles possible.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>June 20, 2016</br>
           </div>
The Linux networking developers have long held a strong opinion about
user-space protocol implementations: they should be avoided in favor of
making the in-kernel implementation better.  So it might be surprising to
see a veteran networking developer post a patch set aimed at making
user-space implementations easier.  A look at this patch and its
motivations shines an interesting light on changes that are taking place in
the networking world.
<p>
The developer in question is Tom Herbert; the patch set is titled "<a
href="/Articles/691873/">transports over UDP</a>", or "TOU".  This
patch set allows any transport-layer protocol (such as TCP or <a
href="https://en.wikipedia.org/wiki/Stream_Control_Transmission_Protocol">SCTP</a>)
to be 
packaged up and carried within a stream of UDP packets.  The mechanism by
which this is done is described in <a
href="https://tools.ietf.org/html/draft-herbert-transports-over-udp-00">this
draft RFC</a> (also written by Tom); it uses the draft <a
href="https://tools.ietf.org/html/draft-ietf-nvo3-gue-01">generic UDP
encapsulation (GUE)</a> specification for the actual encapsulation.  The
patch set adds basic (still incomplete) TOU support to the kernel, with the
ability to encapsulate TCP connections in particular.
<p>
Any destination that is reachable via UDP should also, in principle, be
reachable directly using a transport-layer protocol, so one might well
wonder why it is worth the trouble to hide that protocol inside UDP.  The
fact that this encapsulation comes with (according to Tom's benchmark
numbers) a 10-15% performance loss also serves to increase eyebrow
elevation.  It turns out, though, that there are a few advantages to encapsulating a
protocol like TCP in this way.
<p>
The first of those is that, as mentioned above, it facilitates running the
transport-layer protocol stack in user space.  The usual reason for
bypassing the kernel in favor of user-space networking is to maximize
performance for specific types of communications, but that is not the
intent here.  Tom (and his employer Facebook) envision putting the
transport-layer protocol code into desktop and mobile client applications
instead, and the main reason to do that is to speed progress on the
development and adoption of newer protocol versions.  Tom <a
href="/Articles/691888/">described the purpose</a> this way:
<p>
<div class="BigQuote">
	The major problem we have is that Android and to some extent iOS
	&amp; Windows take a long time to update the kernel, and it can
	take an _extremely_ long time if we need them to actively enable
	features that are needed by applications. For instance, TFO [<a
	href="/Articles/508865/">TCP fast open</a>] was put in the Linux
	[kernel]
	several years ago, but it still hasn't been enabled in Android and
	only fairly recently enabled in iOS. If we (e.g. Facebook)
	implement a userspace stack in clients and control the stack in our
	servers we can roll out a feature like that in a couple of months.
</div>
<p>
This is, in other words, an attempt to address the <a
href="/Articles/667059/">protocol ossification problem</a> by taking more
direct control of the protocol code on both sides of the connection.  That
will, it is thought, allow network protocols to start evolving at a
reasonable pace again — when users are running the right
user-space implementation, at least.
<p>
The other benefit to TOU is related to the protocol ossification problem,
but also to the privacy and security concerns that are prevalent on the
net.  Once the transport-layer headers (and payload) are encapsulated
within a UDP packet, they no longer need to be sent in the clear.  The TOU
draft specifies that DTLS (<a
href="https://tools.ietf.org/html/rfc4347">datagram transport layer
security</a>) can be used to encrypt the payload of the UDP packets,
hiding the transport-layer information entirely from any system other than
the endpoints.  It thus brings back the idea of end-to-end networking,
where the endpoints know about a specific communication and all other
machines in the middle exist only to serve as dumb transport.
Eavesdropping on communications — or even collecting metadata — would be
much harder in a world where TOU was widely deployed and used.
<p>
TOU can thus provide privacy, but there is another advantage: routers along
the path ("middleboxes") will be unable to inspect packets and filter out
specific protocols.  This filtering makes the addition of any new protocol
difficult at best.  Adding a simple flag for <a
href="https://en.wikipedia.org/wiki/Explicit_Congestion_Notification">explicit
congestion notification (ECN)</a> made much of the net unreachable; the
developers of <a href="/Articles/544399/">multipath TCP</a> have had to go
to considerable lengths to disguise the new protocol as boring vanilla TCP
to get it past middleboxes.  But once a middlebox loses visibility into the
protocol that is actually being used, it also loses the ability to filter
it.  That too, Tom hopes, will fight ossification and speed the adoption of
new protocols.
<p>
It is also worth noting that encapsulating a TCP connection in this way
separates it from the underlying network, making the endpoints of TCP
connections mobile.  That, too, could be useful in a world where computers
move rapidly from one network to the next.
<p>
Before all this can happen, though, the TOU patches need to find their way
into the kernel.  Networking maintainer David Miller <a
href="/Articles/691889/">did not reject them</a>, but he did express some
strong misgivings about the whole thing, starting with the additional
maintenance burden that it implies:
<p>
<div class="BigQuote">
	We also now have to debug against every single userland TCP
	implementation someone can come up with, the barrier to entry is
	insanely low with TOU.  Maybe this sounds great to you, but to me
	it is quite terrifying
	This has a monumental impact upon maintenance of our TCP stack.
</div>
<p>
He suggested that, in the future, developers would treat TOU-related bug
reports the way reports involving proprietary modules are treated now — by
ignoring them.  He also worried that the middlebox problem might not be
quite so easily solved:
<p>
<div class="BigQuote">
	This sounds really great on paper, however I find it hard to
	believe that makers of middleware boxes are just going to throw
	their hands in the air and say "oh well, we lose."  Rather, I think
	people are going to start adding rules to block TOU tunnels
	entirely because they cannot inspect nor conditionally
	filter/rewrite the contents.
</div>
<p>
Tom responded that the bulk of the net allows UDP traffic now, and that a
number of higher-level protocols, including <a
href="/Articles/558826/">QUIC</a>, have been successfully deployed.  The
nascent <a
href="https://www.ietf.org/mail-archive/web/spud/current/msg00501.html">path
layer UDP substrate</a> effort is working to improve flow control for
UDP-based transport protocols.  Overall, that seems to be the direction the
net is taking, and TOU should fit into it well, so it may not be
unreasonable to believe that it will get through middleboxes in the future.
<p>
It would seem that the way to save the Internet is to take the
higher-level protocols out of the kernel's hands and bury them, instead, in
the applications.  There is one potential problem here, though, that has
not yet really been discussed on the list.  TOU <i>could</i> be used to achieve
rapid deployment of new Internet standards.  Or it could be used to deploy
a whole new set of proprietary transport-level protocols that are not
easily accessible outside of closed-source applications.  It could be that
TOU-like technologies (including the already-deployed QUIC) will, instead,
retard the adoption of open Internet standards by rendering them
irrelevant.  Tom <a href="/Articles/692062/">acknowledged</a> that the
whole idea 
"<q>conflicts with our idea of what the architecture of
the Internet should be<q>", but also asserted that the development
community cannot ignore it.
<p>
In summary, enabling this mode might lead to a world where the
network evolves more quickly and is more resistant to surveillance and
eavesdropping.  On the other hand, it could lead to a fragmented net where
each large company has its own transport-layer protocols baked into its own
proprietary applications.  Guarantees that things would go the right way
would appear to be in short supply; this area is going to be interesting to
watch.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Networking">Networking</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/691887/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor692074"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 6:23 UTC (Tue)
                               by <b>xman</b> (guest, #46972)
                              [<a href="/Articles/692074/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Adding a simple flag for explicit congestion notification (ECN) made much of the net unreachable</font><br>
<p>
On the down side, the whole point of ECN is that any hop along the way can potentially signal congestion by flipping the bits. You lose that if they aren't manipulating the embedded protocol.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692074/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692079"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 7:44 UTC (Tue)
                               by <b>kugel</b> (subscriber, #70540)
                              [<a href="/Articles/692079/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Did they hear about Foo-over-UDP already, which is part of the mainline?<br>
<p>
I guess together with KCM it can even be relatively performant.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692079/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692085"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 8:41 UTC (Tue)
                               by <b>iarenaza</b> (subscriber, #4812)
                              [<a href="/Articles/692085/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
They should know about it :-), as Tom Herbert is the author of Foo-over-UDP patch set (see <a href="https://lwn.net/Articles/614348/">https://lwn.net/Articles/614348/</a>).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692085/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692090"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 9:22 UTC (Tue)
                               by <b>kugel</b> (subscriber, #70540)
                              [<a href="/Articles/692090/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Interesting. That makes me wonder why that isn't used by himself? What's the difference? I must be missing some key element.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692090/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor692120"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 13:19 UTC (Tue)
                               by <b>NAR</b> (subscriber, #1313)
                              [<a href="/Articles/692120/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There's also GTP to tunnel IP over UDP. Skimming through the draft this "Generic UDP Encapsulation" might be faster (depending on hardware acceleration), but otherwise I don't see any improvement.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692120/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor692189"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 16:32 UTC (Tue)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/692189/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Do you  mean that editing the packet's ECN bits is a downside? But the alternative is dropping the packet which any hop along the way could also do.<br>
<p>
Or did you mean that the downside is that with these customized protocols embedded in UDP, there is no longer any way for routers to do things like flipping ECN bits and they now have no choice but to drop packets.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692189/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor692078"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 8:16 UTC (Tue)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/692078/">Link</a>] (34 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
From the perspective of the End to End Principle, the kernel is no different from a "middleware box": it confiscates some of the implementation from the "real End" = the application.<br>
<p>
Exerting control on applications put aside, performance looks like the only real reason for TCP to be in the kernel. User-space libraries are obviously enough for code re-use.<br>
<p>
I bet the above just summarized what has already been explained in a gazillion of research papers (of which there shouldn't be a gazillion in the first place; but I digress). Ossification, research: pick one.<br>
<p>
<p>
<font class="QuotedText">&gt; "We also now have to debug against every single userland TCP implementation someone can come up with, the barrier to entry is insanely low with TOU."</font><br>
<p>
Wow, "barriers to entry" presented as a good thing: that's serious "ossification" indeed. Looks like some would like a GPL'ed version of the Internet: one you cannot fork freely. By the way: are other kernels besides Linux allowed to network in such a world? Only if they can demonstrate a slow and conservative enough development pace?<br>
<p>
OSI and telcos are back?<br>
<p>
<font class="QuotedText">&gt; Rather, I think people are going to start adding rules to block TOU tunnels entirely because they cannot inspect nor conditionally filter/rewrite the contents.  This is even more likely if Joe Random and so easily can do their own userland TCP stack over TOU.</font><br>
<p>
Whoever filters Facebook today may switch to new ways in the future. Whoever doesn't now, is very unlikely to filter TOU in the future. So this will make little difference if any.<br>
<p>
Whatever happens here, the most powerful "barrier to entry" will always remain: Metcalfe's law. It will be more than enough to clamp the number of Joe Random implementations. Metcalfe's law is cruel for "small"; but it's especially crueler for "small + buggy".<br>
<p>
<font class="QuotedText">&gt; I suspect a lot of bug reports will go straight to /dev/null once it is clear that it is a TOU TCP connection.</font><br>
<p>
Bug reports from Joe Random getting ignored: what's new? TOU-related bug reports from Facebook, Amazon or Google coming with tentative fix attached? I bet they will be looked at.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692078/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692100"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 11:14 UTC (Tue)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/692100/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; From the perspective of the End to End Principle, the kernel is no different from a "middleware box": it confiscates some of the implementation from the "real End" = the application.</font><br>
<p>
No, the real end is the user.<br>
The kernel has always been a great way for the user to keep control on the applications.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692100/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692147"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 15:51 UTC (Tue)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/692147/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; No, the real end is the user.</font><br>
<p>
The closer to the user, the closer to the principle. From that perspective TOU is a massive step forward. Whether the e2e principle is good or bad, when and how is a much bigger question.<br>
<p>
<font class="QuotedText">&gt; The kernel has always been a great way for the user to keep control on the applications.</font><br>
<p>
The kernel has always been a great way                     to keep control on the applications.<br>
<p>
Kernels were and are still designed to keep applications and users from interfering with each other (and with the network). It's only recent that so many people can afford exclusive ownership and control of a pocket computer[*]. It took ages to get to this <a href="https://developer.android.com/training/permissions/requesting.html">https://developer.android.com/training/permissions/reques...</a> and despite all Google's efforts I bet most users still don't take advantage of it: too complicated. Most users are not admins of their own devices because there's no market interest: it's way too technical. (Un)installing/disabling/upgrading applications is control that is simple enough for all users to actually understand and perform. At the risk of hurting the feelings of this kernel-centric community: the vast majority of users have no more interest in controlling the kernel running in their pocket than for controlling the setup box in their home. Too far away from them. Just make sure my apps work and get out of the way. Security? Yes please, make it secure for me as long as I don't need to know about it. Privacy? What's that again?<br>
<p>
[*] this evolution is obvious when you see that each Android application is assigned a separate user ID.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692147/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692703"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 25, 2016 19:01 UTC (Sat)
                               by <b>robert_s</b> (subscriber, #42402)
                              [<a href="/Articles/692703/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"The closer to the user, the closer to the principle."<br>
<p>
I disagree that the application is closer to the user than the OS. The application is closer to the corporatized (and often rather greedy) vision the application developer has. The application likes to think it exists in a vacuum on your system without having to interoperate with or work alongside things it doesn't want to. One of the OS's important jobs is to police that on behalf of the user.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692703/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692728"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 26, 2016 10:37 UTC (Sun)
                               by <b>Fowl</b> (subscriber, #65667)
                              [<a href="/Articles/692728/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That job has been delegated to the web browser, it seems <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692728/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor692739"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 26, 2016 18:38 UTC (Sun)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/692739/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This discussion has so far been confusing two different types of control/freedoms:<br>
<p>
A) run-time control, e.g.: root permission, cgroups, firewalls, etc.<br>
B) "build/install control", sorry for the lack of a better term. e.g.: choosing which application to trust and install, a.k.a: "is there an app for that?"<br>
<p>
<p>
<font class="QuotedText">&gt; One of the OS's important jobs is to police that...</font><br>
<p>
Yet is is, and this can be type of control/freedom A. <br>
<p>
<font class="QuotedText">&gt; ... on behalf of the user.</font><br>
<p>
... on behalf of the *administrator*.<br>
<p>
Freedom A obviously did not exist on multi-user systems. Now that everyone has a single-user computer in their pocket you'd think people have it. Except not because it's way too technical and complicated and scary, so all users besides geeks still want someone else to manage this on their behalf: see the massive success of secure/verified boot, DRMs, managed set-up boxes, etc.[*]. So nice theory but was never really practised on a wide scale. In practice the OS is owned just like the rest of the network is.<br>
<p>
This leaves only freedom B as a (admittedly limited) type  of control for most users.<br>
<p>
<p>
<p>
[*] now add Linux TCP/IP maintainers to that list?<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692739/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor693209"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 1, 2016 21:21 UTC (Fri)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/693209/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  This discussion has so far been confusing two different types of control/freedoms:</font><br>
<p>
I think it is also confusing two types of user. The user/owner, and the (ab)user/nonowner.<br>
<p>
Just because I'm the user doesn't mean I have any special rights. The owner may be someone completely different who wants to use the kernel to secure HIS rights.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/693209/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor692096"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 12:06 UTC (Tue)
                               by <b>k3ninho</b> (subscriber, #50375)
                              [<a href="/Articles/692096/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;Ossification, research: pick one.</font><br>
Interfaces are hard, so we went sho- ...and built AWS and the cloud instead.<br>
<p>
I've got a grumble with the idea that we build things with a fixed set of data fields but simly don't make use of the metadata available at creation (authorship, compilation, deployment) to indicate interoperability and control compatbility. We're missing the opportunity that the metadata about the version of the program provides to show the intent of interoperability so we can easily know whether programs are compatible. <br>
<p>
Separation of interface and implementation is a helpful distinction to make and is widely adopted everywhere but Linux kernel, the distributions' library space and (consequently) the conatainerized tools for distributed applications in the cloud. Stuff like Telegram has a magic number which can be queried to say which versions of its messaging are supported and the magic number is appended to your calls. With this additional layer of abstraction (ha!) between the supported interfaces and the could improve the research side of computer science while respecting the ossification that's needed for engineering robust systems.<br>
<p>
K3n. (Yes, I hear you say 'show us the code' so I'll slink away quietly.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692096/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor692127"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 15:28 UTC (Tue)
                               by <b>gdt</b> (subscriber, #6284)
                              [<a href="/Articles/692127/">Link</a>] (19 responses)
      </p>
      
      </div>
      </summary>
      <p><i>Exerting control on applications put aside&hellip;</i></p>

<p>Except that this is key. Networking authors fear that moving congestion control to userspace will lead to parties adopting congestion control algorithms which work well for the individual but which lead to congestion collapse for the network or lead to extreme unfairness between differing classes of connections. A high barrier to entry for the creation and wide dissemination of such algorithms is seen as desirable to prevent that Internet-breaking outcome.</p>

<p>Similar concerns have been expressed by researchers (eg, the last decade of Floyd's <a href="http://www.icir.org/floyd/papers.html">work</a> before she retired), so the picture you paint of &ldquo;ossification, research: pick one&rdquo; is far too simplistic.</p>

<p>Concern about the fairness of connections between newer congestion control algorithms and established congestion control algorithms isn't limited to Linux. It can be found in the design of Microsoft's Compound TCP. CTCP is so focussed on avoiding extreme unfairness to connections from Windows Xp computers that it models the congestion window of that older congestion control algorithm and only exceeds that algorithm's datarate when unfairness will not be a result. Interestingly, many of the congestion control parameters are locked down on consumer versions of Windows to prevent misuse.</p>

<p>There are ways forward to userspace congestion control, but the proposed API is simply &lsquo;trust userspace&rsquo; which is probably too simple and too trusting. Of course  there is a performance penalty for being less simple and less trusting. Meaning that there's no immediately-apparent choice of API, but that a skilled design of careful choices is needed.</p>

<p><i>OSI and telcos are back?</i> Oh please, that's rhetoric from ancient history. The situation in the IETF has changed so very much in thirty years that you can now often see telcos/ISPs being on the side of the angels and opposing equipment vendors wishing to cut corners for sooner &lsquo;time to market&rsquo;.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/692127/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692180"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 16:03 UTC (Tue)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/692180/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Except that this is key. Networking authors fear that moving congestion control to userspace will lead to parties adopting congestion control algorithms which work well for the individual but which lead to congestion collapse for the network or lead to extreme unfairness between differing classes of connections. A high barrier to entry for the creation and wide dissemination of such algorithms is seen as desirable to prevent that Internet-breaking outcome.</font><br>
<p>
You never had someone in your household using Bittorrent. Skype and others already use their own congestion control; wake up and smell the coffee.<br>
<p>
The correct location to enforce traffic control and contain congestion is subscriber/bill paying/peering interface. Then please leave end users the freedom to flood their own network or not. They decide which network applications they use or not. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692180/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692230"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 20:17 UTC (Tue)
                               by <b>nim-nim</b> (subscriber, #34454)
                              [<a href="/Articles/692230/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The result of such thinking is hilarious on any shared network.<br>
<p>
Want to watch video? Ni problem, youtube, akamai, whatever will saturate your link.<br>
<p>
Why is only one person in the building getting the video? Well the CDN saturated the link of course. No provision for a second watcher. All the javascript knows is push as many bits as possible till nothing else fits<br>
<p>
(at which point your home becomes a shared network? I now have 7 streaming-capable network nodes at home, most of them appliances in different rooms. Does it qualifies?)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692230/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692293"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 22, 2016 4:37 UTC (Wed)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/692293/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Ni problem, youtube, akamai, whatever will saturate your link.</font><br>
<p>
As long as its only your link: not a problem since you know the person who is saturating it and can do something about it.<br>
<p>
<font class="QuotedText">&gt; The result of such thinking is hilarious on any shared network.</font><br>
<p>
The result is hilarious... today.<br>
<p>
<font class="QuotedText">&gt; (at which point your home becomes a shared network? I now have 7 streaming-capable network nodes at home, most of them appliances in different rooms. Does it qualifies?)</font><br>
<p>
So you are new to all this. Welcome.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692293/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692544"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 23, 2016 17:27 UTC (Thu)
                               by <b>cwillu</b> (guest, #67268)
                              [<a href="/Articles/692544/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;&gt; Ni problem, youtube, akamai, whatever will saturate your link.</font><br>
<p>
<font class="QuotedText">&gt;As long as its only your link: not a problem since you know the person who is saturating it and can do something about it.</font><br>
<p>
Ahhh... the myopic view of the bachelor.<br>
<p>
"Honey, I'm trying to play counterstrike, can you stop watching netflix?" is not a good answer.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692544/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692547"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 23, 2016 19:42 UTC (Thu)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/692547/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think the point was that you could do your own traffic shaping on your home router to enforce fairness between devices (or whatever other policy you want), not that you would manually shut off devices which are using excessive bandwidth.<br>
<p>
We're long past the point where it is reasonable to simply assume that every device and application will employ fair congestion algorithms. Effective traffic shaping policies at the border are a necessity, and render tight control over the endpoints' congestion algorithms unnecessary. In any case, it doesn't make sense to allow applications to use UDP (which has no built-in congestion control) and yet forbid them from taking charge of the TCP congestion algorithm.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692547/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692767"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 27, 2016 4:29 UTC (Mon)
                               by <b>gdt</b> (subscriber, #6284)
                              [<a href="/Articles/692767/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <p>To date most UDP algorithms have had flow-control. DNS, for example, has one packet in flight per query. Where UDP algorithms don't do congestion control then we already see congestion collapse, such as with high-rate videoconferencing systems taking out campus traffic.</p>

<p>Rate-limiting of client-side interfaces isn't enough. To suggest otherwise is to think only of the case of congestion is where the bottleneck link is the link to the customer. But there are two client-side interfaces on any congested path, so the the suggestion of using ingress rate-limiting fails on its own terms, as it fails to address the issue of congestion on the *far* client-side link.</p>

<p>In any case rate-limiting is too large a stick to be deployable. The customer has paid for 10Gbps. Rate limiting says they can't transmit at 10Gbps, even if that causes no congestion.</p>

<p>What you are handwavingly asking for is that the client-side interface ask "is this connection's sending rate reasonable given the apparent congestion control parameters?" That is, the router needs to reverse-engineer the TCP algorithm's variables. Easy enough to do for a TCP stream, but to do it for UDP streams then the only reasonable way to do that is for the router to tunnel them in a TCP stream to the far client-side egress interface. It also adds a new performance parameter to interfaces: the number of concurrent client-side connections they can support; and it's not difficult to see how that can become an anchor for an effective denial of service (and yeah, you could soft-fail and not monitor connections, in which case the library mentioned in another comment starts by opening 100,001 connections).<p>

<p>Now maybe networks will have to do that. But let's not pretend it will be cheap, either finanically, in terms of robustness, or in terms of latency (a three-way TCP handshake before that UDP packet progresses into the network).</p>

<p>The whole point of the TCP/IP protocols is that they found a better-performing and more robust design than "enforce congestion control in the network". Moving away from that design necessarily means less performance and less robustness. Maybe a failure of the commons will force us to that situation. But let's not pretend it is optimal.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/692767/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692768"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 27, 2016 6:43 UTC (Mon)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/692768/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Rate-limiting of client-side interfaces isn't enough. To suggest otherwise...</font><br>
<p>
I don't think anyone suggested otherwise yet.<br>
<p>
<font class="QuotedText">&gt; it fails to address the issue of congestion on the *far* client-side link.</font><br>
<p>
When you receive too much it's because you asked for it. For instance, this guy currently saturating your link with his brain-dead video conference application is almost always someone you know and someone you're trying to communicate with using the same brain-dead application. I bet you may both switch to a smarter and gentler application next time.<br>
<p>
<font class="QuotedText">&gt; What you are handwavingly asking for is that the client-side interface ask "is this connection's sending rate reasonable given the apparent congestion control parameters?" That is, the router needs to reverse-engineer the TCP algorithm's variables.</font><br>
<p>
What's done in the network doesn't have to be that real-time, that fine-grained and that close to TCP: leave that to the applications. <br>
<p>
<font class="QuotedText">&gt; The whole point of the TCP/IP protocols is that they found a better-performing and more robust design than "enforce congestion control in the network".</font><br>
<p>
What you and TCP are "handwavingly" asking is for everything to be nice and behave on the Internet. TCP's congestion control was a very smart afterthought, however gentlemen agreements can only last for so long:<br>
<a href="http://www.stevesouders.com/blog/2008/03/20/roundup-on-parallel-connections/">http://www.stevesouders.com/blog/2008/03/20/roundup-on-pa...</a><br>
<a href="https://trac.filezilla-project.org/ticket/2309">https://trac.filezilla-project.org/ticket/2309</a><br>
The per-connection "fairness" never made sense anyway: what's fair about someone or something multitasking getting more bandwidth?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692768/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692868"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 27, 2016 17:34 UTC (Mon)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/692868/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  gentlemen agreements can only last for so long</font><br>
<p>
I'm not sure that's really true, so much in society depends on people doing the right thing even when an authority isn't watching, civilization seems to still exist.  The network is just another facet of human interaction.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692868/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor693051"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 30, 2016 3:51 UTC (Thu)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/693051/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"A network" maybe sometimes yes; not the internet. In a civilization you're not exposed to threats from the entire planet.<br>
<p>
Whatever "real-world" agency is actually policing the internet has much bigger fish to fry than congestion control. Among many others, ransomware looks higher priority to me. Good luck with that one already.<br>
<p>
I don't think anyone expects the internet to look anything like a civilization any time soon. I hope the Linux network stack maintainers are not under such an illusion.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/693051/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor693238"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 2, 2016 13:16 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/693238/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &gt; gentlemen agreements can only last for so long</font><br>
<p>
<font class="QuotedText">&gt; I'm not sure that's really true, so much in society depends on people doing the right thing even when an authority isn't watching, civilization seems to still exist. The network is just another facet of human interaction.</font><br>
<p>
The problem here is that the people feeling the pain are not the people inflicting it. Even within a household. And as soon as the choke-point moves "out there", all the evidence says that people are indifferent (at best!) to the pain they inflict on other people - if it's some impersonal "them", it's not seen as important.<br>
<p>
I think the fairest thing to do is choke traffic by IP address. And if it's IPv6, you choke based on the network portion (iiuc, v6 comes as a network half and device half, and it's allocated by the network half). That way, cheating by opening multiple connections won't work :-)<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/693238/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor692801"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 27, 2016 17:16 UTC (Mon)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/692801/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; To date most UDP algorithms have had flow-control.</font><br>
<p>
At the application level, which was the whole point. The proposal which has gathered so much opposition was merely to give applications control over the congestion algorithm for TCP, when they already have full control over the congestion algorithms (if they exist at all) for UDP-based protocols.<br>
<p>
This is not an argument that congestion algorithms are useless, but rather that mandatory QoS is needed at the routers regardless of any congestion algorithms (well-behaved or otherwise) at the endpoints. You can't simply rely on the endpoints to do the right thing for the health of the entire network.<br>
<p>
<font class="QuotedText">&gt; In any case rate-limiting is too large a stick to be deployable. The customer has paid for 10Gbps. Rate limiting says they can't transmit at 10Gbps, even if that causes no congestion.</font><br>
<p>
You don't set a fixed rate, you limit the amount of data in the buffer, prioritizing packets according some "fairness" policy and dropping anything that can't be transmitted in a reasonable time. This is exactly what adaptive AQM (e.g. CoDel) was designed for, and it works quite well. If there is no congestion then you can transmit at line rate; if congestion appears then you start dropping packets selectively to maintain the configured QoS policy.<br>
<p>
Of course, you only get to set the QoS policy on your own routers. The endpoints are generally the lowest-bandwidth and thus most congested points, but if congestion does appear elsewhere in the network then the administrators of those routers will determine the policy. In my opinion the best default policy would be a fair division of available bandwidth according to source addresses for IPv4 or source /64 prefixes for IPv6—by user, in other words, to the extent that one can be readily identified.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692801/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692969"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 29, 2016 1:48 UTC (Wed)
                               by <b>gdt</b> (subscriber, #6284)
                              [<a href="/Articles/692969/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <p><i> The endpoints are generally the lowest-bandwidth and thus most congested points</i></p>

<p>I see that assumption a lot in this discussion. For many nations the undersea capacity is the bottleneck; for Australia's NBN it is the links to the ISP connection point (the 'CVC'); for a campus network it might be the campus link, shared between thousands of downstream users; for a metro ethernet network it might be the link from the basement switch of the building, shared between all occupants of that multistory residential block.</p>

<p>In short, congestion immediately north of the endpoint -- although common for US consumers -- isn't universal enough to anchor a design for congestion control enforcement .</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/692969/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692979"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 29, 2016 7:59 UTC (Wed)
                               by <b>micka</b> (subscriber, #38720)
                              [<a href="/Articles/692979/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; In short, congestion immediately north of the endpoint [...]</font><br>
<p>
north of ? I'm confused... Does it say something about the orientation of landline or cable installations ?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692979/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor693239"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 2, 2016 13:18 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/693239/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
upstream/downstream - north/south - an interchangeable metaphor (north is, in general parlance, up).<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/693239/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor693030"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 29, 2016 17:56 UTC (Wed)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/693030/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The point remains that whoever administers the congested router (whether that router is responsible for home network, a corporate intranet, a regional ISP, or the overseas traffic for an entire country) is responsible for managing the congestion in a fair manner, regardless of what any individual endpoint might do. Enforcing fair congestion algorithms at the endpoint is an infeasible task.<br>
<p>
Short of the adoption of a protocol like Backward ECN (<a href="https://en.wikipedia.org/wiki/Network_congestion#BECN">https://en.wikipedia.org/wiki/Network_congestion#BECN</a>) there isn't much that *can* be done at the ISP or national level beyond attempting to ensure fair access for each end-user.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/693030/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor693210"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 1, 2016 21:25 UTC (Fri)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/693210/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I think the point was that you could do your own traffic shaping on your home router to enforce fairness between devices (or whatever other policy you want), not that you would manually shut off devices which are using excessive bandwidth.</font><br>
<p>
I think you're assuming knowledge and ability way beyond what is actually available in most homes. My router is supplied by the telco, and I have no idea how to configure it - I have actually actively wanted to NOT get involved in messing with it.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/693210/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor692678"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 25, 2016 7:06 UTC (Sat)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/692678/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; "Honey, I'm trying to play counterstrike, can you stop watching netflix?" is not a good answer.</font><br>
<p>
Far from ideal, however and unless you're a (myopic?) geek it's pretty much the only practical answer available for any network performance issue. Random example among many, many others: <a href="http://www.agnilam.com/league-of-ledgends-ping-lag-reduce-checklist/">http://www.agnilam.com/league-of-ledgends-ping-lag-reduce...</a><br>
<p>
For the special case of professional bachel..^H gamers who can't stand the latency of a single extra packet queued in their way at any point in time, this will stay the answer for the foreseeable future. There are just too many buffers all over the place since most *other* consumers want throughput (or at least they're made to believe they do) and typically don't have a clue what latency is. So good luck policing ALL these buffers.<br>
<p>
I remember the days before mobile phones when telcos were trying to sell you additional landlines (on the same wires). I wonder if some tried that with gamers now?<br>
<p>
<font class="QuotedText">&gt; I think the point was that you could do your own traffic shaping on your home router to enforce fairness between devices (or whatever other policy you want), not that you would manually shut off devices which are using excessive bandwidth.</font><br>
<p>
It was both. The former for the few dozens of LWN readers, and the latter for everyone else.<br>
<p>
<p>
<font class="QuotedText">&gt; We're long past the point where it is reasonable to simply assume that every device and application will employ fair congestion algorithms. Effective traffic shaping policies at the border are a necessity, and render tight control over the endpoints' congestion algorithms unnecessary. In any case, it doesn't make sense to allow applications to use UDP (which has no built-in congestion control) and yet forbid them from taking charge of the TCP congestion algorithm.</font><br>
<p>
Quoting this entirely cause it's what I wish I could have written.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692678/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor692188"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 17:06 UTC (Tue)
                               by <b>mtaht</b> (subscriber, #11087)
                              [<a href="/Articles/692188/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One of the reasons why I have become such an advocate of "fair queuing" (and to a lesser extent) AQM, is that we already have lousy congestion control everywhere on the internet, despite putting up barriers to entry like requiring kernel support for good performance, recommending minimum numbers of flows open per application, etc.<br>
<p>
It's not just "bufferbloat"!. App writers will open dozens of tcp connections, middlebox writers and nat will make deploying new message based transports like sctp and dccp impossible, and nobody will care until sneakernet becomes the best way to share maps and cat videos again.<br>
<p>
Videoconferencing apps like jitsy and freeswitch do no congestion control already, and things that do do it, have been slow to take off or be incorporated in videoconferencing apps.<br>
<p>
The latest wave of the "distributed web" folk are leveraging a library that allows an application to create connections over every possible transport (udp,tcp,utp,sctp,etc), "any way you want", and "as many as you want"... which applications like ipfs, actually do use any way they want, with as many as they possibly can, simultaneously... I've been working really hard on just making rational, limited uses on multiple tcp flows work halfway decently for years now... and I stared blankly at the presenter so proud of this work in this lib, and wondered if I should grab the mic, or merely go drinking. (I went drinking).<br>
<p>
Nagle's basic premise - "every app is entitled to *one* packet in the network", is dead. So I give up.  Bring it on. One benefit to collapsing networks on a more regular basis would lead to the development of more internal, rather than cloud applications, in particular.<br>
<p>
Some other steps forward would be to, flippantly:<br>
<p>
I would support a development API that had a question+response segment you had to answer correctly in order to write the next line of code.<br>
<p>
#include &lt;TOU.h&gt;<br>
<p>
Compiler: Have you read and understood <a href="http://ee.lbl.gov/papers/congavoid.pdf">http://ee.lbl.gov/papers/congavoid.pdf</a> ?<br>
Compiler: Have you read and understood rfc5348?<br>
<p>
compiler: "OK, go ahead, and should your application become popular and you be wrong, my god have mercy on your soul, and you fix before the Internet collapses. There will be a quiz, later."<br>
<p>
...<br>
<p>
Bram Cohen has some lovely stories... one, about bittorrent taking out all of south korea at one point, and he was trying to build a low priority application in the first place. There was a very good idea in early versions of bittorrent - reducing the MSS size on congested links so a connection could still be transferring some data with minimal impact - he had to rip it out because hardware deployed in the field overloaded on such small packets in such volume.<br>
<p>
(I think it's a deployable idea today). There's also been some work on making tcp's use sub-packet windows, and certainly I regard the IW10 default of linux as horrifically stupid from outside of the datacenter, looking in (e.g from the home or business).<br>
<p>
...<br>
<p>
So, if we end up writing applications in javascript with udp... which seem inevitable at this point, do I think app writers will be suitably cautious? No. <br>
<p>
Which is where fq, enforced on the routers, comes into play, the only application you can hurt (mostly) is yourself. It has the benefit of having not been tried to any large extent, is much last nasty than what a typical middlebox would attempt to impose, and merely requires updating a few billion routers to use it before things get much worse.<br>
<p>
aqm, enforced on the routers, also, applies saner limits to application crazyness.<br>
<p>
I would, of course, love it, if a facebook tried to help out on getting stuff like fq_codel out to the edges before inflicting more hurt on the internet in this way.<br>
<p>
...<br>
<p>
I could see adding some sort of per-application limits on accessing stuff through this new API, also, like, no more than 6, and some application of fq techniques to multiplex app traffic through it, so no one application, accessing this api, could dominate the local machine.<br>
<p>
...<br>
<p>
Another thing that would help is to try and make sure the ipv6 deployment does have heavy users of newer protocols so that they are not firewalled or middleboxed away. dctp, sctp, udp-lite, etc. I would love it if a facebook or google were to make a service available over any of these native protocols over ipv6.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692188/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692241"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 21, 2016 21:18 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/692241/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Somehow, BitTorrent doesn't make Internet collapse. Mostly because there's a simple way to do traffic shaping - simply use src-dst tuples to drop random packets. That's it.<br>
<p>
If applications can't deal with it - then it's a problem for individual end-user nodes.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692241/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor693055"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 30, 2016 5:37 UTC (Thu)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/693055/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &gt; I suspect a lot of bug reports will go straight to /dev/null once it is clear that it is a TOU TCP connection.</font><br>
<p>
<font class="QuotedText">&gt; Bug reports from Joe Random getting ignored: what's new? </font><br>
<p>
Example: one of the many, spot reports of bufferbloat. A very simple one. Reported in 2004, more than 5 years before Jim Gettys thoroughly studied bufferbloat and gave it a catchy name. According to <a href="https://lwn.net/Articles/617070/">https://lwn.net/Articles/617070/</a>, this had been ignored until 2014.<br>
<p>
I find nothing wrong with ignoring bug reports from nobodies; the reputation system serves a useful filtering purpose and this is the way it's supposed to work. Everything is fine... as long as no one pretends that all reports get looked at.<br>
<p>
<font class="QuotedText">&gt; TOU-related bug reports from Facebook, Amazon or Google coming with tentative fix attached? I bet they will be looked at.</font><br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/693055/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor693082"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 30, 2016 13:33 UTC (Thu)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/693082/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Interesting blast from the past. After re-reading the wider comment threads there, it is sad that this is _still_ happening:<br>
<p>
3: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000<br>
<p>
Fedora 24. qdisc + 1k qlen. <br>
<p>
:( :( :(<br>
<p>
(And yeah, I've raised bugs in the past, given suggested scripts for NM to set lower qlen - rejected).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/693082/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor693406"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 5, 2016 9:39 UTC (Tue)
                               by <b>Lennie</b> (subscriber, #49641)
                              [<a href="/Articles/693406/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's amazing to see something like this:<br>
<p>
"Going back to what Marc said in an earlier e-mail about having txqueuelen in the unit of bytes rather than packets to provide a fixed queueing delay in ms rather than packets.  Maintaining txqueuelen in ms would be an ideal solution, but probably hard to achieve in practice."<br>
<p>
That is actually what CoDel does, drop some packets when the length of the queue measured _in time_ becomes to long (simplification).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/693406/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor693407"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 5, 2016 9:48 UTC (Tue)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/693407/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, and the response to my Fedora bug on lowering the default qdisc qlen (or setting it according to the negotiated bitrate - at least the initial one) was that a much better fix would just be to switch over to CoDel. Which is fair enough. And it has happened for the default for ethernet:<br>
<p>
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>
<p>
But wlan still seems stuck on qdisc and a massive qlen. :(<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/693407/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor694697"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2016 11:45 UTC (Sun)
                               by <b>mtaht</b> (subscriber, #11087)
                              [<a href="/Articles/694697/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Assembling the resources, ideas, code, people, etc, to tackle wifi's bufferbloat issues in linux has taken a long time.<br>
<p>
but we are making serious progress, now on two chipsets.<br>
<p>
<a href="http://blog.cerowrt.org/post/fq_codel_on_ath10k/">http://blog.cerowrt.org/post/fq_codel_on_ath10k/</a><br>
<p>
<a href="https://blog.tohojo.dk/2016/06/fixing-the-wifi-performance-anomaly-on-ath9k.html">https://blog.tohojo.dk/2016/06/fixing-the-wifi-performanc...</a><br>
<p>
Coming soon to a kernel tree near you, I hope.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/694697/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor694704"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2016 14:57 UTC (Sun)
                               by <b>Lennie</b> (subscriber, #49641)
                              [<a href="/Articles/694704/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You folks are my heroes. Keep up the awesome work !<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/694704/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor694716"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2016 21:32 UTC (Sun)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/694716/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That looks amazing. I recognise that horrible mess of a graph: it's what my home network does as soon as someone else on it starts watching videos or whatever...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/694716/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor692785"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 27, 2016 12:09 UTC (Mon)
                               by <b>smitty_one_each</b> (subscriber, #28989)
                              [<a href="/Articles/692785/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Is TOU to protocols what NoSQL is to relational databases?<br>
There is always some minimal amount of metadata that needs to be managed across the application. Moving that management out of TCP might (or might not) bring joy.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692785/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor692946"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 28, 2016 18:05 UTC (Tue)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/692946/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Replacing TCP with TOU is more akin to replacing a denormalized MySQL 3.x DB with a single-column table full of schemaless JSON blobs, with all the smarts happening in userspace code written this century.<br>
<p>
NoSQL in this analogy would be something along the lines of SCTP+IPv6; that'd be a real improvement (and naturally, still wouldn't make everyone happy), but we don't have the luxury of choosing an appropriate tool for the job.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/692946/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor694788"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Transport-level protocols in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 18, 2016 16:16 UTC (Mon)
                               by <b>Hugne</b> (guest, #82663)
                              [<a href="/Articles/694788/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It is also worth noting that encapsulating a TCP connection in this way separates it from the underlying network, making the endpoints of TCP connections mobile.</font><br>
<p>
TCP doesn't really like when the datapath changes to worse conditions.. New CCA's needed?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/694788/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2016, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
