        <!DOCTYPE html>
        <html lang="en">
        <head><title>Preparing for nonvolatile RAM [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/498283/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/497564/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/498283/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Preparing for nonvolatile RAM</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>We're bad at marketing</b>
<p>
We can admit it, marketing is not our strong suit. Our strength is
writing the kind of articles that developers, administrators, and
free-software supporters depend on to know what is going on in the
Linux world. Please <a href="/Promo/nsn-bad/subscribe">subscribe today</a> to help us keep doing that, and so
we don’t have to get good at marketing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>May 23, 2012</br>
           </div>
Once upon a time, your editor had a job that involved working with a Data
General Nova system.  The Nova had an interesting characteristic: since it
contained true core memory, the contents of that memory would persist
across a reboot—or a power-down.  So the end-of-day shutdown procedure was
a simple matter of turning the machine off; when it was turned on the next
morning, it would simply continue where it was before.  There were no
complaints about system boot time with that machine.  The replacement of
core memory with silicon-based RAM brought a lot of nice advantages, but
the nonvolatile nature was lost on the way.  But it appears that
nonvolatile memory may be about to make a comeback, bringing some
interesting development problems with it.
<p>
Matthew Wilcox <a href="/Articles/498289/">raised the issue</a>, noting
that nonvolatile memory (NVM) is coming, that it promises bandwidth and latency
numbers similar to those offered by dynamic RAM, and that, being cheaper
than DRAM, it is likely to be offered in larger sizes than DRAM is.  He
later <a href="/Articles/498291/">disclaimed any resemblance</a> between
this description and any future products to be offered by his employer; it
is, he says, simply where the industry is going.  Given that, it would be a
good idea for the kernel community to be ready for this technology when it
arrives.
<p>
One part of being ready is figuring out how to deal with nonvolatile
memory within the kernel.  The suggested approach was to use a filesystem:
<p>
<div class="BigQuote">
	We think the appropriate way to present directly addressable NVM to
	in-kernel users is through a filesystem.  Different technologies
	may want to use different filesystems, or maybe some forms of
	directly addressable NVM will want to use the same filesystem as
	each other.
</div>
<p>
A filesystem approach would allow the association of names with regions of
NVM space; an API was then proposed to allow the kernel to perform tasks
like mapping regions of NVM into the kernel's address space.
<p>
One question that came up quickly was: won't the use of the filesystem
model slow things down?  There is a lot of overhead in the block layer,
which was not designed to deal with "storage" that operates at full memory
bandwidth.  Matthew was never thinking of bringing in the full block layer,
though; instead, he <a href="/Articles/498295/">said</a>: "<q>I'm hoping
that filesystem developers will indicate enthusiasm for moving to new
APIs</q>".  Such enthusiasm was in short supply in this discussion; that
is probably more indicative of a lack of thought about the problem than any
sort of active opposition (which was also in short supply).
<p>
James Bottomley, though, <a href="/Articles/498297/">questioned the
filesystem idea</a>, suggesting that NVM should be treated like memory.  He
said that the way to access NVM might be through the kernel's normal memory
APIs, with nonvolatility just being another attribute of interest.  One
could imagine calling <tt>kmalloc()</tt> with a new
<tt>GFP_NONVOLATILE</tt> flag, for example.  The only problem with this approach is that
it is not enough to request an arbitrary nonvolatile region; callers will
usually want a <i>specific</i> NVM region that, presumably, contains data
from a previous use.  So the memory API would have to be extended with some
sort of namespace giving reliable access to persistent data.  To many, that
namespace looks like a filesystem; James suggested using 32-bit keys like
the SYSV shared memory mechanism does, but admirers of SYSV IPC tend to be
scarce indeed on linux-kernel.
<p>
So, while there are a lot of details to be worked out, some sort of
name-based kernel API seems certain to come about.  Then there will be a
mechanism, either through the memory-related or filesystem-related system
calls, to make NVM available to user space.  But that leads to another,
perhaps harder question: what, then, do we do with all that fast,
nonvolatile memory?
<p>
Some of it, certainly, could be used for caching; technologies like <a
href="/Articles/497024/">bcache</a> could make good use of it.  The page
cache could go there; Matthew suggested that the inode cache might be
another possibility.  Both could speed booting considerably, though it
would be necessary to somehow validate the cache contents against
filesystems that could have changed while the system was down.  Boaz
Harrosh <a href="/Articles/498299/">suggested</a> that filesystems could
store their journals in that space, speeding journal access and reducing
journal I/O load on the underlying storage devices.  He also mentioned
checkpointing the system to NVM, allowing for quick recovery should the
system go down unexpectedly.  Vyacheslav Dubeyko had <a
href="/Articles/498300/">some wilder ideas</a> about how NVM could
eliminate system bootstrap entirely and make the concept of filesystems
obsolete; instead, everything would just live in a persistent object
environment. 
<p>
Clearly, many of these ideas are going to take some time to come to
fruition.  Nonvolatile memory changes things in fundamental ways; Linux may
have to scramble to keep up, but, then, that is a high-quality problem to
have.  It will be most interesting to watch how this plays out over the
coming years.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Memory_management-Nonvolatile_memory">Memory management/Nonvolatile memory</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/498283/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor498485"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 2:03 UTC (Thu)
                               by <b>JoeBuck</b> (subscriber, #2330)
                              [<a href="/Articles/498485/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Yes, I remember working with core memory.  It was very convenient.
<p>
Perhaps mmap is the right abstraction: if a file is mmap'ed read-write it is randomly addressable and persistent.  Another alternative, if the NVRAM is as fast as any other RAM, is to ignore the nonvolatile characteristic and use it as ordinary memory.  Or it could be a mixture of both: users can create files in it and what's left is available as memory.

      
          <div class="CommentReplyButton">
            <form action="/Articles/498485/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor498489"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 3:12 UTC (Thu)
                               by <b>pj</b> (subscriber, #4506)
                              [<a href="/Articles/498489/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I've been thinking for awhile that RAM, NVM, flash, and disks are all part of a continuum of storage with various latencies and qualities (persistent, rewritable, clearable) and it would be interesting to try and unite the interfaces to all of them, and perhaps write different 'services' for them.  A persistent-block service would look like a block device.  A non-persistent page-storage service would look like current memory management.  This would, I think, make some of the blurry-edged cases clearer: page files fall out quite easily, and caching at all levels could likely be united - so the page cache is just like the block cache. <br>
<p>
I dunno, just an idea I had awhile back.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498489/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor498631"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 17:41 UTC (Thu)
                               by <b>cesarb</b> (subscriber, #6266)
                              [<a href="/Articles/498631/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This might interest you: <a href="https://en.wikipedia.org/wiki/Single-level_store">https://en.wikipedia.org/wiki/Single-level_store</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498631/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor498562"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">I guess I am a little slow here</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 13:24 UTC (Thu)
                               by <b>felixfix</b> (subscriber, #242)
                              [<a href="/Articles/498562/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I too remember core memory.<br>
<p>
I do not understand the problem as posed here, nor the responses.  Why not just treat it exactly like a regular suspend and wakeup?  The sole difference is that some peripherals may have lost power, including the usually-non-removable disk drives.<br>
<p>
What is the point of trying to make it look like a disk?  It reminds of those fun projects to run Linux on a 6502 emulator running under Windows running under Wine on Linux.  Fun, interesting ... but ultimately silly.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498562/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor498647"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">I guess I am a little slow here</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 18:44 UTC (Thu)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/498647/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's a bit different from usual suspend/resume if you have both DRAM and NVM, and you could have some memory areas lose power and others persist. You're also likely to have some interesting effects with the BIOS going through its boot instead of its resume, and leaving devices configured in an unexpected way.<br>
<p>
I think the point of making it look like a disk is the same as the point of having tmpfs: it's nice to have filesystems (with their actual benefit of namespaces, naming, and authorization properties) with full memory bandwidth.<br>
<p>
It's also possible that it would be beneficial to be able to keep data in NVM usefully while switching to a new kernel, which requires some sort of in-storage data structures which are stable across kernel versions.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498647/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor498658"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">I guess I am a little slow here</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 19:16 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/498658/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
if NVM is as fast as DRAM and higher desnity, why would people still have DRAM in their system?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498658/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor498704"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Uses for NVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 23:42 UTC (Thu)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/498704/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
if NVM is as fast as DRAM and higher density, why would people still have DRAM in their system?
</blockquote>
<p>
Don't forget cheaper.
<p>
I think the real question may be: after you replace all your DRAM with NVM and do the obvious suspend/resume exploitation, what more can you do with all the <em>additional</em> NVM you have in excess of what used to be DRAM.  The article's reference to "available in larger sizes" alludes to this.
<p>
A bigger file cache in the kernel was mentioned.  This would address the problem some systems have today that their file cache size is limited by how long it takes to prime it after each boot.
<p>
The filesystem idea seems to allude to using it for stuff we used to keep on SSDs, but were limited by the cost of dragging it over a SATA wire into a CPU register (stopping off at DRAM along the way).

      
          <div class="CommentReplyButton">
            <form action="/Articles/498704/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor498715"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Uses for NVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 23:57 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/498715/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
when they say "available in larger sizes", what sort of sizes are they talking about?<br>
<p>
if they are talking about sized 2x -4x larger than current DRAM devices, the answer is simple, you will use all that you have as normal RAM and not have 'extra' to find a use for.<br>
<p>
If they are talking 20x+ larger, then it may start replacing flash in systems. but unless they are talking significantly larger than that, they won't start replacing spinning rust<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498715/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499894"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Uses for NVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 2, 2012 9:45 UTC (Sat)
                               by <b>Duncan</b> (guest, #6647)
                              [<a href="/Articles/499894/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This realistic, cautionary note seems IMO to be the best comment so far (in time), both above and below yours.  Let's look at what we have:<br>
<p>
Using pricewatch.com as a guide on going street-price, current near-best prices (note that for most gig quantities, prices are higher, and of course spinning rust comes in far larger gig quantities... I simply quickly scanned and picked what appeared to be the best gigs per $ in each category) :<br>
<p>
DRAM ~ $4/gig ($32ish, 8 gig)<br>
<p>
SSDs ~ $1/gig ($230, 240 gig)<br>
<p>
Flash ~ 50 cents a gig ($16, 32 gig USB stick)<br>
<p>
Spinning rust 3.5 inch ~ 5 cents a gig ($145, 3000 gig)<br>
Spinning rust 2.5 inch ~ 9 cents a gig ($$60, 640 gig)<br>
<p>
<p>
Now it's worth considering just what this NVRAM is being compared against.  It's being compared against $4+/gig DRAM, similar latency, higher density, lower cost, except that it happens to be non-volatile.  <br>
<p>
It's *NOT* being compared against the next step down in both price and latency, SSDs, except lower latency, higher bandwidth, tho its non-volatile nature might make that a more logical direct comparison.<br>
<p>
That certainly says a great deal about at least the intended price point.  They'd rather be compared against $4/gig DRAM than against $1/gig SSDs.<br>
<p>
<p>
OK, that sets some pretty close bounds on the practical price-point, well under an order of magnitude.  We're looking at, probably, $2-3/gig at today's capacity/price points, tho of course all three technologies (SSD, NVRAM, DRAM) can be predicted to be somewhat below that by the time it comes out in reasonable quantities and target sub-dram prices (the time frame wasn't mentioned, but maybe a couple years?)<br>
<p>
You've made a very practical point that at the target sub-dram price-point (tho you said size/capacity, but price per capacity is I believe the controlling factor, or we'd all be using battery-backed DRAM storage for our tibibytes of videos!), perhaps half that of dram, in practice we're simply talking a cheaper dram replacement that has one very different property than current dram -- non-volatility.<br>
<p>
That means it's *NOT* going to be the end of the world as we know it.  We're simply looking at, for the most part, a cheaper dram with one rather interesting quality compared to current dram.  We're NOT, at least near term, going to be replacing spinning rust, for sure.<br>
<p>
While it's likely to replace current tech SSDs at the high end, that's likely to simply push them down-market a bit, much as SSDs forced spinning rust down-market quite a bit.  Current tech SSDs will in turn drop back toward on par with flash, where it seems they settled for quite awhile, altho they're double flash's price ATM.  That will hopefully in turn push flash prices down... so were this NVRAM available at the target price-points today, we might see something like this instead of the above.<br>
<p>
DRAM, $3/gig<br>
<p>
NVRAM, $2/gig,<br>
<p>
SSD, 80 cents/gig<br>
<p>
Flash, 40 cents/gig<br>
<p>
Spinning rust, 4 cents/gig 3.5, 8 cents/gig 2.5<br>
<p>
<p>
Or for a time NVRAM might floor the dram market, to say $2/gig (relative), with NVRAM at $1.50/gig, then actually increase the price of dram as it gets eclipsed and drops from competitive so that prices for dram don't fall in line with the rest of the market, thus going up relative to it, such that people might end up with half-gig dram machines again, the rest nvram, and dram costing (relative, the whole market would of course be cheaper by then) say $6-8/gig low end as a result.  (The dynamic would thus be much like that for eclipsed memory technologies like DDR-1 and PC100/133, today.  You can compare their prices per gig on pricewatch, or your favorite alternative, if you like.  I just took a WAG above, but just checked and $6-8/gig for DDR is pretty close, actually, PC100/133 about double that!  Prices for eclipsed tech do drop, but not by nearly as much, relative to current tech.)<br>
<p>
The big point of course being that all this talk about killing filesystems or even SSDs and spinning rust... is VERY premature, to say the least!  Otherwise, the comparison would as I said, be to SSDs, but lower latency and higher bandwidth, not to dram, but non-volatile.<br>
<p>
Of course predicting ten years out is a tough business.  By then, this could well either look like a flash in the pan or could have taken over the whole market.  But more likely, it'll be simply incremental, spinning rust will still be around for our then approaching petabyte needs and nvram may or may not have replaced dram and/or ssds but may, if it survives, be used like one or the other, or both, and the world will go on much like it does today, but different, just as today is much like 2002, but different.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499894/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499948"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Uses for NVM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 2, 2012 20:43 UTC (Sat)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/499948/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
if NVRAM is bigger, cheaper, and faster than DRAM (or worst case, equivalent in any or all of these categories), why would anyone still use DRAM?<br>
<p>
This is similar to the way that flash has essentially eliminated both ROM and EEPROM from the market.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499948/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor498717"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">I guess I am a little slow here</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 25, 2012 0:41 UTC (Fri)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/498717/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
He actually said "similar latency and throughput"; the difference could be enough that we'll see systems with some of each.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498717/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor498712"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">I guess I am a little slow here</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 23:49 UTC (Thu)
                               by <b>felixfix</b> (subscriber, #242)
                              [<a href="/Articles/498712/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why would the BIOS not know it has NVRAM?<br>
<p>
Some things simply are not upgradeable.  If you have an old computer with DRAM, you almost certainly won't be able to replace the DRAM with NVRAM.<br>
<p>
And if the NVRAM computer comes with a BIOS that thinks it needs to set up refresh cycles and such, it is much too broken to buy, and anyone who does gets what they deserve.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498712/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor498721"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">I guess I am a little slow here</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 25, 2012 1:06 UTC (Fri)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/498721/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
When the power comes up and the machine has NVM, the BIOS doesn't necessarily know whether the NVM actually contains anything useful (or salvageable-- the processors may have lost power without suspending cleanly, which the OS may or may not be clever enough to sort out). And you might be trying to boot an old OS or be switching OSes entirely. So I expect that what will happen is that the BIOS will pass control to the bootloader on powerup (having clobbered the first 640k of RAM, most likely), and the bootloader has to recognize that we have a kernel in NVM already and return to its recovery point instead of loading a kernel off of the boot medium.<br>
<p>
Of course, you could also just say, "unexpected power failures are still fatal; the only benefit of NVM is that you can remove all power while cleanup suspended." I'd expect that to be the behavior if the OS doesn't know about NVM, but I think being able to recover from unexpected power failures is more interesting.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498721/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor498637"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Paging AS/400 veterans</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 18:24 UTC (Thu)
                               by <b>ncm</b> (guest, #165)
                              [<a href="/Articles/498637/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
We should be able to learn something from the experience of those who have worked with/on IBM's AS/400 and its OS, nowadays called "IBM i".  As I recall, in its original release it didn't have a file system. Instead, every call to malloc(), over the life of the machine, would return a different (128-bit) numeric value.  Anything put there would be accessible indefinitely, across reboots and substitution of underlying hardware. Replace the 32-bit CPU with a quad 64-bit, and your programs don't notice.  As far as programs running on it were concerned, it never shut down; restore power and whatever was running picks up where it left off.<br>
<p>
In place of a file system, programs exchange pointer values.  You can construct a name mapping if you want, or several (and they did), but the OS doesn't insist on it.  In effect, every file is memory-mapped, and its inode number is also a pointer to it; alternatively, every allocated memory block is also a file, and its name is also a pointer to it.  <br>
<p>
AS/400 sneers at your uptime statistics.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498637/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor498656"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Data General core machines</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 19:11 UTC (Thu)
                               by <b>maney</b> (subscriber, #12630)
                              [<a href="/Articles/498656/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I worked on mostly Eclipse machines one summer years back.  There was one annoying problem with that scheme: the machine's main power switch had three positions, off, on, and locked IIRC, the last being the save to and restore from core.  The problem was that this meant that both AC line and a logic signal that ran more or less directly into the middle of one of the two 15" square boards that implemented the CPU were on contacts only a fraction of an inch apart.  And every now and then one of those switches would fail in the worst possible way...<br>
<p>
It was interesting trying to fix that CPU board set - microcoded diagnostics kept leading us to change more chips (this was gate level TTL, the microcode ROM &amp; RAM and the ALU slices were about the most complex chips), and it always seemed we were making progress.  Then they wondered why this one job was taking so long, which is when they told us about this interesting failure mode, and the board set was sent to the scrap heap.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498656/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor498682"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 20:48 UTC (Thu)
                               by <b>daglwn</b> (guest, #65432)
                              [<a href="/Articles/498682/">Link</a>] (25 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think Vyacheslav Dubeyko is on the right track.  If NVRAM is as fast as DRAM and cheaper, there will be really no reason to have DRAM at all.  At that point, you don't need filesystems anymore.<br>
<p>
In fact we don't really need filesystems today.  We could simply use the paging system to write out the contents of memory to persistent storage on a shutdown and load them back up on a restart, not unlike suspend/resume.  Pointers become the names of objects.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498682/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor498701"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 23:26 UTC (Thu)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/498701/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
... and with pointers being used instead of pathnames, we are suddenly in a situation when what used to be text (you know, C source, makefiles, etc.) contains pointers.  Oh, the rapture...  Pardon me, but I'm unimpressed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498701/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor498709"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 23:40 UTC (Thu)
                               by <b>daglwn</b> (guest, #65432)
                              [<a href="/Articles/498709/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Oh come on.  One can certainly have mappings between user-readable handles and objects.<br>
<p>
The point is that we have an entire OS subsystem that probably isn't needed at all for a lot of use cases.  Who wouldn't want to get rid of that complexity.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498709/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor498734"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 25, 2012 3:48 UTC (Fri)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/498734/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
... and that's what filesystem _is_.  No more, no less.  It's a mechanism mapping pathnames to objects.  Look at Multics, for fsck sake - everything is mmappable segment (and the entire address space of process consists of those; 36bit address split into 18bit segment and 18bit offset, with per-segment page tables and segments sharable between the processes), regular files are segments (with on-disk bits used as persistent storage), directories are *also* segments containing essentially pairs (name, segment reference).  Said references may refer to regular files or to directories, giving you hierarchical namespace in usual way.  All file IO done via mmap + direct memory access.<br>
<p>
What do you think 'ls' stands for?  That's right, "list segments".  In a directory segment, that is.  As for the supposed complexity...  Take a look at the amount of code in fs/ramfs someday.  Especially if you leave no-MMU side of things alone...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498734/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499179"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 29, 2012 20:40 UTC (Tue)
                               by <b>daglwn</b> (guest, #65432)
                              [<a href="/Articles/499179/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Come on Al, you're being deliberately dense.  All that filesystem code ALSO optimizes access for rotating storage, does buffering, etc.  Why the heck do we need a file cache at all if we don't have a slow disk?<br>
<p>
There is a lot of complex code that could be dumped if everything lived in a random-access memory.  Device drivers alone would be a huge savings.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499179/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499183"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 29, 2012 21:33 UTC (Tue)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/499183/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm curious, where in the VFS is the complex code for optimising rotating storage, buffering, etc? Or where/how does the API for the VFS require fs implementations to do that kind of thing?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499183/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499198"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2012 1:36 UTC (Wed)
                               by <b>daglwn</b> (guest, #65432)
                              [<a href="/Articles/499198/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you don't have a filesystem model you don't have a VFS and you don't have filesystems.  I'm really quite surprised at the pushback here.  It's an idea.  Don't get bent out of shape.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499198/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499209"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2012 4:43 UTC (Wed)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/499209/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There are a lot of people who have advocated eliminating filesystems.<br>
<p>
However, they have always run into the stumbling block that it's just impractical to deal with all hunks of data in a flat namespace. Directories are EVIL, but nobody has make anything else work even one tenth as well<br>
<p>
Also, just keeping everything in ram falls apart as soon as you want someone else to access it (or you loose the device, or the device gets destroyed, or ...)<br>
<p>
Many of the people pushing back have been though this "eliminate filesystems" experiment before and have the scars to show for it. Listen and learn (then go try and build something to prove them wrong :-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499209/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499393"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2012 19:35 UTC (Thu)
                               by <b>timka.org</b> (guest, #53366)
                              [<a href="/Articles/499393/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Dmitry Zavalishin, the author of <a rel="nofollow" href="http://code.google.com/p/phantomuserland/">Phantom OS</a> (which "eliminates filesystems"), was asked the question about removable storage when he was giving a talk about the OS at HighLoad++ in 2009.
<br/><br/>
His idea is to start a separate Phantom VM for a removable media which then can be seen as another "host" accessible via "network". AFAIU, this means Phantom's native IPC is substituted by some protocol. Smells somewhat like Plan 9 to me.
      
          <div class="CommentReplyButton">
            <form action="/Articles/499393/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor499210"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2012 4:52 UTC (Wed)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/499210/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But you said you would still have a layer to provide user-friendly namespace, and a translation between that and the actual memory handles. You seem to think the current VFS is far more than that, that the current VFS does things like block-IO buffering and has other arcane IO related knowledge. So where does the VFS have anything like that?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499210/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499249"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2012 14:54 UTC (Wed)
                               by <b>daglwn</b> (guest, #65432)
                              [<a href="/Articles/499249/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The VFS doesn't.  The fs layers and drivers do.<br>
<p>
I think the discussion is pretty pointless now...<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499249/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor499195"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2012 0:11 UTC (Wed)
                               by <b>Trelane</b> (subscriber, #56877)
                              [<a href="/Articles/499195/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Why the heck do we need a file cache at all if we don't have a slow disk?</font><br>
<p>
Because not all memory is the same, let alone the pipe over which we get it.<br>
<p>
How would you use a hypothetical storage medium that had 1EB of storage but you could only access it at 128kbps?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499195/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499199"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2012 1:37 UTC (Wed)
                               by <b>daglwn</b> (guest, #65432)
                              [<a href="/Articles/499199/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Probably the same way we handle networks today.<br>
<p>
The filesystem is the abstraction and that abstraction has certain costs.  Changing the abstraction doesn't imply we immediately forget everything we know.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499199/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor499214"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2012 6:53 UTC (Wed)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/499214/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
RTFS.  I've even told you which source to read.<br>
<p>
One more time, slowly:<br>
<p>
* fs/ramfs/inode.c does *not* optimise for rotating storage, what with having nothing whatsoever to do with any storage.<br>
<p>
* it does *not* optimise for disc buffering, what with having no backing storage, disc or otherwise<br>
<p>
* file cache (page cache, really) is just a mechanism for finding a page by offset in file.  In case of object living entirely in RAM, that's exactly what you need to work with that object.  Unless you want your objects to be contiguous in RAM, that is - great idea, that, for e.g. 800Kb text file.  Or a 22Mb PDF document.<br>
<p>
* Device drivers have nothing whatsoever to do with aforementioned ramfs.<br>
<p>
* You have demonstrated just what is wrong with "visionaries".  You keep making profound sounds without stopping to check whether they have anything to do with reality.  Other than that of your bowel movements, that is.<br>
<p>
As for being deliberately dense...  I wouldn't have dared - any attempt to fake being dense would be simply pathetic next to the geniune article of that magnitude.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499214/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499250"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2012 14:55 UTC (Wed)
                               by <b>daglwn</b> (guest, #65432)
                              [<a href="/Articles/499250/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks, Al.  Real classy.  It truly makes me want to learn more.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499250/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499315"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2012 21:25 UTC (Wed)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/499315/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, you should.<br>
<p>
Don't know about you, but after Al Viro's post I went and checked VFS source code - and he's entirely correct.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499315/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499327"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2012 21:59 UTC (Wed)
                               by <b>daglwn</b> (guest, #65432)
                              [<a href="/Articles/499327/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm sure he is correct.  But he doesn't have to be an ass about it.  He started right off with unwarranted sarcasm, graduated to foul language and it went downhill from there, leading to personal attacks.<br>
<p>
I never claimed to be a "visionary."  I'm far, far from that.  The idea isn't even original, people have talked about it for years.  It just strikes me that it makes a lot of sense given system architecture trends.  Outright dismissal accompanied by foul language, holier-than-thou attitudes and outright insults says much more about Al than it does me.<br>
<p>
Al definitely lost a notch or too on my respect ladder and that's a pity because I've generally enjoyed reading his posts/articles.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499327/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499352"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2012 1:29 UTC (Thu)
                               by <b>bronson</b> (subscriber, #4806)
                              [<a href="/Articles/499352/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I suppose the sarcasm is warranted if it's an idea that's proposed by many well-intentioned but ill-informed people. It attempts to keep the conversation short or, failing that, provide car-crash style entertainment. "Bring facts or suffer ridicule."  <br>
<p>
I'm no linguist but anybody who disagrees is a dweeb.  :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499352/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor498724"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 25, 2012 1:18 UTC (Fri)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/498724/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You'll notice that we have at least three filesystems (tmpfs, procfs, and sysfs) which don't use anything other than RAM. You'll also notice that programs make extensive use of filesystems for the well-specified inter-process semantics around the common case where the computer doesn't lose power and RAM keeps working.<br>
<p>
Oh, and we use filesystems for disks, which NVM doesn't replace, not for DRAM, which NVM does replace. It would make more sense to say that now we can now have *only* filesystems, not anonymous memory. But that's also dumb.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498724/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor498727"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 25, 2012 1:53 UTC (Fri)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/498727/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thank you for saying that, it saved me the trouble. (aka "+1").<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498727/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor498733"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 25, 2012 3:03 UTC (Fri)
                               by <b>daglwn</b> (guest, #65432)
                              [<a href="/Articles/498733/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And this is all because we think the filesystem abstraction is the only way to go.  NVRAM certainly could replace disks on some devices and really, what's the difference between storing data on disk in a filesystem and storing on disk in the form of pages?<br>
<p>
There are many other, better ways to do IPC.<br>
<p>
I don't think a filesystem-less Linux would work that well - the concept is too ingrained into the kernel.  But starting from scratch?  I would seriously consider not providing a filesystem at all.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498733/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor498738"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 25, 2012 5:10 UTC (Fri)
                               by <b>mrons</b> (subscriber, #1751)
                              [<a href="/Articles/498738/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There have been operating systems that have removed the filesystem abstraction. I recall reading about the Monads system in the 80's:<br>
<p>
<a href="http://www.jlkeedy.net/research-highlights.html">http://www.jlkeedy.net/research-highlights.html</a><br>
<p>
Don't know how far they got with an actual implementation though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498738/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499545"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2012 19:56 UTC (Thu)
                               by <b>timka.org</b> (guest, #53366)
                              [<a href="/Articles/499545/">Link</a>] 
      </p>
      
      </div>
      </summary>
      There's also <a rel="nofollow" href="http://code.google.com/p/phantomuserland/w/list">Phantom OS</a>. Never tried it myself but it's still active and looks interesting.
      
          <div class="CommentReplyButton">
            <form action="/Articles/499545/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor498767"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 25, 2012 8:52 UTC (Fri)
                               by <b>dgm</b> (subscriber, #49227)
                              [<a href="/Articles/498767/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It would not work. There are two use cases that the pointer/page combination doesn't cover, namely: removable storage and named data. Both are very important, so a system that doesn't support them will not be very useful.<br>
<p>
And as Viro said above, the moment you add a name-&gt;page mapping... voilà! the filesystem is back.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498767/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499180"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 29, 2012 20:45 UTC (Tue)
                               by <b>daglwn</b> (guest, #65432)
                              [<a href="/Articles/499180/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I guess I'm not following what's so special about "named data."  Ultimately it's a mapping from a user-readable handle to a machine-readable handle.  And no, such a mapping does not have to look like a filesystem at all.  We don't necessarily even want a concept of directories as such, for example.<br>
<p>
I'll grant that removable media presents a challenge.  But with The Cloud(TM) these days, do we even need it?  I'm talking about certain common use cases.  Certainly we need it for lots of things but I don't think everyone in the world needs it.<br>
<p>
Even so, I wonder if page migration could be adapted to support removable storage.  Page out on one system, page back in on another.<br>
<p>
Just thinking blue sky here, I'm not an expert on any of this.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499180/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor499603"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 1, 2012 1:07 UTC (Fri)
                               by <b>kevinm</b> (guest, #69913)
                              [<a href="/Articles/499603/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What people are trying unsuccessfully to point out is that *all* the "filesystem abstraction" is is a mapping from a hierarchical name and offset into a memory address.  That's all it is.<br>
<p>
About that only thing you can change that about that and still have a mapping from names to memory is to change what the names look like.  Maybe you don't want them to be hierarchical - maybe you want them to be flat, or multidimensional instead of single-dimensional.  But there doesn't seem to be a good reason why changing how the names look is in any way related to NVM.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/499603/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor498694"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 24, 2012 21:54 UTC (Thu)
                               by <b>tbird20d</b> (subscriber, #1901)
                              [<a href="/Articles/498694/">Link</a>] 
      </p>
      
      </div>
      </summary>
      No one has brought up <a href="http://pramfs.sourceforge.net/">PRAMFS</a>, which seems like a natural fit for this.
      
          <div class="CommentReplyButton">
            <form action="/Articles/498694/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor498794"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Preparing for nonvolatile RAM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 25, 2012 10:51 UTC (Fri)
                               by <b>drag</b> (guest, #31333)
                              [<a href="/Articles/498794/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I vote for using something like tmpfs, but with the ability to execute in place. Like what is used in some embedded systems. <br>
<p>
<a href="http://en.wikipedia.org/wiki/Execute_in_place">http://en.wikipedia.org/wiki/Execute_in_place</a><br>
<p>
Fragmentation would be a serious problem so it would be necessary to revist and improve the anti-defrag memory patches and such that I've seen discussed here in the past. <br>
<p>
Like: <br>
<a href="http://lwn.net/Articles/211505/">http://lwn.net/Articles/211505/</a><br>
<p>
As far as booting and dealing with BIOS...<br>
<p>
Have the bootloader bootstrap the system just enough to just start executing whatever is at 0x0 on the NVRAM. Then leave it up the kernel to notice that the system just was booted and undo whatever brain dead state the UEFI or BIOS or whatever just put the system into.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/498794/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2012, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
