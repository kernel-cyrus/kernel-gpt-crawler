        <!DOCTYPE html>
        <html lang="en">
        <head><title>Introducing lazytime [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/621046/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/620192/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/621046/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Introducing lazytime</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>This article brought to you by LWN subscribers</b>
<p>
Subscribers to LWN.net made this article &mdash; and everything that
       surrounds it &mdash; possible.  If you appreciate our content, please
       <a href="/Promo/nst-nag3/subscribe">buy a subscription</a> and make the next
       set of articles possible.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>November 19, 2014</br>
           </div>
POSIX-compliant filesystems maintain three timestamps for every file,
corresponding to the times of the last change in the file's metadata or contents (known
as its "ctime"), modification of the file's contents ("mtime"), and access of the
file ("atime").  The first two timestamps are generally considered to be
useful, but "atime" has long been seen as being too expensive for the
benefits it provides.  In current
systems, there is a mount option (called "relatime") that mitigates the
worst problems caused by atime, but it has a few issues of its own.  Now a
new "lazytime" option might replace relatime and provide the best of all
worlds.
<p>
The problem with atime is that it is supposed to be updated every
time the associated file is accessed.  Updating atime requires writing the
file's inode back to disk, so atime tracking essentially turns every read
operation into a write.  For many workloads, the effect on performance can
be severe.  On top of that, there are few programs out there that make use
of atime or depend on it being updated.  So, ten years ago, it was common
to mount filesystems with the "noatime" option, which disabled the tracking
of access times entirely.
<p>
The problem, of course, is that "few programs" is not the same as "no
programs"; it turns out that there are indeed utilities that break in the absence of
atime tracking.  A classic example is mail clients that use atime to
determine whether a mailbox has been read since mail was last delivered to
it.  After some discussion, the kernel community added the "relatime" mount
option in the 2.6.20 development cycle.  Relatime will cause most atime
updates to be suppressed, but it will allow an atime update if the current
recorded 
atime is prior to the current ctime or mtime.  Later on, relatime was tweaked
to update atime once every 24 hours regardless (but only if the file is
accessed, of course).
<p>
Relatime works well enough for most systems, but there are still those who
would like better atime tracking without paying the performance penalty for
it.  Some users also dislike the fact that relatime, for all its value,
causes the system to not be fully compliant with the POSIX specification.
For the most part, people have put up with the minimal deficiencies in
relatime (or put up with the cost of atime updates), but there is now an
alternative on the horizon.
<p>
That alternative takes the form of the <a href="/Articles/620086/">lazytime
mount option</a>, posted as an ext4-specific patch by Ted Ts'o.  With
lazytime enabled, a filesystem will keep atime current in a file's
in-memory inode.  But that inode will not be written to disk until there is
some other reason to do so, or until the inode itself is being pushed out
of memory.  The effect will to have an atime that is always correct from
the point of view of any program running on the system.  The version of
atime stored on disk may well lag significantly behind reality, though, and
the current atime could be lost if the system were to crash.
<p>
Dave Chinner was quick to <a href="/Articles/621067/">point out</a> that,
while the option looked like it could be useful, the ext4 filesystem might
not be the best place to implement it.  If lazytime were to be implemented
in the virtual filesystem (VFS) layer, then it would be available for all
filesystems, not just ext4 and, perhaps most importantly, it would work the
same way on all of them.  Ted <a href="/Articles/621068/">agreed</a> that a
VFS implementation might make sense; the next version of this patch seems
almost certain to be implemented at that level.
<p>
Dave also <a href="/Articles/621071/">suggested</a> that delaying the
writing of atime updates indefinitely might not be advisable:
<p>
<div class="BigQuote">
	However, we'd be fools to ignore the development of relatime, which
	in it's original form never updated the atime until m/ctime
	updated.  3 years after it was introduced, relatime was changed to
	limit the update delay to 24 hours (before it was made the default)
	so that applications that required regular updates to timestamps
	didn't silently stop working.
</div>
<p>
Once again, Ted was amenable to this idea, so the next version will
probably write out 
updated atime values a minimum of once every 24 hours.  Without that
change, atime updates could be held in
memory for months at a time on a system like a database server (which
keeps its files open indefinitely).
<p>
Finally, there is the question of whether lazytime should become the
default mount option.  It satisfies POSIX (or, at least, will after another
fix or two) without incurring the cost of normal atime updates, so it does
seem like a better option than relatime, which is the current default.
Ted, seemingly, would like to change the default in the near future, while
Dave is a bit more concerned about regressions and would like to wait a
couple of years to see how things work out.  That led to a question of
whether the feature will see enough testing in the meantime, but, as Dave
noted, there will probably be enough interest in the feature to ensure that
people will try it out.
<p>
Whether that is true remains to be seen; relatime works well enough for
most users, so there isn't necessarily a crowd of people looking to try a
new filesystem mount option.  But eventually some of the more adventurous
distributions are likely to pick it up; at that point, any latent problems
should probably come out before too long.  So, when lazytime becomes the
default in 2016 or so, it should indeed be well tested and shown to work
without problems.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems-Access-time_tracking">Filesystems/Access-time tracking</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/621046/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor622173"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2014 3:09 UTC (Thu)
                               by <b>kokada</b> (subscriber, #92849)
                              [<a href="/Articles/622173/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For coincidence, yesterday I was reading the article about the relatime option here in LWN (<a href="https://lwn.net/Articles/244829/">https://lwn.net/Articles/244829/</a>). Someone suggested something similar in the comments (<a href="https://lwn.net/Articles/244879/">https://lwn.net/Articles/244879/</a>) and another person commented that Solaris already did something similar (<a href="https://lwn.net/Articles/244915/">https://lwn.net/Articles/244915/</a>).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/622173/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor624460"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 4, 2014 10:02 UTC (Thu)
                               by <b>chojrak11</b> (guest, #52056)
                              [<a href="/Articles/624460/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
NTFS has that for years. And more; for example during the course of file writing, file metadata is not updated on the disk, only on close or when another process specifically requests it using an equivalent of stat/fstat(2).<br>
<p>
Glad to hear that Linux is finally starting to use these critical performance-increasing tricks.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/624460/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor622184"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Mtime, too?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2014 5:09 UTC (Thu)
                               by <b>ncm</b> (guest, #165)
                              [<a href="/Articles/622184/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Most people are shocked to find that mtime is not updated when you write to a file, but only after you close the file descriptor.  If you mmap the file and close the file descriptor, subsequent modifications also do not affect mtime.  If you crash before you close the file, mtime will not have been updated, even if the write finished a week before the crash.<br>
<p>
It seems as if a similar treatment of mtime could be a big improvement.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/622184/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor622194"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Mtime, too?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2014 6:09 UTC (Thu)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/622194/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Most people are shocked to find that mtime is not updated when you write to a file</font><br>
<p>
Isn't it?<br>
My reading of the code suggests that mtime is updated by calls to file_update_time(), and that ultimately calls mark_inode_dirty_sync() which should cause the on-disk version to be updated fairly promptly.<br>
<p>
file_update_time() is called when writing to a file (__generic_file_write_iter) or when making a mmapping writeable  (filemap_page_mkwrite).<br>
<p>
So while I haven't tested, it looks to me like the mtime is updated at the correct time and is written to storage promptly (not instantly - maybe 30second delay).<br>
<p>
What is your evidence?<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/622194/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor622234"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Mtime, too?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2014 10:07 UTC (Thu)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/622234/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
While a 30 second (or 24 hour) delay may be acceptable for the infrequently-used atime field, failure to update mtime promptly could result in data loss (if there is a crash in the meantime).  'make' wouldn't build the right result, and so on.<br>
<p>
One answer might be to add an 'mtime needs updating' flag to the inode.  When a file is opened for write access (or left mmapped, even if the file descriptor is closed) then this 'needs updating' flag is set and written to disk immediately.  If there is a crash, then on recovery the mtime on all such inodes is set to the current time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/622234/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor622341"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Mtime, too?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2014 16:37 UTC (Thu)
                               by <b>SEJeff</b> (guest, #51588)
                              [<a href="/Articles/622341/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Looks like the parent is correct. I didn't believe this either, but it only takes ~30 seconds to test. I touched a file, used stat -c %Y to see the mtime, opened it in write mode via the python shell, wrote to it ^Z, ran stat, etc, etc.<br>
<p>
$ uname -r<br>
3.8.5-201.fc18.x86_64<br>
$ touch foobar<br>
$ stat -c %Y foobar<br>
1416501313<br>
$ python<br>
Python 2.7.3 (default, Aug  9 2012, 17:23:57) <br>
[GCC 4.7.1 20120720 (Red Hat 4.7.1-5)] on linux2<br>
Type "help", "copyright", "credits" or "license" for more information.<br>
<p>
<font class="QuotedText">&gt;&gt;&gt; FH = open('foobar', 'w')</font><br>
<font class="QuotedText">&gt;&gt;&gt; </font><br>
[1]+  Stopped                 python<br>
$ stat -c %Y foobar<br>
1416501321<br>
$ fg<br>
python<br>
    <br>
<p>
<font class="QuotedText">&gt;&gt;&gt; FH.write('test\n')</font><br>
<font class="QuotedText">&gt;&gt;&gt; </font><br>
[1]+  Stopped                 python<br>
$ stat -c %Y foobar<br>
1416501321<br>
$ fg<br>
python<br>
<p>
<p>
<font class="QuotedText">&gt;&gt;&gt; FH.write('test\n')</font><br>
<font class="QuotedText">&gt;&gt;&gt; </font><br>
[1]+  Stopped                 python<br>
$ stat -c %Y foobar<br>
1416501321<br>
$ fg<br>
python<br>
<p>
<p>
<font class="QuotedText">&gt;&gt;&gt; FH.close()</font><br>
<font class="QuotedText">&gt;&gt;&gt; </font><br>
$ stat -c %Y foobar<br>
1416501347<br>
<p>
<p>
Looks like the evidence points that indeed this is the case. Oh and if you're curious, this is on my Fedora 18 workstation (I'm too lazy to update) with a 3.8.5 kernel.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/622341/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor622352"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Mtime, too?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2014 16:58 UTC (Thu)
                               by <b>mthambi</b> (guest, #51395)
                              [<a href="/Articles/622352/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
FH.flush() is needed to make python do the system call.<br>
<p>
After that mtime gets updated immediately. I am not sure whether it is actually written to disk.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/622352/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor622396"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Mtime, too?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2014 20:59 UTC (Thu)
                               by <b>jefftaylor</b> (guest, #95911)
                              [<a href="/Articles/622396/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Alternatively, using the `os` (os.{open|write|close}) module gives direct access to the low level file access primitives.  Particularly important when mucking around with HW drivers; the builtin `write` buffers into 4096B chunks which might wreak havoc if your goal is to send data over a wire.<br>
<p>
Using the `os` module gives the expected behaviour (linux 3.17.2, F20)<br>
<p>
$ uname -r<br>
3.17.2-200.fc20.x86_64<br>
$ touch test<br>
$ stat -c %Y test<br>
1416516686<br>
$ python3<br>
Python 3.3.2 (default, Nov  3 2014, 15:32:43) <br>
[GCC 4.8.3 20140911 (Red Hat 4.8.3-7)] on linux<br>
Type "help", "copyright", "credits" or "license" for more information.<br>
<font class="QuotedText">&gt;&gt;&gt; import os</font><br>
<font class="QuotedText">&gt;&gt;&gt; fd = os.open("test", os.O_WRONLY)</font><br>
[2]+  Stopped                 python3<br>
$ stat -c %Y test<br>
1416516686 # Unchanged by os.open<br>
$ fg<br>
python3<br>
<font class="QuotedText">&gt;&gt;&gt; os.write(3, b"test\n")</font><br>
5<br>
[2]+  Stopped                 python3<br>
$ stat -c %Y test<br>
1416516760 # Changed by os.write<br>
$ fg<br>
python3<br>
<font class="QuotedText">&gt;&gt;&gt; os.write(3, b"test2\n")</font><br>
6<br>
[2]+  Stopped                 python3<br>
$ stat -c %Y test<br>
1416516780 # Changed by os.write<br>
$ fg<br>
python3<br>
<font class="QuotedText">&gt;&gt;&gt; os.close(3)</font><br>
[2]+  Stopped                 python3<br>
$ stat -c %Y test<br>
1416516780 # Unchanged by os.close<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/622396/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor622470"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Mtime, too?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 21, 2014 4:06 UTC (Fri)
                               by <b>zev</b> (subscriber, #88455)
                              [<a href="/Articles/622470/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Or just use the shell...<br>
<p>
$ exec 3&gt;foo<br>
$ stat -c%Y foo<br>
1416542579<br>
$ echo bar &gt;&amp;3<br>
$ stat -c%Y foo<br>
1416542590<br>
<p>
# note that subsequently closing does *not* update mtime<br>
$ sleep 5<br>
$ exec 3&gt;&amp;-<br>
$ stat -c%Y foo<br>
1416542590<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/622470/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor624222"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Mtime, too?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 3, 2014 10:06 UTC (Wed)
                               by <b>k8to</b> (guest, #15413)
                              [<a href="/Articles/624222/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
On unix, with native filesystems, mtime is updated for every write.<br>
<p>
I don't know when the inode is updated on disk.<br>
<p>
For more odd ducks like NFS and CIFS, the mtime information viewed by different parties can vary, unfortunately.  On modern Windows, the strongly equivalent modification time is only updated on file close, which is almost irrelevant except when writing portable code or when mounting those filesystems on unix.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/624222/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor622424"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Mtime, too?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2014 22:50 UTC (Thu)
                               by <b>reubenhwk</b> (guest, #75803)
                              [<a href="/Articles/622424/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <pre>
/* I also had to test this to see for myself.  My C code
 * shows mtime *is* updated as expected...
 */


#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;unistd.h&gt;

int main()
{
	struct stat buf;

	FILE * fp = fopen("hello.txt", "w");
	fprintf(fp, "Hello World!\n");
	fflush(fp);
	stat("hello.txt", &amp;buf);
	printf("mtime: %d\n", (int)buf.st_mtime);

	sleep(2);

	fp = fopen("hello.txt", "a");
	fprintf(fp, "Hello World!\n");
	fflush(fp);

	stat("hello.txt", &amp;buf);
	printf("mtime: %d\n", (int)buf.st_mtime);
	return 0;		
}
</pre>
      
          <div class="CommentReplyButton">
            <form action="/Articles/622424/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor622478"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 21, 2014 4:52 UTC (Fri)
                               by <b>steveriley</b> (guest, #83540)
                              [<a href="/Articles/622478/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The article states:<br>
<p>
"In current systems, there is a mount option (called "relatime") that mitigates the worst problems caused by atime, but it has a few issues of its own."<br>
<p>
What are the "few issues" that relatime has?<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/622478/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor622513"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 21, 2014 11:15 UTC (Fri)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/622513/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you rely on atime's official semantics you will be disappointed by relatime which of course does not provide them.<br>
<p>
For example, perhaps you intend to preserve files in a cache directory so long as they've been accessed at least once per hour. You have a flush process which checks once per hour, and any files that are more than an hour old and have an atime more than an hour old are deleted. With relatime this feature won't work out of the box. You have to configure relatime to ensure atime is no worse than an hour (the default is a day) wrong.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/622513/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor623016"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 25, 2014 12:42 UTC (Tue)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/623016/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's not correct to say that this is just a atime-related change. It affects mtime too: if a file is written to without modifying its inode (say, it's preallocated or you're modifying the middle of it for some reason) *mtime* updates will be put off just like the atime ones.<br>
<p>
This is a fairly significant change in semantics, I'd say.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/623016/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor623032"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 25, 2014 14:51 UTC (Tue)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/623032/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Any reason mtime wouldn't trigger under the "some other reason" condition here?<br>
<p>
<font class="QuotedText">&gt; But that inode will not be written to disk until there is some other reason to do so, or until the inode itself is being pushed out of memory.</font><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/623032/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor623109"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 25, 2014 18:53 UTC (Tue)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/623109/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's also worth pointing out the difference between the inode being modified in RAM and the inode being pushed out to disk.<br>
<p>
Unless the system crashes, your software isn't going to see any difference, any filesystem actions you take will see the modified inode.<br>
<p>
This change is just affecting when the changes hit disk.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/623109/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor623144"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 25, 2014 22:43 UTC (Tue)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/623144/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Because writing to the middle of a non-sparse file won't change any part of the inode other than the mtime -- so the inode wouldn't get written out under those conditions.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/623144/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor623155"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 26, 2014 4:31 UTC (Wed)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/623155/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
To restate: why would it be invalid for the mtime to not be a trigger to write the inode out to disk? (Maybe I'm missing some key data point here, but in don't think your question shed any new light for me.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/623155/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor623286"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 27, 2014 17:34 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/623286/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
My understanding is that after this patch, changes to the inode times (atime, mtime and ctime) are not such triggers, by definition: only changes to other things in the inode are. Clearly it *would* be valid -- heck, I'd prefer it, since unlike atime updates mtime updates don't really constitute a large volume of disk output in normal usage as far as I'm aware -- but that's not what this patch does.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/623286/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor624515"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 4, 2014 14:40 UTC (Thu)
                               by <b>nye</b> (subscriber, #51576)
                              [<a href="/Articles/624515/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ted's actual description is somewhat clearer:<br>
<p>
<font class="QuotedText">&gt;Add a new mount option which enables a new "lazytime" mode.  This mode</font><br>
<font class="QuotedText">&gt;causes atime, mtime, and ctime updates to only be made to the</font><br>
<font class="QuotedText">&gt;in-memory version of the inode.  The on-disk times will only get</font><br>
<font class="QuotedText">&gt;updated when (a) when the inode table block for the inode needs to be</font><br>
<font class="QuotedText">&gt;updated for some non-time related change involving any inode in the</font><br>
<font class="QuotedText">&gt;block, (b) if userspace calls fsync(), or (c) the refcount on an</font><br>
<font class="QuotedText">&gt;undeleted inode goes to zero (in most cases, when the last file</font><br>
<font class="QuotedText">&gt;descriptor assoicated with the inode is closed).</font><br>
<p>
So if you want that information to be committed to disk, fsync() will do the job.<br>
Since behaviour when the file is never fsync()ed is not well defined, this isn't *in theory* much of a change.<br>
<p>
In practice, the difference roughly means going from<br>
"Data written but not synced before OS crash or power loss will hopefully be written to disk, mostly in the right order if you're lucky, but there are no guarantees" to appending the proviso "except for isolated time updates, which probably won't".<br>
<p>
In both cases, you could never be sure that the mtime was updated on disk after writing to the middle to your file, nor even that the write was either completed or not, and the file would need to be checked for consistency. This might, in certain circumstances, reduce the probability that you happen to get lucky, if you're using mtime to determine whether a file needs to be checked after crash/power loss (this scenario seems unlikely on the grounds that it probably won't work a great deal of the time).<br>
<p>
Do correct me if I have misunderstood.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/624515/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor641854"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 25, 2015 15:45 UTC (Sat)
                               by <b>mcortese</b> (guest, #52099)
                              [<a href="/Articles/641854/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>I don't care about performance, but all my disks are SSD and avoiding some writes looks like a good idea. I switched to noatime years ago and have never since regretted it.</p>

<p>Apart from email clients developed centuries ago, what are the "few" applications that really can't work without atime?</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/641854/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor654099"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Introducing lazytime</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2015 22:48 UTC (Mon)
                               by <b>lsatenstein</b> (guest, #34741)
                              [<a href="/Articles/654099/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I am just an end-user with SSD disks.  I would have preferred to have noatime as the absolute default for any fileopen or mount.<br>
But with  the open call, I would have added a symbol _FORCE_ATIME, which would reverse the noatime for that particular file or Directory or partition.<br>
<p>
Of course, we would have to go through the exercise of review by all standard associations, but in the end, atime or noatime would be managed by the user.  (If the open() is sacrosanct, then extend the touch call to control /force atime. <br>
<p>
If I am wrong about this solution for managing atime, please post an explanation to me as to why it is not a good solution.<br>
<p>
Thank you<br>
<p>
Leslie  <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/654099/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2014, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
