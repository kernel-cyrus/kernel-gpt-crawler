        <!DOCTYPE html>
        <html lang="en">
        <head><title>Not-a-GPU accelerator drivers cross the line [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/867168/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/867462/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/867168/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Not-a-GPU accelerator drivers cross the line</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>August 26, 2021</br>
           </div>
As a general rule, the kernel community is happy to merge working device
drivers without much concern for the availability of any associated
user-space code.  What happens in user space is beyond the kernel's concern
and unaffected by the kernel's license.  There is an exception, though, in
the form of drivers for graphical processors (GPUs), which cannot be merged
in the absence of a working, freely-licensed user-space component.  The
question of which drivers are subject to that rule has come up a few times
in recent years; that discussion has now come to a decision point with an
effort to block <a
href="/ml/linux-kernel/20210819110209.GA115485@ogabbay-vm2.habana-labs.com/">some
Habana Labs driver updates</a> from entry into the 5.15 kernel.
<p>
The GPU-driver rule is the result of a "<a href="/Articles/394702/">line in
the sand</a>" drawn by direct-rendering (DRM) maintainer Dave Airlie in
2010.  The kernel side of most GPU drivers is a simple conduit between user
space and the device; it implements something similar to a network
connection.  The real complexity of these drivers is in the user-space
component, which uses the kernel-provided channel to control the GPU via a
(usually) proprietary protocol.  The DRM maintainers have long taken the
position that, without a working user-space implementation, they are unable
to judge, maintain, or test the kernel portion of the driver.  They have
held firm 
for over a decade now, and feel that this policy is an important part of
the progress that this subsystem has made over that time.
<p>
At its core, a GPU is an accelerator that is optimized to perform certain
types of processing much more quickly than even the fastest CPU can.
Graphics was the first domain in which these accelerators found widespread
use, but it is certainly not the last.  More recently, there has been a
developing market in accelerators intended to perform machine-learning
tasks; one of those, the <a href="https://habana.ai/">Habana Gaudi</a>, is
supported by the Linux kernel.
<p>
The merging of the Gaudi driver has raised a number of questions about how
non-GPU accelerators should be handled.  This driver did not go through the
DRM tree and was not held to that subsystem's rules; it went into the
mainline kernel while lacking the accompanying user-space piece.  That was later
rectified (mostly — see below), but the DRM developers were unhappy about
a process that, they felt, bypassed the rules they had spent years
defending.  <a href="/Articles/821817/">Just over one year ago</a>, the
arrival of a couple of other accelerator drivers spurred a discussion on
whether those drivers should be treated like GPUs or not; no clear
conclusions resulted.
<p>
The Habana driver has been the source of a few similar discussions over the
last few months, with bursts <a
href="/ml/linux-kernel/CAKMK7uFOfoxbD2Z5mb-qHFnUe5rObGKQ6Ygh--HSH9M=9bziGg@mail.gmail.com/">in
late June</a> and <a
href="/ml/linux-kernel/YOQXBWpo3whVjOyh@phenom.ffwll.local/">early
July</a>.  The problem now is an expansion of that driver's capabilities
that requires using the kernel's <a
href="https://www.kernel.org/doc/html/v5.13/driver-api/dma-buf.html">DMA-BUF</a>
and <a href="/Articles/767281/">P2PDMA</a> subsystems to move data between
devices.  These subsystems were developed to work with GPU drivers and are
clearly seen by some DRM developers as being part of the kernel's GPU API;
drivers using them should, by this reasoning, be subject to the GPU
subsystem's merging rules.  Or, as Airlie <a
href="/ml/linux-kernel/CAPM=9tyT_iouVE2v8J0SMJOLV=pr=QJOm88ud=bht4=5Ms2Y2A@mail.gmail.com/">phrased
it</a> in his objection to merging the Gaudi changes:
<p>
<blockquote class="bq">
	NAK for adding dma-buf or p2p support to this driver in the
	upstream kernel. There needs to be a hard line between
	"I-can't-believe-its-not-a-drm-driver" drivers which bypass our
	userspace requirements, and I consider this the line.
<p>
	This driver was merged into misc on the grounds it wasn't really a
	drm/gpu driver and so didn't have to accept our userspace rules.
<p>
	Adding dma-buf/p2p support to this driver is showing it really fits
	the gpu driver model and should be under the drivers/gpu rules
	since what are most GPUs except accelerators.
</blockquote>
<p>
The interesting twist here, as <a
href="/ml/linux-kernel/YORLTmyoXDtoM9Ta@phenom.ffwll.local/">acknowledged</a>
by DRM developer Daniel Vetter, is that there is, indeed, a free user-space
implementation of the Gaudi driver.  What is still <i>not</i> available is
the compiler used to generate the instruction streams that actually drive
this device.  Without the compiler, Vetter said, the available code is
"<q>still useless if you want to actually hack on the driver
stack</q>".  He <a
href="/ml/linux-kernel/CAKMK7uHfCbNQJwbXgLC9ibk71kVG7TBK4bfFxzX82ziSgqG9nw@mail.gmail.com/">elaborated</a> further:
<p>
<blockquote class="bq">
	Can I use the hw how it's intended to be used without it?
<p>
	If the answer is no, then essentially what you're doing with your
	upstream driver is getting all the benefits of an upstream driver,
	while upstream gets nothing. We can't use your stack, not
	as-is. Sure we can use the queue, but we can't actually submit
	anything interesting.
</blockquote>
<p>
Over the course of the discussions, the DRM developers have tried to make
it clear that they want <i>a</i> working, free implementation of the
user-space side.  It does not have to be <i>the</i> code that is shipped to
customers, as long as it is sufficient to understand how the driver as a
whole works.  To some, though, the compiler requirement stretches things a
bit far.  Habana developer Oded Gabbay has <a
href="/ml/linux-kernel/CAFCwf10_rTYL2Fy6tCRVAUCf4-6_TtcWCv5gEEkGnQ0KxqMUBg@mail.gmail.com/">described</a>
the DRM subsystem's requirements this way:
<p>
<blockquote class="bq">
	I do think the dri-devel merge criteria is very extreme, and
	effectively drives-out many AI accelerator companies that want to
	contribute to the kernel but can't/won't open their software IP and
	patents.
<p>
	I think the expectation from AI startups (who are 90% of the deep
	learning field) to cooperate outside of company boundaries is not
	realistic, especially on the user-side, where the real IP of the
	company resides.
</blockquote>
<p>
Cooperating outside of company boundaries is, of course, at the core of the
Linux kernel development process.  The DRM subsystem is not alone in making
such requirements; Vetter <a
href="/ml/linux-kernel/CAKMK7uEAJZUHNLreBB839BZOfnTGNU4rCx-0k55+67Nbxtdx3A@mail.gmail.com/">responded</a>
by pointing out, among other things, that the kernel community will not
accept a new CPU architecture without a working, free compiler.
<p>
Over the years, there has been no shortage of problems with vendors that
want their hardware to work with Linux while keeping their "intellectual
property" to themselves.  This barrier has been overcome many times,
resulting in wider and better hardware support in the kernel we all use.
Getting there has required at least two things: demand from customers for
free drivers and a strong position in the development community against
proprietary drivers.  The demand side must develop on it own (and often
does), but the kernel community has worked hard to maintain and communicate
a unified position on driver code; consider, for example, the <a
href="/Articles/287056/">position statement</a> published in 2008.  As a
result there is a consensus in the community covering a number of areas
relevant to proprietary drivers; one will have to work hard to find voices
in favor of exporting symbols to benefit such drivers, for example.
<p>
This ongoing series of discussions makes it clear that the kernel community
has not yet reached a consensus when it comes to the requirements for
drivers for accelerator devices.  That creates a situation where code that
is subject to one set of rules if merged via the DRM subsystem can avoid
those rules by taking another path into the kernel.  That, of course, will
make it hard for the rules to stand at all.  Concern about this prospect
extends beyond the DRM community; media developer Laurent Pinchart <a
href="/ml/linux-kernel/YSLYklow2ZAPqgK1@pendragon.ideasonboard.com/">wrote</a>:
<p>
<blockquote class="bq">
	I can't emphasize strongly enough how much effort it took to start
	getting vendors on board, and the situation is still fragile at
	best. If we now send a message that all of this can be bypassed by
	merging code that ignores all rules in drivers/misc/, it would be
	ten years of completely wasted work.
</blockquote>
<p>
Avoiding that outcome will require getting kernel developers and
(especially) subsystem maintainers to come to some sort of agreement —
always a challenging task.
<p>
In the case of the Gaudi driver, Greg Kroah-Hartman <a
href="/ml/linux-kernel/YR6PIvwYbYG20ZY0@kroah.com/">replied</a> that he had
pulled the controversial code into his tree.  In response to the subsequent
objections, he <a
href="/ml/linux-kernel/YR99zh43GD3AylRY@kroah.com/">dropped that work</a>
and promised to "<q>write more</q>" once time allows.  Dropping the
patches for now helps to calm the situation, but it has not resolved the
underlying disagreement.  At some point, the kernel community will have to
reach some sort of conclusion regarding its rules for accelerator drivers.
Failing that, we are likely to see a steady stream of not-a-GPU drivers
finding their way into the kernel — and a lot of unhappiness in their
wake.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Device_drivers-Accelerators">Device drivers/Accelerators</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/867168/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor867514"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 16:39 UTC (Thu)
                               by <b>q_q_p_p</b> (guest, #131113)
                              [<a href="/Articles/867514/">Link</a>] (31 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Aren&#x27;t DMA-BUF and P2PDMA interfaces completely generic ? I don&#x27;t see why drivers using them, should be considered GPUs. Yeah, they were made with GPU use cases in mind, but it doesn&#x27;t mean they can&#x27;t be used for other things too. Imagine a floppy drive driver using DMA-BUF and being called a GPU driver ;) <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867514/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867529"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 17:00 UTC (Thu)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/867529/">Link</a>] (29 responses)
      </p>
      
      </div>
      </summary>
      <p>The thing that makes these things GPU-like is that a GPU is a programmable accelerator that takes in memory buffers (including those provided by DMA-BUF and P2PDMA interfaces) and outputs new memory buffers with processing applied based on the contents of one of the input memory buffers (which contains a program for the accelerator to run). These "not-a-GPU" things are programmable accelerators that take in memory buffers (including those provided by DMA-BUF and P2PDMA interfaces)  and outputs new memory buffers with processing applied based on the contents of one of the input memory buffers (which contains a program for the accelerator to run).
<p>A floppy drive driver would not have the programmable accelerator bit.


      
          <div class="CommentReplyButton">
            <form action="/Articles/867529/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867530"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 17:45 UTC (Thu)
                               by <b>q_q_p_p</b> (guest, #131113)
                              [<a href="/Articles/867530/">Link</a>] (28 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For me GPU is something that utilizes DRM or KMS. Your description of gpu and not-a-gpu is what almost all computing devices do - take input (memory buffer), compute (execute program) and produce output (memory buffer) - on this level there&#x27;s no difference between any of these devices, but it would be ridiculous to call every such device a GPU (e.g. FPGAs, programmable DSPs).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867530/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867536"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 18:29 UTC (Thu)
                               by <b>ab</b> (subscriber, #788)
                              [<a href="/Articles/867536/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A difference is that the stream of instructions for transforming an input buffet into an output buffet is completely opaque to the kernel. If you are not in a privileged position to be able to generate the stream, there&#x27;s no way you&#x27;d know how to drive a particular floppy drive, so to say, if there&#x27;s no a common standard for that communication. Accelerators like these are black boxes without that knowledge. Vendors like to keep them as such and this is way different from traditional DRM or KMS use.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867536/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor867547"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 19:30 UTC (Thu)
                               by <b>airlied</b> (subscriber, #9104)
                              [<a href="/Articles/867547/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
&quot;At its core, a GPU is an accelerator &quot;<br>
<p>
So for you that might be something you hold true to, but in the real world, DRM (without KMS) is a subsystem that exposes accelerators to userspace. It just happens to be 3D accelerators.<br>
<p>
We don&#x27;t call these devices GPUs we call them accelerators. Does that make it easier to understand, and yes DSPs and FPGAs should be in the same boat, we have bunch of pointless upstream FPGA drivers that are pretty much unmaintainable because they are tied to closed userspaces. Xilinx even submitted a drm driver in the past.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867547/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867552"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 20:03 UTC (Thu)
                               by <b>brigdh</b> (subscriber, #137272)
                              [<a href="/Articles/867552/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Perhaps a problem is that DRM stands for Direct Rendering Manager. &quot;Rendering&quot; evokes &quot;graphics&quot;. Sure, its a decades old name, but if its intended to be a general accelerator interface, perhaps it should be renamed to account for that?<br>
Essentially your &quot;marketing&quot; doesn&#x27;t match your intent.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867552/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867562"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">what does &quot;drm&quot; mean</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 20:49 UTC (Thu)
                               by <b>nwnk</b> (guest, #52271)
                              [<a href="/Articles/867562/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This feels a bit like chasing goalposts, but if that&#x27;s the concern I suggest retconning it to &quot;Doesn&#x27;t Really Matter&quot; and then explaining that it&#x27;s the accelerator subsystem in the Kconfig text.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867562/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867565"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">what does &quot;drm&quot; mean</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 21:14 UTC (Thu)
                               by <b>brigdh</b> (subscriber, #137272)
                              [<a href="/Articles/867565/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The naming isn&#x27;t strictly important, but it probably does hurt the conversation.  What may be more important is having someone be the &quot;poster boy&quot; for a &quot;non-gpu&quot; in the drivers/gpu area to show everyone else what that looks like, and to be an example to copy.  Some of the past discussion seemed to be the GPU folks claiming their interface will do it all, but not providing any examples, and expecting someone else to figure out what the userspace stack is going to look like.  Is it MESA?  Some other framework?  Chances are someone is going to get OneAPI talking to DRM, post the patches, and the GPU folks are going to tell them they are an idiot for not refactoring MESA.  This is not to say the GPU folks need to do all the work, but some sort of a &quot;blueprint&quot; for what they want to see or what they think will work might go a long way.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867565/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867566"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">what does &quot;drm&quot; mean</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 21:22 UTC (Thu)
                               by <b>blackwood</b> (guest, #44174)
                              [<a href="/Articles/867566/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
xillinx submitted a drm driver with their own opencl userspace stack a few years ago. That looked pretty reasonable as far as these things go (we have plenty of non-mesa userspace for the not-so-3d use-cases). Aside from the lack of compiler. It was some TPU/fpga fusion core aimed at AI use-cases.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867566/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor867659"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">what does &quot;drm&quot; mean</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 20:39 UTC (Fri)
                               by <b>linusw</b> (subscriber, #40300)
                              [<a href="/Articles/867659/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I have recently been under the impression that Apache TVM has the ambition to be the &quot;MESA of learning/inference engines&quot;. In difference from other AI userspace this project seems very alive with major companies contributing to it. Their stated ambition is &quot;An End to End Machine Learning Compiler Framework for CPUs, GPUs and accelerators&quot;.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867659/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867660"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">what does &quot;drm&quot; mean</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 20:53 UTC (Fri)
                               by <b>blackwood</b> (guest, #44174)
                              [<a href="/Articles/867660/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
From a quick look it&#x27;s another model optimizer framework, of which there&#x27;s an enormous amount all over for different combinations of use-cases. This one seems more aimed at embedded since they talk a lot about zephyr, if I got that right.<br>
<p>
That&#x27;s all important to squeeze actual good real world performance out of your hw, but not something we care about for a driver stack. The actual compiler backend is absent for real hw. They have llvm (for cpus), cuda (we know that one is blobby) and bring-your-own-codegen (definitely going to be blobby too).<br>
<p>
With these fairly pure math accelerators with a lot less fixed function than 3d the only somewhat interesting thing in the hw is the actual compute block and corresponding compiler. And that one is always the sticking point, all the pieces around are generally fairly easy to get after a bit of talking.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867660/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867691"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">what does &quot;drm&quot; mean</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2021 15:07 UTC (Sat)
                               by <b>linusw</b> (subscriber, #40300)
                              [<a href="/Articles/867691/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Actually Arm has submitted a backend for the Ethos NPU, and it is pretty open:<br>
<a href="https://discuss.tvm.apache.org/t/rfc-ethosn-arm-ethos-n-integration/6680">https://discuss.tvm.apache.org/t/rfc-ethosn-arm-ethos-n-i...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867691/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867813"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">what does &quot;drm&quot; mean</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2021 18:26 UTC (Mon)
                               by <b>blackwood</b> (guest, #44174)
                              [<a href="/Articles/867813/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
(I forgot to hit publish, why does lwn make you ponder your comment first)<br>
<p>
On a quick look this seems fairly interesting. I think there&#x27;s a few other NN stacks for inteference engines at least which are similarly open. Nothing yet that achieved actual cross hw-vendor status, but good thing to watch for sure.<br>
<p>
This one also seems to just redirect to the arm ethnos stack, and not actually merge the backend fully into the upstream project. Only when you do that do the benefits of a real upstream project kick in.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867813/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor867575"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 23:25 UTC (Thu)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/867575/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; DRM stands for Direct Rendering Manager</font><br>
Maybe change that to Device Resource Manager? Because it&#x27;s kinda what it is these days.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867575/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor867597"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 9:07 UTC (Fri)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/867597/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <p>KMS is an interface for display controllers, not GPUs; GPUs <em>are</em> simply compute accelerators attached to the main CPU, which take a program and some input buffers, and produce output, and that's what DRM is intended to provide a good interface for. It happens, for historical reasons, that the first major use of programmable compute accelerators in Linux was accelerators attached to display controllers, but that's simply history.
<p>This is why other compute accelerators belong with DRM; after more than a decade of getting the interfaces for compute acceleration right, and fighting the fight for maintainable kernel drivers, the DRM team (Dave Airlie et al) know what they're doing. One of the (many) things they've learnt over the years is that the driver maintainers need to be able to understand the program bytes for security reasons - if you don't know what the program bytes do, you can't determine what memory accesses the hardware is intended to attempt, and which ones are security bugs, nor is it even possible to filter out programs that are going to ask the hardware to make memory accesses the kernel does not want it to.
<p>There's even an option for teams that think that their software secret sauce is what makes the difference; do what AMD has done, and have a complete open source stack atop the kernel driver (the Mesa stack in the case of AMD OpenCL compute drivers), <em>and</em> have a separate proprietary stack (the AMDGPU-PRO stack in the case of AMD OpenCL compute drivers) that includes the secret sauce. 
<p>Also, when we're trying to determine what devices should utilize DRM, "utilizes DRM" is not a good dividing line because it's circular :-)


      
          <div class="CommentReplyButton">
            <form action="/Articles/867597/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867601"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 10:35 UTC (Fri)
                               by <b>daniels</b> (subscriber, #16193)
                              [<a href="/Articles/867601/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; This is why other compute accelerators belong with DRM; after more than a decade of getting the interfaces for compute acceleration right, and fighting the fight for maintainable kernel drivers, the DRM team (Dave Airlie et al) know what they&#x27;re doing. One of the (many) things they&#x27;ve learnt over the years is that the driver maintainers need to be able to understand the program bytes for security reasons - if you don&#x27;t know what the program bytes do, you can&#x27;t determine what memory accesses the hardware is intended to attempt, and which ones are security bugs, nor is it even possible to filter out programs that are going to ask the hardware to make memory accesses the kernel does not want it to.</font><br>
<p>
Not just security reasons, but also because dma-buf and thus dma-fence have deep ties into memory management.<br>
<p>
The analogy to things like floppy drives is a total red herring. For storage and network devices, you have well-known interfaces on both sides: industry standards like SCSI/NVMe/RDMA for hardware, and standardised kernel/userspace API through POSIX or Linux-specific development. Accelerator development is much more wild-west in that regard, so the kernel is being asked to be a dumb shovel between huge unknowns on both sides. That was much easier to handle in the past, because the driver had to bash registers and IRQs directly, so you could at least derive from that how the hardware works and thus what the implications should be. But now kernel drivers for modern accelerators just map command/event queues into userspace, so it&#x27;s a total black box.<br>
<p>
That&#x27;s why there&#x27;s a line in the sand: because the deep integration into all kinds of complex subsystems means that we&#x27;re tying the behaviour of huge amounts of kernel behaviour into totally unknown vendor-specific black boxes. Having an open userspace - something meaningful, not just submitting an empty &#x27;ping&#x27; command into the ring - is the only thing that lets us reason about what this actually means.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867601/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867647"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 17:50 UTC (Fri)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/867647/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;m not very familiar with the DRM stack, so perhaps this is a stupid question, but...<br>
<p>
What is stopping these manufacturers from releasing product A, with FOSS drivers/userspace, getting the drivers upstreamed, and then releasing product B, with proprietary userspace, but which just so happens to have the same firmware/hardware-level interface as product A, so that you can use the same drivers at the kernel level (but if you try to use product A&#x27;s userspace with product B&#x27;s hardware, it doesn&#x27;t work)?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867647/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867656"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 19:59 UTC (Fri)
                               by <b>dezgeg</b> (subscriber, #92243)
                              [<a href="/Articles/867656/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This actually has happened (assuming I understood correctly what you were asking): NVIDIA proprietary driver running on top of nouveau kernel driver: <a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=Nouveau-Pixel-C-Default">https://www.phoronix.com/scan.php?page=news_item&amp;px=N...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867656/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor867654"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 20:24 UTC (Fri)
                               by <b>blackwood</b> (guest, #44174)
                              [<a href="/Articles/867654/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Generally these come with new pciids or new device-tree id, and that requires a kernel patch to add. You could just bind the old driver through sysfs to the new device to bypass that. But no one is that good at creating hardware that doesn&#x27;t need at least minor adjustments to the kernel driver setup code, so in pratice this doesn&#x27;t happen. Except when it actually really is the exact same chip with just different branding.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867654/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor867671"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 21:43 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/867671/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; What is stopping these manufacturers from releasing product A, with FOSS drivers/userspace, getting the drivers upstreamed, and then releasing product B, with proprietary userspace, but which just so happens to have the same firmware/hardware-level interface as product </font><br>
<p>
That&#x27;s the situation now with the Radeon drivers. There&#x27;s a reasonable open source stack, and then there&#x27;s AMDGPU Pro closed-source driver that uses the same kernel interface as the open source driver, but provides more optimizations and functionality.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867671/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867679"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 23:21 UTC (Fri)
                               by <b>daniels</b> (subscriber, #16193)
                              [<a href="/Articles/867679/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don’t think that was the question. What you’re saying is that you can write closed userspace that happens to be better optimised against the same stack, and that’s totally fine, as long as the full surface area of the hardware and the API is understood in open stacks.<br>
<p>
The question though was: what if someone makes hardware that’s similar enough to existing open hardware + userspace stacks to fool the kernel, but is only usable with new proprietary userspace, presumably with new extensions as well? And honestly, it’s a good question, and would be a great problem to have. But like blackwood said, no-one has yet done it and thanks to the designs open stacks enforce, it’s not on the cards either.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867679/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867694"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2021 16:08 UTC (Sat)
                               by <b>alyssa</b> (guest, #130775)
                              [<a href="/Articles/867694/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In an alternate universe where the Midgard stack was upstream FOSS and Bifrost DDK-on-mainline was productized, this could have happened close to home...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867694/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor867728"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2021 18:37 UTC (Sun)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/867728/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The question though was: what if someone makes hardware that’s similar enough to existing open hardware + userspace stacks to fool the kernel, but is only usable with new proprietary userspace, presumably with new extensions as well? And honestly, it’s a good question, and would be a great problem to have</font><br>
<p>
What would be the kernel maintenance problem in that case?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867728/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867794"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2021 15:48 UTC (Mon)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/867794/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
5+ years after the FOSS userspace is no longer usable, the kernel suddenly suffers a regression which can only be reproduced using the proprietary userspace. The regression is eventually narrowed down to some random subsystem which the driver briefly calls into, and the easiest way to fix it is to roll back a security fix. Now what?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867794/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867819"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2021 19:41 UTC (Mon)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/867819/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Remove the driver from the mainline. Duh. Actually, remove it immediately (move to staging, mark BROKEN, remove) after the userspace goes proprietary.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867819/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867832"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 31, 2021 4:22 UTC (Tue)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/867832/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, I suppose technically the FOSS userspace does *work.* It&#x27;s just that it only works with some 10+ year old toaster that 4 users actually own. Unfortunately, those 4 users know how to post to LKML and are not afraid of doing so.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867832/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867833"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 31, 2021 4:30 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/867833/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Then limit it to several PCI IDs and blacklist further additions. Or make sure it works with certain firmware versions. It&#x27;s not like the kernel developers can&#x27;t do anything once the driver is in the kernel.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867833/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor867837"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 31, 2021 10:16 UTC (Tue)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/867837/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <p>If there's a regression with the proprietary userspace only, then that's what's at fault, automatically - after all, the FOSS userspace works just fine.


      
          <div class="CommentReplyButton">
            <form action="/Articles/867837/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867857"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 31, 2021 14:41 UTC (Tue)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/867857/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Since when has the source-availability been a release valve for ignoring kernel regressions? I haven&#x27;t heard that that was suitable now.<br>
<p>
The *right* thing to do is to ask for a way to reproduce the behavior with the FOSS userspace stack as part of the regression&#x27;s test suite :) . Because how else are kernel developers going to know that they broke it?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867857/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867924"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 31, 2021 15:27 UTC (Tue)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/867924/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>In this case, because the driver is split into two parts - the userspace component, and the kernelspace component. Without source for both, how do you know that the kernelspace component is causing the breakage by doing the wrong thing? It might, for example, be the userspace component expecting that the kernel doesn't enable IOMMU facilities for this device, and being caught out by the change.


      
          <div class="CommentReplyButton">
            <form action="/Articles/867924/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor868525"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2021 2:17 UTC (Tue)
                               by <b>florianfainelli</b> (subscriber, #61952)
                              [<a href="/Articles/868525/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Accelerator development is much more wild-west in that regard, so the kernel is being asked to be a dumb shovel between huge unknowns on both sides.</font><br>
<p>
So maybe the approach should be to push back, wait for these 100 AI startups or so to get out of business/be acquired/merged and start working on what resembles a standard. The same is true with any silicon these days, the differentiation is in support, pricing, intrinsic hardware design and software should just be a commodity, because it will be down the road.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868525/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor867646"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 17:01 UTC (Fri)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/867646/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Imagine a drive whose developers want to install a DMA interface in the Linux kernel and keep all the details of loading data from and to the disk in a proprietary system outside kernel space. I can&#x27;t imagine that kernel developers would be too amused.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867646/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor867531"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 17:27 UTC (Thu)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/867531/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There&#x27;s prior art outside the DRM tree for how to deal with shovelware. If the manufacturer insists on making these devices a miserable experience to use and debug, like Conexant did with its winmodems and Broadcom with its everything, we should respect their wishes loud enough that nobody is fooled into buying them again.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867531/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867542"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 19:01 UTC (Thu)
                               by <b>airlied</b> (subscriber, #9104)
                              [<a href="/Articles/867542/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The problem is these are not consumer devices, they are mainly enterprise but also show up on cloud vendors like AWS. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867542/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867598"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 9:08 UTC (Fri)
                               by <b>shiftee</b> (subscriber, #110711)
                              [<a href="/Articles/867598/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Unlike the consumer market, Linux has a lot of clout in the enterprise market.<br>
Broadcom drivers is an area we need to compromise for the sake of regular users.<br>
This seems like a bad deal where we provide kernel infrastructure and maintenance for very little return.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867598/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor867639"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 15:15 UTC (Fri)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/867639/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In that case, I humbly suggest that they should never have merged it at all. For all intents and purposes this thing is about as relevant to mainline as a big-endian x86.<br>
<p>
There&#x27;s plenty of weird drivers already in the kernel but all of them have the major distinction that a normal person could realistically obtain the hardware and use it under Linux without breaking any laws (cf. the PS4 R600 support patches - rejecting those was the right thing to do even though it annoyed a few people). This hardware on the other hand sounds effectively time-bomb drm&#x27;ed — it&#x27;ll be obsolete before it shows up on the grey market, and it&#x27;s non-functional without the secret sauce component. Aside from the technical reasons: there&#x27;s very few honest uses for these responsibility laundering accelerators to begin with.<br>
<p>
A quick skim over the EULA on their site suggests that the company keeps tight legal control over who has access to the userspace part, so once they lose interest in it it becomes a paperweight. And it&#x27;s an Intel subsidiary, throwing things over the wall and discontinuing support on a timeframe of months is all but guaranteed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867639/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867729"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2021 18:39 UTC (Sun)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/867729/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; so once they lose interest in it it becomes a paperweight. And it&#x27;s an Intel subsidiary, throwing things over the wall and discontinuing support on a timeframe of months is all but guaranteed.</font><br>
<p>
Unlike... smartphones?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867729/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868244"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 3, 2021 6:06 UTC (Fri)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/868244/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not really comparable (unless you&#x27;re talking Windows Mobile). My phone&#x27;s 10 years old and although the manufacturer sucks, it still gets aftermarket OS updates thanks to having so many eyes on it; I&#x27;ve even done some myself to get better fonts.<br>
<p>
These ML chips will never get that kind of attention, because they&#x27;re neither interesting nor accessible to hackers. If the company&#x27;s lucky they may become a curiosity in a hardware museum someday, but they probably won&#x27;t be plugged in.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868244/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868332"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 3, 2021 19:13 UTC (Fri)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/868332/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Not really comparable...</font><br>
<p>
... to other Intel products either.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868332/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor869893"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 21, 2021 4:09 UTC (Tue)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/869893/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
From recent memory: GMA500 (infamously never had a functional driver beyond software framebuffer, PowerVR junk but Intel branding and responsibility); the entire Moorestown x86 SoC platform (all purged from the kernel earlier this year to prevent people using them, if anyone ever bought them); old CPUs getting excluded from microcode fixes for logo-and-website architectural vulnerabilities. I&#x27;ve heard sour opinions of their recent WiFi 6 stuff from the bufferbloat people too.<br>
<p>
And that&#x27;s just the problems concerning Linux. The entire USB3/4/C/TB mess they&#x27;ve foisted on the world is a miserable experience no matter which OS you use, to the point where I&#x27;ve actively avoided buying any devices that need it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/869893/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor869897"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 21, 2021 5:47 UTC (Tue)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/869897/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Dunno about the USB mess. All other examples look like exceptions rather than the rule.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/869897/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor869931"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 21, 2021 17:10 UTC (Tue)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/869931/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The one area where they seem to be doing well is their own GPUs, I&#x27;ll give them that. If Intel was an option that didn&#x27;t require an entire new PC I&#x27;d consider it over upgrading my ageing Radeon, because they&#x27;ve always been on the ball with driver support and the latter seems to be perpetually 5 years behind on video codecs.<br>
<p>
It&#x27;d be irresponsible to go there right now though, what with the tulip mania apocalypse going on.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/869931/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor869961"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 22, 2021 6:37 UTC (Wed)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/869961/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You only need a PCIe slot (Intel does stand-alone GPUs, again):<br>
<a href="https://www.tomshardware.com/news/intel-iris-xe-dg1-budget-1080p-gaming-gpu">https://www.tomshardware.com/news/intel-iris-xe-dg1-budge...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/869961/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor869965"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 22, 2021 8:39 UTC (Wed)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/869965/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don&#x27;t think you can buy it just now, though. It should be available in near-future, though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/869965/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor868533"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2021 10:42 UTC (Tue)
                               by <b>immibis</b> (guest, #105511)
                              [<a href="/Articles/868533/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; These ML chips will never get that kind of attention, because they&#x27;re neither interesting nor accessible to hackers. If the company&#x27;s lucky they may become a curiosity in a hardware museum someday, but they probably won&#x27;t be plugged in.</font><br>
<p>
I have been looking at Tenstorrent, which promises to sell you a PCIe card for $750 (but it&#x27;s not ready yet). Some other companies will sell you a powerful server for $X,XXX (or maybe $1X,XXX) which seems to still be in the range of (perhaps small groups of) really dedicated ML hackers. And, yes, some will only sell thousands of servers to huge cloud enterprises, but we can&#x27;t assume that as a rule.<br>
<p>
---<br>
<p>
Not to mention that in 5-10 years, all these now-outdated accelerators made by now-defunct startups will be discarded and will have to go somewhere. At that point you may be able to pick one up on eBay for $100-$1000.<br>
<p>
I found a set of &quot;obsolete&quot; Infiniband hardware that way - where &quot;obsolete&quot; = &quot;only does 40Gbps when the modern hardware does 400Gbps&quot;. So it does happen. Now I can hack on Infiniband if I get the time and inclination. Because there are open source drivers for these NICs.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868533/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor867545"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 19:30 UTC (Thu)
                               by <b>bjacob</b> (guest, #58566)
                              [<a href="/Articles/867545/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It would be understandable if Linux maintainers felt particularly conservative now, given the fact that so many of these new hardware accelerators will never actually be used by anyone in practice. There are probably more than 100 artificial-intelligence hardware accelerator startups, the majority funded by investors not actual consumers. Even when one gets acquired by a division in a corporation that really thinks it is going to ship it, the odds of that actually happening are still long.<br>
<p>
Maybe what Linux needs is some middle-ground between fully supported in-tree drivers and &quot;NAK&quot;...<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867545/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867548"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 19:43 UTC (Thu)
                               by <b>olof</b> (subscriber, #11729)
                              [<a href="/Articles/867548/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I tried to get that going a couple of years ago, but was met with significant resistance -- and worse, after talking through and reaching some sort of middle ground, it just continued with passive-aggressiveness and subtweeting and snipes whenever the topic came up.<br>
<p>
As a result, there&#x27;s better things to spend my time on than dealing with difficult or toxic people, and I&#x27;ve stopped paying attention.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867548/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor867549"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 19:51 UTC (Thu)
                               by <b>airlied</b> (subscriber, #9104)
                              [<a href="/Articles/867549/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The middle ground is just open source out of tree drivers I suppose.<br>
<p>
Piling crap into the kernel isn&#x27;t maintainable, especially crap with it&#x27;s own bespoke ioctl interfaces and user APIs. Like a bad network driver you can remove later, but a bad accelerator driver with a uAPI that userspace has started using is nightmare fuel. There are still a lot of kernel maintainers who think all drivers are like network or scsi and assume userspace isn&#x27;t important to them. Really kernel maintainers need to take more responsibility for the messes they create by merging stuff.<br>
<p>
There is no track record of meeting these companies half way working, some people believe that if we let them merge stuff it&#x27;ll magically create a community with no effort or they will suddenly see the light.<br>
<p>
In 10-15 years of experience in this is that companies will only do what they have to satisfy customer/market pressures. The only reason most of these companies want upstream drivers is to get them into RHEL in the end, and I don&#x27;t get why we&#x27;d want to create upstream as a dumping ground for that.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867549/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867580"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 2:58 UTC (Fri)
                               by <b>developer122</b> (guest, #152928)
                              [<a href="/Articles/867580/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Makes me thing they should be striking deals with RHEL to carry them for their customers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867580/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867590"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 6:57 UTC (Fri)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/867590/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
RHEL doesn&#x27;t include out-of-tree drivers, so that would be a non starter.<br>
<p>
It doesn&#x27;t for exactly the same reasons that Dave mentioned,. It is in Red Hat&#x27;s interest to have (at least in the future) a common upstream subsystem instead of locking in Red Hat&#x27;s customers to the SDKs of individual vendors.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867590/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867686"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2021 13:29 UTC (Sat)
                               by <b>lacos</b> (guest, #70616)
                              [<a href="/Articles/867686/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  RHEL doesn&#x27;t include out-of-tree drivers, so that would be a non starter.</font><br>
<p>
That&#x27;s how it should be, but at least VDO is an exception, to my understanding. (See e.g. the &quot;kmod-kvdo&quot; package from &quot;rhel-7-workstation-rpms&quot;.)<br>
<p>
<a href="https://www.redhat.com/en/blog/look-vdo-new-linux-compression-layer">https://www.redhat.com/en/blog/look-vdo-new-linux-compres...</a><br>
<p>
<font class="QuotedText">&gt; The code is available in the source RPMs, and upstream projects are getting established.</font><br>
<p>
<a href="https://man7.org/linux/man-pages/man7/lvmvdo.7.html">https://man7.org/linux/man-pages/man7/lvmvdo.7.html</a><br>
<p>
<font class="QuotedText">&gt; To use VDO with lvm(8), you must install the standard VDO user-space tools vdoformat(8) and the currently non-standard kernel VDO module &quot;kvdo&quot;.</font><br>
<p>
<a href="https://github.com/dm-vdo/kvdo#status">https://github.com/dm-vdo/kvdo#status</a><br>
<p>
<font class="QuotedText">&gt; there are a number of issues that must still be addressed to be ready for upstream</font><br>
<p>
The file list of &quot;linux-5.13.13.tar.xz&quot; does not seem to contain relevant &quot;uds&quot; of &quot;vdo&quot; hits. Even on Fedora, the kernel module(s) seem only available from personal COPRs -- two different (competing?) ones, at that.<br>
<p>
<a href="https://copr.fedorainfracloud.org/coprs/rhawalsh/dm-vdo/">https://copr.fedorainfracloud.org/coprs/rhawalsh/dm-vdo/</a><br>
<a href="https://copr.fedorainfracloud.org/coprs/tmm/VDO/">https://copr.fedorainfracloud.org/coprs/tmm/VDO/</a><br>
<p>
I fully agree that RHEL *should* not include out-of-tree drivers, but at least VDO is a precedent to the contrary.<br>
<p>
IIUC, VDO is now (C) Red Hat, and Red Hat actually open-sourced originally proprietary code, which is fantastic -- but for this discussion, the driver is still out-of-tree. (I abandoned evaluating VDO on my RHEL installs when I realized I wouldn&#x27;t be able to mount the same volumes under Fedora Live DVDs; e.g. for system recovery.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867686/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor867569"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 21:54 UTC (Thu)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/867569/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Without the compiler, Vetter said, the available code is &quot;still useless if you want to actually hack on the driver stack&quot;</font><br>
<p>
I think this should be the &quot;line in the sand&quot; (except &quot;to hack&quot; sounds vague and/or &quot;too big&quot; in this context).<br>
<p>
I have the corresponding hardware and I want to make a dead simple one-line change in this driver. How easily can I run my one-line change before submitting? If I cannot run a simple one-line change in that driver then it is not really open-source. This should not require the manufacturer to expose advanced features or other intellectual property.<br>
<p>
Discussing what is a GPU and what is not Does not Really Matter.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867569/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867581"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 3:10 UTC (Fri)
                               by <b>developer122</b> (guest, #152928)
                              [<a href="/Articles/867581/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think it was described more clearly in terms of &quot;can I use this thing the way it&#x27;s meant to be used?&quot;<br>
<p>
To maintain something you need to be able to exercise it. The open-source implementation doesn&#x27;t need to be high-performance, or even very good. However, there needs to be enough there that a maintainer can come along and exercise the kernel driver and hardware in all of the ways that are important to what the device is intended to do. For GPUs, a maintainer can run a video game over Mesa  (or run a pytorch ML model over ROCm).<br>
<p>
The inevitable alternative is to have broken drivers in the tree because either they couldn&#x27;t be tested to ensure continued functionality, or the provided precompiled command language or anemic open source userspace components didn&#x27;t exercise it comprehensively enough to notice the break.*<br>
<p>
Either customers _eventually_ discover the break years later when they are (forced) to move to a new kernel/version of RHEL, or there&#x27;s a heated debate years later over whether users still exist for a decrepit driver and if it can finally be dropped.<br>
<p>
*(or worse, there&#x27;s not enough information available to fix it, meaning reversions to not-break-userspace)<br>
<p>
Either way, reverts, complaining users, and calls for users of decrepit drivers are no fun for kernel maintainers to deal with.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867581/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867731"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2021 19:17 UTC (Sun)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/867731/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I think it was described more clearly in terms of &quot;can I use this thing the way it&#x27;s meant to be used?&quot;</font><br>
<font class="QuotedText">&gt; all of the ways that are important to what the device is intended to do.</font><br>
<p>
That sounds more ambiguous to me than &quot;run a one-line change&quot;.<br>
<p>
<font class="QuotedText">&gt; To maintain something you need to be able to exercise it.</font><br>
<p>
Agreed, the devil is in defining &quot;to exercise&quot;, especially in today&#x27;s binary world of yes/no answers.<br>
<p>
A number/metric can be attached to &quot;running a one-line change&quot; to make completely non-ambiguous, example: ability to run a one-line change in 80% of the driver code (without any NDA).<br>
<p>
This all sounds like a test coverage metric because it basically is, as you noted yourself:<br>
<p>
<font class="QuotedText">&gt; For GPUs, a maintainer can run [TEST!] a video game over Mesa (or run [TEST!] a pytorch ML model over ROCm). The inevitable alternative is to have broken drivers in the tree because either they couldn&#x27;t be tested</font><br>
<p>
I think a surprisingly number of kernel maintenance issues come down to a simple lack of consideration for test code.  For instance in this case if there were a requirement to provide some minimal test code and/or instructions as part of the &quot;line in the sand&quot; then this entire discussion would probably have not happened and this article not be written.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867731/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor867571"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2021 22:07 UTC (Thu)
                               by <b>alyssa</b> (guest, #130775)
                              [<a href="/Articles/867571/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
danvet and airlied are 100% right as usual -- upstream = FOSS. There is no such thing (rather, there shouldn&#x27;t be) as an upstream closed driver stack, and that is precisely what&#x27;s under discussion here.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867571/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867583"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 4:04 UTC (Fri)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/867583/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Right, and there are plenty of downstream git repos everywhere for anything that does not pass that bar.<br>
<p>
Spoilt with choice.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867583/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor867596"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 8:33 UTC (Fri)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/867596/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Seems like the DRM rule should apply to all the drivers in Linux that expose hardware-specific interfaces to userspace. Are there any where that doesn&#x27;t make sense?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867596/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867681"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2021 2:17 UTC (Sat)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/867681/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
None whatsoever; this should be the rule for every single driver.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867681/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor867685"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2021 9:46 UTC (Sat)
                               by <b>jezuch</b> (subscriber, #52988)
                              [<a href="/Articles/867685/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For me it is a tale of following the letter of the law while ignoring its spirit. All these companies are conveniently forgetting the fact that FOSS is a social contract in the first place. When you push shovelware (or any software which appears to be giving while giving nothing), even if you do everything according to the &quot;rules&quot;, you still make the FOSS community just an accessory. You&#x27;re not a member of that community, you&#x27;re treating it instrumentally. And it doesn&#x27;t matter one whit if it&#x27;s using one interface or the other or if it&#x27;s a GPU or any other type of device.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867685/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor867687"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2021 14:23 UTC (Sat)
                               by <b>moorray</b> (subscriber, #54145)
                              [<a href="/Articles/867687/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The mission of staging was pretty clear, and code-centric. Attracting vendors to stable trees was primarily a corporate success IMHO. Feels like what&#x27;s happening in the char-misc tree is a continuation of the downward “lets make corporations happy” trend. Did Greg ever publish a clear explanation? Maybe he should write it up as an LWN article, I&#x27;ve discussed it over email with him in the past but we all write 100 emails a day, that&#x27;s not conducive to solid philosophical disputes.<br>
<p>
This is not a discussion between peers, he’s #2 in the project. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867687/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor867717"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2021 7:55 UTC (Sun)
                               by <b>tchernobog</b> (guest, #73595)
                              [<a href="/Articles/867717/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
From the article:<br>
<p>
<font class="QuotedText">&gt; I do think the dri-devel merge criteria is very extreme, and effectively drives-out many AI accelerator companies that want to contribute to the kernel but can&#x27;t/won&#x27;t open their software IP and patents. </font><br>
<p>
Then the few remaining will have the advantage of working with Linux, which would make them succeed on the rather fundamental enterprise market. Frankly, I fail to see how this is not benefiting the community at large in the long run.<br>
<p>
I have yet to see these startup companies contribute large pieces of the Linux kernel. Mostly it has been hacks and tweaks to work around GPL restrictions, which are more harmful than not. The bulk of the work (outside the driver itself, which is company-specific) is still being done by others.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867717/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867861"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 31, 2021 15:00 UTC (Tue)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/867861/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; but can&#x27;t/won&#x27;t open their software IP and patents. </font><br>
<p>
If it&#x27;s going in the kernel, then it *shouldn&#x27;t* have got past the patent office.<br>
<p>
We need to bang that drum loud and hard ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867861/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor867721"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">&quot;Startup companies&quot; argument</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2021 8:55 UTC (Sun)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/867721/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Oded Gabbay seem to imply that AI startup companies should be treated differently. I really hope no-one will buy this.<br>
Besides, Habana Labs is not a startup anymore, it&#x27;s a part of Intel. <br>
Intel people should know better how Linux development works.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867721/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867730"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">&quot;Startup companies&quot; argument</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2021 18:54 UTC (Sun)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/867730/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
From <a href="https://lwn.net/Articles/817671/">https://lwn.net/Articles/817671/</a><br>
<p>
<font class="QuotedText">&gt; There is a tendency in these discussions to anthropomorphize large corporations. Which is dangerous, because it is grossly inaccurate to reality. A large corporation is difficult to steer from the top and impossible to steer from the bottom. ...</font><br>
<p>
Search keywords: <a href="https://www.google.com/search?q=site%3Alwn.net+anthropomorphize">https://www.google.com/search?q=site%3Alwn.net+anthropomo...</a><br>
<p>
<font class="QuotedText">&gt; Besides, Habana Labs is not a startup anymore, it&#x27;s a part of Intel.</font><br>
<p>
Another oversimplification. I don&#x27;t know about Habana specifically but in general: <a href="https://www.google.com/search?q=%22hands-off%22+merger">https://www.google.com/search?q=%22hands-off%22+merger</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867730/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867762"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">&quot;Startup companies&quot; argument</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2021 14:07 UTC (Mon)
                               by <b>joib</b> (subscriber, #8541)
                              [<a href="/Articles/867762/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In particular, you shouldn&#x27;t anthropomorphize Oracle: <a href="https://www.youtube.com/watch?v=-zRN7XLCRhc">https://www.youtube.com/watch?v=-zRN7XLCRhc</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867762/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor867749"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2021 8:06 UTC (Mon)
                               by <b>tamara_schmitz</b> (guest, #141258)
                              [<a href="/Articles/867749/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;m crossing the line!<br>
And I&#x27;m done holding back<br>
So look out, clear the track<br>
It&#x27;s my turn!<br>
I&#x27;m taking what&#x27;s mine!<br>
Every drop, every smidge<br>
If I&#x27;m burning a bridge<br>
Let it burn<br>
But I&#x27;m crossing the line!<br>
<p>
And for us, if we&#x27;re over<br>
That&#x27;s fine<br>
I&#x27;m crossing the line.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867749/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor868828"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2021 9:21 UTC (Fri)
                               by <b>scientes</b> (guest, #83068)
                              [<a href="/Articles/868828/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It is pretty clear that if you can&#x27;t run the software (without loading some binary blob), there is no reason it can or should be maintained, and anyone that accepts it is a fool.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868828/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor868875"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not-a-GPU accelerator drivers cross the line</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2021 15:31 UTC (Fri)
                               by <b>geert</b> (subscriber, #98403)
                              [<a href="/Articles/868875/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Habanalabs Open-Source TPC LLVM compiler and SynapseAI Core library<br>
<a href="https://lore.kernel.org/lkml/CAFCwf119s7iXk+qpwoVPnRtOGcxeuZb3rnihf6NWWoVT-4ODHA@mail.gmail.com">https://lore.kernel.org/lkml/CAFCwf119s7iXk+qpwoVPnRtOGcx...</a><br>
<p>
Thanks to LaF0rge and Thorsten Leemhuis for the reporting trail.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868875/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2021, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
