        <!DOCTYPE html>
        <html lang="en">
        <head><title>Tightening security: not for the impatient [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/503660/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/502982/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/503660/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Tightening security: not for the impatient</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ready to give LWN a try?</b>
<p>
With a subscription to LWN, you can stay current with what is happening in the Linux and free-software community and take advantage of subscriber-only site features.  We are pleased to offer you <b><a href="https://lwn.net/Promo/nst-trial/claim">a free trial subscription</a></b>, no credit card required, so that you can see for yourself.  Please, join us!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>June 27, 2012</br>
           </div>
It has often been said that memory management patches can take a long time
to be accepted into the mainline kernel.  Because memory management
performance regressions can take years to be discovered, developers
in this area have become highly conservative; making memory management
changes is not a recommended endeavor for those lacking patience.  But
there may be an area where progress can be even more glacial, for different
reasons.  Security-oriented changes are subject to arbitrary delays because
tighter security can break programs and irritate users.
<p>
Consider the classic symbolic link vulnerability, wherein an attacker fools
a privileged program into writing to a file behind an attacker-controlled
symbolic link.  Such vulnerabilities can be exploited to overwrite files
that the attacker would not otherwise have access to.  One does not have to
dig far into the <a href="/Vulnerabilities/">LWN vulnerability list</a> to
see that the identification and patching of symbolic link vulnerabilities
is an ongoing process.  One might think that, if somebody could come up
with a way to eliminate such vulnerabilities altogether, it would be
adopted in a hurry.
<p>
As it happens, Kees Cook <a href="/Articles/503671/">has a way</a> to deal
with this class of vulnerabilities.  It is based on the observations that
symbolic link vulnerabilities almost always involve links placed in
<tt>/tmp</tt>, and that <tt>/tmp</tt> has the "sticky" bit set in any
contemporary distribution.  Given that:
<p>
<div class="BigQuote">
	The solution is to permit symlinks to only be followed when outside
	a sticky world-writable directory, or when the uid of the symlink
	and follower match, or when the directory owner matches the
	symlink's owner.
</div>
<p>
In short, this change would make it so that nobody could create symbolic
links in <tt>/tmp</tt> and expect a privileged program to follow them.
Lest one think that Kees is taking credit for this concept, he posted a bit
of history for this idea, starting with <a
href="http://marc.info/?l=bugtraq&m=87602167419830&w=2">a 1996 Bugtraq
message</a> from Zygo Blaxell and <a
href="http://lkml.indiana.edu/hypermail/linux/kernel/9610.2/0086.html">a
kernel patch by Andrew Tridgell</a> from the same year.  This idea, in
other words, has been floating around for at least 16 years, but an
implementation 
has never found its way into the mainline kernel.  Memory management
changes are amazingly fast in comparison.
<p>
The reason for the resistance, of course, is that this is a change in
filesystem semantics.  There are concerns that it would break POSIX
compliance, though Kees claims that POSIX is silent on this particular
behavior.  Also of concern is the possibility of breaking existing
applications.  Kees responds that any broken applications would be easily
noticed (while those suffering from symbolic link vulnerabilities are not),
and that no applications relying on existing behavior have ever been
found.  There have also been disagreements over how the patch should be
implemented, but those have seemingly mostly been resolved.
<p>
So Kees thinks that his current <a href="/Articles/503676/">patch set</a>
(a variant of one we have <a href="/Articles/390323/">seen</a>
<a href="/Articles/472071/">before</a>)
should be considered for merging, finally.  The patches implement the
symbolic link restrictions, but also add a new rule for hard links: a hard
link to a file can only be created if the user owns the file or has write
access to it.  Once again, this change eliminates a class of attacks, but
at a small cost: older versions of the "at" daemon break unless a small
patch is applied.  No other problems have been found, Kees says, after 1.5
years of experience with this patch in the Ubuntu kernel.
<p>
Whether that is enough evidence to get the changes merged this time around
remains to be seen.  It has only been 16 years, after all, and one would
not want to be too hasty about such a thing.
<p>

Meanwhile, Kees has put together a separate security-oriented patch that
has run into some concerns of its own.  On Linux systems, there is a sysctl
knob (<tt>suid_dumpable</tt>) that controls whether a crashing setuid
process generates a core dump or not.  Setting it to a non-zero value
allows core dumps to happen; setting it to two applies certain restrictions
that are intended to make it safe.  But, Kees says, that's not the case; it
allows a user to create a file called <tt>core</tt> in almost any
directory, containing arbitrary text (environment strings, for example).
This capability is not necessarily as harmless as one might think; as <a
href="/Articles/191080/">the 2006 cron vulnerability</a> shows, some
programs will happily pick out the strings they understand in a file full
of junk, happily
ignoring the rest.  Thus, he claims, allowing users to create files in
arbitrary locations is asking for trouble.
<p>
His response has been through a number of iterations:
<p>
<ul>
<li> <a href="/Articles/503678/">Version 1</a> disallowed storing 
     core dumps from privileged executables into a file.  If the
     <tt>core_pattern</tt> knob is set to a pipe, instead, core dumps
     happen as before.  This was seen as an incompatible ABI change,
     though, and one that would cause surprising results.
<p>
<li> <a href="/Articles/503680/">Version 2</a> added a new setting (3) that
     would only allow setuid core dumps to a pipe.  The previous "safe"
     setting (2) was deprecated; attempting to set it would fail with an
     EINVAL error.  This version ran into trouble as a result of how it
     interacted with the sysctl mechanism.
<p>
<li> <a href="/Articles/503315/">Version 3</a> fixed the sysctl
     difficulties but was opposed by Andrew Morton, who feared that the
     deprecation of the previous mode would break current systems in
     surprising ways.  He suggested keeping <tt>suid_dumpable=2</tt> as a
     working mode with a warning.
<p>
<li> <a href="/Articles/503681/">Version 4</a> went back to something
     closer to version&nbsp;1, but with some loud warnings emitted.  But
     then Eric Biederman asked whether disallowing relative paths would be
     a sufficient fix.
<p>
<li> Thus, <a href="/Articles/503682/">version 5</a> (the current version,
     as of this writing), just disallows the writing of setuid core dumps
     to relative paths.  Should <tt>core_pattern</tt> be set to a relative
     path ("<tt>core</tt>", for example), a warning will be logged instead.
</ul>
<p>
Thus far, there has not been much in the way of complaints about the fifth
iteration of the patch.  So, possibly, it will not be necessary to wait for
years until this particular bit of security tightening gets into the
mainline kernel.  Of course, unlike the system's link behavior, the core
dump behavior can be changed now by concerned system administrators—no need
to wait at all.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security">Security</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Symbolic_links">Symbolic links</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Linux_kernel">Linux kernel</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/503660/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor503983"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 28, 2012 14:30 UTC (Thu)
                               by <b>ortalo</b> (guest, #4654)
                              [<a href="/Articles/503983/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Time and patience is one aspect of the issue of course. However, it seems to me that this aspect is also a consequence of design priorities.<br>
<p>
 Should you pointing these very long delays of elementary improvements lead us to think that reconsidering the priority of security with respect to other issues in the overall development would be desirable?<br>
<p>
 If that's the case, you have my full support - even though it also seems to me that nowadays the security of user-level programs is becoming the urgent issue.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/503983/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor504004"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 28, 2012 15:31 UTC (Thu)
                               by <b>david.a.wheeler</b> (subscriber, #72896)
                              [<a href="/Articles/504004/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <p>
Congrats to Kees Cook, who patiently managed to get this in.
</p>
<p>
But the slow pace of getting security-tightening mechanisms into the kernel is embarrassing.
</p>
<p>
It's absurd to wait until "all applications as libraries are perfect" as a security strategy.  We need a "plan B".  A kernel cannot prevent all errors from becoming security vulnerabilities, but where the kernel can reasonably prevent them or reduce their effects, it should do so.
</p>
<p>
We should be making security-tightening measures a high priority, not something that's done as a last resort.  We should be <i>searching</i> for those mechanisms, not trying to prevent their inclusion.
</p>

      
          <div class="CommentReplyButton">
            <form action="/Articles/504004/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor504242"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 29, 2012 14:50 UTC (Fri)
                               by <b>spender</b> (guest, #23067)
                              [<a href="/Articles/504242/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; We should be searching for those mechanisms</font><br>
<p>
For those without horse blinders:<br>
<a href="http://www.grsecurity.net/">http://www.grsecurity.net/</a><br>
<p>
Kick your shoes off, prop your feet up, and have a margarita or two.  Reward yourself for a job well done!<br>
<p>
-Brad<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/504242/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor504324"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 29, 2012 19:14 UTC (Fri)
                               by <b>utoddl</b> (guest, #1232)
                              [<a href="/Articles/504324/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      Okay, I have no familiarity with grsecurity, but that their entire site seems to be php based made me wince a little.
      
          <div class="CommentReplyButton">
            <form action="/Articles/504324/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor504383"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 30, 2012 1:31 UTC (Sat)
                               by <b>spender</b> (guest, #23067)
                              [<a href="/Articles/504383/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I suppose you prefer the OpenBSD camp and their "security through complete lack of features"?  What kind of security system would it be if it couldn't withstand running the same software nearly everyone else does?<br>
<p>
Regardless, it seems to be working out a lot better for us than whatever kernel.org has been running ;)<br>
<p>
It's clear you have no familiarity with grsecurity: having your head in the sand for a decade speaks volumes about your security knowledge.<br>
<p>
Not really sure why people like yourself feel the need to reply publicly just to expose your own ignorance to the world.<br>
<p>
-Brad<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/504383/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor504517"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 1, 2012 11:52 UTC (Sun)
                               by <b>roblucid</b> (guest, #48964)
                              [<a href="/Articles/504517/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
grsecurity has been offered by some distro's and not others, so the original point made in comment was reasonable; it does not have universal acceptance.  There are often competing approaches and implementations of ideas, some developers work better with the LKML community than others so tend to have code accepted where others have failed.<br>
<p>
The last sentence was not necessary, a personal comment detracting from the technical point point.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/504517/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor504521"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 1, 2012 12:40 UTC (Sun)
                               by <b>spender</b> (guest, #23067)
                              [<a href="/Articles/504521/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You should look again at the comment I was actually replying to (it seems you paired it up with a different one).  If you think *that* idiotic one-liner was "reasonable", more power to you.<br>
<p>
-Brad<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/504521/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor504529"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 1, 2012 14:35 UTC (Sun)
                               by <b>man_ls</b> (guest, #15091)
                              [<a href="/Articles/504529/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Granted, the one-liner was a bit misleading; the same comment could have been made for many other things and be equally meaningless. Just for fun:
<blockquote>
I have no familiarity with github, but that their entire site seems to be Rails-based made me wince a little.<br>
I have no familiarity with Red Hat, but that their entire distro seems to be Linux-based made me wince a little.<br>
I have no familiarity with eBay, but that their entire site seems to be IIS-based made me wince a little.
</blockquote>
(The last one made me wince too, but hey.)
<p>
Anyway I think you (Brad Spender) can do better than insult someone in public. This kind of derision tells more about you than about the original poster.
      
          <div class="CommentReplyButton">
            <form action="/Articles/504529/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor506424"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 11, 2012 21:21 UTC (Wed)
                               by <b>BenHutchings</b> (subscriber, #37955)
                              [<a href="/Articles/506424/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
spender doesn't want distributions to package grsecurity, as its security improvements might be compromised by other patches they apply. I am quite happy to oblige him in this regard.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/506424/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor506493"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 12, 2012 12:26 UTC (Thu)
                               by <b>spender</b> (guest, #23067)
                              [<a href="/Articles/506493/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ben seems to be referring to my only public comment on the Debian list regarding packaging grsecurity.  For the others reading, here's my comment in its entirety:<br>
<a href="http://lists.debian.org/debian-kernel/2012/01/msg01165.html">http://lists.debian.org/debian-kernel/2012/01/msg01165.html</a><br>
<p>
Anyone is free to do what they want, of course.  I just don't recommend the use of such kernels, as over the years I've noticed several things:<br>
<p>
1) Our development is very active, yet any 3rd-party packaging has always lagged (often quite badly).  In fact just yesterday I had someone on the forums waste my time trying to get help compiling his "grsecurity" kernel that turned out to be a 2 year old Debian source of it.<br>
2) Security isn't obtained by lifting individual features, and you can't just toss some code into a codebase and claim it works as intended just because it applies cleanly.  I'll be giving a talk in October at H2HC where in part I'll talk about some security features that were ripped from grsecurity and submitted upstream, then neglected to the point where they no longer do what they claim.<br>
3) When it comes to security features, I argue the same as in Plato's "Ion", that a security researcher with kernel development experience would know best how it should be merged to preserve its integrity.  Not a kernel developer lacking security knowledge, and definitely not someone just testing to see if two codebases compile when merged.<br>
<p>
I don't think any of the above is unreasonable.  BTW, instead of making snide remarks, might your time be better served backporting some more missing security fixes to 3.2? ;)<br>
<p>
-Brad<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/506493/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor506629"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 13, 2012 1:36 UTC (Fri)
                               by <b>BenHutchings</b> (subscriber, #37955)
                              [<a href="/Articles/506629/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>In fact just yesterday I had someone on the forums waste my time trying to get help compiling his "grsecurity" kernel that turned out to be a 2 year old Debian source of it.</blockquote>
<p>Not an official Debian package, of course.</p>
<blockquote>BTW, instead of making snide remarks, might your time be better served backporting some more missing security fixes to 3.2? ;)</blockquote>
<p>My remark was intended more as a joke that it's very easy to satisfy people who want me (or rather us) not to work on something. Less funny when it has to be explained, I suppose. As for backporting security fixes, I try, but surely you consider me incompetent to do so?</p>

      
          <div class="CommentReplyButton">
            <form action="/Articles/506629/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor506632"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 13, 2012 2:45 UTC (Fri)
                               by <b>spender</b> (guest, #23067)
                              [<a href="/Articles/506632/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In that case, sorry -- I shouldn't have assumed.  FWIW you do a good job backporting with much attention to detail.  My comments were more about merging of security features as opposed to fixes for a particular bug.  Features generally require ongoing maintenance and re-evaluation.<br>
<p>
-Brad<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/506632/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor512632"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 21, 2012 7:46 UTC (Tue)
                               by <b>reddit</b> (guest, #86331)
                              [<a href="/Articles/512632/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
These guys should work on pushing their changes into the mainline kernel.<br>
<p>
Which means doing them properly in such a way that they don't impact performance, functionality or compatibility.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/512632/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor512659"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 21, 2012 10:55 UTC (Tue)
                               by <b>dark</b> (guest, #8483)
                              [<a href="/Articles/512659/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Well, that definition of 'properly' puts security in fourth place. It makes it an afterthought. Something that's nice to have as long as it doesn't impact the important stuff. I don't think it's likely that people who put security in <i>first</i> place are going to do their work that way.

      
          <div class="CommentReplyButton">
            <form action="/Articles/512659/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor512781"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: Time to prioritize it!!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 21, 2012 19:34 UTC (Tue)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/512781/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
for people who put security first, ahead of everything else, there is really only one solution<br>
<p>
<a rel="nofollow" href="http://www.ranum.com/security/computer_security/papers/a1-firewall/index.html">http://www.ranum.com/security/computer_security/papers/a1...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/512781/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor504987"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 3, 2012 22:01 UTC (Tue)
                               by <b>ScottMinster</b> (subscriber, #67541)
                              [<a href="/Articles/504987/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <blockquote><i>a hard link to a file can only be created if the user owns the file or has write access to it</i></blockquote>

<p>This doesn't sound too good.  Where I work, we have applications that regularly create hard links to files just for reading.  The reason we do this is in case the file is replaced by a new version while it is being read.  This shouldn't be a problem on most file systems, but NFS has given us trouble in the past, and we're often using NFS filesystems.</p>

<p>The code follows the pattern of link(), open(), and unlink().  The NFS server will keep the unlink'ed file, and more importantly the NFS key (or whatever its called) around so the original file's contents can be read, even if the file is replaced with a new version (through writing to a temporary file and renaming).</p>

<p>While the code is robust enough to fallback on opening the original file instead of a temporary link if it cannot make the link (often happens if the directory itself is not writable), it would be annoying to lose this feature.  We've had weird race conditions in the past on NFS without this logic.</p>

<p>Perhaps link() should be allowed to work if the user has read or write access to the file?  Making a hard link to a file that cannot be read by the current user does seem to have little purpose.</p>

      
          <div class="CommentReplyButton">
            <form action="/Articles/504987/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor506425"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 11, 2012 21:30 UTC (Wed)
                               by <b>BenHutchings</b> (subscriber, #37955)
                              [<a href="/Articles/506425/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>Perhaps link() should be allowed to work if the user has read or write access to the file? Making a hard link to a file that cannot be read by the current user does seem to have little purpose.</blockquote>
<p>If a setuid executable turns out to be exploitable, the sysadmin will (hopefully) upgrade it to a fixed version quickly. But in some filesystem configurations a malicious user could use hard links to make 'backups' of setuid executables in the expectation that one of them would later turn out to be exploitable. The hard link restrictions prevent this.</p>

      
          <div class="CommentReplyButton">
            <form action="/Articles/506425/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor506434"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 11, 2012 22:44 UTC (Wed)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/506434/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; ... in some filesystem configurations a malicious user could use hard links to make 'backups' of setuid executables in the expectation that one of them would later turn out to be exploitable.</font><br>
<p>
Some other reasonable workarounds for this issue would be to clear the setuid bit before replacing a setuid executable, to restrict setuid executables to a dedicated filesystem with no non-superuser write access, or to prevent creating links to files with setuid enabled.<br>
<p>
Or we could drop setuid entirely and go with something more like PolicyKit, which isn't affected by hard links, thus making the root -&gt; user transition a one-way street.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/506434/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor506485"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 12, 2012 11:06 UTC (Thu)
                               by <b>philomath</b> (guest, #84172)
                              [<a href="/Articles/506485/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Disabling links to suid files seems very reasonable, and will most probably break nothing sane.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/506485/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507034"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2012 9:29 UTC (Tue)
                               by <b>nlucas</b> (guest, #33793)
                              [<a href="/Articles/507034/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It might break current busybox installations. Multiple suid binaries are linked to the same binary.<br>
<p>
But I agree with you that it's a reasonable breakage.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507034/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507060"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 17, 2012 15:18 UTC (Tue)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/507060/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That should still work, so long as you create the links _before_ marking the binary as SUID. You could look at the reference count to ensure that there are no "rogue" links at that point. Once it's marked SUID, no new hard links could be created without first clearing the SUID bit.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507060/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507672"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2012 23:41 UTC (Fri)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/507672/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I seem to have run across the problem that hardlinked files all shared the same permissions. Are the tests we ran for that missing something or is it just suid that is special?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507672/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507701"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2012 11:30 UTC (Sat)
                               by <b>anselm</b> (subscriber, #2796)
                              [<a href="/Articles/507701/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <p>
Hard-linked files do share the same permissions – permissions are stored on the file's inode and hard links are just extra directory entries that point to the same inode.
</p>
<p>
Linux will not let you create a hard link to an executable file that is marked suid but doesn't belong to you. Making hard links to a file that you own yourself is fine regardless of whether that file is suid or not, and does not impinge on the suid status of the file.
</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/507701/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507712"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2012 16:55 UTC (Sat)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/507712/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Okay, so why make the binary SUID after hardlinking? Since that makes *every* one of those binaries SUID now. If it's something like toybox, I don't want sed to be SUID even if mount is hardlinked to it. Seems like there's a case for having a separate SUID instance that those programs link to.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507712/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507789"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2012 13:15 UTC (Mon)
                               by <b>nlucas</b> (guest, #33793)
                              [<a href="/Articles/507789/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The busybox project is well is aware of that and recomends a different busybox binary for suid and regular binaries.<br>
<p>
It's easy enough to build a busybox binary implementing only the suid utils (as is to not include the suid utils on the regular binary).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507789/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor505211"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 5, 2012 2:18 UTC (Thu)
                               by <b>kevinm</b> (guest, #69913)
                              [<a href="/Articles/505211/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's correct that the symlink behaviour change doesn't violate POSIX, because it's limited to directories with the sticky bit set and the sticky bit isn't specified by POSIX at all.<br>
<p>
The hardlink behaviour change would though, unless it too is limited to directories with the sticky bit set - is that the case?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/505211/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor505665"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 6, 2012 19:49 UTC (Fri)
                               by <b>mfedyk</b> (guest, #55303)
                              [<a href="/Articles/505665/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Since most filesystems do not have a reverse reference from inode to dirents that point to them, you would either have to do a directory tree walk or hope it's already cached in the dcache, which would lead to immeasurable amounts of fun.  That, or it would depend on which dirent was used to look up the inode.<br>
<p>
No, this hard link change could not be related to directory sticky bit because multiple directories could point to the same inode (hard links).<br>
<p>
That said, it would be acceptable IMO if it was activated with a mount option.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/505665/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor505899"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 9, 2012 3:55 UTC (Mon)
                               by <b>kevinm</b> (guest, #69913)
                              [<a href="/Articles/505899/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's not the director(ies) where the current links are that matter, it's the directory where the new link is being created that should have to be sticky for the new rules to apply.<br>
<p>
It even makes sense, because in a sticky directory you can create hardlinks that you can't then remove, but the same isn't true of nonsticky directories.<br>
<p>
It's also unambiguous, and the destination directory of the link already has to be looked up to create the link.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/505899/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor506429"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tightening security: not for the impatient</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 11, 2012 21:31 UTC (Wed)
                               by <b>BenHutchings</b> (subscriber, #37955)
                              [<a href="/Articles/506429/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
POSIX also allows pretty much any operation to be denied due to security policy.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/506429/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2012, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
