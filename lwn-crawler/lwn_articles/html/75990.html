        <!DOCTYPE html>
        <html lang="en">
        <head><title>A new Adore root kit [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/75990/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/75288/">Return to the Security page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/75990/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>A new Adore root kit</h1>
<div class="Byline">[Posted March 17, 2004 by corbet]
               <p>
               </div>
</div>
<div class="ArticleText">
For your cracking pleasure: a new version of the Adore root kit has been <a
href="/Articles/75991/">announced</a>.  This code is, of course, "for
educational purposes only."  On the notion that it's best to look at code
like this when one has downloaded it explicitly, rather than when one has
found it on one's system, we grabbed a copy.
<p>
Adore is a kernel module which is intended to give a cracker the full run
of a compromised system without detection.  To that end, it installs itself
into several key parts of the kernel and lurks until somebody comes along
who knows the right "key," where a key is a special process ID.  If you do
not know this key, finding signs of an Adore installation will be
difficult, to say the least.
<p>
The module starts by hooking itself into various filesystems.  It digs up
the inode for the root filesystem, and replaces that inode's
<tt>readdir()</tt> function pointer with one of its own.  The Adore version
performs like the one it replaces, except that it hides any files owned by
a specific user and group ID.  If you are a Black Hat trying to keep
installed files out of the eye of the system administrator, this is the way
to do it.
<p>
Similarly, Adore hooks itself into the lookup function for <tt>/proc</tt>.
An attempt to read <tt>/proc/KEY</tt>, where <tt>KEY</tt> is a predefined
key value, will give the current process the ability to access other Adore
functions.  A process which has been "authenticated" in this way can then,
by accessing other special <tt>/proc</tt> filenames, give itself full root
privileges or tell Adore to hide other processes from view.  The module
keeps a list of such processes; once a process appears in that list, it
will never appear in <tt>/proc</tt>, and thus it will not by displayed by
utilities like <tt>ps</tt> or <tt>top</tt>.  The only way to find such
processes, it would seem, would be to dig through the entire kernel task
list and check to see if any of them are not represented in <tt>/proc</tt>.
<p>
People who crack into systems may well want to run network services on
those systems.  To cater to their needs, Adore replaces the
<tt>show()</tt> function for <tt>/proc/net/tcp</tt>; the new version edits
out any connections involving ports that the person installing Adore would
rather others didn't know about.  A hidden server process, running from a
hidden executable, and sitting behind a
hidden port could be very hard for a system administrator to find.
<p>
For good measure, Adore will also filter out entries made into files like
<tt>/var/log/utmp</tt> or syslog on behalf of hidden processes.
<p>
The one thing Adore does not do is hide itself; it will show up in the list
of loaded kernel modules.  To address that, a separate module called
"cleanup" is provided.  If cleanup is loaded immediately after Adore, it
will patch Adore out of the list of loaded modules, thus hiding it
altogether. 
<p>
All of this functionality has been implemented in a kernel module which is
a mere 600 lines long.  This module is scary; it is a living demonstration
of what an attacker can do once he gets root access on a system.  A careful
attacker could, using this module, maintain undetected control of a
compromised system indefinitely.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Adore_root_kit">Adore root kit</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security">Security</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/75990/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor76209"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 2:13 UTC (Thu)
                               by <b>mikeraz</b> (guest, #155)
                              [<a href="/Articles/76209/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      What can we look forward to?  It seems the only way to detect an Adore compromised system would be through a Nessus, or other port scanning tool, port scan detecting open ports.  But if the Adore designers were to implement port knocking they could hide from that detection method also.   Detection of a compromise would be very difficult then.
      
          <div class="CommentReplyButton">
            <form action="/Articles/76209/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor76263"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 11:56 UTC (Thu)
                               by <b>fergal</b> (guest, #602)
                              [<a href="/Articles/76263/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      What would be needed is a &quot;reverse port scanner&quot;. Something that runs on the machine and attempts to bind to address:port for every address and port on the machine. The secret port will show up as already in use.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/76263/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor76371"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 17:28 UTC (Thu)
                               by <b>RobSeace</b> (subscriber, #4435)
                              [<a href="/Articles/76371/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I loved your idea so much, I whipped up just such a thing as a quick Perl
script: <A HREF="http://www.magrathea.com/~ras/misc/rpscan">http://www.magrathea.com/~ras/misc/rpscan</A>... ;-)
<p>
Perl isn't my strongest language (I usually write pure C code), but it seemed
like the best bet for such a quick and dirty task...  But, any strong Perl
coders, forgive any obvious mistakes on my part... ;-)
      
          <div class="CommentReplyButton">
            <form action="/Articles/76371/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor76451"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 19, 2004 4:00 UTC (Fri)
                               by <b>xorbe</b> (guest, #3165)
                              [<a href="/Articles/76451/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Not if the module doesn't bind to the port until it sees the secret knock goes by.  That's the whole point...
      
          <div class="CommentReplyButton">
            <form action="/Articles/76451/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor76981"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 24, 2004 6:38 UTC (Wed)
                               by <b>jzbiciak</b> (guest, #5246)
                              [<a href="/Articles/76981/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Won't it at least have to bind to the first port of the &quot;knocking&quot; sequence?
      
          <div class="CommentReplyButton">
            <form action="/Articles/76981/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor78822"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2004 0:30 UTC (Sat)
                               by <b>alterself</b> (guest, #1746)
                              [<a href="/Articles/78822/">Link</a>] 
      </p>
      
      </div>
      </summary>
      The idea is not that you bind to the port... but that you log attempts to open the port.<p>On a normal tcp/ip stack... the stack sends a request denied on attempts to open closed ports. I would imagine that if the module tied into the tcp/ip stack, it could monitor for attempts to open a specific set of ports...
      
          <div class="CommentReplyButton">
            <form action="/Articles/78822/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor76436"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Port knocking</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 19, 2004 1:24 UTC (Fri)
                               by <b>AnswerGuy</b> (guest, #1256)
                              [<a href="/Articles/76436/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <br> If the attacker wants to run a custom service (not some commodity like a warez FTP or IRC node) then he can use a &quot;port knocker&quot; to obscure it from scanning.  Basically the ports appear closed but some magic sequence of packets (could be anything that the port knocker module will see, including DNS response packets from a magic source address, think of an ipchains rule that logs such packets and a tail -f script that monitors the logs for them, then opens the port for a limited time and possibly to a limited address. --- now just hide that a little better.  Presto! port knocker!)<p>  Of course they can run any service on any port using this technique, it's<br> just that the clients have to have the right &quot;knocker client&quot; script (generally  just something for netcat, socat, or perl's net libraries).  They have to know the &quot;secret knock&quot; (Shave and a haircut ...)<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/76436/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor76437"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SNORT or Prelude NIDS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 19, 2004 1:42 UTC (Fri)
                               by <b>AnswerGuy</b> (guest, #1256)
                              [<a href="/Articles/76437/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <br> I hate to respond to my own post but I forgot something that I'd<br> intended to say (hit the preview/submit buttons a little too quick)<p> This is one of the best reasons to run a tight SNORT Prelude <br> configuration.  The default NIDS code is sort of like virus scanners<br> in that they only tell you about KNOWN attack signatures.   However,<br> you can make a SNORT configuration that's more like a checksum<br> integrity tool (like Tripwire, AIDE or Samhain, only for net traffic).<p> Basically you have to be able to characterize, in detail the proper<br> and expected behavior of the protected system(s).  A profile<br> of everything it should be allowed to do on the net.  For example a<br> web server might need: <p> Inbound: <br>   dst port 80 or 443 from anywhere, <br>   dst port NTP from (list of three to give NTP peers), <br>   dst port SSH from (list of two or three sysadmin workstations<br>     and/or staging servers)<br>   dst port SNMP from (list of NMS systems)<br> Outbound:<br>   dst port any from port 80 or 443 (http and https)<br>   dst port CVS (perhap for automated checkout of new changes<br>      which are checked in by webmasters, web authors, programmers, etc.<br>   dst port DNS to (list of internal name servers) (for reverse lookup?)<p> ... and so on.<p> Once done properly ANY traffic that doesn't fit these rules will<br> be an alert on the NIDS (network intrusion detection system).<br> (Unless it also exploits a bug in your NIDS, which is hopefully <br> pretty hard to do these days).<p> Of course this sort of Draconian/totalitarian configuration is only<br> suitable for highly specialized servers.  The more services running<br> on a machine the harder it is to characterize it's traffic.  For most<br> client systems (workstations) ... FORGET IT!<p> I hope its clear why this works better than looking for bad traffic.<br> Here we look for &quot;not good traffic.&quot;  (Similarly one of the first<br> rules of secure and robust programming for parsers is that it's better<br> to suppy a list of known innocuous characters, tokens whatever, then<br> to attempt to filter out a list of &quot;suspects&quot;).<p>JimD
      
          <div class="CommentReplyButton">
            <form action="/Articles/76437/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor76221"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">urgh</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 3:27 UTC (Thu)
                               by <b>mattdm</b> (subscriber, #18)
                              [<a href="/Articles/76221/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      I'm no kernel hacker, but it seems like something like this would be a good thing:<p>In /etc somewhere, have a file containing checksums of modules which are allowed to be loaded in the kernel. Then, some kernel mechanism to read this file _once_ -- and once read, make it impossible to add to the list without a reboot.<p>This would be far from perfect protection, but seems like it'd provide another layer of protection -- the attacker would have to reboot the system, which is at least noticable.<p>It'd also be kind of a pain for third-party drivers, but....
      
          <div class="CommentReplyButton">
            <form action="/Articles/76221/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor76224"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Allowed modules list</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 3:32 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/76224/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      If you're really concerned, a better solution is to link everything you need into your kernel and disallow modules altogether.  A weaker alternative is to load your modules at boot time, then disable module loading via the <a href="http://lwn.net/1999/1202/kernel.php3">capability bounding set</a>.
<p>
In either case, however, you must contend with the fact that it is still possible to patch code into the kernel without loading a module via <tt>/dev/mem</tt>.
      
          <div class="CommentReplyButton">
            <form action="/Articles/76224/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor76229"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Allowed modules list</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 4:12 UTC (Thu)
                               by <b>mattdm</b> (subscriber, #18)
                              [<a href="/Articles/76229/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Hmmm, yeah, I vaguely remember reading about that. <p>So, is some sort of hardware-based code signing really the only thing that can be done? Other than &quot;don't let bad people get root&quot;, of course.
      
          <div class="CommentReplyButton">
            <form action="/Articles/76229/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor76230"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Allowed modules list</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 4:19 UTC (Thu)
                               by <b>mebrown</b> (subscriber, #7960)
                              [<a href="/Articles/76230/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Compile out support for /dev/mem?<p>or, <p>Arjan has patches for 2.6 in the RH kernel that allow access through /dev/mem to only the first 1MB of memory (for tools that look at BIOS info, eg SMBIOS), and non-RAM memory (X drives PCI cards using IO through /dev/mem).<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/76230/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor76239"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Allowed modules list</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 7:01 UTC (Thu)
                               by <b>sweikart</b> (guest, #4276)
                              [<a href="/Articles/76239/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <pre>>In either case, however, you must contend with the fact that it is still 
>possible to patch code into the kernel without loading a module via /dev/mem.

To block access through /dev/mem, just drop the sys_rawio capability.  [You
might even be able to drop sys_rawio after starting X; I've only dropped it 
on servers.]

Some good references are:
   http://lwn.net/1999/1202/kernel.php3
   http://lwn.net/2000/0629/backpage.php3  # Subject: disabling module loading 
</pre>
      
          <div class="CommentReplyButton">
            <form action="/Articles/76239/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor76248"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Allowed modules list</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 9:22 UTC (Thu)
                               by <b>eru</b> (subscriber, #2753)
                              [<a href="/Articles/76248/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <i>If you're really concerned, a better solution is to link everything you need into your kernel and disallow modules altogether.</i>
<p>
But I recall that some time ago LWN (or possibly some other Linux web page, not sure) reported discussions among kernel developers about deprecating the making of statical kernels altogether. Did that already happen with 2.6? Is it likely to happen?
<p>
Anyway, this solution is not quite feasible for most ordinary users: configuring the kernel with its hundreds of options is tedious, and I have found it can be difficult to decide what drivers or features can be disabled safely. The result is also less flexible when new hardware is installed. So I do not think the statical kernel a very practical solution for most users. Other alternatives are needed for securing against rootkit modules..

      
          <div class="CommentReplyButton">
            <form action="/Articles/76248/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor76261"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Allowed modules list</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 11:31 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/76261/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>
Anyway, this solution is not quite feasible for most ordinary users: configuring the kernel with its hundreds of options is tedious, and I have found it can be difficult to decide what drivers or features can be disabled safely. The result is also less flexible when new hardware is installed. So I do not think the statical kernel a very practical solution for most users.
</blockquote>

This may well be true for general-purpose systems (although I haven't found it so), but firewalls, at least, can run with module support removed (no matter what their hardware: if necessary, run the firewall as a UML instance with no module support. UML's not *quite* secure, and won't be until lcall syscalls can be virtualized, but it's damned close.)
      
          <div class="CommentReplyButton">
            <form action="/Articles/76261/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor76314"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What protection does module versioning provide?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 13:21 UTC (Thu)
                               by <b>rankincj</b> (guest, #4865)
                              [<a href="/Articles/76314/">Link</a>] 
      </p>
      
      </div>
      </summary>
      How would the attacker arrange for the module to get silently reloaded after a reboot? Wouldn't they need to hook something into your init scripts somehow? And what happens when you upgrade or recompile your kernel? You may be able to force an insmod of Adore's modules, but there's no guarantee that they would still work.
      
          <div class="CommentReplyButton">
            <form action="/Articles/76314/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor76420"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Allowed modules list</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 22:24 UTC (Thu)
                               by <b>LogicG8</b> (guest, #11076)
                              [<a href="/Articles/76420/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      A list of allowed modules won't help much if<br>a user has root privileges. With any *nix once<br>root is obtained the system is completely<br>comprimised.<p>For those interested in patching the kernel w/o LKM<br>http://www.phrack.org/phrack/58/p58-0x07
      
          <div class="CommentReplyButton">
            <form action="/Articles/76420/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor76438"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Allowed modules list</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 19, 2004 1:40 UTC (Fri)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/76438/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <i>A list of allowed modules won't help much if
a user has root privileges.
</i>
<p>It would if you implemented the rest of the proposal, which was to make the kernel not allow updating of this list by anyone.  It was, of course, left vague how you might design something like that.

<p><i>With any *nix once
root is obtained the system is completely
compromised.
</i>
<p>That's very on-point.  It's why the best reaction to this type of threat is to make it harder to "obtain root," by making "root" far less pervasive in a system.
<p>
Linux took steps toward this long ago by replacing the traditional Unix concept of superuser/not superuser with a set of fine grained capabilities.  As has been pointed out, if you had every one except CAP_SYS_MODULE, you would not be able to install Adore.  And if only processes that needed CAP_SYS_MODULE had CAP_SYS_MODULE, it would be next to impossible for the cracker to find one that he can trick into loading Adore.
<p>
It isn't customary on Linux systems to manipulate individual capabilities, but it should be.
<p>
For that matter, there's still a whole lot of code running with full capabilities that doesn't need any of them at all.  I.e. it should "drop root."
<p>
One thing I don't know the status of: capabilities assigned to executables.  Last I saw, if you need a privileged program, you have to make it setuid/owner 0 and then whoever executes it gets ALL capabilities.  We need to do better than that.

      
          <div class="CommentReplyButton">
            <form action="/Articles/76438/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor76440"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LIDS, SELinux, etc</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 19, 2004 1:51 UTC (Fri)
                               by <b>AnswerGuy</b> (guest, #1256)
                              [<a href="/Articles/76440/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <br> It's not quite true that root-compromised systems *have* to be<br> inherently, persistenly compromised.  It's CLOSE to true; but<br> some features in LIDS and SELinux could protect a well configured system<br> even from a rogue root process.  These patches work by limiting root's<br> power and imposing additional authentication/authorization measures for<br> some operations.<p>JimD
      
          <div class="CommentReplyButton">
            <form action="/Articles/76440/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor107973"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Allowed modules list</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 25, 2004 0:44 UTC (Mon)
                               by <b>jcm</b> (subscriber, #18262)
                              [<a href="/Articles/107973/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Hi all,<br>
<p>
It's worth noting that the issue of signed modules has recently cropped up in a debate on lkml. It looks as though something will eventually go mainstream - but what form it'll take is still subject to list wrangling.<br>
<p>
Cheers,<br>
<p>
Jon.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/107973/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor76439"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Signed modules, &quot;Sealed&quot; mode  etc</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 19, 2004 1:46 UTC (Fri)
                               by <b>AnswerGuy</b> (guest, #1256)
                              [<a href="/Articles/76439/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <br> There are various patches such as LIDS and (DSIGN?) that limit<br> allowed modules or &quot;seal&quot; the kernel after boot and refuse to let<br> modules load or do digital signature checks before linking into<br> loadable modules.  (The capability bounding set is a coarse grained<br> measure in this direction --- but it's the only one in a stock<br> kernel).<p> There are many countermeasures to each of the steps that any<br> rootkit takes.  Of course they must be deployed before the<br> compromise! :(<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/76439/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor104933"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">urgh</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2004 13:25 UTC (Mon)
                               by <b>arafel</b> (guest, #18557)
                              [<a href="/Articles/104933/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Give someone sufficient privileges to load a kernel module, and I can guarantee that, if they really want, it will be loaded one way or the other. Bear in mind that any code which you can write to check for an 'allowed' module list can simply be changed to always return 'yes, that module is okay'.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/104933/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor76256"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">disabling /dev/mem</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 10:24 UTC (Thu)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/76256/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      One of the caveats of disabling /dev/mem was that lsof  <br>did not work anymore. Is there any workaround available ? 
      
          <div class="CommentReplyButton">
            <form action="/Articles/76256/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor104524"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">disabling /dev/mem</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2004 13:58 UTC (Thu)
                               by <b>jhs</b> (guest, #12429)
                              [<a href="/Articles/104524/">Link</a>] 
      </p>
      
      </div>
      </summary>
      The workaround is, lsof is a troubleshooting tool, like tcpdump.  It should not be on a production system.  If you have a problem, use lsof on your test environment until you fix the bug.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/104524/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor76262"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 11:53 UTC (Thu)
                               by <b>copsewood</b> (subscriber, #199)
                              [<a href="/Articles/76262/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Presumably hidden files would show up if the system is booted using a trusted kernel and the file system scanned with a scanner that knows where to look for them and what to look for ? I seem to remember having to do this reliably to detect MSDOS infection by certain viruses a few years ago. The problems with this approach are a bit of routine downtime while you run this kind of thing, maintaining separation between the potentially compromised and trusted scanning environments, and keeping malware scanning software up to date. Alternatively if the evidence is on the disk and the same disk can be simultaneously mounted read-only using another otherwise isolated system a similar security scan could be done without downtime. This will probably be followed by versions which remove themselves from disk when they load themselves into memory, and resave themselves to disk when the systems shut down.<p>So I guess other defences might have to involve virtualising the environment and running this within a sandbox continually monitored for known attack signatures.<p>These precautions all put up the cost of running computing environments which retain similar levels of reasonable trust prior to discovery of this kind of technique.
      
          <div class="CommentReplyButton">
            <form action="/Articles/76262/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor76441"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Clean boot scans, chkrootkit, and RAID Hotswap For FIDS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 19, 2004 1:59 UTC (Fri)
                               by <b>AnswerGuy</b> (guest, #1256)
                              [<a href="/Articles/76441/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Of course running chkrootkit and/or AIDE or other checksum scanners from<br>a clean boot will help find compromised files and *known* rootkits.<p>However, that impinges on uptime for 24x7 servers.  There should be<br>scheduled downtime and such clean boot scanning should be routine during<br>those downtime windows.<p>It's possible, with hotswap capable mirror (RAID1) to yank a drive,<br>insert it into a scan system, force it to come up in degraded mode<br>as a mountable (non-system) drive and then scan that.<p>(Put in a spare on the production system and let it re-integrate to<br>preserve the array and performance).<p>If it's true hotswap hardware you can do this.  If it's soft raid and<br>you try commands like raidsetfaulty, etc. then you risk the attacker<br>hooking into that and covering his traces.<p>I'm surprised I've never seen an article published on this technique,<br>I've been describing it for years and tested it a couple times.  (I'm<br>not maintaining any production systems in this configuration).<p>JimD
      
          <div class="CommentReplyButton">
            <form action="/Articles/76441/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor76577"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 21, 2004 1:07 UTC (Sun)
                               by <b>shapr</b> (subscriber, #9077)
                              [<a href="/Articles/76577/">Link</a>] 
      </p>
      
      </div>
      </summary>
      You could put the trusted kernel on a bootable cdimage, and set the BIOS to boot from CDROM, where the trusted kernel would only start the system on the hard disk after all checks passed.<p>That would work for chkrootkit at least, and it would beat the &quot;save to disk on shutdown&quot; trick.
      
          <div class="CommentReplyButton">
            <form action="/Articles/76577/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor76325"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 14:09 UTC (Thu)
                               by <b>freethinker</b> (guest, #4397)
                              [<a href="/Articles/76325/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Is something wrong with this article? I tried to read it, and as soon as the browser window opened, it closed again. I tried using wget to get the source, and it gave me a weird error. Then I tried googling for &quot;adore rootkit&quot; and it came up empty. I tried emailing someone about it, and as soon as I typed &quot;Adore&quot;, my email client crashed.<p>Help, please. I have no idea what's going on!<p>;)<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/76325/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor76425"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 18, 2004 23:17 UTC (Thu)
                               by <b>rjamestaylor</b> (guest, #339)
                              [<a href="/Articles/76425/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <ul><i>Is something wrong with this article? I tried to read it, and as soon as the browser window opened, it closed again. I tried using wget to get the source, and it gave me a weird error. Then I tried googling for "adore rootkit" and it came up empty. I tried emailing someone about it, and as soon as I typed "Adore", my email client crashed.
<p>
Help, please. I have no idea what's going on!</i></ul>
Warning! You must act quickly! Someone has surruptiously installed Microsoft Windows on your computer!
      
          <div class="CommentReplyButton">
            <form action="/Articles/76425/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor76443"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Chkrootkit on Live system???</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 19, 2004 2:02 UTC (Fri)
                               by <b>AnswerGuy</b> (guest, #1256)
                              [<a href="/Articles/76443/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <br> I will find this out for myself later, but I really wish the author had  <br> reported whether chkrootkit detects this new Adore on a live/compromised <br> system.<p> It can detect many of them.  Of course a clean boot is far more dependable<br> but chkrootkit is cheap to run from cron (suitable obscured from the<br> cracker's scripts, of course).<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/76443/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor77252"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 25, 2004 10:11 UTC (Thu)
                               by <b>Kstat</b> (guest, #20442)
                              [<a href="/Articles/77252/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Sorry to kill the myth, but adore is very easy to detect (at least 3 differents ways). Of course, If the adore rk is sligly modified it will be more difficult to find :).<p>I let you goole on how to easyly find adore :)<p>Kstat &lt;- check for this too, this is a good tool to detect adore :)
      
          <div class="CommentReplyButton">
            <form action="/Articles/77252/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor77553"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 26, 2004 10:57 UTC (Fri)
                               by <b>trolldbois</b> (guest, #20139)
                              [<a href="/Articles/77553/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      And why doesn't adore prevent kstat from reading useful information from /dev/kmem ? ;)
      
          <div class="CommentReplyButton">
            <form action="/Articles/77553/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor156013"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2005 18:07 UTC (Mon)
                               by <b>xian1990@yahoo.com</b> (guest, #33150)
                              [<a href="/Articles/156013/">Link</a>] 
      </p>
      
      </div>
      </summary>
      What version of Linux kernel does Adore affect?<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/156013/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor184704"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 23, 2006 7:14 UTC (Tue)
                               by <b>duanjigang</b> (guest, #37367)
                              [<a href="/Articles/184704/">Link</a>] 
      </p>
      
      </div>
      </summary>
      like hacking technologies, thoughts more than codes, but codes are<br>
the proof of what the author said Thank you!<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/184704/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor220505"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A new Adore root kit</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 4, 2007 10:16 UTC (Sun)
                               by <b>X-Kernrootkit</b> (guest, #43134)
                              [<a href="/Articles/220505/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I AM TRYING TO INSTALL adore-ng0.54 on fedora core6 its giving me lots of errors<br>
such as<br>
adore-ng-2.6.c:546: error: current undeclared (first use in this function)<br>
adore-ng-2.6.c:550: error: dereferencing pointer to incomplete type<br>
adore-ng-2.6.c:550: error: dereferencing pointer to incomplete type<br>
adore-ng-2.6.c: In function patch_syslog:<br>
adore-ng-2.6.c:565: warning: implicit declaration of function sock_create<br>
adore-ng-2.6.c:568: error: dereferencing pointer to incomplete type<br>
adore-ng-2.6.c:569: error: dereferencing pointer to incomplete type<br>
adore-ng-2.6.c:570: error: dereferencing pointer to incomplete type<br>
adore-ng-2.6.c:571: warning: implicit declaration of function sock_release<br>
adore-ng-2.6.c: At top level:<br>
adore-ng-2.6.c:583: error: expected =, ,, ;, asm or __attribute__ <br>
etc<br>
please help<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/220505/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2004, Eklektix, Inc.<BR>
            
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
