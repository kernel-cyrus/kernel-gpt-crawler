        <!DOCTYPE html>
        <html lang="en">
        <head><title>Organizing kernel messages [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/407379/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/406705/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/407379/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Organizing kernel messages</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>September 29, 2010</br>
           </div>
In a previous life, your editor developed Fortran code on a VAX/VMS
system.  Every message emitted by VMS came decorated with a unique
identifier which could be used to look it up in a massive blue binder,
yielding a few paragraphs of (hopefully) helpful text on what the message
actually meant.  Linux has no analogous mechanism, but that is not the
result of a 
lack of attempts.  A talk at LinuxCon Japan detailed a new approach to
organized kernel messaging which, its authors hope, has a better chance of
making it into the mainline.
<p>
Andrew Morton recently <a
href="http://lwn.net/Articles/392177/">described</a> the kernel's approach
to messaging this way:
<p>
<div class="BigQuote">
	The kernel's whole approach to messaging is pretty haphazard and
	lame and sad.  There have been various proposals to improve the
	usefulness and to rationally categorise things in way which are
	more useful to operators, but nothing seems to ever get over the
	line
</div>
<p>
At LinuxCon Japan, Hisashi Hashimoto described an effort which, he hopes,
will get over the line.  To that end, he and others have examined previous
attempts to bring order to kernel messaging.  Undeterred, they have pushed
forward with a new project; he then introduced Kazuo Ito who discussed the
actual work.
<p>
Attempts to regularize kernel messaging usually involve either attaching an
identifier to kernel messages or standardizing the message format in some
way.  One thing that Ito-san noted at the outset is that any scheme
requiring wholesale changes to <tt>printk()</tt> lines is probably not
going to get very far.  There are over 75,000 such lines in the kernel,
many of them buried within macros; there is no practical way to change them all.
Other wrapper functions, such as <tt>dev_printk()</tt>, complicate the
situation further.  So any change will have to be effected in a way which
works with the existing mass of <tt>printk()</tt> calls.
<p>
A few approaches were considered.  One would be to create a set of wrapper
macros which would format message identifiers and pass them to
<tt>printk()</tt>; the disadvantage of this method, of course, is that it
still requires changing all of the <tt>printk()</tt> call sites.  It's also

<a href="/Articles/407535/"><img
src="https://static.lwn.net/images/conf/2010/LC-Tokyo/KazuoIto-sm.jpg" width=125 height=198
alt="[Kazuo Ito]" border=0 align="right"></a>

possible to turn <tt>printk()</tt> into a macro which would assemble a
message identifier from the available file name and line number
information; those identifiers, though, would be too volatile for the
intended use.  So the approach which the developers favored was hooking
into <tt>printk()</tt> itself to add message identifiers to messages as
they find their way to the console and the logs.
<p>
These message identifiers (also called "message-locating helper tokens")
must be assigned in some sort of automatic manner; asking the development
community to maintain a list of identifiers and attach them to messages
seems like a sure road to disappointment.  So one must immediately think of
how those identifiers will be generated; the two main concerns are
uniqueness and stability.  It turns out that Ito-san is not concerned with
absolute uniqueness; if, on occasion, two or three kernel messages end up
with the same identifier, the administrator should still be able to sort
things out without a great deal of pain.
<p>
Stability is important, though; if message identifiers change frequently
between releases - not to mention between boots - their value will be
reduced.  For that reason, generating messages at compile time using
preprocessor variables like <tt>__FILE__</tt> and <tt>__LINE__</tt> to
generate the identifiers, while easy, is not sufficient.  One could also
use the virtual address of the <tt>printk()</tt> call site, which is
guaranteed to be unique, but that could even change from one system boot to
the next, depending on things like the order in which modules are loaded.
So a different approach needs to be found.
<p>
What this group has settled on is generating a CRC32 hash of the message
format string at run time.  There is a certain runtime cost to that which
would have been nice to avoid, but it's not that high and, if
<tt>printk()</tt> calls are a bottleneck to system performance, there are
other problems.  If the system has been configured to output message
identifiers, this hash value will be prepended (with a "<tt>(%08x):</tt>"
format) to the message before it is printed.  A CRC32 hash is not
guaranteed to produce a unique identifier for each message (though it is
better than CRC16, which is guaranteed to have collisions with 75,000
messages), but it will be close enough.
<p>
Discussion of the current implementation during the talk revealed that
there are some remaining problems.  Messages printed with
<tt>dev_printk()</tt> will all end up with the same identifier, which is an
undesirable result.  The newly-added "<tt>%pV</tt>" format directive
(which indicates the passing of a structure containing a new format string
and argument list) also complicates things significantly by adding
recursive format string processing.  So the implementation will require
some work, but there was not a lot of disagreement over the basic approach.
<p>
It was only toward the end of the talk that there was some discussion of
what the use cases for this feature are.  The initial goal is simply to
make it easier to find where a message is coming from in the kernel code.
The use of macros, helper functions, etc. can make it hard to track down a
message with a simple <tt>grep</tt> operation.  But, with a message ID and
a supporting database (to be maintained with a user-space tool), developers
should be able to go directly to the correct <tt>printk()</tt> call.  Vinod
Kutty noted that, in large installations, automatic monitoring systems
could use the identifiers to recognize situations requiring some sort of
response.  There are also long-term goals around creating databases of
messages translated to other languages and help information for specific
messages.
<p>
So there are real motivations for this sort of work.  But, as was noted
back at the beginning, getting any kind of message identifier patch through
the process has always been a losing proposition so far.  It is hoped that,
this time around, the solution will be sufficiently useful (even to kernel
developers) and sufficiently nonintrusive that it might just get over the
line.  We should find out soon; once the patch has been fixed, it will be
posted to the mailing list for comments.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Messages">Messages</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#LinuxCon_Japan-2010">LinuxCon Japan/2010</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/407379/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor407683"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Organizing kernel messages</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2010 7:58 UTC (Thu)
                               by <b>heicarst</b> (subscriber, #20234)
                              [<a href="/Articles/407683/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That sounds quite exactly what we proposed appr. a year back already for s390. We maintain an out-of-tree patch which might be of interest:<br>
<a href="http://www.ibm.com/developerworks/linux/linux390/kernel-2.6.35.html">http://www.ibm.com/developerworks/linux/linux390/kernel-2...</a><br>
Look for the "message catalog" patch.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/407683/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor407701"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2010 10:19 UTC (Thu)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/407701/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So this decorates each message with a magic string that you can look up with a userspace tool to get... the location of the printk() in the kernel source?  Why not just add the source filename and line number to every message?<br>
<p>
Of course, line numbers shuffle around a bit as the kernel tree changes, but with git it should be straightforward to get the exact source tree used to build the kernel you're running.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/407701/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor407709"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2010 12:00 UTC (Thu)
                               by <b>NAR</b> (subscriber, #1313)
                              [<a href="/Articles/407709/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Especially that this tool seems to be directed towards developers, not system administrators (unlike the VMS messages) and there won't be binders full of documentation about the messages...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/407709/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor407880"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2010 21:25 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/407880/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Binders full of documentation (and translations) are definitely on the list.  That's just not the first thing they want to do, and it's not the way they are trying to sell this feature to the development community.
      
          <div class="CommentReplyButton">
            <form action="/Articles/407880/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor407738"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2010 13:39 UTC (Thu)
                               by <b>felixfix</b> (subscriber, #242)
                              [<a href="/Articles/407738/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Because the source line number may well change from time to time?  That won't help if you want consistent ids for automated handling, or to send in an email.<br>
<p>
I have often used source file and line number in my own messages in my own programs, but always for temporary use, not for any kind of long term identification.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/407738/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor407773"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2010 15:36 UTC (Thu)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/407773/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>Because the source line number may well change from time to time?</blockquote>And so will the exact format string, whose CRC32 has to match exactly for the tool to work.  In either case you depend on the exact kernel version.  A tiny change to the format string would produce a totally different CRC32.
      
          <div class="CommentReplyButton">
            <form action="/Articles/407773/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor407778"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2010 16:05 UTC (Thu)
                               by <b>adamgundy</b> (subscriber, #5418)
                              [<a href="/Articles/407778/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
that's not hard to fix. just add a new (optional) version of printk() that lets you specify the ID. if you tweak the format string for some reason (spelling, etc), but the meaning is the same, then just specify the ID so it stays the same..<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/407778/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor407987"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2010 9:53 UTC (Fri)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/407987/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>just add a new (optional) version of printk() that lets you specify the ID.</blockquote>In that case why not short-circuit the whole process - add a unique id to every kernel printk() right now (which can hardly be a controversial patch, even for linux-kernel, since it changes no functionality whatsoever) and be done with it.  No need to go through the transitional stage of making up ids from CRC32s.
      
          <div class="CommentReplyButton">
            <form action="/Articles/407987/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor407990"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2010 10:44 UTC (Fri)
                               by <b>intgr</b> (subscriber, #39733)
                              [<a href="/Articles/407990/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; add a unique id to every kernel printk() right now (which can hardly be a</font><br>
<font class="QuotedText">&gt; controversial patch, even for linux-kernel, since it changes no</font><br>
<font class="QuotedText">&gt; functionality whatsoever)</font><br>
<p>
Such "flag day" patches that require all developers to make the transition at the same time, only work for features with few users. This is because writing patches and merging them is an asynchronous task, trying to coordinate one change to happen on a particular "flag day" synchronizes the process and thus limits the throughput.<br>
<p>
And even if you don't expect everyone to transition at the same time, a change that touches practically _every_ file in the source tree would still cause merge conflicts with a large portion of other patches that do real work, and that means lots of work for all maintainers. So in order to have numbered printk's, all other work will have to suffer. It's just not worth the cost for this feature.<br>
<p>
It could only work if the conversion is done bit by bit, slowly enough that it has little measurable impact on the process -- but that would take a long time. So even if using CRC32 is a bit of a hack, it's a worthwhile tradeoff because we get similar functionality in no time and no impact.<br>
<p>
(Disclaimer: I'm not a Linux kernel hacker, that's just my understanding of the process)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/407990/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor408038"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2010 15:12 UTC (Fri)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/408038/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If adding a number to a format string - which does not change the line number of any other piece of code, does not move any code around, and does not add or remove files - causes a merge conflict, then your merge algorithm needs fixing.  I don't think git's merging is that bad.  On the contrary, a single patch to change some strings should be easy for everyone to merge and doesn't require any manual attention or conflict resolution (which would, however, be needed if the patch changed any actual code).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/408038/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor408043"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2010 16:32 UTC (Fri)
                               by <b>intgr</b> (subscriber, #39733)
                              [<a href="/Articles/408043/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; a single patch to change some strings should be easy for everyone to merge</font><br>
<p>
A _single_ patch is not merged in isolation. That doesn't even make sense. A merge, by definition, can only happen when two patches change the tree from a common ancestor state in different ways. A merge conflict occurs when these two changesets touch the same area of code in different ways.<br>
<p>
And git merge doesn't try to be clever. It doesn't understand C. It looks at which lines changed and which didn't, and does a 3-way merge. Resolving merge conflicts requires knowledge of what the code actually does.<br>
<p>
So, the printk patch will conflict with every _other_ patch that touches printk lines -- or lines adjacent to a printk -- it's as simple as that.<br>
<p>
git merge also obviously cannot assign numbers to printk messages for printk's that were _added_ by other merged patches, so that's another source of headaches.<br>
<p>
And can you imagine how many changesets touch printk lines in each kernel release?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/408043/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor407789"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2010 16:22 UTC (Thu)
                               by <b>felixfix</b> (subscriber, #242)
                              [<a href="/Articles/407789/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You have direct control over the format.  You don't have direct control over the line number.  It is even arguable that changing the format does change the message.  New content needs a new external description.  It may indicate circumstances which caused the message have changed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/407789/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor407984"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2010 9:50 UTC (Fri)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/407984/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It wouldn't be a good situation, however, for all kernel messages to become set in stone because people are relying on the CRC32 of the format string, so that even spelling mistakes and typos can never be corrected.  If you think that line number is something unpredictable, perhaps show "foo.c:N" for the Nth occurrence of printk() in file foo.c.  Then it would be fairly robust against code jiggling; only a real change to the code's functionality would cause the number to change.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/407984/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor409116"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not filename and line number?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 7, 2010 19:47 UTC (Thu)
                               by <b>gvy</b> (guest, #11981)
                              [<a href="/Articles/409116/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Seems you haven't actually read the history part of the article, all of that was discussed already (and outlined there).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/409116/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor407854"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Organizing kernel messages</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2010 19:25 UTC (Thu)
                               by <b>jimparis</b> (guest, #38647)
                              [<a href="/Articles/407854/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wonder if, instead of "(%08x):", the hash should be printed with a prefix like "(km%08x):".  A unique letter-prefixed string like km01234567 would be much easier to find in a Google search.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/407854/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor407863"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Organizing kernel messages</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2010 20:05 UTC (Thu)
                               by <b>mezcalero</b> (subscriber, #45103)
                              [<a href="/Articles/407863/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Would be good to keep this generic enough so that messages generated from userspace could be handled in a similar way. i.e. syslog() also takes a format string...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/407863/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor407980"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Organizing kernel messages</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2010 9:23 UTC (Fri)
                               by <b>error27</b> (subscriber, #8346)
                              [<a href="/Articles/407980/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why not: [git hash][file number][line number]<br>
<p>
You would use a tool to check out the correct code.<br>
<p>
The [git hash] would be the hash from most recent Linus tree.  The [file number] would be the hash of the filename.<br>
<p>
You could also assign a more permanent number by looking at the git hash for the patch which added the printk().  You could look the permentent number up on google or in your binder.<br>
<p>
Actually the [git hash] would be stored in a file under /sys.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/407980/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor408386"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Organizing kernel messages</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2010 17:02 UTC (Mon)
                               by <b>Lennie</b> (subscriber, #49641)
                              [<a href="/Articles/408386/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I was thinking the same thing.<br>
<p>
But it is not useful to everyone.<br>
<p>
It would only be useful as a (distribution)support or admin-tool.<br>
<p>
If you are a kernel developer it wouldn't help you much.<br>
<p>
To me, this seems fine, but maybe not for the people working on this.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/408386/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor408066"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Organizing kernel messages</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2010 18:58 UTC (Fri)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/408066/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <p>
Rather than a message manual to find out what a kernel message means, I'd prefer that the kernel just say what it means.
<p>
Message manual technology goes back to a time when disk space and memory were so expensive that the OS couldn't afford to display more than a code; paper and operator time were cheaper.
<p>
There is still an obvious bias on the part of many software developers toward making computers tight-lipped, giving just a hint as to what might be the problem when something fails.  But there's really no reason the kernel can't be more user friendly.
<p>
Having informative messages also removes much of the need to find the line of code that issued the message, as that's usually an attempt to find out what the kernel was trying to say.
<p>
And with detailed error messages, I think searching the code or the web for the text would be as easy as searching for an arbitrary message identifier.

      
          <div class="CommentReplyButton">
            <form action="/Articles/408066/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor408074"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Organizing kernel messages</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2010 19:55 UTC (Fri)
                               by <b>jeremiah</b> (subscriber, #1221)
                              [<a href="/Articles/408074/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This doesn't nessicarily address the automated tools. Although I do tend to agree with your saying. I don't know if the CRC32 will really be any better, but I'd love to have an automated response system for kernel messages based on som expted ID as opposed to some random text. The nice thing about this system, is that you can dig into the ID's and look for situations you didn't know could happen because you didn't look at a particular peice of source to see what kind of messages it could produce. Although i guess one could grep all of the printks() in the source right now, and get a full list, but that smells funny to me. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/408074/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor408255"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Organizing kernel messages</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 3, 2010 17:55 UTC (Sun)
                               by <b>error27</b> (subscriber, #8346)
                              [<a href="/Articles/408255/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's a tautology that good error messages are good.  But one thing about help files is that you can update them after the fact.  If some new hardware is released with a buggy BIOS then the help file can tell people how to install the work around patch.  Here again, having the git version would is usefull.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/408255/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor409277"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Organizing kernel messages</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 8, 2010 19:39 UTC (Fri)
                               by <b>roelofs</b> (guest, #2599)
                              [<a href="/Articles/409277/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <FONT COLOR="#448800"><I>Message manual technology goes back to a time when disk space and memory were so expensive that the OS couldn't afford to display more than a code; paper and operator time were cheaper.</I></FONT>

<P>
Memory is still expensive, it's just that now we measure the cost in performance (think "cache miss").  A paragraph of useful description for each of 75,000 printks?  No thanks...  (Not that most developers are willing or even necessarily capable of writing a paragraph of useful documentation.)

<P>
And, of course, it need not stop there:  a wiki could provide not only the paragraph-length descriptions but also user experiences, e.g., "I also saw that in this other situation that seemed unrelated, but because of <I>foo</I> bug and <I>baz</I> fallthrough, it triggered."

<P>
<FONT COLOR="#448800"><I>And with detailed error messages, I think searching the code or the web for the text would be as easy as searching for an arbitrary message identifier.</I></FONT>

<P>
Um...have you ever tried?  Finding copies of the same message is trivial--millions of logs are exposed on the Net.  Finding the one-in-10000 web page where somebody quotes the message and actually describes the fix (or at least the underlying problem) is damn near impossible.  (Kernel errors <I>might</I> be more amenable to it than gcc/binutils errors, but I wouldn't bet on it.  Even the number of forums containing orphaned what-does-this-mean / how-do-I-fix-this? postings--or postings with useless / outdated / incorrect responses--is ridiculously high.)

<P>
Greg
      
          <div class="CommentReplyButton">
            <form action="/Articles/409277/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor409347"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Organizing kernel messages</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2010 16:28 UTC (Sat)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/409347/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>
Memory is still expensive, it's just that now we measure the cost in performance (think "cache miss"). A paragraph of useful description for each of 75,000 printks? No thanks
</blockquote>
<p>
I don't see how long error messages would cause appreciable cache misses or other slowdowns.  I note that printks rarely execute and string literals are stored in a separate page from the rest of the stuff the program is likely to be accessing.
<p>
I hope there aren't people scrimping on messages (in any program) because they think they cost too much performance.

<blockquote>
<blockquote>
And with detailed error messages, I think searching the code or the web
for the text would be as easy as searching for an arbitrary message
identifier.
</blockquote>
Um...have you ever tried? Finding copies of the same message is
trivial--millions of logs are exposed on the Net. Finding the
one-in-10000 web page where somebody quotes the message and actually
describes the fix
</blockquote>
<p>
I agree that searching the web for message text is a poor way to diagnose a problem for the reasons you give (so I'd prefer that the program just tell me what the problem is), but how is searching the web for a message number any better?  I've done both.

<p>
Note that I switched context in my original post, addressing two separate  advantages of message numbers discussed in the article: 1) message manual ala VMS, and 2) Google.

      
          <div class="CommentReplyButton">
            <form action="/Articles/409347/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor408127"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ah, VMS ...</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 2, 2010 9:56 UTC (Sat)
                               by <b>ldo</b> (guest, #40946)
                              [<a href="/Articles/408127/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <P><TT>$ show node<BR>
%DCL-W-ABKEYW, ambiguous qualifier or keyword - supply more characters<BR>
 \NODE\</TT>
 
      
          <div class="CommentReplyButton">
            <form action="/Articles/408127/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor409329"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why does this need to be done in the kernel?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2010 10:47 UTC (Sat)
                               by <b>tux1968</b> (guest, #58956)
                              [<a href="/Articles/409329/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What's the purpose of calculating this CRC in kernel space?  Couldn't a userspace tool calculate it just as easily?  Said tool could keep a database of messages that have changed so that they hash out to the same ID etc...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/409329/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor409330"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why does this need to be done in the kernel?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2010 12:43 UTC (Sat)
                               by <b>johill</b> (subscriber, #25196)
                              [<a href="/Articles/409330/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You want to calculate the CRC on the format string, not on the formatted string, and userspace never has access to the former at runtime.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/409330/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2010, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
