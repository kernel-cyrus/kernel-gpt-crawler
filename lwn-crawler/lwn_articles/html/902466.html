        <!DOCTYPE html>
        <html lang="en">
        <head><title>Security requirements for new kernel features [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/902466/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/902797/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/902466/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Security requirements for new kernel features</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>LWN.net needs you!</b>
<p>
Without subscribers, LWN would simply not exist.  Please consider
       <a href="/Promo/nst-nag2/subscribe">signing up for a subscription</a> and helping
       to keep LWN publishing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>July 28, 2022</br>
           </div>
The relatively new <a href="/Articles/776703/">io_uring subsystem</a> has
changed the way asynchronous I/O is done on Linux systems and improved
performance significantly.  It has also, however, begun to run up a record
of disagreements with the kernel's security community.  A recent
discussion about security hooks for the new uring_cmd mechanism
shows how easily requirements can be overlooked in a complex system with no
overall supervision.
<p>
Most of the operations that can be performed within io_uring follow the
usual I/O patterns — open a file, read data, write data, and so on.  These
operations are the same regardless of the underlying device or filesystem
that is doing the work.  There always seems to be a need for something
special and device-specific, though, and io_uring is no exception.  For the
kernel as a whole, device-specific operations are made available via <a
href="https://man7.org/linux/man-pages/man2/ioctl.2.html"><tt>ioctl()</tt></a>
calls.  That system call, however, <a href="/Articles/897202/">has built up
a reputation</a> as a dumping
ground for poorly thought-out features, and there is little desire to see
its usage spread.
<p>
In early 2021, io_uring maintainer Jens Axboe <a
href="/Articles/844875/">floated an idea</a> for a command passthrough
mechanism that would be specific to io_uring.  A year and some later, that
idea has evolved into uring_cmd, which was pulled into the
mainline during the 5.19 merge window.  There is a new io_uring operation
that, in turn, causes an invocation of the underlying device or
filesystem's <tt>uring_cmd()</tt> <tt>file_operations</tt> function.  The
actual operation to be performed is passed through to that function with no
interpretation in the io_uring layer.  The <a
href="/ml/io-uring/20220511054750.20432-1-joshi.k@samsung.com/">first
user</a> is the NVMe driver, 
which provides a direct passthrough operation.
<p>
<h4>Missing security hooks</h4>
<p>
Just over one year ago, there was <a href="/Articles/858023/">a bit of a
disagreement</a> after the developers of the kernels Linux Security Module
(LSM) and auditing subsystems figured out that there were no security or
auditing hooks in all of that new io_uring code.  That put io_uring
operations outside the control of any security module that a given system
might be running and made those operations invisible to auditing.  Those
gaps were filled in, but not before the security developers expressed their
unhappiness about how io_uring had been designed and merged without thought
for LSM and audit support.
<p>
Given that, one might expect that the addition of a new feature like
<tt>uring_cmd</tt> would have seen more involvement from the security
community.  To an extent, that happened; Luis Chamberlain <a
href="/ml/io-uring/YiuC1fhEiRdo5bPd@bombadil.infradead.org/">posted a
patch</a> adding LSM support back in March.  In short, it added a new
<tt>security_uring_async_cmd()</tt> hook that would be called before
passing a command through to the underlying code; it could examine that
command and decide whether to allow or deny the operation.  There were some
disagreements over how well this would work; in particular, Casey Schaufler
<a
href="/ml/io-uring/8adf55db-7bab-f59d-d612-ed906b948d19@schaufler-ca.com/">complained</a>
that security modules would have to gain an understanding of every
device-specific command, which clearly would not scale well.
The conversation wound down shortly thereafter.
<p>
When the new feature was pushed
into the mainline, there was no LSM support included with it.  On
July&nbsp;13, Chamberlain <a
href="/ml/linux-block/20220714000536.2250531-1-mcgrof@kernel.org/">reposted
his patch</a> adding the new security hook.  Schaufler <a
href="/ml/linux-block/30dee52c-80e7-f1d9-a2e2-018e7761b8ea@schaufler-ca.com/">was
equally unimpressed</a> this time around:
<p>
<blockquote class="bq">
	You're passing the complexity of uring-cmd directly into each and
	every security module. SELinux, AppArmor, Smack, BPF and every
	other LSM now needs to know the gory details of everything that
	might be in any arbitrary subsystem so that it can make a wild
	guess about what to do. And I thought ioctl was hard to deal with.
</blockquote>
<p>
SELinux and audit maintainer Paul Moore <a
href="/ml/linux-block/CAHC9VhSjfrMtqy_6+=_=VaCsJKbKU1oj6TKghkue9LrLzO_++w@mail.gmail.com/">agreed</a>
with that assessment.  The end result, he said, was that security modules
would be unable to distinguish between low-level operations, so they
would end up simply enabling all io_uring passthrough commands for any
given subsystem or none of them; "<q>I think we can all agree that is not a
good idea</q>".  He later <a
href="/ml/linux-block/CAHC9VhQMABYKRqZmJQtXai0gtiueU42ENvSUH929=pF6tP9xOg@mail.gmail.com/">acknowledged</a>
that there does not appear to be a better solution at hand and merging
Chamberlain's patch looked like the only path forward: "<q>Without any
cooperation from the io_uring developers, that is likely what we will have
to do</q>".  The current plan appears to be to get Chamberlain's patch into
the mainline during the next merge window, with backports to the stable
kernels to be done thereafter.
<p>
<h4>Grumpiness</h4>
<p>
This particular problem appears to be solved, albeit in a way that is
less than satisfying to the security community.  A better solution may
materialize in the future, though providing a way to control access to
device-specific functionality in a general way is a hard problem.  But a
harder problem may be addressing the residual grumpiness in the security
community and preventing such problems from recurring in the future.  As
Moore <a
href="/ml/linux-block/CAHC9VhRCW4PFwmwyAYxYmLUDuY-agHm1CejBZJUpHTVbZE8L1Q@mail.gmail.com/">put
it</a>:
<p>
<blockquote class="bq">
	I feel that expressing frustration about the LSMs being routinely
	left out of the discussion when new functionality is added to the
	kernel is a reasonable response; especially when one considers the
	history of this particular situation.
</blockquote>
<p>
For his part, Axboe <a
href="/ml/linux-block/711b10ab-4ac7-e82f-e125-658460acda89@kernel.dk/">acknowledged</a>
that the security concerns should not have been allowed to fall through the
cracks, but he didn't necessarily offer a lot of hope for changes in the
future:
<p>
<blockquote class="bq">
	I guess it's just somewhat lack of interest, since most of us don't
	have to deal with anything that uses LSM. And then it mostly just
	gets in the way and adds overhead, both from a runtime and
	maintainability point of view, which further reduces the
	motivation.
</blockquote>
<p>
Even when the motivation is there, mistakes can happen.
Kernel development is a complex business.  A lot of effort has gone into
making the kernel sufficiently modular that developers need not worry about
what is happening in the rest of the system, but there are limits to how
far that process can go.
<p>
For example, developers must be aware of locking and the
locking requirements of subsystems they call into or things may go badly
wrong.  Memory must be handled according to the constraints placed on the
memory-management subsystem, and developers creating complex caches may
have to implement shrinkers to release memory on demand.  CPU hotplug
affects many subsystems and must be taken into account.  The same is true
of power-management events.  Changes to the user-space API can create
unhappiness years later.  Inattention to latency constraints may create
trouble in realtime applications.  A failure to properly document a
subsystem will make life harder for developers and users — but they are all
used to that by now.
<p>
And, of course, a failure to provide proper security hooks will hobble the
ability of administrators to control process behavior by way of LSM
policies. 
<p>
The fact that developers do not always succeed in keeping all of these
constraints in mind — and consequently make mistakes — is unsurprising.
Catching such omissions is one of the reasons for the existence of the
kernel's sometimes tiresome review process.  But nothing ensures that
a given change will be properly reviewed by, for example, a developer who
understands the needs of Linux security modules, and there is little that
forces the suggestions from any such review to be heeded.
<p>
So important things will occasionally fall through the cracks, and it is
not clear that much can be done to improve the situation.  It would be
wonderful if more companies would pay developers to spend more time
reviewing patches to provide, as an example, an overall security-oriented
eye on code heading into the mainline, but that does not appear to be the
world that we are living in.  Attempts to impose requirements with a more
bureaucratic process would mostly create friction and lead to the
distribution of more out-of-tree (and severely unreviewed) code.
<p>
The best path toward improvement may be, as Axboe <a
href="/ml/linux-block/2c6541c2-d55b-4fbc-ec03-3b84722b7264@kernel.dk/">put
it</a>, "<q>one subsystem being aware of another one's needs</q>".  Working
toward that goal — and the ability to fix mistakes in the stable kernels
when they do happen — seems to work reasonably well most of the time.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_model-Code_review">Development model/Code review</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#io_uring">io_uring</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-Security_modules">Security/Security modules</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/902466/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor902824"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Security requirements for new kernel features</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2022 14:51 UTC (Thu)
                               by <b>khuey</b> (guest, #158560)
                              [<a href="/Articles/902824/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How is the situation here different from the situation with ioctls? Wouldn&#x27;t security modules need to grok (or alternatively just ignore) every random ioctl command too?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/902824/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor902829"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Security requirements for new kernel features</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2022 15:02 UTC (Thu)
                               by <b>magfr</b> (subscriber, #16052)
                              [<a href="/Articles/902829/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I guess it is a question of an old and well known horror versus an entirely new horror.<br>
<p>
In a perfect world all of the security stuff would be unnecessary but the world is sadly not perfect.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/902829/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor902857"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Security requirements for new kernel features</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2022 22:51 UTC (Thu)
                               by <b>cschaufler</b> (subscriber, #126555)
                              [<a href="/Articles/902857/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Security modules do have to deal with the hideousness of ioctls. SELinux introduces a sophisticated set of classes for them, but it&#x27;s still somewhat wonkey. Smack relies on the correct use of ioctl command conventions (_IOC) by the driver implementations, even though the reliability of that is at best questionable. Neither is especially satisfactory. That&#x27;s one reason there&#x27;s a flap over io_uring_cmd. The collective community has had the opportunity to learn the lesson. It&#x27;s disappointing that we have to have this bruhaha over and over.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/902857/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor902867"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2022 8:24 UTC (Fri)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/902867/">Link</a>] (23 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
io_uring, apart from being a nice async interface, seem to be all about raw speed. It is achieving millions of IOps per core. What if we add LSM hooks, audit hooks, etc. and performance goes down? In few years someone will come with &quot;io_uring lite&quot; without those speed bumps.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/902867/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor902879"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2022 13:01 UTC (Fri)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/902879/">Link</a>] (22 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think that would be better solved by asking those that want &quot;ricer car&quot; speeds to just compile a kernel without any LSM hooks whatsoever.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/902879/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor902914"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2022 15:17 UTC (Fri)
                               by <b>jhoblitt</b> (subscriber, #77733)
                              [<a href="/Articles/902914/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I suspect a more common response would be for LSM policies applied to containers to block io_uring syscalls.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/902914/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor902931"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2022 18:14 UTC (Fri)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/902931/">Link</a>] (19 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Please don&#x27;t denigrate people who don&#x27;t want the overhead of things like the audit subsystem. It is the job of the security subsystems to add zero overhead for people who aren&#x27;t using them.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/902931/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor902984"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 30, 2022 20:52 UTC (Sat)
                               by <b>andresfreund</b> (subscriber, #69562)
                              [<a href="/Articles/902984/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
+1<br>
<p>
For production use having to build a custom kernel requires a decent scale to be a good decision. The overhead of various unused features in common distribution kernels is a problem.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/902984/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor903860"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 4, 2022 21:44 UTC (Thu)
                               by <b>cschaufler</b> (subscriber, #126555)
                              [<a href="/Articles/903860/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, and it&#x27;s the job of the IO subsystems to allow for security enforcement for the systems that do want them. When LSM was introduced the additional restrictions provided were only used by a handful of government and affiliated agencies. Today the system that doesn&#x27;t use security modules is an odd duck indeed. I seriously doubt you have any idea just how much of the work that goes into a security facility is focused on making sure that it performs well for those who don&#x27;t know they want it or think they know they don&#x27;t want it. Unfortunately, this often results in security features that are slower then they should be because they can&#x27;t be properly integrated. This adds to the Common Wisdom that security impacts performance.<br>
<p>
I cherish the memory of the Unix system that ran a sophisticated management program five to ten times faster when audit was enabled than when it wasn&#x27;t. When the characteristics of disparate sub-systems provide mutual benefit it&#x27;s a wonderful thing. You&#x27;ll never know that can happen if you don&#x27;t at least try.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903860/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor903884"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 1:28 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/903884/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; When LSM was introduced the additional restrictions provided were only used by a handful of government and affiliated agencies. </font><br>
<p>
And it&#x27;s pretty much used in these situations now. SELinux is useful if you are a giant corp with a huge development staff that is OK with torturing themselves by writing SELinux policies.<br>
<p>
<font class="QuotedText">&gt; Today the system that doesn&#x27;t use security modules is an odd duck indeed.</font><br>
<p>
Like, pretty much all classic desktops? I&#x27;ve yet to see a developer with &quot;serious&quot; LSMs like SELinux turned on.<br>
<p>
I think, some serious soul-searching on the side of LSM developers is in order.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903884/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor903912"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 8:47 UTC (Fri)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/903912/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Dunno about the Red Hat side of things, but I&#x27;m pretty certain SUSE (SLES, OpenSUSE) comes with SELinux enabled and functional.<br>
<p>
The OP said that Android comes with SELinux switched on.<br>
<p>
I think you&#x27;re forgetting that (a) your &quot;classic desktop&quot; is actually a niche use case for Linux, and (b) even then, all of the &quot;big boys&quot; - RH, Ubuntu, SUSE - probably do have SELinux switched on. It&#x27;s just not that visible ...<br>
<p>
My system is gentoo - of course I haven&#x27;t enabled it. But as Linux goes, gentoo and stuff like that is very much the minority ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903912/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904259"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2022 12:58 UTC (Tue)
                               by <b>anton</b> (subscriber, #25547)
                              [<a href="/Articles/904259/">Link</a>] 
      </p>
      
      </div>
      </summary>
      All I could find says that Ubuntu does not have SELinux enabled by default.  You apparently don't count Debian among the big boys, but it does not have SELinux enabled by default, either.


      
          <div class="CommentReplyButton">
            <form action="/Articles/904259/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor903916"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 9:03 UTC (Fri)
                               by <b>mw_skieske</b> (guest, #144003)
                              [<a href="/Articles/903916/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  Like, pretty much all classic desktops? I&#x27;ve yet to see a developer with &quot;serious&quot; LSMs like SELinux turned on.</font><br>
<p>
Hi there!<br>
<p>
Do you know every Fedora Desktop has, in fact SELinux in enforcing mode?<br>
<p>
❯ getenforce <br>
Enforcing<br>
<p>
kind regards<br>
<p>
People who don&#x27;t do SELinux are just lazy.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903916/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor903936"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 12:39 UTC (Fri)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/903936/">Link</a>] 
      </p>
      
      </div>
      </summary>
      That last line could really have been done without; there is no need to insult people you disagree with on something like this.  Please don't do that here.


      
          <div class="CommentReplyButton">
            <form action="/Articles/903936/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor903940"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2022 13:33 UTC (Fri)
                               by <b>pizza</b> (subscriber, #46)
                              [<a href="/Articles/903940/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  Like, pretty much all classic desktops? I&#x27;ve yet to see a developer with &quot;serious&quot; LSMs like SELinux turned on.</font><br>
<p>
Fedora and RHEL, at least, have SELinux on out of the box.<br>
<p>
All but one of my Linux installations have SELinux enabled (the exception is a heavily-used snowflake shell server whose install predates this SELinux stuff), including my two daily-use desktops (and several others I am responsible for).<br>
<p>
Additionally, nearly every Android device out there relies on SELinux to enforce app isolation.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/903940/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor904228"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2022 22:43 UTC (Mon)
                               by <b>cschaufler</b> (subscriber, #126555)
                              [<a href="/Articles/904228/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As others have pointed out, all Redhat desktops ship with SELinux full-up enabled. Ubuntu ships with AppArmor. I personally have systems running with both SELinux and AppArmor. Some with Smack and AppArmor, too. And there&#x27;s every cloud provider, every phone and almost every IoT device. When we search our souls it&#x27;s not about whether we should do a better job of getting out of the way, it&#x27;s about how we can provide more of the features developers are screaming for and still maintain performance. If you are content with access controls from the 1970&#x27;s I&#x27;m fine with that. But that puts you as far outside the mainstream as Bell &amp; LaPadula was in 1984. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904228/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904229"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2022 22:57 UTC (Mon)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/904229/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I have yet personally to see a person with SELinux enabled. I don&#x27;t see Fedora desktops often, but all the people I know that are using them have SELinux disabled because they work on low-level stuff.<br>
<p>
AppArmor in Ubuntu is a bit more sane, because it doesn&#x27;t require crazy labelling and impenetrable policies.<br>
<p>
<font class="QuotedText">&gt; And there&#x27;s every cloud provider</font><br>
<p>
Not every. And I know how one large provider works internally (a couple of years outdated, but I doubt it has changed much). <br>
<p>
Heck, here&#x27;s what EC2 offers for their own supported in-house distribution:<br>
<p>
<font class="QuotedText">&gt; [ec2-user@ip-172-31-0-166 ~]$ getenforce</font><br>
<font class="QuotedText">&gt; Disabled</font><br>
<p>
<font class="QuotedText">&gt; When we search our souls it&#x27;s not about whether we should do a better job of getting out of the way, it&#x27;s about how we can provide more of the features developers are screaming for and still maintain performance. </font><br>
<p>
How long did it take to build stackable LSMs? For a decade the inability to run multiple LSMs made anything but SELinux/AppArmor impractical. <br>
<p>
Sorry. But right now LSMs are just an impediment that most people try to wave away so it won&#x27;t bother them. Large companies like Google have time and money to invest in getting it into shape, sure. But that&#x27;s a far cry from being a useful and productive feature. Unlike cgroups or namespaces that are widely accepted by developers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904229/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904282"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2022 16:16 UTC (Tue)
                               by <b>cschaufler</b> (subscriber, #126555)
                              [<a href="/Articles/904282/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Stacking LSMs could have been completed a decade ago had it not been for some of the design choices forced upon the security module developers to ensure that performance impact on systems that don&#x27;t use LSMs is minimized. I understand and appreciate that in whatever subset of the Linux development community you reside LSM is not considered useful. I personally have little interest in the device driver infrastructure, which many developers consider most critical. I am concerned that work I do in LSM does not interfere with device drivers *to the extent possible*. If you need to blame CAP_SYS_ADMIN on somebody, I&#x27;m probably the best target. The Linux kernel does lots of things for lots of reasons. I have no idea what you work on, or why, but I&#x27;m willing to wager a refreshing beverage that we could have made security a much bigger pain than it is now.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904282/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904294"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2022 20:15 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/904294/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I understand and appreciate that in whatever subset of the Linux development community you reside LSM is not considered useful.</font><br>
<p>
It&#x27;s not that it&#x27;s not useful, additional mitigations are great. It&#x27;s that the amount of effort that needs to be expended to make use of SELinux is just not comparable with the amount of protection it provides. I long ago tried to make sense of policies and to create my own toy policies, but failed miserably. TOMOYO is rigorously undocumented and I haven&#x27;t touched Smack because it doesn&#x27;t even look in any way &quot;simplified&quot;.<br>
<p>
AppArmor is a bit better, since it at least doesn&#x27;t require labelling across all of the filesystem which is nothing but security theater compared to just using paths. Its policies are also easier to understand.<br>
<p>
One feature that I really personally would have liked is an ability to use LSMs to _grant_ permissions instead of taking them away.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904294/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904296"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2022 20:24 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/904296/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And yeah, at this point I&#x27;d just prefer a well-tailored ad-hoc solution like pledge()/unveil() in OpenBSD to the generalized LSM system that Linux has.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904296/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor904297"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Authoritative hooks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2022 20:29 UTC (Tue)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/904297/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      It seems you have one point of agreement with Casey, anyway: at one point, at least, <a href="/2001/1108/a/cs-hooks.php3">he too wanted authoritative hooks</a> in the LSM subsystem.


      
          <div class="CommentReplyButton">
            <form action="/Articles/904297/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904411"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Authoritative hooks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 10, 2022 21:39 UTC (Wed)
                               by <b>cschaufler</b> (subscriber, #126555)
                              [<a href="/Articles/904411/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Had we adopted authoritative LSM hooks the landscape would be very different indeed. Stacking of modules would have been impossible. What would happen if module A said &quot;yes&quot; and module B said &quot;no&quot;? You&#x27;d have to define some sort of peeking order for the modules, which wouldn&#x27;t make each module authoritative now, would it? What we could do is refactor the traditional Linux discretionary controls into an LSM and insert it at the front of the list. You could then implement POSIX ACLs in an LSM, replacing the mode-bit only hooks with ACL cognizant ones. To forgo DAC all you would have to do is drop that module from the list. Now I suppose one might only want to drop certain of the controls (e.g. signal delivery ) and not the whole set. That&#x27;s solvable, but hideous. Too much &quot;fine granularity&quot; for my taste.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904411/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904416"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Authoritative hooks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2022 0:09 UTC (Thu)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/904416/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  Had we adopted authoritative LSM hooks the landscape would be very different indeed. Stacking of modules would have been impossible. What would happen if module A said &quot;yes&quot; and module B said &quot;no&quot;?</font><br>
<p>
Various systems (like IAM policies in AWS or ACLs in Windows) typically consider &quot;Deny&quot; to be a veto on any allowing ACLs/policies. <br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904416/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904494"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Authoritative hooks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2022 17:50 UTC (Thu)
                               by <b>cschaufler</b> (subscriber, #126555)
                              [<a href="/Articles/904494/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is exactly the &quot;bail on fail&quot; model of permissive hooks that we have today. What you can&#x27;t do is what you had asked for, which is to provide a mechanism for a hook to grant access instead of denying it as would occur otherwise. We could make it possible, but that would have -- wait for it -- performance impact. :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904494/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor904495"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Authoritative hooks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 11, 2022 18:50 UTC (Thu)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/904495/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; What you can&#x27;t do is what you had asked for, which is to provide a mechanism for a hook to grant access instead of denying it as would occur otherwise. </font><br>
<p>
That would actually help and make time investment into SELinux be worthwhile, as it will open up _new_ possibilities. Performance impact is another question, and it&#x27;d be interesting to see if removing the DAC entirely in favor of MAC would help.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904495/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor905672"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 23, 2022 7:26 UTC (Tue)
                               by <b>daenzer</b> (subscriber, #7050)
                              [<a href="/Articles/905672/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I don&#x27;t see Fedora desktops often, but all the people I know that are using them have SELinux disabled because they work on low-level stuff.</font><br>
<p>
I&#x27;ve been working on the graphics stack (mostly between Mesa / mutter / Xwayland) as part of the Red Hat desktop group for 3 years. In this time, I&#x27;ve never had to disable SELinux on Fedora. AFAIK my colleagues are leaving it enabled as well.<br>
<p>
There can sometimes be minor SELinux related issues when upgrading to a new beta release, but those are usually quickly fixed.<br>
<p>
It seems to me what you think you know about this is hearsay and/or outdated.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/905672/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor902955"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Performance impact</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 30, 2022 10:14 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/902955/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not knowing anything about io_uring, but I would have thought a &quot;simple&quot; fix was adding a security module pointer to the uring itself. If that contains a pointer, that is the &quot;god&quot; uring security monitor. Any io_uring call must register its security module with god, because, if god has been so configured, &quot;no security module, no run ...&quot;.<br>
<p>
That way, people who don&#x27;t want the hassle/overhead just don&#x27;t bother registering god with io_uring. People who are paranoid, or need accounting, or whatever, configure god to reject calls it doesn&#x27;t know about (and the writers of said calls will quickly get bug reports saying &quot;your io_uring call doesn&#x27;t work - missing security module&quot;).<br>
<p>
And if this is added *quickly*, before io_uring gets too embedded, it means that &quot;no security module no run&quot; is a realistic option. The later it gets left, the harder it gets to turn that on without all hell breaking loose ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/902955/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor904766"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Security requirements for new kernel features</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2022 18:03 UTC (Mon)
                               by <b>jezuch</b> (subscriber, #52988)
                              [<a href="/Articles/904766/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; For example, developers must be aware of locking and the locking requirements of subsystems they call into or things may go badly wrong. Memory must be handled according to the constraints placed on the memory-management subsystem, and developers creating complex caches may have to implement shrinkers to release memory on demand. CPU hotplug affects many subsystems and must be taken into account. The same is true of power-management events. Changes to the user-space API can create unhappiness years later. Inattention to latency constraints may create trouble in realtime applications. A failure to properly document a subsystem will make life harder for developers and users — but they are all used to that by now.</font><br>
<p>
<font class="QuotedText">&gt; And, of course, a failure to provide proper security hooks will hobble the ability of administrators to control process behavior by way of LSM policies.</font><br>
<p>
My $DAYJOB recently introduced a checklist in the pull request template. It pertains mostly release notes and documentation, but I imagine it could at least help here. Of course people will ignore it, will mis-judge the requirements etc, but maybe in the case of the bigger pull requests someone will insist on it being at least seriously considered.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904766/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2022, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
