        <!DOCTYPE html>
        <html lang="en">
        <head><title>Facing the Git commit-ID collision catastrophe [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/1001526/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/1001870/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/1001526/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Facing the Git commit-ID collision catastrophe</h1>
</div>
<div class="ArticleText">
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>December 13, 2024</br>
           </div>
Commits in the Git source-code management system are identified by the
SHA-1 hash of their contents — though the specific hash <a
href="/Articles/898522/">may change someday</a>.  The full hash is a
160-bit quantity, normally written as a 40-character hexadecimal string.
While those strings are convenient for computers to work with, humans find
them to be a bit unwieldy, so it is common to abbreviate the hash values to
shorter strings.  Geert Uytterhoeven recently <a
href="/ml/all/cover.1733421037.git.geert+renesas@glider.be">proposed</a>
increasing the length of those abbreviated hashes as used in the kernel
community, but the problem he was working to solve may not be as urgent as
it seems.
<p>
A hash, of course, is not the same as the data it was calculated from;
whenever hashes are used to represent data, there is always the possibility
of a collision — when two distinct sets of data generate the same hash
value.  A 160-bit hash space is large enough that the risk of accidental
collisions is essentially zero; the risk of intentional (malicious)
collisions is higher, but is still not something that most people worry
about — for now.  The hash space is large enough that even a relatively
small portion of the hash value is still enough to uniquely identify a
value.  In a small Git repository, a 24-bit (six-digit) hash may suffice;
as a repository grows, the number of digits required to unambiguously
identify a commit will grow.  In all cases, though, the shorter commit IDs
are much easier for humans to deal with, and are almost universally used.
<p>
The kernel has, for some years now, used a twelve-character (48-bit) hash
value in most places where a commit ID is needed.  That is the norm for
citing commits within changelogs (in Fixes tags, for example), and in email
discussions as well.  Uytterhoeven expressed a concern that, given the
growth of the kernel repository, soon twelve digits will not be enough:
"<q>the Birthday Paradox states that collisions of 12-character commit IDs
are imminent</q>".  He suggested raising the number of digits used to
identify commits in the kernel repository to&nbsp;16 to head off this
possibility.
<blockquote class="ad">
<b><tt>$ sudo subscribe today</tt></b>
<p>
Subscribe today and elevate your LWN privileges. You’ll have
access to all of LWN’s high-quality articles as soon as they’re
published, and help support LWN in the process.  <a href="https://lwn.net/Promo/nst-sudo/claim">Act now</a> and you can start with a free trial subscription.
</blockquote>

<p>
Linus Torvalds, though, <a
href="/ml/all/CAHk-=wiwAz3UgPOWK3RdGXDnTRHcwVbxpuxCQt_0SoAJC-oGXQ@mail.gmail.com">made
it clear</a> that he did not support this change, for a couple of reasons.
The first of those was that, while Git uses hashes to identify the objects
in a repository, those objects are not all commits.  There are three core
object types in Git: blobs, trees, and commits.  Blobs hold the actual data
that the repository is managing — one blob holds the contents of one file
at a given point in the history.  Tree objects hold a list of blobs and
their places in the filesystem hierarchy; they indicate which files were
present in a given revision, and how they were laid out.  If the only
change between a pair of revisions is the renaming of a single file, the
associated tree objects will differ only in that file's name; both will
refer to the same blob object for the file's contents.  Finally, a commit
contains references to a number of objects (the previous commit(s) and the
tree) along with metadata like the commit author, date, changelog, and so
on.
<p>
Torvalds's point was that commits only make up about 1/8 of the total
objects in the repository.  Even if two objects turn up with the same
(shortened) hash, one of those objects is highly likely not to be a commit.
Since humans rarely (never, in truth) traffic in blob or tree hashes, any
collisions with those hashes are not a problem; it will be clear which one
the human was referring to.  When dealing with just the commit space, the
problem of ambiguous abbreviations appears to be further away:
<p>
<blockquote class="bq">
	My tree is at about 1.3M commits, so we're basically an order of
	magnitude off the point where collisions start being an issue wrt
	commit IDs.
</blockquote>
<p>
When just looking at commit IDs, he said, there are no collisions when
ten-digit abbreviations are used, so twelve seems safe for a while yet.
Especially given that, as Torvalds pointed out, the current state was
reached after nearly 20&nbsp;years of use of Git within the kernel project.
It will take a fair while yet to close that order-of-magnitude buffer that
the kernel still has.
<p>
Torvalds's other point, though, was that humans should not normally be
quoting abbreviated hashes in isolation anyway.  Within the kernel
community, there is a strong expectation that commit IDs will be
accompanied by the short-form version of the changelog.  So rather than
just citing <a
href="https://git.kernel.org/linus/690b0543a813">690b0543a813</a>, for
example, a developer would write:
<p>
<pre>
    commit 690b0543a813 ("Documentation: fix formatting to make 's' happy")
</pre>
<p>
There are times, Torvalds says, when the hash provided for a commit is
incorrect (often because a rebase operation will have caused it to change),
but the short changelog can always be used to locate the correct commit in
the repository.  Tools should support using that extra information; any
workflow that relies too heavily on just the commit ID is already broken,
he said.  Given that even a twelve-digit hash is often "<q>line noise</q>",
he was unwilling to make it even worse for a questionable gain.
<p>
That response brought an abrupt end to the conversation; the proposed
patches will not be merged into the mainline.  That ending cut off one
other aspect of Uytterhoeven's changes, though.  Current kernel
documentation is inconsistent about whether hashes should be abbreviated to
<i>exactly</i> twelve characters, or to <i>at least</i> that many.  That
inconsistency is far from the biggest problem in the kernel's
documentation, but it still seems worth straightening out at some point.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_tools-Git">Development tools/Git</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/1001526/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor1002134"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is the date there?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2024 15:18 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/1002134/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you ask for eg 10 characters, and there's a collision, can't git just display enough extra characters to disambiguate, along with the commit date? If the hash wasn't initially ambiguous, it obviously refers to the earliest one.<br>
<p>
So does the number of characters really matter? That'll give you all the information you need.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002134/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002137"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is the date there?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2024 15:38 UTC (Sat)
                               by <b>randomguy3</b> (subscriber, #71063)
                              [<a href="/Articles/1002137/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
the obvious immediate issue you'd have to solve is what counts as "older" in a distributed system? you can't use the date - even if you could trust the date on commits, there could easily be an older commit with the same hash in another branch that you can't currently see from your local clone (but will be able to when you - in the future - pull from someone else)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002137/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002191"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is the date there?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2024 23:55 UTC (Sat)
                               by <b>skissane</b> (subscriber, #38675)
                              [<a href="/Articles/1002191/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; the obvious immediate issue you'd have to solve is what counts as "older" in a distributed system? you can't use the date - even if you could trust the date on commits, there could easily be an older commit with the same hash in another branch that you can't currently see from your local clone (but will be able to when you - in the future - pull from someone else)</span><br>
<p>
Git is not the kind of distributed system which needs a highly accurate clock. If someone is talking about a commit with some ID, and there are two commits with that ID – one from this year and one from a decade ago – most likely they mean the one from this year. So even if my clock is 5 minutes off, so long as I know what year it is, I'm fine.<br>
<p>
Since there are a lot more commits from years ago than from this year, odds are high that when a collision finally happens, it will be between a recent commit and one much older, so it will be obvious from the timestamps which one is relevant. Yes, it is possible that an ID collision could occur between two recent commits, but that is significantly less likely because historical commits greatly outnumber recent ones.<br>
<p>
Also there are other ways to disambiguate commits – if we are talking about the networking subsystem, and one commit with that ID is a networking commit, and the other is touching some unrelated kernel subsystem, we know which one is likely meant.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002191/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002262"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is the date there?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2024 10:22 UTC (Mon)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/1002262/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That is all nice and well for a human reader but how is automated tooling supposed to make decisions like that?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002262/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002271"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Automated tools should fail on ambiguity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2024 11:42 UTC (Mon)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/1002271/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <p>Automated tools, when presented with an ambiguous truncated hash, should simply fail and require a human to disambiguate. The extra information in context should allow a human to look up the truncated hash, see the (likely single-digit) possibilities, and ask the automated tool to retry with the correct full hash.
<p>And tools generating truncated hashes should verify that the truncated hash is locally unambiguous; for example, if I ask <tt>git</tt> for a 6 character hash, and it determines that <tt>123abc</tt> is both the first 6 characters <em>and</em> ambiguous locally, it should give me a longer hash that isn't ambiguous (e.g. 123abc45, to distinguish from 123abcde as the other local option).


      
          <div class="CommentReplyButton">
            <form action="/Articles/1002271/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002274"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Automated tools should fail on ambiguity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2024 11:55 UTC (Mon)
                               by <b>intelfx</b> (subscriber, #130118)
                              [<a href="/Articles/1002274/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Automated tools, when presented with an ambiguous truncated hash, should simply fail and require a human to disambiguate. The extra information in context should allow a human to look up the truncated hash, see the (likely single-digit) possibilities, and ask the automated tool to retry with the correct full hash.</span><br>
<span class="QuotedText">&gt;</span><br>
<span class="QuotedText">&gt; And tools generating truncated hashes should verify that the truncated hash is locally unambiguous; for example, if I ask git for a 6 character hash, and it determines that 123abc is both the first 6 characters and ambiguous locally, it should give me a longer hash that isn't ambiguous (e.g. 123abc45, to distinguish from 123abcde as the other local option). </span><br>
<p>
I mean, that's how it (Git's own CLI, aka porcelain) works right now. However, there clearly are people who feel it's not adequate.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002274/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002275"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Automated tools should fail on ambiguity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2024 11:59 UTC (Mon)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/1002275/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <p>Git's porcelain is not the only tool out there that uses or generates truncated hashes; CI systems consume them, and forges generate them in their Web UIs. Hopefully, they all get things right, but the nature of code is that some of these systems will have bugs.


      
          <div class="CommentReplyButton">
            <form action="/Articles/1002275/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002544"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Automated tools should fail on ambiguity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 17, 2024 18:24 UTC (Tue)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/1002544/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
AFAIK, CI nor forges communicates solely on truncated hashes. Either they use full hashes or hidden refs (e.g., `refs/pipelines/N` on GitLab-CI). The UI might *render* only truncated hashes, but interacting should get full hashes (cf. this GitLab bugfix to do so: <a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/146052">https://gitlab.com/gitlab-org/gitlab/-/merge_requests/146052</a>).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002544/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002545"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Automated tools should fail on ambiguity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 17, 2024 18:28 UTC (Tue)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/1002545/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      You do, however, have to cope with users doing things like highlighting the truncated hash and copying it (rather than using the affordances in the UI to get a full hash), taking a screenshot and attaching that to a mail (where the recipient then has to reconstruct the hash from the picture), and pasting a truncated hash into the CI's "request a build of an arbitrary commit" field.
<p>I would hope that all of these cases are at least considered by forges and CIs, but once you have a human in the loop, they will find ways to do weird things that you did not expect, and did not allow for - and the best a forge or CI can do is fail when I ask it to interact with an ambiguous commit hash.


      
          <div class="CommentReplyButton">
            <form action="/Articles/1002545/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002709"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Automated tools should fail on ambiguity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2024 14:31 UTC (Wed)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/1002709/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; I would hope that all of these cases are at least considered by forges and CIs, but once you have a human in the loop, they will find ways to do weird things that you did not expect, and did not allow for - and the best a forge or CI can do is fail when I ask it to interact with an ambiguous commit hash.</span><br>
<p>
Yes, humans always make things messy ;) . AFAIK, all APIs would stop something ambiguous at the API surface rather than after figuring out what work needs to be done. And, AFAIK, most APIs want names of refs or forge entities (like PRs) rather than commit IDs. Not that the latter don't exist, but I don't usually find interest in CI results of a specific commit rather than a ref or current PR state (without naming it by one of those ways).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002709/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002710"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Automated tools should fail on ambiguity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2024 14:40 UTC (Wed)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/1002710/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>Note that a commit ID in git qualifies as a refspec, and that's what most APIs actually ask for - something that git can resolve to a commit. And the trouble kicks in when you accept a refspec - because <tt>main</tt>, <tt>refs/branches/main</tt>, <tt>aef25be35d23</tt> and <tt>aef25be35d23ec768eed08bfcf7ca3cf9685bc28</tt> are all valid refspecs in git, but the truncated hash can be ambiguous with other commits, and only the full hash is unambiguous over time (since the others are mutable).
<p>And IME, if you don't run CI on every single commit, people do ask for CI for a specific commit by hash, rather than mutable ref - when something worked 10 commits ago, but fails now, asking CI to fill in the gaps is useful.



      
          <div class="CommentReplyButton">
            <form action="/Articles/1002710/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor1002396"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Automated tools should fail on ambiguity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2024 19:21 UTC (Mon)
                               by <b>geert</b> (subscriber, #98403)
                              [<a href="/Articles/1002396/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, git knows about all commits (in your repository), and will print a longer hash automatically when needed (for your repository).<br>
<p>
That is how people end up with patches with Fixes:-tags of 13 characters, even with core.abbrev = 12 in their .gitconfig.  Next, a strict maintainer will reject those patches, because scripts/checkpatch.pl complains about a hash that is not exactly 12 characters, despite (some parts of) the documentation stating that _at least 12_ is fine.<br>
<p>
So that is what the first patch in the series is supposed to fix, but everybody focuseses on the second patch ;-)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002396/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor1002364"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Automated tools should fail on ambiguity</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2024 15:45 UTC (Mon)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/1002364/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
When I wrote automated tools I was more thinking of tooling consuming e.g. those Fix annotations in the history of the Linux kernel, i.e. tooling that consumes a large number of the truncated hashes.<br>
<p>
Any place where that could become a problem, i.e. long-term storage of commit hashes, should not use truncated hashes for that reason in my opinion.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002364/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor1002142"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is the date there?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2024 16:16 UTC (Sat)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/1002142/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; If you ask for eg 10 characters, and there's a collision, can't git just display enough extra characters to disambiguate, along with the commit date?</font>

<p>Not if you have hundreds of independent git repos (as happens with kernel development) and commits go into different trees.</p>

<font class="QuotedText">&gt; If the hash wasn't initially ambiguous, it obviously refers to the earliest one.</font>

<p>Not if you have many independent repos.</p>

<p>P.S. With one, single, “canonical” repo the whole discussion wouldn't even make any sense since you can just hand over unique IDs sequentially.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/1002142/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002257"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is the date there?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2024 7:44 UTC (Mon)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/1002257/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
? We effectively do have a single repo, in that there is a single official git tree.<br>
<p>
The chances that a new hash collides with another new hash in a different tree that happens to *also* not be in Linus' tree are way too small to worry about, you'd need roughly 100'000 commits per release cycle for that to be even remotely likely, using 12-character hashes. (16⁶ is 16 million, which is the point where the chance of a collision approaches 50%.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002257/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002436"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is the date there?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 17, 2024 9:57 UTC (Tue)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/1002436/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; you'd need roughly 100'000 commits per release cycle for that to be even remotely likely</font>

<p>Is this 100'000 <b>commits</b> or 100'000 <b>unique hashes</b>? Given the fact that each release cycle there are <a href="https://lwn.net/Articles/981559/">more than 10'000 commits accepted</a> I would suspect that there are significantly more than 100'000 transient commits that don't go into Linus tree (rejected patches, temporary commits into different git trees, etc).</p>

<p>And we are talking about discussions on mailing lists and other such things. These don't belong to a single git tree.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/1002436/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002437"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is the date there?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 17, 2024 11:52 UTC (Tue)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/1002437/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Is this 100'000 commits or 100'000 unique hashes?</span><br>
<p>
Commits. If you ask git to show something that might be a commit and/or something else, you get a nice list with the candidates, including the (we hope) single commit in question.<br>
<p>
<span class="QuotedText">&gt; significantly more than 100'000 transient commits that don't go into Linus tree (rejected patches, temporary commits into different git trees, etc).</span><br>
<p>
These are not going to be referenced from short hashes that *are* in Linus' tree.<br>
<p>
<span class="QuotedText">&gt; And we are talking about discussions on mailing lists and other such things. These don't belong to a single git tree.</span><br>
<p>
The number of commit references on mailing lists, online discussions, other git trees, et al. is significantly smaller than 100'000, which violates the birthday paradox-ish assumption that *any* two commits that share a prefix are a problem.<br>
<p>
In other words, the real-life probability of a collision that actually matters to anybody is a lot less than what the BP tells us it might be. <br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002437/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor1002242"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Is the date there?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2024 20:56 UTC (Sun)
                               by <b>andy_shev</b> (subscriber, #75870)
                              [<a href="/Articles/1002242/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I remember I had seen a collisions when I used 6 or so characters to refer a commit. `git log` simply outputs me all that matched.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002242/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor1002146"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nice!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2024 17:25 UTC (Sat)
                               by <b>npitre</b> (subscriber, #5680)
                              [<a href="/Articles/1002146/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Love the commit used as example.  ;-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002146/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002277"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nice!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2024 12:11 UTC (Mon)
                               by <b>sdalley</b> (subscriber, #18550)
                              [<a href="/Articles/1002277/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And the delightful way in which our editor does a send-up of click-baity headlines with tongue coiled firmly-in-cheek!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002277/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor1002170"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Including the commit date in the reference</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2024 23:05 UTC (Sat)
                               by <b>alx.manpages</b> (subscriber, #145117)
                              [<a href="/Articles/1002170/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The commit subject is usually distinct.  However, some commits have a more generic subject, which might not be enough to disambiguate.<br>
<p>
Recently, I had to refer to many of the commits in one project I co-maintain, and came up with some notation that's straightforward, and lets me easily see the precise commit I'm referring to:<br>
<p>
```<br>
$ cat ~/.gitconfig | grep -A1 'ref ='<br>
    ref = show --no-patch --abbrev=12 --date=short  --format=format:'%C(auto)%h (%cd,%C(reset) \"%C(white)%s%C(reset)\")'<br>
$ git ref HEAD -3<br>
8821d3ff2dcf (2024-12-09, "lib/fs/readlink/: readlinknul(): Fix return type")<br>
b9d00b64a19f (2024-12-09, "lib/fs/readlink/readlinknul.h: readlinknul(): Silence warning")<br>
205c23bff28f (2024-12-09, "Added option -a for listing active users only, optimized using if aflg,return")<br>
```<br>
<p>
That is:<br>
<p>
&lt;hash-12-chars&gt; (&lt;commit-date&gt;, "commit-subject")<br>
<p>
The combination of 12-char hash and commit date makes it completely unambiguous, and the subject makes it more readable.<br>
<p>
A few considerations, compared to `git log --pretty=reference`:<br>
-  The commit date is more useful than the author date, because some commits might have been authored years before being finally committed.  When looking at the git-log(1), and especially in --graph mode, the dates that will be correlative are the commit dates, which make it easy to search.<br>
-  This puts the date before the subject, which makes it easier to find all three fields in a long list of references.<br>
-  This includes quotes around the subject, as usual.<br>
<p>
So, I now use references like this in commit messages:<br>
<p>
Fixes: 419ce14b6f72 (2024-11-01, "lib/fs/readlink/: readlinknul(): Add function")<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002170/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002223"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Including the commit date in the reference</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2024 15:43 UTC (Sun)
                               by <b>mgedmin</b> (subscriber, #34497)
                              [<a href="/Articles/1002223/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is pretty similar to the builtin `git log --pretty=ref`, about which I only learned recently and by accident.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002223/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002414"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Including the commit date in the reference</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2024 23:06 UTC (Mon)
                               by <b>alx.manpages</b> (subscriber, #145117)
                              [<a href="/Articles/1002414/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I actually learned about --pretty=reference when reading the documentation for implementing my `git ref` alias.  :)<br>
<p>
I didn't like it though.  The author date is useless, as it doesn't serve to find a commit in the log.  Also, I prefer having quotes around the subject.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002414/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor1002415"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Including the commit date in the reference</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2024 23:09 UTC (Mon)
                               by <b>alx.manpages</b> (subscriber, #145117)
                              [<a href="/Articles/1002415/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
BTW, when dealing with multiple forks of a project, it's interesting to specify which one the commit belongs to.  So, for example, I would use:<br>
<p>
Fixes: mutt.git b423ebbfa9d2 (1999-01-04, "Make the experimental branch the main trunk.")<br>
<p>
I also use this when cherry-picking commits from other projects; that's where this is especially useful.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002415/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor1002214"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Full commit hashes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2024 14:30 UTC (Sun)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/1002214/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I always refer to full commit hashes in commit messages, I wonder how popular that is.<br>
<p>
Fixes: commit 74fd8a97e67cb8ab0da073e94a54804a66ca8e40<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002214/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002216"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Full commit hashes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2024 14:45 UTC (Sun)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/1002216/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This works better when forges are involved in rendering such things where, generally, a hover will show context on what it is. However, when just using `git log`, I think the date/subject are very helpful. Of course, nothing is stopping anyone from adding such LSP-like behaviors to `vim-fugitive` or Magit, but they don't exist yet AFAIK. And even that is requiring using some kind of smarter tooling than `| less` that is the prevalent default.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002216/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1002413"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Full commit hashes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2024 23:53 UTC (Mon)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/1002413/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Wonder if there is any sane way for `git log` itself to render them, maybe with an option.<br>
<p>
There is a hyperlink ANSI escape sequence, and it seems that you can include arbitrary text as the "URL".<br>
<p>
On GNOME Terminal at least, that means you can create an underlined sequence, that on mouse hover, will show the commit message summary. Since it strips out tabs, LF and probably more, you can't add the full commit message though.<br>
<p>
<a href="https://github.com/Alhadis/OSC8-Adoption">https://github.com/Alhadis/OSC8-Adoption</a><br>
<a href="https://gist.github.com/egmontkob/eb114294efbcd5adb1944c9f3cb5feda">https://gist.github.com/egmontkob/eb114294efbcd5adb1944c9...</a><br>
<p>
Unfortunately the hover part isn't implemented in Ptyxis, which is the successor to GNOME Console, which was the successor to GNOME Terminal.<br>
<p>
KDE Konsole also doesn't enable hyperlink support by default.<br>
<p>
<a href="https://github.com/Alhadis/OSC8-Adoption/pull/18">https://github.com/Alhadis/OSC8-Adoption/pull/18</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002413/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor1002231"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Full commit hashes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2024 17:29 UTC (Sun)
                               by <b>adobriyan</b> (subscriber, #30858)
                              [<a href="/Articles/1002231/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;I always refer to full commit hashes in commit messages, I wonder how popular that is.</span><br>
<p>
They are de facto banned in our beloved kernel.<br>
<p>
<a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/scripts/checkpatch.pl?h=v6.13-rc2#n3242">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002231/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor1002236"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Using a forge identifier</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2024 19:27 UTC (Sun)
                               by <b>sunshowers</b> (guest, #170655)
                              [<a href="/Articles/1002236/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Interestingly, large organizations, with repositories orders of magnitude bigger than the Linux kernel, tend to use other unique identifiers in places like commit messages. The most common one is identifiers issued by whatever forge they're using.<br>
<p>
I worked on source control at Facebook/Meta for many years, where every commit had a numerically increasing "Differential ID" associated with it, corresponding to the forge in use. The IDs had deep integration with the source control system, so you could run "hg update D123456" and your working copy would be updated to that revision.<br>
<p>
On GitHub, it's common to use the PR number for the same purpose. Gerrit also issues identifiers I believe.<br>
<p>
The Jujutsu VCS has change IDs which stay stable  across amends and rebases, but they aren't shared across clones so are less useful as common identifiers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1002236/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2024, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
