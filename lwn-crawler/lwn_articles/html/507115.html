        <!DOCTYPE html>
        <html lang="en">
        <head><title>Random numbers for embedded devices [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/507115/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/506531/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/507115/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Random numbers for embedded devices</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>LWN.net needs you!</b>
<p>
Without subscribers, LWN would simply not exist.  Please consider
       <a href="/Promo/nst-nag2/subscribe">signing up for a subscription</a> and helping
       to keep LWN publishing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>July 17, 2012</br>
           </div>
Secure communications are dependent on good cryptography, and cryptography,
in turn, is dependent on good random numbers.  When cryptographic keys are
generated from insufficiently-random values, they may turn out to be easily
guessable by an attacker, leaving their user open to eavesdropping and
man-in-the-middle attacks.  For this reason, quite a bit of attention has
been put into random number generation, but that does not mean that
problems do not still exist.  A set of patches intended for merging into
the 3.6 kernel highlight some of the current concerns about random number
generation in Linux.
<p>

Computing systems traditionally do not have sources of true randomness
built into them.  So they have operated by attempting to extract randomness
from the environment in which they operate.  The fine differences in timing
between a user's keystrokes are one source of randomness, for example.
The kernel can also use factors like the current time, interrupt timing,
and more.  For a typical desktop system, such sources usually provide
enough randomness for the system's needs.  Randomness gets harder to come
by on server systems without a user at the keyboard.  But the hardest
environment of all may be embedded systems and network routers; these
systems may perform 
important security-related tasks (such as the generation of host keys)
before any appreciable randomness has been received from the environment.
<p>
As Zakir Durumeric, Nadia Heninger, J. Alex Halderman, and
Eric Wustrow have <a href="https://factorable.net/">documented</a>, many of
the latter class of systems are at risk, mostly as a result of keys
generated with insufficient randomness and predictable initial conditions.
They write: "<q>We found that 5.57% of TLS hosts and 9.60% of SSH hosts
share public keys in an apparently vulnerable manner, due to either
insufficient randomness during key generation or device default
keys.</q>"  They were also able to calculate the actual keys used for a
rather smaller (but still significant) percentage of hosts.  Their site
includes a key checker; concerned administrators may point it at their
hosts to learn if their keys are vulnerable.
<p>
Fixes for this problem almost certainly need to be applied at multiple
levels, but kernel-level fixes seem particularly important since the kernel
is the source for most random numbers used in cryptography.  To that end,
Ted Ts'o has put together <a href="/Articles/507135/">a set of patches</a>
designed to improve the amount of randomness available in the system from
when it first boots.  Getting there involves making a number of changes.
<p>
One of those is to fix the internal <tt>add_interrupt_randomness()</tt>
function, which is used to derive randomness from interrupt timing.  Use of
this function has been declining in recent years, as a result of both its
cost and concerns about the actual randomness of many interrupt sources.
Ted's patch set tries to address the cost by batching interrupt-derived
randomness on a per-CPU basis and only occasionally mixing it into the
system-wide entropy pool.  That mixing is also done with a new, lockless
algorithm; this algorithm contains some small race conditions, but those
could be seen to make the result even more random.  An attempt is
made to increase the amount of randomness obtained from interrupts by
mixing in additional data, including the value of the instruction pointer
at the time of the interrupt.  After this change, adding randomness from
interrupts should be fast and effective, so it is done by default for
<i>all</i> interrupts; the <tt>IRQF_SAMPLE_RANDOM</tt> interrupt flag no
longer has any effect.
<p>
Next, the patch set adds a new function:
<p>
<pre>
    void add_device_randomness(const void *buf, unsigned int size);
</pre>
<p>
The purpose is to allow drivers to mix in device-specific data that, while
not necessarily random, is system-specific and unpredictable.  Examples
include serial, product, and manufacturer information from attached USB
devices, the "write counter" from some realtime clock devices, and the MAC
address from network devices.  Most of this data should be random from the
point of view of an attacker; it should help to prevent the situation where
multiple, newly-booted devices generate the same keys.
<p>
Finally, Ted's patch set also changes the use of the hardware random number
generator built into a number of CPUs.  Rather than return random numbers
directly from the hardware, the code now mixes hardware random data into
the kernel's entropy pool and generates random numbers from there.  His
reasoning is that using hardware random numbers directly requires placing a
lot of trust in the manufacturer:
<p>
<div class="BigQuote">
	It's unlikely that Intel (for example) was paid off by the US
	Government to do this, but it's impossible for them to prove
	otherwise --- especially since Bull Mountain is documented to use
	AES as a whitener.  Hence, the output of an evil, trojan-horse
	version of RDRAND is statistically indistinguishable from an RDRAND
	implemented to the specifications claimed by Intel.  Short of using
	a tunneling electronic microscope to reverse engineer an Ivy
	Bridge chip and disassembling and analyzing the CPU microcode,
	there's no way for us to tell for sure.
</div>
<p>
Mixing hardware random data into the entropy pool helps to mitigate that
threat.  The first time this patch came around, Linus <a
href="/Articles/507140/">rejected it</a>, saying "<q>It would be a total
PR disaster for Intel, so they have huge incentives to be
trustworthy.</q>"  That opinion <a href="/Articles/506407/">was not
universally shared</a>, though, and the patch remains in the current set.
Chances are it will be merged in its current form.
<p>
An important part of the plan, though, is to get these patches into the
stable updates despite their size.  Then, with luck, device manufacturers
will pick them up relatively quickly and stop shipping systems with a known
weakness.  Even better would be, as Ted <a
href="/Articles/507153/">suggested</a>, to make changes at the user-space
levels as well.  For example, delaying key generation long enough to let
some randomness accumulate should improve the situation even more.  But
making things better at the kernel level is an important start.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Random_numbers">Random numbers</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-Random_number_generation">Security/Random number generation</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Random_number_generation">Random number generation</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/507115/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor507374"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Random numbers for embedded devices</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2012 3:33 UTC (Thu)
                               by <b>rbrito</b> (guest, #66188)
                              [<a href="/Articles/507374/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I just skimmed some of the patches (not the rest of the code, which may mean that I'm missing context), but what is reason for having the pool initialized to something while not adding entropy, as mentioned in the commit message of Ted's patch number 4?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507374/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507414"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Random numbers for embedded devices</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2012 9:50 UTC (Thu)
                               by <b>ilmari</b> (guest, #14175)
                              [<a href="/Articles/507414/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The "not adding entropy" refers to not incrementing the kernel's estimate of the amount of entropy in the pool, since the data being mixed in isn't really very random.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507414/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor507440"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Random numbers for embedded devices</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 19, 2012 15:19 UTC (Thu)
                               by <b>cpeterso</b> (guest, #305)
                              [<a href="/Articles/507440/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Can the expensive mixing operations be moved to get_random_bytes(), so the mixing is only done when needed and the cost is paid by the caller, not interrupt handlers?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507440/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507554"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Random numbers for embedded devices</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2012 0:53 UTC (Fri)
                               by <b>pr1268</b> (subscriber, #24648)
                              [<a href="/Articles/507554/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>That might make <tt>get_random_bytes()</tt> <i>very</i> expensive (relatively speaking).  My suggestion is that the mixing operations happen only when the entropy pool gets below a low-water mark (but then again perhaps this might make the RNG a little more vulnerable; I'm not totally sure about this).</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/507554/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor507829"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Random numbers for embedded devices</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2012 17:14 UTC (Mon)
                               by <b>tytso</b> (subscriber, #9993)
                              [<a href="/Articles/507829/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The expensive (i.e., cryptographic) operations are already in get_random_bytes().   What we do amortized across multiple interrupts is a few xors, a rotate, and some memory accesses into a per-CPU memory pool.   So the bulk of the cost is already paid by the processes that need random numbers.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507829/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor507573"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definitely not speaking for my employer, but here goes..</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2012 6:04 UTC (Fri)
                               by <b>DavidJohnston</b> (guest, #85852)
                              [<a href="/Articles/507573/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The argument that the random numbers from the RdRand instruction cannot be trusted, compared to the kernel RNG algorithms that extract entropy from interrupt timing doesn't really hold water. Especially in light of the recent studies showing the lack of boot time entropy.<br>
<p>
To suggest that users 'wait' for entropy to be available from the kernel when their platform provides copious amounts of entropy before the first instruction has executed suggests that it is the kernel that is the problem, not the platform or user behavior.<br>
<p>
Compared to the treatment of most CPU logic, Intel has been extraordinarily open with the design on the RNG, exposing the full algorithmic details and opening the design for external review. I've yet to see an comparable expositions of why we should believe the Kernel entropy gathering code achieves a well defined min-entropy.<br>
<p>
When a user has paid for and deployed a RdRand capable machine that solves their boot time entropy problem, it is not in that user's interests that a paranoid design philosophy in the kernel leads to the user getting no entropy, rather than the 150MB/s+ that the platform can provide. They need the random numbers, not advice on who to trust and they should get those numbers if they trust the platform they run their software on. <br>
<p>
Lack of entropy has been a problem that has dogged computer security for decades. Now that we are in sight of a comprehensive solution in hardware, the right approach for the kernel is to facilitate high bandwidth access to entropy through the /dev/[u]random interfaces, drawing from the underlying hardware.<br>
<p>
The right approach for application software is to dispense with slow, large attack surface libraries and kernel calls and use the instruction based sources directly, rendering themselves immune from a large class of side channel and memory based attacks that can be raised against software entropy extractors and PRNGs. Existing and new software might continue to use /dev/[u]random, but where security and performance are a goal, RdRand and AES-NI are simply better.<br>
<p>
The primary goal of RdRand is to make the platform entropy problem simply go away. In time it will, but we are in a position to speed the process by making the right design decisions, so the non cryptographers stand a chance of their security software working for them.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507573/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507580"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definitely not speaking for my employer, but here goes..</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2012 8:55 UTC (Fri)
                               by <b>Aissen</b> (subscriber, #59976)
                              [<a href="/Articles/507580/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <p><cite>
Compared to the treatment of most CPU logic, Intel has been extraordinarily open with the design on the RNG, exposing the full algorithmic details and opening the design for external review. I've yet to see an comparable expositions of why we should believe the Kernel entropy gathering code achieves a well defined min-entropy.
</cite></p>

Could you provide links to the papers, algorithms and design source code ?

      
          <div class="CommentReplyButton">
            <form action="/Articles/507580/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507595"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definitely not speaking for my employer, but here goes..</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2012 12:39 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/507595/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Links to proof that what's in the CPU matches that design would be necessary too, before this can be trusted. The point about those sources that currently contribute to the entropy estimate is that they are only those sources which an external observer can see cannot be controlled or predicted by an attacker. Something impossible to inspect buried inside your CPU by a major corporation is... not worthy of the same degree of trust.<br>
<p>
It's not even worthy of the same degree of trust as, say, the Simtec Entropy Key, because at least Simtec is a small company and you can in theory get to know the people who did the work and become as sure as you wish that they did not get nobbled by the secret services -- though even that entropy is somewhat less trustworthy than environmental entropy not derived from a necessarily-opaque IC. Intel? It's a behemoth, and we know it therefore does business with all sorts of people. Who knows what pressures may have been brought to bear?<br>
<p>
This isn't saying that I think pressures *were* brought to bear on Intel to nobble their RNGs -- it's just that had they *been* brought to bear, the design would have looked just like we see now (as the nobbling would happen later in the process, with less risk of public exposure), and the CPUs that resulted would have looked from the outside *just like the ones we see now* except that their 'random' numbers would be predictable by a suitably-privileged outside attacker. So we cannot distinguish between those cases, so cannot grant the entropy derived from those CPUs the same definitely-unpredictable status as entropy derived from environmental noise.<br>
<p>
(This is not, of course, unique to Intel. I consider uninspectable RNGs and binary crypto blobs from all vendors untrustworthy, but larger vendors are probably less trustworthy than smaller ones, regardless of the quality of their engineering or employees, simply because they are easier for the security services to quietly nobble.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507595/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507684"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definitely not speaking for my employer, but here goes..</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2012 3:22 UTC (Sat)
                               by <b>DavidJohnston</b> (guest, #85852)
                              [<a href="/Articles/507684/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Then I suspect no hardware product will meet your needs.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507684/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507707"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definitely not speaking for my employer, but here goes..</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2012 13:48 UTC (Sat)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/507707/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Precisely my point. Or, rather, they do meet my needs, but my needs do not include having this stuff contribute to the entropy estimate. I can't trust that it is truly entropy. That doesn't mean it won't help keep your random numbers look random, of course: it still mixes into the pool.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507707/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor512243"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definitely not speaking for my employer, but here goes..</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2012 16:32 UTC (Sat)
                               by <b>kjp</b> (guest, #39639)
                              [<a href="/Articles/512243/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Use an FM or TV tuner and use the white noise for entropy.  I'd trust that.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/512243/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor512277"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definitely not speaking for my employer, but here goes..</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2012 21:37 UTC (Sat)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/512277/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Really? That noise is often fearfully non-random and highly correlated, and anyone with a radio transmitter or indeed any electrical device can introduce new patterning. It's... not a good noise source on its own (though obviously it contains noise, so it could probably contribute *some* entropy.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/512277/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor507830"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definitely not speaking for my employer, but here goes..</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2012 17:19 UTC (Mon)
                               by <b>tytso</b> (subscriber, #9993)
                              [<a href="/Articles/507830/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Of course there could be hardware products that would meet an independent auditability criteria.  It would require a completely open hardware design where the only thing that is done in hardware is a noise diode, and the minimal circuitry to convert the analog signal into a digital one.   A quick google search reveraled something like this that could perhaps be used as a basis of such an implementation:<br>
<p>
<a href="https://mywebspace.wisc.edu/lnmaurer/web/minirng/minirng.html">https://mywebspace.wisc.edu/lnmaurer/web/minirng/minirng....</a><br>
<p>
Add a simple USB interface so it can be plugged into a laptop or a server, but the key point is that it's a open hardware design, using basic commodity parts whose operation can be easily verified.<br>
<p>
Then what we do in open source software is all of the hard work of analyzing the raw output of the hardware circuit, to make sure it hasn't failed, and then all of the whitening using AES, etc.    Alternatively, we could take the unwhitened output and just feed it into /dev/random (since the /dev/[u]random entropy pools will take care of doing the whitening for us).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507830/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507948"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definitely not speaking for my employer, but here goes..</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 24, 2012 16:59 UTC (Tue)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/507948/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>
Alternatively, we could take the unwhitened output and just feed it into /dev/random (since the /dev/[u]random entropy pools will take care of doing the whitening for us).
</blockquote>
This is exactly what the Entropy Key's daemon does. There's no point in engaging in whitening and the like, since the key already does all of that (mixing together the output of two RNGs, making sure they are not correlated, and the like) and the daemon just asks the key 'are you broken?' and stops feeding entropy into /dev/random if it says it is.
      
          <div class="CommentReplyButton">
            <form action="/Articles/507948/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor507679"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definitely not speaking for my employer, but here goes..</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2012 3:11 UTC (Sat)
                               by <b>DavidJohnston</b> (guest, #85852)
                              [<a href="/Articles/507679/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;Could you provide links to the papers, algorithms and design source code ? </font><br>
The design source code isn't available. There's a lot more to designing chip RTL at 22nm than just the implementation of the algorithms, so I'm not at liberty to reveal the source code.<br>
<p>
I'm working towards making some C code available that models the design. This served as part of the design validation (it helps show model equivalence and calibrate entropy estimates) but could also answer a lot of the detail questions people have about the nature of the raw entropy.<br>
<p>
Patrick OKeef has done an efficient job of linking to all the information that is out there. <a href="https://sites.google.com/site/intelrdrand/references">https://sites.google.com/site/intelrdrand/references</a><br>
<p>
You might find Jesse Walker's talk, particularly the stuff at the end on the Ornstein-Uhlenback process (which nicely models ES) informative. <a href="http://www.ists.dartmouth.edu/docs/walker_ivy-bridge.pdf">http://www.ists.dartmouth.edu/docs/walker_ivy-bridge.pdf</a><br>
<p>
The Intel Developer Forum talk should be out there somewhere. If not I can send it. <br>
<p>
These guys performed external review. They did get to see the source code and had access to raw data and the engineers. Fortunately for us they didn't find anything too horrendous. The paper is here: <a href="http://www.cryptography.com/public/pdf/Intel_TRNG_Report_20120312.pdf">http://www.cryptography.com/public/pdf/Intel_TRNG_Report_...</a><br>
<p>
I described the details of the conditioning algorithms here: <a href="http://software.intel.com/en-us/forums/showthread.php?t=104200">http://software.intel.com/en-us/forums/showthread.php?t=1...</a><br>
<p>
There's more on the way, but we have to write it first.<br>
<p>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507679/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor507691"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definitely not speaking for my employer, but here goes..</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2012 5:56 UTC (Sat)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/507691/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
you don't have to 'wait' if you are willing to trust the /dev/urandom source, you only have to wait if you insist on getting a 'guarantee' that you are getting true randomness as opposed to just the best that the system can do.<br>
<p>
The system will use the hardware RNG to modify the output of /dev/random and /dev/urandom, the only thing is that it doesn't increment the "guaranteed randomness available" counter.<br>
<p>
realistically, I don't think it makes sense for anyone to depend on /dev/random and the 'available entropy' counter, the few cases that have super strict randomness guarantee requirements should just have a separate source of randomness<br>
<p>
think of this as improving the quality of /dev/urandom rather than failing to get the full randomness of the hardware RNG <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507691/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor509792"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Definitely not speaking for my employer, but here goes..</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 5, 2012 4:14 UTC (Sun)
                               by <b>mina86</b> (guest, #68442)
                              [<a href="/Articles/509792/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
We should trust them because we all know that Intel would never release buggy hardware like random number generator or, oh I don't know, a floating point unit. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/509792/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor507666"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Random numbers for embedded devices</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2012 8:38 UTC (Sat)
                               by <b>PaXTeam</b> (guest, #24616)
                              [<a href="/Articles/507666/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
concerned/interested readers might want to check out the latent_entropy plugin featured in the latest PaX patch. the idea is very simple: each basic block of boot-only functions is instrumented to compute a random function (based on add/xor/rol, hi Halvar :) whose output is then fed into the input/nonblocking pools after each initcall. tests show that even an allnoconfig amd64 kernel under qemu produces a few bits of entropy. at this point i'm interested in real field tests with embedded systems, so feel free to contribute :).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507666/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor507730"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">MAC address as random input?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2012 22:42 UTC (Sat)
                               by <b>Max.Hyre</b> (subscriber, #1054)
                              [<a href="/Articles/507730/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      This may just exemplify a little learning being a dangerous thing, but doesn't IPv6 put the MAC address in the packet header?  If so, ungood.
      
          <div class="CommentReplyButton">
            <form action="/Articles/507730/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor507850"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">MAC address as random input?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2012 19:14 UTC (Mon)
                               by <b>BenHutchings</b> (subscriber, #37955)
                              [<a href="/Articles/507850/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      By default, the local part of the IPv6 address is the MAC address with 16 constant bits in the middle. There is an option to use 'privacy extensions' which means the local part is randomised (sysctl net.ipv6.conf.all.use_tempaddr; <a href="http://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt">Documentation/networking/ip-sysctl.txt</a>).
      
          <div class="CommentReplyButton">
            <form action="/Articles/507850/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor508132"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">MAC address as random input?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2012 18:45 UTC (Wed)
                               by <b>kleptog</b> (subscriber, #1183)
                              [<a href="/Articles/508132/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Note that the default varies by implementation. Various versions of windows default to privacy extensions.<br>
<p>
Privacy extensions means your IP changes regularly, usually once a day. For servers you don't want that, but for client PCs the tradeoff is different. If it bugs you you can set the IP address yourself.<br>
<p>
Note the link-local address always includes your MAC address, but that address never leaves the LAN, and everyone on your LAN needs your MAC address anyway to talk to you.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/508132/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor508204"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">MAC address as random input?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2012 12:18 UTC (Thu)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/508204/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>More accurately, it adds an extra IP that changes regularly; you still have the permanent IP that you would have if you didn't enable privacy extensions, but you also have a temporary IP that changes, and that is used in preference to your permanent IP for outgoing connections.
<p>The idea is that if you give me your permanent IP, I can connect to you. If you don't, the only IP of yours I know about is your temporary IP, which changes regularly - so while it's fine for the duration of communication you initiated, it's not useful in a few days time.
      
          <div class="CommentReplyButton">
            <form action="/Articles/508204/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor507907"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">MAC address as random input?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2012 21:37 UTC (Wed)
                               by <b>pjm</b> (guest, #2080)
                              [<a href="/Articles/507907/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Another thing to note is that it doesn't hurt to add lots of attacker-known data to the pool, so long as there's at least k bits of attacker-unknown data also in the pool.  So using the MAC address by default is fine if there are some systems where attackers don't trivially know the value.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/507907/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor508188"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">MAC address as random input?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2012 8:01 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/508188/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Quite. This is one reason why the BSDs et al don't bother with an entropy estimate: as long as there's *some* entropy, you're fine, and if it's wrong, you're very much not fine.<br>
<p>
(I like the entropy estimator for a much more selfish reason: collecting randomness from some sources can be quite expensive, and we can use the entropy estimator as a high-water-mark to indicate that there's no point whatsoever providing more randomness because nobody's read much since we last shoved a bunch in. We could do much the same thing with a simple counter of "bytes read from /dev/*random by other users since last entropy fed in by a /dev/random writer", but that leaks information about those other users and might be considered ugly. The BSDs don't have a counter like this, and it makes the ekeyd ridiculously costly on those platforms because it has to pull entropy from the key and remix it for /dev/random all the time, even if the system is otherwise totally idle.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/508188/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2012, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
