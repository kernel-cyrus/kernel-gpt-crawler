        <!DOCTYPE html>
        <html lang="en">
        <head><title>Device tree troubles [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/560523/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/559491/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/560523/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Device tree troubles</h1>
</div>
<div class="ArticleText">
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>July 24, 2013</br>
           </div>
Kernel developers working on the x86 architecture are spoiled; they develop
for hardware that, for the most 
part, identifies itself when asked, with the result that it is usually easy
to figure out how a specific machine is put together.  Other architectures
— most notably ARM — are rather messier in this regard, requiring the
kernel to learn about the configuration of the hardware from somewhere
other than the hardware itself.  Once upon a time, hard-coded "board files"
were used to build ARM-system-specific kernels; more recently, the <a
href="http://devicetree.org/Device_Tree_Usage">device tree</a> mechanism
has emerged as the preferred way to describe a system to the kernel.  A
device tree file provides the enumeration information that the hardware
itself does not, allowing the kernel to understand the configuration of the
system it is running on.  The device tree story is one of success, but,
like many such stories, success is bringing on some growing pains.
<p>
A device tree "binding" is the specification of how a specific piece of
hardware can be described in the device tree data structure.  Most drivers
meant to run on platforms where device trees are used include a
documentation file describing that driver's bindings; see <a
href="/Articles/560533/">Documentation/devicetree/bindings/net/can/cc770.txt</a>
as a randomly chosen example.  The kernel contains nearly 800 such files,
plus a hundreds more "<tt>.dts</tt>" files describing complete
system-on-chips and boards, and the number is growing rapidly.
<p>
Maintenance of those files is proving to be difficult for a number of
reasons, but the core of the problem can be understood by realizing that a
device tree 
binding is a sort of API that has been exposed by the kernel to the world.
If a driver's 
bindings change in an incompatible way, newer kernels may fail to boot on
systems with older device trees.  Since the device tree is often buried in
the system's firmware somewhere, this kind of problem can be hard to fix.
But, even when the fix is easy, the kernel's normal API rules should apply;
newer kernels should not break on systems where older kernels work.
<p>
The clear implication is that new device tree bindings need to be reviewed
with care.  Any new bindings should adhere to existing conventions, they
should describe the hardware completely, and they should be supportable
into the future.  And this is where the difficulties show up, in a couple
of different forms: (1)&nbsp;most subsystem maintainers are not device tree
experts, and thus are not well equipped to review new bindings, and
(2)&nbsp;the maintainers who <i>are</i> experts in this area are overworked
and having a hard time keeping up.
<p><blockquote class="ad">
<b><tt>$ sudo subscribe today</tt></b>
<p>
Subscribe today and elevate your LWN privileges. You’ll have
access to all of LWN’s high-quality articles as soon as they’re
published, and help support LWN in the process.  <a href="https://lwn.net/Promo/nst-sudo/claim">Act now</a> and you can start with a free trial subscription.
</blockquote>
<p>
The first problem was the subject of <a
href="https://lists.linuxfoundation.org/pipermail/ksummit-2013-discuss/2013-July/000110.html">a
request for a Kernel Summit discussion</a> with the goal of educating
subsystem maintainers on the best practices for device tree bindings.
One might think that a well-written document would suffice for this
purpose, but, unfortunately, these best practices still seem to be in the
"I know it when 
I see it" phase of codification; as Mark Brown <a
href="/Articles/560544/">put it</a>:
<p>
<div class="BigQuote">
	At the minute it's about at the level of saying that if you're not
	sure or don't know you should get the devicetree-discuss mailing
	list to review it.  Ideally someone would write that document,
	though I wouldn't hold my breath and there is a bunch of convention
	involved.
</div>
<p>
Said mailing list tends to be overflowing with driver postings, though,
making it less useful than one might like.  Meanwhile, the best guidance,
perhaps, came from <a href="/Articles/560546/">David Woodhouse</a>:
<p>
<div class="BigQuote">
	The biggest thing is that it should describe the *hardware*, in a
	fashion which is completely OS-agnostic.  The same device-tree
	binding should work for Solaris, *BSD, Windows, eCos, and
	everything else.
</div>
<p>
That is, evidently, not always the case, currently; some device tree
bindings can be strongly tied to specific kernel versions.  Such bindings
will be a maintenance problem in the long term.
<p>
Keeping poorly-designed bindings out of the mainline is the responsibility
of the device tree maintainers, but, as Grant Likely (formerly one of those
maintainers) <a href="/Articles/560547/">put it</a>, this maintainership
"<q>simply isn't working right now.</q>"  Grant, along with Rob
Herring, is unable to keep up with the stream of new bindings (over 100 of
which appeared in 3.11), so a lot of substandard bindings are finding their
way in.  To address this problem, Grant has announced a "refactoring" of
how device tree maintainership works.
<p>
The first part of that refactoring is Grant's own resignation, with lack of
time given as the reason.  In his place, four new maintainers (Pawel Moll,
Mark Rutland, Stephen Warren and Ian Campbell) have been named as being
willing to join Rob and take responsibility for device tree bindings;
others with an interest in this area are encouraged to join this group. 
<p>
The next step will be for this group to figure out how device tree
maintenance will actually work; as Grant noted, "<q>There is not yet any
process for binding maintainership.</q>" For example, should there be a
separate repository for device tree bindings (which would make review
easier), or should they continue to be merged through the relevant
subsystem trees (keeping the code and the bindings together)?  It will take
some time, and possibly a Kernel Summit discussion, to figure out a proper
mechanism for the sustainable maintenance of device tree bindings.
<p>
Some other changes are in the works.  The kernel currently contains
hundreds of <tt>.dts</tt> files providing complete device trees for
specific systems; there are also many <tt>.dtsi</tt> files describing
subsystems that can be included into a complete device tree.  In the short
term, there are plans to design a schema that can be used to formally
describe device tree bindings; the device tree compiler utility
(<tt>dtc</tt>) will then be able to verify that a given device tree file
adheres to the schema.  In the longer term, those device tree files are
likely to move out of the kernel entirely (though the binding documentation
for specific devices will almost certainly remain).
<p>
All told, the difficulties with device trees do not appear to be anything
other than normal growing pains.  A facility that was once only used for a
handful of PowerPC machines (in the Linux context, anyway) is rapidly
expanding to cover a sprawling architecture that is in wide use.  Some
challenges are to be expected in a situation like that.  With luck and a
fair amount of work, a better set of processes and guidelines for device
tree bindings will result from the discussion — eventually.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Device_tree">Device tree</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/560523/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor560711"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2013 11:59 UTC (Thu)
                               by <b>linusw</b> (subscriber, #40300)
                              [<a href="/Articles/560711/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks for doing this write-up Jon. As noted in another thread in the Ksummit mailing list, ACPI (the other hardware description tree) has its own set of similar troubles, just not yet as big, with x86 drivers going back to pre-PCI ISA-style ioport probing for devices. I would say it is something of an embedded or shorter-development cycle problem. (I characterized it as vendors constantly keeping on finger on the fast-forward button.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/560711/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor560740"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2013 14:30 UTC (Thu)
                               by <b>etienne</b> (guest, #25256)
                              [<a href="/Articles/560740/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It seems that device trees are also used to describe ARM "system on chip" even when the macro-blocks can be probed by software, having unique signature and even version information available at predefined addresses.<br>
Just nobody did take the time to write that auto-detection, or had all the NDA necessary.<br>
Shall the device tree describe the macro-compoments or only the different chips on the board (like how much DDR is on the card, at which I2C address is that subsystem)?<br>
Is the device tree a way to replace Linux command line?<br>
When the device tree is "glued" to the kernel to ease the boot process (instead of fixed ROM like interface), would it not be better to use linker command file to define all those constants?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/560740/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor560749"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2013 15:27 UTC (Thu)
                               by <b>dougg</b> (guest, #1894)
                              [<a href="/Articles/560749/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I get to have a down under (looking up) view of DT for various Atmel SoCs: at91sam9g20, g25 and the sama5d3. Forget auto-detect of macrocells: there are so many (I just counted 38 on the sama5d3 and that is without instances, so I counted 1 for the PIO but there are 5 instances), that they can't all be configured. At least two reasons: the 160 gpio pins would be insufficient to route them to the outside of the chip, and the power budget for the chip would probably get blown (literally). The main way that SoCs save power is by _not_ configuring macrocells (or configure them at lower clock frequencies). So again auto-detect is just wrong for SoCs.<br>
Well yes, DT is a replacement for the kernel command line which obviously can't handle the amount of data we are talking about here. And having a specific DT blob boot the same SoC on another OS is a nice idea, I'd put that in the same category as nuclear fusion for large scale electricity generation :-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/560749/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor560925"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2013 9:45 UTC (Fri)
                               by <b>etienne</b> (guest, #25256)
                              [<a href="/Articles/560925/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I also deal with a complex Sitara ARM Cortex-A8 system on chip, where each subsystem can be independently switched ON or OFF, can be independently clocked or un-clocked, and can be active or sleeping.<br>
I do think that every subsystem shall be known by the kernel, so that at boot the kernel turns OFF everything he does not need.<br>
Else you get in a situation where software version N+1 manages a new subsystem, and if you reboot the card (hot boot) into version N the "new subsystem" is still powered ON and clocked - unlike cold boot into version N.<br>
<p>
What I really want is an ELF boot-loader (which can load multiple sections at different addresses) and a C description of all these subsystems, so that the memory mapped address range are initialised in this order:<br>
- value for all I/O ports (in C, const port42_t port42 = (port42_t) {1, 0}; - not 10000's of #define)<br>
- direction for all I/O port <br>
- functions of each package pins (which is currently managed by another set of software, not device tree)<br>
At that point of loading the Linux kernel I know that any previous crash which may have left I/O port short circuit is now fixed.<br>
Then I want the ELF file to contain pre-linked code&amp;data into the fast internal memory, so that is the next section of the ELF file. With device tree, one can only describe the internal memory, not its content, so all the loading/linking has to be done manually.<br>
Then the ELF boot-loader can load the kernel code &amp; data, and the initial ram disk if it is not directly mappable from FLASH.<br>
<p>
Tl,dr: use fewer tools (GCC and LD) to do more things, and do checks at link time, not execution time like device tree.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/560925/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor561135"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2013 18:28 UTC (Sat)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/561135/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Tl,dr: use fewer tools (GCC and LD) to do more things, and do checks at link time, not execution time like device tree.</font><br>
<p>
That's not very UNIX-like ;) . Personally, I think that if device trees could be used as a base for other kernels, we'll be better off[1] and making the format either code or an ELF binary doesn't help that.<br>
<p>
[1]For the BSDs, if/when a replacement for Linux comes along written in INTERCAL, etc.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/561135/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor561238"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2013 10:17 UTC (Mon)
                               by <b>etienne</b> (guest, #25256)
                              [<a href="/Articles/561238/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; That's not very UNIX-like ;)</font><br>
<p>
LD is very Unix like, it does one thing (turning symbols into real addresses) and does it right.<br>
You are saying that some symbols are different and shall be described by a complex device tree system?<br>
The DT is so complex even the boot-loader (U-boot) is not using it (because it has to be small to fit in the (256 Kb or less) internal memory), to find/initialise the serial port and have a command line interface...<br>
At some point, all the hardware addresses and I/O configuration have to be defined for the system to work, I am saying that there is no advantage to initialise those at boot (where no debugging is possible) compared to initialise them in the build Makefile, or at installation time by a final linker command (of a partially linked ELF file).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/561238/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor561242"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2013 10:45 UTC (Mon)
                               by <b>andresfreund</b> (subscriber, #69562)
                              [<a href="/Articles/561242/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I am saying that there is no advantage to initialise those at boot (where no debugging is possible) compared to initialise them in the build Makefile, or at installation time by a final linker command (of a partially linked ELF file).</font><br>
<p>
Except that the latter makes it pretty much fundamentally impossible to get to the point where you can boot one media on differing devices.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/561242/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor561244"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2013 11:12 UTC (Mon)
                               by <b>etienne</b> (guest, #25256)
                              [<a href="/Articles/561244/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; boot one media on differing devices</font><br>
<p>
Assuming you are talking of a SD-card (no CDROM/DVD), you probably already have an installation script to either select which DT to use (if the DT is on the SD-card) or how to access it (if the DT is on some FLASH on the board, at which address it is and how is the FLASH configured).<br>
Instead of having tools to upgrade/downgrade/display/edit the DT, is would be simpler to just do a final link in the install script.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/561244/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor561250"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2013 11:58 UTC (Mon)
                               by <b>andresfreund</b> (subscriber, #69562)
                              [<a href="/Articles/561250/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Assuming you are talking of a SD-card (no CDROM/DVD)</font><br>
SD-card, internal storage, USB, whatever. I am pretty happy that CDs are dying a rather rapid death these days.<br>
<p>
<p>
<font class="QuotedText">&gt; Instead of having tools to upgrade/downgrade/display/edit the DT, is would be simpler to just do a final link in the install script.</font><br>
<p>
I don't think that's really realistic. You'd need to get to the point of running a pretty much full blown OS to actually run a full elf linker. Those aren't simple beasts anymore. Also, linking a kernel image, even one trimmed for an embedded architecture, actually takes a good amount of resources.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/561250/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor561256"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2013 13:31 UTC (Mon)
                               by <b>etienne</b> (guest, #25256)
                              [<a href="/Articles/561256/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I don't think that's really realistic. You'd need to get to the point of running a pretty much full blown OS to actually run a full elf linker.</font><br>
<p>
Maybe I am underestimating the difference in between linking and relocating.<br>
We have already bootloaders which are able to relocate few sections at run-time on ia32, i.e. running "ld --emit-relocs" and moving those sections where appropriate.<br>
Even on Windows you could have a installation software which relocate few hundreds of sections to configure a SD-card (including it's own U-boot) to the right value for the targeted ARM hardware.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/561256/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor561537"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 31, 2013 6:52 UTC (Wed)
                               by <b>alison</b> (subscriber, #63752)
                              [<a href="/Articles/561537/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; if device trees could be used as a base for other kernels, we'll be better &gt; off[1] and making the format either code or an ELF binary doesn't help that.</font><br>
<p>
I'm reminded of (IIRC) the answer Rex Dieter gave when asked why KDE bothered to have a Windows version.   (paraphrasing) "Because requiring developers to create code that will run on Windows is the best guarantee of good level separation and cleaning coding practices."<br>
<p>
Just so with device-tree: if the bindings have names specific to Linux, then there will be a temptation to take the extra step of choosing bindings that are specific to particular kernel release, and then we'll never have the stable ABI.   While I argued with the stable ABI idea in the cited discussion thread, the discussion is more about how to practically achieve the goals and when, not what they are.     Forcing an OS-agnostic interface on the device-tree will force better coding practices, as Dieter expressed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/561537/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor560860"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2013 22:06 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/560860/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is stuff that you can't autodetect.<br>
<p>
The particular I/O pins can be used for many things, and if you send the wrong signals to the wrong pins you can seriously corrupt what's connected there (or in some cases, you can cause actual physical damage, since some of those pins may be connected to devices that affect the real world)<br>
<p>
That's why the kernel needs to get a description of the system from something other than the hardware itself.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/560860/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor560924"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2013 9:00 UTC (Fri)
                               by <b>etienne</b> (guest, #25256)
                              [<a href="/Articles/560924/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; That's why the kernel needs to get a description of the system from something other than the hardware itself.</font><br>
<p>
Obviously the kernel has to know the hardware, but the question is:<br>
Shall this description be compiled-in (#ifdef's), linked-in (an extra file on "ld" command line with lines like "uart1_base = 0x45000000;\n"), or glued-in in a device tree file which - if describing properly a system on chip - would be easily more than few thousand lines.<br>
Shall we pre-process by CPP the device tree description to add "#include", to protect against multiple inclusion, and have "#ifdef" everywhere?<br>
And all those functions to get a device tree value in the kernel, where you know that the address of that subsystem (for instance UART) is obviously constant, they do not really simplify the driver source - they have to handle errors like "device tree not loaded", "element not found" at run time (not at compile time or link time).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/560924/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor560971"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2013 13:33 UTC (Fri)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/560971/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; ...the address of that subsystem (for instance UART) is obviously constant...</font><br>
<p>
and this is the root of the misunderstanding.<br>
<p>
On ARM devices, the address of the UART is NOT consistent, there are many possible places for it to be, and the same physical pins that are used for one UART may be used for something else instead.<br>
<p>
So the kenrel needs to be told what device is hooked up to those pins.<br>
<p>
this isn't a matter of it being something that's defined for a particular SoC release, it can depend on how the board that it's plugged into is wired.<br>
<p>
And in addition to this, you can have another SoC model that's got most of the same features as the one I talked about above, but which has the different components hooked up on the chip differently, so the functions that share particular pins are going to be different.<br>
<p>
The alternative to DT isn't that the kernel will know what's there, or that the kernel can probe and figure out what's there. the alternative is that you will have to have a file included into the kernel build that tells the kernel about the system. At which point that kernel build cannot be used for any other system.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/560971/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor560976"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2013 14:31 UTC (Fri)
                               by <b>etienne</b> (guest, #25256)
                              [<a href="/Articles/560976/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &gt; ...the address of that subsystem (for instance UART) is obviously constant...</font><br>
<font class="QuotedText">&gt; and this is the root of the misunderstanding.</font><br>
<p>
I did not express myself precisely. It is constant at run time (C const), and will not change in between power-cycles.<br>
That is why it can be defined by the linker.<br>
If you want a common file in between few boards, that common file shall be a partial link, where few symbols are still not defined - the final link specialise that Linux kernel for that system on chip on that board.<br>
<p>
Trying to define pin functions in the pre-boot environment calls for problems, because for instance you still did not define what is the UART pins for the console - and cannot check anything beforehand - (no error log can be printed).<br>
At least at link time, errors can be produced if you define the console to an UART which does not have its pin configured for UART but for I/O port.<br>
<p>
For what I can see, most people attach the DT to the kernel one way or another (i.e. DT not constant for a board), because each new kernel version define more fields of DT or fixes DT bugs (DT would be too complex if it were complete, just define what you use) - and so the DT complexify the system (and slow it down) instead of simplifying it.<br>
Ever had a Device Tree: incomplete, wrong version, not at the right place in the FLASH, not present because someone erased that FLASH partition, truncated because the partition/sector_size is too small, corrupted, or the wrong DT file has been copied to FLASH?<br>
How do you recover that board, DHCP/BOOTP (present inside system-on-chip internal ROM) only transfer a single file, the Linux kernel - no DT!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/560976/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor561059"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2013 20:16 UTC (Fri)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/561059/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; just define what you use</font><br>
<p>
This is wrong, and this point is being made on the kernel list<br>
<p>
DT is supposed to describe the hardware period. It's supposed to do so not just for Linux, but for other OSs as well.<br>
<p>
If the hardware doesn't change, then the DT should not change. If it does, it should be a bug in the DT being fixed, or it's an API change (which should not be happening)<br>
<p>
by the way, where do you expect the data to come from to get linked into your binary?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/561059/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor561239"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2013 10:55 UTC (Mon)
                               by <b>etienne</b> (guest, #25256)
                              [<a href="/Articles/561239/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &gt; just define what you use</font><br>
&gt;<br>
<font class="QuotedText">&gt; This is wrong, and this point is being made on the kernel list</font><br>
<p>
Sorry no more reading LKML, not enough time.<br>
So you ask me to write those 10000 or more lines to describe that system on chip, with no real way to test?<br>
Did you see the complexity of those systems on chip lately, they have a defined area of silicon and a package pin count; they fit everything they can find.<br>
They do not even describe completely everything in their voluminous docs, they add reference to sub-parts: lately I wanted to check if there is a DMA in virtual address provided by the ARM subsystem (there are other DMAs in physical addresses in the system) - the only way to know is to ask the processor the content of a register (the docs only say where to read...).<br>
<p>
When that is done, I also have to define the hardware PCB with a few thousand lines of DT describing how the system could be used and then define how I use it?<br>
I am already happy when the hardware works the way it is supposed to do, I cannot claim what happens if you would use it another way - and anyway you wouldn't have such a PCB to play with...<br>
<p>
<font class="QuotedText">&gt; If the hardware doesn't change, then the DT should not change. If it does, it should be a bug in the DT being fixed</font><br>
<p>
Sorry, firmware in FPGA changed, loaded at run time, the DT description is variable depending on the filesystem content...<br>
<p>
<font class="QuotedText">&gt; by the way, where do you expect the data to come from to get linked into your binary?</font><br>
<p>
You write it from the same docs that you would write your DT from.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/561239/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor561324"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2013 16:56 UTC (Mon)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/561324/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;&gt; by the way, where do you expect the data to come from to get linked into your binary?</font><br>
<p>
<font class="QuotedText">&gt;You write it from the same docs that you would write your DT from.</font><br>
<p>
I was meaning, where does the system trying to boot find the data to link into your binary. you seem to be saying that the DTis no good because there's no place to store it, so where do you store this other data that needs to be linked?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/561324/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor561342"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2013 19:12 UTC (Mon)
                               by <b>etienne</b> (guest, #25256)
                              [<a href="/Articles/561342/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What I am saying is that you should not have 3 files (uboot, kernel, device tree) and try to combine the last two at a time where you cannot even display an error message.<br>
That is, combine the last two files at installation into the sdcard time, when you are running linux, windows or OSx to write that sdcard, when you can display error messages and check stuff.<br>
 In the PC world it would be at grub-install-kernel time.<br>
And what I then mean is all this complex DT is just doing what the LD linker do, but a lot more slowly, with a lot more code, and with errors delayed to execution time when it would be better to just use LD.<br>
TL,dr: no DT partition or file, generic kernel is partial link, specialised at installation time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/561342/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor561536"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 31, 2013 6:45 UTC (Wed)
                               by <b>alison</b> (subscriber, #63752)
                              [<a href="/Articles/561536/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;the alternative is that you will have to have a file included into the </font><br>
<font class="QuotedText">&gt; kernel build that tells the kernel about the system. At which point that </font><br>
<font class="QuotedText">&gt; kernel build cannot be used for any other system.</font><br>
<p>
I know, let's call that a "board file"!    Oh, wait . . .<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/561536/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor566131"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Device tree troubles</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2013 6:36 UTC (Tue)
                               by <b>glaesera</b> (guest, #91429)
                              [<a href="/Articles/566131/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There seems to be a discrepancy between the market, i.e. what people like to buy (very often an ARM-tablet or -smartphone instead of a PC-architecture notebook) and the underlying technical foundations and their understanding and living inside the cummunities.<br>
PC-developers are not spoiled, but the ARM-manufacturers are. They sold and sell very large quantities, but some time the market will be saturated.<br>
ARM is going to catch up with the PC-architecture, but it will most probably not be able to completely rule out x86(-64).<br>
It is going to be equally easy to set up a linux-installation on any ARM-device as it used to be on PCs, but the big hype will be mostly over then already.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/566131/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2013, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
