        <!DOCTYPE html>
        <html lang="en">
        <head><title>5.10 Merge window, part 1 [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/834157/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/834397/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/834157/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>5.10 Merge window, part 1</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Benefits for LWN subscribers</b>
<p>
The primary benefit from <a href="/Promo/nst-nag5/subscribe">subscribing to LWN</a>
       is helping to keep us publishing, but, beyond that, subscribers get
       immediate access to all site content and access to a number of extra
       site features.  Please sign up today!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>October 16, 2020</br>
           </div>
As of this writing, 7,153 non-merge changesets have been pulled into the
mainline Git repository for the 5.10 release â€” over a period of four days.
This development cycle is clearly off to a strong start.  Read on for an
overview of the significant changes merged thus far for the 5.10 kernel
release.
<p>

<h4>Architecture-specific</h4>
<p>
<ul class="spacylist">

<li> The arm64 architecture can now do performance-events monitoring
     over Arm's CMN-600 interconnect.
<li> The Arm v8.5 <a
     href="https://developer.arm.com/-/media/Arm%20Developer%20Community/PDF/Arm_Memory_Tagging_Extension_Whitepaper.pdf1">memory
     tagging extension [PDF]</a> is now supported.  This feature allows a
     four-bit tag to be assigned to every 16-byte "granule" in physical
     memory; whenever a pointer into a specific granule is dereferenced,
     the CPU will ensure that the tag stored in the pointer matches that
     assigned to the granule.  Proper use of this extension can trap
     use-after-free and buffer-overflow bugs (and attempts to exploit those
     bugs).  See <a href="/Articles/834289/">this article</a> for more
     information on this feature.
<li> The ia64 performance-monitoring code has been removed.  Few are likely
     to miss it, since it hasn't worked for years.
<li> AMD's "secure encrypted virtualization" (SEV) feature encrypts memory
     assigned to virtualized guests; Linux has supported SEV for a while.
     The new SEV-ES feature, merged for 5.10, expands SEV by encrypting the
     guest's processor 
     registers as well, making them unavailable to the host unless the
     guest explicitly shares them.
</ul>


<p>
<h4>Core kernel</h4>
<p>
<ul class="spacylist">

<li> The io_uring subsystem now supports <a href="/Articles/826053/">the
     creation of restricted rings</a> that can be passed safely to a
     less-trusted process.
<li> The <a
     href="https://man7.org/linux/man-pages/man2/pidfd_open.2.html"><tt>pidfd_open()</tt>
     system call</a> now supports a <tt>PIDFD_NONBLOCK</tt> flag to create
     a non-blocking file descriptor.  See <a
     href="https://git.kernel.org/linus/4da9af0014b5">this commit</a> for a
     thorough description of the semantics of non-blocking pidfds.
</ul>

<p>
<h4>Filesystems and block I/O</h4>
<p>
<ul class="spacylist">

<li> The Btrfs filesystem has gained some significant performance
     improvements in <tt>fsync()</tt> operations.
<li> XFS has seen a bunch of work to resolve its year-2038 problems;
     timestamps in this filesystem are now good through 2468.  Developers
     now have clear warning of a problem coming in 448 years, but chances
     are they will procrastinate on addressing it for at least 440 of
     them. 
</ul>

<p>
<h4>Hardware support</h4>
<p>
<ul class="spacylist">

<li> <b>Graphics</b>:
     Lontium LT9611 DSI/HDMI bridges,
     Toshiba TC358775 DSI/LVDS bridges,
     Toshiba TC358762 DSI/DPI bridges,
     Mantix MLAF057WE51-X MIPI-DSI LCD panels,
     Cadence DPI/DP bridges,
     Samsung S6E63M0 RGB DSI interfaces, and
     NXP i.MX8MQ display controllers.
<li> <b>Hardware monitoring</b>:
     Analog Devices ADM1266 sequencers,
     MPS MP2975 multi-phase controllers,
     Intel MAX10 BMC monitoring chips, and
     Moortec Semiconductor MR75203 PVT controllers.
<li> <b>Industrial I/O</b>:
     Analog Devices ADXRS290 dual-axis MEMS gyroscopes,
     AMS AS73211 XYZ color sensors, and
     TI HDC2010 relative humidity and temperature sensors.
<li> <b>Miscellaneous</b>:
     Amazon Annapurna Lab memory controllers,
     MediaTek MStar interrupt controllers,
     Xiphera XIP8001B true random number generators,
     Ingenic true random number generators,
     MCHP Sparx5 SDHC interfaces,
     Baikal-T1 SPI controllers,
     TI LP5036/30/24/18/12/9 LED controllers,
     Kontron sl28cpld interrupt/watchdog/PWM controllers,
     ENE KB3930 embedded controllers,
     Intel MAX 10 board management controllers,
     Kinetic KTD253 backlight drivers,
     Hisilicon 3670 SPMI controllers,
     Hisilicon Hi6421v600 SPMI power-management ICs, and
     Qualcomm SM8150 and SM8250 interconnect buses.
<li> <b>Pin control</b>:
     Qualcomm 8226 pin controllers,
     Actions Semi S500 pin controllers,
     Mediatek MT8192 and MT8167 pin controllers,
     Toshiba Visconti TMPV7700 series pin controllers, and
     Allwinner A100 pin controllers.
<li> <b>Regulator</b>:
     Richtek RT4801 regulators,
     Raspberry Pi 7-inch touchscreen panel ATTINY regulators,
     MediaTek MT6360 SubPMIC regulators, and
     Richtek RTMV20 load switch regulators.
<li> <b>Sound</b>:
     MediaTek MT6359 codecs,
     Microchip S/PDIF controllers,
     Cirrus Logic CS4234 codecs, and
     Texas Instruments TAS2764 mono audio amplifiers.
<li> <b>USB</b>:
     Hisilicon hi3670 USB PHYs,
     Mediatek MT6360 Type-C controllers,
     UniPhier AHCI PHYs,
     Intel Lightning Mountain USB PHYs,
     STMicroelectronics STUSB160x Type-C controllers,
     Maxim TCPCI based Type-C chips, and
     Qualcomm PMIC USB Type-C detectors.
<li> There is an entirely new user-space API for GPIO lines.  Naturally,
     this API is rigorously undocumented, but some information can be
     gleaned from <a href="https://git.kernel.org/linus/b53911aa872d">this
     commit</a>.
<li> The "raw" char device, which provides a classic Unix-style char
     interface to block devices, has been deprecated with the intention of
     removing it in the 5.14 release.  The raw device was primarily used
     for direct I/O, which has been supported via the <tt>O_DIRECT</tt>
     flag since 2002.
</ul>


<p>
<h4>Security-related</h4>
<p>
<ul class="spacylist">

<li> Support for the RC4-HMAC-MD5 KerberosV algorithm has been removed from
     the crypto subsystem.  This algorithm was created for compatibility
     with Windows 2000; according to <a
     href="https://git.kernel.org/linus/e33d2a7b3041">the commit</a>, its
     removal "<q>should only adversely affect interoperability with
     Windows NT/2000 systems that have not received any updates since 2008
     (but are connected to a network nonetheless)</q>".
<li> The <a href="https://tools.ietf.org/html/draft-shen-sm2-ecdsa-02">SM2
     digital-signature algorithm</a> is now supported.
<li> It is now possible to remove <tt>security.selinux</tt> extended
     attributes from files, but only before the SELinux policy is loaded.
     This makes it possible to "unlabel" files when SELinux is not being
     used. 
</ul>


<p>
<h4>Virtualization and containers</h4>
<p>
<ul class="spacylist">

<li> Support for <a
     href="https://aws.amazon.com/ec2/nitro/nitro-enclaves/">Amazon Nitro
     enclaves</a> has been added.  See <a
     href="/Articles/834427/">Documentation/virt/ne_overview.rst</a> for
     some more information.

</ul>

<p>
<h4>Internal kernel changes</h4>
<p>
<ul class="spacylist">

<li> The <a href="/Articles/831540/">seqcount latch</a> specialized
     lock type has been added.
<li> "Orphan sections" â€” code or data sections that find their way into the
     kernel image without having been explicitly put there by the linker
     script â€” will now generate warnings during the kernel build.  This
     change was made to protect the kernel from the possibility of unwanted
     changes in how linkers place those sections; the <a
     href="https://git.kernel.org/linus/34eb62d868d7">merge changelog</a>
     describes orphan sections as "<q>a long-standing source of obscure
     bugs</q>".
<li> Static calls are a mechanism for performing indirect function calls
     with better performance, especially on systems where <a
     href="https://support.google.com/faqs/answer/7625886">retpolines</a>
     would 
     otherwise have to be used to protect against Spectre vulnerabilities.
     This mechanism has <a href="/Articles/774743/#static">been under
     development since 2018</a>; it was finally merged for 5.10.
<li> The <tt>printk()</tt> subsystem has gained a new lockless ring buffer
     meant to be a first step in resolving a number of problems in this
     area.  See <a href="/Articles/800946/">this article</a> for an overall
     description of the <tt>printk()</tt> work, including the new ring
     buffer. 
<li> The minimum version of Clang needed to build the kernel is now 10.0.1.
</ul>
<p>

The 5.10 merge window can be expected to close on October&nbsp;25, after
which the stabilization portion of the development cycle will begin.  Stay
tuned for LWN's coverage of the second half of the 5.10 merge window, to be
published shortly after the window closes.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-5.10">Releases/5.10</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/834157/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor834516"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2020 4:42 UTC (Sat)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/834516/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Nitro Enclaves are interesting. I guess this means Amazon isn&#x27;t planning to follow Azure into nested virtualization. That&#x27;s probably a good decision.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834516/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834517"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2020 4:53 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/834517/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;ve heard from Amazon engineers at the last re:Invent that they reasonably believe that nested virtualization is unsafe on the current Intel CPUs. Their _current_ (with emphasis on &quot;current&quot;) Graviton2 ARM family also doesn&#x27;t support it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834517/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834526"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2020 11:40 UTC (Sat)
                               by <b>mss</b> (subscriber, #138799)
                              [<a href="/Articles/834526/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; that they reasonably believe that nested virtualization is unsafe on the current Intel CPUs. </font><br>
<p>
Ohh, that&#x27;s interesting.<br>
<p>
Do you know whether they meant the current KVM nVMX implementation (which is tricky to get right with issues getting fixed all the time) or the VMX support itself in the CPU (as the expression &quot;current CPUs&quot; in your comment would suggest)?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834526/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834545"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2020 19:54 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/834545/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No idea. Back when I was working at Amazon, there were several huge hardware-level scares that required mass reboots of client VMs (both for legacy Xen and newer KVM-based VMs).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834545/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor834563"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 16:05 UTC (Sun)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/834563/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Google and Oracle have been offering nVMX for years and have contributed lots of changes. nVMX is definitely ready for production use and nSVM is getting there (though there is one processor erratum that complicates things).<br>
<p>
What follows is my guess on what things really look like. First, Amazon plays complicated games with /dev/mem and memremap for EC2 in order to save the price of &quot;struct page&quot; for guest memory (that&#x27;s 1.5% so nothing to sneeze at), and that makes nested virtualization slower. Second, their kernel is probably based on older versions of Linux and thus it lacks a lot of the improvements made to nested virtualization lately. And finally, Amazon sells bare metal instances at a higher price  so they have no interest in covering virtualization workloads.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834563/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834574"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 21:35 UTC (Sun)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/834574/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
VMX seems so complicated to me that I expect there to be lots of hardware bugs in it accessible from the hypervisor. That&#x27;s not a big deal if you trust the hypervisor, which you mostly do at the root, but it&#x27;s deeply problematic for nested virtualization.<br>
<p>
*Maybe* so much bug hunting has been done by people with variously-coloured hats, and so many bugs fixed, that this risk has been reduced to an acceptably low level. But if this has been done then I would expect some of those bugs to have been published, and I haven&#x27;t seen that, not like we have for other attack surfaces.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834574/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834577"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 22:02 UTC (Sun)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/834577/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It is not *that* complicated actually, once you get familiar with it. Also, large parts of the state is not passed through to the processor by the root hypervisor, so the configuration for the nested guest ends up being not very different from that for the non-nested case.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834577/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor834587"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2020 4:44 UTC (Mon)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/834587/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; though there is one processor erratum that complicates things</font><br>
<p>
What&#x27;s the nSVM-related errratum on AMD?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834587/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834594"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2020 9:25 UTC (Mon)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/834594/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
VMLOAD/VMRUN/VMSAVE instructions check their operand against a range of restricted addresses (such as the SMM TSeg) and generate an instruction if the operand is within that address. When nesting is on, the address should be checked after it has gone through nested page tables, but instead it is checked as is.<br>
<p>
If the nested hypervisor is unlucky enough to place its VMCB at an address that the processor rejects, it will fail to enter the nested guest. There are various possible workarounds though (the simplest is to reduce the amount of memory below 4GB in the nested hypervisor to 1GB, because usually SMM TSeg is somewhere between 0x40000000 and 0xC0000000).<br>
<p>
Apparently it&#x27;s been there since the first SVM processors but we only noticed last year and it took a few months to find the root cause.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834594/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor834572"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 19:06 UTC (Sun)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/834572/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Nitro enclaves are not a replacement for nested virtualization. The idea is that you offload part of the work, for example logging, to the enclave so that it is impossible to tamper with that data in case the parent VM is taken over. The parent is not necessarily trusses. With nested virtualization instead the parent has total control over the guest and must be trusted.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834572/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834573"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 21:27 UTC (Sun)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/834573/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks for clarifying that, I guess it makes sense as an alternative to SGX that is simpler and actually works.<br>
<p>
But, is &quot;logging&quot; actually a valid use-case for Nitro enclaves?<br>
<p>
<font class="QuotedText">&gt; Enclaves are virtual machines attached to EC2 instances that come with no persistent storage, no administrator or operator access, and only secure local connectivity to your EC2 instance.</font><br>
<p>
Not clear to me how a Nitro enclave can improve the security of logging if it can&#x27;t actually write logs anywhere without cooperation from the untrusted parent instance.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834573/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834579"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 22:11 UTC (Sun)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/834579/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You could encrypt logs within the enclave and send them back to the parent VM that immediately sends them somewhere for storage. This doesn&#x27;t guarantee that logs are actually forwarded and stored but it does guarantee confidentiality and integrity; in case of an attack this means that the attacker cannot wipe all of its traces. And at least it&#x27;s more interesting than DRM. :-)<br>
<p>
The enclave only gets a vsock connection to the outer would. One interesting feature would be the ability for the parent to configure (at enclave startup) a mapping from a vsock port to a remote TCP address/port, with the forwarding being done by the host so that the link cannot be broken.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834579/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor834588"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2020 4:47 UTC (Mon)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/834588/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Nitro enclaves are not a replacement for nested virtualization</font><br>
<p>
If you don&#x27;t care about the tamper-proof attestation that Nitro Enclaves provide, what&#x27;s the difference between a Nitro enclave and a locked-down KVM using nested virtualization with only a vsock, other than that nested virtualization seems likely to be slower?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834588/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834596"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2020 9:28 UTC (Mon)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/834596/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
None, but that&#x27;s a fairly big &quot;if&quot;. The point of Nitro enclaves is that you don&#x27;t trust the host.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834596/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834792"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 20, 2020 21:41 UTC (Tue)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/834792/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sure, but they&#x27;re also the only approximation to &quot;nested virtualization&quot; on AWS, so they&#x27;re wildly useful even if you don&#x27;t care about keeping the host untrusted.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834792/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834814"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 21, 2020 7:21 UTC (Wed)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/834814/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You have to rewrite your application to use them. Nested virtualization is mostly useful for test deployments of kubernetes clusters  and the like. If you want virtualization on AWS you have to fork out the money and get bare metal instances, period.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834814/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834895"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 21, 2020 21:40 UTC (Wed)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/834895/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; You have to rewrite your application to use them.</font><br>
<p>
Only if your application started out assuming more devices than just a vsock.<br>
<p>
<font class="QuotedText">&gt; If you want virtualization on AWS you have to fork out the money and get bare metal instances, period.</font><br>
<p>
Money isn&#x27;t the issue. Bare-metal instances take an incredibly long time to start up (~10 minutes), compared to virtualized instances (~5-10 seconds, which is already far too long).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834895/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor834518"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2020 5:07 UTC (Sat)
                               by <b>re:fi.64</b> (subscriber, #132628)
                              [<a href="/Articles/834518/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Developers now have clear warning of a problem coming in 448 years, but chances are they will procrastinate on addressing it for at least 440 of them.</font><br>
<p>
Terrifyingly accurate.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834518/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834564"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 16:06 UTC (Sun)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/834564/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
430 based on experience with 2038.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834564/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834586"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2020 4:06 UTC (Mon)
                               by <b>gus3</b> (guest, #61103)
                              [<a href="/Articles/834586/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If I&#x27;m still around in 2448, I promise I&#x27;ll bring attention to this issue in XFS.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834586/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor834917"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 22, 2020 11:13 UTC (Thu)
                               by <b>eru</b> (subscriber, #2753)
                              [<a href="/Articles/834917/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Such an odd extension (not the &quot;virtual eternity&quot; of 64 bits). I guess they tried to shoe-horn the extended time into some existing on-disk bits for backward-compatibility, so I guess existing XFS installations work seamlessly with this. Right?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834917/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor835517"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 28, 2020 18:53 UTC (Wed)
                               by <b>BenHutchings</b> (subscriber, #37955)
                              [<a href="/Articles/835517/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
ext4 had 32-bit seconds + 32-bit nanoseconds fields, and has reassigned 2 bits from nanoseconds to seconds. I would guess that XFS has made a similar change.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/835517/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor834520"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2020 8:16 UTC (Sat)
                               by <b>darwi</b> (subscriber, #131202)
                              [<a href="/Articles/834520/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; There is an entirely new user-space API for GPIO lines. Naturally, this API is rigorously undocumented.</font><br>
<p>
Unfortunately, this is a sign of the maintainer not properly doing his or her job. Proper documentation should be a prerequisite of merging such patches.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834520/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834524"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2020 11:37 UTC (Sat)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/834524/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <p>No. That would be horrible waste of resources. APIs are changed so radically during review process that writing adequate documentation for them (with examples and diagrams) is usually pointless. It could be redone 2, 3, even 10 times in extreme cases.</p>

<p>But of course after new API is merged it's too late to write a documentation because, well, it's merged, why bother?</p>

<p>Not sure how could that issue be adequately resolvedâ€¦</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/834524/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834529"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2020 13:47 UTC (Sat)
                               by <b>magfr</b> (subscriber, #16052)
                              [<a href="/Articles/834529/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Process.<br>
Do not require (but do encourage) documentation for a proposed API but demand it in order to merge the API.<br>
<p>
There is actually another benefit of this - forcing documentation is kind of an &quot;explain it to the duck&quot; session for developers that forces them to think about their new shiny interface from another angle.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834529/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor834532"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2020 14:34 UTC (Sat)
                               by <b>dxin</b> (guest, #136611)
                              [<a href="/Articles/834532/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Don&#x27;t reviewers need documentation as well?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834532/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834575"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 21:39 UTC (Sun)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/834575/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, exactly. Good documentation eases the review process for maintainers.<br>
<p>
Writing good documentation is also a clarifying process for everyone to understand exactly what the feature does and how it can and cannot be used. It&#x27;s too easy to write some code and only later realize that the API is actually very difficult to use correctly; writing the documentation usually exposes this.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834575/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor834542"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2020 17:11 UTC (Sat)
                               by <b>mkubecek</b> (guest, #130791)
                              [<a href="/Articles/834542/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
With ethtool netlink interface, I tried to go even farther: I tried to document each part of the API first, before starting with the implementation on either side. I don&#x27;t think it was a waste of resources, I did actually find it quite helpful at times.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834542/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor834684"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2020 20:33 UTC (Mon)
                               by <b>darwi</b> (subscriber, #131202)
                              [<a href="/Articles/834684/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; No. That would be horrible waste of resources. APIs are changed so radically during review process that writing adequate documentation for them (with examples and diagrams) is usually pointless. It could be redone 2, 3, even 10 times in extreme cases.</font><br>
<p>
Thatâ€™s a BS argument, sorry.<br>
<p>
If the newly added user space API is really **that** contentious, then by the time the maintainer is going to merge the changes, he asks for a final iteration with proper documentation. Simply because if itâ€™s not done at that moment, it might never be done in the future.<br>
<p>
Stop justifying bad behavior please.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834684/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834696"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2020 23:38 UTC (Mon)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/834696/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The other thing is, you should document BEFORE you write code. Without a plan, how do you know if your API is going to work / do what it should / be of any use.<br>
<p>
They say that no battle plan survives five minutes contact with the enemy, but without a plan you don&#x27;t stand a chance.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834696/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834704"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 20, 2020 8:32 UTC (Tue)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/834704/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>This is where kerneldoc is great - documentation for the API sits with the implementation, and if you're working on the implementation, the API docs are right there, staring you in the face with the code you're reviewing.
<p>See <a href="https://www.kernel.org/doc/Documentation/gpu/drm-uapi.rst">the DRM top-level</a>, which gets turned into <a href="https://www.kernel.org/doc/html/latest/gpu/drm-uapi.html">this document based on both the  top-level and the code included by the top-level</a>.
      
          <div class="CommentReplyButton">
            <form action="/Articles/834704/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor835054"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 23, 2020 20:55 UTC (Fri)
                               by <b>rgmoore</b> (<b>&#x272D; supporter &#x272D;</b>, #75)
                              [<a href="/Articles/835054/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>If the newly added user space API is really **that** contentious, then by the time the maintainer is going to merge the changes, he asks for a final iteration with proper documentation.</blockquote>

<p>This sounds very reasonable.  No documentation, no merge.  The hard part is having the resolve to make it stick the first few times.  Once everyone knows that's the rule and it will be enforced, they'll know to have the documentation done before the merge.  Then the only hard part is keeping the documentation up to date as the code changes.
      
          <div class="CommentReplyButton">
            <form action="/Articles/835054/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor834581"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 23:29 UTC (Sun)
                               by <b>deater</b> (subscriber, #11746)
                              [<a href="/Articles/834581/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Urgh I just finished re-writing the examples/homeworks in my embedded system class to use the &quot;new&quot; GPIO interface on the theory that the old sysfs interface is deprecated and scheduled for removal in 2020.<br>
<p>
only to find out it was a complete waste of time due to yet another gpio interface being added.<br>
<p>
although I guess if the new interface has debounce support I won&#x27;t have to spend a lot of time trying to convince students that sprinkling random usleep()s all over their code somehow counts as debouncing<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834581/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor834528"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2020 12:53 UTC (Sat)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/834528/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Is it still the case that AMD&#x27;s on-cpu memory encryption is incompatible with AMD&#x27;s own (potentially on-cpu) GPUs? That&#x27;s a bit of an embarrassment.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834528/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor834543"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2020 18:46 UTC (Sat)
                               by <b>jrtc27</b> (subscriber, #107748)
                              [<a href="/Articles/834543/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Proper use of this extension can trap use-after-free and buffer-overflow bugs (and attempts to exploit those bugs).</font><br>
<p>
It&#x27;s worth noting that this is only probabilistic (for use-after-free the memory tag will eventually cycle back round and be usable again with an old pointer, and for buffer overflows you in general have a 1/16 chance of the out-of-bounds memory having a matching tag), with the exception that you can catch overflows into adjacent memory deterministically by choosing your tags such that adjacent allocations&#x27; are always different, and that using the tags for both simultaneously multiplies the constraints together such that both mitigations become weaker (higher probability of an invalid memory access not being detected) compared with exclusively enabling one.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834543/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834555"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 8:43 UTC (Sun)
                               by <b>Jandar</b> (subscriber, #85683)
                              [<a href="/Articles/834555/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; for use-after-free the memory tag will eventually cycle back round and be usable again with an old pointer</font><br>
<p>
One could reserve 1 of the 16 tags for un-allocated or freed memory, so no cycling required.<br>
<p>
<font class="QuotedText">&gt; for buffer overflows you in general have a 1/16 chance of the out-of-bounds memory having a matching tag</font><br>
<p>
If the n tags used for this are assigned in a cycling pattern, than small overflows are detected reliable, and if n isn&#x27;t divisible by 2 all offsets by any x-order page are detected.<br>
<p>
While this doesn&#x27;t detect overflows to 100% it&#x27;s nevertheless a good defense.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834555/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834569"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 18:01 UTC (Sun)
                               by <b>jrtc27</b> (subscriber, #107748)
                              [<a href="/Articles/834569/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &gt; for use-after-free the memory tag will eventually cycle back round and be usable again with an old pointer</font><br>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt; One could reserve 1 of the 16 tags for un-allocated or freed memory, so no cycling required.</font><br>
<p>
So, the important thing about use-after-free is that it&#x27;s actually not the real problem. If you free memory but continue to use it whilst it&#x27;s still free, so long as the entire page isn&#x27;t unmapped by the allocator (and so long as your allocator doesn&#x27;t go and pattern-fill the memory to try and catch these things), you don&#x27;t actually have a vulnerability. Where the vulnerabilities come from is use-after-*reallocation*, i.e. when you continue to use memory that has since been allocated to someone else. That allows you to then read and/or write to whatever their data structures are and do things like rewrite C++ vtables or conduct data-oriented attacks. Using a reserved tag for unallocated memory doesn&#x27;t solve that problem, as when malloc reuses freed memory it needs to assign it a different tag from whatever you&#x27;ve reserved, which it can&#x27;t do forever without eventually re-tagging that region of memory with the same as the original tag.<br>
<p>
<font class="QuotedText">&gt; &gt; for buffer overflows you in general have a 1/16 chance of the out-of-bounds memory having a matching tag</font><br>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt; If the n tags used for this are assigned in a cycling pattern, than small overflows are detected reliable, and if n isn&#x27;t divisible by 2 all offsets by any x-order page are detected.</font><br>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt; While this doesn&#x27;t detect overflows to 100% it&#x27;s nevertheless a good defense.</font><br>
<p>
Yeah, you can do things like that, but once you get significantly out-of-bounds there won&#x27;t be much of a useful pattern any more, both because the offset is likely fairly arbitrary and because you may be crossing into an allocation pool for a different bucket size, so for anything that&#x27;s a few pages out of bounds it&#x27;s highly likely to just degrade into a 1/n probability. It&#x27;s better than nothing, but it doesn&#x27;t solve the problem, it just creates additional work for attackers to ensure they get an offset that lands on a correctly-tagged region.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834569/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834576"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 21:45 UTC (Sun)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/834576/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I bet attackers will very quickly learn how to groom the heap to ensure they get the right tag values for any fixed tag recycling scheme, at least when their wild-read/wild-write primitive allows an arbitrary offset. So I think allocators will have to use random tags.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834576/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor834558"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2020 11:24 UTC (Sun)
                               by <b>thumperward</b> (guest, #34368)
                              [<a href="/Articles/834558/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Is there a year 2468 problem?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834558/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor834589"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2020 5:23 UTC (Mon)
                               by <b>matthias</b> (subscriber, #94967)
                              [<a href="/Articles/834589/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Now, there is. XFS has chosen to use a 64 bit nanosecond counter with the minimal value being in December 1901.<br>
<p>
<a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=XFS-Linux-5.10">https://www.phoronix.com/scan.php?page=news_item&amp;px=X...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834589/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor834605"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">5.10 Merge window, part 1</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2020 14:34 UTC (Mon)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/834605/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The art of choosing new limits is finding one which will not be force a format change. I&#x27;m anticipating a larger format change in the next 50 years, and at that time XFS can go to larger timestamps.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/834605/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2020, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
