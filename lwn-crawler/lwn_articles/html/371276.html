        <!DOCTYPE html>
        <html lang="en">
        <head><title>LCA: Graphics driver ponies [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/371276/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/370618/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/371276/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>LCA: Graphics driver ponies</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ready to give LWN a try?</b>
<p>
With a subscription to LWN, you can stay current with what is happening in the Linux and free-software community and take advantage of subscriber-only site features.  We are pleased to offer you <b><a href="https://lwn.net/Promo/nst-trial/claim">a free trial subscription</a></b>, no credit card required, so that you can see for yourself.  Please, join us!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>January 26, 2010</br>
           </div>
Those of you who have come to appreciate Dave Airlie's kitten-filled
presentations might just have been dissatisfied with his linux.conf.au
talk, which was called "So you moved graphics drivers to the kernel.. what
next? I can haz ponies?"  But ponies, too, can be cute, and the update on
the state of graphics drivers in the kernel was well worth the listening.
<p>

It has now been about a year since kernel mode setting (KMS) was merged
into the mainline kernel.  KMS ends the "mess" which came from having
graphics drivers in user space; digging out of that particular hole took a
good seven years or so.  But now our graphics drivers are in the kernel,
just like most other drivers.
<p>
Beyond cleaning up the mess, there are a few other good reasons for merging
KMS.  One is that the system is now able to make full use of the
power-saving features of the hardware; before KMS, the kernel never really
knew enough about what was going on with the hardware to do this.  The
Intel drivers can now perform as well as Windows with regard to power
saving; the ATI drivers, instead, are not quite there yet.  Another nice

<a href="/Articles/371302/"><img
src="https://static.lwn.net/images/conf/lca2010/DaveAirlie-sm.jpg" width=160 height=97 alt="[Dave
Airlie]" border=0 align="right"></a>

feature is the ability to use a kernel debugger on a system with graphics
running; it's now possible to trap into the debugger, then return to a
running system and have everything just work.
<p>
One of the reasons why KMS took so long to merge is that it places a number
of new requirements on the kernel.  At the top of the list is a proper
manager for graphical memory.  That's a hard problem, one that the graphics
developers always intended to get to sometime Real Soon Now.  Eventually
the <a href="http://lwn.net/Articles/257417/">TTM</a> developers got to it,
but they quickly ran into a number of API difficulties.  After some effort,
the Intel developers
decided that a generic approach to the memory management API wasn't going
to work; out of that realization came the GEM memory manager, which only
tried to solve the Intel problem.
<p>
Developers working on ATI chipsets, in turn, soon realized that GEM did not
have the capabilities that they needed.  So they went back to TTM, but not
before bolting something that looks a lot like the GEM API onto it.  TTM
was recently merged, making KMS possible for ATI chipsets as well.
<p>
So what is coming?  One future feature is the <a
href="http://wiki.freedesktop.org/wiki/Software/gallium">Gallium</a> 3D
architecture.  Gallium, says Dave, is starting to work, but full
functionality will take a while yet.  Moving drivers to Gallium is going to
be a painful exercise; there are already plenty of APIs that these drivers
need to support.
<a href="http://www.x.org/wiki/DRI2">DRI2</a> is also coming along.  This
feature really needed KMS to work properly, especially when compositing is
being used.  There are still performance issues which must be resolved,
though. 
<p>
Another thing to look forward to is the <a
href="http://groups.google.com/group/wayland-display-server">Wayland</a>
display server.  Wayland can be seen as a simpler, smaller replacement for
X built on KMS.  It can run GTK and GL
applications now; there is also an X server emulator which can run on top
of it.  A few difficulties remain, including the fundamental fact that
Wayland is not X;  since X is the standard in this area, alternatives are
going to be hard to sell.  The Wayland
developers also have not yet really dealt with the input problem, but input
is a big piece of the X code.  So Wayland, too, will be a while in coming;
it may find its way into embedded situations first.
<p>
Dave spent some time on the current state of the graphics drivers.
<b>Intel</b>, he says, is currently in the leading position.  It supports KMS
for everything - well, almost everything; the "chipset we won't name" (the
proprietary GMA500) still lacks support.  The driver is feature-complete,
but Dave isn't quite ready to call it "mature"; another release or two will
be required first.  As <a href="http://lwn.net/Articles/369706/">discussed
here</a> previously, the driver will need to retain user mode setting (UMS)
support for some time, but the current upstream X.org sources have already
removed UMS from the X server.
<p>

The <b>ATI/AMD</b> drivers are further behind, but getting closer; this
driver is harder than the Intel driver, due to the large number of chipset
variations.  Chipsets from R100 to R700 are currently supported; R800
support can be expected within a few weeks.  The driver works "nearly as
well as the old stuff" at this point; suspend and resume work better than
before.  Support for power-saving features is missing but expected for
2.6.34.  The Radeon driver is currently in the staging tree, but it might
move out before the end of the 2.6.33 development cycle.
<p>
What about the RadeonHD driver?  That fork of the driver is primarily the
result of a disagreement over the use of ATI's BIOS tables; the Radeon
driver has an interpreter for these tables, while RadeonHD reimplements the
functionality that those tables provide.  Using the BIOS tables makes life
a lot easier; it lets the driver ignore a lot of the details associated
with different chipset variations.  The BIOS table code is part of the KMS
implementation which has been merged into the mainline; that should, Dave
thinks, resolve this disagreement.
<p>

The "pony" displayed for the <b>Nouveau</b> discussion was a Trojan horse.
Nouveau, of course, was <a href="http://lwn.net/Articles/366648/">merged
for 2.6.33</a>.  The driver has just lost its 
user-mode support; it will be KMS only.  Chipsets from the NV4 through the
G80 are supported, with the final pieces to be filled in soon.  The
"ctxprogs" firmware is being figured out; the NV40 version has already been
replaced with a rewritten, freely-licensed equivalent and NV50 is in the
works.  Dave noted that, whatever one thinks about NVIDIA's approach to
working with the community, its hardware tends to be relatively good and
easy to work with.
<p>

When Dave was asked about support for non-Linux systems, he replied that
most of them have been left behind at this point.  There is, apparently, an
OpenSolaris port being done within Sun, but no code has been released from
that group.  One other audience member asked about running X without root
privileges: that does work now, and Moblin is doing it.  There are some
problems remaining, though, especially with fast user switching.  In the
absence of a <tt>revoke()</tt> system call, there's no way to guarantee
that one user isn't listening in on another.  Since <tt>revoke()</tt> is
known to be a hard problem, it's not clear how this issue will be
resolved.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Device_drivers">Device drivers</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Nouveau">Nouveau</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#linux.conf.au-2010">linux.conf.au/2010</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/371276/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor371598"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 4:36 UTC (Thu)
                               by <b>thedevil</b> (guest, #32913)
                              [<a href="/Articles/371598/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      I have 2 comments about the ATI side.

1.  I think what in the staging tree in 2.6.32 is just the option of making KMS the default.  Even if you don't enable the staging tree at all you can already use KMS just by doing

<pre>
echo 'options radeon modeset=1' >> /etc/modprobe.d/local-radeon.conf
</pre>

2.  I tried it, it works fine in X, and I see no problems as long as my virtual consoles start in old-fashioned text mode.  They actually seem to be changed to an internal framebuffer mode as soon as I switch to them with Alt+Ctl+Fn .  But I get a very unexpected result when I enable *both* KMS and vesafb.  When I switch to a virtual console with Alt+Ctl+Fn, my monitor displays the "No signal" message and goes to sleep!  So, based on this experience I am not going to use KMS quite yet.

      
          <div class="CommentReplyButton">
            <form action="/Articles/371598/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371602"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 5:01 UTC (Thu)
                               by <b>BenHutchings</b> (subscriber, #37955)
                              [<a href="/Articles/371602/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The DRI+KMS graphics drivers will conflict with framebuffer drivers for the same hardware. The kernel only allows one driver to bind to each PCI device and normally that prevents you from making this mistake. vesafb is an exception because it doesn't bind to a specific PCI device, but you should not expect it to work.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371602/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371612"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 6:43 UTC (Thu)
                               by <b>thedevil</b> (guest, #32913)
                              [<a href="/Articles/371612/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hmm.  Maybe my memory is really going to $@#! due to middle age, but I seem to remember that saner switching between X and VCs was one of the selling points of KMS.  But if that means you have to stay in 80x25 for the VCs it's not very persuasive.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371612/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371656"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 13:29 UTC (Thu)
                               by <b>xav</b> (guest, #18536)
                              [<a href="/Articles/371656/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
By default on my system KMS sets the console framebuffer to 1900x1200, which makes fro a quite high res text console (I don't know how much, but far more than 80x25).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371656/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371666"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 14:57 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/371666/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I do wonder how to set the resolution to something nonstandard. As far as <br>
I can tell with Radeon KMS there is no way: the resolution the monitor <br>
prefers is always selected. This is normally fine for those of us with <br>
LCDs, but for the poor sods stuck on CRTs it seems suboptimal.<br>
<p>
(but, yes, a nice fb console with huge numbers of rows and columns which <br>
does not bugger up X acceleration is a major plus of KMS. Another major <br>
plus.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371666/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371743"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 21:52 UTC (Thu)
                               by <b>michich</b> (subscriber, #17902)
                              [<a href="/Articles/371743/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Boot parameter <code>video=800x600</code> works for me with Radeon KMS. See <code>Documentation/fb/modedb.txt</code>.
      
          <div class="CommentReplyButton">
            <form action="/Articles/371743/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371752"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 22:53 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/371752/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
OK, no wonder I couldn't find the docs. fb/modedb.txt is, uh, not the most <br>
obvious of places :)<br>
<p>
(though 800x600 is the last-ditch fallback resolution in any case, so <br>
perhaps not the best one to test with.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371752/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor372212"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 2, 2010 1:38 UTC (Tue)
                               by <b>Spudd86</b> (guest, #51683)
                              [<a href="/Articles/372212/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If the text is too small change the console font to something bigger.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/372212/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor371736"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 20:59 UTC (Thu)
                               by <b>BenHutchings</b> (subscriber, #37955)
                              [<a href="/Articles/371736/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You set it through the KMS driver, not vesafb. (But don't ask me how!)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371736/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor371618"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 7:42 UTC (Thu)
                               by <b>airlied</b> (subscriber, #9104)
                              [<a href="/Articles/371618/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you don't enable KMS by default using the staging option, udev won't load it, so you'll need to load it by hand before starting X. This is really why distros need to ship support for KMS by default or don't bother.<br>
<p>
So just load it by default somewhere before X starts and get a hires console.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371618/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371786"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2010 5:05 UTC (Fri)
                               by <b>thedevil</b> (guest, #32913)
                              [<a href="/Articles/371786/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But it doesn't work!  It gives me the same "No signal" behavior as when I enable vesafb.<br>
<p>
I guess I should report this, but where?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371786/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371918"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2010 4:09 UTC (Sat)
                               by <b>thedevil</b> (guest, #32913)
                              [<a href="/Articles/371918/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Solved!  It turns out I haven't selected fbcon in the kernel config.  So this is really a bug in the kernel build system: drm + kms should autoselect fbcon.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371918/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371933"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2010 11:36 UTC (Sat)
                               by <b>chris.wilson</b> (guest, #42619)
                              [<a href="/Articles/371933/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It does, but only if you have not also selected to optimize for small/embedded systems where you can opt out of the overhead of allocating a framebuffer for the console.<br>
<p>
config DRM_KMS_HELPER<br>
        tristate<br>
        depends on DRM<br>
        select FB<br>
        select FRAMEBUFFER_CONSOLE if !EMBEDDED<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371933/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor372211"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 2, 2010 1:37 UTC (Tue)
                               by <b>Spudd86</b> (guest, #51683)
                              [<a href="/Articles/372211/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
err, you REALLY ought to make sure the KMS driver is controlling your consoles... if somehow you managed to end up binding vesafb to your consoles with the radeon DRI stuff assuming KMS bad things would happen...<br>
<p>
You CAN'T use both at the same time, KMS implies framebuffer console with the KMS based driver controlling it. (And vesafb should do nothing)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/372211/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor371641"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Unclear paragraph</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 10:56 UTC (Thu)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/371641/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>KMS ends the "mess" which came from having graphics drivers in the kernel; digging out of that particular hole took a good seven years or so. But now our graphics drivers are in the kernel, just like most other drivers.</blockquote>I don't understand - are the drivers in the kernel or not, and is this a mess?
      
          <div class="CommentReplyButton">
            <form action="/Articles/371641/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371655"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Unclear paragraph</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 13:25 UTC (Thu)
                               by <b>niner</b> (subscriber, #26151)
                              [<a href="/Articles/371655/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
They have not been in the kernel which lead to a mess, but now they are. I<br>
already reported that obvious typo. But it's still very early in the<br>
morning over in the U.S.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371655/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor371662"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Unclear paragraph</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 14:25 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/371662/">Link</a>] 
      </p>
      
      </div>
      </summary>
      That's a really silly mistake; I'm not sure how it got through.  It's fixed now, sorry for the confusion.
      
          <div class="CommentReplyButton">
            <form action="/Articles/371662/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor371658"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 13:57 UTC (Thu)
                               by <b>Tet</b> (subscriber, #5433)
                              [<a href="/Articles/371658/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <em>The driver has just lost its user-mode support; it will be KMS only</em>
<p>
I do wish they wouldn't do this. It essentially prevents me from using a recent kernel. With my card, KMS causes a segfault in the server, but it works just fine without KMS. I understand why they want to do it. The non-KMS code is messy, and they don't want to maintain it. But it <em>works</em>, in places where KMS currently doesn't.
      
          <div class="CommentReplyButton">
            <form action="/Articles/371658/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371676"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 15:43 UTC (Thu)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/371676/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The answer there is not to maintain two different systems with different bugs in each of them but fix the one that is there for the longer term <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371676/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371683"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 16:49 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/371683/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Especially given that the non-KMS code is not just 'messy' but <br>
misdesigned. Multiple drivers in kernel and userspace arguing over a <br>
single video card is pretty much obviously a bad idea. If video cards on <br>
PCs had never been capable of displaying text, I suspect this design would <br>
never have lasted as long as it has, at least on Linux: this meant that <br>
most people could just use a text-mode console and pretend that there was <br>
only one graphics driver, the 2D X one, when in fact the other driver was <br>
in the video card...<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371683/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor371886"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2010 21:08 UTC (Fri)
                               by <b>Tet</b> (subscriber, #5433)
                              [<a href="/Articles/371886/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Agreed. Clearly maintaining both is not viable. All I'm proposing is not removing the non-KMS code until the KMS code is stable and usable. Importantly, that has to include older hardware (not obsolete, just not cutting edge). It seems there's been a reasonable amount of work on getting KMS working with newer video cards. But it needs to work on cards that are 3 or 4 years old, too, and based on my experience, it currently doesn't.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371886/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371921"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2010 6:03 UTC (Sat)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/371921/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<p>
Have you reported your bug?  We can debate on what is the right threshold but it is also the case as long as there are two different systems end users tend to switch between them and never report bugs<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371921/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371981"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 31, 2010 16:21 UTC (Sun)
                               by <b>Tet</b> (subscriber, #5433)
                              [<a href="/Articles/371981/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes. For better or for worse, I report every problem I find as a bug. The usual response seems to be to ignore it, wait for a year and then close the bug because it's for an unsupported release. But I have to keep trying...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371981/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor371949"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2010 18:48 UTC (Sat)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/371949/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It certainly should work with older hardware: my 2000-vintage system (now <br>
reserved for compatibility checking) with its Radeon 9250 is quite happy <br>
with KMS.<br>
<p>
However ATI have a crazy variety of cards, all wired up slightly <br>
differently, and the pre-ATOM ones don't give the drivers much help to <br>
fight through the morass. So, yes, report as a bug.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371949/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor371722"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 19:34 UTC (Thu)
                               by <b>jsbarnes</b> (guest, #4096)
                              [<a href="/Articles/371722/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Please file a bug.  A server segfault obviously shouldn't happen, but should also be pretty easy to fix.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371722/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor371744"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 22:02 UTC (Thu)
                               by <b>Thalience</b> (subscriber, #4217)
                              [<a href="/Articles/371744/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As I understood it, the component that would lose UMS support is the X Driver (DDX). So you wouldn't be able to run a newer X on an old kernel.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371744/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371758"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 22:59 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/371758/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
... or on a non-Linux OS. I suppose OSes that can't be bothered to <br>
implement KMS over the course of many years are probably moribund anyway. <br>
(The cynic in me would say that everything but Linux is pretty moribund as <br>
an X server platform these days...)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371758/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor372213"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 2, 2010 1:43 UTC (Tue)
                               by <b>Spudd86</b> (guest, #51683)
                              [<a href="/Articles/372213/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Apparently people ARE working on it for FreeBSD and Solaris, but FreeBSD doesn't have as many people as Linux so it might be a while<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/372213/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor371678"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LCA: Graphics driver ponies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 15:56 UTC (Thu)
                               by <b>ernstp</b> (guest, #13694)
                              [<a href="/Articles/371678/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And now we have power management for Radeon also:<br>
<a href="http://git.kernel.org/?p=linux/kernel/git/airlied/drm-2.6.git;a=shortlog;h=refs/heads/drm-radeon-testing">http://git.kernel.org/?p=linux/kernel/git/airlied/drm-2.6...</a><br>
<p>
It's all coming together very quickly now! I guess that's the benefit of having several full time employees working on this... :-)<br>
<p>
(Not sent to Linus yet though)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371678/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor371681"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">revoke()</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 16:43 UTC (Thu)
                               by <b>chrish</b> (guest, #351)
                              [<a href="/Articles/371681/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <p>"One other audience member asked about running X without root privileges: that does work now, and Moblin is doing it. There are some problems remaining, though, especially with fast user switching. <b>In the absence of a revoke() system call, there's no way to guarantee that one user isn't listening in on another.</b>"

<p>Could someone expdand on the part in bold and describe in more detail what the problem is? Why would fast user switching cause a single fd to be allocated to processes belonging to different users?
      
          <div class="CommentReplyButton">
            <form action="/Articles/371681/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371693"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">revoke()</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 17:59 UTC (Thu)
                               by <b>wingo</b> (guest, #26929)
                              [<a href="/Articles/371693/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't know, but I'll hazard a guess: the input and output devices of an X session are file descriptors, and have to be handed to and from the display manager and different userspace, and there's nothing preventing one user from keeping a dupped copy of one of the devices.<br>
<p>
At least this comment should provoke someone knowledgeable to correct me :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371693/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor372006"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">revoke()</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 1, 2010 0:05 UTC (Mon)
                               by <b>whot</b> (subscriber, #50317)
                              [<a href="/Articles/372006/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The evdev input driver opens /dev/input/eventX file descriptors. The same fd can be opened by another process allowing this process to read events coming from the devices. Currently, you need to be root to open the devices.<br>
<p>
If the fd of a keyboard can be opened by a user, this user is able to read keyboard events. Example scenario:<br>
1. user A logs in, /dev/input/event0 is opened as keyboard<br>
2. user A starts keyboard sniffer on /dev/input/event0 because he or she has permissions to open this file.<br>
3. user A uses fast user switching<br>
4. user B logs in, /dev/input/event0 is opened as keyboard<br>
<p>
Unless any process by user A can be suspended or revoked access to the fd, this process can sniff keyboard events from user B.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/372006/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2010, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
