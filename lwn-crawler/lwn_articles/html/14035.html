        <!DOCTYPE html>
        <html lang="en">
        <head><title>Reiser4 - the mammoth arrives [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/14035/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/13587/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/14035/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Reiser4 - the mammoth arrives</h1>
<div class="Byline">[Posted October 30, 2002 by corbet]
               <p>
               </div>
</div>
<div class="ArticleText">
One of the remaining issues to be resolved before the Halloween feature
freeze is whether the Reiser4 filesystem will be included in the 2.5
kernel.  This has been a hard question to answer, however, given that
almost nobody had actually seen the Reiser4 source.  That situation, at
least, has come to an end with the <a
href="/Articles/14002/">announcement</a> of the first public Reiser4
snapshot.  
<p>
Reiser4 is the latest incarnation of the ReiserFS filesystem.  It is not
simply an upgrade; Reiser4 has been redesigned and reimplemented from the
beginning.  It is a completely different filesystem than the ReiserFS (also
known as "Reiser3") found in the 2.4 kernel; should it be included, the
next stable kernel will contain both Reiser3 and Reiser4, as separate
options. 
<p>
There is a fair amount of online information available on Reiser4, though
some of it makes for a bit of a challenging read.  <a
href="http://www.namesys.com/v4/v4.html">This lengthy document</a> provides
discussion in depth of many of the Reiser4 features (not all of which are
implemented yet), along with an explanation of Hans Reiser's long-term
vision for filesystems, a polemic on free software, and some of the
weirdest imagery to be found in software documentation anywhere.  The
document entitled <a href="http://www.namesys.com/v4/fast_reiser4.html">The
Infrastructure for Security Attributes in Reiser4</a> is actually a
relatively straightforward discussion of many of the technical details
behind the Reiser4 design, and might be a better starting point.
<p>
For those wanting a shorter summary, here's a few of the features to be
found in Reiser4:
<p>
<ul>
<li> The filesystem maintains many of the basic features of Reiser3 - 
     it is based on (mostly) balanced trees, with file data incorporated in
     the tree along with names.  Reiser4 thus remains well suited to the
     handling of large numbers of very small files.
<p>
<li> It is smarter about block allocation and data placement.  Block 
     allocation is delayed until file data is actually written to disk,
     leading to more efficient layouts.  On-disk layout is done with
     extents.  The result of these optimizations is that the filesystem's
     read performance is greatly improved over Reiser3.
<p>
<li> "Wandering logfiles" take some techniques from log-structured 
     filesystems to provide journaling without (always) writing data to the
     disk twice.  In many cases, Reiser4 can write "journal" data to a disk
     block, then atomically swap the journal block into the file itself.
     The journaling code can overwrite or replace blocks, depending on
     which technique would provide better layout on the disk.
<p>
<li> Most filesystem semantics are implemented with plugins.  The normal 
     Unix directory behavior, for example, is implemented with the "Unix
     directory plugin."  Plugins can be used to implement security features
     (access control lists and such), encryption, maintenance of audit
     trails,  and no end of strange, non-POSIX
     semantics.  Hans Reiser remains determined to implement a lot of
     interesting features in his filesystem, and plugins are the mechanism
     by which those features will be included.
<p>
<li> Reiser4 is heavily transaction-oriented, and is able to provide 
     guarantees that operations will be performed atomically.  Future plans
     call for the ability to perform multi-file operations in an atomic
     manner.
<p>
<li> The Reiser4 design includes a <tt>reiser4()</tt> system call 
     "<q>to support applications that don't have to be fooled into
     thinking that they are using POSIX.</q>"  This system call will
     accept (and parse) command strings that can describe complex
     operations.  The <tt>reiser4()</tt> system call is not implemented in
     the current snapshot.
</ul>
<p>
As an example of the sort of uses that the Reiser4 developers eventually
would like to see, consider the classic Unix password file.  Each line in
the file describes one account, and contains several colon-separated fields
with information like the account name, user and group IDs, the user's home
directory and shell, etc.  In Reiser4, each field in the password file
would become a file in its own right; one could obtain the home directory
of a given <tt>user</tt> via a path like:
<p>
<pre>
	/etc/passwd/user/home
</pre>
<p>

A special-purpose plugin would aggregate the various files, so that a
process reading <tt>/etc/passwd</tt> would see the same information as
always.  But each field file could be protected differently; a user could
have write access to the file describing his or full name, but not to the
one containing the user ID value.
<p>
In the Reiser4 vision, file attributes would also be stored as files.  For
a given <tt>file</tt>, something like <tt>file/owner</tt> would contain
the UID of the
user who owns that file.  
<p>
Needless to say, in the long-term Reiser vision, Linux systems will behave
rather differently than they do now.  In the shorter term, Reiser4 promises
a high-performance journaling filesystem with highly efficient handling of
small files and a plugin architecture which encourages experiments with
interesting new semantics.  
<p>
Will it be merged?  The Reiser4 team plans to submit a patch for merging at
the last second, sometime before midnight on Halloween.  Some developers
have argued that it is too late to propose a major new feature that nobody
has had a chance to look at.  Hans <a href="/Articles/14152/">feels this is
inappropriate</a>: 
<p>
<div class="BigQuote">
	I'm the last straggler coming back from the hunt, and I've got what
	looks like it might be a wooly mammoth on my shoulders, and my
	tribesmen are complaining that I'm late for dinner.  How about
	helping me by cutting down a tree for the roasting spit instead
</div>
<p>
Linus has not offered any public opinions on the matter.  The Reiser4 patch
is apparently unintrusive, however, so there is probably no real reason not
to include it.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems-Reiser4">Filesystems/Reiser4</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/14035/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor14223"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reiser4 - the mammoth arrives</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 31, 2002 3:52 UTC (Thu)
                               by <b>cpeterso</b> (guest, #305)
                              [<a href="/Articles/14223/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Hans has made many comments on LKML that Reiser4 is &quot;100% faster&quot; for many benchmarks. Was Reiser3 just really slow? How does Reiser4 performance compare to ext3?
      
          <div class="CommentReplyButton">
            <form action="/Articles/14223/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor14328"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reiser4 - the mammoth arrives</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 31, 2002 18:12 UTC (Thu)
                               by <b>himi</b> (subscriber, #340)
                              [<a href="/Articles/14328/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Reiserfs was a bit slower than ext2, but not by that much - on bonnie++ I saw numbers like ~19MB/s reads from ext2, and about 16-17MB/s reads from reiserfs. This is on a disk that hdparm -t lists as giving about 21MB/s from the platters. I can't remember about writes, but I think it was slower there too - I may have had tail packing enabled, though,which would screw with the numbers.<p>The real test will be how it performs with a) lots of small files, and b) big files: reiserfs has always been better at dealing with lots of small files than ext2 (which isn't saying much, and with directory indexing ext3 looks to be as fast), but it's had problems with very large files, and it's tended to have problems with fragmentation leading to performance degredation over time. If they've dealt with those problems, then I could see &quot;100% faster&quot; being a reasonable description, assuming of course it /is/ that much faster.<p>Of course, I'm not going to trust my data to Reiser4 until it's been in real use for a while . . . Maybe 2.6.5 or so ;-)<p>himi<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/14328/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor14374"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">System CPU usage</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 1, 2002 13:02 UTC (Fri)
                               by <b>jzbiciak</b> (guest, #5246)
                              [<a href="/Articles/14374/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <P>One thing I've noticed in many benchmarks (well, at least the few that report this figure) is that Reiser3 seems to be very CPU heavy as compared to ext2.  They may achieve about the same benchmark numbers as other filesystems when run with a disk-intensive benchmark, but (as I recall) the system CPU %age is much higher for Reiser3 than others.
The effect of higher system CPU usage is to slow down  any compute-intensive processes that might be running in parallel with your I/O intensive application.
</P>
<P>
I'd like to see how Reiser4 fares.  It's apparently a major rewrite,
so if it has fundamental changes in design, it could have completely
different CPU usage patterns.
</P>
<TT>--Joe</TT>
      
          <div class="CommentReplyButton">
            <form action="/Articles/14374/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor14252"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reiser4 - the mammoth arrives</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 31, 2002 11:59 UTC (Thu)
                               by <b>mwh</b> (guest, #582)
                              [<a href="/Articles/14252/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      This sort of thing sounds interesting, but I wonder if it's too late in the day to fiddle with things on this level.  I mean, I'm reluctant to tie my code to Linux alone, never mind Linex-with-a-particular-file-system.<p>Depressing, isn't it?
      
          <div class="CommentReplyButton">
            <form action="/Articles/14252/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor14270"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reiser4 - the mammoth arrives</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 31, 2002 12:47 UTC (Thu)
                               by <b>xanni</b> (subscriber, #361)
                              [<a href="/Articles/14270/">Link</a>] 
      </p>
      
      </div>
      </summary>
      The clever thing about the design is that the new features are transparent to applications that don't want to deal with the new semantics.  So you can continue to write applications that just treat it as a fast, efficient POSIX filesystem while other applications can make use of the new magic on the very same files.  Existing filesystems have been stuck with 1940s concepts for too long; there are plenty of ideas from the 1960s and later that I've been looking forward to having for my applications, and the Reiser plugin architecture should help make these things a lot more feasible.<p>Cheers,<br>Andrew Pam<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/14270/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor14410"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reiser4 - the mammoth arrives</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 1, 2002 19:23 UTC (Fri)
                               by <b>radeex</b> (guest, #765)
                              [<a href="/Articles/14410/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      I'm going mad over want for an automatically CVSed ~/stuff. I looked at linux's existing virtual filesystem interfaces, and they're nasty for implementing something like this. I sure hope Reiser has a decent API for plugins (and that there will be a Python wrapper for it! Heck, maybe I'll write one myself if the API's good enough :))
      
          <div class="CommentReplyButton">
            <form action="/Articles/14410/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor14958"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reiser4 - the mammoth arrives</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 7, 2002 19:54 UTC (Thu)
                               by <b>job</b> (guest, #670)
                              [<a href="/Articles/14958/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I hope you mean RCS and not CVS..!
      
          <div class="CommentReplyButton">
            <form action="/Articles/14958/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor14413"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reiser4 - the mammoth arrives</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 1, 2002 19:41 UTC (Fri)
                               by <b>leandro</b> (guest, #1460)
                              [<a href="/Articles/14413/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      ReiserFS seems to try to be a filesystem on a DBMS.  I wonder if it would not be more powerful and easy to make that DBMS a relational one, like MS and IBM oft promised but never delivered.
      
          <div class="CommentReplyButton">
            <form action="/Articles/14413/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor14905"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reiser4 - the mammoth arrives</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 7, 2002 14:01 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/14905/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Like IBM promised ... ?
<br><br>
Didn't IBM <b>DELIVER</b> with the AS/400 / OS/400 combo?
<br><br>
And take a look at Pick, which was doing exactly that in the sixties. btw, did you know that Pick was the ?first? commercial DBMS to be ported to linux, some seven or so years ago?
<br><br>
And take a look at open source Pick, www.maverick-dbms.org
<br><br>
Cheers,<br>
Wol
      
          <div class="CommentReplyButton">
            <form action="/Articles/14905/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor43978"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Reiser4 - the mammoth arrives</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 12, 2003 1:30 UTC (Tue)
                               by <b>leandro</b> (guest, #1460)
                              [<a href="/Articles/43978/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>> <i>Didn't IBM DELIVER with the AS/400 / OS/400 combo?</i></blockquote>

<p>No, because the OS/400 isn't relational.  It is but the engine for SQL, and even SQL is in several violations of fundamental precepts and proscriptions of the relational model.</p>

<blockquote>> <i>take a look at Pick</i></blockquote>

<p>Pick is not even up to SQL standards.  It's not even a deviation from the relational model, but totaly unrelated.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/43978/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor14872"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GNU Hurd has this already</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 7, 2002 6:33 UTC (Thu)
                               by <b>kaol</b> (subscriber, #2346)
                              [<a href="/Articles/14872/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>They're called translators there.  You can do magic passwd files with them, just as in this example here.  Translators can provide even whole directory structures, so that 'mount' is done actually by setting a translator.
<p>If the plugins would run in user space and could be set by any user, this would make linux much more micro-kernel-like.
      
          <div class="CommentReplyButton">
            <form action="/Articles/14872/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2002, Eklektix, Inc.<BR>
            
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
