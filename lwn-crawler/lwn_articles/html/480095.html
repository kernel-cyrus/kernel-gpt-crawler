        <!DOCTYPE html>
        <html lang="en">
        <head><title>POHMELFS returns [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/480095/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/479074/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/480095/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>POHMELFS returns</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ready to give LWN a try?</b>
<p>
With a subscription to LWN, you can stay current with what is happening in the Linux and free-software community and take advantage of subscriber-only site features.  We are pleased to offer you <b><a href="https://lwn.net/Promo/nst-trial/claim">a free trial subscription</a></b>, no credit card required, so that you can see for yourself.  Please, join us!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>February 8, 2012</br>
           </div>
LWN <a href="/Articles/267896/">wrote briefly</a> about the POHMELFS
filesystem in early 2008; thereafter, POHMELFS has languished in the
staging tree without much interest or activity.  The POHMELFS
developer, Evgeniy Polyakov, <a href="/Articles/308566/">expressed his
unhappiness with the development process</a> and disappeared from the
kernel community for some time.
<p>
Now, though, <a href="/Articles/480093/">Evgeniy is back</a> with a new
POHMELFS release.  He said:
<p>
<div class="BigQuote">
	It went a long way from parallel NFS design which lived in
	drivers/staging/pohmelfs for years effectively without usage case -
	that design was dead.
<p>
	New pohmelfs uses elliptics network as its storage backend,
	which was proved as effective distributed system. Elliptics is used
	in production in Yandex search company for several years now and
	clusters range from small (like 6 nodes in 3 datacenters to host 15
	billions of small files or hundred of nodes to scale to 1 Pb used
	for streaming).
</div>
<p>
This time around, he is asking that the filesystem be merged straight into
the mainline without making a stop in the staging tree.  But merging a
filesystem is hard without reviews from the virtual filesystem maintainers,
and no such reviews have yet been done.  So Evgeniy may have to wait a
little while longer yet.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems-Network">Filesystems/Network</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/480095/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor480215"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 9, 2012 11:06 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/480215/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So, in place of the old POHMELFS, which had no use case other than 'just like NFS, only better, look, you can take an existing filesystem and distribute it across the network instantly!' (I'm not sure I can think of a more common use case), we have... this, which requires you to shift all your FS data onto new storage which cannot be accessed without pohmelfs.<br>
<p>
Not an improvement, sorry.<br>
<p>
I think I'll try out NFSv4 one of these days. Maybe it's got inotify support now. I'd really like something NFSish ('take an FS and make it distributed, you don't need a cluster or special fabrics or anything like that') but that is closer to POSIX and also preferably supports inotify so that modern KDE and GNOME versions have a chance of working properly if your home directory is exported over it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/480215/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor480228"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 9, 2012 12:09 UTC (Thu)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/480228/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That was also the flaw with the Andrew File System (AFS) I believe.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/480228/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor480418"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 9, 2012 21:18 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/480418/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah. AFS made NFS look like the soul of POSIX-compliance: no cross-directory hardlinks, close() with extra magic effects (IIRC), and its own very non-Unixlike permissions system. (Ironically it would look more Unixlike today than when it was originally written, because ACLs are fairly similar to the AFS permission model.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/480418/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor480485"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 10, 2012 4:14 UTC (Fri)
                               by <b>cmccabe</b> (guest, #60281)
                              [<a href="/Articles/480485/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If POSIX compliance was the path to victory, we'd all be using AT&amp;T's RFS now.  (I tried to find a link, but apparently RFS doesn't even have a wikipedia entry... sigh.)<br>
<p>
Personally, I think AFS was a great system that should have been more widely adopted.  It didn't get open sourced until much later, though, and the usual VHS vs. Betamax thing happened.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/480485/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor480239"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 9, 2012 13:24 UTC (Thu)
                               by <b>jackb</b> (guest, #41909)
                              [<a href="/Articles/480239/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Some people have great experiences with NFSv4. My experience has been that it's easy to encounter obscure bugs.<br>
<p>
About a month ago I went through a period in which running emerge on any client on a network in which /home and /usr/portage is hosted on an NFS server would randomly trigger lockd errors on all the other clients, requiring a hard reboot to resolve.<br>
<p>
Then after a few weeks the problem went away. I'm not sure which update (kernel, nfs-utils, portage, or some other dependency) resolved the problem. I didn't change any configuration during this time. That basically describes my experience with NFS - it's good when it works but it's also prone to mysterious and inexplicable problems from time to time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/480239/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor485008"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 3, 2012 10:01 UTC (Sat)
                               by <b>TRS-80</b> (guest, #1804)
                              [<a href="/Articles/485008/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Have you looked at GlusterFS? It stores files on a regular filesystem, and then makes them network accessible, optionally clustering, striping and mirroring them.
      
          <div class="CommentReplyButton">
            <form action="/Articles/485008/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor485317"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 5, 2012 23:46 UTC (Mon)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/485317/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I haven't looked at it, though I've heard of it. I'll give it a look: at first sight it looks really rather nice.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/485317/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor492327"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 13, 2012 19:15 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/492327/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No good. glusterfs cannot support inotify, because it is based on FUSE, and FUSE doesn't support inotify. Currently, it seems, only in-kernel distributed filesystems can support inotify -- and, as far as I can see, none of them do.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/492327/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor480226"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS versus Ceph</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 9, 2012 12:02 UTC (Thu)
                               by <b>abacus</b> (guest, #49001)
                              [<a href="/Articles/480226/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      Anyone who knows how POHMELFS compares to <a href="https://lwn.net/Articles/258516/">Ceph</a> ?
      
          <div class="CommentReplyButton">
            <form action="/Articles/480226/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor480487"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS versus Ceph</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 10, 2012 4:58 UTC (Fri)
                               by <b>cmccabe</b> (guest, #60281)
                              [<a href="/Articles/480487/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ceph has a three tier architecture-- monitors, metadata servers, and object storage daemons.<br>
<p>
The object storage layer of Ceph seems vaguely similar to Evgeniy's "elliptics network."  However, there are some very important differences.<br>
<p>
In Ceph, there is only ever one object storage daemon that has the authority to write to an object.  In contrast, the elliptics network is based on the Chord paper from MIT.[1]  So potentially there could be multiple writers to a single distributed hash table (DHT) object at once.  In his 2010 paper [2], Evigeny describes the DHT model as "write-always-succeed and eventual consistency."<br>
<p>
One of the biggest questions about any distributed system is how it handles "split-brain syndrome."  In other words, what happens when we cut the network into two halves which cannot talk to one another?  In Ceph, only one of those halves would be able to continue functioning.  This is accomplished by the monitors, who use Paxos [3] to decide on changes in cluster topology.  In contrast, in the elliptics network, it looks like both halves would continue functioning.  Then later, if they were reunified, we would make some attempt to "merge the histories."<br>
<p>
Merging histories sounds good in theory, but in practice it's kind of a quagmire.  What happened if one side of the brain decided to delete all files in /foo and remove the directory, and another side added files to this directory?  Who should "win"?  When the parallel universes implode into one, there are potentially going to be some unhappy users.  To be fair, some users seem willing to accept this.<br>
<p>
Another issue is caching.  Ceph has true POSIX read-after-write semantics.  If you're on one computer and you write a byte to a file at offset 0, and then immediately afterwards someone on another computer reads a byte from offset 0, he'll see exactly what you wrote.  In CAP terms [4], Ceph is a highly consistent system.  In contrast, in his commit message, Evigeny says that POHMELFS will "only sync (or close with sync_on_close mount option) or writeback will flush data to remote nodes."<br>
<p>
That actually seems to run counter to what I would call "strict" POSIX semantics.  However, I've never seen a formal definition of POSIX filesystem semantics and my usage is kind of informal.  If anyone has a document which clarifies it succinctly, I'd love to see it.<br>
<p>
Full disclosure: I worked on the Ceph project for a while.<br>
<p>
P.S.  Evigeny, if anything I've said here is wrong, please let me know.  Elliptics and POHMELFS seem like an interesting projects and I'm always curious to see what you'll come up with in the future.<br>
<p>
P.P.S. Evigeny, if you're reading this, do you have any ideas about avoiding replication storms?<br>
<p>
[1] <a href="http://www.pdos.lcs.mit.edu/chord">http://www.pdos.lcs.mit.edu/chord</a><br>
[2] <a href="http://www.ioremap.net/tmp/lk2010-elliptics-text.pdf">http://www.ioremap.net/tmp/lk2010-elliptics-text.pdf</a><br>
[3] <a href="http://the-paper-trail.org/blog/?p=173">http://the-paper-trail.org/blog/?p=173</a><br>
[4] <a href="http://en.wikipedia.org/wiki/CAP_theorem">http://en.wikipedia.org/wiki/CAP_theorem</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/480487/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor481946"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS versus Ceph</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 16, 2012 17:13 UTC (Thu)
                               by <b>raalkml</b> (guest, #72852)
                              [<a href="/Articles/481946/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; P.S. Evigeny, if anything I've said here is wrong</font><br>
<p>
Er, yes. It is "Evgeniy" :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/481946/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor490923"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS versus Ceph</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 6, 2012 5:46 UTC (Fri)
                               by <b>bradfitz</b> (subscriber, #4378)
                              [<a href="/Articles/490923/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's complicated.<br>
<a href="http://en.wikipedia.org/wiki/Romanization_of_Russian">http://en.wikipedia.org/wiki/Romanization_of_Russian</a><br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/490923/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor490931"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">POHMELFS versus Ceph</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 6, 2012 7:34 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/490931/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, the newest Russian transliteration rules (I hate them) state that it should be "Evgeni" :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/490931/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2012, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
