        <!DOCTYPE html>
        <html lang="en">
        <head><title>Rustaceans at the border [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/889924/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/891296/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/889924/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Rustaceans at the border</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>LWN.net needs you!</b>
<p>
Without subscribers, LWN would simply not exist.  Please consider
       <a href="/Promo/nst-nag2/subscribe">signing up for a subscription</a> and helping
       to keep LWN publishing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>April 14, 2022</br>
           </div>
Support for developing in the <a href="https://www.rust-lang.org/">Rust</a>
language is <a 
href="/Articles/870555/">headed toward the kernel</a>, though just when it
will land in the mainline is yet to be determined.  The Rust patches are
progressing, though, and beginning to attract attention from beyond the
kernel community.  When two languages — and two different development
communities — come together, the result can be a sort of cultural clash.
Some early signs of that are appearing with regard to Rust in the kernel;
if the resulting impedance mismatches can be worked out, the result could
be a better development environment for everybody involved.
<p>
The latest round of Rust patches was <a
href="/ml/linux-kernel/20220317181032.15436-1-ojeda@kernel.org/">posted by
Miguel Ojeda</a> on March&nbsp;17.  This time around, Rust support has
moved forward to <a
href="https://blog.rust-lang.org/2022/02/24/Rust-1.59.0.html">version
1.59.0</a> of the Rust language, which has stabilized a 
couple of important (for the kernel) features.  The patches add a new module
abstracting access to hardware random-number generators.  A
<tt>CString</tt> type has been added for C strings.  The spinlock
implementation has been improved.  All told, the patch series, which can be
found in the linux-next repository, adds over 35,000 lines of code and
documentation; it is a considerable body of work.
<p>
There has been no public discussion on just when these patches might be
deemed ready to go into the mainline kernel.  Rust support is still
considered "experimental" even by its developers;  that is likely to
remain the case for some time (even after this work is merged into the
mainline) until the language proves itself for kernel
development.
<p>
Clearly, though, some developers are beginning to play with it — and they
are not all traditional kernel developers.  Recently, Nándor Krácser <a
href="/ml/rust-for-linux/CAHkG_ewRo5uPOue3ZMAAPAc+eP7MNNU5iVym-JVG1jN7HD+XMg@mail.gmail.com/">asked</a>
on the Rust-for-Linux mailing list
about the possibility of including Rust modules from the <a
href="https://crates.io/">crates.io repository</a> into the kernel build.
This request, seemingly, <a
href="/ml/rust-for-linux/CAHkG_ewQ3uJBTTPQ24+faW6v2ZHvGhTR2qTpfrj6URTr6hy0SQ@mail.gmail.com/">is
not just for small stuff</a>:
<p>
<blockquote class="bq">
	Currently I'm experimenting with different crates which I would
	like to use in my module, serialization libraries, math
	libraries. etc, even complex ones, are really hard to pull in as a
	direct source library (copy the code to the module), and if they
	have a transitive dependency that complicates things even more.
</blockquote>
<p>
Shortly thereafter, Chris Suter <a
href="/ml/rust-for-linux/CAKfU0DLS5icaFn0Mve6+y9Tn1vL+eLKqfquvXbX4oCpYH+VapQ@mail.gmail.com/">showed
up</a> with a similar request.  Rust developers working with kernel
modules, it seems, want more functionality than the current <tt>kernel</tt>
crate provides to them.
<p>
This should not be entirely surprising.  Like many newer languages, Rust is
closely tied to a language-specific package-management system and
associated central repository; in this case, the <a
href="https://doc.rust-lang.org/cargo/">Cargo</a> package manager and
crates.io.  Developers in such languages quickly become accustomed to
pulling in new modules (and any dependencies they may have) with a simple
command, and to having the build system make dependencies magically appear
when building a new program.  For these developers, the idea of working in an environment where
complex libraries are not obtainable with a few keystrokes starts to have a
distinct lack of appeal after a while.
<p>
The kernel does not work in this way, though.  To those of us who didn't
grow up with that kind of development environment, it looks like a recipe
for bloat, bugs, and security problems.  Depending on central repositories
opens up a project to problems like the famous <a
href="/Articles/681410/">leftpad incident</a> or, worse, the deliberate
insertion of malicious software.  A lack of attention to API compatibility
leads to a thicket of version requirements and dependency-resolution
problems so complex that <a
href="https://thoth-station.ninja/">machine-learning systems</a> are
emerging to deal with them.  Plus it all just looks so undisciplined and
messy.
<p>
At least some of the criticisms of this mode of development are valid, but
it's also not 
hard to detect a bit of Stockholm syndrome as well.  For many of us, for
much of our careers, building a new program from source was likely to
involve a lengthy cycle of "try to build, figure out which dependency it
wants now, install the dependency" iterations — and recursive iterations at
that when the dependencies turn out to have missing dependencies of their
own.  This exercise helped us to understand our systems better and must
somehow have helped us to build better moral character, so we can't understand
why Kids These Days just don't want to live that way.
<p>
The kernel community seems more than usually likely to have developers who
are resistant to newer methods of development.  The kernel has to stand
alone, and its developers keep a firm grip on its dependencies.  The kernel
repository contains all of the code needed to build a working kernel;
developers can be expected to install a limited set of tools to do the
build, but the idea of installing external libraries to build into the
kernel would not go over well.
<p>
So when developers see a shopping list like the one <a
href="/ml/rust-for-linux/CAKfU0DJ1AqR4cy4=706qRGESozHii9dPL5BYQV047cZkyn3RzA@mail.gmail.com/">posted</a>
by Suter:
<p>
<blockquote class="bq">
	Like I said, I'm interested in futures. Why it's useful: async Rust
	is arguably more common and easier to use than other forms of
	multi-threaded processing. Other crates that I'd like: anyhow,
	bincode, byteorder, log, once_cell, pin-project, rand, serde, slab,
	static_assertions, uuid plus some more esoteric ones.
</blockquote>
<p>
The first temptation will be to either run and hide or to respond in a way
that may not be compliant with anybody's code of conduct.
<p>
There are some good reasons for this.  As Greg Kroah-Hartman <a
href="/ml/rust-for-linux/YjsHLJPb2haKbOBg@kroah.com/">pointed out</a>, code
that has been written to be useful in user space almost certainly does not
work within the constraints imposed on kernel code.  "Async Rust" knows
nothing about kernel threads or how context switching is done in the
kernel, for example.  Kernel code must be extremely 
careful in how it allocates memory, must not use floating-point arithmetic,
cannot store large data structures on the stack, and cannot use unbounded
recursion, among many other rules.  Most user-space code, which was not
written with these rules in mind, will fare poorly in this environment.
For this reason, Kroah-Hartman said that any functionality desired by Rust
programs must be specially written and provided in the dedicated
<tt>kernel</tt> crate.
<p>
The Rust-for-Linux developers understand this situation and <a
href="/ml/rust-for-linux/CAFRnB2W+8XqOj0aL5DP2cMNLO2uR0DpPk-qB-oC7r=zT5N5gGA@mail.gmail.com/">are
not envisioning</a> adding the ability to pull in modules with a tool like
Cargo.  So it is interesting that a long-time kernel developer, Kent
Overstreet, was the one to <a
href="/ml/rust-for-linux/20220330204353.57w3fxtaw4wwqvi3@moria.home.lan/">argue</a>
for a different approach.  "<q>The world is changing</q>", he said,
and perhaps it is time for the kernel community to change with it as well.
There are numerous situations where it can be beneficial to run code in
both user and kernel space, he said, and the fact that doing so is currently painful
is a problem for developers on both sides:
<p>
<blockquote class="bq">
	The solution to problems like these are to stop thinking that
	kernelspace and userspace _have_ to be completely different beasts
	- they really don't have to be! and start encouraging different
	thinking and tooling improvements that will make our lives easier.
</blockquote>
<p>
It is true that the boundary between kernel and user space has become more
porous over the years.  Various subsystems provide hooks that allow
formerly kernel-specific tasks to be carried out in user space instead,
while user space can use BPF to run code inside the kernel.  But the two
environments are still quite different, and code meant to run on one side
generally cannot run on the other.

There has not been a lot of effort put into thinking about how to reduce
that divide; perhaps it really is time for that to change.  The Rust
language might just be the environment in which this transformation could
happen.  As Overstreet put it:
<p>
<blockquote class="bq">
	Rust's conditional compilation &amp; generics story is _much_ better
   	than what we've had in the past in C and C++, meaning writing Rust
   	code that works in both userspace and kernelspace is much saner
   	than in the past.
</blockquote>
<p>
If an initiative like this were to work, it could greatly reduce the
barrier to entry for future kernel developers while making a lot of useful
code available to the kernel community.  It would be a different kernel
project than the one we know now, but it might be a more fun and more
productive one.
<p>
Interesting things tend to happen when immigrants show up in a new land.
They can often create a backlash among those who are already there — the
new people dress funny and their cooking smells weird, after all, and some
of them even have <a href="https://rustacean.net/">a crab</a> as their mascot.  But they
can also bring energy and ideas that shake up their new home and make
it richer for everybody involved.  It may just be that we will see
something like that happen if and when a crowd of Rust developers descends
upon the kernel community.  The end result could be difficult to recognize
— and perhaps better than anything we had before.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_tools-Rust">Development tools/Rust</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/889924/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor891372"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 19:24 UTC (Thu)
                               by <b>rvolgers</b> (guest, #63218)
                              [<a href="/Articles/891372/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &quot;Async Rust&quot; knows nothing about kernel threads or how context switching is done in the kernel, for example. Kernel code must be extremely careful in how it allocates memory, must not use floating-point arithmetic, cannot store large data structures on the stack, and cannot use unbounded recursion,</font><br>
<p>
The Rust response to this would probably be &quot;can&#x27;t we just... solve that?&quot;<br>
<p>
Various embedded Rust folks have been doing work on things like static stack usage analysis. Tight stack requirements are not unique to the Linux kernel by any means, it is clearly desirable to have insight and control over that.<br>
<p>
And as for memory allocation, again, people write Rust code which has no support for memory allocation at all, using libraries which are on crates.io. And they&#x27;re not always super custom libraries, sometimes it&#x27;s literally just a matter of enabling the &quot;no_std&quot; feature flag, and you can use a bog-standard Rust library (with a somewhat more limited API, of course).<br>
<p>
More complex things like interrupt context seem more likely to remain &quot;here be dragons&quot; territory (just like signal handlers are, to some degree, in userspace). But Rust is hardly unique in that; not all kernel C functionality is safe to use there either.<br>
<p>
TLDR: Some of the arguments being used smack of prejudice against Rust ecosystem libraries as being by definition userland-focused. Many are, but many are not, and some adapt well to either use case.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891372/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891375"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 19:47 UTC (Thu)
                               by <b>atnot</b> (subscriber, #124910)
                              [<a href="/Articles/891375/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; sometimes it&#x27;s literally just a matter of enabling the &quot;no_std&quot; feature flag, and you can use a bog-standard Rust library</font><br>
<p>
To add to that, some of the requested libraries like pin_project and serde to my knowledge do not even really exist at runtime at all. There are a lot of utility crates like that which contain a bunch of fancy macro and type definitions, at most a few lines of which will actually end up in the final binary.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891375/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891384"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 22:13 UTC (Thu)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/891384/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>On top of that, this is a case where a perfect solution isn't needed; if automation can permit 70% of the crates that would work well in kernel space into the kernel, and provide a way for a human to audit and certify the remaining 30% of those that would work as accepted for kernel use, that's a good outcome. Which, in turn, means that a conservative approximation is good enough - rejecting 90% of crates as "not kernel compatible for $reason", accepting 7% as "kernel compatible", and leaving 3% as "not sure - needs a human involved" would work just fine as a solution.



      
          <div class="CommentReplyButton">
            <form action="/Articles/891384/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891392"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 22:33 UTC (Thu)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/891392/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>sometimes it's literally just a matter of enabling the "no_std" feature flag, and you can use a bog-standard Rust library (with a somewhat more limited API, of course).</blockquote>

<p>Rust feature flags are additive, so the convention is to declare an on-by-default feature flag named <code>std</code> which toggles the <code>no_std</code> attribute.</p>

<p>(<code>no_std</code> being equivalent to GCC's <code>-nostdlib</code>.)</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/891392/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891399"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 0:05 UTC (Fri)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/891399/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Note that -nostdlib is getting rid of almost everything, whereas Rust&#x27;s no_std only gets rid of stuff from std itself (much of what you think of as Rust&#x27;s standard library was only re-exported from std and actually lives in core or alloc).<br>
<p>
So e.g. suppose you&#x27;ve got a slice (maybe an array, but however you got it, some contiguous memory) of Things and you&#x27;d like to sort them. In C without the standard library you&#x27;re out of luck, code it yourself, but in Rust lacking std only means you don&#x27;t have a nice stable allocating merge sort, you do still get a perfectly usable (albeit not always trivially what you needed) in-place unstable sort.<br>
<p>
https://rust-for-linux.github.io/docs/core/primitive.slice.html#method.sort_unstable<br>
<p>
When C was invented such things would be too heavy, but today Rust&#x27;s compiler and linker are certainly smart enough that if you never actually perform sort_unstable the code to implement it is omitted from your binary so the &quot;price&quot; of Rust&#x27;s more comprehensive library is only that the documentation is a little larger and for that price you avoid the unsettlingly common (even in Linux) discovery that six people have re-implemented some useful idea, meaning the kernel carries not one but six copies of the code, and worse at least one of them is actually faulty.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891399/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891492"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 23:46 UTC (Fri)
                               by <b>Hello71</b> (subscriber, #103412)
                              [<a href="/Articles/891492/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; When C was invented such things would be too heavy, but today Rust&#x27;s compiler and linker are certainly smart enough that if you never actually perform sort_unstable the code to implement it is omitted from your binary</font><br>
<p>
afaik, unix linkers have pruned unnecessary object files from the final link for basically as long as unix has existed. this is the origin of needing to specify -l flags in dependency order. this doesn&#x27;t help with dynamic linking, but rust has no magic pixie dust there either.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891492/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891493"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 1:00 UTC (Sat)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/891493/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; unix linkers have pruned unnecessary object files from the final link for basically as long as unix has existed</font><br>
<p>
Yes, but Rust goes farther. It doesn&#x27;t just prune unused object files as a whole but individual functions, global data, trait implementations, and even code paths, taking advantage of static analysis across module boundaries. The closest equivalent in C would be link-time optimization, which is relatively new and not enabled by default.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891493/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891565"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 11:26 UTC (Sat)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/891565/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Any C compiler worth its salt already can put each function into its own section, which the linker then skips if it&#x27;s not referenced. This scheme has been supported by gcc/ld since, umm, whenever. It&#x27;s hardly as comprehensive as LTO but gets the job done well enough for the kernel and, frankly, most other codebases that aren&#x27;t heavily obfuscated C++.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891565/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891610"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 2:48 UTC (Sun)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/891610/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You might want to check whether CONFIG_LD_DEAD_CODE_DATA_ELIMINATION is set in your kernel before making such confident assertions.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891610/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor891370"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 19:24 UTC (Thu)
                               by <b>atnot</b> (subscriber, #124910)
                              [<a href="/Articles/891370/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think Kent Overstreet hinted at another good point in the message:<br>
<p>
<font class="QuotedText">&gt; We already have large swaths of code being imported from userspace into the kernel as-is - e.g. zstd [...]</font><br>
<p>
Presumably, this is in reference to this event last November:<br>
<p>
<font class="QuotedText">&gt; Hi Linus,</font><br>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt; I am sending you a pull request to add myself as the maintainer of zstd and</font><br>
<font class="QuotedText">&gt; update the zstd version in the kernel, which is now 4 years out of date,</font><br>
<font class="QuotedText">&gt; to the latest zstd release. [...]</font><br>
(<a href="https://lore.kernel.org/all/20211109013058.22224-1-nickrterrell@gmail.com/">https://lore.kernel.org/all/20211109013058.22224-1-nickrt...</a>)<br>
<p>
It sounds like it would already be pretty desirable in general to create a more formal, more automated version of the process of making vetted external dependencies available to the kernel, not just for Rust, but also for C.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891370/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891495"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 1:39 UTC (Sat)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/891495/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The kernel&#x27;s got a quarter of a gigabyte of binary blob sitting in the amdgpu part of the tree already, I think they&#x27;ve surrendered their authority to be picky at this point.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891495/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891496"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 1:52 UTC (Sat)
                               by <b>davmac</b> (guest, #114522)
                              [<a href="/Articles/891496/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Where is that in the tree exactly? (In 5.15.32 The whole of the amdgpu directory has 45M, the containing amd directory totals 328M but most of that seems to be include files)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891496/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891621"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 10:05 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/891621/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <p>Said include files are precisely these “binary blobs” people are talking about.</p>

<p>They include hundreds of thousands of flags (maybe millions by now?) which do god-knows-what and are not documented anywhere. The code which toggles these is, essentially, a decompiled binary blob.</p>

<p>This is still kind-of better than what nVidia is doing (you can execute that mess on the RISC-V without binary translator, e.g.) but only marginally so.</p>

<p>You couldn't even prove that said code doesn't affect the kernel! The comments which are there strongly hints that code does what it is supposed to do, but you have absolutely no way to verify if said comments are true or not!</p>

<p>What's worse: it's not clear if or how one can improve that situation: AMD releases new architectures too fast for anything else. If there would even be someone who may decide to actually verify what all that code is doing and AMD would be supportive of that effort… I'm not even sure they have the required information internally! They are literally doing the best effort they could, this does not mean we understand what the heck is happening there!</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/891621/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891695"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 18, 2022 5:55 UTC (Mon)
                               by <b>nhaehnle</b> (subscriber, #114772)
                              [<a href="/Articles/891695/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You haven&#x27;t actually pointed at anything?<br>
<p>
Last I checked, our binary blobs were in the firmware repository, not the kernel. IIRC the kernel contains a pre-assembled copy of the shader trap handler, but the trap handler source is right next to it and LLVM&#x27;s assembler can be used to rebuild a binary.<br>
<p>
The header situation is unfortunate, but it is the closest thing to the hardware team&#x27;s source of truth that could be open sourced. It&#x27;s also decidedly not binary blobs -- there is no code there, just register definitions.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891695/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891761"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 5:58 UTC (Tue)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/891761/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Nvidia produces a PNG with bundled libpng shim and gets flamed mercilessly for decades over it.<br>
<p>
AMD throws a massive obfuscated XPM over the wall, and gets praised by the tech splogs as a messiah of FOSS for giving gcc oh so much valid input to chew on.<br>
<p>
Intel, for all their faults, just gives people the damn SVG.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891761/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891765"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 6:12 UTC (Tue)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/891765/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What&#x27;s obfuscated about the AMD driver? <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/gpu/drm/amd/include/asic_reg/dce/dce_12_0_sh_mask.h">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/...</a> is a huge file, but it reads exactly like I&#x27;d expect a set of register definitions to read - there&#x27;s just a *lot* of registers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891765/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891927"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 20:53 UTC (Tue)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/891927/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What&#x27;s the point in including definitions of all the registers, while actual code uses only some of them? It&#x27;s obfuscating which registers are important. On the other hand, the actual code is not obfuscated...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891927/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891950"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 20, 2022 3:48 UTC (Wed)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/891950/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Are you really arguing in favour of less documentation?<br>
<p>
The Andrew Schulman Programming Series (&quot;Undocumented DOS&quot;, &quot;DOS Internals&quot;, &quot;The Undocumented PC&quot;, &quot;Undocumented Windows&quot;, &quot;Windows Internals&quot;, etc.) would like a word with you.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891950/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor892598"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 25, 2022 19:41 UTC (Mon)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/892598/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And on the other end there&#x27;s the OOXML specification...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/892598/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor893127"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 29, 2022 14:09 UTC (Fri)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/893127/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <p>The problem with the OOXML specification isn't over-documentation. It's rampant NIH combined with "Good time to clear out code debt? What's that?"</p>

<p>For example, the XLS to XLSX migration would have been a great time to ditch Excel 1.0's date format which <a rel="nofollow" href="http://www.robweir.com/blog/2006/10/leap-back.html">assumes 1900 was a leap year</a>. Instead, they baked it into XLSX.</p>

<p>Combine that with how OOXML embeds a million other things that ODF farms out to other specs (eg. SVG for vectors) and it's easy to see why OOXML is such a mess. They pushed a million implementation details of a legacy codebase into the spec document and then politicked it into being a "standard" to make it difficult for others to implement. (As I remember, they fronted the membership fees to get a bunch of their allies added to the voting body just in time for the vote.)</p>




      
          <div class="CommentReplyButton">
            <form action="/Articles/893127/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor893135"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 29, 2022 16:00 UTC (Fri)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/893135/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The problem with the OOXML specification isn&#x27;t over-documentation.</font><br>
<p>
As if &quot;do X like Excel 2003 did&quot; was anything but under-documentation.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/893135/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor893148"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 29, 2022 19:11 UTC (Fri)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/893148/">Link</a>] 
      </p>
      
      </div>
      </summary>
      If they have some of that, then that's also a problem. I was referring to how it's made needlessly difficult by things like these snips quoted from the post I linked:

<blockquote>For legacy reasons, an implementation using the 1900 date base system shall treat 1900 as though it was a leap year. [Note: That is, serial value 59 corresponds to February 28, and serial value 61 corresponds to March 1, the next day, allowing the (nonexistent) date February 29 to have the serial value 60. end note] A consequence of this is that for dates between January 1 and February 28, WEEKDAY shall return a value for the day immediately prior to the correct day, so that the (nonexistent) date February 29 has a day-of-the-week that immediately follows that of February 28, and immediately precedes that of March 1.</blockquote>
<hr>

<blockquote><p>date1904 (Date 1904)</p>

<p>Specifies a boolean value that indicates whether the date systems used in the workbook starts in 1904.

    <p>A value of on, 1, or true indicates the date system starts in 1904.<br>
    A value of off, 0, or false indicates the workbook uses the 1900 date system, where 1/1/1900 is the first day in the system.</p>

    The default value for this attribute is false.</blockquote>

(That particular example is their "TIFF has little-endian and big-endian versions" moment. An XLSX file contains a flag that indicates whether the dates are serializations of Excel 1.0 for Windows's in-memory format or Excel 1.0 for Mac's in-memory format, which have different epochs and different bugs... because apparently, in true Microsoft fashion, they were made by different teams who at least didn't communicate and probably saw each other as competitors.)


      
          <div class="CommentReplyButton">
            <form action="/Articles/893148/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor893157"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 29, 2022 20:20 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/893157/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
People keep referring to that, but in reality it&#x27;s just a couple of relatively unimportant formatting directives that you can safely ignore in practice. OOXML is _really_ overspecified.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/893157/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor891607"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 0:58 UTC (Sun)
                               by <b>developer122</b> (guest, #152928)
                              [<a href="/Articles/891607/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;d also like to point out, nearly 100% of the code in the kernel already gets downloaded from an external repository: Linus&#x27; git.<br>
<p>
If there were actually the proper infrastructure in place, useful rust crates could be pulled down as sub-gits or whatever along with firmware and everything else. Whether it&#x27;s a good idea to auto-mirror new versions from crates.io, or how dependencies should be handled is an open question, but downloading a ton of code when you start to build a kernel isn&#x27;t a new idea at all.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891607/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor891373"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 19:39 UTC (Thu)
                               by <b>Gaelan</b> (guest, #145108)
                              [<a href="/Articles/891373/">Link</a>] (38 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>Most user-space code, which was not written with these rules in mind, will fare poorly in this environment.</blockquote>

<p>It's worth nothing that user-space Rust will fare better than user-space C in this regard. Rust's standard library is split into three pieces: core, alloc, and std. core runs pretty much anywhere; alloc contains the interfaces that require malloc() (or something similar); and std contains the interfaces that require an operating system. Kernelspace Rust obviously can't use std (and uses a custom fork of alloc), but there's a large body of "no_std" Rust code on crates.io which should uses only core and should, in principle, run fine in kernelspace.

<p>This already happens in practice: no_std crates are extensively used by people writing Rust for devices like microcontrollers, which (due to their small memory) are also likely to be sensitive to concerns about stack space, recursion, etc.

<p>While there will obviously be crates that would never be useful in kernel space, and it's certainly wise to be suspicious of introducing dependencies on third-part package maintainers, there's still a lot of code out there which could be very useful in the kernel.



      
          <div class="CommentReplyButton">
            <form action="/Articles/891373/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891378"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 19:59 UTC (Thu)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/891378/">Link</a>] (34 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think the question is more like:<br>
Should we depend our kernel build on external sources such as crates.io?<br>
<p>
Yes, we should allow no_std crates to be used from kernel code.<br>
(after careful review for things like floating point, etc..)<br>
<p>
But how should we integrate the crate?<br>
Should we only declare the version in the kernel&#x27;s Cargo.toml and fetch the latest compatible SemVer at kernel build time? That would result in kernels with the same version having different content.<br>
Should we pin a specific version via Cargo.lock or similar?<br>
Should we copy the crate into the kernel tree to be independent of crates.io?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891378/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891380"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 20:29 UTC (Thu)
                               by <b>djc</b> (subscriber, #56880)
                              [<a href="/Articles/891380/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Keeping the Cargo.lock file in the Git repository is pretty common for Rust applications, we do that at work.<br>
<p>
I don&#x27;t see the point in Rust for Linux forbidding the use of crates.io crates. Yes, you&#x27;d probably want to enforce that only no_std crates are pulled in (I don&#x27;t know if that&#x27;s currently supported), but otherwise it seems like a great way of sharing functionality with other parts of the ecosystem.<br>
<p>
I can see how pulling in an async runtime would be a bigger deal, but at the same time being able to write async code instead of callback hell seems like it might be important for making code easier to understand the same way it does in userspace.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891380/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891393"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 22:48 UTC (Thu)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/891393/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote> Keeping the Cargo.lock file in the Git repository is pretty common for Rust applications, we do that at work.</blockquote>

I think it'd be more likely they'd want to use <code>cargo vendor</code> (which automatically vendors the specified dependencies) so the kernel repository can <em>use</em> third-party crates but rely on crates.io only as a means of standardizing/automating the rote steps in their existing workflow for manually OKing updates to vendored dependencies.

<blockquote>I can see how pulling in an async runtime would be a bigger deal, but at the same time being able to write async code instead of callback hell seems like it might be important for making code easier to understand the same way it does in userspace.</blockquote>

They'd almost certainly want to write their own executor which is just an API adapter for the relevant kernel machinery.

<p>That's the whole point of Rust's async system being designed as it is. To avoid tying everyone to a single executor.</p>

(Yeah, most people use tokio because the APIs provided beyond the executor itself are still working toward standardization, but those are generally <code>std</code> things like userspace I/O anyway, so that's not relevant to kernel or embedded use-cases.)






      
          <div class="CommentReplyButton">
            <form action="/Articles/891393/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor891394"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 22:42 UTC (Thu)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/891394/">Link</a>] (28 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I absolutely *don&#x27;t* think we should pull in third-party crates over the network. I do think we should have a means of &quot;vendoring&quot; unmodified upstream crates that work in the kernel, without having to rewrite them.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891394/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891403"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 0:32 UTC (Fri)
                               by <b>IanKelling</b> (subscriber, #89418)
                              [<a href="/Articles/891403/">Link</a>] (21 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I absolutely *don&#x27;t* think we should pull in third-party crates over the network.</font><br>
<p>
I strongly agree. <br>
<p>
For multiple reasons, including the fact that when I go to <a href="https://crates.io">https://crates.io</a> I get a blank page which says I should enable javascript. Please don&#x27;t make kernel development require remote code execution on my machine.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891403/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891404"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 0:55 UTC (Fri)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/891404/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I just want to be clear on this - you&#x27;ll download kernel source code from the internet and type &quot;make&quot;, resulting in a great deal of code running on your system, but you&#x27;re not ok with javascript running inside a strongly sandboxed environment?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891404/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891425"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 8:39 UTC (Fri)
                               by <b>tux3</b> (subscriber, #101245)
                              [<a href="/Articles/891425/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Presumably a possible defense for the more general version of this position is that the review process is very different, between web pages in general and the kernel.<br>
<p>
While I personally run most JavaSscript without a second though, some websites that are not crates.io sometimes run undesirable JS - cryptominers, supercookies, what have you. Sometimes there is third-party JS code that has clever ways of escaping the sandboxes. <br>
I am told Firefox&#x27;s content process lost connection to the X11 server just a month ago. Although the sandbox is improving as well, hardness may sometimes be a relative thing.<br>
<p>
In contrast, I will trust Debian to update many millions of lines of code straight from the internet into a running system, much of it which could enter my $HOME. <br>
If the kernel were to pull in more external libraries, like it did with zstd, there&#x27;s more than a couple git remotes that I&#x27;d feel I could pull from without being gifted any crypto miner or other code that might try to poke at a sandbox.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891425/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891427"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 8:49 UTC (Fri)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/891427/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I have no reason to believe that kernel code gets significantly more review than crates.io does - I agree that the web as a whole doesn&#x27;t meet that bar, but frankly most software I pull from Debian has also had much less review than the kernel does (<a href="https://lists.debian.org/debian-devel/2003/02/msg00771.html">https://lists.debian.org/debian-devel/2003/02/msg00771.html</a> is an example of this not going well) so it feels like what&#x27;s missing is a way to express what level of trust I place in any provider of code I end up executing rather than just to assert that websites that use Javascript are unacceptable .<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891427/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891430"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 9:08 UTC (Fri)
                               by <b>tux3</b> (subscriber, #101245)
                              [<a href="/Articles/891430/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I agree with that. As for crates.io, I have respect for the work they do and I&#x27;m happy to run their code (though I have not read it).<br>
This may be getting off-topic, but now I&#x27;m curious if you have anything specific in mind when you write about expressing levels of trust — would that look like further sandboxing?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891430/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891431"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 9:27 UTC (Fri)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/891431/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Great question! I spent a while looking into whether it was feasible to apply different LSM profiles (SELinux/Apparmor/whatever) to dpkg depending on where the package was downloaded from, and unfortunately the architecture doesn&#x27;t make that terribly possible. From the web perspective, I think that probably comes down to extension-level handling at the moment? In an ideal universe we&#x27;d have infrastructure to tie any given piece of javascript back to an upstream repo and make a trust decision based on things like licensing and review assurances, but that feels like kind of a lot of work.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891431/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor891459"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 13:51 UTC (Fri)
                               by <b>IanKelling</b> (subscriber, #89418)
                              [<a href="/Articles/891459/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hah good point. I do generally try to also run make within a sandbox too though. Websites should not requiring people to download and run a program to simply read a page of text. Crates.io is almost entirely used for text that could be simple html.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891459/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891788"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 8:28 UTC (Tue)
                               by <b>LtWorf</b> (subscriber, #124958)
                              [<a href="/Articles/891788/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; but you&#x27;re not ok with javascript running inside a strongly sandboxed environment?</font><br>
<p>
The fact that there is a CVE a day or so for chromium and firefox contraddicts your statement about &quot;strongly sandboxed&quot;.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891788/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891789"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 8:50 UTC (Tue)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/891789/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Very few of those CVEs involve sandbox escapes.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891789/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891794"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 9:29 UTC (Tue)
                               by <b>LtWorf</b> (subscriber, #124958)
                              [<a href="/Articles/891794/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Only one is needed though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891794/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891795"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 9:45 UTC (Tue)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/891795/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sure, but only one local privilege escalation bug in Linux is needed for any non-Javascript attack vector and there&#x27;s more of those than there are Chrome sandbox escape chains.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891795/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891846"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 13:43 UTC (Tue)
                               by <b>LtWorf</b> (subscriber, #124958)
                              [<a href="/Articles/891846/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But I trust anything coming from apt much more than anything coming from some website.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891846/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891848"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 13:59 UTC (Tue)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/891848/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; But I trust anything coming from apt much more than anything coming from some website.</font><br>
<p>
The conversation isn&#x27;t really about what you personally trust but what ought to be considered trusted by people and that should be based on empirical data.  For the most part, distributions don&#x27;t vet code from upstream for security issues and sometimes distribution specific patching can even introduce security holes (A notorious example is <a href="https://www.debian.org/security/2008/dsa-157">https://www.debian.org/security/2008/dsa-157</a>).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891848/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891850"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 14:01 UTC (Tue)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/891850/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <p>Your link is truncated - I'm guessing you mean <a href="https://www.debian.org/security/2008/dsa-1571">this OpenSSL predictable RNG security advisory</a>?


      
          <div class="CommentReplyButton">
            <form action="/Articles/891850/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891855"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 14:30 UTC (Tue)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/891855/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Your link is truncated - I&#x27;m guessing you mean this OpenSSL predictable RNG security advisory?</font><br>
<p>
Correct.  Thanks<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891855/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891866"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 16:58 UTC (Tue)
                               by <b>amacater</b> (subscriber, #790)
                              [<a href="/Articles/891866/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is a favourite stick to drag up to beat Debian with: what&#x27;s more interesting is to actually go back and realise what happened when it came to light. The work by Luciano Bello was first class: Debian&#x27;s response was clear and relatively immediate - explain the problems with OpenSSL and thereby OpenSSH fully, create a tool to deny-list problem keys, explain what needed regenerating and why.<br>
<p>
The mistake came as a result of actually querying with the upstream maintainers what should be done and doing it inappropriately once too often. I haven&#x27;t seen other incidents handled as well by other teams and other distributions - let alone by commercial software. It&#x27;s worth looking at as something being handled well at the time and in retrospect, not necessarily trotted out at every opportunity 14 years later<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891866/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891887"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 17:36 UTC (Tue)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/891887/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; This is a favourite stick to drag up to beat Debian with</font><br>
<p>
As I specifically noted already, it was just an example of a distribution specific vulnerability that is more well known (and it has some significance due to OP&#x27;s reference to apt but mostly incidental). Your defensive reaction to that specific example does nothing to address the broader point.  Replace that example with another distribution example if it helps you, here you go: <br>
<p>
<a href="https://nvd.nist.gov/vuln/detail/CVE-2007-5962">https://nvd.nist.gov/vuln/detail/CVE-2007-5962</a><br>
<p>
We can certainly find more across distributions since everytime backporting or distribution specific patching happens (even as simple as a permissions change in the filesystem), there is deviations from upstream that introduces some potential risk of bugs including security vulnerabilities that don&#x27;t exist upstream.  So the broader point is that humans are infallible and occasions make mistakes (not even counting malicious attackers) and we shouldn&#x27;t automatically rely on distributions to provide us a better security compared to well vetted upstream projects.  Atleast in some cases, they do worse.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891887/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891889"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 17:39 UTC (Tue)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/891889/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Correction:   humans are not infallible.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891889/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891897"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 18:11 UTC (Tue)
                               by <b>amacater</b> (subscriber, #790)
                              [<a href="/Articles/891897/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well vetted upstream projects is the difficulty. &quot;With enough eyeballs, all bugs are shallow&quot; - not necessarily if the eyelids (or codebases) happen to be effectively closed ... and see the discussions round the security of Chrome/Chromium regularly, for example.<br>
<p>
The case of Rust in the kernel is similar to the problems of vendored code necessary to keep some ecosystems running: Node is the obvious one that causes problems to Debian and others. <br>
<p>
It&#x27;s possible that there&#x27;s just an instinctive awareness of potential problems to come.<br>
 There&#x27;s _so_ much code there that&#x27;s intertwined and impenetrable and we&#x27;ve all been subject on occasion to being force-marched forwards by large scale change in someone else&#x27;s ecosystem that we can&#x27;t control - see, for example init system flamewars or Python 2 -&gt; Python 3 (or a.out to ELF if your memory is long enough).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891897/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891901"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 18:28 UTC (Tue)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/891901/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Well vetted upstream projects is the difficulty</font><br>
<p>
To be clear, the original context here was visiting crates.io website compared to installing a distro package.<br>
<p>
<font class="QuotedText">&gt; The case of Rust in the kernel is similar to the problems of vendored code necessary to keep some ecosystems running</font><br>
<p>
Vendored code already exists in the Linux kernel.  The Rust mechanisms for tracking vendoring is strictly better than the ones we have for vendored C based projects in the kernel.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891901/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor891417"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 6:41 UTC (Fri)
                               by <b>qyliss</b> (subscriber, #131684)
                              [<a href="/Articles/891417/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It&#x27;s not a solution to any of the broader points being discussed, but I recommend <a href="https://lib.rs/">https://lib.rs/</a>, an alternative frontend to crates.io, which does not require JavaScript (and also has a much nicer interface).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891417/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891686"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 18, 2022 3:40 UTC (Mon)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/891686/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>Bear in mind that crates.io, the package index, and crates.io, the web-based browser frontend for it, are separate systems.</p>

<p>Think of it like GitHub or GitLab or BitBucket or <a rel="nofollow" href="https://gitea.io/">Gitea</a>. When using <code>git</code> with one of those sites or <code>cargo</code> with crates.io, you only need to enable JavaScript if you want to publish to the site and, once you've set things up and retrieved your API key(s), you don't need to log in.</p>

<p>Heck, comparing <code>cargo</code> to <code>git</code> is an understatement. With subcommands like <code>search</code>, <code>publish</code>, and <code>owner</code>, it's more like <a rel="nofollow" href="https://hub.github.com/">hub</a>. (A wrapper for <code>git</code> which adds subcommands like <code>git issue create</code> for GitHub-proprietary APIs so you probably <i>never</i> need to use the web UI once you've set up your credentials.)</p>

<p>Beyond that, they do have plans to enable server-side rendering for the browser frontend... it's just that the team who handle the frontend is a bit understaffed so it's taking a while to rework it.</p>


















      
          <div class="CommentReplyButton">
            <form action="/Articles/891686/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor891423"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 8:23 UTC (Fri)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/891423/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &quot;vendoring&quot; unmodified upstream</font><br>
<p>
Problem: everyone knows &quot;copy/paste/diverge&quot; sounds bad.<br>
<p>
Solution: keep inventing new synonyms to disguise it. Like when $BIGCORP changes name after some scandal.<br>
<p>
The real solution is of course some form of branching / forking == copy/paste under (version) control. Probably what the author of a git tool written in rust had in mind :-)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891423/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891471"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 16:14 UTC (Fri)
                               by <b>pj</b> (subscriber, #4506)
                              [<a href="/Articles/891471/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think it&#x27;s pretty common these days to &#x27;vendor&#x27; code via git submodules, which seems to be what you&#x27;re advocating for.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891471/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891475"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 17:35 UTC (Fri)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/891475/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
&quot;git submodule&quot; doesn&#x27;t vendor anything. The code is still pulled from a remote repository, it&#x27;s just pinned to a specific version. Which is exactly what you want to avoid spurious external changes that introduce more-or-less-subtle security problems.<br>
<p>
&quot;Real&quot; vendoring, aka copy/paste/ignore, disconnects the copy entirely from its source. (Thanks but no thanks.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891475/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891501"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 7:08 UTC (Sat)
                               by <b>riking</b> (subscriber, #95706)
                              [<a href="/Articles/891501/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The &#x27;cargo vendor&#x27; subcommand does copy-paste-track by saving the copied version to the Cargo.lock file.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891501/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor891470"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 17:12 UTC (Fri)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/891470/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What we do is we have a separate git history for the import that is subset from upstream (remove test suites, test data, docs, sources we don&#x27;t care about, etc.) and commit that on the respective tracking branch. One can even transform the import to do things like sqlite&#x27;s amalgamate to make a smaller set of sources. This then gets `-Xsubtree` merged into the main tree and is checked that:<br>
<p>
- changes to this directory only come from such a merge<br>
- the merge came from the &quot;right&quot; branch (tracked by its root commit)<br>
- the merge did not modify the subtree in the merge commit (yay)<br>
<p>
We also check that *all* such changes come in through this mechanism and we track our patches in a fork of upstream that we tag for each import for posterity.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891470/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor891506"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 8:21 UTC (Sat)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891506/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is more like a constraint set by the kernel process rather than an opinion :-) It&#x27;s in some ways analogous to OOT modules (&quot;sort of&quot; same different). We cannot import unreviewed code to the kernel. It&#x27;s a brickwall.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891506/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor891467"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 15:01 UTC (Fri)
                               by <b>cesarb</b> (subscriber, #6266)
                              [<a href="/Articles/891467/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Should we copy the crate into the kernel tree to be independent of crates.io?</font><br>
<p>
As mentioned in a comment above, there&#x27;s precedent with things like zstd, which is also fully copied into the kernel tree instead of being kept as an external package. So I&#x27;d expect every crate included in the kernel, with the exception of the ones which come with the compiler (i.e. the &quot;core&quot; crate), to be vendored directly into the kernel tree.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891467/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891548"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 9:39 UTC (Sat)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891548/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think this whole thing is in the scope of kernel maintainers to decide because they have to take the responsibility of using external crates. You can have an opinion but unless you are one who that has to deal with its consequences, it unfortunately does not count that much at all.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891548/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891578"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 14:55 UTC (Sat)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891578/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As long as pulling them does not require Internet connection :-) One must be able to build kernel without downloading external code. Importing in some cases is of course considerable but that must be done case by case.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891578/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor891541"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 9:33 UTC (Sat)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891541/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Linux is used also a wide range of other targets than just microcontrollers. How can you deduce that a external component does not break *any* of the uses? How can you take responsibility to as a kernel maintainer to take responsibility of the code that lives outside the kernel tree, which you do not have any control?<br>
<p>
Finally: how are you expected to fix a kernel bug if the bug is caused by an external component?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891541/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891567"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 12:10 UTC (Sat)
                               by <b>excors</b> (subscriber, #95769)
                              [<a href="/Articles/891567/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Linux doesn&#x27;t really run on microcontrollers at all - the point is that the technical constraints for kernel software on a regular desktop CPU are very similar to the constraints for application software on a microcontroller, in contrast to the very different constraints for application software on desktop CPUs. (E.g. they can&#x27;t crash and expect an OS to clean up after them, so they need to think more carefully about handling heap allocation failures, and/or avoid using the heap entirely. They typically have small stacks, so they need to avoid large stack allocations or recursion. They need to handle interrupts, which are a peculiar kind of concurrency where you can&#x27;t use normal mutexes. There&#x27;s no pthreads. They often can&#x27;t use an FPU. Code size is important. Etc.)<br>
<p>
So there&#x27;s a good chance that libraries designed for microcontroller applications will be technically suitable for the Linux kernel. Of course they&#x27;d still need to be code-reviewed and maybe adapted slightly for the specific environment they&#x27;re being used in, and there&#x27;s social questions about who will maintain the code and what their priorities are, but the same applies to new code that&#x27;s written exclusively for Linux. Starting from an existing well-designed well-tested library should achieve the same quality with less work than starting from scratch.<br>
<p>
Rust&#x27;s no_std doesn&#x27;t mean a library is necessarily suitable for microcontrollers/kernels, but it does mean it avoids some common features that would make it definitely unsuitable, so it seems a good way to filter libraries before reviewing them in more depth.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891567/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891581"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 14:59 UTC (Sat)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891581/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Off-topic: to cut hairs it does. μClinux was previously a fork but was integrated to the mainline already for 2.6 kernel.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891581/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor891379"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 20:09 UTC (Thu)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/891379/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One (IMO) major problem with letting each kernel module choose to fetch random crates from crates.io is that it will result in multiple incompatible versions of the same crate being built into the kernel.<br>
<p>
E.g. the module wants foo-1.0 and a dependency of the module wants foo-2.0. And another module requires foo-3.0. Therefore, three versions are included.<br>
<p>
The kernel as a whole must agree on which crate versions to use.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891379/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891389"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 22:23 UTC (Thu)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/891389/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
To an extent you&#x27;ll see that happen anyway when Rust-based modules are compiled separately from the kernel. Rust code compiled for the kernel will be specialized based on how it&#x27;s used in the kernel, and the same Rust code compiled for a loadable module will be specialized for the module. In Rust that can even affect things like structure layout, unless the structure has been declared #[repr(C)].<br>
<p>
In general this isn&#x27;t a problem so long as you don&#x27;t try to cross kernel/module boundaries through the (unstable) Rust ABI. The module should expose C entry points and only share #[repr(C)] data with outside code—even other code written in Rust. Even if a module happens to pull in a different version of some dependency than the kernel, the dependency will be constrained to that module and will not affect the rest of the system.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891389/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891482"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 19:36 UTC (Fri)
                               by <b>bartoc</b> (guest, #124262)
                              [<a href="/Articles/891482/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You actually don&#x27;t have to agree on what version to use, since the build system makes sure that you see the definitions you were expecting and everything is mangled such that you can&#x27;t screw it up. <br>
<p>
It is not good to have multiple versions of stuff for other reasons, like code auditing, and code size, and compile time<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891482/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor891385"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 21:49 UTC (Thu)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/891385/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don&#x27;t foresee people whose mascot is a penguin having too much trouble welcoming people whose mascot is a crab.<br>
<p>
As a C programmer I will say that Rust&#x27;s standard library (not all of which, admittedly, the kernel gets, see other comments about the stack of core -&gt; alloc -&gt; std of which the kernel will receive core and a somewhat custom alloc) has much more than I was used to from the C standard library and in many cases also utility libraries like Glib.<br>
<p>
Programs where in C I&#x27;d have reached for some third party utility libraries at least, often in Rust the standard library is more than enough. Yet it&#x27;s still a very hospitable place to do the sort of low-level programming Linux is all about. For example, Rust explicitly has a char type which reflects Unicode scalar values, but it pragmatically offers predicates like is_ascii_hexdigit() both on the char type and on u8 (the unsigned byte). If you actually have bytes (say from a character device), and the only thing you care about is whether those bytes are ASCII hex digits, with no interest in whether they might be part of an Emoji or a Korean word, or anything fancy like that, then Rust doesn&#x27;t waste your time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891385/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891500"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 6:45 UTC (Sat)
                               by <b>bartoc</b> (guest, #124262)
                              [<a href="/Articles/891500/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It&#x27;s pretty embarrassing that C doesn&#x27;t have is_ascii_digit and friends tbh.<br>
<p>
Someone should write a paper, I bet it could get accepted.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891500/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891587"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 16:31 UTC (Sat)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/891587/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Arguably Rust got lucky here. In the 1990s locale APIs were all the rage, and perhaps a new Rust language would have adopted locale-sensitive APIs for all this stuff as C did. After all C is also a low-level bit-banging type language, and yet nevertheless isdigit() insists on being locale sensitive.<br>
<p>
By the early 21st century, there was more of a note of caution. An API which tells you whether this code is arguably a digit of some sort in the character encoding somebody (mis)configured on your server is rarely what you needed, while an API which says ASCII 0 through 9 are digits only is often useful. If you&#x27;d given away the latter in order to offer the former you looked a bit daft. Today, Rust offers only two things here, is this an ASCII digit, or (exclusively on its char type which represents Unicode&#x27;s &quot;scalar values&quot; only) is this in Unicode&#x27;s digit class? Got EUC-JP? Big-5? Too bad, decode them into Unicode and use our Unicode APIs.<br>
<p>
If you&#x27;d done that in 1995 there&#x27;d be howls of outrage at what seems to be cultural imperialism at work, today not so much.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891587/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891596"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 19:22 UTC (Sat)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/891596/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; If you&#x27;d done that in 1995 there&#x27;d be howls of outrage at what seems to be cultural imperialism at work, today not so much.</font><br>
<p>
I think this was because in 1995, surrogate pairs didn&#x27;t yet exist and everybody still thought of &quot;Unicode&quot; as a 16-bit encoding, which is completely inadequate for encoding all of CJK (without considering the fact that you also want to have enough room left over for all of the other writing systems in the world). But even in 1996, when they did theoretically have the code space for all of CJK, they hadn&#x27;t done Extension A yet, let alone all of the subsequent CJK extensions, so a whole heck of a lot of characters were not actually encoded.* And then you have the Han unification controversy etc., so it&#x27;s really not too surprising that people in the 1990&#x27;s were not sure that Unicode was going to work out as well as it did.<br>
<p>
* In 1989, the Consortium took the position that these characters were not &quot;useful&quot; enough for this to be a real problem in practice, which is how they managed to conclude that 16 bits would be enough in the first place. Unsurprisingly, if you tell a user &quot;you can&#x27;t enter your name because it uses an obscure character,&quot; people get upset.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891596/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891622"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 10:23 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/891622/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <p>I wonder what would have happened in the alternate history where IBM-360 wouldn't impose 8bit byte and people would continue with 36bit words. In such a world we may still be using 36bit systems (very few devices even today need more than 64GiB RAM) and Unicode would be simple 18bit encoding, etc.</p>

<p>But of course by now 8bit byte is too entrenched to do such a switch.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/891622/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891756"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 2:01 UTC (Tue)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/891756/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; very few devices even today need more than 64GiB RAM</font><br>
<p>
Eh, it depends what you use it for. If you have a bunch of dedicated machines running something like memcached, you probably do want to shove an unusually large amount of RAM into them. The same goes for NAS systems or anything else that has a lot of RAM pressure. I&#x27;m not sure if you&#x27;d actually hit 64 GiB per device - that probably depends on other factors like the size and shape of your traffic, the number and speed of CPU cores, etc., but OTOH there are RAM-heavy systems that are difficult to horizontally scale (e.g. traditional RDBMS&#x27;s), so I could imagine scenarios where you might end up deploying such a thing, at least as a stopgap until you figure out how to do replication without having glaring consistency problems all over the place.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891756/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891764"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 6:34 UTC (Tue)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/891764/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I feel like Unicode could easily fit all the current semantics into 16 bits of codepoints with lots of room to space, if it were redone today as RISC (consistent use of combining sequences) instead of CISC (e.g. the entire precomposed CJK glyphs area, all the latin-with-extra-squiggles codeplanes).<br>
<p>
Still wouldn&#x27;t be anywhere near simple to use, but that&#x27;s how written communication is.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891764/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891820"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 11:06 UTC (Tue)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/891820/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Unfortunately, it&#x27;s not as simple as it sounds.<br>
<p>
Wikipedia&#x27;s commentary on Han Ideographs (Chinese, Japanese Kanji, Korean Hanja, etc.) being only offered precomposed is &quot;However, attempts to do this for character encoding have stumbled over the fact that Chinese characters do not decompose as simply or as regularly as Hangul does.&quot;<br>
<p>
...and I remember reading that the precomposed Latin stuff is necessary to guarantee that text strings used as opaque lookup keys (eg. filesystem paths) wouldn&#x27;t get altered when round-tripping between a legacy encoding and Unicode, regardless of the circumstances.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891820/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891944"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 20, 2022 1:16 UTC (Wed)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/891944/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I can accept that first point, but regarding latin I believe macOS munges every filename through NFD, so it&#x27;s already a lost cause.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891944/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891949"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 20, 2022 3:42 UTC (Wed)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/891949/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>That's fine. Programs are supposed to assume that the filesystem may change under them. That's the cost of a shared resource which doesn't use Microsoft Visual SourceSafe-style locking overkill.</p>

<p>What's important is that, if the OS APIs give you a string identifier, your internal string processing can round-trip what you were given without altering it.</p>

<p>For comparison, I imagine that using the Windows version of Python's <code>os.path.normcase</code> for purposes other than in-process equality comparisons would cause i18n issues since it uses Python's internal <code>.lower()</code> method and thus the Unicode case-conversion tables baked into that version of Python while NTFS lookups use a case-folding table baked into the NTFS partition at the time it was formatted to ensure that Unicode updates can't introduce case-equivalence collisions for already-existing paths.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/891949/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor892344"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 22, 2022 10:24 UTC (Fri)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/892344/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Assuming that there even is a legacy encoding that has composing codepoints *and* the corresponding composed characters.<br>
<p>
And even if there is, you could mark the offenders, e.g. by placing a combining grapheme joiner U+034F between them.<br>
<p>
IMHO the real reason is that, at the time, font rendering engines were not clever enough to show alternate glyphs for composed characters whose naïve supposition of their constituent parts simply doesn&#x27;t work. (As in, all accented/umlauted/whatever&#x27;d capital letters.)<br>
<p>
That, or the precedence of Latin-1 with its mountain of composed characters proved too strong and nobody even thought about solving the problem some other way until it was too late.<br>
<p>
That, or the problem was deemed unfixable because instead of expanding Han-encoded texts by 50% (three-byte UTF-8 instead of two-byte words) you&#x27;d blow them up by &gt;250% (two bytes for radical A, two for radical B, at least one for either marking the end of a glyph or a joiner; more if there&#x27;s a radical C involved) which would not have been acceptable at the time. After all, at the time Weird Al chastised Microsoft that &quot;in case you haven&#x27;t noticed, four-gig drives don&#x27;t grow on trees&quot;.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/892344/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor892373"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 22, 2022 13:48 UTC (Fri)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/892373/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p><font class="QuotedText">&gt; That, or the precedence of Latin-1 with its mountain of composed characters proved too strong and nobody even thought about solving the problem some other way until it was too late.</font></p>

<p>It's not even about the “precedence of Latin-1”. It's about the simple practical need to keep parts of your data in Unicode and parts in some other encoding with constant conversions between these.</p>

<p>It took years (about 10 to 20 years, in fact) before people, finally, stopped using legacy encodings.</p>

<p>If Unicode would have been impossible (or very hard and inefficient) to use in that fashion then it would have never taken off.</p>

<p>Size considerations were also quite real: Japan persisted for years with <a href="https://en.wikipedia.org/wiki/ISO/IEC_2022#ISO-2022-JP">ISO-2022-JP</a> both because roundtrip there is not perfect and also because it made documents 50% larger.</p>

<p>The only big issue with Unicode was initial assumption that 16-bit would be enough, after all: that prompted thus useless and <b>very</b> costly trip to USC-2 then UTF-16 and then, finally, to UTF-8.</p>

<p>USC-2 made sense but UTF-16 has all the problems of UTF-8 without giving you any benefits.</p>

<p>If people realized earlier that USC-2 wouldn't work then all that hoopla with two kinds of functions in Java, endless bugs with UTF-16 in browsers and other such things could have been avoided.</p>

<p>But oh, well, we can't change the path, can only adopt UTF-8 for the future.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/892373/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor891911"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 19:40 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/891911/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There are more than 100000 unique Han characters. They can usually be decomposed into simpler characters (radical + phonetic), but even with that simplification it&#x27;s going to get uncomfortably close to 2^16 code points.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891911/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor891664"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 21:19 UTC (Sun)
                               by <b>bartoc</b> (guest, #124262)
                              [<a href="/Articles/891664/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
well, the real issue is that getting a feature into C is quite involved, and I can understand nobody wanting to go through all the trouble (including possible travel with airfare and hotel costs and so on) just to standardize a one line function. <br>
<p>
the real problem with locales (besides them not really working with variable width encodings, and being based on code units) is that programmers do NOT expect the behavior of many if these functions to change out from under them (printf is locale sensitive!). This is not just beginner users either! When the C++ committee standardized formatting (via std::format) for dates and times they accidentally made it local sensitive by basically saying “interpret the format string as strftime would”, whoops. (the std::format model is locale invariant by default with special specifiers to do locale things, and the ability to pass in a locale object if you wanna use that instead of the global one)<br>
<p>
C locales are so totally insufficient for actual internationalization that having everything be locale sensitive basically only results in non-user-facing stuff being mangled. I hope you like your log analytics misclassifying output from all your machines in countries with a different date order than your developers! Its totally insane. <br>
<p>
Even if they were useful for localization the actual specification is essentially “do whatever you want, unless its the C locale”, its really, really bad. And in practice implementers do just phone in locales because they aren&#x27;t really useful for anything anyway. They should be deprecated and removed (or “removed” by specifying that all locales are equivalent to the C locale)<br>
<p>
Then theres the multiple attempts at standard C encoding conversion routines, all of which are broken. <br>
<p>
Even if you stick to Unicode you can get into trouble with cursed/unexpected unicode translation formats, GB18030 is the worst (and the only really bad one in somewhat common usage)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891664/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891869"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 15:21 UTC (Tue)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/891869/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
We&#x27;re diverting pretty far from the original topic, but as to it being difficult to get features in C, there isn&#x27;t any actual requirement.<br>
<p>
Consider the BSD sockets API. Why is that commonplace? Did some JTC1 sub-committee sign off on it and then all our operating systems got the same API? No, it&#x27;s just the right shape and so everybody adopted it and any &quot;standards&quot; are subsequent and simply documenting what was de facto already the case about networking.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891869/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor893132"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 29, 2022 15:02 UTC (Fri)
                               by <b>peter-b</b> (subscriber, #66996)
                              [<a href="/Articles/893132/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It&#x27;s pretty embarrassing that C doesn&#x27;t have is_ascii_digit and friends tbh.</font><br>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt; Someone should write a paper, I bet it could get accepted.</font><br>
<p>
I will be submitting exactly such a proposal for std::ascii_isdigit() etc. for the C++ standard library.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/893132/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor891391"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 22:32 UTC (Thu)
                               by <b>NHO</b> (guest, #104320)
                              [<a href="/Articles/891391/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As a Gentoo user, I build kernel sometimes and customize the configuration to my hardware.<br>
<p>
Sometimes, I make a mistake and end up with no network. If I can&#x27;t rebuild my system in that situation, because kernel needs network for build, then that?<br>
There is a local mirror of Gentoo repo, source included, in Russia. But our internet censorship organization could get some garbage in their heads because some ancient judge from Nowhere, Ural mountains added crates.io to the list of sites to be blocked.<br>
Debian prevents network access when building packages, no?<br>
<p>
What I&#x27;m saying is that any solution that breaks kernel build in airgapped sandbox is bad.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891391/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891395"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 22:55 UTC (Thu)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/891395/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I remember them saying they had no plans to use Cargo for the build system but, if they decide to use it for dependency handling, I imagine they'd use <code>cargo vendor</code> to automate what they already do with C libraries they use.

<p>(i.e. Keep a copy in the kernel repository and manually pull in updates from upstream every now and then.)</p>

<blockquote><p>This cargo subcommand will vendor all crates.io and git dependencies for a project into the specified directory at <code>&lt;path&gt;</code>. After this command completes the vendor directory specified by <code>&lt;path&gt;</code> will contain all remote sources from dependencies specified. Additional manifests beyond the default one can be specified with the <code>-s</code> option.</p>

<p>The <code>cargo vendor</code> command will also print out the configuration necessary to use the vendored sources, which you will need to add to <code>.cargo/config.toml</code></p></blockquote>






      
          <div class="CommentReplyButton">
            <form action="/Articles/891395/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891396"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 14, 2022 23:13 UTC (Thu)
                               by <b>gerdesj</b> (subscriber, #5446)
                              [<a href="/Articles/891396/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;ve run Gentoo on 10s of systems for well over over a decade.  There are plenty of other, far more straightforward, ways to break a Gentoo box!  For starters, emerge will pull down the dependencies and build them first and work up the chain to the final result.  Unless you go mad with eclean, you&#x27;ll have all the bits on site.<br>
<p>
I do understand where you are coming from though.  It all sounds a bit ... devops.  Before you know it we&#x27;ll be piping curled configs through configure/make.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891396/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor891410"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 5:19 UTC (Fri)
                               by <b>q_q_p_p</b> (guest, #131113)
                              [<a href="/Articles/891410/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If they want kernel in rust, they should write kernel in rust like google does with fuchsia. <br>
Rust is such a cancer... attaching to popular projects and destroying them - why don&#x27;t they do this with llvm, huh ? because they would have to deal with at least dependency hell, proper compiler boostrapping procedure, etc.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891410/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891413"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 5:45 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/891413/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; If they want kernel in rust, they should write kernel in rust like google does with fuchsia. </font><br>
<p>
Fuchsia is written mainly in C++.<br>
<p>
<font class="QuotedText">&gt; Rust is such a cancer... attaching to popular projects and destroying them - why don&#x27;t they do this with llvm, huh ? because they would have to deal with at least dependency hell, proper compiler boostrapping procedure, etc.</font><br>
<p>
Cargolift.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891413/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891414"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 5:47 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/891414/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sorry, Cranelift: <a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift">https://github.com/bytecodealliance/wasmtime/tree/main/cr...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891414/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891416"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 6:41 UTC (Fri)
                               by <b>q_q_p_p</b> (guest, #131113)
                              [<a href="/Articles/891416/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
LLVM: <a href="https://github.com/llvm/llvm-project">https://github.com/llvm/llvm-project</a> <br>
I can use the same argument about the kernel, just use redox (cranelift) if you don&#x27;t like C: <a href="https://gitlab.redox-os.org/redox-os/redox">https://gitlab.redox-os.org/redox-os/redox</a> and leave kernel(LLVM) alone ?<br>
<p>
I was wrong about fuchsia though...<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891416/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891418"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 6:44 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/891418/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The decision to use Rust will be done by actual Linux developers.<br>
<p>
And nobody is forcing you to use the mainline Linux. If you so dislike Rust, then you are totally free to fork Linux and maintain your own Rust-less fork.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891418/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor891433"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 10:04 UTC (Fri)
                               by <b>mpr22</b> (subscriber, #60784)
                              [<a href="/Articles/891433/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; attaching to popular projects and destroying them</font><br>
<p>
This is the kind of claim that needs hard citations to be anything other than a content-free &quot;look at me see how much I hate Rust&quot; signal flag.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891433/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891432"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 11:30 UTC (Fri)
                               by <b>fazalmajid</b> (guest, #158016)
                              [<a href="/Articles/891432/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Totally agree. The Rust project’s cavalier attitude to language and compiler stability, the absurd compiler bootstrapping and limited platform support makes it throughly unsuitable for the Linux kernel., and that’s also why I won’t touch it despite the many benefits. Not to mention their belief that “curl something}bash” is acceptable practice.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891432/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891454"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 12:51 UTC (Fri)
                               by <b>mpr22</b> (subscriber, #60784)
                              [<a href="/Articles/891454/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The Rust project’s cavalier attitude to language and compiler stability</font><br>
<p>
I&#x27;m curious: What&#x27;s &quot;cavalier&quot; about their attitude to language and compiler stability at this time?<br>
<p>
For this question, I&#x27;m only interested in claims backed by concrete examples, relating to officially designated stable features of the compiler and language, postdating version 1.0 of the toolchain.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891454/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891476"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 18:14 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/891476/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Oh yeah, the system in which things are tested under nightly feature guards, getting stabilized and available to ordinary code only when ready, and only then broken if unsound or after an edition change (and the old versions continue to work under older editions), and the way that feature additions are validated against all of crates.io to make sure they don&#x27;t break things before going in... it&#x27;s just so totally cavalier! Nothing like the elegant and refined C world, where, say, the introduction into POSIX of getline() and its consequent promotion into the _POSIX_C_SOURCE glibc feature flag (formerly it was only visible under _GNU_SOURCE) could not possibly break dozens of unrelated packages that just happened to use that as an identifier with no way to fix it other than to change all of them.<br>
<p>
(That&#x27;s not to say Rust can&#x27;t improve. My personal if-wishes-were-unicorns perfect-world wish: if Rust grew the same amazing system Swift has to allow generic types with a stable ABI without heaps of monomorphization code bloat, that would be fabulous. It is an incredibly intricate system though, so I can see why it hasn&#x27;t happened, at least not yet: it certainly can&#x27;t be used unchanged but would need some redesign, and I&#x27;m not even sure this is possible. I know others have mused about this before, because Rust&#x27;s lack of a nice way to do the shared library stable-ABI thing is probably its biggest remaining downside compared to other, lesser languages like C. C++, of course, has the exact same flaw, but unlike Rust it&#x27;s much harder to apply the same cunning Swift tricks to it.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891476/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891478"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 19:05 UTC (Fri)
                               by <b>LoganDark</b> (guest, #158019)
                              [<a href="/Articles/891478/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
At least C++ has the benefit of &quot;well USUALLY if you use the same C++ compiler it&#x27;s compatible with pretty much all C++ libraries compiled by that compiler&quot;. Sometimes it&#x27;s even compatible with other compilers. With Rust it&#x27;s &quot;the ABI is 100% undefined and changes basically every commit, you can&#x27;t use generic types at all because they&#x27;re not present at all in the library&quot;, etc.<br>
<p>
At least Rust has the ability to declare C functions.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891478/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891490"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 22:06 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/891490/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I see you&#x27;ve never used binary-only C++ libs. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891490/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891667"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 21:56 UTC (Sun)
                               by <b>bartoc</b> (guest, #124262)
                              [<a href="/Articles/891667/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That Usually is because of monumental sacrifices in implementation quality (I am a C++ standard library maintainer). A regex that is slower than spinning up a java vm, doing the regex, and then shutting it down. A hash table that is 2x slower than it should be. An insane work stealing thread implementation that just exists to get around big kernel locks that were removed 20 years ago. A mutex that is huge and deadlocks under resource starvation. A buffered IO stream that buffers like 16 characters. A deque (linked list of buckets) with a bucket size optimized for caches from 1995. A span type that is always passed on the stack because we forgot to add the attribute to say we want the sane ABI, the one we cant make the default because that would break ABI. The only data structures that are pretty OK are the vector and the r-b tree. The lists are not horrible either, but “generic” linked lists are not terrifically useful things. <br>
<p>
The ability to provide a stable ABI is great, but C++ has gotten into a position where the first “real” release of your library has a stable ABI and boy is that not a good thing.<br>
<p>
Even with all the care that we take not to break abi we still break it accidentally in subtle ways from time-to-time, as do other implementations. The way C++ libraries are designed and the way the standard library in particular is specified are at complete odds with the ability to make any kind of future changes without breaking ABI. You can do such libraries, but they look like Qt, POCO, or a COM library rather than your typical boost/standard library. <br>
<p>
Swift gets this very much right. I wish it integrated with a jit of some kind to allow slowly migrating to the “unstable abi” versions of stuff though (and switching back when the dependency changes)<br>
<p>
Fun tidbit: I recall that for Windows Phone 7 apps were distributed as bytecode in the compiler’s intermediate format and compiled to a final executable on the phone during installation. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891667/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor891623"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 10:35 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/891623/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; If Rust grew the same amazing system Swift has to allow generic types with a stable ABI without heaps of monomorphization code bloat, that would be fabulous</font>

<p>It's not just Swift. Ada uses similar system, too. And it supported it for much, <b>much</b>, <b>MUCH</b> longer.</p>

<font class="QuotedText">&gt; it certainly can't be used unchanged but would need some redesign, and I'm not even sure this is possible</font>

<p>Rust-the-language is certainly strict enough to support it. Rustc-the-compiler… nope.</p>

<p>This would be a multi-year effort and someone has to fund it. But it's definitely possible and I really wish someone would fund it.</p>

<p>Sadly Google is not one who needs or wants such a thing (they use static linking, mostly), Apple already has Swift… who can fund it, I wonder? Maybe Microsoft?</p>

<p>But yeah, it would be a nice and elegant solution for the stable ABI. Rust developers are <a href="https://smallcultfollowing.com/babysteps//blog/2022/03/29/dyn-can-we-make-dyn-sized/">thinking</a> about small, very limited subset, but I really wish someone would fund development of real, polymorphic traits instead.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/891623/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891803"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 10:40 UTC (Tue)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/891803/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>Amazon are the other entity that might choose to fund it - they're getting heavily into Rust as a language for AWS, and having a stable ABI for a Rust AWS Lambda runtime would be a neat thing.


      
          <div class="CommentReplyButton">
            <form action="/Articles/891803/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor892487"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 25, 2022 5:34 UTC (Mon)
                               by <b>ras</b> (subscriber, #33059)
                              [<a href="/Articles/892487/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; cunning Swift tricks</font><br>
<p>
Is there anywhere I can read about what these cunning Swift for generic are?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/892487/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor892505"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 25, 2022 10:54 UTC (Mon)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/892505/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There was an article that seemed to be by one of the devs that I had read, but I can&#x27;t find it anymore (Firefox seems to expire history now…). Here&#x27;s one I found that describes it; it may have a link to the &quot;original&quot; I&#x27;m thinking of.<br>
<p>
<a href="https://gankra.github.io/blah/swift-abi/">https://gankra.github.io/blah/swift-abi/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/892505/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor892612"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 25, 2022 22:00 UTC (Mon)
                               by <b>ras</b> (subscriber, #33059)
                              [<a href="/Articles/892612/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That was a good read.<br>
<p>
Nothing particularly remarkable in how it&#x27;s done.  Generous use of vtables, thunks converting parameters by coping them, putting the return value on the heap.  (I wonder if they considered a separate return value stack?)  Thunks in vtables is novel - I haven&#x27;t seen that before<br>
<p>
But mostly it&#x27;s stuff we&#x27;ve all done manually at some point.  Android&#x27;s compatibility libraries are the same thing done manually, on steroids.  Is the major difference is seems to be Swift does it by default, making it automagic it with some nice tooling?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/892612/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor892687"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 26, 2022 13:03 UTC (Tue)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/892687/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Exactly. Because it&#x27;s automatic it&#x27;s everywhere. If it&#x27;s only done manually you end up with only a few foundational libraries with stable ABIs, and an ecosystem that more or less doesn&#x27;t use shared libs at all. If it&#x27;s automatic you get pervasive sharing.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/892687/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor892686"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 26, 2022 13:01 UTC (Tue)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/892686/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That&#x27;s the one I was thinking of too but for some reason couldn&#x27;t find anywhere in my browser history. Thanks!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/892686/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor891419"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 6:47 UTC (Fri)
                               by <b>qyliss</b> (subscriber, #131684)
                              [<a href="/Articles/891419/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;d expect one of the big problems here to be the build system.  Right now, Rust for Linux integrates Rust into the kernel build system, rather than using Cargo.  I think the attraction of using lots of third-party crates would quickly fade if developers had to write Makefiles for any dependency they wanted to add (very few Rust libraries build without a build.rs file doing something fancy somewhere in their dependency graph), but Cargo really does not like co-operating with other build systems.  This has made life difficult for any sort of generic build or meta-build system to add Rust support — Meson, gn, Soong, Bazel, Nix, etc.<br>
<p>
It comes up over and over when big established projects try to adopt Rust, but no progress has been made on it yet as far as I&#x27;m aware.  I think it would require some very fundamental changes to how Cargo works.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891419/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891437"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 11:46 UTC (Fri)
                               by <b>LoganDark</b> (guest, #158019)
                              [<a href="/Articles/891437/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If this were my project (and maybe 0.1% the size), I&#x27;d migrate the rest of the existing codebase to use Cargo and Rust build scripts, rather than the other way around (trying to get Cargo to fit into makefiles/something else), since other parts of the kernel are probably going to eventually be rewritten in Rust as well.<br>
<p>
That doesn&#x27;t exactly sound feasible here, but it&#x27;s a nice thought. imho, it would be an almost-all-around win for Cargo to become more interoperable with existing build systems, but it could also encourage laziness or tricky setups.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891437/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891502"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 7:16 UTC (Sat)
                               by <b>pkolloch</b> (subscriber, #21709)
                              [<a href="/Articles/891502/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      One thing that would helped me immensely:

Have a cargo sub command that builds a crate in isolation. With a command line option for the directory of the output artifacts. And being able to specify all the dependency outputs as input. 


      
          <div class="CommentReplyButton">
            <form action="/Articles/891502/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891508"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 8:35 UTC (Sat)
                               by <b>atnot</b> (subscriber, #124910)
                              [<a href="/Articles/891508/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What would that provide over just using rustc directly?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891508/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891589"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 17:45 UTC (Sat)
                               by <b>pkolloch</b> (subscriber, #21709)
                              [<a href="/Articles/891589/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p> There is a lot of plumbing that cargo does:

<ul>
<li> setting env variables
<li> running build scripts
<li> setting features
<li> setting something like a symbol prefix to avoid clashes
<li> linker flags
<li>... and a lot of other details
</ul>

<p>It's surprisingly hard to replicate. I know because I helped doing it for nix with contributions to buildRustCrate in nixpkgs and creating crate2nix. 



      
          <div class="CommentReplyButton">
            <form action="/Articles/891589/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor891421"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 7:31 UTC (Fri)
                               by <b>tlamp</b> (subscriber, #108540)
                              [<a href="/Articles/891421/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &quot;Async Rust&quot; knows nothing about kernel threads or how context switching is done in the kernel, for example.</font><br>
<p>
Hmm, but it doesn&#x27;t know that stuff for the user space either. Async is basically sugaring to wrap handling a pinned future type, each runtime, and future type (with a poll funciton, and a pending and ready state), can map that to their actual, underlying execution model of choice. I mean, that&#x27;s why the Rust ecosystem can have multiple async runtime libaries like tokio, async-std or smol. <br>
<p>
https://rust-lang.github.io/async-book/02_execution/01_chapter.html<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891421/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891687"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 18, 2022 3:32 UTC (Mon)
                               by <b>Paf</b> (subscriber, #91811)
                              [<a href="/Articles/891687/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ok, but none of those implementations know anything about the kernel.  We’ll have to add one and if we don’t it won’t work - that’s the point being made.  Can’t generally bring in user space stuff without issues.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891687/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor891424"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 8:30 UTC (Fri)
                               by <b>seanyoung</b> (subscriber, #28711)
                              [<a href="/Articles/891424/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Jonathan Corbet, I must say I am disappointed with the reporting on rust. Rust is an entirely new language with many interesting properties, memory safety for example and just how expressive the language is.<br>
<p>
Instead we get an article which almost uniquely focusses on the ability to pull in external crates, which is always going to be controversial for a kernel.<br>
<p>
A lot of us kernel hackers will need to learn how to use rust in the kernel. How about something a bit more in-depth?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891424/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891426"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 8:35 UTC (Fri)
                               by <b>beagnach</b> (guest, #32987)
                              [<a href="/Articles/891426/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;   A lot of us kernel hackers will need to learn how to use rust in the kernel. How about something a bit more in-depth?</font><br>
<p>
Let me google that for you...<br>
<p>
<a href="https://www.google.com/search?q=site%3Alwn.net%20rust&amp;ie=utf-8&amp;oe=utf-8&amp;client=firefox-b-m">https://www.google.com/search?q=site%3Alwn.net%20rust&amp;...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891426/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891429"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 8:46 UTC (Fri)
                               by <b>seanyoung</b> (subscriber, #28711)
                              [<a href="/Articles/891429/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Nothing in depth to see there.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891429/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891457"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 13:29 UTC (Fri)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/891457/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<a href="https://lwn.net/Articles/869428/">https://lwn.net/Articles/869428/</a> might have something for you.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891457/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor891436"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 10:39 UTC (Fri)
                               by <b>Karellen</b> (subscriber, #67644)
                              [<a href="/Articles/891436/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Um, that&#x27;s the subject that the kernel mailing list threads he was reporting on were about? As in, that&#x27;s a subject that kernel developers are currently discussing, which is why it&#x27;s worth summarising now.<br>
<p>
What?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891436/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891439"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 12:02 UTC (Fri)
                               by <b>kay</b> (subscriber, #1362)
                              [<a href="/Articles/891439/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;m in contrast are completely happy with the lwn covering of rust. If I want to learn developing in Rust I wouldn&#x27;t expect lwn as place to go Ym2C<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891439/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891455"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 13:11 UTC (Fri)
                               by <b>xav</b> (guest, #18536)
                              [<a href="/Articles/891455/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Seconded; we see lots of Python technical articles but I don&#x27;t think there&#x27;s much chance to have some parts of the kernel written in it anytime soon ... it&#x27;d be nice to have at least some example of where Rust shines for kernel dev (some obvious ones: getting rid of void*, and getting rid of &quot;if (myptr != NULL)&quot;).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891455/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891474"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 16:47 UTC (Fri)
                               by <b>thoughtpolice</b> (subscriber, #87455)
                              [<a href="/Articles/891474/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That&#x27;s because it&#x27;s the topic of the mailing list discussion.<br>
<p>
You can quite literally find dozens of articles about using Rust for things like kernel/bare metal programming if that&#x27;s what you want. It&#x27;s actually so easy I&#x27;m not sure why you&#x27;re bothering to complain here. But regardless of complaints, it&#x27;s not what the topic of the discussion is about, though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891474/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891828"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 12:17 UTC (Tue)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/891828/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There is a lot of Rust learning material available, among many other good sources (in no particular order)<br>
<p>
<a href="https://www.rust-lang.org/learn">https://www.rust-lang.org/learn</a><br>
<p>
<a href="https://cheats.rs">https://cheats.rs</a><br>
<p>
<a href="https://github.com/ctjhoa/rust-learning">https://github.com/ctjhoa/rust-learning</a><br>
<p>
<a href="https://tourofrust.com/">https://tourofrust.com/</a><br>
<p>
https://this-week-in-rust.org/<br>
<p>
<a href="https://docs.rs/">https://docs.rs/</a><br>
<p>
<a href="https://dhghomon.github.io/easy_rust/">https://dhghomon.github.io/easy_rust/</a><br>
<p>
<a href="https://www.sheshbabu.com/posts/rust-module-system/">https://www.sheshbabu.com/posts/rust-module-system/</a><br>
<p>
<a href="https://github.com/rust-lang/rustlings">https://github.com/rust-lang/rustlings</a><br>
<p>
<a href="https://practice.rs/why-exercise.html">https://practice.rs/why-exercise.html</a><br>
<p>
<a href="https://forge.rust-lang.org/">https://forge.rust-lang.org/</a><br>
<p>
<a href="https://lborb.github.io/book/title-page.html">https://lborb.github.io/book/title-page.html</a><br>
<p>
<a href="https://fasterthanli.me/">https://fasterthanli.me/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891828/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor892093"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 21, 2022 2:23 UTC (Thu)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/892093/">Link</a>] 
      </p>
      
      </div>
      </summary>
      A couple of things listed in that second-last URL (The Little Book of Rust Books) that I'd like to call out as relevant:

<ul>
<li>I generally recommend <a rel="nofollow" href="https://rust-unofficial.github.io/too-many-lists/">Learning Rust With Entirely Too Many Linked Lists</a> as the next step after <a rel="nofollow" href="https://www.rust-lang.org/learn">https://www.rust-lang.org/learn</a> because it helps to solidify in your mind what ownership and borrowing actually mean for implementing data structures.</li>
<li><a rel="nofollow" href="http://cliffle.com/p/dangerust/">Learn Rust the Dangerous Way</a> is helpful for learning Rust from the perspective of a C programmer  by translating some C into equivalent but ugly and un-idiomatic Rust code that the compiler can't help much to verify and then cleaning it up.</li>
</ul>






      
          <div class="CommentReplyButton">
            <form action="/Articles/892093/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor891480"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 19:32 UTC (Fri)
                               by <b>bartoc</b> (guest, #124262)
                              [<a href="/Articles/891480/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
At the very least they probably don&#x27;t wanna allow multiple versions of packages, which is very common in rust projects (but people don&#x27;t realize it, because they are hidden behind an up-to-date dependency).<br>
<p>
Cargo doesn&#x27;t really like being the passenger in the build process, it likes to drive things itself, and that&#x27;s probably not gunna fly in the kernel either, which means they need to interact with the rust compiler itself, and that interface is not well documented.<br>
<p>
At a higher level I think this is the sort of thing that could cause rust to stabilize their ABI unintentionally, without the core rust developers having a choice in the matter. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891480/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891484"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 20:20 UTC (Fri)
                               by <b>shemminger</b> (subscriber, #5739)
                              [<a href="/Articles/891484/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Seems like getting a secure language with the insecurity of an external package system would be a bad tradeoff.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891484/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891491"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 15, 2022 23:14 UTC (Fri)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/891491/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Which is why Cargo provides multiple mechanisms for allowing projects to choose a balance that works for them. For example:

<ol>
<li>By default, it generates a lockfile that stores SHA256 hashes to ensure that an attempt to slip in an unapproved change will fail the fetch.</li>
<li>The <code>cargo vendor</code> command automates the process of vendoring your dependencies so you can have the benefits of a dependency manager without having to rely on an external source for the code.</li>
<li>Should you so choose, Cargo supports overriding package sources to map them to a mirror you control.</li>
</ol>

Ensuring security shouldn't be any more difficult than with an external C codebase like zstd that you periodically import into your repo.







      
          <div class="CommentReplyButton">
            <form action="/Articles/891491/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor891507"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 8:30 UTC (Sat)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891507/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The alloc crate in Rust does not seem to scale to kernel&#x27;s requirements at all. How do you handle OOM at the call site? How do you reach `kmem_cache_*`, when your needs are more specialized than `kmalloc()`?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891507/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891510"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 9:08 UTC (Sat)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/891510/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I haven't kept up on the details but, last I heard, the plan was to address that by providing their own fork/adaptation of <code>alloc</code> that breaks some APIs. The kernel's innards would be <code>no_std</code> anyway, so the main purpose in <em>not</em> breaking <code>alloc</code> APIs would be keeping things familiar for developers.



      
          <div class="CommentReplyButton">
            <form action="/Articles/891510/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891579"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 15:39 UTC (Sat)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/891579/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Here&#x27;s the (documentation for the) Rust for Linux alloc crate: https://rust-for-linux.github.io/docs/alloc/index.html<br>
<p>
As you will notice, in Rust for Linux the alloc crate&#x27;s APIs lack functions such as new() which are infallible, and instead only provide the fallible try_new() function, whereas in conventional Rust you can choose.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891579/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891592"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 17:46 UTC (Sat)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891592/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Fallible allocation is only a small portion of the problem.<br>
<p>
Also, what is required even for the drivers are access directly kmem_cache and gfp_t flags. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891592/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891631"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 11:35 UTC (Sun)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/891631/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If it&#x27;s &quot;required even for the drivers&quot; then presumably both the C and Rust drivers presented for comparison here:<br>
<p>
<a href="https://lwn.net/Articles/863459/">https://lwn.net/Articles/863459/</a><br>
<p>
... illustrate that ?<br>
<p>
Of course almost a year has passed since that was written, so Rust and Rust for Linux has made further improvements, but presumably you don&#x27;t mean that these things somehow became mandatory in the last 12 months.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891631/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor891563"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 10:43 UTC (Sat)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891563/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;ve added quite a few comments to this one but here&#x27;s one more: when is Rust compiler/language going to start retain full backwards compatibility between the so called editions?<br>
<p>
I don&#x27;t see future of Rust in kernel before this happens. In order to reach mainline Linux, Rust needs to have major changes to the more &quot;conservative&quot; side on how the language and compiler are developed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891563/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891564"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 11:04 UTC (Sat)
                               by <b>mpr22</b> (subscriber, #60784)
                              [<a href="/Articles/891564/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; when is Rust compiler/language going to start retain full backwards compatibility between the so called editions?</font><br>
<p>
Do you have a concrete example of a case where the compatibility rules documented in <a href="https://doc.rust-lang.org/edition-guide/editions/index.html">https://doc.rust-lang.org/edition-guide/editions/index.html</a> are being broken?<br>
<p>
If so, has someone filed a bug report, and what was the response?<br>
<p>
In the alternative, if you aren&#x27;t claiming those rules are being broken, but rather that those rules do not satisfy your demands, perhaps you could clarify what the deficiency is.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891564/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891571"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 14:19 UTC (Sat)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891571/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That&#x27;s trivial. It&#x27;s hard to orchestrate changes around the mainline kernel if a change to the language that is not backwards compatible. Direct quote:<br>
<p>
&quot;There are times, however, when it is useful to be able to make small changes to the language that are not backwards compatible.&quot;<br>
<p>
This is unacceptable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891571/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891584"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 16:06 UTC (Sat)
                               by <b>mpr22</b> (subscriber, #60784)
                              [<a href="/Articles/891584/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The paragraph following the one that contains the sentence you&#x27;re reacting to says:<br>
<p>
<font class="QuotedText">&gt; When we want to release a feature that would otherwise be backwards incompatible, we do so as part of a new Rust edition. Editions are opt-in, and so existing crates do not see these changes until they explicitly migrate over to the new edition. This means that even the latest version of Rust will still not treat async as a keyword, unless edition 2018 or later is chosen. This choice is made per crate as part of its Cargo.toml. New crates created by cargo new are always configured to use the latest stable edition.</font><br>
<p>
So if you write all your code in Rust 2018, and label it as being in Rust 2018, it should continue to be treated as Rust 2018 by the toolchain for as long as you keep it labelled as being in Rust 2018, and any failure by the toolchain to do so is a bug which should be reported post-haste.<br>
<p>
And then a bit further on:<br>
<p>
<font class="QuotedText">&gt; The most important rule for editions is that crates in one edition can interoperate seamlessly with crates compiled in other editions. This ensures that the decision to migrate to a newer edition is a &quot;private one&quot; that the crate can make without affecting others.</font><br>
<p>
So your code built as Rust 2018 can interoperate with crates that were built as Rust 2021 or Rust 2015 (Rust 2015 being the initial stable edition associated with v1.0 of the toolchain, and the edition your code is treated as if you do not explicitly specify an edition); in pursuit of this goal, they even created a &quot;raw identifiers&quot; mechanism when defining Rust 2018, to allow a crate which declared public interfaces using identifiers that were valid under Rust 2015 but have become keywords in Rust 2018 to continue to present those public interfaces under the same name.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891584/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891597"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 19:31 UTC (Sat)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891597/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I would like to see a clear explanation how the maintenance flow would work with stable and long-term kernels and all these editions. The oldest long-term still in maintenance was released in late 2016. This looks like initially a nightmare for backporting and bisecting stuff. I admit that this might be because my lack of experience with Rust but that&#x27;s why Rust community should be able to explain this so that you cannot misunderstand instead of just referencing Rust documentation.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891597/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891603"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 22:53 UTC (Sat)
                               by <b>beagnach</b> (guest, #32987)
                              [<a href="/Articles/891603/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You&#x27;ll probably get a better answer in lkml, since all of this is a work in progress with issues like this still being figured out by some very dedicated people who (if you bother to follow the discussions) actually do care very much about stability, compatibility and so on.<br>
<p>
Your chances of getting a good reply would probably be increased by reducing the amount of hostility and condescension in your tone.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891603/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891762"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 5:53 UTC (Tue)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891762/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I did subscribe to that now. Continuing over there. Thanks for pointing out. I did not know that vger list already exists.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891762/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor891625"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 10:56 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/891625/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; I would like to see a clear explanation how the maintenance flow would work with stable and long-term kernels and all these editions.</font>

<p>Only the kernel can answer that. C and C++ <b>also</b> have editions and they <b>also</b> are not 100% compatible. Yet kernel <a href="https://lwn.net/Articles/885941/">contemplates</a> them, anyway.

<p>Rust editions happen every 3 years, their incompatibility is usually pretty limited and there are <a href="https://doc.rust-lang.org/edition-guide/">guide</a> which helps you go from one edition to another.</p>

<p>They are also enabled on the per-crate basis and it's explicitly permittable to link together crates compiled for different editions.</p>

<p>Thus I would assume kernel folks would stick to oldest editions which are used in still supported versions of the kernel. Or maybe would allow use of the new ones in modules which are not support in older kernels.</p>

<p>Frankly, in practice editions are such a minor issue that it's not even worth discussing: yes, these changes are backward-incompatible but they are extremely minor (holf-dozen to dozen changes every three years) and mostly superfluous (as in: code written for the new edition can still be converted to old editions and in very mechanical fashion). A small nuisance instead of a major PITA.</p>

<p>Much more significant are <b>non</b>-edition style changes. These are numerous, happen every six week and while they <b>are</b> backward-compatible people embrace them quickly which means you can not easily backport new versions of important crates to old version of kernel without bumping the used version of rust compiler first.</p>

<p>You are barking on a wrong tree.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/891625/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891673"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 22:40 UTC (Sun)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/891673/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote><b>non</b>-edition style changes</blockquote>

<p>I think calling them style changes is a bit misleading. Generally, the stuff that bumps the minimum supported Rust version is the addition or stabilization of new standard library types/functions that people are then quick to jump on because they significantly reduce some boilerplate that has become near enough to ubiquitous to justify their creation.</p>

<p>(If you want to see the kind of things I'm talking about, <a rel="nofollow" href="https://caniuse.rs/">caniuse.rs</a> provides a quick overview.)</p>

<p>For example, one of the things introduced in Rust 1.56 was adding the <code>rust</code> field to <code>Cargo.toml</code> so libraries can specify the minimum supported Rust version in a machine-readable way.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/891673/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor891583"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 16:08 UTC (Sat)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/891583/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; This is unacceptable</font><br>
<p>
It seems that Linus Torvalds does not agree, since the kernel did in fact take a &quot;small change to the language that is not backwards compatible&quot; by going from C89 to C11.<br>
<p>
Unlike this change, Rust&#x27;s Editions aren&#x27;t actually language version changes, as you&#x27;d have discovered if you read more than a few sentences into that document. The allowed changes can alter the written syntax but not the abstract syntax. Thus, code from Rust 2015, Rust 2018 and Rust 2021 can be expressed together in a single abstract syntax inside the compiler, even though some things you were allowed to do in Rust 2015 are prohibited in Rust 2021, and some things in Rust 2021 were impossible in Rust 2015 and the way you spell some of the things that are allowed still changed if you decided to adopt a newer edition.<br>
<p>
For example, in C11 _Bool became a keyword, and in Rust 2021 async is a keyword. So, there&#x27;s no way to name the identifier _Bool in C11, it&#x27;s just gone, you&#x27;ll be told this was anyway reserved and so you were wrong to use it (but the kernel uses various reserved names all over the place and does not respect C&#x27;s rule about reserved names). Whereas you can name the identifier async in Rust 2021, it&#x27;s just spelled r#async<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891583/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891599"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 21:02 UTC (Sat)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891599/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hmm... I would not compare something where the breaking change happens for the first time in 30 years, for legit reasons, to the situation with Rust. Quite a bad comparison IMHO.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891599/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891604"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 16, 2022 22:57 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/891604/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
gcc has _plenty_ of non-backward-compatible changes. Try compiling the kernel with gcc 3, for example.<br>
<p>
As it is, Linux has a minimum version requirement for gcc (or clang) that gets raised pretty often. I believe it&#x27;s at 5.1 right now: <a href="https://lore.kernel.org/lkml/20210910234047.1019925-2-ndesaulniers@google.com/#t">https://lore.kernel.org/lkml/20210910234047.1019925-2-nde...</a><br>
<p>
So in practice, the _current_ Linux policy is worse than Rust. Instead of a well-defined edition, the kernel depends on an informal compiler version.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891604/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor891627"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 11:15 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/891627/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Hmm... I would not compare something where the breaking change happens for the first time in 30 years, for legit reasons, to the situation with Rust. Quite a bad comparison IMHO.</font>

<p>It's actually a very good comparison. The situation when you upgrade GCC and kernel stops working were so numerous that RedHat even had a special <code>kgcc</code> package for a time. And Android used a separate compiler <i>just for kernel</i> for a long time, too.</p>

<p>Granted, it's not because C definition, as a language, changes, but because clang/gcc and kernel disagree about certain minor features of the standard… but from a practical POV it's the same thing.</p>

<p>In theory, the same thing can happen in Rust, too… but in practice, because safe code doesn't contain UB (except when you exploit bugs in the compiler) it's much less of a problem. I don't think I have <b>ever</b> heard about the case where someone upgraded the compiler and Rust program started misbehaving. Sometimes (rarely) there are compilation issues, but they are usually easy to fix.</p>

<p>But with Rust we have an issue similar to C++ in the last century: it's incomplete. Certain important features are not implemented yet. Yes, that doesn't affect the code in way where you can not use new compiler to compile old code but the fact that these features are slowly-but-surely are added to the language means that many crates force you to use pretty new version of a compiler.</p>

<p><b>That</b> is serious issue in practice. Please think what you plan to do about that, forget about editions, these are minor things.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/891627/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891634"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 13:52 UTC (Sun)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/891634/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Please think what you plan to do about that</font><br>
<p>
We&#x27;re not talking about a feature set here, just one number which goes up. If you have Rust 1.72 then by definition all the stable stuff from Rust 1.71, 1.70, 1.69, and so on is available. You may not care very much whether checked_div() is const (Rust 1.52), but if you want IntoIterator implemented for arrays (Rust 1.53), you&#x27;ll get const checked_div into the bargain.<br>
<p>
The feature switches I think could be more contentious because at the same time some people see value in enabling some feature switch, other people will have begun to depend on it not being present in some cases. But this is already something you see for C compiler flags.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891634/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891639"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 14:12 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/891639/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <p>The problem is not the “some number goes up”. The problem is that Rust is still getting major features like <a href="https://blog.rust-lang.org/2021/02/26/const-generics-mvp-beta.html">const generics</a> or <a href="https://blog.rust-lang.org/2021/08/03/GATs-stabilization-push.html">GATs</a>.</p>

<p>And because these are significant, major features people often adopt in the matter of weeks and months. Some “conservative” crates only use features which are six months old, but not all crates which kernel may need or want would be “conservative”.</p>

<p>And even then six months is not much, kernel is accustomed for times measured in <b>years</b>. GCC 5.1 is still supported and that was released <a href="https://gcc.gnu.org/gcc-5/">seven years ago</a>!</p>

<p><b>That</b> impedance mismatch would be <b>much</b> bigger problem than any hypothetical issue with Rust editions.</p>

<p>Yes, in theory Rust editions can wreak total chaos every three years. In practice that's a tempest in a teapot: they come rarely enough and changes are minor enough that this formal incompatibility rarely becomes a problem in practice.</p>

<p>But the requirement to use six months old compiler can be real PITA for may kernel users.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/891639/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891682"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 23:13 UTC (Sun)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/891682/">Link</a>] 
      </p>
      
      </div>
      </summary>
      That said, if you'd like some concrete data, <a rel="nofollow" href="https://steveklabnik.com/writing/how-often-does-rust-change">How often does Rust change?</a> by Steve Klabnik is good.


      
          <div class="CommentReplyButton">
            <form action="/Articles/891682/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor891669"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 22:10 UTC (Sun)
                               by <b>bartoc</b> (guest, #124262)
                              [<a href="/Articles/891669/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Rust “UB” is a smaller category than c/c++ because theres no formal standard for the language with multiple implementers. Not all ub in C is assumed to never happen by compilers (for ex: most of the preprocessor and lexer UB)<br>
<p>
The other thing to remember is that the C standard can be obscenely vague about what implementations are allowed to do, the C++ standard tries much harder. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891669/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891877"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 15:44 UTC (Tue)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/891877/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Rust “UB” is a smaller category than c/c++ because theres no formal standard for the language with multiple implementers.</font><br>
<p>
It&#x27;s not about multiple implementations, at most that would lead to having Implementation Defined Behaviour which is much less scary, but in many cases there wouldn&#x27;t be any difference since the additional implementations would just do the same thing.<br>
<p>
C++ in particular is riddled with _intentional_ Undefined Behaviour. But even in the mundane C standard library trivial functions like abs() have Undefined Behaviour.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891877/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor891802"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 12:34 UTC (Tue)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/891802/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>An important point here is that while Rust 2021 code will not compile with a Rust 2015-only compiler, a future Rust compiler is expected to be able to compile all past editions, and to support interface-level interoperability between the editions at the crate level. Note that the crate is the unit of compilation in Rust, just as the translation unit is the unit of compilation in C.
<p>So, within a crate, I must stick to one edition; but within a project such as the kernel, I can freely mix editions (because I'd expect the kernel to be made of several crates, not to be one giant crate - just as in C I'd expect the kernel to be in multiple files spread around several directories, and not in a single giant source file). The only limitation I have is that I cannot use recent editions without a bump to the MSRV; but the same applies to C, where I can't use the full language without allowing for the bugs in older versions of GCC.


      
          <div class="CommentReplyButton">
            <form action="/Articles/891802/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor891654"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 17:45 UTC (Sun)
                               by <b>wtarreau</b> (subscriber, #51152)
                              [<a href="/Articles/891654/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I particularly despise automatic downloading of dependencies during build, and it&#x27;s unrelated to the language. Many of us have already been bit by not being able to rebuild an old piece of software just because some dependencies were missing. For embedded systems as well as for some mission critical systems, you often need to be able to rebuild the same code 5 years later, to reproduce an equivalent system consecutive to a disaster, or to reproduce a production bug in a test environment. The kernel is one of such components you need to be able to reproduce, and it&#x27;s really vital to be able to keep a local copy of *all* your dependencies and never rely on some $site that happily displays &quot;this domain is for sale&quot;, or a download repository that displays &quot;404 (as many have seen after trying to apply minimal fixes to very old debians for example after the repos were moved)&quot;.<br>
<p>
Sure it&#x27;s &quot;more convenient for us developers&quot; but developers&#x27; convenience is exactly what brings important costs in field (resource and problems). What made the success of linux is not just that it was opensource, but also that it was very reliable and reasonably easy to enter into. A reasonable balance needs to remain here. We don&#x27;t need to see random code being injected all the time just to add a line on a resume like we&#x27;re seeing dummy bug reports trying to be presented as security issues to get a CVE ID to the reporter.<br>
<p>
I would like that the developers continue to make a little bit of effort to make sure that the code that builds today will build exactly the same in 10 years if I download the same tarball and build on the same system with the same tools. Right now the kernel stands by that critical promise because it&#x27;s entirely self-contained. If some want other approaches, at least they should provide scriptable methods to retrieve everything and make sure one can always rebuild exclusively from these downloads.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891654/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891675"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2022 23:08 UTC (Sun)
                               by <b>ssokolow</b> (guest, #94568)
                              [<a href="/Articles/891675/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      I think the "random code being injected all the time just to add a line on a resume" being undesirable is the important thing.

<p>Cargo isn't NPM and they provide multiple layers of protection against kernel code failing to build ten years from now:</p>

<ol>
<li>Crates.io is designed so that only the admins can remove things and they don't do that unless either they're legally compelled to or the thing in question is out-and-out malicious. Developers can <code>cargo yank</code> crate versions with security vulnerabilities to prevent new things from depending on them, but they're still available to be downloaded by any project that has them in the lockfile that Cargo automatically maintains, and you're encouraged to commit your lockfiles to version control alongside your code.</li>
<li>The <code>cargo vendor</code> command automates what the kernel devs currently do with things like zstd, providing something similar to the status quo, but while still preserving machine-readable info on where they came from that allows you to streamline monitoring for updates and auditing them for manually approved inclusion.</li>
<li>They care enough about forward compatibility and their <a rel="nofollow" href="https://blog.rust-lang.org/2014/10/30/Stability.html">v1.0 stability promise</a> that, when they're considering making a change to the compiler or standard library in line with "We reserve the right to fix compiler bugs, patch safety holes, and change type inference in ways that may occasionally require new type annotations.", they've got a bot named Crater that can build and run the test suites for a chosen subset of the crates on crates.io, with "every single one" being a valid option. (Thank goodness for Microsoft donating the Azure time. It's a resource-expensive process.)</li>
<li>C has <code>_Bool</code> because too many people <code>typedef</code>'d <code>bool</code>. Rust has namespaces and editions so they can introduce new keywords like <code>async</code> and add new things to the prelude (the set of identifiers that get pulled into scope by default) without breaking existing code, because you have to opt into newer editions... and you can mix editions in the same build. They're just different frontends to produce the same underlying AST.</li>
<li>The compiler, standard library, etc. have an extensive test suite that gets run on every pull. (Another thing that would have become either prohibitively expensive or cripplingly slow with the growing number of platform targets without Microsoft donating Azure time.)</li>
<li>There are ongoing efforts to improve things further.</li>
</ol>











      
          <div class="CommentReplyButton">
            <form action="/Articles/891675/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor891890"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Rustaceans at the border</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 19, 2022 17:48 UTC (Tue)
                               by <b>jsakkine</b> (subscriber, #80603)
                              [<a href="/Articles/891890/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In this discussion I realized that it is better to experiment with the code rather than complain from the side. I did learn about &quot;cargo vendor&quot; command today, and it looks like a valid option for selected components. And I&#x27;m experimenting on bringing some of the stuff that I&#x27;m maintaining in the kernel to Rust. I&#x27;m also now following the vger list, which I also learned about thanks to this article.<br>
<p>
One thing that might become obstacle is the state of Rust front-end support in GCC because it is hard to imagine that this could end up to mainline without being able to compile it fully with stock GCC. Also, in order to use Rust ever in the core would probably require full coverage of arch/*. But I guess the latter is not end of the world as far as drivers are concerned.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/891890/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2022, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
