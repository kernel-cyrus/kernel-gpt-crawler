        <!DOCTYPE html>
        <html lang="en">
        <head><title>Adding periods to SCHED_DEADLINE [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/396634/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/396181/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/396634/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Adding periods to SCHED_DEADLINE</h1>
</div>
<div class="ArticleText">
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>July 20, 2010</br>
           </div>
The Linux scheduler, in both the mainline and realtime versions, provides a
couple of scheduling classes for realtime tasks.  These classes
implement the classic POSIX priority-based semantics, wherein the
highest-priority runnable task is guaranteed to have access to the CPU.
While this scheduler works as advertised, priority-based scheduling has a
number of problems and has not been the focus of realtime research for some
time.  Cool schedulers in this century are based on deadlines instead.
Linux does not yet have a deadline scheduler, though <a
href="http://lwn.net/Articles/356576/">there is one in the works</a>.  A
recent discussion on implementing the full deadline model has shown, once
again, just how complex it can be to get deadline scheduling right in the
real world.
<p>
Deadline scheduling does away with priorities, replacing them with a
three-parameter tuple: a worst-case execution time (or budget), a deadline,
and a period.  In essence, a process tells the scheduler that it will
require up to a certain amount of CPU time (the budget) by the given
deadline, and that the deadline optionally repeats with the given period.
So, for example, a video-processing application might request 1ms of CPU
time to process the next incoming frame, expected in 10ms, with a 33ms
period thereafter for subsequent frames.  Deadline scheduling is appealing
because it allows the specification of a process's requirements in a
natural way which is not affected by any other processes running in the
system.  There is also great value, though, in using the deadline
parameters to guarantee that a process will be able to meet its deadline,
and to reject any process which might cause a failure to keep those
guarantees.
<p>
The <tt>SCHED_DEADLINE</tt> scheduler being developed by Dario Faggioli
appears to be on track for an eventual mainline merger, though nobody, yet,
has been so foolish to set a deadline for that particular task.  This
scheduler works, but, thus far, it takes a bit of a shortcut: in
<tt>SCHED_DEADLINE</tt>, the deadline and the period are assumed to be the
same.  This simplification makes the "admission test" - the decision as to
whether to accept a new <tt>SCHED_DEADLINE</tt> task - relatively easy.
Each process gets a "bandwidth" parameter, being the ratio of the CPU
budget to the deadline/period value.  As long as the sum of the bandwidth
values for all processes on a given CPU does not exceed 1.0, the scheduler
can guarantee that the deadlines will be met. 
<p>
As Dario recently <a href="/Articles/396640/">brought up on
linux-kernel</a>, there are users who would like to be able to specify separate
deadline and period values.  Adjusting the scheduler to implement those
semantics is not particularly hard.  Coming up with an admission test which
insures that deadlines can still be met is rather harder, though.  Once the
period and the deadline are separated from each other, it becomes possible
for processes to miss their deadlines even if the total bandwidth of the
CPU has not been oversubscribed.
<p><blockquote class="ad">
<b><tt>$ sudo subscribe today</tt></b>
<p>
Subscribe today and elevate your LWN privileges. You’ll have
access to all of LWN’s high-quality articles as soon as they’re
published, and help support LWN in the process.  <a href="https://lwn.net/Promo/nst-sudo/claim">Act now</a> and you can start with a free trial subscription.
</blockquote>
<p>
To see how this might come about, consider <a href="/Articles/396641/">an
example</a> posted by Dario.  Imagine a process which needs 4ms of CPU time
with a period of 10ms and a deadline of 5ms.  A timeline of how that
process might be scheduled could look like this:
<p>
<img src="https://static.lwn.net/images/ns/kernel/deadline1.png" width=582 height=193,
alt="[Scheduling timeline]">
<p>
Here, the scheduler is able to run the process within its deadline; indeed,
there is 1ms of time to spare.  Now, though, if a second process comes in
with the same set of requirements, the results will not be as good:
<p>
<img src="https://static.lwn.net/images/ns/kernel/deadline2.png" width=582 height=193,
alt="[Scheduling timeline]">
<p>
Despite the fact that 20% of the available CPU time remains unused, process
P2 will miss its deadline by 3ms.  In a hard realtime situation, that tardiness
could prove fatal.  Clearly, the scheduler should reject P2 in this
situation.  The problem is that detecting this kind of problem is not easy,
especially if the scheduler is (as seems reasonable) expected to leave some
CPU time for applications and not use it all performing complex admission
calculations.  For this reason, admission decision algorithms are currently
an area of considerable research interest in the academic realtime
community.  See <a
href="ftp://ftp.rcs.ei.tum.de/pub/papers/rtsg/edffast.pdf">this paper by
Alejandro Masrur et al. [PDF]</a> or <a
href="http://retis.sssup.it/~marko/papers/ICPP09.pdf">this one by Marko
Bertogna [PDF]</a> for examples of how involved it can get.
<p>
There are a couple of ways to simplify the problem.  One of those would be
to change the bandwidth calculation to be the ratio of the CPU budget to
the relative deadline time (rather than to the period).  For the example
processes shown above, each has a bandwidth of 0.8 using this formula; the
scheduler, on seeing that the second process would bump the total to 1.6,
could then decide to reject it.  Using this calculation, the scheduler can,
once again, guarantee that deadlines will be met, but at a cost: this
formula will cause the rejection of processes that, in reality, could be
scheduled without trouble.  It is an overly pessimistic heuristic which will
prevent full utilization of the available resources.
<p>
An alternative, proposed by Dario, would be to stick with the period-based
bandwidth values for admission decisions and to take the risk that some
deadlines might not be met.  In this case, user-space developers would be
responsible for ensuring that the full set of tasks on the system can be
scheduled.  They might take some comfort in the fact that, since the
overall bandwidth of the CPU would still 
not be oversubscribed, the amount by which a deadline could be missed would
be deterministically bounded.
<p>
That idea <a href="/Articles/396646/">did not survive its encounter</a>
with Peter Zijlstra, who thinks it ruins everything that a deadline
scheduler is supposed to provide:
<p>
<div class="BigQuote">
	The whole reason SCHED_FIFO and friends suck so much is that they
	don't provide any kind of isolation, and thus, as an
	Operating-System abstraction they're an utter failure.  If you take
	out admission control you end up with a similar situation.
</div>
<p>
Peter's suggestion, instead, was to split deadline scheduling logically
into two different schedulers.  The hard realtime scheduler would retain
the highest priority, and would require that the deadline and period values
be the same.  If, at some future time, a suitable admission controller is
developed then that requirement could be relaxed as long as deadlines could
still be guaranteed.
<p>
Below the hard realtime scheduler would be a soft realtime scheduler which
would have access to (most of) the CPU bandwidth left unused by the hard
scheduler.  That scheduler could accept processes using period-based
bandwidth values with the explicit understanding that deadlines might be
missed by bounded amounts.  Soft realtime is entirely good enough for a
great many applications, so there is no real reason not to provide it as
long as hard realtime is not adversely affected.
<p>
So that is probably how things will go, though the real shape of the
solution will not be seen until Dario posts the next version of the
<tt>SCHED_DEADLINE</tt> patch.  Even after this problem is solved, though, deadline
scheduling has a number of other challenges to overcome, with good
multi-core performance being near the top of the list.  So, while Linux
will almost certainly have a deadline scheduler at some point, it's still
hard to say just when that might be.
<p>
(Readers who are interested in the intersection of academic and practical
realtime work might want to peruse the recently-released <a
href="http://www.artist-embedded.org/docs/Events/2010/OSPERT/OSPERT2010-Proceedings.pdf">proceedings
[PDF]</a> from the OSPERT 2010 conference, held in Brussels in early July.)<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Realtime-Deadline_scheduling">Realtime/Deadline scheduling</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Scheduler-Deadline_scheduling">Scheduler/Deadline scheduling</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/396634/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor396676"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 20, 2010 22:04 UTC (Tue)
                               by <b>xxiao</b> (guest, #9631)
                              [<a href="/Articles/396676/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
how about a new scheduler option...CFS is hard to tune and has a really bad performance on my multithread embedded apps(&gt;10% cpu usage increase,etc), the same app ran perfectly well with the O1 scheduler in the past for years.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/396676/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor396720"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2010 7:46 UTC (Wed)
                               by <b>abacus</b> (guest, #49001)
                              [<a href="/Articles/396720/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Please report this as a kernel bug, such that Ingo Molnar can have a look at it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/396720/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor396769"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2010 16:18 UTC (Wed)
                               by <b>cesarb</b> (subscriber, #6266)
                              [<a href="/Articles/396769/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It would be cool if people could "record" a trace of their scheduling so that the sched maintainers could "replay" it, so that they can find and fix bugs without having to find a reproducible testcase (i.e. even if it happened just once, if you have a trace, it could be used to find the cause).<br>
<p>
I do not know if this already exists; I have not looked.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/396769/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor396837"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2010 19:31 UTC (Wed)
                               by <b>sbohrer</b> (guest, #61058)
                              [<a href="/Articles/396837/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I believe "perf sched record" and "perf sched replay" will do exactly that.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/396837/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor396721"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2010 8:01 UTC (Wed)
                               by <b>viiru</b> (subscriber, #53129)
                              [<a href="/Articles/396721/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; how about a new scheduler option...CFS is hard to tune and has a really </font><br>
<font class="QuotedText">&gt; bad performance on my multithread embedded apps(&gt;10% cpu usage </font><br>
<font class="QuotedText">&gt; increase,etc), the same app ran perfectly well with the O1 scheduler in </font><br>
<font class="QuotedText">&gt; the past for years.</font><br>
<p>
Google is having the same problem with some of their apps, which is why they have ported the old scheduler over to the 2.6 series. I'm not sure if they have a kernel tree with that publicly available, though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/396721/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor396754"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2010 15:09 UTC (Wed)
                               by <b>ms</b> (subscriber, #41272)
                              [<a href="/Articles/396754/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm clearly missing something - I don't understand why there's a problem with P2. The only issue that I can see is that the scheduler should tell it that it can meet its demands, but only if P2 is happy to wait for 2ms initially - after that the interleaving with P1 works out fine for both of them.<br>
<p>
Is this initial scheduling problem the only issue with P2 here or am I missing something else?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/396754/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor396755"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2010 15:10 UTC (Wed)
                               by <b>ms</b> (subscriber, #41272)
                              [<a href="/Articles/396755/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
(Err, I meant "wait for 3ms initially", not 2ms)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/396755/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor396756"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2010 16:03 UTC (Wed)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/396756/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <p>That's the entire problem - kernel-side, spotting that you have to tell P2 that its request for CPU time cannot be met as-is, but could be met if P2 could delay its initial deadline is the hard part. It's easy to tell that we have enough CPU time in total in the 10ms time period, but not (in general) easy to tell if we can't have P2 and P1 both meet their first deadline. If P2 could cope with having its deadline delayed by 2ms, it would say that - IOW, it would ask for first deadline 7ms from now, not 5ms from now.
<p>Note that while this example is rather simple (we have two 4ms processes to fit into 5ms, which isn't going to work), you've also got to cope with more complex examples - e.g. P1 has a deadline of 5ms from now, 4ms of work to do, and a period of 10ms (so deadlines at 5ms from now, 15ms from now, 25ms from now etc), while P2 has a deadline of 3ms from now, 1ms of work to do, and a period of 16ms (so deadlines at 3ms, 19ms, 35ms etc). Can P1 and P2 co-exist on the same CPU, or does P2 have to be told that its demands can't be met?
      
          <div class="CommentReplyButton">
            <form action="/Articles/396756/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor396781"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2010 17:02 UTC (Wed)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/396781/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Actually, it should be trivial to tell that, before the first deadline, we already have 4ms of work and can't allocate another 4ms of work. I think the real issue is that, if you've got two tasks with slightly different periods, they may be fine for the first deadlines, but slowly drift into phase, at which point the processor is oversubscribed until they drift back out of phase.<br>
<p>
Say you're doing video processing on a stream at 60 Hz and one at 50 Hz. If you've got tight windows between when the input is available and when the output is required (say 2ms of work out of 3ms of real time), you may be fine for the first 100ms and then have to do both frames at the same time. Or the streams might be staggered such that they never conflict.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/396781/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor396849"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2010 20:34 UTC (Wed)
                               by <b>blitzkrieg3</b> (guest, #57873)
                              [<a href="/Articles/396849/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I agree wholeheartedly. The example provided was pretty bad. Clearly what the scheduler does in the case above is just stagger the cpu time. I don't think any realtime guys consider it unreasonable for a process to have a start up cost.<br>
<p>
The example you provided was exactly what I thought of when I started reading, sort of like how blinkers will phase in and out of sync while sitting in the turning lane.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/396849/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor396850"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Example</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2010 20:43 UTC (Wed)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/396850/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      I'll confess to being totally confused by this comment.  The example was (deliberately) simple, but I think it's clear and valid: the scheduler simply cannot meet the deadlines in that case.  I don't see how that can be fixed by "staggering the CPU time."  The scheduler can't change the deadline...  What am I missing?
      
          <div class="CommentReplyButton">
            <form action="/Articles/396850/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor396854"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Example</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2010 21:58 UTC (Wed)
                               by <b>Shewmaker</b> (guest, #1126)
                              [<a href="/Articles/396854/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think their confusion centers around the implications of allowing separate deadline and period values.  If the commenters read Dario's email, then they would have seen his reference to the "sporadic task model" which may have helped.<br>
<p>
Perhaps another way to describe your example is that it is specifically constructed to show that when a scheduler tries to allow admission of a task at any time, and not just on period boundaries, then it gets harder.  Yes, the scheduler could delay the admission of the new task until the deadline of the existing task, but then you have a periodic scheduler and not one that handles sporadic job arrivals.<br>
<p>
I hope that helps.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/396854/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor396863"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Example</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 21, 2010 22:37 UTC (Wed)
                               by <b>blitzkrieg3</b> (guest, #57873)
                              [<a href="/Articles/396863/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>I think their confusion centers around the implications of allowing separate deadline and period values. If the commenters read Dario's email, then they would have seen his reference to the "sporadic task model" which may have helped.</blockquote>

<p>
Yeah exactly. I went back and read the email after seeing the response, and the key point is:
</p>

<blockquote> one of the tasks can miss its deadline by 3 time units in the worst case (if, and if yes which one, depends on the order with witch they arrive). </blockquote>

<p>Obviously if we have the good fortune of having P2 arrive after 5 time units, we're golden. Before reading the email, I would have assumed that if you're just starting an executable, rather than acting on an event such as a udp packet or something, then you can sacrifice 5 time units.</p>

I've illustrated exactly what I mean <a href="http://imgur.com/CKMcp.png" >http://imgur.com/CKMcp.png</a>

<p>
For the purposes of explaining how this works and what these values mean, it might make more sense to use a simple example that isn't schedule-able, no matter what order it comes in, like:
</p>

<code>
T_1 = (2, 4, 3)
<br>
T_2 = (2, 5, 3)
</code>

<p>Even if T_2 can be scheduled after 2 time units, using the naive algorithm that I illustrated in the picture, it's clear that they're both going to wake up at the same time after 10 units, at which time you have 3 units to schedule 4 slots of cpu time.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/396863/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor397227"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Example</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2010 22:33 UTC (Fri)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/397227/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>I think where people really get lost in these explanations is that they appear to describe a system where the scheduler gets to to decide exactly who to give CPU time and when, or where a process requests a precise CPU schedule for itself for the rest of time.
<p>
But in reality, the scheduler must wait for a process to <em>request</em> each chunk of time, and <em>even the process</em> can't know exactly when it will do that.
<p>
I presume the parameters actually say, "I am going to be requesting CPU time in the future.  There will be at least 10 ms between requests.  Each one will be for less than 4 ms, but whatever it is, I'll need it all within 5 ms of when I ask for it.
<p>
Based on that, the scheduler is supposed to say, "As long as you stick to those constraints, I guarantee I will fill all your requests" or "I can't guarantee that, so don't bother trying to run."
<p>
I really don't get the one statement about it being OK to miss the deadline by a bounded amount.  If the process is OK with getting its 4ms within 10 ms, why did it state a deadline of 5 ms?

      
          <div class="CommentReplyButton">
            <form action="/Articles/397227/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor397049"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Example</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2010 19:57 UTC (Thu)
                               by <b>droundy</b> (subscriber, #4559)
                              [<a href="/Articles/397049/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think the problem with the example was just that in the case where all the periods are the same (as in the example), the kernel need only look at the first period to figure out if it can accept the request, which wouldn't be particularly hard to figure out.  But when there are different periods involved, it could be much harder...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/397049/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor397100"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 22, 2010 23:27 UTC (Thu)
                               by <b>ejr</b> (subscriber, #51652)
                              [<a href="/Articles/397100/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Is it reasonable to assume these tasks will be in the scheduler for a "long" period of time?  If so, perhaps the best idea is the simplest possible in-kernel schedule builder coupled with an optional user-space schedule builder.  Using a more complicated scheduler (and admission decider) adds a large initial cost, but that *may* be acceptable if the initial cost is much smaller than the total span of time the task will be in the scheduler.  Statically analyzed systems and those with only one or two such tasks may be content with the in-kernel simple solution.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/397100/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor397110"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2010 0:36 UTC (Fri)
                               by <b>gdt</b> (subscriber, #6284)
                              [<a href="/Articles/397110/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>From an application programming point of view I don't want to have to profile my application for each target system. I'd very much like to run a few AV frames, BGP Hellos or whatever and then say "deadline schedule me that". It would be nice if the APIs were better thought out so that this could be simple, but they aren't. The current APIs really encourage reserving the worst-case behaviour of the algorithm on the worst-case target (not really appropriate for a soft real time such as video decode or protocol handling, where we can let the occasional extraordinary event pass through to the keeper), so we can be asking for two or three orders of magnitude too much resources.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/397110/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor397137"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 23, 2010 10:23 UTC (Fri)
                               by <b>mjthayer</b> (guest, #39183)
                              [<a href="/Articles/397137/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If the granularity of the periods is not too high (millisecond should be alright) then a brute force check - running through a few seconds of all the real-time tasks on the system with the hypothetical newly scheduled task - might do the trick.  I could also imagine the task wanting to be scheduled giving an deadline for when it needed a definite answer as to whether or not it was possible, and the kernel successively trying increasingly "tight" methods in that time, accounting the time to the task, to try and schedule it.  Bearing in mind of course that the checks might need to be restarted if something else was successfully scheduled - or descheduled -  in that time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/397137/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor397235"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 24, 2010 1:42 UTC (Sat)
                               by <b>mcmechanjw</b> (guest, #38173)
                              [<a href="/Articles/397235/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
When looking at the example, I believe both the current bandwidth and the future bandwidth need to be checked separately. I can envision the scheduler having 100% usage from now into the future and yet have a very low future bandwidth.<br>
<p>
For example a current SCHED_DEADLINE process has claimed 100% until its deadline in 10ms but won't reschedule for 1000ms afterwards.<br>
<p>
I can also see having 100% free for a while and 100% used later.<br>
E.g. the current process has completed and won't reschedule for 1000ms but the total reserved is 100% of the CPU then...<br>
<p>
Looking at it, it seems it does not matter if the period and deadline are separate or not, the current schedule must be tested against the first deadline regardless of when that will be and the periodic bandwidth must be tested separately against future bandwidth reservations.<br>
<p>
The simplest method that comes to mind for the current schedule is to just walk the schedule forward and see when enough free ms have accumulated before the proposed deadline is hit...<br>
I am fairly sure most heuristics will have bad to very bad corner cases either not offering cpu time when available or oversubscribing.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/397235/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor397808"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2010 6:04 UTC (Thu)
                               by <b>eternaleye</b> (guest, #67051)
                              [<a href="/Articles/397808/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
While reading up on this I came across this mail: <a rel="nofollow" href="http://lkml.org/lkml/2008/10/31/52">http://lkml.org/lkml/2008/10/31/52</a> (though I forget exactly how), which made me curious what these 'pfair' algorithms were. I am posting here a link to a paper which explains the entire pfair/erfair family of scheduling algorithms in some depth, as it's really fascinating - it also makes me wonder why Dario is implementing EDF (Earliest Deadline First) despite its poor SMP properties rather than, say, the ERFair variant of PD2, which not only is more optimal in its scheduling but also has a much simpler admission test. (I do admit that 'simplicity of concept' may well be a valid argument here, but simplicity at the cost of usefulness isn't likely to go over well).<br>
<p>
Link:<br>
<a rel="nofollow" href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.77.6265&amp;rep=rep1&amp;type=pdf">http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1....</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/397808/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor398415"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Adding periods to SCHED_DEADLINE</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 2, 2010 14:22 UTC (Mon)
                               by <b>Arakageeta</b> (guest, #60609)
                              [<a href="/Articles/398415/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Unfortunately, preemption and CPU migration overheads limits pfair performance.  Global earliest deadline scheduling is, practically speaking, the best algorithm for soft realtime scheduling.<br>
<p>
BTW, the research group that published the paper you linked also maintains a Linux testbed (Litmus^RT) to test real-time scheduling (pfair, various deadline schedulers) and synchronization algorithms: <a rel="nofollow" href="http://www.cs.unc.edu/~anderson/litmus-rt/">http://www.cs.unc.edu/~anderson/litmus-rt/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/398415/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2010, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
