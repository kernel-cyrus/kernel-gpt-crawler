        <!DOCTYPE html>
        <html lang="en">
        <head><title>Support for drivers in user space [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/198202/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/197729/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/198202/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Support for drivers in user space</h1>
<div class="Byline">[Posted September 4, 2006 by corbet]
               <p>
               </div>
</div>
<div class="ArticleText">
Device drivers are generally done inside the kernel for the usual reasons
of performance and control.  There are times, however, when the ability to
run a device driver in user space is helpful.  These include situations
where the code is far too large to go into the kernel (X.org, for example)
and where the author of the driver does not wish to
place the code under the GPL.  Some types of drivers (such as those for USB
devices) are easily run in user space now, but others can be a bit more
challenging.  Very few PCI drivers, for example, are written in user space.
<p>

Thomas Gleixner has written <a href="http://lwn.net/Articles/197523/">an
interface module</a> which may help to change that situation.  With this
code in place, PCI drivers (some of them, at least) can be written almost
entirely in user space, with only a small stub module loaded into the kernel.
<p>

That module has two specific jobs to carry out.  The first is to register
the device to be driven, with a couple of bits of important information.
To that end, it should fill out an <tt>iio_device</tt> structure, which
contains the following fields:
<P>
<pre>
struct iio_device {
    char			*name;
    char			*version;
    unsigned long		physaddr;
    void			*virtaddr;
    unsigned long		size;
    long			irq;

    irqreturn_t (*handler)(int irq, void *dev_id, struct pt_regs *regs);
    ssize_t (*event_write)(struct file *filep, const char __user * buf,
    		       size_t count, loff_t *ppos);
    struct file_operations	*fops;
    void			*priv;
    /* ... */
};
</pre>
<p>

The first part of the structure provides information about the hardware 
to be driven - its name, where its I/O memory area lives
(<tt>physaddr</tt>), where that area has been mapped into the kernel
(<tt>virtaddr</tt>), its size, and the interrupt being used by the device.
If <tt>virtaddr</tt> is zero, then <tt>physaddr</tt> is interpreted as the
beginning of a range of I/O ports, rather than a memory address.
<p>
The <tt>fops</tt> field provides the file operations for the device;
normally, they are set to the generic versions provided by the IIO (for
"industrial I/O") driver: <tt>iio_open()</tt>, <tt>iio_read()</tt>,
<tt>iio_mmap()</tt>, etc.
With this setup, the driver can create a
basic device which allows a user-space program to read from or write to
device memory (or ports).  I/O memory can also be mapped into user space.
<p>
The capabilities described thus far are not all that different from what
can be done with <tt>/dev/mem</tt>; the main difference is that the stub
driver can enable the PCI device and perform any other needed
initialization.  The real hitch in writing user-space PCI drivers, however,
has been in the handling of interrupts.  There is currently no way to write
a user-space interrupt handler, and the IIO patch doesn't really change
that.  Instead, the stub driver is expected to provide a minimal interrupt
handler of its own.
<p>
This handler is needed because every device requires its own specific
interrupt acknowledgment ritual.  The kernel must respond quickly to an
interrupt and give the device the attention it craves so that said device
will stop asserting the interrupt.  After that, any additional processing
can be done at relative leisure.  So, once the handler provided with the
stub driver acknowledges the interrupt, the rest of the work can normally
be done by the user-space driver.
<p>
All that is needed is to let this driver know that the interrupt has
happened.  The IIO module provides a couple of mechanisms for that
purpose.  One is a second device node associated with the device; whenever
an interrupt happens, a byte can be read from this "event device."  So a
user-space driver can simply block on a read from that device, or it can
use <tt>poll()</tt> in more complicated situations.  It is also possible
for the user-space driver to receive <tt>SIGIO</tt> signals when an
interrupt happens, but using signals will normally increase the ultimate
response time to the interrupt.
<p>
So, to make all this happen, the stub driver provides a minimal interrupt
handler in the <tt>handler()</tt> field of the <tt>iio_device</tt>
structure.  When an interrupt happens, the IIO module will call this handler;
if it returns <tt>IRQ_HANDLED</tt>, user space will be notified.
If the stub driver provides an <tt>event_write()</tt> function, that
function will be called in response to a write operation on the event
device.  This capability can be used to further control the kernel-space
response to interrupts, request that interrupts be masked, etc.
<p>
Readers who think that the event mechanism shares some features with the
proposed kevent subsystem are right.  It is probable that the IIO event
handling code will be rewritten to use kevents, if and when kevents are
merged into the mainline.
<p>

Meanwhile, however, the IIO driver works.  Thomas has posted <a
href="/Articles/198208/">an example driver</a> (or parts of one, anyway) to
show how this mechanism can be used.  The real question which appears to be
on a number of minds, however, is: could ATI and nVidia use IIO to move
their drivers out of the kernel.  Only those vendors can answer that
question, however, so, until they say something, nobody really knows.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Device_drivers-In_user_space">Device drivers/In user space</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/198202/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor198566"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 0:53 UTC (Thu)
                               by <b>NCunningham</b> (guest, #6457)
                              [<a href="/Articles/198566/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Sigh. If you implement your drivers in userspace, you can simultaneously <br>
tell your users to forget about suspending to disk, and possibly to ram.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198566/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor198573"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 2:30 UTC (Thu)
                               by <b>gregkh</b> (subscriber, #8)
                              [<a href="/Articles/198573/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Not true at all, you have to have a tiny kernel piece for this framework<br>
to work properly, and just add the proper PCI suspend / resume portions<br>
of the pci framework and it should work just fine.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198573/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor199485"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 14, 2006 9:07 UTC (Thu)
                               by <b>quintesse</b> (guest, #14569)
                              [<a href="/Articles/199485/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Hi Nigel (*), could you expand on this? Would it really be impossible to do power management and such things if (most of) the driver code is moved to user space and why?<br>
<p>
*) See <a rel="nofollow" href="http://www.suspend2.net">http://www.suspend2.net</a> for those who don't know Nigel<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/199485/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor198590"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 6:49 UTC (Thu)
                               by <b>bboissin</b> (subscriber, #29506)
                              [<a href="/Articles/198590/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      Although there seems to be a consensus among kernel devs that if it is in userspace then the GPL is not applicable.<br>
Doesn't a driver in userspace constitute a derivative work from the kernel (especially since the API is specific to Linux) ?<br>
<p>
The note from Linus in the COPYING file only says:<br>
" This copyright does *not* cover user programs that use kernel<br>
 services by normal system calls"<br>
<p>
Maybe someone can enlighten me (please no flames).<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198590/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor198610"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 9:33 UTC (Thu)
                               by <b>pphaneuf</b> (guest, #23480)
                              [<a href="/Articles/198610/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I'd say this is correct. But this device driver is incomplete, you still need to create a kernel module that adds the missing interrupt handler. That part will still need to comply with whatever the licensing rules for kernel modules are.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198610/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor198650"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">This is not a flame...</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 13:19 UTC (Thu)
                               by <b>hummassa</b> (guest, #307)
                              [<a href="/Articles/198650/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Google for abstraction, filtration and comparison.<br>
After doing so, my opinion: no, a device driver is not necessarily a <br>
derivative work of the kernel. But, as the sibling post states, the kernel <br>
module that handles the interrupts (and possibly suspending/resuming) <br>
probably _is_ a derivative work of the kernel.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198650/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor199481"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 14, 2006 8:57 UTC (Thu)
                               by <b>lgb</b> (guest, #784)
                              [<a href="/Articles/199481/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      Well yes, I guess, the kernel part of these drivers should be released as GPL code. However, the bulk of the code is in user space ... If you were right, an average user space app is also a derivative work, since it's not only uses system calls, but may also use /dev or /proc or even /sys entries, besides syscalls. This splitted driver model just do this: a to-be-GPL'ed kernel part, and a user space part which needn't released as GPL.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/199481/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor199524"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 14, 2006 15:05 UTC (Thu)
                               by <b>gwg</b> (guest, #20811)
                              [<a href="/Articles/199524/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      Something that seems to be overlooked most of the time in these<br>
discussions, is that the GPL applies to "work based on the Program",<br>
and there are more types of such work that just derived work.<br>
<p>
Another sort of work is a collective (or compilation) work.<br>
GPL and non-GPL code doesn't have to be linked in any way to<br>
both be part of a collective work. The point for discussion<br>
in such cases is whether placing the GPL and non-GPL work<br>
together, forms a collective work or not. One criteria for<br>
deciding this might be the same one used to decide whether<br>
a collective work qualifies for copyright protection,<br>
ie. does it have authorship in the selection, co-ordination<br>
or arrangement of its parts.<br>
<p>
For a work to be a collective work, I don't think that it<br>
is even necessary for the parts to be on the same media -<br>
it's only necessary that the parts be supplied by the same<br>
party, and be intended to work together, showing that there<br>
is authorship in the selection, co-ordination or arrangement of<br>
the parts (ie. consider the analogy in literature of a book<br>
anthology being delivered in separate volumes).<br>
<p>
If a user mode driver is arranged to work with the kernel<br>
(and there would need to be authorship in the arrangement,<br>
selection and co-ordination of the user and/or kernel parts<br>
to achieve that), then surely if it is supplied with the<br>
intention of running with GPL code supplied by the same<br>
party, it forms a collective work, and the whole must be<br>
licensed under the GPL.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/199524/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor199614"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 14, 2006 21:54 UTC (Thu)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/199614/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      That may possibly be a valid legal argument, but its irrelevant to Linux, since it has always exempted user-space programs from any Linux-related license requirement.  <br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/199614/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor199632"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2006 4:37 UTC (Fri)
                               by <b>gwg</b> (guest, #20811)
                              [<a href="/Articles/199632/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Linus's explanation in the Linux "COPYING" file is unclear. In the relevant<br>
sentence he states that "this copyright does *not* cover user programs that<br>
use kernel services by normal system calls", which might be construed as<br>
meaning that the Kernel copyright does not regard user programs as ever<br>
being part of a "work based on the Program", or it could mean that no<br>
copyright is claimed over user programs just because they make system<br>
calls, or both, (these being two different things, one being the scope of<br>
a collective work, the other being the copyright on the user program).<br>
<p>
But then he goes on to say " - this is merely considered normal use of the<br>
kernel, and does *not* fall under the heading of "derived work".", thereby<br>
suggesting that the disclaimer is intended to have the narrower second meaning,<br>
not the first. If this is the case, then my argument would apply to Kernel<br>
code and user code, if they are presented as a collective work, supplied by<br>
a single party.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/199632/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor199681"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2006 16:42 UTC (Fri)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/199681/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      One more point.  Your argument is clearly not the intent of Linus' exception.<br>
<p>
For example, if you are correct, a Linux LiveCD with Unreal Tournament included is violating the GPL.<br>
<p>
Unreal Tournament communicates with the GPU directly (well, through OpenGL direct rendering libraries), just as a user-space driver would.<br>
<p>
So if one is violating the GPL by your argument, so is the other, and that is clearly ridiculous.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/199681/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor199757"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 16, 2006 2:32 UTC (Sat)
                               by <b>gwg</b> (guest, #20811)
                              [<a href="/Articles/199757/">Link</a>] 
      </p>
      
      </div>
      </summary>
      It's hard to say from Linus's statement in the COPYING file alone, what his intention was.<br>
From common usage, you may regard such an interpretation as ridiculous, but that doesn't<br>
somehow invalidate the interpretation of the licence. If a different contributor to the<br>
Linux kernel wanted to make the interpretation I've made, then they could well take someone<br>
distributing something like Unreal Tournament on a LiveCD to court, and see if the court<br>
agrees that it's a collective work, and falls under the requirements of the GPL, as being a<br>
"work based on the Program", and that Linus's disclaimer only applies to derived works.<br>
I certainly regard anyone making use of my GPL licences code as being in violation of the<br>
licence, if they release a collective work that does not itself comply with the GPL licence<br>
(but then I don't have a Linus like disclaimer in my copy of the GPL).<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/199757/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor199708"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2006 18:14 UTC (Fri)
                               by <b>efexis</b> (guest, #26355)
                              [<a href="/Articles/199708/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I don't think so; you can communicate with something without being a derivative work of it. Maybe you could write a portable driver, where the majority of the code can run under different OS's, that just uses a small glue to connect to the actual kernel. The driver itself could maybe run under Linux, Solaris, and Windows... but does that make it a derivate of all three?<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/199708/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor198592"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 6:58 UTC (Thu)
                               by <b>flewellyn</b> (subscriber, #5047)
                              [<a href="/Articles/198592/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      This is really not a good idea.  If we move drivers out of kernel space, we lose not just 
performance, but we lose some of the power of the GPL as a tool to keep the system free.  Go 
down this road, and we may wind up with a situation where the kernel is free software, but the 
drivers for hardware are not.  In other words, a non-free system.

      
          <div class="CommentReplyButton">
            <form action="/Articles/198592/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor198611"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 9:34 UTC (Thu)
                               by <b>pphaneuf</b> (guest, #23480)
                              [<a href="/Articles/198611/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I wonder how the HURD (with its microkernel design and its userspace modules) deals with that issue? Or maybe they just didn't think of this possibility?<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198611/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor198628"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 11:14 UTC (Thu)
                               by <b>appie</b> (guest, #34002)
                              [<a href="/Articles/198628/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Indeed, doesn't this open up a road to scenarios like
<a href="http://lwn.net/Articles/162686/">Linux in a binary world... a doomsday scenario
</a> as well ?
<br/>
As with all inventions, there's a good side and a Dark Side to be considered.<br/>
The whole driver area is, i'm afraid, unfortunately one where coders do have to consider politics et al besides, well, coding.

      
          <div class="CommentReplyButton">
            <form action="/Articles/198628/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor198662"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 14:53 UTC (Thu)
                               by <b>simlo</b> (guest, #10866)
                              [<a href="/Articles/198662/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      I think this is a good compromise:<br>
An open source, GPL'ed, in-kernel driver very often perform better than the closed source user-space one. Thus vendors providing open source drivers gets an etch over those who do not want to open their driver. So Linux users not so worried about having a 100% free system will be able to use the hardware but will tend to choose one from a vendor providing an open driver, because it performs better.<br>
<p>
And it is not as big a problem for the kernel development since the interface to userspace can more easily be keeped stable than an internal API.<br>
<p>
Having a closed source driver running in userspace is a good starting point for reverse engineering it, too.<br>
<p>
Esben<br>
<p>
PS. How can you complain about a closed source driver and not complain about the BIOS? Or the closed source microcode in the processor?<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198662/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor198731"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 19:33 UTC (Thu)
                               by <b>flewellyn</b> (subscriber, #5047)
                              [<a href="/Articles/198731/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I think the reason people don't complain about the BIOS (more than they do; see LinuxBIOS) is that the BIOS could be considered part of the hardware.  So could microcode in the processor.<br>
<p>
If hardware manufacturers put the "sensitive" portions of their drivers in firmware, using Forth or something else compact to provide a programmable interface to the hardware, then they could release free drivers that just sent the necessary commands to the firmware.  I don't think that would be objectionable, since, again, the firmware could be considered part of the hardware.<br>
<p>
Maybe.  I'm not a lawyer.  (I would like to see free firmware, mind you, but I think free software is more important.)<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198731/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor198752"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 22:06 UTC (Thu)
                               by <b>man_ls</b> (guest, #15091)
                              [<a href="/Articles/198752/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <blockquote type="cite" >PS. How can you complain about a closed source driver and not complain about the BIOS? Or the closed source microcode in the processor?</blockquote>
<a href="http://www.fsf.org/news/freebios.html" >Richard Stallman does</a>. In fact many people do once they learn or figure out the problem. The reasoning goes: software you can change yourself should be free software, i.e. have source code available and allow distribution of modified versions.
<p>
People do not complain about the microcode in the processor, mind you, since it cannot be upgraded or changed; it can safely be considered hardware.
      
          <div class="CommentReplyButton">
            <form action="/Articles/198752/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor198798"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 8, 2006 10:26 UTC (Fri)
                               by <b>Los__D</b> (guest, #15263)
                              [<a href="/Articles/198798/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Oh? <a href="http://freshmeat.net/projects/intelp6microcodeupdateutility/">http://freshmeat.net/projects/intelp6microcodeupdateutility/</a><br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198798/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor198799"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 8, 2006 10:38 UTC (Fri)
                               by <b>man_ls</b> (guest, #15091)
                              [<a href="/Articles/198799/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Oops! One more thing to worry about then...
      
          <div class="CommentReplyButton">
            <form action="/Articles/198799/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor198677"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 15:36 UTC (Thu)
                               by <b>sbishop</b> (guest, #33061)
                              [<a href="/Articles/198677/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I think that this is a good idea because it is useful.  Let me explain.  I work with self-taught programming electrical engineers, and maintain a very simple USB driver for a tester we've developed to test our own hardware.  I'm planning to switch to a user-space driver, though, as soon as possible, to make things much, much easier for my (eventual) replacement.<br>
<p>
I could take Greg K-H up on his offer (to everyone in my situation, not just me personally) to have the kernel driver merged into the mainline.  But the tester hosts are just now switching over to RHEL4 (with a 2.6.9 kernel).  How long would it take before that merged driver came back around to us?<br>
<p>
I have a friend who maintains a PCI driver, also for an internally used tester, at a different company.  I'm sure he (and importantly, his boss) would be happy to go user-space.<br>
<p>
License-wise, I'm with Linus.  Enforce the GPL with respect to the kernel, but don't try to use it to force things on others beyond that.  Free software can stand on its own merits.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198677/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor198682"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Modularity and competition</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 15:38 UTC (Thu)
                               by <b>copsewood</b> (subscriber, #199)
                              [<a href="/Articles/198682/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I think this argument potentially confuses a technical with a political issue.<br>
<p>
My view is that in both contexts modularity is good. In the licensing/political context, having modularity means that 2 pieces of software, or subsystems, or systems under 2 different free licenses or under free and proprietary licenses can communicate. Modularity makes competition between different implementations possible and evolution ensures survival of best working code (usually but not always free).<br>
<p>
If a proprietary hardware manufacturer which doesn't want to disclose information to competitors through support of free software drivers can support Linux through a userspace driver this means those who have bought, or want to buy this hardware won't be totally discouraged by the lack of Linux support for it. If a second hardware manufacturer can achieve better performance with a GPL kernelspace driver this has the potential advantage of more Linux sales than the first manufacturers products. Unless there is competition for Linux related sales between them, neither manufacturer need bother.<br>
<p>
Extending the argument to reductio ad absurdam, consider the case that the ideological purity of Linux requires that it doesn't communicate with any _system_ that uses non-free software, including Windows boxes using TCP/IP. In practice there are different levels of communication possible between software components, and genuine technical modularity and neutral and published interfacing standards such as TCP/IP not only leads to more reliable components and systems such as Linux and BSD, but this also creates niches leading to whole market ecosystems within which free software can flourish and grow.<br>
<p>
So I think that having support for a generic Linux userspace device driver interface is an excellent idea, both for technical reasons in the sense of introducing a boundary protecting the overall system from buggy userspace code, and for the purpose of advancing the cause of free software as a political benefit through the incremental improvement this technical interface allows in the free software marketplace.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198682/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor198697"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tainting</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 16:10 UTC (Thu)
                               by <b>feyd</b> (guest, #26860)
                              [<a href="/Articles/198697/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      There should be a way for the userspace driver to state its license and the kernel should be tainted if it is not GPL compatible.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198697/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor198850"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tainting</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 8, 2006 18:52 UTC (Fri)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/198850/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
There should be a way for the userspace driver to state its license and the kernel should be tainted if it is not GPL compatible.
</blockquote>
<p>
Toward what end?
<p>
The stated purpose of the existing taint flag is to warn a kernel engineer who might try to diagnose and fix a kernel problem that he doesn't have all the source code, so he might want to refuse.  But the system call interface is supposed to be a thick enough barrier that kernel engineers don't normally require source code for what's running on the other side of it in order to work on the kernel.

      
          <div class="CommentReplyButton">
            <form action="/Articles/198850/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor199231"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Tainting</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 12, 2006 19:08 UTC (Tue)
                               by <b>feyd</b> (guest, #26860)
                              [<a href="/Articles/199231/">Link</a>] 
      </p>
      
      </div>
      </summary>
      The userspace PCI driver can cause problems on PCI bus or memory corruption and thats hard to debug if the source is not available.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/199231/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor198723"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Support for drivers in user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2006 18:56 UTC (Thu)
                               by <b>mycroft</b> (guest, #40381)
                              [<a href="/Articles/198723/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Very interesting read.  You might also consider the other reasons for wanting a user level device driver (ULDD):<br>
<p>
  o Improved development time<br>
  o Fault isolation/recovery<br>
  o Isolation from the linux kernel may make it more<br>
    portable, especially if similar support can be made<br>
    to other OS's.<br>
<p>
In regards to handling interrupts.  Have you looked at Peter Chubb's<br>
work on the Gelato project (www.gelato.org) with ULDD's?  He has a<br>
good idea for handling interrupts from user mode.<br>
<p>
This interest in ULDD's is good to see as it is an area of<br>
interest for me.<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198723/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor198776"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">benefits of user space</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 8, 2006 3:11 UTC (Fri)
                               by <b>pjm</b> (guest, #2080)
                              [<a href="/Articles/198776/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Indeed: I'd have thought that one of the primary reasons for userspace drivers is for the greater fault isolation.  Many device drivers have noticeably lower quality code and tend to have more bugs per line of code than the rest of the kernel.  Moving to userspace (separate address space, more familiar programming environment) reduces the harm that can be done: buggy userspace device drivers can still bring down the system, but there's less opportunity for bugs to silently corrupt unrelated parts of memory (for example).<br>
<p>
(Device drivers tend to be written by people with knowledge of / access to the device in question, and are often not regular kernel developers.  The limited pool of people with access to a particular device means that fewer eyes pass over the code, and in particular that fewer exceptionally good programmers look at the code as some of the rest of Linux.)<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/198776/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor199458"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Power Management</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 14, 2006 6:08 UTC (Thu)
                               by <b>ringerc</b> (subscriber, #3071)
                              [<a href="/Articles/199458/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I just hope bus power management was carefully considered in this design - especially, as one poster mentioned, suspend and resume. It would be EXTREMELY frustrating to see a new PCI device driver API arrive without well thought out interfaces for consistent power managment, given that a new API is the perfect opportunity to introduce strong requirements on those issues.<br>
<p>
Given that everything from supercomputers to smartphones cares a lot about power managment these days, it'd be very silly not to plan for it.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/199458/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2006, Eklektix, Inc.<BR>
            
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
