        <!DOCTYPE html>
        <html lang="en">
        <head><title>On entropy and randomness [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/261804/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/261091/">Return to the Security page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/261804/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>On entropy and randomness</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>LWN.net needs you!</b>
<p>
Without subscribers, LWN would simply not exist.  Please consider
       <a href="/Promo/nst-nag2/subscribe">signing up for a subscription</a> and helping
       to keep LWN publishing.
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>December 12, 2007</br>
           </div>
<p>
Linux random number generation (RNG) is often a source
of confusion to developers, but it is also a very integral part of the
security of the system.  It provides random data to generate cryptographic
keys, TCP sequence numbers, and the like, so unpredictability as well as
very strong random numbers are required.  When someone notices a flaw, or
a possible flaw in the RNG, kernel hackers take notice.
</p>

<p>
Recurring universally unique identifiers (UUIDs), as reported by the <a
href="https://hosted.fedoraproject.org/projects/smolt/">smolt hardware
profiler</a> client program, had some worried about problems in the
kernel RNG.  As it turns out, the problem exists in
the interaction between Fedora 8 LiveCD installations and smolt &ndash;
essentially the UUID came from the CD &ndash; but it sparked a <a href="http://lwn.net/Articles/261871/">discussion
leading to some possible improvements</a>.  Along the way, some common
misconceptions about kernel RNG were cleared up. 
</p>

<p>
The kernel gathers information from external sources to provide input to
its entropy pool.  This pool contains bits that have extremely strong
random properties, so long as unpredictable events (inter-keypress timings,
mouse movements, disk interrupts, etc.) are sampled.  It provides direct
access to this pool via the <tt>/dev/random</tt> device.  Reading from that
device will provide the strongest random numbers that Linux can offer
&ndash; depleting the entropy pool.  When the entropy pool runs low,
reads to <tt>/dev/random</tt> block until there is sufficient entropy.
</p>

<p>
The alternative interface, the one that nearly all programs <i>should</i>
use, is <tt>/dev/urandom</tt>.  Reading from that device will not block.
If sufficient entropy is available, it will provide random numbers just as
strong as <tt>/dev/random</tt>, if not, it uses the SHA cryptographic hash
algorithm to generate very strong random numbers.  
Developers often overestimate how strong their random numbers need to be;
they also overestimate how easy "breaking" <tt>/dev/urandom</tt> would be,
which leads to programs that, unnecessarily, read <tt>/dev/random</tt>.  Ted
Ts'o, who wrote the kernel RNG, <a
href="http://lwn.net/Articles/261874/">puts it this way</a>:
<div class="BigQuote">
Past a certain point /dev/urandom will start returning results which
are cryptographically random.  At that point, you are depending on the
strength of the SHA hash algorithm, and actually being able to not
just to find hash collisions, but being able to trivially find all or
most possible pre-images for a particular SHA hash algorithm.  If that
were to happen, it's highly likely that all digital signatures and
openssh would be totally broken.
</div>
</p>

<p>
There is still a bit of hole in all of this: how does a freshly installed
system, with little or no user interaction, at least yet, get its initial
entropy?  When Alan Cox and Mike McGrath started describing the smolt
problem, the immediate reaction was to look closely at how the entropy pool
was being initialized.  While that turned out not to be the problem, it did
lead Matt Mackall, maintainer of the kernel RNG, to <a
href="http://lwn.net/Articles/261881/">start thinking about better pool
initialization</a>.  Various ideas about mixing in data specific to the
host, like MAC address and PCI device characteristics were discussed.
</p>

<p>
As Ts'o <a href="http://lwn.net/Articles/261886/">points out</a>, that will
help prevent things like UUID collisions, but it doesn't solve the problem
of predictability of the random numbers that will be generated by these
systems.  
<div class="BigQuote">
In order to do that we really do need to improve
the amount of hardware entropy we can mix into the system.  This is a
hard problem, but as more people are relying on these facilities, it's
something we need to think about quite a bit more!
</div>
</p>

<p>
Linux provides random numbers suitable for nearly any purpose via
<tt>/dev/urandom</tt>.  For the truly paranoid, there is also
<tt>/dev/random</tt>, but developers would do well to forget that device
exists for everything but the most critical needs.  If one is generating a
large key pair, to use for the next century, using some data from
<tt>/dev/random</tt> is probably right.  Anything with lower requirements
should seriously consider <tt>/dev/urandom</tt>.
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Random_numbers">Random numbers</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Linux_kernel-Random_number_generation">Linux kernel/Random number generation</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Random_number_generation">Random number generation</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/261804/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor261933"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">thermal noise?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2007 6:43 UTC (Thu)
                               by <b>nettings</b> (subscriber, #429)
                              [<a href="/Articles/261933/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
at least for machines equipped with a sound card or onboard sound interface (i.e. almost
everywhere, except some embedded or server machines), couldn't we just record some thermal
circuit noise and have 48k sufficiently random "pieces of entropy" per second to mix into
/dev/random?

</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/261933/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor261962"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">thermal noise?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2007 10:51 UTC (Thu)
                               by <b>ekj</b> (guest, #1524)
                              [<a href="/Articles/261962/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
There's plenty of randomness for 99.99% of all computers, the remaining ones can easily get
some hardware entropy-source, for example one based on the soundcard as you suggest.

/dev/urandom is actually a lot STRONGER than sha, because it does use whatever real entropy is
available, and while sometimes low enough that /dev/random would block, it is seldom -zero-.

Predicting the next number coming out of urandom is similar to predicting the next number
coming out of a scheme like this:

do:
   pool = sha(pool)
   output(pool[0])

Which would perhaps be doable if sha was severly broken. But there's an added complication:
Every once in a while, some -real- entropy from whatever source enters the pool via the rough
equivalent of:

pool = sha(pool xor real-random-data)

This should mess things up enough that -even- if sha is severly broken, predicting the
sequence is, essentailly, impossible.

Our editor is rigth: If you are generating a keypair to use for a decade, by all means, use
real randomness. If you are doing anything less, use urandom and forget about it.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/261962/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262114"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">offtopic</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2007 3:34 UTC (Fri)
                               by <b>ikm</b> (guest, #493)
                              [<a href="/Articles/262114/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
<font class="QuotedText">&gt; pool = sha(pool)</font>

I'm curious if there exists such a value of pool that the 'pool == sha(pool)' condition would
be true, effectively turning the rng's period to 0. What is the actual period of such a
generator, the one based on a sha hash? Is there some info to read about this? A proof that
the period is constant for any initial seed values, or a proof that it's not? Any pointers
would be greatly appreciated.

p.s. I understand that the external entropy would (eventually) shift the generator out of the
pit, but I am more concerned about what happens when there is no external entropy available,
on theoretical grounds.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262114/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262328"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">offtopic</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 16, 2007 21:54 UTC (Sun)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/262328/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
if pool == sha(pool) then the sha hash would be broken as there would be one situation where
knowing the output would tell you what the input was.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262328/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262397"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">offtopic</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 17, 2007 19:09 UTC (Mon)
                               by <b>ikm</b> (guest, #493)
                              [<a href="/Articles/262397/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
You're joking, right? Here's another situation for you:

6768033e216468247bd031a0a2d9876d79818f8f == sha( 0000000000000000000000000000000000000000 )

Here, knowing the output (6768..8f8f) tells us what the input was (00000..0000)! There are
2^160 situations like this, not just one or two. As long as the only way to know the input for
some particular output is to try all the inputs, the hash is not broken. What difference would
it make if some unique value would both be the argument and the result? I fail to see any.

As far as I understand, no one has ever stated that a crypto hash may never produce the same
output value as its input value. That's why I was asking in the first place.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262397/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262477"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">offtopic</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2007 3:18 UTC (Tue)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/262477/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
every hash function I am aware of involves doing many iterations of the same funtion, mixing
the output back into the input for the next stage.

in fact, the only difference between sha1 and sha256 are the number of iterations (as I
understand it anyway)

if you ever have a hash produce it's input as it's output you end up in a loop where
additional iterations will always produce the same output.

I was incorrect before when I said the problem was knowing the input that caused the output.
the fact that multiple inputs produce the same output prevents that knowledge from being
useful (expect in the case where the input is small enough that you can enumerate all of them
to produce a rainbow table that you can use in that specific situation)
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262477/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262479"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">offtopic</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2007 4:10 UTC (Tue)
                               by <b>ikm</b> (guest, #493)
                              [<a href="/Articles/262479/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      Well, I personally have no idea how hashes work. As long as they comply with the usual requirements (i.e. resistance to reversion and collision-finding), I'm quite happy. What I am concerned about is their use as RNGs, as I can't google out any papers on how mathematically correct it is to feed a hash output to its input to build an RNG. What would be the period? Does it depend on the seed supplied? The aforementioned requirements for hashes don't allow any conclusions to be drawn on these questions. Hashes are simply designed for a different purpose. While using a hash to compress the resulting entropy from another source is probably ok (as I doubt it would make it less random than it was), looping it to itself seems questionable to me. E.g., consider an example RNG, for instance, a very simple Marsaglia's SHR3. It has a period of exactly 2^32-1, which means that it iterates through all numbers within [1..2^32-1] in some random order. You can use any value to seed it other than 0, and it would still have an exact same period (and a value of zero would make it always produce zeroes). Usually RNGs have these properties well understood. Did anyone make a research on SHA1 in that regard? I don't know and I would want to know. Not that all this stuff matters in real life, but still it's interesting.
<p>
p.s. While I can't make google find any real stuff, I found posts of other people concerned with the same question, e.g. <a href="http://mail.python.org/pipermail/python-list/2003-March/194684.html">this thread.</a> Someone there made statistical conclusions on the period based solely on the hash length, but that's statistical, while the algorithms are deterministic and not too perfect.
      
          <div class="CommentReplyButton">
            <form action="/Articles/262479/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262492"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">offtopic</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2007 15:11 UTC (Tue)
                               by <b>njs</b> (guest, #40338)
                              [<a href="/Articles/262492/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
Okay, seriously, last crypto tutorial comment from me for a while, I swear...

There's a lot of research of how you generate good cryptographic PRNGs.  Some approaches use
hashes, some don't.  The analysis in general is utterly different from the analysis of
scientific PRNGs, for the natural reason that you don't care so much about having provably
insane period and provably insane equidistribution requirements; but you do care a huge amount
about e.g. making sure that the internal state remains secret even when people can observe the
PRNG's output, and that even if current state *were* revealed that this would not let you "run
the PRNG backwards" and work out what earlier states were, and that you are clever about how
you mix in new entropy from whatever external sources.  Of course, you'd *like* a provably
insane period too (to the extent that "period" is even meaningful when you are mixing in
entropy as you go), but it's very hard to get an algorithm that resists all cryptographic
analysis, *but* is still amenable to period analysis...

Random posts on python-list are, unfortunately, pretty useless for grokking this stuff.  If
you really are curious to learn how CPRNGs are designed, one convenient place to start might
be Schneier's various online-accessible writings on the subject:
  <a href="http://www.schneier.com/paper-prngs.html">http://www.schneier.com/paper-prngs.html</a>
  <a href="http://www.schneier.com/paper-yarrow.html">http://www.schneier.com/paper-yarrow.html</a>
  <a href="http://www.schneier.com/blog/archives/2007/11/the_strange_sto.html">http://www.schneier.com/blog/archives/2007/11/the_strange...</a>
(Yarrow in particular is a fun and interesting algorithm, though no longer quite considered
state of the art.  The last link is awesome for anyone who enjoys some geeky conspiracy, and
has lots more links.)
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262492/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262602"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">offtopic</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 19, 2007 3:39 UTC (Wed)
                               by <b>ikm</b> (guest, #493)
                              [<a href="/Articles/262602/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
Yay! Thanks. You're right -- I've never thought too much about the use of RNGs outside
Monte-Carlos and such, and the properties you've mentioned can mean a lot more than typical
equidistribution/period requirements in other contexts indeed.

I'll go dig the links you've provided. Thanks again, your help is much appreciated.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262602/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262611"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">offtopic</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2007 17:57 UTC (Thu)
                               by <b>njs</b> (guest, #40338)
                              [<a href="/Articles/262611/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
Cool, glad to help.  Have fun!

(If you really want to get into this, I also highly recommend Ferguson and Schneier's
/Practical Cryptography/.  /Applied Cryptography/ is better known, but it's all like "so in
RSA you use modular arithmetic on primes in the following way" while /Practical Cryptography/
is all like "so if for some reason you want to reinvent SSL, here are the design trade-offs
you have to decide about, and here are the subtle bugs you're going to put in that will break
everything".)

</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262611/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor262481"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">offtopic</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2007 14:43 UTC (Tue)
                               by <b>njs</b> (guest, #40338)
                              [<a href="/Articles/262481/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
<font class="QuotedText">&gt;in fact, the only difference between sha1 and sha256 are the number of iterations (as I
understand it anyway)</font>

No -- SHA-1 has quite a different design from the SHA-2 family (which includes SHA-224,
SHA-256, SHA-384, and SHA-512).  In fact, SHA-256/224 have fewer rounds than SHA-1.  Not that
this matters to anyone except real cryptography geeks, but hey, in case you were curious.

Except, of course, that it's why the recent attacks against SHA-1 haven't generalized to SHA-2
yet (though the increased bit-length would probably protect them anyway).  It is unclear to
what extent this is coincidence and to what extent it is NSA Sneakiness.

<font class="QuotedText">&gt;if you ever have a hash produce its input as its output you end up in a loop where additional
iterations will always produce the same output.</font>

True (at least for the simplest hash-based CPRNG design), but I'm pretty sure no-one has ever
found such a input/output pair, and finding one is very similar to accomplishing a preimage
attack, so I wouldn't worry about it much in practice.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262481/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor262001"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">thermal noise?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2007 14:08 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/262001/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
The thermal circuit noise isn't as random as all that: it gets interference from system
circuitry, which is regular as anything.

It could certainly contribute some randomness, I'd think, but nowhere near as much as 48kbits.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262001/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262007"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">thermal noise?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2007 14:26 UTC (Thu)
                               by <b>NRArnot</b> (subscriber, #3033)
                              [<a href="/Articles/262007/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
48K samples/second, each 16 bits, of which the least significant should be random regardless
of how much patterned noise is being picked up from the system's innards. In practice one
would run some verification tests first. One wouldn't be relying on it being a truly random
bitstream, just on it containing a reasonable amount of entropy.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262007/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262032"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">thermal noise?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2007 16:49 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/262032/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
I've tried it; you don't get anywhere near that much entropy. Quite a lot of it is strongly
correlated, at least with cheap sound cards, even at the least significant bits.

I wish this wasn't true, but it is :/ or at least it was in 2003, when I last looked at it (I
still don't have any sound cards newer than that: I'm not made of money and the newer cards
don't offer anything I can use. I don't have enough speakers or a suitably-shaped room for
surround-sound...)
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262032/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor262118"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">thermal noise?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2007 6:02 UTC (Fri)
                               by <b>bronson</b> (subscriber, #4806)
                              [<a href="/Articles/262118/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
Electrical engineers learn to become deeply fearful of harmonics.  They show up everywhere!
Thanks to this, (the harmonics, not the fear), I think you'll find that /dev/urandom offers far
more random data than anything arriving over cheap hardware.

Well, unless that hardware was explicitly designed to avoid harmonics, like the transistor
noise RNG on some of Via's chips.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262118/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor263145"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">thermal noise?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 25, 2007 12:15 UTC (Tue)
                               by <b>flok</b> (subscriber, #17768)
                              [<a href="/Articles/263145/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
What about installing either audio-entropyd or video-entropyd? For the first one every cheap
soundcard will do nicely.
<a rel="nofollow" href="http://www.vanheusden.com/aed/">http://www.vanheusden.com/aed/</a> and <a rel="nofollow" href="http://www.vanheusden.com/ved/">http://www.vanheusden.com/ved/</a>
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/263145/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor261944"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">On entropy and randomness</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2007 8:32 UTC (Thu)
                               by <b>jimbo</b> (subscriber, #6689)
                              [<a href="/Articles/261944/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <p>As a lot of Linux distributions download packages, why 
not provide a dynamically-generated package that contains seeding data 
from the package server's own entropy pool? 
</p>
<p>With all the disk and network activity on a busy package server [I 
suppose that we can't rely on keyboard and mouse event timings as entropy 
sources on a server<tt>:-)</tt>], there should be a rich source of pool 
data there.
</p>
<tt>--</tt><br/>
Jimbo<br/>
<p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/261944/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor261985"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">On entropy and randomness</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2007 12:58 UTC (Thu)
                               by <b>brother_rat</b> (subscriber, #1895)
                              [<a href="/Articles/261985/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
For the same reason that using things like a MAC address is a bad idea. You really want to be
sure the data from /dev/urandom is not only random but secret too. There are services such as
<a href="http://www.random.org/">http://www.random.org/</a> that provide really random numbers, but they are aimed at scientific
and statistical applications rather than cryptographic uses.

Also the original problem relates to randomness available to an installer, where I'm sure the
network is unconfigured.


</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/261985/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262052"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">On entropy and randomness</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2007 18:47 UTC (Thu)
                               by <b>cpeterso</b> (guest, #305)
                              [<a href="/Articles/262052/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
What if you had a random.org-like service with a *shared* internet-wide entropy pool, where
users could *upload* entropy? Sure there would be griefers uploading continuous streams of
non-random data (e.g. 00000000000000000000000000000000000...) to be mixed into the public
entropy pool. But isn't the number and actions of an "internet-ful"  of griefers also
unpredictable (and thus increasing entropy)? :)
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262052/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor262054"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">On entropy and randomness</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2007 19:01 UTC (Thu)
                               by <b>adamgundy</b> (subscriber, #5418)
                              [<a href="/Articles/262054/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
we've hit this problem at the company I work for with cyrus-popd, depleting the entropy pool
and hanging due to a bunch of SSL connections. 

the 'nasty' solution was to install the 'rngd' daemon pointed at /dev/urandom as it's data
source.. this essentially loops data back from urandom into the 'real' random pool when its
entropy level gets low. the quality of the random numbers is obviously reduced, but it seems
to work well..

I suspect many SSL using servers out there hit this issue more frequently than they realize -
once we'd spotted it on one server we realized others (openvpn, https) etc were also
occasionally blocked on /dev/random for no good reason...

</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262054/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262113"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">On entropy and randomness</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2007 2:06 UTC (Fri)
                               by <b>cpeterso</b> (guest, #305)
                              [<a href="/Articles/262113/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
Servers can easily be starved for entropy since they don't get many keyboard, mouse, or disk
interrupts. I think there are some kernel patches or optional build configs to feed network
I/O into the entropy pool, but I think this is off by default because of tinfoil hats.

</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262113/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262138"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">On entropy and randomness</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2007 15:24 UTC (Fri)
                               by <b>adamgundy</b> (subscriber, #5418)
                              [<a href="/Articles/262138/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
yeah, we've seen those. the problem is that we intentionally try to stick with the distrib
kernel so we don't end up recompiling kernels every time there's a new security patch...

the alternatives are to compile our own cyrus with the magic flag telling it to use
/dev/urandom (same problem as above, plus we'd have to recompile apache, openvpn, ...), or
hack on udev to make it create a /dev/random which is actually /dev/urandom... couldn't
convince udev to do that reliably though.

rngd seems to do the trick as a userspace workaround. it's main purpose is supposed to be
pulling entropy from hardware addons, but it seems to be pretty common to use it the way we do
too.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262138/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262171"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">On entropy and randomness</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2007 20:18 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/262171/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
KERNEL=="urandom", NAME="random"

(or SYMLINK, if you prefer)

should do the trick, I'd expect.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262171/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262181"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">On entropy and randomness</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2007 21:34 UTC (Fri)
                               by <b>adamgundy</b> (subscriber, #5418)
                              [<a href="/Articles/262181/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
pretty sure we tried something like that.. sometimes it would work, sometimes not (timing?)

I forget exactly the issue with udev, we just couldn't convince it to do what we wanted and
rngd worked out of the box.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262181/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor262140"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">On entropy and randomness</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2007 15:56 UTC (Fri)
                               by <b>TRS-80</b> (guest, #1804)
                              [<a href="/Articles/262140/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Recent server chipsets include hardware entropy sources, which rng-tools will feed into /dev/random.
      
          <div class="CommentReplyButton">
            <form action="/Articles/262140/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor262115"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">On entropy and randomness</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2007 4:06 UTC (Fri)
                               by <b>ikm</b> (guest, #493)
                              [<a href="/Articles/262115/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
<font class="QuotedText">&gt; If one is generating a large key pair, to use for the next century, using some data from
/dev/random is probably right.</font>

Much concern should be put when using so-called 'real' random data. Unlike particular PRNG
algorithms, whose random properties are usually well studied and known, the so-called
'physical sources of real randomness' might easily exhibit certain non-random properties,
since the actual properties of such sources, being dependent on numbers of factors (physical,
temporal, spatial etc), are much more obscure than that of the deterministic RNGs. This was
e.g. shown by George Marsaglia when he was trying out several Johnson noise based TRNGs while
preparing his random-data CDROM. To get the best result, it is usually best to mix the 'real
random data' with an output of some good deterministic PRNG. The result won't get less random
than it was (assuming, of course, that TRNG and PRNG outputs did not correlate, which would be
quite a straightforward assumption). But assuming the worst has happened and the TRNG was
indeed flaky, this can really save the day, since the output would still be quite as perfect,
better than of any of the sources if they were used separately.

I can only hope that /dev/random does exactly that (since, yes, I'm too lazy to check the
source), but if not, I personally wouldn't trust its output as much as it is hyped to be.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262115/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor262119"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">On entropy and randomness</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2007 7:29 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/262119/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
/dev/random does indeed do exactly that.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262119/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor262175"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">On entropy and randomness</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2007 20:25 UTC (Fri)
                               by <b>zooko</b> (guest, #2589)
                              [<a href="/Articles/262175/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
Consider also the issues of crash and restart, and of your machine actually being virtual
(although your code, of course, can't necessarily tell if the machine is virtual):

<a href="http://www1.ietf.org/mail-archive/web/cfrg/current/msg01352.html">http://www1.ietf.org/mail-archive/web/cfrg/current/msg013...</a>


</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/262175/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2007, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
