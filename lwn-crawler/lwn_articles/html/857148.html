        <!DOCTYPE html>
        <html lang="en">
        <head><title>printk() indexing [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/857148/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/857463/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/857148/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>printk() indexing</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>LWN.net needs you!</b>
<p>
Without subscribers, LWN would simply not exist.  Please consider
       <a href="/Promo/nst-nag2/subscribe">signing up for a subscription</a> and helping
       to keep LWN publishing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>May 27, 2021</br>
           </div>
When kernel developers want to communicate something about the state of a
running kernel, they tend to use <tt>printk()</tt>; that results in a log
entry that is intended — with varying success — to be human-readable.  As it
happens, though, the
consumers of that information are often not human; the kernel's log output
is also read by automated monitoring systems that are looking for
problems.  The result is an impedance mismatch that often ends with the
monitoring system missing important messages.  The <a
href="/ml/linux-kernel/cover.1621338324.git.chris@chrisdown.name/"><tt>printk()</tt>
format indexing patch set</a> is the latest of many attempts to improve
this situation.
<p>
Monitoring systems are installed by administrators who want to know when
there is a problem with the systems they manage.  So, for example, if the
CPU bursts into flames, and the administrator doesn't happen to be in the
room to witness the event, they would at least like to receive an alert
telling them to call their hardware vendor and the fire department,
probably in that order.  To produce this alert, the monitoring system will
be watching the kernel log for the "CPU on fire" message printed by <a
href="https://elixir.bootlin.com/linux/v5.12.6/source/arch/x86/kernel/cpu/mce/p5.c#L23">the
relevant code</a> in the kernel.  If all goes well, the message will escape
before the CPU melts and the replacement system can be ordered in a timely
manner.
<p>
Then, one day, along comes a well-meaning contributor of trivial patches
who decides that the message would be more aesthetically pleasing if it
read "CPU in flames" instead.  The resulting patch will be duly merged by
the maintainer after a rigorous review process and shipped in a stable
kernel update; the administrator, upon
seeing the improved message, will be overcome by the beauty of the kernel's
expression.
<p>
But that will only happen <i>if</i> the administrator sees this message.
Unfortunately, the monitoring system is still looking for the old "CPU on
fire" message; it is not only unmoved by the new phrasing, but it also
misses the message entirely.  So no alarm is sent, and the administrator
continues the background project of testing the latency of a favorite
social-networking site until the sprinklers go off and make a huge mess.
By then it is too late in the day to order a replacement system and the
service goes down.
<p>
System administrators hate it when that happens.
<p>
The problem is that, while messages emitted by way of <tt>printk()</tt> (and
all the functions layered on top of it) are consumed by user-space tools,
those messages have never really been considered to be a part of the
kernel's ABI, so 
kernel developers feel free to change (or delete) them at any time.   That
creates trouble for anybody who has created a massive collection of regular
expressions meant to detect the messages of interest; it also thwarts any
effort at translating messages into other languages.
<p>
There have been many attempts to address this problem over the years.  The
2011 Kernel Summit featured <a href="/Articles/464276/">a combative
session</a> around a proposal to add a 128-bit binary tag to every kernel
message.  That idea, like all others before and after, failed to get
anywhere near the mainline.  The kernel community has, quite simply, never
felt the need to impose any structure on the logging information it puts
out via <tt>printk()</tt>; the additional effort that would be required does
not seem to be worth the cost.
<p>
The latest proposal, posted by Chris Down, does not attempt to impose any
such structure.  Instead, it simply collects every <tt>printk()</tt> format
string built into the kernel and makes them all available via a file in
debugfs.  Specifically, <tt>printk()</tt> becomes a wrapper macro that
declares a new structure to hold the format information:
<p>
<pre>
    struct pi_entry {
	const char *fmt;
	const char *func;
	const char *file;
	unsigned int line;
	const char *level;
	const char *pre_fmt;
	const char *post_fmt;
    };
</pre>
<p>
This structure holds the format string passed to <tt>printk()</tt>, along
with the log level, information on where in the source this call is to be
found, and "pre" and "post" data that is added by various wrappers (such as
the <tt>dev_printk()</tt> functions).  This structure is placed into a
special section (<tt>.printk_index</tt>) of the built kernel.  The wrapper
also calls the original <tt>printk()</tt> — now called <tt>_printk()</tt> —
to output the message, of course.
<p>
When the kernel is built, all of those <tt>pi_entry</tt> structures are
placed together in the <tt>.printk_index</tt> section.  After mounting
debugfs, the administrator can look at <tt>printk/index/vmlinux</tt>, which
contains the entire set of formats; there are also files under
<tt>printk/index</tt> for each loadable module.  Paging through these files,
which will contain thousands of format strings, is likely to be almost as
interesting as the administrator's social-media feed, but that is not
really the intended use.  Instead, monitoring systems can use this
information to make
sure that all of their tests still match messages that the kernel will
actually emit.  If the "CPU on fire" test no longer finds a match, then
either the CPU has been rendered fireproof or the message has been
changed.  Should the latter prove to be the case, the test can be updated
accordingly.
<p>
There are a couple of interesting questions that have not, as of this
writing, been raised in the minimal review that this patch set has seen.
The first would be: why does this information need to be built into the
kernel?  It could be placed into a separate file that would not require
memory on a running system.  The answer, perhaps, is that this mechanism
makes it easy to keep the correct set of format strings with the kernel as
it is deployed across systems.
<p>
The other is that debugfs is explicitly not meant for production systems,
but this feature looks like it is meant to be used with production
kernels.  Should this mechanism be accepted into the mainline, it may have
to find a home in a more stable setting, such as <tt>/sys</tt>.
<p>
Whether it will be accepted remains to be seen, though.  Since this
mechanism does not require any additional effort from kernel developers,
and since it imposes no cost when it is turned off, it might encounter less
resistance than the previous efforts to ease automated parsing of kernel
log messages.  If so, monitoring systems will not be shielded from changing
kernel log messages, but they will at least know when their tests need
updating.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Messages">Messages</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#printk">printk()</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/857148/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor857489"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 27, 2021 15:50 UTC (Thu)
                               by <b>dullfire</b> (guest, #111432)
                              [<a href="/Articles/857489/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; There are a couple of interesting questions that have not, as of this writing, been raised in the minimal review that this patch set has seen. The first would be: why does this information need to be built into the kernel? It could be placed into a separate file that would not require memory on a running system. The answer, perhaps, is that this mechanism makes it easy to keep the correct set of format strings with the kernel as it is deployed across systems. </font><br>
<p>
<p>
Hmmm... this could probably be... a kernel module. as long as the kernel module loader need to keep modules .printk_index section around (possibly a cmdline  option to turn on/off), the bulk data could be relegated to a module that&#x27;s only load if when needed<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857489/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857530"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 28, 2021 5:31 UTC (Fri)
                               by <b>dxin</b> (guest, #136611)
                              [<a href="/Articles/857530/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don&#x27;t think it&#x27;s a big issue. There has been efforts to build the entire UAPI kernel header into the kernel before this. <a href="https://lwn.net/Articles/783578/">https://lwn.net/Articles/783578/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857530/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor857491"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 27, 2021 16:15 UTC (Thu)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/857491/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The first would be: why does this information need to be built into the kernel? It could be placed into a separate file that would not require memory on a running system.</font><br>
<p>
One reason would be that containerization could then be broken if the contained filesystem image doesn&#x27;t forward this file into the container.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857491/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor857527"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 28, 2021 4:09 UTC (Fri)
                               by <b>dxin</b> (guest, #136611)
                              [<a href="/Articles/857527/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
CPU hotplug is the best invention since sliced bread.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857527/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor874502"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 1, 2021 4:57 UTC (Mon)
                               by <b>developer122</b> (guest, #152928)
                              [<a href="/Articles/874502/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Now I&#x27;m just imagining the server ejecting a little square CPU module (complete with fan), and the little flaming brick skittering across the linoleum floor.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/874502/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor857528"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 28, 2021 4:18 UTC (Fri)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/857528/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is very similar and possibly inspired by the concept of a message catalog / dictionary which is common in embedded systems for a different reason: saving memory.<br>
<p>
<a href="https://en.wikipedia.org/wiki/MIPI_Debug_Architecture">https://en.wikipedia.org/wiki/MIPI_Debug_Architecture</a> -&gt; System Software Trace (Sys-T)<br>
<a href="https://github.com/zephyrproject-rtos/zephyr/pull/30539">https://github.com/zephyrproject-rtos/zephyr/pull/30539</a><br>
Etc.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857528/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857532"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 28, 2021 8:22 UTC (Fri)
                               by <b>PengZheng</b> (subscriber, #108006)
                              [<a href="/Articles/857532/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thank you for the insightful comments.<br>
I learned a lesson.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857532/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor857616"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 28, 2021 20:16 UTC (Fri)
                               by <b>shemminger</b> (subscriber, #5739)
                              [<a href="/Articles/857616/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is often done to provide native language support as well.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857616/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor857864"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 1, 2021 21:16 UTC (Tue)
                               by <b>riking</b> (subscriber, #95706)
                              [<a href="/Articles/857864/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Defmt for Rust is another similar project, that performs compile-time macros to get complete indexing of strings.<br>
https://ferrous-systems.com/blog/gdb-and-defmt/<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857864/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor857534"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 28, 2021 8:32 UTC (Fri)
                               by <b>professor</b> (subscriber, #63325)
                              [<a href="/Articles/857534/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
On IBM z/OS there is a message prefix assigned for each subsystem (IEA for example could be the most &quot;kernel like&quot;) and then there is also a pre-defined suffix for each record written, the text in the message could be subject for change but automation does not care since it relies on the message prefix+suffix.<br>
<p>
Works nice i think<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857534/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857650"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 29, 2021 19:04 UTC (Sat)
                               by <b>ejr</b> (subscriber, #51652)
                              [<a href="/Articles/857650/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Heh, and then you pull the right volume of the Principles of Operation off the shelf...  Unless you have the codes memorized.  Am I dating myself?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857650/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857693"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2021 11:06 UTC (Mon)
                               by <b>professor</b> (subscriber, #63325)
                              [<a href="/Articles/857693/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
oh yes! And we still have the volumes on the shelf but we stopped looking in them since the dawn of Internet<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857693/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor857691"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2021 10:48 UTC (Mon)
                               by <b>eru</b> (subscriber, #2753)
                              [<a href="/Articles/857691/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
VAX/VMS (later OpenVMS) did something similar: each message is prefixed by a subsystem name, error level, and abbreviation for the message, followed by text meant for humans. Something like:<br>
<p>
%CPU-E-COMBST, CPU is in flames<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857691/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857694"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2021 11:24 UTC (Mon)
                               by <b>professor</b> (subscriber, #63325)
                              [<a href="/Articles/857694/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I remember when OpenVMS was introduced as the z/OS replacement.. stealing all the good parts (and doing some other things better, shadow set for example makes my storage endorphins rush)<br>
<p>
//NO JCL<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857694/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor858260"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 4, 2021 2:09 UTC (Fri)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/858260/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      That method (message numbers) is what the article refers to as the multiple previous attempts to fix this problem, which have always been rejected.
      
          <div class="CommentReplyButton">
            <form action="/Articles/858260/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor874503"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 1, 2021 4:58 UTC (Mon)
                               by <b>developer122</b> (guest, #152928)
                              [<a href="/Articles/874503/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It&#x27;s painful to accept if you haven&#x27;t been doing it from the beginning.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/874503/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor857538"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 28, 2021 13:25 UTC (Fri)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/857538/">Link</a>] (24 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This… is actually a really good idea, of the sort other software should be looking to steal.<br>
<p>
The article jokes about it, but being able to browse through a list of potential output strings sounds like it&#x27;d be a great learning tool for the curious.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857538/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857604"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 28, 2021 18:24 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/857604/">Link</a>] (22 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  This… is actually a really good idea, of the sort other software should be looking to steal.</font><br>
That&#x27;s basically how GNU gettext works.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857604/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857617"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 28, 2021 21:54 UTC (Fri)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/857617/">Link</a>] (21 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wrote some software with gettext support (in PHP of all things) in the mid-2000s, and you&#x27;re right. It&#x27;s a shame it seems to have fallen out of fashion.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857617/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857624"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 28, 2021 22:24 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/857624/">Link</a>] (20 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah. gettext() is the best way to do message i18n, but for some reason this whole approach got forgotten.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857624/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857627"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 29, 2021 2:43 UTC (Sat)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/857627/">Link</a>] (19 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I hear Mozilla&#x27;s Project Fluent provides a better option to do i18n than gettext:<br>
<p>
<a href="https://projectfluent.org/">https://projectfluent.org/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857627/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857628"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 29, 2021 2:55 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/857628/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I dislike it. <br>
<p>
The main feature of gettext() is that your messages are right in the source code. You don&#x27;t have to invent names and then put the messages into a separate file. This makes the l10n much easier to get into, just put T() around the text and you&#x27;re done. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857628/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857629"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 29, 2021 3:08 UTC (Sat)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/857629/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That aspect is definitely more convenient for English-speaking developers, but it sounds like Fluent&#x27;s approach results in better outcomes for people viewing the translations?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857629/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857630"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 29, 2021 3:17 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/857630/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not really. gettext supports the same features: multiple plural forms, inflections, etc. In much the same way as Fluent, actually. I&#x27;m a native Russian speaker, so I&#x27;ve actually encountered most of the translation-based complications.<br>
<p>
See here: <a href="https://www.gnu.org/software/gettext/manual/html_node/Translating-plural-forms.html#Translating-plural-forms">https://www.gnu.org/software/gettext/manual/html_node/Tra...</a> <br>
<p>
gettext definitely shows its age, the PO files are poorly designed, the toolchain is somewhat clunky, etc. You can just feel that it&#x27;s software from 90-s. But the core feature of NOT externalizing the messages is still genius.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857630/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor857639"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 29, 2021 11:12 UTC (Sat)
                               by <b>mpr22</b> (subscriber, #60784)
                              [<a href="/Articles/857639/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The main feature of gettext() is that your messages are right in the source code.</font><br>
<p>
I hate that and refuse to use gettext() in the idiomatic manner recommended by the authors of its documentation.<br>
<p>
(I hate having to rebuild just because I changed the text of a message that isn&#x27;t being machine-parsed.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857639/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor857665"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2021 15:35 UTC (Sun)
                               by <b>Jandar</b> (subscriber, #85683)
                              [<a href="/Articles/857665/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The main feature of gettext() is that your messages are right in the source code</font><br>
<p>
In my eye this is the worst feature of gettext. As this message string is essentially a key into the translation database it has to stay the same. You want to fix a typo, not possible in the source code. Now there a two places to look for the real output string. Any gettext message you have to look up in the po file to see if there is a changed version. While the source code *looks* like a real message it may be an output string or may be not. Worst design ever.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857665/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857666"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2021 17:00 UTC (Sun)
                               by <b>madscientist</b> (subscriber, #16861)
                              [<a href="/Articles/857666/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      Gettext is the best design.  Being allowed to keep the same key but change the text is terrible.  It's much better to have a <i>correct</i> output message even if it's in a different language, than it is to have a <i>wrong</i> output message in the expected language.
<p>
The FOSS software I maintain uses the translation project and has 30 translations.  It's totally infeasible for me to coordinate (read: wait for) all those translations to be updated by 30 different translation teams, some of whom are just one person with limited time.
<p>
It's also better to be able to print <i>some</i> message than just some random error code, if somehow the translation catalog is lost.
<p>
These days, with the internet, it's straightforward enough to translate messages on your own which were not translated automatically for some reason.
      
          <div class="CommentReplyButton">
            <form action="/Articles/857666/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857671"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2021 18:27 UTC (Sun)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/857671/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What prevents having a list of fallback languages if the preferred one doesn&#x27;t have it in the key-lookup-for-all-languages? For example, pt_PT -&gt; pt_BR -&gt; en_US (having &quot;everything&quot;).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857671/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857673"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2021 20:11 UTC (Sun)
                               by <b>madscientist</b> (subscriber, #16861)
                              [<a href="/Articles/857673/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Nothing at all.  It&#x27;s even already implemented ... if you&#x27;re using GNU gettext.<br>
<p>
See <a href="https://www.gnu.org/software/gettext/manual/html_node/The-LANGUAGE-variable.html">https://www.gnu.org/software/gettext/manual/html_node/The...</a><br>
<p>
I&#x27;m not sure I see how this relates to my comment though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857673/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857674"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2021 20:17 UTC (Sun)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/857674/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Gah, I was thinking about it backwards. I now see what you mean. Since the key is the &quot;default text&quot;, if it changes, the translations automatically need changed as well. Versus where the key is some ID where if the default text is updated, the other translations need some marker to indicate that they need to sync up.<br>
<p>
It&#x27;s not an easy problem. How does Gettext deal with text which is spelled the same but has different meanings depending on context? Let&#x27;s say there&#x27;s a button with the text &quot;Bark&quot; on it. How is it indicated that one wants &quot;dog bark&quot;, &quot;bark a shin&quot;, or &quot;tree bark&quot; with the default text as a key? I assume there is some way to plumb some kind of intent message through to the interface translators use?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857674/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857675"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2021 21:17 UTC (Sun)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/857675/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You can just put Bark(Tree) in the message and provide translation for English.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857675/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857776"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 1, 2021 13:28 UTC (Tue)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/857776/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;ve even proposed that as good practice somewhere before. Just in case people need more selling on the idea:<br>
<p>
The source code naturally contains LC_MESSAGES=C strings; those don&#x27;t need to be written for anyone but the author and can shamelessly be optimised for high jargon density and minimum mental context switching. It gives a motive to write a human translation later, and even if that&#x27;s just en_US with few changes you&#x27;ve now made a map of the terrain for anyone else to work with. There&#x27;s a long tail of other benefits besides (such as, the one I started the thread with).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857776/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor857676"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2021 21:27 UTC (Sun)
                               by <b>mbunkus</b> (subscriber, #87248)
                              [<a href="/Articles/857676/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The gettext system knows a concept called &quot;Contexts&quot;. This is basically a second parameter for the translation functions that works as a disambiguation. You&#x27;d have calls to &#x27;pgettext(&quot;dog&quot;, &quot;bark&quot;)&#x27; and &#x27;pgettext(&quot;tree&quot;, &quot;bark&quot;)&#x27;, and both would show up in PO files as two separate entries to translate. How you name contexts is totally up to you.<br>
<p>
Contexts are optional. The most basic function, &#x27;gettext(&quot;bark&quot;)&#x27;, works without a context.<br>
<p>
See here for more details: <a href="https://www.gnu.org/software/gettext/manual/html_node/Contexts.html">https://www.gnu.org/software/gettext/manual/html_node/Con...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857676/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857695"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2021 12:30 UTC (Mon)
                               by <b>eru</b> (subscriber, #2753)
                              [<a href="/Articles/857695/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That requires original authors to use contexts assiduously, because they may not even be aware when a translation depends on it. In Microsoft&#x27;s web mail, the English word &quot;Empty&quot; was used in two senses (something is empty, or as a command to empty a folder). The Finnish localisation seemed to have been made with a simple string substitution, and used a word that was appropriate only for the first meaning. (This has since been fixed).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857695/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857702"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2021 14:09 UTC (Mon)
                               by <b>mbunkus</b> (subscriber, #87248)
                              [<a href="/Articles/857702/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah sure, but good knowledge about the pitfalls of translation (or in general: localization) is always required for good translations. The question I answered was &quot;how does gettext deal with terms that have different meanings in different contexts&quot;, and in order to solve this in any way, shape or form, requires awareness of the possibility of different meanings. No matter the translation system in use.<br>
<p>
Systems that use symbols instead of real text in the source files also require the author to have that awareness so that the author can use two different symbols in different places, even if both symbols&#x27; corresponding text in the original language is the same.<br>
<p>
Localization is a complex topic. You cannot magic complexity away. All systems add to that complexity in certain ways, some more than others. Some systems only seem to do away with part of the complexity, but at the cost of flexibility and expressiveness, leading to awkward or wrong translations.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857702/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor857759"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2021 18:07 UTC (Mon)
                               by <b>madscientist</b> (subscriber, #16861)
                              [<a href="/Articles/857759/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Localization / internationalization is hard, there&#x27;s no doubt about it.  Successful i18n is an ongoing conversation between the code maintainer and the translator about what is needed vs. what is feasible.<br>
<p>
There&#x27;s no way every maintainer can know enough about all the different languages and their needs to get everything right the first time; that&#x27;s not the goal.  The maintainer&#x27;s responsibility is to be receptive to the issues raised by the translator to make their job easier and a good translation possible.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857759/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor857677"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2021 21:58 UTC (Sun)
                               by <b>madscientist</b> (subscriber, #16861)
                              [<a href="/Articles/857677/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thinking about this I&#x27;m not sure this variable actually does what you (and I!) were hoping though.  I haven&#x27;t tried it and the documentation is not clear enough.<br>
<p>
What I was hoping is that this list is consulted on a per-message basis, so that if a given message was not available in one language it would fall back to another.  But maybe this is not the case: maybe it will open only the first catalog of your preferred languages that exist, then stop.<br>
<p>
So if the preferred catalog exists but is missing some messages, then you&#x27;ll get the default message (whatever is printed in the &quot;C&quot; locale) not the fallback.<br>
<p>
I could be wrong: I didn&#x27;t test it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857677/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor857672"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2021 19:48 UTC (Sun)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/857672/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
gettext supports fuzzy matching, so a small typo is not a problem. I also remember a tool that looked at PO files and automatically tried to update the strings for these kinds of changes.<br>
<p>
It&#x27;s not at all different from making a typo in the message name.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857672/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857681"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2021 2:15 UTC (Mon)
                               by <b>Gaelan</b> (guest, #145108)
                              [<a href="/Articles/857681/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That seems dangerous. If I change &quot;CPU status: fine&quot; to &quot;CPU status: fire&quot;, I certainly don&#x27;t want translations to default to the old translation, even though they&#x27;re &quot;only&quot; one character apart.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857681/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857683"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2021 3:57 UTC (Mon)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/857683/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Honestly, this is kind of theoretical in practice. I don&#x27;t remember exactly, but gettext did warn about possible ambiguous matches during PO file compilation.<br>
<p>
A modernized gettext() can be designed to raise an error if there are two messages that can be ambiguously fuzzily matched with each other. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857683/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor904133"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 8, 2022 7:07 UTC (Mon)
                               by <b>ssmith32</b> (subscriber, #72404)
                              [<a href="/Articles/904133/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You could run the command &quot;strings&quot; on your executable file for a start. Just a start, though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/904133/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor857587"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 28, 2021 15:41 UTC (Fri)
                               by <b>GCMorGoHome</b> (subscriber, #151226)
                              [<a href="/Articles/857587/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think this is a good approach.<br>
Not just for keeping monitoring systems up to date, but also to build them more thoroughly in the first place.<br>
<p>
Recently I had to find all sorts of possible failure messages XFS could print so that I don&#x27;t miss any.<br>
This would&#x27;ve been useful!<br>
Of course we can grep the source tree, but it&#x27;d be neat anyway.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857587/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor857641"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 29, 2021 11:54 UTC (Sat)
                               by <b>mm7323</b> (subscriber, #87386)
                              [<a href="/Articles/857641/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It could be placed into a separate file that would not require memory on a running system.</font><br>
<p>
The format strings themselves are already in the kernel, so perhaps the overhead of this &#x27;index&#x27; could just be reduced by storing less of the meta-info about the printk() locations, and use existing debug info to retrieve things like source file, line and function from just a list of printk() addresses and format strings.  <br>
<p>
Perhaps some clever unwinding could even disassemble code to find the format strings from just a list of the printk() call site addresses?<br>
<p>
The index might also be suitable for compression if sorted.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857641/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor857652"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 29, 2021 22:47 UTC (Sat)
                               by <b>dancol</b> (guest, #142293)
                              [<a href="/Articles/857652/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In Windows, format strings don&#x27;t appear* in the kernel binary image at all! Instead, each printk()-equivalent logs the current program counter and the arguments to the printk()-equivalent function. Compiler magic puts the format strings to the debug information file for the kernel alongside the program counter value at which the format string appears. To view the log messages, you run a userspace tool that combines the raw message-argument log and the kernel debug information, doing the message formatting at log-viewing time instead of message-logging time.<br>
<p>
I really like this approach. It saves both time and memory while giving you the &quot;just print me a string damn it!&quot; development experience. Granted, you need the debug information file to make sense of the kernel log, but when you have a symbol server, that&#x27;s easy to get.<br>
<p>
* When using one kind of ETW mode anyway. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857652/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857662"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 30, 2021 14:37 UTC (Sun)
                               by <b>alison</b> (subscriber, #63752)
                              [<a href="/Articles/857662/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; you need the debug information file to make sense of the kernel log, but when you have a symbol server, that&#x27;s easy to get.</font><br>
<p>
The process is reasonably fast when you have a sizable log?   <br>
<p>
A dmesg_pipe akin to trace_pipe would be great for those of us who write log monitors.  If there were a data structure containing the format strings, log monitors would sensibly reason about the importance of a message based on the format string and skip the recombination step if not.   Organizing a map of format strings with the LOG_LEVEL as the key could make lookup fast.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857662/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor859481"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 13, 2021 15:45 UTC (Sun)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/859481/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yabbut, non-developers don&#x27;t have a symbol server. They get incomprehensible hexadecimal garbage in the logs, rather than a message they could possibly (if technically inclined but not Windows developers) use to fix the actual problem. Not a very good look.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/859481/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor857768"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 1, 2021 1:10 UTC (Tue)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/857768/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If I was implementing a monitoring system I think I would implement it the other way: make it a list of messages that are normal and shouldn&#x27;t be cared about by the sysadmin. That is what I did with my apt upgrade log filter at least. As long as the monitoring system can have new messages to ignore added by the sysadmin, eventually it will be silent enough to be reasonable most of the time.<br>
<p>
Alternatively, perhaps we can get several thousand sysadmins to read all their dmesg, mark each message as normal/weird and train an AI model on the results.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857768/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor857866"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">printk() indexing</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 1, 2021 21:19 UTC (Tue)
                               by <b>riking</b> (subscriber, #95706)
                              [<a href="/Articles/857866/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This doesn&#x27;t work anymore when you want relatively simple analyses such as the rate of all USB resets / disconnects per machine and across all machines.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/857866/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2021, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
