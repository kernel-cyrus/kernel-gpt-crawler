        <!DOCTYPE html>
        <html lang="en">
        <head><title>Snowpatch: continuous-integration testing for the kernel [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/777421/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/777497/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/777421/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Snowpatch: continuous-integration testing for the kernel</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Benefits for LWN subscribers</b>
<p>
The primary benefit from <a href="/Promo/nst-nag5/subscribe">subscribing to LWN</a>
       is helping to keep us publishing, but, beyond that, subscribers get
       immediate access to all site content and access to a number of extra
       site features.  Please sign up today!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>January 26, 2019</br>
           <hr>
<a href="/Archives/ConferenceByYear/#2019-linux.conf.au">LCA</a>
</div>
Many projects use continuous-integration (CI) testing to improve the
quality of the software they produce.  By running a set of tests after
every commit, CI systems  can identify problems quickly, before they find
their way into a release
and bite unsuspecting users.  The Linux kernel project lags many others in
its use of CI testing for a number of reasons, including a fundamental
mismatch with how kernel developers tend to manage their workflows.  At <a
href="https://2019.linux.conf.au/">linux.conf.au 2019</a>, Russell Currey
described a CI system called <a
href="https://github.com/ruscur/snowpatch">Snowpatch</a> that, he hopes,
will bridge the gap and bring better testing to the kernel development
process.
<p>
There are a number of advantages to CI, Currey said.  It provides immediate
feedback to developers; with luck, they can fix their problems before other
people have to spend any time reporting them.  It can save a lot
of time for reviewers.  As a result, the whole code submission process
speeds up, and the project is able to move more quickly as a whole.
<p>
The core idea behind a kernel CI implementation is not complicated: one
just needs to merge
patches from the mailing lists, then run a set of tests on the result.
These tests can be as simple as <tt>checkpatch.pl</tt>, but can also

<a href="/Articles/777513/"><img
src="https://static.lwn.net/images/conf/2019/lca/RussellCurrey-sm.jpg" alt="[Russell Currey]"
title="Russell Currey" class="lthumb"></a>

include building and booting, running the kernel's self-testing code, and
more.  Once the tests are done, the results can be reported back to the
developer.
<p>
Doing this in the kernel context proves to be harder than in projects that
are hosted on sites like GitHub, though.  A pull request contains all of
the information needed to merge a group of changes; an email containing, say,
patch 7/10 lacks that context.  It is nearly impossible to tell from an
email message whether a patch series has been merged, rejected, or
superseded.  In general, mailing lists simply do not carry the same
level of metadata as contemporary project-hosting sites, and that makes
the CI problem harder.
<p>
Even so, there are groups doing CI testing on the kernel now.  The "big
boy" of kernel CI 
is the 0day robot, which picks up patches from the mailing lists and runs a
number of tests.  It does some static-analysis testing on the x86
architecture, build testing with over 100 kernel configurations, and a
runs set of tests looking for performance regressions.  When tests fail,
email is sent to the developer.  0day is useful, but it is proprietary to
Intel, so nobody else has the ability to change it to do what they want.
In the absence of failures, there is also no way for developers to tell
whether the tests have been run on a given patch posting or not.
<p>
Providing better CI for the kernel requires obtaining better metadata for
patches, but any proposal that requires kernel developers to change their
workflow is clearly not going to get far, he said.  The solution is to use
<a href="http://jk.ozlabs.org/projects/patchwork/">Patchwork</a>, which is
already in use by a number of kernel subsystems and is 
designed to supplement mailing lists rather than replacing them.  Patchwork
is able to track the state of patches, keep a patch series together, and
host test results.  And, perhaps best of all for those who would like to
extend its functionality, it has a JSON API that can be used to build
scripts around it.
<p>
Patchwork fills the bill nicely because it is already in use and accepted
by many developers; adopting it will not require any workflow changes.
Patchwork can host test results without having to run the tests itself;
they can come from anywhere.
There is also value in having the results posted on a web site; developers
can learn when tests have been run (and their outcome) without the need to
send out email for every patch set.
<p>
Snowpatch, thus, is built on top of patchwork.  It is written in Rust in, 
Currey said, an attempt to be cool.  The effort began at linux.conf.au 2016
in Geelong, and is maintained in collaboration with Andrew
Donnellan.  The code is GPL-licensed.  There is an instance 
running now for the linuxppc-dev mailing list.
<p>
At its core, Snowpatch grabs a patch from Patchwork,
applies it to one or more repository branches, then sends the result to a
remote system for testing.  When the results come back, they are added to
the Patchwork entry.  Actually running the tests requires <a
href="https://jenkins.io/">Jenkins</a> for now â€” a limitation that Currey
apologized for.  But, he said, Jenkins does everything that the project
needs it to do.
<p>
Should anybody else want to set up a Snowpatch instance, he said, there are
a few basic requirements.  First of all, it needs a local repository to
which patches can 
be applied.  Access to a patchwork instance is needed to be able
to publish the results.  A Jenkins server is needed to run the tests, and
there needs to be a remote Git repository that is visible to the Jenkins
system.  Currey ended his talk with an expression of hope that more kernel
subsystems will set up Snowpatch and start making use of it to improve
their CI testing.
<p>
A member of the audience asked about the risk of malicious patches taking
over the test machines.  Currey answered that "something" needs to be in
place to deal with that problem, but it hasn't been addressed yet.  That
something might involve having a maintainer approve test runs.  That said,
bad patches haven't been a problem so far.  The final question had to do
with dependencies between patches; Snowpatch has no real solution for that
problem at this time.
<p>
<a href="https://www.youtube.com/watch?v=IRtBqPNsM9g">A video of this
talk</a> is available on YouTube.
<p>
[Thanks to linux.conf.au and the Linux Foundation for supporting my travel
to the event.]<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_tools">Development tools</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Patchwork">Patchwork</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#linux.conf.au-2019">linux.conf.au/2019</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/777421/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor777567"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 26, 2019 7:57 UTC (Sat)
                               by <b>ruscur</b> (guest, #104891)
                              [<a href="/Articles/777567/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks for the article!  Happy to answer any questions.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777567/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777574"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 26, 2019 10:23 UTC (Sat)
                               by <b>jani</b> (subscriber, #74547)
                              [<a href="/Articles/777574/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Just FYI, we're doing fairly serious kernel CI on Intel Graphics i.e. the drm/i915 driver: <a href="https://intel-gfx-ci.01.org">https://intel-gfx-ci.01.org</a><br>
<p>
There was an LWN article on this in 2017 <a href="https://lwn.net/Articles/735468/">https://lwn.net/Articles/735468/</a>. We've improved and expanded since.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777574/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777614"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 27, 2019 5:50 UTC (Sun)
                               by <b>ajdlinux</b> (subscriber, #82125)
                              [<a href="/Articles/777614/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That looks super cool.<br>
<p>
Is any of your infrastructure tooling publicly available at the moment?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777614/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777620"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 27, 2019 10:07 UTC (Sun)
                               by <b>jani</b> (subscriber, #74547)
                              [<a href="/Articles/777620/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Large parts of it are free software:<br>
<p>
- <a href="https://gitlab.freedesktop.org/patchwork-fdo">https://gitlab.freedesktop.org/patchwork-fdo</a><br>
- <a href="https://gitlab.freedesktop.org/gfx-ci">https://gitlab.freedesktop.org/gfx-ci</a><br>
- <a href="https://gitlab.freedesktop.org/drm/igt-gpu-tools">https://gitlab.freedesktop.org/drm/igt-gpu-tools</a><br>
<p>
But you caught me there, I'm not sure if the actual nuts and bolts of building the kernel, deploying to the farm of test machine, and gathering the test suite results to <a href="https://intel-gfx-ci.01.org/">https://intel-gfx-ci.01.org/</a> are available. Mostly Jenkins last I checked.<br>
<p>
There was another presentation at FOSDEM last year <a href="https://archive.fosdem.org/2018/schedule/event/intel_ci/">https://archive.fosdem.org/2018/schedule/event/intel_ci/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777620/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777624"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 27, 2019 16:59 UTC (Sun)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/777624/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It would really help if all of this could be more of a turnkey type solution.  Tall ask I know but it will likely lead to most of the free software projects adopt this type of testing.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777624/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777650"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2019 12:24 UTC (Mon)
                               by <b>mupuf</b> (subscriber, #86890)
                              [<a href="/Articles/777650/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It would really help if all of this could be more of a turnkey type solution.</font><br>
<p>
I disagree that it should be a turnkey solution, as each project has different needs. Instead, I believe we should be aiming towards developing components that work well together: an open source toolbox for CI.<br>
<p>
This is what <a href="https://gitlab.freedesktop.org/gfx-ci/documentation">https://gitlab.freedesktop.org/gfx-ci/documentation</a> is about. Here is the lightning talk that kicked off the effort: <a href="https://xdc2018.x.org/slides/GFX_Testing_Workshop.pdf">https://xdc2018.x.org/slides/GFX_Testing_Workshop.pdf</a><br>
<p>
Also, we should be aiming towards having common infrastructure for CIs, allow CI farms to plug themselves and provide additional testing.<br>
<p>
--------------------------------<br>
<p>
One thing that is missing from all of the kernel CIs project that I have seen is a competent tool keeping track of failures automatically and mapping them to bugs. This tool also needs to be able to do a filtered A/B comparison, indicating what were the changes when going from A -&gt; B (critical for pre-merge testing).<br>
<p>
I have been working on such a tool for years, but you are in luck, it finally got open sourced on Friday: <a href="https://gitlab.freedesktop.org/gfx-ci/cibuglog">https://gitlab.freedesktop.org/gfx-ci/cibuglog</a> . A read-only instance can be seen here ( <a href="https://intel-gfx-ci.01.org/cibuglog/">https://intel-gfx-ci.01.org/cibuglog/</a> ) and it produces A/B comparisons for patchwork ( <a href="https://patchwork.freedesktop.org/series/55750/">https://patchwork.freedesktop.org/series/55750/</a> ):<br>
<p>
CI Bug Log - changes from CI_DRM_5488 -&gt; Patchwork_12046<br>
====================================================<br>
<p>
Summary<br>
-------<br>
<p>
  **SUCCESS**<br>
<p>
  No regressions found.<br>
<p>
  External URL: <a href="https://patchwork.freedesktop.org/api/1.0/series/55750/revisions/1/mbox/">https://patchwork.freedesktop.org/api/1.0/series/55750/re...</a><br>
<p>
Known issues<br>
------------<br>
<p>
  Here are the changes found in Patchwork_12046 that come from known issues:<br>
<p>
### IGT changes ###<br>
<p>
#### Issues hit ####<br>
<p>
  * igt@gem_exec_suspend@basic-s4-devices:<br>
    - fi-blb-e6850:       PASS -&gt; INCOMPLETE [fdo#107718]<br>
<p>
  * igt@kms_chamelium@hdmi-hpd-fast:<br>
    - fi-kbl-7500u:       PASS -&gt; FAIL [fdo#108767]<br>
<p>
  <br>
#### Possible fixes ####<br>
<p>
  * igt@kms_chamelium@dp-edid-read:<br>
    - fi-kbl-7500u:       WARN -&gt; PASS<br>
<p>
  * igt@kms_pipe_crc_basic@read-crc-pipe-a:<br>
    - fi-byt-clapper:     FAIL [fdo#107362] -&gt; PASS<br>
<p>
  * igt@kms_pipe_crc_basic@read-crc-pipe-b-frame-sequence:<br>
    - fi-byt-clapper:     FAIL [fdo#103191] / [fdo#107362] -&gt; PASS +1<br>
<p>
  <br>
  [fdo#103191]: <a href="https://bugs.freedesktop.org/show_bug.cgi?id=103191">https://bugs.freedesktop.org/show_bug.cgi?id=103191</a><br>
  [fdo#107362]: <a href="https://bugs.freedesktop.org/show_bug.cgi?id=107362">https://bugs.freedesktop.org/show_bug.cgi?id=107362</a><br>
  [fdo#107718]: <a href="https://bugs.freedesktop.org/show_bug.cgi?id=107718">https://bugs.freedesktop.org/show_bug.cgi?id=107718</a><br>
  [fdo#108767]: <a href="https://bugs.freedesktop.org/show_bug.cgi?id=108767">https://bugs.freedesktop.org/show_bug.cgi?id=108767</a><br>
<p>
<p>
Participating hosts (44 -&gt; 40)<br>
------------------------------<br>
<p>
  Missing    (4): fi-kbl-soraka fi-ilk-m540 fi-byt-squawks fi-bsw-cyan <br>
<p>
<p>
Build changes<br>
-------------<br>
<p>
    * Linux: CI_DRM_5488 -&gt; Patchwork_12046<br>
<p>
  CI_DRM_5488: f13eede6ea3e780d900c5220bf09d764a80a3a8f @ git://anongit.freedesktop.org/gfx-ci/linux<br>
  IGT_4790: dcdf4b04e16312f8f52ad389388d834f9d74b8f0 @ git://anongit.freedesktop.org/xorg/app/intel-gpu-tools<br>
  Patchwork_12046: 6f40b811103eee129743c6465e987be7a51e7596 @ git://anongit.freedesktop.org/gfx-ci/linux<br>
<p>
<p>
== Linux commits ==<br>
<p>
6f40b811103e drm/i915/execlists: Suppress redundant preemption<br>
2ee9b7413598 drm/i915/execlists: Suppress preempting self<br>
0cf0a44086c4 drm/i915: Rename execlists-&gt;queue_priority to preempt_priority_hint<br>
<p>
I really believe this system is the reason for the success of our CI, and I will explain these reasons at FOSDEM next week: <a href="https://fosdem.org/2019/schedule/event/igt_ci/">https://fosdem.org/2019/schedule/event/igt_ci/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777650/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor777742"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2019 5:28 UTC (Tue)
                               by <b>ajdlinux</b> (subscriber, #82125)
                              [<a href="/Articles/777742/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks for the links, there's some interesting stuff in there that we should take a look at. We're familiar with FDO Patchwork, indeed initially that's what snowpatch targetted, because upstream Patchwork didn't yet have a REST API. The divergence between mainline and FDO patchwork is a bit of a sad story really.<br>
<p>
Our primary interest right now is in filling the gap you identify - the nuts and bolts of building kernels, deploying and publishing results. That's what's valuable across multiple different subsystems - we don't have any particular use for other subsystems' actual tests other than as inspiration for implementing our own for the subsystems we're personally interested in.<br>
<p>
As we develop our own infrastructure our plan is to open source as much of the pipeline stuff as we can, and try to make our test environments as replicable as possible for the benefit of other kernel developers who want to spin up their own stuff.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777742/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777821"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2019 17:10 UTC (Tue)
                               by <b>mupuf</b> (subscriber, #86890)
                              [<a href="/Articles/777821/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; we don't have any particular use for other subsystems' actual tests other than as inspiration for implementing our own for the subsystems we're personally interested in.</font><br>
<p>
I agree, but you also would not want to paint yourself in a corner by neglecting to think about the userspace ;)<br>
<p>
So far, we are really considering moving all the userspace to a container, for reproducibility and getting rid dependency issues between the builders and runners.<br>
<p>
If you have any question about our setup, join us on Freenode, #intel-gfx-ci.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777821/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor777608"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 27, 2019 1:03 UTC (Sun)
                               by <b>ndesaulniers</b> (subscriber, #110768)
                              [<a href="/Articles/777608/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Neat stuff, I hope you got a chance to talk with Joel Stanley (also of IBM) at Linux Conf AU '19; we're looking to do additional CI of kernel builds with Clang.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777608/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777613"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 27, 2019 5:46 UTC (Sun)
                               by <b>ajdlinux</b> (subscriber, #82125)
                              [<a href="/Articles/777613/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
We absolutely can throw clang on top of our existing builds we're doing on linuxppc-dev, shouldn't be too much trouble at all.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777613/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor777575"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 26, 2019 12:48 UTC (Sat)
                               by <b>unixbhaskar</b> (guest, #44758)
                              [<a href="/Articles/777575/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I am not sure,  what's wrong with <a href="https://kernelci.org/">https://kernelci.org/</a> ...or is not relevant?? <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777575/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777585"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 26, 2019 17:25 UTC (Sat)
                               by <b>olof</b> (subscriber, #11729)
                              [<a href="/Articles/777585/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
kernelci is mostly focused on building and booting contents in existing git trees, not patches posted on the lists and in patchwork.<br>
<p>
Over time they might expand it to do just that, but it's not there today.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777585/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777615"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 27, 2019 5:58 UTC (Sun)
                               by <b>ajdlinux</b> (subscriber, #82125)
                              [<a href="/Articles/777615/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Exactly this.<br>
<p>
What we're trying to do is tighten the feedback loop for developers so that CI results come within minutes of patch submission, not days or weeks after maintainers have merged patches into their trees.<br>
<p>
On the other hand, we're also NOT trying to test as many different combinations of kernel configurations as services like KernelCI or KISSKB. KernelCI concentrates on making sure we detect breakage across many different types of hardware, whereas currently we are quite happy to concentrate on a few high value tests and also static analysis.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777615/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor777618"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 27, 2019 7:47 UTC (Sun)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/777618/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; kernelci is mostly focused on building and booting contents in existing git trees, not patches posted on the lists and in patchwork.</font><br>
<p>
Patchwork applies patches to git trees so not clear why patchwork and kernelci couldn't be chained.<br>
<p>
I think I know what you actually mean; the reason I'm being pedantic is that this regular confusion between the content and its format keeps weakening the companion argument that "email is better for code reviews". The next step in confusion would be not being interested in CI because interfaces are typically web-based... Don't laugh, this is actually not too far from some of the worst LWN comments seen on these topics. Unusually low.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777618/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777731"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2019 2:50 UTC (Tue)
                               by <b>ajdlinux</b> (subscriber, #82125)
                              [<a href="/Articles/777731/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Patchwork applies patches to git trees so not clear why patchwork and kernelci couldn't be chained.</font><br>
<p>
It doesn't - Patchwork itself has minimal awareness of git, it just maintains a database of patches from the mailing list.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777731/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777752"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2019 7:15 UTC (Tue)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/777752/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
My bad, looks like I confused the "original" patchwork with their various CI extensions like this one: <a href="http://damien.lespiau.name/2016/02/augmenting-mailing-lists-with-patchwork.html">http://damien.lespiau.name/2016/02/augmenting-mailing-lis...</a><br>
Search/replace accordingly.<br>
<p>
Proves the terminology is even more confusing I thought it was.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777752/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777755"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2019 7:23 UTC (Tue)
                               by <b>ajdlinux</b> (subscriber, #82125)
                              [<a href="/Articles/777755/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
We're doing essentially the same thing with upstream Patchwork, using the API to fetch patches, then applying them to a git tree and triggering builds.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777755/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor777639"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2019 7:32 UTC (Mon)
                               by <b>mjthayer</b> (guest, #39183)
                              [<a href="/Articles/777639/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"...any proposal that requires kernel developers to change their workflow is clearly not going to get far, he said"<br>
<p>
Although it is probably a different direction to what Russell was looking for, I could imagine some number of kernel developers, enough to be interesting, being ready to change their workflow somewhat - like adding additional tags to patches for instance - to take advantage of a CI system which was there and working.  Especially if they were asked beforehand what sort of changes they could live with.  And I could imagine more following suit if it caught on.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777639/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777649"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2019 12:01 UTC (Mon)
                               by <b>jani</b> (subscriber, #74547)
                              [<a href="/Articles/777649/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Email is a lossy format for distributing changes. That said, I'm not prepared to give up on email based patch review just yet. I'd like to see a system where you contribute by git push/pull flow, and the other end emails the patches out for review. This would get rid of a class of lack of meta information issues with patchwork style systems parsing emails. To where and to whom should patch emails be sent to? Is this email really a patch? Is this series of emails a patch series? Against which git tree? What's the baseline? What are the changes to the earlier version? Has it been merged? Is this reply that contains a patch review or an updated version of the patch? Etc.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777649/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777733"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2019 3:47 UTC (Tue)
                               by <b>ajdlinux</b> (subscriber, #82125)
                              [<a href="/Articles/777733/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This would be a very interesting approach to try - perhaps something that could be experimented with by bolting something on to the Patchwork API...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777733/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor777647"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2019 11:16 UTC (Mon)
                               by <b>pm215</b> (subscriber, #98099)
                              [<a href="/Articles/777647/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It would be interesting to see a feature comparison with Patchew (<a href="https://patchew.org/">https://patchew.org/</a>) which also grabs patches from a mailing list, merges them, runs tests and reports the results on a website (and as email followups to the patches).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777647/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777732"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Snowpatch: continuous-integration testing for the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2019 5:22 UTC (Tue)
                               by <b>ajdlinux</b> (subscriber, #82125)
                              [<a href="/Articles/777732/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I haven't looked too deeply into Patchew, but on the surface it does appear to do a lot of the things we would want.<br>
<p>
From what I can tell, Patchew does have a bit of a different design philosophy to Patchwork and snowpatch, and perhaps that's because Patchew is much newer than Patchwork and they were thinking about CI from the very beginning.<br>
<p>
In our case, we started with Patchwork primarily because that's what the development workflow in many parts of the kernel is already using.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777732/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor777773"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Aren't developers already using git?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2019 12:53 UTC (Tue)
                               by <b>NAR</b> (subscriber, #1313)
                              [<a href="/Articles/777773/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I might miss something, but I don't quite get why does this system have to get patches out of e-mails. I presume most (or all?) kernel developers already work on a git tree (they need to base their code on something) and their patches are on a branch. So why not tell the CI system to pull this branch and run the tests there? Might not work with repos only living on the developer's laptop, but I'd guess at least for sake of redundancy these repos are public (or at least accessible from a remote CI system).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777773/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor777785"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Aren't developers already using git?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2019 14:10 UTC (Tue)
                               by <b>MattJD</b> (subscriber, #91390)
                              [<a href="/Articles/777785/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Speaking as someone who only has some ~4 patches added to the tree, my kernel source is not currently publicly available (mostly because I don't do enough work on the kernel to bother).  For large developers (and especially maintainers), I'd bet it's true they have their trees shared somewhere.  But for people doing smaller contributions, it's less likely if we just have to send an email.  And realistically I'd feel a lot better if my patches had an automatic CI run over them, as I'd be more likely to have a small issue easily identified by a CI.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777785/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor777855"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Aren't developers already using git?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2019 2:33 UTC (Wed)
                               by <b>ajdlinux</b> (subscriber, #82125)
                              [<a href="/Articles/777855/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Pretty much all kernel developers use git (though I think that may still not be 100%!), but developers very much have their own individual ways of working which often (mostly?) do *not* involve pushing all their branches to a publicly accessible location. (Speaking for myself, I push any major work I'm doing to either my GitHub account or to one of my company's internal Git services (which *aren't* public) but for minor patches I often just go straight from my laptop's working tree to sending an email patch.)<br>
<p>
The only part of the process that's common to all developers and all kernel subsystems is the submission of patches for review on the mailing list. That's why we chose to have snowpatch run tests at that point - it will catch everything, and the CI results will be visible (in patchwork) right alongside the code review comments.<br>
<p>
It would probably be better if everyone did make use of git in a more sensible fashion, and indeed some subsystems like drm are looking at using more features of tools like GitLab. But we don't live in a perfect world...<br>
<p>
The obvious disadvantage of the snowpatch approach is that a developer can't take advantage of the infrastructure to run the tests before they're ready to submit their patches for review on the mailing list. We're thinking about what we can do there, though that's a low priority for us at the moment.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/777855/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2019, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
