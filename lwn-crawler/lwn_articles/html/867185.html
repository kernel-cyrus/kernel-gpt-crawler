        <!DOCTYPE html>
        <html lang="en">
        <head><title>Nftables reaches 1.0 [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/867185/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/867462/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/867185/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Nftables reaches 1.0</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>August 27, 2021</br>
           </div>
The Linux kernel is a fast-moving project, but change can still be
surprisingly slow to come at times.  The <a
href="https://nftables.org/projects/nftables/index.html">nftables project</a> to replace the kernel's
packet-filtering subsystem has its origins in 2008, but is still not being
used by most (or perhaps even many) production firewalls.  The transition
may be getting closer, though, as highlighted by the release of <a
href="/ml/netdev/20210819173626.GA1776@salvia/">nftables 1.0.0</a> on
August&nbsp;19.
<p>
The <a href="/Articles/324251/">first public nftables release</a> was made
by Patrick McHardy in early 2009.  At that time, the kernel had a capable
packet-filtering subsystem 
in the form of iptables, of course, that was in widespread use, but
there were a number of problems driving a change.  These include the fact
that the kernel had (and still has) more than one packet-filtering
mechanism: there is one for IPv4, another for IPv6, yet another for ARP,
and so on.  Each of those subsystems is mostly independent, with a lot of
duplicated code.  Beyond that, iptables contains an excessive amount of
built-in protocol knowledge and suffers from a difficult API that, among
other things, makes it impossible to update a single rule without replacing
the entire set.
<p>
The core idea behind nftables was to throw away all of that protocol-aware
machinery and replace it with a simple virtual machine that could be
programmed from user space.  Administrators would still write rules
referring to specific packet-header fields and such, but user-space tooling
would translate those rules into low-level fetch and compare operations, then
load the result into the kernel.  That resulted in a smaller
packet-filtering engine that was also far more flexible; it also had the
potential to perform better.  It looked like a win, overall, once the minor
problem of transitioning a vast number of users had been overcome.
<p>
Nftables made a bit of a splash when it was launched, but then bogged down
and disappeared from view, perhaps because McHardy decided he had <a
href="/Articles/721458/">more 
interesting opportunities to pursue</a> in courtrooms.  In 2013, though, Pablo Neira
Ayuso <a href="/Articles/564095/">restarted the project</a> with the idea
of getting the code merged into the mainline as soon as possible.  That
part succeeded; nftables found its way into the 3.13 kernel release at the
beginning of 2014.
<p>
The work since then has been a hard slog of filling in the gaps and making
nftables sufficiently appealing that users would want to make the
transition.  The language used to write filtering rules has gained a long
list of features for stateful tracking, address mapping, efficient handling
of address intervals and large rule chains, and support for numerous
protocols.  There was also documentation to write, of course; the <a
href="https://wiki.nftables.org/wiki-nftables/index.php/Main_Page">nftables
wiki</a> has a lot of information about how it all works.
<p>
There is, of course, one other significant impediment to transitioning away
from iptables: the vast number of deployed, working firewalls using the
latter.  In many cases, rewriting the firewall rules may be the best course
of action because many complex filtering setups can be expressed much more
efficiently in the new scheme.  But, for administrators who just want their
painfully developed firewall to keep working, the benefits of nftables
may be less appealing than one might expect.  The nftables developers have
developed a set of scripts to translate iptables firewalls into the
nftables equivalent, which should help, but it is still a big jump.
<p>
In some cases, users may eventually make that jump without even noticing,
though.  Linux distributions have carried support for nftables for some
time now, and work is being done <a
href="https://firewalld.org/2018/07/nftables-backend">to port tools like
Red Hat's firewalld</a> to 
nftables.  In cases like this, users may have never seen the iptables rules
in the first place and, with luck, will not notice that the underlying
mechanism has changed.
<p>
When will that change happen?  It is still somewhat hard to say.  The <a
href="https://ral-arturo.org/2018/06/16/nfws2018.html">2018 Netfilter
Workshop</a> decreed that iptables is "<q>a legacy tool</q>" whose
days are numbered.  Debian switched to nftables by default in the 2019
Debian&nbsp;10 "buster"
release, though Ubuntu didn't follow until the 21.04 release.  While almost
all distributions 
ship nftables,  many of them have yet to make the switch to use it by
default. 
<p>
The release of nftables 1.0.0 can be seen as a signal that it is time for
the laggards to get more serious about making the switch.  While it is hard
to imagine iptables support being removed anytime soon, it's rather easier
to foresee that enthusiasm for maintaining it will continue to wane.  New
features will show up in nftables instead, and users will eventually need
to migrate over to take advantage of them.  It only took 13&nbsp;years, but
this transition finally appears to be heading into its final stage.
<p>
There is, however, one other interesting question.  In 2018, the BPF
developers <a href="/Articles/747551/">announced bpfilter</a>, a
packet-filtering mechanism that runs on the BPF virtual machine.  The
announcement drew some attention at the time; BPF had (and has) a lot of
momentum, and a lot of work has been done to optimize the virtual machine
and make it safe to use.  Arguably, it makes sense to use that rather than
maintain yet another virtual machine just for packet filtering.  That would
allow the removal of a bunch of code and the focusing of maintenance effort 
on BPF.
<p>
The bpfilter code was <a href="/Articles/755919/">merged for the 4.18
kernel release</a>; it also brought in a "user-mode blobs" mechanism 
that was intended to facilitate the translation of firewall rules to the
new machine.  Since then, however, development on this code has come to a
halt; there have been exactly two (trivial) commits to the code in
<tt>net/bpfilter</tt> in 2021.  The removal of this code was <a
href="/Articles/822744/">discussed in June 2020</a> but it survived at that
time.  Since then, the cobwebs have only gotten thicker; it seems fair to
say that bpfilter is not an active area of development at this point, and
that it seems unlikely to displace nftables anytime soon.
<p>
Whether that is the "right" outcome is hard to say.  Perhaps the
special-purpose virtual machine used by nftables is a better solution to
this particular problem than the more general BPF.  Or possibly nftables
came out on top simply because the developers behind it continued to show
up and push the project forward.  One of the keys to success in kernel
development is simple persistence; that is doubly true for a critical
subsystem like packet filtering, where it is more than reassuring to know that
the developers are in it for the long haul.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Networking-Packet_filtering">Networking/Packet filtering</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Nftables">Nftables</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/867185/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor867643"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 15:46 UTC (Fri)
                               by <b>magfr</b> (subscriber, #16052)
                              [<a href="/Articles/867643/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I suppose it was inevitable. BPF is used for absolutely everything in the kernel with one exception:<br>
Packet filtering.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867643/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867651"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 18:11 UTC (Fri)
                               by <b>aszs</b> (subscriber, #50252)
                              [<a href="/Articles/867651/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As amusing as that would be, it doesn&#x27;t seem likely given <a href="https://lwn.net/Articles/858173/">https://lwn.net/Articles/858173/</a>, for better or worse...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867651/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor867644"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 15:57 UTC (Fri)
                               by <b>johill</b> (subscriber, #25196)
                              [<a href="/Articles/867644/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Couldn&#x27;t you kind of compile NFT to BPF?<br>
<p>
Today NFT has a whole bunch of &#x27;eval&#x27; methods, so to compile to BPF you just need to have a function that returns a few BPF instructions instead. Where not implemented, provide a BPF helper function that calls the existing eval function from BPF.<br>
<p>
It doesn&#x27;t even seem that hard, and if you implement the most commonly used &#x27;eval&#x27; methods directly and then send the program through the compiler you&#x27;ll probably already win something?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867644/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867715"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2021 7:12 UTC (Sun)
                               by <b>nilsmeyer</b> (guest, #122604)
                              [<a href="/Articles/867715/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
According to the LWN bpfilter article this is already possible with iptables:<br>
<a href="https://lwn.net/Articles/747551/">https://lwn.net/Articles/747551/</a><br>
<p>
Under: &quot;Bringing in BPF&quot;<br>
<font class="QuotedText">&gt; One of the core design features for bpfilter is the ability to translate existing iptables rules into BPF programs. </font><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867715/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867716"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2021 7:43 UTC (Sun)
                               by <b>johill</b> (subscriber, #25196)
                              [<a href="/Articles/867716/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don&#x27;t think that&#x27;s how it works - it wants to compile iptables (not nftables) _rules_, but as far as I can tell it has a separate userspace etc. that does all of that, rather than doing a sort of &quot;VM to VM&quot; translation in the kernel I was thinking of (NFT VM to BPF VM)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867716/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor867678"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 27, 2021 22:54 UTC (Fri)
                               by <b>jkingweb</b> (subscriber, #113039)
                              [<a href="/Articles/867678/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I set up the firewall on my home server using nftables as a learning exercise circa 2016 or thereabouts after my ISP deployed IPv6 service, with no significant prior experience in packet filtering. I found the experience decent-but-finicky, with some disappointing duplication of effort to handle both IPv4 and IPv6. <br>
<p>
I&#x27;m not sure what documentation I was following at the time; it may have led me down suboptimal paths, or things may have improved in the years since. I&#x27;ll have to give it another look!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867678/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867683"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2021 6:47 UTC (Sat)
                               by <b>wtarreau</b> (subscriber, #51152)
                              [<a href="/Articles/867683/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In my opinion it has significantly improved over the years. I&#x27;m using it at home as well and it&#x27;s way better than iptables. There are some places where you still can&#x27;t merge IPv4 and IPv6 rules, resulting in some duplication effort but I found that it remained reasonable (though more unification would always be welcome of course).<br>
<p>
The really nice thing compared to iptables is the instant and atomic load of the rules. No more situation where the nat table loads while the filter table fails etc. And the ability to define objects supporting lists about everywhere (ports, hosts etc) is great. I used to do that using scripts requiring a more complex language to automatically produce iterations. Now it is natural in the config language.<br>
<p>
What still really annoys me is the lack of command-line help. I promised Pablo I would some day send him a patch for this but still failed to find sufficient time to work on it. Having to go to the wiki to figure you need to type &quot;nft list rulesets&quot; after not having used it for 2 months is pretty annoying, especially when you&#x27;ve been used to &quot;iptables -h&quot; providing very detailed syntax information. But this minor user-interface aspect aside, nftables is a great technology that is far closer from the spirit of traffic filtering than ipfwadm, ipchains or iptables could be, making it extremely user-friendly.<br>
<p>
It&#x27;s difficult to adopt it, but it&#x27;s really worth it. Most of the effort is to convert the existing config. I would strongly encourage new firewall deployments to start with nftables, as it will be much easier than iptables for the first setup, an will not require any conversion.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867683/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867713"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2021 3:59 UTC (Sun)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/867713/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I definitely like nftables better than iptables, both for atomicity and for syntax.<br>
<p>
But I do wish the documentation was much better, especially the documentation for the kernel-to-userspace interfaces.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867713/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor867690"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2021 15:41 UTC (Sat)
                               by <b>hailfinger</b> (subscriber, #76962)
                              [<a href="/Articles/867690/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I had the questionable idea to set up a nftables based packet filter on various Debian Buster systems in 2020/2021 because nftables was declared to be the future. Lessons learned:<br>
- The syntax is nice once you get used to it and I think most of it is more easily readable due to the structure<br>
- The documentation was incomplete, especially for NAT<br>
- If the documentation says that two ways to specify a rule are equivalent you should verify that instead of blindly rewriting working rules<br>
- Concatenations are cool, but rarely work<br>
- Order within in a single rule matters sometimes<br>
- Combining the same rule from &quot;table ip nat&quot; and &quot;table ip6 nat&quot; into &quot;table inet nat&quot; only works in some cases<br>
- If your kernel and the nftables userspace are not the same age you will run into problems, so either upgrade both or none, this may be different now that 1.0 is released<br>
- Kernel 5.10 is roughly where most of the interesting functions start working if your userspace is new enough and nftables 0.9.6 (Buster Backports) is similarly a point where things start working better<br>
- On Debian Buster without backports the whole thing is really painful, it&#x27;s manageable with backports<br>
- Priorities as keywords (introduced in 0.9.6) instead of priorities as numbers helps a lot with readability compared to older versions<br>
- Error messages exist, but in netfilter 0.9.6 (from 2020) they were as helpful as gcc error messages (&quot;error: expected ‘asm’ or ‘__attribute__’&quot; instead of &quot;missing semicolon&quot;) from the era before llvm, they are a bit better now<br>
<p>
Overall, I think nftables has a nice future ahead and I&#x27;m looking forward to testing nftables 1.0.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867690/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867697"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2021 20:25 UTC (Sat)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/867697/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; gcc error messages from the era before llvm, </font><br>
<p>
Ahah, that&#x27;s actually a coincidence. GCC error messages for C were bad mostly due to the usage of yacc for the parser. When the parser was rewritten as recursive decent in 2004 by Joseph Myers that laid the foundation for improving error recovery. They then finally improved when GCC developers including myself got fed up of a few particularly egregious cases[1][2].<br>
<p>
But competition with llvm wasn&#x27;t particularly involved. In fact for C++ (which used recursive descent since before clang was started) error message quality has always been comparable to clang.<br>
<p>
More recently (and long after I had stopped working on GCC), David Malcolm did a huge amount of work on caret diagnostics, where GCC&#x27;s front ends were indeed lagging behind. But that&#x27;s a different story.<br>
<p>
[1] <a href="https://gcc.gnu.org/legacy-ml/gcc-patches/2010-10/msg02619.html">https://gcc.gnu.org/legacy-ml/gcc-patches/2010-10/msg0261...</a><br>
<p>
[2] <a href="https://gcc.gnu.org/legacy-ml/gcc-patches/2010-11/msg01808.html">https://gcc.gnu.org/legacy-ml/gcc-patches/2010-11/msg0180...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867697/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867701"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2021 21:24 UTC (Sat)
                               by <b>Paf</b> (subscriber, #91811)
                              [<a href="/Articles/867701/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
My experience with C++ errors around 2010-2011 (with whatever was in Ubuntu at the time) was there was a lot of multi-page spew when using even fairly simple templates?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867701/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867754"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2021 13:22 UTC (Mon)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/867754/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I have never done serious C++, but I think the issue there was that the error messages were overly precise and expanded the same template typenames over and over. At some point a couple tweaks were made, teaching the compiler about default template arguments and typedefs.<br>
<p>
In C, the problem was abysmal error recovery, causing dozens of cascaded errors for a single missing semicolon or fat-fingered type name (such as &quot;intt&quot; or &quot;unsgined char&quot;). With a recursive descent parser it&#x27;s relatively easy and maintainable to add heuristics that look ahead and insert missing tokens or fix things up as necessary. For example if you see two consecutive unknown identifiers, it&#x27;s likely that the first is a misspelled type and the second is a variable name. With some luck, that will remove a lot of errors involving that variable, because the compiler now knows about it and treats it as declared.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867754/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor867725"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2021 13:49 UTC (Sun)
                               by <b>moorray</b> (subscriber, #54145)
                              [<a href="/Articles/867725/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; McHardy decided he had more interesting opportunities to pursue in courtrooms. In 2013, though, Pablo Neira Ayuso restarted the project</font><br>
<p>
Is this timeline right? I remember wondering if Patric got unhinged *because* Pablo’s implementation got picked over his.. The quote makes it sound like Pablo came after. It was before my time tho.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867725/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867820"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2021 19:59 UTC (Mon)
                               by <b>armijn</b> (subscriber, #3653)
                              [<a href="/Articles/867820/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, this timeline is right. McHardy&#x27;s contributions took a very sharp dive around September 2011 and he was only sporadically active in the years after that, with almost nothing happening in 2012. Pablo&#x27;s contributions didn&#x27;t start increasing until after McHardy dropped out.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867820/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor867748"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2021 6:46 UTC (Mon)
                               by <b>carORcdr</b> (guest, #141301)
                              [<a href="/Articles/867748/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
&quot;The nftables project to replace the kernel&#x27;s packet-filtering subsystem has its origins in 2008, but is still not being used by most (or perhaps even many) production firewalls. &quot;<br>
<p>
Glad to see a substantive article on nftables and iptables. Do you have any numbers on the use in production firewalls?<br>
<p>
In Rusty&#x27;s words:<br>
<p>
When your Linux box is the only thing between the chaos of the Internet and your nice, orderly network, it&#x27;s nice to know you can restrict what comes tromping in your door.<br>
<p>
Rusty Russel, Linux IPCHAINS-HOWTO, v1.0.8 (2000-07-04)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867748/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor867750"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2021 9:13 UTC (Mon)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/867750/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I just had a look at the CLI command nft and it still seems extremely unpolished<br>
<p>
When I call ntf --help I get<br>
<p>
<font class="QuotedText">&gt; Usage: nft [ options ] [ cmds... ]</font><br>
<font class="QuotedText">&gt; [...]</font><br>
<p>
but not a single command is listed in the help output, nor another command/option that would display that information.<br>
<p>
When I try ntf help I get<br>
<p>
<font class="QuotedText">&gt; Operation not permitted (you must be root)</font><br>
<font class="QuotedText">&gt; Error: syntax error, unexpected newline, expecting string</font><br>
<font class="QuotedText">&gt; help</font><br>
<font class="QuotedText">&gt;      ^</font><br>
<p>
which seems like a weird mix of errors and also &quot;unexpected newline&quot; is an odd error to emit for commandline parameters, not to mention that it is far too low level in general.<br>
<p>
There is also no obvious option in the --help output to list the currently active ruleset.<br>
<p>
On top of that, since firewalls are quite complex we will be unlikely to maintain an iptables and an nftables version of our rulesets in our Puppet configuration management so a working and usable and fully featured version will have to be part of the oldest distros we use before it is even something to consider, so I would imagine nothing will happen before about 2030 since the current version doesn&#x27;t really look usable yet.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867750/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor867763"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2021 14:35 UTC (Mon)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/867763/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The full list of commands is in the nft(8) manual page; it would be too long to include in the --help output. If you&#x27;re using iptables-nft (which the default iptables backend in Debian starting with Buster) then you can list your current iptables rules in nft syntax with the command &quot;sudo nft -s list ruleset&quot;.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867763/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868049"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 1, 2021 18:58 UTC (Wed)
                               by <b>Chousuke</b> (subscriber, #54562)
                              [<a href="/Articles/868049/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Unfortunately the nft manual page seems to take after the iproute2 suite of tools in being extremely light on examples and leaving the reader to figure out how to put things togethers from rather loosely organized grammar descriptions and tables. You basically have to guess how to use it.<br>
<p>
For example, if you wanted to know how to perform a 1:1 nat for an entire IP prefix, the manual page would not help because it doesn&#x27;t even mention that you can use bitwise operators (&amp;, |) with netmasks to perform calculations and modifications on packet fields.<br>
<p>
I know there&#x27;s a partial sentence somewhere on the wiki page that indirectly hints at this being possible because I found it some time ago when I had to do prefix translation, but I can&#x27;t find it anymore.<br>
<p>
nftables is capable, but its documentation makes me sad. It&#x27;s unbeliveably bad.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868049/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868056"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 1, 2021 19:27 UTC (Wed)
                               by <b>Chousuke</b> (subscriber, #54562)
                              [<a href="/Articles/868056/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Replying to myself since I can&#x27;t edit to give an actual example:<br>
<p>
I tried finding the relevant documentation from the wiki page but I can&#x27;t; I&#x27;ve forgotten where I found it the last time. The manual page says &quot;Expressions can be combined using binary, logical, relational and other types of expressions&quot;, but *nowhere* does it detail what those expressions &quot;binary&quot;, &quot;logical&quot; or &quot;relational&quot; expressions are. It doesn&#x27;t even contain the word &quot;operator&quot;.<br>
<p>
I did find out that man libnftables-json at least lists &quot;binary operations&quot;, but there&#x27;s no context.<br>
<p>
Just in case someone ends up needing it, you can do stuff like this:<br>
<p>
ip daddr 10.240.1.0/24 dnat to ip daddr &amp; 0.0.0.255 | 10.140.7.0;<br>
<p>
I don&#x27;t even remember how I figured that out the first time, but it wasn&#x27;t thanks to the documentation.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868056/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868704"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 9, 2021 4:48 UTC (Thu)
                               by <b>chaispaquichui</b> (guest, #77035)
                              [<a href="/Articles/868704/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Very useful, thanks !<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868704/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor868103"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 2, 2021 5:19 UTC (Thu)
                               by <b>carORcdr</b> (guest, #141301)
                              [<a href="/Articles/868103/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I can appreciate the concern for the lack of examples, but if you actually look at all the manual pages for the 100+ programs (arpd...tipc-socket) there are actually a significant number of examples. If I decide to list them I will update this comment.<br>
<p>
There are many non-iproute2 programs, including significant ones, that have far fewer examples. Some have null.<br>
<p>
My definition of an example in the context of a program is a command string--<br>
<p>
$|# program argument[s] file|filepath<br>
<p>
I realize some may limit the definition of string to alphabetic characters. I do not. My definition of string is a string of characters--alphabetic, numeric and/or symbolic. <br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868103/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868331"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 3, 2021 19:10 UTC (Fri)
                               by <b>Chousuke</b> (subscriber, #54562)
                              [<a href="/Articles/868331/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Maybe picking on iproute2 was a bit unfair; I just remembered spending a lot of time trying to decipher the dense synopsis notation way back when. Taking another look, they&#x27;re definitely better than what nft has<br>
<p>
Lately I&#x27;ve felt a bit spoiled by OpenBSD manual pages. If you want to know what good documentation with man pages can look like, you can take a look at some of them. If everything were documented to the same standard I would never need Google...<br>
<p>
For example, If I want a quick overview on how OSPF works, I can just &quot;man ospfd&quot; on OpenBSD. The explanation may not strictly speaking have much to do with configuring ospfd itself, but well-placed context &quot;fluff&quot; is a huge quality-of-life improvement as it helps me understand the kinds of problems I can solve with the software.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868331/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor867752"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 30, 2021 11:22 UTC (Mon)
                               by <b>evgeny</b> (subscriber, #774)
                              [<a href="/Articles/867752/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Writing and maintaining a complex FW config by hand is really a pain - especially when more than one firewall is involved and part of the rules must be kept in sync. Long ago, I started using fwbuilder. There is no support for nftables yet, but hopefully, that will change once nft becomes mainstream.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/867752/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor868037"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 1, 2021 18:17 UTC (Wed)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/868037/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I want to like nftables, honestly, but after years of using it it&#x27;s still incredibly sharp and brittle for something that&#x27;s supposed to someday supplant the firewall everyone currently uses.<br>
<p>
I&#x27;d write out a laundry list of the snags I hit regularly but it turns out one already exists (<a href="https://bugzilla.netfilter.org/show_bug.cgi?id=1461">https://bugzilla.netfilter.org/show_bug.cgi?id=1461</a>). I&#x27;ve got a fail2ban setup that barely works; sometimes after a few hours of operation it refuses to add an address to a set that doesn&#x27;t contain it (this smells like unhandled hash collision... bug 1392?) — much worse is that sometimes adding a /32 is randomly and silently corrupted into a range covering half the ipv4 internet (bug 1438 - note that it&#x27;s happened to me even though I&#x27;m not setting auto-merge). I&#x27;ve found that appending a literal &quot;/32&quot; to the input prevents the latter, but I don&#x27;t understand why.<br>
<p>
In spite of that I&#x27;ll continue to use it because it&#x27;s easier to reason about rules that look like C instead of COBOL. The fundamental design at least seems sound and none of my gripes are unsolvable, I just wish I didn&#x27;t have to handhold it so much.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868037/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868703"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 9, 2021 4:13 UTC (Thu)
                               by <b>splitice</b> (guest, #154172)
                              [<a href="/Articles/868703/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;m in a similar camp. As someone who maintains and has developed alot of iptables modules I can certainly see the room for improvement, but I can&#x27;t help but think that nftables made just as many steps forward as it did steps backwards.<br>
<p>
Fingers crossed bpfilter will hit the mark better.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868703/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor868137"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nftables reaches 1.0</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 2, 2021 14:01 UTC (Thu)
                               by <b>ecree</b> (guest, #95790)
                              [<a href="/Articles/868137/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Regarding bpfilter and its stagnation, I have a little story to tell.  Back when bpfilter was new, Davem asked me if I&#x27;d lend a hand with the code generator (in the user-mode blob that translates iptables rulesets to BPF programs); I replied that I&#x27;d like to but that I couldn&#x27;t find the documentation of the iptables uAPI/ABI and I didn&#x27;t know it well enough to work without docs.  (include/uapi/linux/netfilter_ipv4/ip_tables.h is… unenlightening.)<br>
<p>
I heard nothing back, leading me to suspect that maybe the problem is that no-one *else* can remember all the corners of iptables either.  &#x27;The implementation is the spec&#x27; is fine until you want to replace the implementation.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868137/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2021, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
