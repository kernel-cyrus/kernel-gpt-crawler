        <!DOCTYPE html>
        <html lang="en">
        <head><title>Kernel self tests [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/608959/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/608617/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/608959/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Kernel self tests</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Please consider subscribing to LWN</b>
<p>
Subscriptions are the lifeblood of LWN.net.  If you appreciate this
content and would like to see more of it, your subscription will
help to ensure that LWN continues to thrive.  Please visit
<a href="/Promo/nst-nag1/subscribe">this page</a> to join up and keep LWN on
the net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>August 20, 2014</br>
           <hr>
<a href="/Articles/KernelSummit2014/">Kernel Summit 2014</a>
</div>
Shuah Khan started off her session at the 2014 Kernel Summit by noting that
she has been helping with the process of testing stable kernel releases for
some time.  That testing is mostly of the build-and-boot variety, but it
would be nice to be able to test kernels a bit more thoroughly than that.
If there were a simple set of sanity tests that any developer could run,
perhaps more regressions could be caught early, before they can affect
users.  The result of her work toward that goal is a new <tt>make</tt>
target called "kselftest" in the kernel build system.
<p>
There is a minimal set of tests there now; going forward, she would like to
increase the set of tests that is run.  We have lots of testing code out
there, she said; it would be good to make more use of it.  But she would
like help in deciding which tests make sense to include with kselftest.
The goal, she said, is to make things run quickly; it's a basic sanity
test, not a full-scale stress test.  
<p>
Ted Ts'o asked what the time budget is; what does "quickly" mean?  Shuah
replied that she doesn't know; the current tests run in well under ten
minutes.  That time could probably be increased, she said, but it should
not grow to the point that developers don't want to run the tests.  Mel

<a href="/Articles/608961/"><img
src="https://static.lwn.net/images/conf/2014/ks/ShuahKhan-sm.jpg" width=150 height=188
alt="[Shuah Khan]" title="Shuah Khan" hspace=3 vspace=3
align="left"></a> 

Gorman noted that his tests, if run fully, take about thirteen days â€”
probably a bit more than the budget allows.  Paul McKenney added that the
full torture-test suite for the read-copy-update subsystem runs for more
than six hours.  At this point, Shuah said that her goal is something
closer to 15-20 minutes.
<p>
Josh Triplett expressed concerns about having the tests in the kernel tree
itself.  It could be hard to use bisection to find a test failure if the
tests themselves are changing as well.  Perhaps, he said, it would be
better to fetch the tests from somewhere else.  But Shuah said that would
work against the goal of having the tests run quickly and would likely
reduce the number of people running them.
<p>
Darren Hart asked if only functional tests were wanted, or if performance
tests could be a part of the mix as well.  Shuah responded that, at this
point, there are no 
rules; if a test makes sense as a quick sanity check, it can go in.  What
about driver testing?  That can be harder to do, but it might be possible
to put together an emulator that simulates devices, bugs and all.
<p>
Grant Likely said that it would be nice to standardize the output format of the
tests to make it easier to generate reports.  There was a fair amount of
discussion about testing frameworks and test harnesses.  Rather than having
the community try to choose one by consensus, it was suggested, Shuah
should simply pick one.  But Christoph Hellwig pointed out that the
xfstests suite has no standards at all.  Instead, the output of a test run
is compared to a "golden" output, and the differences are called out.  That
makes it easy to bring in new tests and avoids the need to load a testing
harness on a small system.  Chris Mason agreed that this was "the only way"
to do things.
<p>
The session closed with Shuah repeating that she would like more tests for
the kselftest target, along with input about how this mechanism should work
in general.
<p>
<b>Next</b>: <a href="/Articles/608968/">Two sessions on review</a>.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Regression_testing">Regression testing</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Kernel_Summit-2014">Kernel Summit/2014</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/608959/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor609099"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel self tests</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 21, 2014 3:39 UTC (Thu)
                               by <b>glikely</b> (subscriber, #39601)
                              [<a href="/Articles/609099/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In hallway-track conversations after the session, more time was spent talking about test time. Rusty Russell commented to me that if a test takes longer than about a second, then it isn't going to get run for smoke testing. I pretty much agree with that sentiment.<br>
<p>
It is absolutely important to make it easy to execute longer running tests, and I think we're going to try to do that. However, for the purpose of smoke testing we'll need to predefine a set of "effectively instant" test cases.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/609099/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor609510"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel self tests</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2014 17:26 UTC (Mon)
                               by <b>grundler</b> (guest, #23450)
                              [<a href="/Articles/609510/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Even if tests take longer than a second to run, they are still useful for regression testing - when one needs to confirm a subsystem or API behaves in some documented way.<br>
<p>
What's critical for getting developers to run tests, it has to be easy to:<br>
1) DISCOVER tests<br>
2) RUN tests<br>
<p>
Just like "make install" is the standard way to build a kernel, we need a standard way to discover and invoke the tests..perhaps "make list_tests" and "make run_test FOO".<br>
<p>
ChromeOS uses autotest framework to meet those goals...but autotest has substantial infrastructure (setup/cleanup) cost (~30 seconds for a basic test) that clearly could be improved upon by some "in kernel" tests. And while python isn't that difficult, learning curve for  autotest infrastructure is painful enough that I don't like re-learning it the once or twice a year I have to work on some test.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/609510/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor609198"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Git test suite</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 21, 2014 19:25 UTC (Thu)
                               by <b>jnareb</b> (subscriber, #46500)
                              [<a href="/Articles/609198/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why not use shell based test suite that Git project uses, with TAP (Test Anything Protocol) output? The test "library" weights less than 2000 lines (50KB), including lots of comments.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/609198/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2014, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
