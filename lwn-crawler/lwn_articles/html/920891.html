        <!DOCTYPE html>
        <html lang="en">
        <head><title>GFP flags and the end of __GFP_ATOMIC [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/920891/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/921354/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/920891/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>GFP flags and the end of __GFP_ATOMIC</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>LWN.net needs you!</b>
<p>
Without subscribers, LWN would simply not exist.  Please consider
       <a href="/Promo/nst-nag2/subscribe">signing up for a subscription</a> and helping
       to keep LWN publishing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>January 27, 2023</br>
           </div>
Memory allocation within the kernel is a complex business.  The amount of
physical memory available on any given system will be strictly limited,
meaning that an allocation request can often only be satisfied by taking
memory from somebody else, but some of the options for reclaiming memory
may not be available when a request is made.  Additionally,
some allocation requests have
requirements dictating where that memory can be placed or how quickly the
allocation must be made.  The kernel's
memory-allocation functions have long supported a set of "GFP flags" used
to describe the requirements of each specific request.  Those flags will
probably undergo some changes soon as the result of <a
href="/ml/linux-kernel/20230113111217.14134-1-mgorman@techsingularity.net/">this
patch set</a> posted by Mel Gorman; that provides an opportunity to look at
those flags in some detail.
<p>
The "GFP" in GFP flags initially stood for "get free page", referring to <a
href="https://elixir.bootlin.com/linux/v6.2-rc5/source/mm/page_alloc.c#L5595"><tt>__get_free_pages()</tt></a>,
a longstanding, low-level allocation function in the kernel.  GFP flags are
used far beyond that function, but it's worth remembering that they are
relevant to <i>full-page</i> allocations.  Functions (like <tt>kmalloc()</tt>)
that allocate smaller chunks of memory may take GFP flags, but they are
only used when those functions must get full pages from the
memory-management subsystem.
<p>
Most developers see GFP flags in the
form of macros like <tt>GFP_ATOMIC</tt> or <tt>GFP_KERNEL</tt>, but those
macros are actually constructs made up of lower-level flags.  Thus, for
example, in the 6.2-rc kernels, <tt>GFP_ATOMIC</tt> is <a
href="https://elixir.bootlin.com/linux/v6.2-rc5/source/include/linux/gfp_types.h#L332">defined
as</a>:
<p>
<pre>
    #define GFP_ATOMIC	(__GFP_HIGH|__GFP_ATOMIC|__GFP_KSWAPD_RECLAIM)
</pre>
<p>
Each of the component flags modifies the request in some way;
<tt>__GFP_HIGH</tt> marks it as a "high priority" request, for example,
with implications that will be described below.  Back in 2021, though, Neil
Brown observed that "<q>__GFP_ATOMIC serves little purpose</q>" and <a
href="/ml/linux-kernel/163712397076.13692.4727608274002939094@noble.neil.brown.name/">posted
a patch</a> to remove it.  That patch languished for over a year, though it
did inspire a slow-moving conversation on the meaning of certain GFP flags.
In October, Andrew Morton <a
href="/ml/linux-kernel/20221016193827.37c8c2165b22ae4401c269b4@linux-foundation.org/">threatened</a>
to drop it.  That inspired Gorman to pick it up and fold it into the
current series, which makes a number of changes to how the low-level GFP
flags work.
<p>
<h4>Low-level GFP flags</h4>
<p>
These flags are defined in <a
href="https://elixir.bootlin.com/linux/v6.2-rc5/source/include/linux/gfp_types.h"><tt>include/linux/gfp_types.h</tt></a>.
There are multiple variants of each flag.  Thus, for example,
<tt>__GFP_ATOMIC</tt> is defined as:
<p>
<pre>
    #define __GFP_ATOMIC	((__force gfp_t)___GFP_ATOMIC)
</pre>
<p>
While the three-underscore <tt>___GFP_ATOMIC</tt> is simply defined as:
<p>
<pre>
    #define ___GFP_ATOMIC		0x200u
</pre>
<p>
The intermediate (two-underscore) level of flags is there to enable type
checking for the GFP-flags argument to a number of functions, while the
three-underscore level allows easy manipulation within the
memory-management subsystem.  Developers outside of that subsystem should
not use the three-underscore versions, but they are the ones that, in the
end, define the options that are available with memory-allocation requests. 
<p>
So, for the curious, here is the set of low-level GFP flags and their
effect on allocation requests after the application of Gorman's patch set,
grouped into a few broad categories.
<p>
<h4>Placement options</h4>
<p>
A number of GFP flags affect where an allocation is located in physical
memory:

<dl class="spacylist">
<dt><tt><b>___GFP_DMA</b></tt></dt>
<dd> This is an ancient flag reflecting the limitations of early x86
     systems, which could only support 24-bit DMA addresses on the ISA bus;
     it caused the 
     allocation to be placed in the lowest 16MB of physical memory.  Even
     the worst hardware supported on current systems should not suffer from
     this limitation but, as <tt>gfp_types.h</tt> notes, it cannot be
     easily removed: "<q>careful auditing</q>" would be required.
</dd>
<dt><tt><b>___GFP_DMA32</b></tt></dt>
<dd> Like <tt>___GFP_DMA</tt>, this flag is for devices with a limited
     DMA range; this one restricts the allocation to physical memory that
     is addressable with 32&nbsp;bits.  This flag, hopefully, is only
     needed with older hardware that had a hard time making the 64-bit
     transition. 
</dd>

<dt><tt><b>___GFP_HIGHMEM</b></tt></dt>
<dd> This flag indicates that "high memory" can be used to satisfy the
     allocation request.  High memory is <a
     href="/Articles/813201/">described in this article</a>; it only exists
     on 32-bit systems where it is not possible to map all of physical
     memory into the kernel's address space.  There is no high memory on
     64-bit systems, so this flag has no effect there.
</dd>
<dt><tt><b>___GFP_MOVABLE</b></tt></dt>
<dd> Indicates memory that can be moved by the memory-management subsystem
     if needed to help the reclaim process.  User-space pages, for example, are
     movable since they are accessed via page tables that can be updated to
     a new location without the owning process noticing.
</dd>
<dt><tt><b>___GFP_RECLAIMABLE</b></tt></dt>
<dd> This flag indicates slab memory that can be reclaimed via shrinkers
     when resources get tight.  The memory-management subsystem tries to
     keep both movable and reclaimable allocations together in the same
     memory zones to facilitate the freeing of larger ranges of memory when
     needed.
</dd>
<dt><tt><b>___GFP_HARDWALL</b></tt></dt>
<dd> This flag disallows the allocation of memory outside of the memory
     nodes in the calling process's cpuset.
</dd>
<dt><tt><b>___GFP_THISNODE</b></tt></dt>
<dd> Allocations with this flag can only be satisfied by memory that is
     on the current NUMA node.
</dd>
</dl>
<p>
<h4>Access to reserves</h4>
<p>
The memory-management subsystem works hard to keep a reserve of free memory
at all times.  Freeing memory can often require allocating memory first —
to set up an I/O transfer to write the contents of dirty pages to
persistent storage, for example — and things go badly indeed if that
allocation fails.  There are a few options describing whether an
allocation can eat into the reserves, and by how much.
<p>
<dl class="spacylist">
<dt><tt><b>___GFP_HIGH</b></tt></dt>
<dd> "High-priority" allocations are marked with this flag.  What this
     means in practice, as stabilized by Gorman's patch set, is that the
     allocation is allowed to dip into the memory reserves that the kernel
     keeps for important allocations.  With this flag, a request is allowed
     to deplete the reserves down to 50% of their normal size.
</dd>
<dt><tt><b>___GFP_MEMALLOC</b></tt></dt>
<dd> An allocation with this flag will bypass all limits on use of
     reserves, grabbing any chunk of memory that is available.  It is only
     intended to be used in cases where the allocation is done with the
     purpose of making more memory available in the near future.
</dd>
<dt><tt><b>___GFP_NOMEMALLOC</b></tt></dt>
<dd> Explicitly disables any access to memory reserves.  This flag was
     initially introduced to prevent memory pools from running down the
     kernel's reserves.
</dd>
</dl>
Note that <tt>___GFP_KSWAPD_RECLAIM</tt>, described below, also has an
effect on the use of reserves.
<p>
<h4>Side effects</h4>
<p>
An allocation request made from atomic context cannot be allowed to block,
and requests made from a filesystem should not cause a recursive call back
into that filesystem.  A few of the defined GFP flags reflect these
constraints,  describing what
the memory-management subsystem is allowed to do to satisfy a request:
<p>
<dl class="spacylist">
<dt><tt><b>___GFP_IO</b></tt></dt>
<dd> Requests with this flag are allowed to start I/O if needed to reclaim
     memory.  It will be present for "normal" requests, but missing for
     requests made from within the storage layer, for example, where
     recursive I/O operations should be avoided.
</dd>
<dt><tt><b>___GFP_FS</b></tt></dt>
<dd> This flag allows the request to call into the filesystem layer if
     needed to reclaim memory; like <tt>___GFP_IO</tt>, it is used (by its
     absence) to avoid
     recursive calls when the filesystem itself is allocating memory.
</dd>
<dt><tt><b>___GFP_DIRECT_RECLAIM</b></tt></dt>
<dd> Allows the allocation call to enter direct reclaim, meaning that the
     calling thread can, itself, be put to work freeing memory to satisfy
     the allocation.  Direct reclaim increases the chances of the
     allocation succeeding, but can also increase the latency of the
     request and may cause the calling thread to block.
</dd>
<dt><tt><b>___GFP_KSWAPD_RECLAIM</b></tt></dt>
<dd> This flag allows the <tt>kswapd</tt> process to be invoked to perform
     reclaim.  That is normally desired, but there are cases where having
     <tt>kswapd</tt> running could interfere with other memory-management
     operations.  Less obviously (but perhaps more importantly), this flag
     also indicates that the 
     allocation request should not block for any reason; indeed,
     <tt>GFP_NOWAIT</tt> is a synonym for this flag.  If
     <tt>___GFP_HIGH</tt> is also set, this flag will allow access to 62.5%
     of the memory reserves.
</dd>
</dl>
<p>
<h4>Warnings and retries</h4>
<p>
Yet another set of options describes what should be done if an initial
attempt to fulfill an allocation request fails:
<p>
<dl class="spacylist">
<dt><tt><b>___GFP_NOWARN</b></tt></dt>
<dd> Prevents the printing of warnings in the system log should the request
     fail.  This flag is used in cases where failures may be expected and
     there is a readily available workaround available; an example would be
     an attempt to allocate a large, contiguous area where it is possible
     to get by with a lot of smaller allocations if need be.
</dd>
<dt><tt><b>___GFP_RETRY_MAYFAIL</b></tt></dt>
<dd> Indicates a request that is important and which can wait for
     additional retries if the first attempt at allocation fails.
</dd>
<dt><tt><b>___GFP_NOFAIL</b></tt></dt>
<dd> Marks a request that cannot be allowed to fail; the memory-management
     subsystem will retry indefinitely in this case.  There have been <a
     href="/Articles/401915/">occasional attempts to remove this flag</a>
     on the theory that all kernel code should be able to handle allocation
     failures, but there are still quite a few uses of it.
</dd>
<dt><tt><b>___GFP_NORETRY</b></tt></dt>
<dd> This flag will cause an allocation request to fail quickly if memory
     is not readily available.  It is useful in places where allocation
     failures can be handled relatively easily and it is better to not stress the
     system by trying harder to reclaim memory.
</dd>
</dl>

<p>
<h4>Miscellaneous flags</h4>
<p>
Finally, there is the inevitable set of flags that don't fit into any other
category:
<p>
<dl class="spacylist">
<dt><tt><b>___GFP_ZERO</b></tt></dt>
<dd> This flag requests that the requested page(s) be zeroed before being
     returned.
</dd>
<dt><tt><b>___GFP_WRITE</b></tt></dt>
<dd> Indicates that the page will be written to soon.  This flag is only
     observed in a couple of spots.  One is to try to spread to-be-written
     pages across memory zones.  The other is a tweak to the "refault" code
     that handles a process's working set; if a previously reclaimed
     file page is brought back
     in to be rewritten, it is not treated as part of the working set.
</dd>
<dt><tt><b>___GFP_COMP</b></tt></dt>
<dd> A multi-page allocation should return a <a
     href="/Articles/619514/">compound page</a>.
</dd>
<dt><tt><b>___GFP_ACCOUNT</b></tt></dt>
<dd> This flag causes the allocation to be charged to the current process's
     control group.  It is only used for allocations to be used within the
     kernel; user-space pages are already accounted in this way.
</dd>
<dt><tt><b>___GFP_ZEROTAGS</b></tt></dt>
<dd> Causes the internal "tags" metadata associated with the page to be
     cleared if the page itself is being zeroed on allocation.  This is a
     minor optimization that is used in exactly one place in the arm64
     page-fault-handling code.
</dd>
<dt><tt><b>___GFP_SKIP_ZERO</b></tt></dt>
<dt><tt><b>___GFP_SKIP_KASAN_UNPOISON</b></tt></dt>
<dt><tt><b>___GFP_SKIP_KASAN_POISON</b></tt></dt>
<dd> These three flags are used to tweak the checking by the KASAN
     sanitizer.
</dd>
<dt><tt><b>___GFP_NOLOCKDEP</b></tt></dt>
<dd> Disables checking of the allocation context done by the lockdep
     locking checker.  This flag is only used within the memory-management
     subsystem and XFS filesystem.
</dd>
</dl>
<p>
<h4>In conclusion</h4>
<p>
As can be seen, there are a lot of ways to modify how memory allocation is
done in the kernel.  After Gorman's patch series,  <tt>GFP_ATOMIC</tt>
still exists (there are over 5,000 call sites in the kernel, after all), but it
is defined as:
<p>
<pre>
    #define GFP_ATOMIC	(__GFP_HIGH|__GFP_KSWAPD_RECLAIM)
</pre>
<p>
So, from the list above, we see that a <tt>GFP_ATOMIC</tt> allocation
request will never block, and it has deep access to the kernel's memory
reserves.  That is why use of <tt>GFP_ATOMIC</tt> is discouraged in any
situation where it is not truly necessary.
<p>
One other change made in this patch set is to treat allocations made by
realtime tasks as being implicitly marked as <tt>___GFP_HIGH</tt>, since
dipping into the reserves is seen as better than delaying the task and
causing it to miss a deadline.  But, as Gorman <a
href="/ml/linux-kernel/20230113111217.14134-3-mgorman@techsingularity.net/">pointed
out</a>,
if access to reserves is needed, the system is under memory pressure and
chances are good that the deadlines aren't going to work out anyway.  The
patch warns that the special-case for realtime tasks will be removed at
some point in the future.
<p>
This patch series is in its third iteration, not counting Brown's initial
posting.  The discussion seems to have slowed down, so it is looking like
it is close to ready to head into the mainline.  Then
<tt>___GFP_ATOMIC</tt> will be no more, some of the other flags will be a
bit better defined — and most developers presumably will not even notice.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Memory_management-GFP_flags">Memory management/GFP flags</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-6.3">Releases/6.3</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/920891/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor921514"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 27, 2023 23:03 UTC (Fri)
                               by <b>pql</b> (subscriber, #158399)
                              [<a href="/Articles/921514/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
it's not strictly true that GFP flags are exclusively used for page allocations. For example, kmalloc() with __GFP_ZERO will zero out even when an object from an existing slab is issued.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/921514/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor921557"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2023 22:35 UTC (Sun)
                               by <b>gb</b> (subscriber, #58328)
                              [<a href="/Articles/921557/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I read article twice (with interest), but it seems that there is nothing about what is so bad about _*GFP_ATOMIC?<br>
Does it spins? Is it really mean atomic (only one allocation could happen in parallel)?<br>
What is problem being solved?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/921557/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor921685"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 31, 2023 6:52 UTC (Tue)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/921685/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; What is problem being solved?</span><br>
<p>
Problem was that this maze of twisty __GFP_* flags was confusing my poor brain.<br>
<p>
__GFP_ATOMIC doesn't mean any one thing.  If you follow the link to my original email (which I had to do to refresh my memory) you will see that __GFP_ATOMIC has a motley assortment of tasks that don't really fit any pattern.<br>
<p>
__GFP_ATOMIC is *always* paired with __GFP_HIGH, and much of the __GFP_ATOMIC functionally is really increasing the priority of the allocation in some way.  So maybe __GFP_HIGH should be used.  Or maybe __GFP_ATOMIC should be renamed __GFP_HIGHER.  Or something.<br>
<p>
After some deeper analysis, it seemed that there was no convincing need for multiple levels of HIGHness, so we agreed to let it disappear.<br>
<p>
Mel then did some more revising and refining so that some of the remaining flags have clearer and better documented meanings.<br>
<p>
Net result:  the next time I have to dive into this code, I can expect less confusion (or at least - different confusion).<br>
<p>
Problem solved!<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/921685/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor921792"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 31, 2023 19:19 UTC (Tue)
                               by <b>gb</b> (subscriber, #58328)
                              [<a href="/Articles/921792/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks, article makes sense now.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/921792/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor921561"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2023 1:42 UTC (Mon)
                               by <b>intelfx</b> (subscriber, #130118)
                              [<a href="/Articles/921561/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Wait.

Is it GFP_ATOMIC going away? My impression from reading the patch set that it was __GFP_ATOMIC, not the actual kernel-code-facing GFP_ATOMIC.
<p>
With the patch applied, the actual GFP_ATOMIC will simply mean <code>(__GFP_HIGH|__GFP_KSWAPD_RECLAIM)</code> instead of <code>(__GFP_HIGH|__GFP_ATOMIC|__GFP_KSWAPD_RECLAIM)</code>.







      
          <div class="CommentReplyButton">
            <form action="/Articles/921561/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor921572"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2023 14:33 UTC (Mon)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/921572/">Link</a>] 
      </p>
      
      </div>
      </summary>
      No, <tt>GFP_ATOMIC</tt> isn't going away, as the article says.  The headline really needed the two-underscore <tt>__GFP_ATOMIC</tt>, which <i>is</i> probably going away.  I'll go fix that now, sorry for the confusion.


      
          <div class="CommentReplyButton">
            <form action="/Articles/921572/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor921621"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2023 15:07 UTC (Mon)
                               by <b>ianmcc</b> (subscriber, #88379)
                              [<a href="/Articles/921621/">Link</a>] (32 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How does ___GFP_KSWAPD_RECLAIM invoke kswapd without blocking?  I asked ChatGPT, and it claims that it will fail with an error while kswapd reclaims memory in the background, which seems strange.  I would have thought (coming at this from a non-kernel developer) that the more common operation would be to block until memory is actually available.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/921621/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor921644"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Invoking kswapd</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2023 15:44 UTC (Mon)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/921644/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      The whole point of <tt>__GFP_KSWAPD_RECLAIM</tt> is to <i>not</i> block - that's why <tt>GFP_NOWAIT</tt> appears as a synonym.  It's used in situations where blocking is simply not an option.


      
          <div class="CommentReplyButton">
            <form action="/Articles/921644/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor921659"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Invoking kswapd</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2023 19:13 UTC (Mon)
                               by <b>geert</b> (subscriber, #98403)
                              [<a href="/Articles/921659/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
| This flag allows the kswapd process to be invoked to perform reclaim.<br>
<p>
How do you invoke another process without blocking?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/921659/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor921660"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Invoking kswapd</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2023 19:20 UTC (Mon)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/921660/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Wake it up and let it be scheduled as usual?
<p>
The point that didn't come through, perhaps, is that invoking the process is not the same as waiting for it to get anything done.


      
          <div class="CommentReplyButton">
            <form action="/Articles/921660/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor921691"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Invoking kswapd</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 31, 2023 9:16 UTC (Tue)
                               by <b>geert</b> (subscriber, #98403)
                              [<a href="/Articles/921691/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
OK, so this kicks kswapd, but doesn't have any immediate gain for the memory allocation request that triggers it, as it cannot wait for any action performed by kswapd?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/921691/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor923759"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Invoking kswapd</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 20, 2023 11:22 UTC (Mon)
                               by <b>karim96</b> (subscriber, #153187)
                              [<a href="/Articles/923759/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The kernel wakes up kswapd as soon as the fast allocation path fails.<br>
Then it enters the slow path and tries to concurrently allocate memory while<br>
kswapd is running (in the hope that kswapd frees something meanwhile). <br>
The slow path is a huge loop that tries the allocation several times with different policies<br>
(e.g. ALLOC_HARDER, ALLOC_NO_WATERMARKS, etc), gradually increasing the pressure,<br>
all while kswapd is also trying to free something.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/923759/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor921686"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Invoking kswapd</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 31, 2023 7:08 UTC (Tue)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/921686/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; The whole point of __GFP_KSWAPD_RECLAIM is to not block - that's why GFP_NOWAIT appears as a synonym. It's used in situations where blocking is simply not an option. </span><br>
<p>
That isn't quite how I understand it.<br>
<p>
The whole point of __GFP_KSWAPD_RECLAIM is to wake up kswapd if reclaim is needed.  No more, no less.<br>
<p>
According to <a href="https://lore.kernel.org/all/YZz6QWlk%2FZMzC4DG@dhcp22.suse.cz/">https://lore.kernel.org/all/YZz6QWlk%2FZMzC4DG@dhcp22.sus...</a> that flag dates back to <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=32dba98e085f">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/...</a> (which does something about allocating transparent-huge-pages).<br>
<p>
The implication seems to be  that most callers will want kswapd to start, but there are a few special cases that don't.  It is generally thought best that __GFP_FOO flags should trigger an action rather than suppress an action, so we have the KSWAP_RECLAIM which is almost always used.<br>
<p>
GFP_NOWAIT doesn't want to trigger anything - certainly no IO or direct reclaim or retry or ....  So "0" would be a pretty good value.  But __GFP_KSWAPD_RECLAIM is almost free, so it includes that flag.<br>
<p>
I think the only place that DOESN'T want the KSWAP_RECLAIM flag is internal to mm/ so it could probably use an internal interface which takes ALLOC_FOO flags.  So maybe we could discard KSWAP_RECLAIM as well, *always* wake kswapd when reclaim is needed by external callers, and provide a way for internal-to-mm code to bypass that wake-up.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/921686/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor921704"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Invoking kswapd</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 31, 2023 15:12 UTC (Tue)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/921704/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      So it looks like I got a little confused, not helped by <a href="https://elixir.bootlin.com/linux/latest/source/include/linux/gfp_types.h#L335">this definition</a> in <tt>gfp_types.h</tt>:
<p>
<pre>
    #define GFP_NOWAIT	(__GFP_KSWAPD_RECLAIM)
</pre>
<p>
That seems actively wrong — somebody might set <tt>GFP_NOWAIT</tt> with the idea that it will prevent blocking...but it doesn't do that.  <tt>__GFP_DIRECT_RECLAIM</tt> seems to be the actual flag the controls blocking.


      
          <div class="CommentReplyButton">
            <form action="/Articles/921704/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor921795"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Invoking kswapd</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 31, 2023 21:17 UTC (Tue)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/921795/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; somebody might set GFP_NOWAIT with the idea that it will prevent blocking</span><br>
<p>
They might, but that would be confused (but then these flags are often confusing).<br>
<p>
GFP_NOWAIT isn't something that you "set".  It is not one of several flags that can be added together.<br>
<p>
Rather it is something you choose - something you start with.<br>
<p>
You could equally say that GFP_NOIO prevents starting IO, but it doesn't.  It is a base request that doesn't include any permission to perform IO.<br>
<p>
A gfp arg to a function should take the form of a single GFP_FOO value, possibly or'ed with some __GFP_FOO flags.<br>
GFP_FOO is like a position, and __GFP_FOO is like a displacement.  You can add a displacement to a position and get a new position.  You can add a displacement to a displacement and get a new displacement. But you cannot add a position to a position, it makes no sense.<br>
<p>
So "GFP_NOIO | __GFP_IO"  would be perfectly legal and would allow IO (it is equivalent to to GFP_NOFS).<br>
<p>
However "GFP_KERNEL | GFP_NOWAIT" does not make sense - it is the sum of two positions.<br>
<p>
You could argue that using "NO" if the GFP_ positions is a poor choice, and it would be hard to disagree.  Finding a better name would be a challenge.<br>
<p>
The better direction (in which steps have been taken) is to deprecate the GFP_NO* flags.  Rather than GFP_NOFS we are encouraged to use memalloc_nofs_save/memalloc_nofs_restore to mark code regions where it is not safe to recursively call into filesystems.  Similarly memalloc_noio_save and memalloc_noreclaim_save prevent any IO requests for memory reclaim.  Whether something similar could work to make GFP_NOWAIT unnecessary, I cannot say for sure.<br>
<p>
You typically want NOWAIT when preemption is disabled (inside spinlocks and interrupts for example) and that is easily detected.  There are other times - maybe they would be happy with a name like "GFP_OPPORTUNISTIC" meaning that failure is perfectly acceptable.<br>
<p>
I would be happy if all the "Side effects" flags (as listed in the excellent article) were deprecated and discarded, being replaced by information from the process context.<br>
<p>
I would also be happy if the "Access to reserves" and "warns and retries" flags were combined into something more orthogonal.  These flags are all about the cost of failure.  Failure can be avoided either by accessing reserves, or by doing more reclaim work - using up either space or time.  If the request is urgent, we use space.  If the request is important, we use time.  Each of these seem to have 3 levels.  Using the numbers 1, 2, 3 in the levels rather than current names might make sense, though it would be even better to find a name that was meaningful to the caller (the current names are most meaningful to the implementation).<br>
<p>
Removing __GFP_ATOMIC is really just one small step on a long road.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/921795/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor922193"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 4, 2023 2:25 UTC (Sat)
                               by <b>immibis</b> (guest, #105511)
                              [<a href="/Articles/922193/">Link</a>] (23 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
ChatGPT is a bullshit-generator-as-a-service. You really shouldn't be asking it specific technical questions and expecting correct answers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/922193/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor922278"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 5, 2023 22:20 UTC (Sun)
                               by <b>kleptog</b> (subscriber, #1183)
                              [<a href="/Articles/922278/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It doesn't really matter if ChatGPT produces produces wrong answers sometimes. The test is if it produces better answers than a google search and/or asking your colleagues. That's a *much* lower bar to hurdle.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/922278/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor922310"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ChatGPT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 6, 2023 12:23 UTC (Mon)
                               by <b>Jandar</b> (subscriber, #85683)
                              [<a href="/Articles/922310/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Google produces links. The source pointed to by these links can be evaluated and judged. ChatGPT offers nothing to estimate the value of the answer.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/922310/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor922580"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 8, 2023 11:43 UTC (Wed)
                               by <b>jezuch</b> (subscriber, #52988)
                              [<a href="/Articles/922580/">Link</a>] (20 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<a href="https://www.danmcquillan.org/chatgpt.html">https://www.danmcquillan.org/chatgpt.html</a> (via jwz)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/922580/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor922865"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 10, 2023 6:42 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/922865/">Link</a>] (19 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Of course, the elites don't apply that to themselves, just to the rest of us. The structural injustices and supremacist perspectives layered into AI put it firmly on the path of eugenicist solutions to social problems. </span><br>
<p>
Are we sure this was not written by ChatGPT with the prompt: "Write a rebuttal about AI using as many BS-words as possible"?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/922865/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor923037"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 11, 2023 15:07 UTC (Sat)
                               by <b>immibis</b> (guest, #105511)
                              [<a href="/Articles/923037/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why do you think they are bullshit words?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/923037/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor923059"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 11, 2023 20:55 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/923059/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Usually, once somebody writes "supremacist" in a non-joke context, whatever they say can be dismissed. Here it also has: "elites", "structural" and other nonsense.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/923059/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor924489"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 27, 2023 0:37 UTC (Mon)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/924489/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
He literally had a literal link a few paras earlier showing how easy it is to get ChatGPT to assign dollar values to human lives based on the colour of their skin (and to assign intelligence levels and torture recommendations based on the same thing). All you have to do is ask it.<br>
<p>
Honestly his usage seems downright *moderate* to me.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924489/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor924492"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 27, 2023 1:45 UTC (Mon)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/924492/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
ChatGPT is a text generator. You can ask it to explain how automatic text generators have no morals and can be used for any purpose.<br>
<p>
The author above implies that the "elites" will use ChatGPT's recommendation for "eugenicist solutions to social problems", because "we are all 'stochastic parrots'".<br>
<p>
Honestly, this whole diatribe is deep in the tinfoil-hat category. Heck, it's probably in the lead pants category.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924492/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor924505"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 27, 2023 12:56 UTC (Mon)
                               by <b>excors</b> (subscriber, #95769)
                              [<a href="/Articles/924505/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't think that's what the article is about - it's not saying the "elites" will simply follow ChatGPT's bad recommendations. The quote posted earlier is not really about ChatGPT at all; it's about "AI" more generally, and why businesses and governments are investing so much in it. ChatGPT is just the most prominent step in that decades-long project, so it's the hook to get people interested in the wider topic.<br>
<p>
In this context, I think "AI" means 'any decision-making algorithm where we don't really understand how it's making decisions but we trust its decisions anyway'. It's opaque and unaccountable, which is great when you're a businessperson or politician trying to quietly implement an unpopular policy. Or maybe you're not even trying to implement that policy, it just happens by accident. Either way it's cheaper than employing humans, so you can take your share of the company's increased profits, or you can campaign on the 'efficiency savings' that will fund your popular tax cuts without cutting popular public services, and any news reports of bad outcomes can be dismissed as rare technical glitches and not your fault.<br>
<p>
But it's very bad if you're one of the people suffering under the algorithm's wrong decisions - and that's more likely if you're a statistical outlier, on the fringes of the algorithm's training set, so this disproportionately harms already-vulnerable minorities. Plus these technologies are being deployed to address topics like welfare, crime, health, etc, which already have a (frequently problematic) dependency on race, poverty, disability, etc, so those groups will feel the greatest impact. (I think that's part of the "structural injustice", i.e. a persistent unfairness towards members of particular social groups.)<br>
<p>
The author has a longer article at <a href="https://logicmag.io/home/deep-learning-and-human-disposability/">https://logicmag.io/home/deep-learning-and-human-disposab...</a> with more concrete examples, e.g.:<br>
<p>
<span class="QuotedText">&gt; NarxCare is an analytics platform for doctors and pharmacies in the US to “instantly and automatically identify a patient’s risk of misusing opioids.” It’s an opaque and unaccountable machine learning system that trawls medical and other records to assign patients an Overdose Risk Score. One classic failing of the system has been misinterpreting medication that people had obtained for sick pets; dogs with medical problems are often prescribed opioids and benzodiazepines, and these veterinary prescriptions are made out in the owner’s name. As a result, people with a well-founded need for opioid painkillers for serious conditions like endometriosis have been denied medication by hospitals and by their own doctors. </span><br>
<span class="QuotedText">&gt; </span><br>
<span class="QuotedText">&gt; The problems with these systems go even deeper; past experience of sexual abuse has been used as a predictor of likelihood to become addicted to medication, meaning that subsequent denial of medicines becomes a kind of victim blaming. As with so much of socially applied machine learning, the algorithms simply end up identifying people with complex needs, but in a way that amplifies their abandonment.</span><br>
<p>
The use of AI is still fairly limited, so much of the article is about problems in today's society where AI is not really involved - e.g. the "soft eugenic practices" of GPs giving "blanket do-not-resuscitate notices to disabled people" during Covid-19 in the UK - but (it argues) AI is being introduced to society in a way that will exacerbate these problems. Allocating scarce healthcare resources is a very emotive issue with no good solution, so it's tempting to come up with a metric that's superficially appealing (e.g. "maximise quality-adjusted life years") and then delegate the hard decisions to an algorithm that will optimise that metric with no regard for the complexities of the people it's condemning. It will also have no regard for the political context that led to the avoidable scarcity of resources, and no agency to address the root causes. And similar for many other social problems.<br>
<p>
I think the author doesn't think that's a good direction for society to be going in, so it's important to recognise the trend and resist it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924505/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor924738"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 28, 2023 22:07 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/924738/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;  "elites" will simply follow ChatGPT's bad recommendations</span><br>
<p>
Pretty much, yes, it does. It takes some off-the-cuff remarks and builds up a conspiracy theory around them.<br>
<p>
There are no "elites" with any kind of a plan (heck, I wish the "Committee of 300" from the Illuminati conspiracy existed). Corporations just do what they can to maximize their profit, within the legally allowed limits. And governments are just formed of people who want to get/preserve their power. <br>
<p>
And you can blame corporations for many things, but planning for many generations ahead is most definitely not one of them, and that's what you need if you're promoting a "eugenics agenda" or something.<br>
<p>
ChatGPT is simply another example of automation that will result in a displacement of workers in creative areas, just as it happened with countless other professions before. Nothing more, nothing less.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924738/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor924810"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 1, 2023 16:47 UTC (Wed)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/924810/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Corporations just do what they can to maximize their profit, within the legally allowed limits.</span><br>
<p>
Actually, in many (most) jurisdictions, corporations are LEGALLY OBLIGED to maximise their profits as much as possible. And failure to do so can be terminal as in the Vulture Capitalists will tear you apart.<br>
<p>
Some corporations are protected by their Articles of Association, but even then ...<br>
<p>
And over here, even Charities are affected by this. They can be forced to act to the detriment of those people they are supposed to help, in the name of maximising revenue.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924810/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor924815"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 1, 2023 17:58 UTC (Wed)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/924815/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I thought this came from Milton Freeman's viewpoint, not legal force. In the US (and I may very well be wrong/misinformed here), but don't the S1 and other SEC filings help to scope what the company is willing to do? Because if one is "legally obligated" to maximize profits, wouldn't every company tend towards HFT or other local maxima? Can one bring a suit against a company for not being as profitable as Apple? After all, they make more and do so (presumably) legally (nevermind the ethics of their strategies), so why not copy them and make more than you are now?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924815/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor924817"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 1, 2023 18:43 UTC (Wed)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/924817/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Because if one is "legally obligated" to maximize profits, wouldn't every company tend towards HFT or other local maxima?</span><br>
<p>
Isn't that what happens? Yes, there are restrictions on what a company is allowed to do, hence my comment about Articles of Association, but to take a look at charities for example, assets typically MUST be sold to the highest bidder. Look at the amount of Church property that ends up in "unsuitable" hands because the charity has no say in who the purchaser is.<br>
<p>
We've fallen foul of that - we had a Motability car, and the Government changed the rules so we no longer qualified. So the charity HAD to take the car off us. We were lucky, because so many people got caught up in this, and we were one of the last, they'd got their act together and were selling cars at book price, giving victims financial help, etc etc. But so many disabled people just got told "hand your keys back, goodbye", not because the charity wanted to, but because it had no choice.<br>
<p>
In the normal course of events, when a lease expires, the charity takes the car back, and sells it at auction for the best price possible. It has no choice. It CAN'T sell the car at book to the disabled person, which is a damn good deal. And once a disabled person needs an adapted car, they are on a financial treadmill, where it costs a bomb to stay on the treadmill, but if they fall off they are left without transport! (That's why, when the rules changed, so many disabled people got a kick in the teeth. Standard government practice - every change in government policy for the poor and disabled comes with a heavy cost to be paid by said poor and disabled :-(<br>
<p>
Seeing as we're no longer in that position, I don't know what's happening now, but I suspect many disabled people are stuck in the position where they are supposed to hand their cars back, but there are no (suitable) replacement cars to be had? What to do? Fortunately it's not our problem ...<br>
<p>
You may be right, it may be Freeman not governments. But much of Freeman's attitude permeates legislation and makes it pretty much impossible for companies (and charities) to avoid Freemanomics.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924817/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor924838"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 1, 2023 21:51 UTC (Wed)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/924838/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
(aside: the man's name is Friedman, not Freeman.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924838/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor924846"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 1, 2023 22:23 UTC (Wed)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/924846/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Bah. I thought that at first but thought I was mixing it up with Sam Bankman-Fried :/ .<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924846/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor924847"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 1, 2023 22:28 UTC (Wed)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/924847/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That's sad. I can see *some* justification in trying to prevent fraud or money laundering via charities but it sounds to me like that is better done by enforcing existing laws to that effect rather than mandating specific behaviors.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924847/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor924862"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2023 5:52 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/924862/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, I think a lot of the problem is "responsible steward" legislation, and risk-averse boards of trustees and accountants. Plus of course restrictions on what charities can do. For example, I know the disabled car example, they make loads of grants to disabled people from the profits. But the thing is, selling a car for the best price, and then giving a grant to keep someone trapped in the system, looks good. Just selling the car cheap looks like an abuse :-(<br>
<p>
It happens SOOO often :-(<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924862/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor924875"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2023 11:46 UTC (Thu)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/924875/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think much of what you describe does not relate to some vague, unenforceable duty to maximise shareholder value, but simply is down to a requirement that assets be handled in a responsible way in the interests of the corporation - and not be corrupted by employees' interests.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924875/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor924890"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2023 14:19 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/924890/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I would agree. The problem is that - especially but not only in the case of charities - "acting in a responsible manner" is *actively*harmful* to the interests of the people it is supposed to be helping.<br>
<p>
All the disabled people harmed in my Motability example - including us to the extent we now won't touch the scheme with a barge pole - a scheme that is there explicitly to help us.<br>
<p>
The village hall that was sold off and the money spent on facilities in the town ten miles away that "villagers can still make use of it in the town" except there is no viable transport except private car - and the main users of the hall are elderly who don't drive ... (that was my mother's village hall).<br>
<p>
That's why the US military buy 50cent hammers for $10 - so they can prove they're not wasting money ...<br>
<p>
The AIM is laudable, the end result is execrable.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924890/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor924924"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2023 15:01 UTC (Thu)
                               by <b>kleptog</b> (subscriber, #1183)
                              [<a href="/Articles/924924/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Some corporations are protected by their Articles of Association, but even then ...</span><br>
<p>
Interesting. Here if you want to create a new legal personality (i.e. a limited liability company) you need to have Articles of Association. And a standard part of them, usually one of the first articles, is "the purpose of the business". Maximising profit is not usually listed there. An organisation I do some things for actually lists "to help the local community because more self-supporting in energy needs". Maximising profit is not a goal.<br>
<p>
But then I look at the A of A of Shell and that part is missing completely.<br>
<p>
In the end, shareholders make the final decision (if you have any), and from experience if you have pension funds as shareholders, they are far more interested in a consistent dividend than maximising profits. They'd prefer you having a constant return for the next 30 years than trying to maximise growth and going bust in 5.<br>
<p>
The example you give for charities is sad. It seems crazy there's a legal obligation to work that way.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924924/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor924950"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2023 16:52 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/924950/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; In the end, shareholders make the final decision (if you have any), and from experience if you have pension funds as shareholders, they are far more interested in a consistent dividend than maximising profits. They'd prefer you having a constant return for the next 30 years than trying to maximise growth and going bust in 5.</span><br>
<p>
In the past, that used to be true here. Then the Vulture Capitalists descended. Pension funds are subject to the same short-term pressures as everybody else, forced to make crazy decisions that actively harm savers, and the entire country suffers :-(<br>
<p>
Rule 1 of successful saving - choose a staid, reliable provider and just forget about it. Market pressures - "manage your pension! Make sure you're getting the best return! The more we can bamboozle you into paying excessive management fees the better we look to out stakeholders!" (And in the meantime we can raid charge sky high transaction fees and strip the pension cupboard bare.)<br>
<p>
Pension savers are actively encouraged to "manage your pension". Excessively managed pensions demonstrably produce poor returns. And yet nobody in authority notices anything wrong, they're too busy encouraging the bandwagon.<br>
<p>
All heavily driven by the collapse in "final salary" pensions and the growth of "money purchase".<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/924950/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor925642"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 8, 2023 20:08 UTC (Wed)
                               by <b>immibis</b> (guest, #105511)
                              [<a href="/Articles/925642/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
not exactly the same, but in a similar vein that may be relevant: <a href="https://neritam.wordpress.com/2023/02/12/calling-a-fascist-a-fascist-is-descriptive-not-a-slur/">https://neritam.wordpress.com/2023/02/12/calling-a-fascis...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/925642/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor925644"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">GFP flags and the end of __GFP_ATOMIC</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 8, 2023 20:16 UTC (Wed)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/925644/">Link</a>] 
      </p>
      
      </div>
      </summary>
      ...and you're replying to a month-old comment ... on an article about low-level memory-allocation flags ... I don't really think this subthread needs to go any further.


      
          <div class="CommentReplyButton">
            <form action="/Articles/925644/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2023, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
