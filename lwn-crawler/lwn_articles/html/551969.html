        <!DOCTYPE html>
        <html lang="en">
        <head><title>ALS: Linux interprocess communication and kdbus [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/551969/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/551647/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/551969/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>ALS: Linux interprocess communication and kdbus</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ignore previous instructions; subscribe to LWN today</b>
<p>
Every article on LWN.net is written by humans, for humans. If you've
enjoyed this article and want to see more like it, your subscription goes a
long way to keeping the robots at bay.  We are offering <a href="https://lwn.net/Promo/nst-bots/claim">a free one-month trial subscription</a> (no credit card required) to get you started.
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>May 30, 2013</br>
           </div>
<p>
As part of the developer track at this year's <a
href="http://events.linuxfoundation.org/events/automotive-linux-summit-spring">Automotive
Linux Summit Spring</a>, Greg
Kroah-Hartman talked about interprocess communication (IPC) in the kernel with
an eye toward the motivations behind <a
href="https://github.com/gregkh/kdbus">kdbus</a>.  The work on kdbus is
progressing well and Kroah-Hartman expressed optimism that it would be
merged before the end of the year.  Beyond just providing a faster D-Bus
(which could be accomplished without moving it into the kernel, he said),
it is his hope that kdbus can eventually replace Android's binder IPC
mechanism. 
</p>

<h4>Survey of IPC</h4>

<a href="/Articles/552241/">
<img src="https://static.lwn.net/images/2013/als-gregkh-sm.jpg" border=0 hspace=5 align="right"
alt="[Greg Kroah-Hartman]" width=200 height=141>
</a>

<p>
There are a lot of different ways to communicate between processes
available in Linux (and, for many of the mechanisms, more widely in Unix).
Kroah-Hartman 
strongly recommended Michael Kerrisk's book, <a
href="http://man7.org/tlpi/"><i>The Linux Programming Interface</i></a>, as
a reference to these IPC mechanisms (and most other things in the Linux
API).  Several of his <a
href="https://github.com/gregkh/presentation-kdbus/blob/master/kdbus.pdf?raw=true">slides
[PDF]</a> were taken directly from the book.
All of the different IPC mechanisms fall into one of three categories, he
said: signals, synchronization, or communication. He used diagrams from Kerrisk's book (page 878) to show the
categories and their members.

<p>
There are two types of 
signals in the kernel, standard and realtime, though the latter doesn't see much
use, he said. 
</p>

<p>
Synchronization methods are numerous, including futexes and
<tt>eventfd()</tt>, which 
are both relatively new.  Semaphores are also available, both as the
"old style" System&nbsp;V semaphores and as "fixed up" by
POSIX.  The latter come in both named and unnamed varieties.  There is also
file locking, which has two flavors: record locks to lock a
portion of a file and file locks to prevent access to the whole
file.  However, the code that implements file locking is "scary", he said.
Threads have four separate types of synchronization methods (mutex,
condition variables, barriers, and read/write locks) available as well.
</p>

<p>
For communication, there are many different kernel services available too.
For data transfer, one can use pseudo-terminals.  For byte-stream-oriented
data, there are pipes, FIFOs, and stream sockets.  For communicating via
messages, there are 
both POSIX and System&nbsp;V flavored message queues.  Lastly, there is
shared memory which 
also comes in POSIX and System&nbsp;V varieties along with <tt>mmap()</tt>
for anonymous and file mappings.  Anonymous mappings with <tt>mmap()</tt>
were not something Kroah-Hartman knew about until recently; they ended up
using them in kdbus. 
</p>

<h4>Android IPC</h4>

<p>
"That is everything we have today, except for Android", Kroah-Hartman said.
All of the existing IPC mechanisms were "not enough for Android", so that
project 
added ashmem, pmem, and binder.  Ashmem is "POSIX shared memory for the
lazy" in his estimation.  The Android developers decided to write kernel
code rather than user-space code, he said.  Ashmem uses virtual memory and
can discard memory segments when the system is under memory pressure.
Currently, ashmem lives in the staging tree, but he thinks that Google is
moving to other methods, so it may get deleted from the tree soon.
</p>

<p>
Pmem is a mechanism to share physical memory. It was used to talk to GPUs.
Newer versions of Android don't use pmem, so it may also go away.  Instead,
Android is using the <a href="/Articles/480055/">ION memory allocator</a> now.
</p>

<p>
Binder is "weird", Kroah-Hartman said.  It came from BeOS and its
developers were from academia.  It was developed and used on systems
without the System&nbsp;V IPC APIs available and, via Palm and Danger, came
to Android.  It is "kind of like D-Bus", and some (including him) would
argue that Android should have used D-Bus, but it didn't.  It has a large
user-space library that must be used to perform IPC with binder.
</p>

<p>
Binder has a number of serious security issues when used outside of an
Android environment, he said, so he stressed that it should <i>never</i> be
used by other Linux-based systems.  

<p>
In Android, binder is used for <a href="http://developer.android.com/guide/components/intents-filters.html">intents</a> and app
separation; it is good for passing around small messages, not pictures or
streams of data.  You can also use it to pass file descriptors to other
processes. It is not particularly efficient, as sending a message
makes lots of hops through the library.  A <a
href="http://www.youtube.com/watch?v=NWhyADzgoiI">presentation
[YouTube]</a> at this year's Android 
Builders Summit showed that one message required eight kernel-to-user-space
transitions. 
</p>

<h4>More IPC</h4>

<p>
A lot of developers in the automotive world have used QNX, which has a nice
message-passing model.  You can send a message and pass control to another
process, which is good for realtime and single processor systems,
Kroah-Hartman said. 
Large automotive companies have built huge systems on top of QNX messages,
creating large libraries used by their applications.  They would like to be
able to use those libraries on Linux, but often don't know that there is a
way to get the QNX message API for Linux.  It is called <a
href="http://www.icanprogram.com/simpl/">SIMPL</a> and it works well.
</p>

<p>
Another solution, though it is not merged into the kernel, is <a
href="http://code.google.com/p/kbus/">KBUS</a>, which was created by some
students in England.  It provides simple message passing through the
kernel, but cannot pass file descriptors.  Its implementation involves
multiple data copies, but for 99% of use cases, that's just fine, he said.
Multiple copies are still fast on today's fast processors.  The KBUS
developers never asked for it to be merged, as far as he knows, but if they
did, there is "no 
reason not to take it".
</p>

<p>
D-Bus is a user-space messaging solution with strong typing and process
lifecycle handling.  Applications subscribe to messages or message types
they are interested in.  They can also create an application bus to listen
for messages sent to them.  It is widely used on Linux desktops and
servers, is well-tested, and well-documented too.  It uses the operating system
IPC services and can run on Unix-like systems as well as Windows.
</p>

<p>
The D-Bus developers have always said that it is not optimized for speed.
The original developer, Havoc Pennington, created a list of ideas on how to
speed it up if that was of interest, but speed was not the motivation
behind its development.  In the automotive industry, there have been
numerous efforts to speed D-Bus up.
</p>

<p>
One of those efforts was the <a href="/Articles/504970/"><tt>AF_BUS</tt> address
family</a>, which came about because in-vehicle infotainment (IVI) systems
needed better D-Bus performance.  Collabora was sponsored by GENIVI to come
up with a solution and <tt>AF_BUS</tt> was the result.  Instead of the four
system calls required for a D-Bus message, <tt>AF_BUS</tt> reduced that to
two, which made it "much faster".  But that solution was rejected by the
kernel network maintainers.
</p>

<p>
The systemd project rewrote <tt>libdbus</tt> in an effort to simplify the
code, but it turned out to significantly increase the performance of D-Bus
as well.  In preliminary benchmarks, BMW <a
href="https://github.com/gregkh/presentation-kdbus/blob/master/stuff/EG-SI-IPC%20CommonAPI%20CPP.pptx?raw=true">found
[PPT]</a> that the systemd D-Bus library increased performance by 360%.
That was unexpected, but the rewrite did take some shortcuts and listened
to what Pennington had said about D-Bus performance.  Kroah-Hartman's
conclusion is that "if you want a faster D-Bus, rewrite the daemon, don't
mess with the kernel".  For example, there is a Go implementation of D-Bus
that is "really fast".  The Linux kernel IPC mechanisms are faster than any
other operating system, he said, though it may "fight" with some of the
BSDs for performance supremacy on some IPC types.
</p>

<h4>kdbus</h4>

<p>
In the GNOME project, there is plan for something called "<a href="https://docs.google.com/document/d/1QTgxakyUVFMkvr-xFY2Xg9lYjcJLd6kPTl3Ij5_dL7Q/pub">portals</a>" that
will containerize GNOME applications.  That would allow running
applications from multiple versions of GNOME at the same time while also
providing application separation so that misbehaving or malicious
applications could not affect others.  Eventually, something like Android's
intents will also be part of portals, but the feature is still a long way
out, he said.  Portals provides one of the main motivations behind kdbus.
</p>

<p>
So there is a need for an enhanced D-Bus that has some additional
features. At a recent GNOME hackfest, Kay Sievers, Lennart Poettering,
Kroah-Hartman, 
and some other GNOME developers sat down to discuss a new messaging
scheme, which is what kdbus is.  It will support multicast and
single-endpoint messages, without any extra wakeups from the kernel, he said.   
There will be no blocking calls to kdbus, unlike binder which can sleep,
as the API for kdbus is completely asynchronous. 

<p>
Instead of
doing the message filtering in user space, kdbus will do it in the kernel
using <a href="http://en.wikipedia.org/wiki/Bloom_filter">Bloom
filters</a>, which will allow the kernel to only wake up the destination
process, unlike D-Bus.  Bloom filters have been publicized by Google
engineers recently, 
and they are an "all math" scheme that uses hashes to make searching very
fast.  There are hash collisions, so there is still some searching that
needs to be done, but the vast majority of the non-matches are eliminated
immediately.  
</p>

<p>
Kdbus ended up with a naming database in the kernel to track the message
types and bus names, which "scared the heck out of me", Kroah-Hartman
said.  But it turned to be "tiny" and worked quite well.  In some ways, it
is similar to DNS, he said.
</p>

<p>
Kdbus will provide reliable order guarantees, so that messages will be
received in the order they were sent.  Only the kernel can make that
guarantee, he said, and the current D-Bus does a lot of extra work to try to
ensure the ordering.  The guarantee only applies to messages sent from a
single process, the order of "simultaneous" messages from multiple
processes is not guaranteed.
</p>

<p>
Passing file descriptors over kdbus will be supported.  There is also a
one-copy message passing mechanism that Tejun Heo and Sievers came up
with.  Heo actually got zero-copy working, but it was "even scarier", so
they decided against using it.  Effectively, with one-copy, the kernel
copies the message from 
user space directly into the receive buffer for the destination process.
Kdbus might be fast enough to handle data streams as well as messages, but
Kroah-Hartman does not know if that will be implemented.
</p>

<p>
Because it is in the kernel, kdbus gets a number of attributes almost for
free.  It is namespace aware, which was easy to add because the namespace
developers have made it straightforward to do so.  It also integrated with
the audit subystem, 
which is important to the enterprise distributions.  For D-Bus,
getting SELinux support was a lot of work, but kdbus is Linux Security
Module (LSM) aware, so it got SELinux (Smack, TOMOYO, AppArmor, ...)
support for free. 
</p>

<h4>Current kdbus status</h4>

<p>
As a way to test kdbus, the systemd team has replaced D-Bus in systemd with
kdbus.  The code is available in the systemd tree, but it is still a work
in progress.  The kdbus developers are not even looking at speed yet, but
some rudimentary tests suggest that it is "very fast".  Kdbus will require
a recent kernel as it uses control groups (cgroups); it also requires some
patches that were only merged into 3.10-rc kernels.
</p>

<p>
The plan is to merge kdbus when it is "ready", which he hopes will be
before the end of the year.  His goal, though it is not a general project
goal, is to replace Android's binder with kdbus.  He has talked to the
binder people at Google and they are amenable to that, as it would allow
them to delete a bunch of code they are currently carrying in their trees. 
</p>

<p>
Kdbus will not "scale to the cloud", Kroah-Hartman said in answer to a
question from the audience, because it only sends
messages on a single system.  There are already inter-system messaging
protocols that can be used for that use case.  In addition, the network
maintainers placed a restriction on kdbus: don't touch the networking
code.  That makes sense because it is an IPC mechanism, and that is where
<tt>AF_BUS</tt> ran aground.
</p>

<p>
The automotive industry will be particularly interested because it is used
to using the QNX message passing, which it mapped to <tt>libdbus</tt>.  It chose
D-Bus because it is well-documented, well-understood, and is as easy to use
as QNX.  But, it doesn't just want a faster D-Bus (which could be achieved
by rewriting it), it wants more: namespace support, audit support, SELinux,
application separation, and so on.
</p>

<p>
Finally, someone asked whether Linus Torvalds was "on board" with kdbus.
Kroah-Hartman said that he didn't know, but that kdbus is self-contained,
so he doesn't think Torvalds will block it.  Marcel Holtmann said that
Torvalds was "fine with it" six years ago when another, similar idea had
been proposed. Kroah-Hartman noted that getting it past Al Viro might be
more difficult than getting it past Torvalds, but binder is "hairy code"
and Viro is the one who found the security problems there.
</p>

<p>
Right now, they are working on getting the system to boot with systemd
using kdbus.  There are some tests for kdbus, but booting with systemd will
give them a lot of confidence in the feature.  The kernel side of the code
is done, he thinks, but they thought that earlier and then Heo came up with
zero and one-copy.  He would be happy if it is merged by the end of the
year, but if it isn't, it shouldn't stretch much past that, and he
encouraged people to start looking at kdbus for their messaging needs in
the future.
</p>

<p>
[ I would like to thank the Linux Foundation for travel assistance so that I
could attend 
the Automotive Linux Summit Spring and LinuxCon Japan. ]<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#kdbus">kdbus</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Message_passing">Message passing</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Automotive_Linux_Summit_Spring-2013">Automotive Linux Summit Spring/2013</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/551969/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor552384"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ALS: Linux interprocess communication and kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2013 6:55 UTC (Fri)
                               by <b>sorokin</b> (guest, #88478)
                              [<a href="/Articles/552384/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; In the GNOME project, there is plan for something called "portals"</font><br>
<font class="QuotedText">&gt; that will containerize GNOME applications. That would allow running</font><br>
<font class="QuotedText">&gt; applications from multiple versions of GNOME at the same time while</font><br>
<font class="QuotedText">&gt; also providing application separation so that misbehaving or malicious</font><br>
<font class="QuotedText">&gt; applications could not affect others.</font><br>
<font class="QuotedText">&gt; ...</font><br>
<font class="QuotedText">&gt; Portals provides one of the main motivations behind kdbus.</font><br>
<p>
Could someone clarify why portals in GNOME require a new transport for D-Bus in kernel? Why it is not possible to continue to use UNIX domain sockets and provide separation in userspace?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/552384/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor552387"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ALS: Linux interprocess communication and kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2013 7:13 UTC (Fri)
                               by <b>alexl</b> (subscriber, #19068)
                              [<a href="/Articles/552387/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
True app sandboxing should be kernel enforced, but if you use a userspace dbus daemon implementation then the sandboxed application will be talking directly to a process that is not sandboxed (with no kernel involvement). This would "work", but its not really considered a robust sandbox. <br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/552387/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor552492"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ALS: Linux interprocess communication and kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2013 17:14 UTC (Fri)
                               by <b>Tobu</b> (subscriber, #24111)
                              [<a href="/Articles/552492/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>The trusted part could be in-kernel, or it could be the dbus daemon's code that deals with message serialisation and filtering.  It's academic because we seem to be wed to C, but userspace has access to languages, tools and type systems that could implement the sensitive parts of the daemon with much higher safety.</p>

<p>That said kdbus looks like a useful primitive, and getting rid of most of the copies and context switches could be a great enabler; users could put some extra security boundaries without worrying about throughput or latency.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/552492/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor552499"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ALS: Linux interprocess communication and kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2013 18:06 UTC (Fri)
                               by <b>brouhaha</b> (subscriber, #1698)
                              [<a href="/Articles/552499/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The networking people are opposed to AF_BUS because it sends messages on a single system? Sounds like a specious argument to me. Why aren't they removing AF_UNIX?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/552499/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor552534"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ALS: Linux interprocess communication and kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 31, 2013 22:52 UTC (Fri)
                               by <b>gregkh</b> (subscriber, #8)
                              [<a href="/Articles/552534/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That's not why they rejected AF_BUS, see the archives of the netdev mailing list for the full details as to why it was rejected if you are curious.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/552534/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor552545"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Google invented Bloom filters all the way back in 1970</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 1, 2013 0:45 UTC (Sat)
                               by <b>Tester</b> (guest, #40675)
                              [<a href="/Articles/552545/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The real interesting bit here is that Google has leaked that they have time travel, since they placds Blooms filters into Burton Howard Bloom's head back in 1970.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/552545/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor555077"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Google invented Bloom filters all the way back in 1970</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 18, 2013 9:11 UTC (Tue)
                               by <b>pixelpapst</b> (guest, #55301)
                              [<a href="/Articles/555077/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Maybe Google don't have time travel per se, but have positronic thought inducers capable of planting an idea into a past individual's brain. Or they will have.<br>
<p>
Good thing Burton wasn't wearing a tinfoil hat at the time, or KDBUS would be stuck with boring old hash tables as delivered into Ershov's head by the USSR/ASIEN empire.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/555077/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor553261"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ALS: Linux interprocess communication and kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 7, 2013 5:27 UTC (Fri)
                               by <b>swetland</b> (guest, #63414)
                              [<a href="/Articles/553261/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
pmem is obsolete and I'm not entirely sure why it found its way into staging in the first place.<br>
<p>
ashmem provides anonymous, shareable (via fd passing and mmap) memory without requiring /tmp, without having to worry about cleaning up after processes that leave stuff in /tmp, etc.  It also provides a mechanism for processes to indicate which chunks of these regions may be reclaimed by the kernel in low memory situations via the unpin/pin mechanism.  Android relies on it in a number of places and that is not likely to change, but if all the same semantics were provided via a slightly different mechanism, it could be migrated to.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553261/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor554485"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ALS: Linux interprocess communication and kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 14, 2013 19:51 UTC (Fri)
                               by <b>jstultz</b> (subscriber, #212)
                              [<a href="/Articles/554485/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yea, I don't know why he brought up pmem. And its not in staging (as far as I'm aware).<br>
<p>
And yea, I also don't understand the "lazy" characterization of ashmem either. <br>
<p>
I'm hoping the volatile range work will provide the same functionality as pinning/unpinning (which I think is a really cool feature of ashmem) in a more generic way.<br>
<p>
But there is still the need for getting passable fds to anonymous memory without having a tmpfs mount. And until that is solved I suspect we'll have to keep ashmem (although with the pin/unpin logic removed, it will be much simplified).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/554485/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor553271"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ALS: Linux interprocess communication and kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 7, 2013 11:35 UTC (Fri)
                               by <b>tibsnjoan</b> (guest, #3800)
                              [<a href="/Articles/553271/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As to KBUS.<br>
<p>
I'm one of the principle developers, and current maintainers, of KBUS. It was developed in-house at Kynesim (my employers) and is still used by us and our customers. Sadly, we are no longer students. We did make some attempt to submit it to the kernel (and Jonathan Corbet even wrote "The interface is ... creative"). Various people were helpful with their comments, but the impression we got was that if we didn't use sockets it wasn't going in.<br>
<p>
A lack of an existing visible user base also (quite correctly) made the LKML sceptical of our version of sliced bread.<br>
<p>
If anyone is interested in merging it, we'd be happy to look to that, but I'm now going to go away and read up on KDBUS.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553271/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor553506"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ALS: Linux interprocess communication and kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 9, 2013 18:07 UTC (Sun)
                               by <b>raalkml</b> (guest, #72852)
                              [<a href="/Articles/553506/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
kdbus has somewhat interesting interface:<br>
<p>
<a rel="nofollow" href="https://plus.google.com/109267255479262056080/posts/eN8Sdjmzwhd">https://plus.google.com/109267255479262056080/posts/eN8Sd...</a><br>
<p>
Why such a strange namespaces design for the API?<br>
The entry points of lower level API (bus) are higher up in the /dev/kdbus hierarchy than the higher level API (namespaces)!<br>
The bus API implementation even seems to had to add the uid to avoid name clashes with namespace API (namely "ns" directory, under which the namespaces are collected).<br>
I.e. why not /dev/kdbus/ns/{namespaces..}/bus/{buses...}/entries/{entries}? This way there may be no clash between the interface and user-affected elements in the API: namespaces and buses would be in directories completely for themselves.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553506/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor553663"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ALS: Linux interprocess communication and kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jun 10, 2013 17:16 UTC (Mon)
                               by <b>vrfy</b> (guest, #13362)
                              [<a href="/Articles/553663/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Higher level, lower level API?</font><br>
<p>
A set of buses *is* a namespace. What's high and low here?<br>
<p>
<font class="QuotedText">&gt; Clashes with the "namespace API"?</font><br>
<p>
What namespace API? There is none besides the one "control" node in<br>
every namespace.<br>
<p>
Namespaces should just look exactly like the host's /dev/kdbus/ interface,<br>
there is no separation of buses and namespaces, buses are just *in* a namespace.<br>
<p>
I don't really understand anything in that text. :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/553663/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor570494"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ALS: Linux interprocess communication and kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 16, 2013 8:18 UTC (Wed)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/570494/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Urgh!<br>
<p>
This all assumes someone would want to use D-Bus *at all*. /me shudders<br>
<p>
<a href="http://mid.gmane.org/20131016072853.GA1077@dinah">http://mid.gmane.org/20131016072853.GA1077@dinah</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/570494/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor570508"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ALS: Linux interprocess communication and kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 16, 2013 14:38 UTC (Wed)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/570508/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The responses on that thread don't seem to agree with your feelings. Personally, I run a system bus and not a session bus (until kid3 kicks one into existence), but kdbus doesn't seem like the end of the world. So my questions to you are: what sucks so much about kdbus, how would you fix it, and if you'd remove it, how would you do what it allows you to do now just as easily (mainly the signal notification and RPC calls)? Raw socket communication? Please, then we'd need some kind of parser and serializer anyways to avoid all kinds of bugs at which point you're half way to dbus anyways.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/570508/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor635334"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SIMPL is an userspace implementation which may not be as efficient as the original QNX's implementation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 3, 2015 15:25 UTC (Tue)
                               by <b>dirco</b> (guest, #92179)
                              [<a href="/Articles/635334/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; A lot of developers in the automotive world have</font><br>
<font class="QuotedText">&gt; used QNX, which has a nice message-passing model.</font><br>
<font class="QuotedText">&gt; You can send a message and pass control to another</font><br>
<font class="QuotedText">&gt; process, which is good for realtime and single</font><br>
<font class="QuotedText">&gt; processor systems, Kroah-Hartman said. Large</font><br>
<font class="QuotedText">&gt; automotive companies have built huge systems on</font><br>
<font class="QuotedText">&gt; top of QNX messages, creating large libraries used by</font><br>
<font class="QuotedText">&gt; their applications. They would like to be able to use</font><br>
<font class="QuotedText">&gt; those libraries on Linux, but often don't know that there</font><br>
<font class="QuotedText">&gt; is a way to get the QNX message API for Linux. It is</font><br>
<font class="QuotedText">&gt; called SIMPL and it works well.</font><br>
<p>
QNX message passing needs kernel support, as we can see in Wikipedia<br>
QNX article:<br>
<a rel="nofollow" href="https://en.wikipedia.org/w/index.php?title=QNX&amp;oldid=646426608">https://en.wikipedia.org/w/index.php?title=QNX&amp;oldid=...</a><br>
"QNX interprocess communication consists of sending a message from one<br>
process to another and waiting for a reply. This is a single<br>
operation, called MsgSend. The message is copied, by the kernel, from<br>
the address space of the sending process to that of the receiving<br>
process.<br>
If the receiving process is waiting for the message, control of the<br>
CPU is transferred at the same time, without a pass through the CPU<br>
scheduler. Thus, sending a message to another process and waiting for<br>
a reply does not result in "losing one's turn" for the CPU.<br>
This tight integration between message passing and CPU scheduling is<br>
one of the key mechanisms that makes QNX message passing broadly<br>
usable. Most Unix and Linux interprocess communication mechanisms lack<br>
this tight integration ... Mishandling of this subtle issue is a<br>
primary reason for the disappointing performance of some other<br>
microkernel systems such as early versions of Mach."<br>
It points out transferring CPU control directly from the sender process<br>
to the receiving process is the key step improving QNX IPC performance,<br>
which is in general not possible be implemented by merely userspace<br>
program on Linux.<br>
<p>
According to mails to SIMPL's group, I have confirmed that SIMPL is<br>
just an userspace implementation:<br>
"The main SIMPL source tree is all in user space. For most<br>
SIMPL users the performance is adequate and the codebase is much more portable<br>
and easy to maintain.<br>
<p>
There are kernel implementations of SRR that are compatible with SIMPL but<br>
none of those are recent.<br>
<p>
There is is also a SIPC variation. I know the developer who wrote this one.<br>
If you are interested I could connect you two and see if he has more recent<br>
stuff."<br>
so what we need would be a kernel implementation (like aforementioned SRR<br>
or SIPC) which integrates the special scheduling into the kernel if we want to<br>
have comparable performance with the original implementation.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/635334/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2013, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
