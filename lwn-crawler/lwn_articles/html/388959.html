        <!DOCTYPE html>
        <html lang="en">
        <head><title>2.6.35 merge window part 2 [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/388959/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/388515/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/388959/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>2.6.35 merge window part 2</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>We're bad at marketing</b>
<p>
We can admit it, marketing is not our strong suit. Our strength is
writing the kind of articles that developers, administrators, and
free-software supporters depend on to know what is going on in the
Linux world. Please <a href="/Promo/nsn-bad/subscribe">subscribe today</a> to help us keep doing that, and so
we donâ€™t have to get good at marketing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>May 26, 2010</br>
           </div>
Much code - some 6300 non-merge changesets - has gone into the mainline kernel
since <a href="http://lwn.net/Articles/388109/">last week's article</a>.
Listing all of the changes would be an impossible task, even for the
KernelNewbies folks who seem to get close, but an overview can be given.
The most interesting user-visible changes are:
<p>
<ul>

<li> The <a href="http://lwn.net/Articles/362339/">receive packet
     steering</a> and <a href="http://lwn.net/Articles/382428/">receive
     flow steering</a> mechanisms have been added to the networking subsystem.
<p>
<li> The <a href="http://lwn.net/Articles/368869/">memory compaction</a>
     patch set has been merged.  This should lead to less memory
     fragmentation and higher success rates for large allocations.
<p>
<li> A loophole which would, in some circumstances, allow a security module 
     to be registered at runtime has been closed; security modules must be
     present at boot time.
<p>
<li> The network traffic control subsystem is now namespace-aware.
<p>
<li> The "Communication CPU to Application CPU Interface" (CAIF) protocol,
     used to speak with ST-Ericsson modems, is now supported in the network
     stack.  Also supported in version 3 of the Layer Two Tunneling
     Protocol (L2TP - RFC 3931).
<p>
<li> "FunctionFS" is a mechanism by which user-space USB drivers can create
     USB gadgets with composite functionality.  The "f_uvc" driver builds
     on this feature to create a video capture device driven by data from
     user space.
<p>
<li> There is now support for the "restricted access regions" mechanism
     built into Intel "Moorestown" processors.  RAR can be used to block
     devices (including processors) out of specific regions of memory.
<p>
<li> The cpuidle "menu" governor now features <a
     href="http://lwn.net/Articles/387250/">idle pattern detection</a>
     which tries to be smarter about sleep-state selection based on recent
     system history.
<p>
<li> The slab allocator has gained memory hotplug support.
<p>
<li> Extended attributes are now supported in the squashfs filesystem.
<p>
<li> The size of the in-kernel buffer used to hold data for a pipe can be
     queried with the new <tt>F_GETPIPE_SZ</tt> <tt>fcntl()</tt> command,
     and changed with <tt>F_SETPIPE_SZ</tt>.  As of this writing, the units
     used by this command are page-sized buffers, but that will almost
     certainly change to bytes in the near future.
<p>
<li> Lots of new drivers:
<p>
<ul>
   <li> <b>Input</b>: Analog Devices AD714x capacitance touch sensors,
   	Hampshire serial touchscreens,
	TI TCA6416 keypads,
	Cando dual touch panels,
	Minibox PicoLCD devices,
	Prodikeys PC-MIDI Keyboard devices, and
	Roccat Kone mice.
   <p>
   <li> <b>Network</b>: Atheros HTC based wireless cards,
   	USB-connected Agere Orinoco wireless cards, and
	SBE wanPMC-C[421]E1T1 WAN adapters.
   	The ath5k driver has also gained adaptive noise immunity support, a
	feature which is said to nearly double throughput in noisy
	situations. 

   <p>
   <li> <b>Sound</b>: USB Audio Class v2.0 compliant devices,
   	Wolfson Micro WM1133-EV1 on i.MX31ADS systems,
	Wolfson Micro WM9090 amplifiers,
	TI TWL6040 codecs,
	Texas Instruments SDP4430 audio devices,
	Zipit Z2 WM8750 audio devices, and
	AudioScience ASI sound cards.
   <p>
   <li> <b>Storage</b>: devices with the SmartMedia/xd flash translation layer,
	Ricoh R5C852 xD card readers,
	MPC5121 built-in NAND flash controllers,
	Denali NAND controller on Intel Moorestown systems,
	Samsung OneNAND controllers, and
	QLogic PCIe QLE InfiniBand host	channel adapters.

   <p>
   <li> <b>Systems and processors</b>: much of the support code for the 
   	ARM "MSM" architecture, as found in the G1/ADP1 handset, has been
	merged.  Additionally: OMAP3 SBC STALKER boards and
	PowerPC 476 processors.
   <p>
   <li> <b>Video4Linux</b>: Trident TV Master tm5600/tm6000 chips,
   	SuperH VOU video output devices,
	AK8813/AK8814 video encoders and
	DataTranslation DT3155 frame grabbers.

   <p>
   <li> <b>Miscellaneous</b>: RDMA and iWARP on Chelsio T4 1GbE and 10GbE
     	adapters, 
	viafb-based i2c and GPIO devices,
	SuperH IrDA devices,
	Altera UARTs,
	GSM MUX line discipline support (in the TTY layer),
	Niagara2 stream processing units,
	ACX565AKM (Nokia N900) panels,
	Analog Devices ADIS16255 low power gyroscopes,
	Analog Devices ADIS16300 and ADIS16400/5 inertial sensors,
	Analog Devices ADIS16240 programmable impact sensors,
	Analog Devices ADIS16260/5 digital gyroscope sensors,
	Analog Devices ADIS16209 dual-axis digital inclinometer and
   	accelerometer devices,
	Timberdale FPGA DMA engines,
	ST-Ericsson DMA40 DMA controllers,
	Texas Instruments ADS7871 A/D converters,
	Freescale IMX2 hardware watchdogs,
	Freescale MPC512x PSC SPI controllers, and
	Cirrus EP93xx SPI controllers.
	<p>
	Additionally, "g_hid" is a USB gadget driver implementing the human
	interface device class specification, g_webcam is a gadget-side
	USB video device, and g_ffs allows the creation of USB composite
	functions.
   </ul>
</ul>
<p>
Changes visible to kernel developers include:
<p>
<ul>

<li> There is a new variant of <tt>request_irq()</tt>:
<p>
<pre>
    request_any_context_irq(unsigned int irq, irq_handler_t handler,
			    unsigned long flags, const char *name, 
			    void *dev_id);
</pre>
<p>
     This function connects the interrupt handler in the usual way.  The
     difference is that it looks at how the interrupt line itself was set
     up (by architecture-specific code) and decides whether to establish a
     traditional hard interrupt handler or a threaded handler.  The return
     value on success is either <tt>IRQC_IS_HARDIRQ</tt> or
     <tt>IRQC_IS_NESTED</tt>.
<p>
<li> Also related to <tt>request_irq()</tt>: the <tt>IRQF_DISABLED</tt>
     flag now does nothing; it will be removed entirely in 2.6.36.  All
     interrupt handlers are now called with interrupts disabled; see <a
     href="http://lwn.net/Articles/380931/">this article</a> for details on
     the change.
<p>

<li> The <a href="http://lwn.net/Articles/369549/">timer slack</a>
     mechanism has been merged.  Timer slack (which applies to old-style
     timers, not hrtimers) allows the system to defer timer expiration by a
     bounded amount in order to get timers to expire at the same time, thus
     minimizing system wakeups.
<p>
<li> The new function <tt>ktime_to_ms()</tt> converts a kernel time value
     to milliseconds.
<p>
<li> A number of unused security module hooks (<tt>task_setuid</tt>,
     <tt>sb_post_remount</tt>, <tt>sb_post_pivotroot</tt>,
     <tt>sb_umount_close</tt>, <tt>acct</tt>, <tt>inode_delete</tt>,
     <tt>sb_umount_busy</tt>, <tt>task_setgid</tt>,
     <tt>task_setgroups</tt>, <tt>sb_post_addmount</tt>,
     <tt>cred_commit</tt>, and <tt>key_session_to_parent</tt>) have been
     removed.
<p>
<li> The power management quality of service (pm_qos) system API has been
     significantly changed; see <a
     href="http://lwn.net/Articles/386139/">this article</a> for details.
<p>
<li> "Tagged directory support" has been added to sysfs.  This feature
     allows namespace-specific tags to be added to sysfs directories; these
     tags then control which version of a directory (if any) is visible
     within any given namespace.
<p>
<li> <tt>kref_set()</tt> has been removed after a determination that none
     of its three users were correct.
<p>
<li> The <tt>read()</tt>, <tt>write()</tt> and <tt>mmap()</tt> methods in
     <tt>struct bin_attribute</tt> have gained a new <tt>struct file</tt>
     pointer argument.
<p>
<li> The "kdb" low-level kernel debugger has been joined with kgdb and
     merged into the mainline.
<p>
<li> The checkpatch script will now complain if kernel configuration
     options are added with fewer than four lines of help text.
<p>
<li> There is <a href="http://lwn.net/Articles/389081/">a bunch of new
     infrastructure</a> in the Video4Linux2 subsystem, including a
     framework for supporting memory-to-memory devices (video processing
     engines), a mechanism for reporting asynchronous events to user space,
     and a new core subsystem for infrared controllers.

</ul>

<p>
In a normal merge window, changes would continue to flow into the mainline
until the end of the month.  Linus has made it clear that he no longer
guarantees "normal" merge windows, though, so the window could close sooner
than that.  Regardless, tune in next week for a summary of the final
changes to be merged for 2.6.35.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-2.6.35">Releases/2.6.35</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/388959/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor389580"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Memory compaction and the effect on fragmentation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 27, 2010 11:45 UTC (Thu)
                               by <b>mel</b> (guest, #5484)
                              [<a href="/Articles/389580/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Our esteemed editor said that compaction should lead to less fragmentation but this is not necessarily the case. Anti-fragmentation (preferably with min_free_kbytes adjusted as recommended by hugeadm or tuned automatically within the transparent hugepage tree) still is the key to handling fragmentation (i.e. not necessarily reducing but but giving the system options to handle it). Anti-frag aims to keep pages of different mobility within the same huge page boundaries. Compaction doesn't affect this directly although there would be some minor benfits when the linear scanner would take movable pages from an unmovable range of superpages and put them somewhere else.<br>
<p>
They key benefits it really brings are<br>
<p>
a) one can avoid lumpy reclaim so a contiguous page can be created faster by copying pages instead of dumping them with IO<br>
<p>
b) it can move pages that are mlocked so if locked pages are a major factor of the workload, they will have less impact on large allocations<br>
<p>
c) On swapless systems, the pages can be moved where as without compaction there is very little page reclaim can do about anonymous pages. This is probably the "big" use-case I am expecting in 2.6.35 because it's something that has been whinged about in clusters.<br>
<p>
d) if/when transparent hugepage support gets merged, it'll be cheaper to promote base pages to huge pages than if lumpy reclaim was used.<br>
<p>
A side-benefit is that it avoids some bad trashing from lumpy reclaim. It wasn't such a big deal before but it can cause trashing in the system. Waiting to writeback dirty pages is *slow* and its waiting logic can lead to large stalls as well. It's been on my TODO list to investigate this closely for some time and see if there is a better option which I'm hoping to get around to some time next month. It's been put on the long finger because there were other issues that were a lot more urgent over the last 6-12 months.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/389580/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2010, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
