        <!DOCTYPE html>
        <html lang="en">
        <head><title>A case for variant symlinks [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/680705/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/680615/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/680705/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>A case for variant symlinks</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="GAByline">
           <p>March 23, 2016</p>
           <p>This article was contributed by Neil&nbsp;Brown</p>
           </div>
<p>Variant symlinks are symbolic links that behave differently depending
on details of the process that reads or follows the link.  They have
a history going back at least to the 1980s when various vendors of
Unix systems wanted to be compatible with both BSD Unix from UCB (The
University of California at Berkeley), and System&nbsp;V Unix from AT&amp;T.
Details varied, but the core idea was that some attribute of a process
could be used to modify the target of a symlink or to select among
multiple options.  This would allow, <a href="https://en.wikipedia.org/wiki/Symbolic_link#Variable_symbolic_links">for example</a>, some processes to
see <tt>/bin</tt> as a symlink to <tt>/.ucbbin</tt>, while others
would see 
<tt>/.attbin</tt>.</p>

<p>While those issues are long behind us, the desire for variant symlinks
still pops up from time to time, most recently in a <a href="http://thread.gmane.org/CACsf_wyTqDyfwVnJeWC3ExO5Jeh5mjKxQP2HmJF6o9wuSXATaA@mail.gmail.com">proposal</a> by Cole Minnaar
for a "Variant Symlink Filesystem". The proposed filesystem — currently
implemented as an <a
href="https://github.com/onslauth/varsymfs">out-of-tree kernel 
module</a> — takes an extremely simple approach to the problem.  The
filesystem provides a single directory that contains a single symlink
called <tt>resolve</tt>.  When any process reads or follows this link, the
filesystem looks though that process's environment for a particular
environment variable, specified when the filesystem is mounted, and
reports the value of that variable as the content of the symlink.</p>

<p>To use this you would mount a filesystem at some well known location
and create links that pass though that location.  For example</p>
<pre>
    # mount -t varsymfs -o UNIVERSE none /.universe
    # ln -s /.universe/resolve/bin /bin
</pre>

<p>Then:
<pre>
    $ UNIVERSE=/att ls -lL /bin
</pre>
would show the contents of <tt>/att/bin</tt>,
while:
<pre>
    $ UNIVERSE=/ucb ls -lL /bin
</pre>
would show those of <tt>/ucb/bin</tt>.</p>

<p>The responses to this proposal were pretty much as would be expected:
Minnaar was told that he should use a <a
href="https://lwn.net/Articles/68104/">FUSE</a> filesystem
written in user space, or use
<a href="https://lwn.net/Articles/531114/">mount namespaces</a> to give different processes a different view of the
system.  Minnaar made it clear that this wasn't just a new idea with no
history, but was something he has been working on for some time.  Both
those ideas had been tried and found wanting.</p>

<p>The problem with a FUSE-based solution is performance.  Though the
special filesystem 
is not used for any filesystem I/O and is only needed to look up a
single symbolic link, a performance decrease can still be measured.  By its
nature, a variant symbolic link cannot be cached in the VFS layer, so
every request would need to go to user space and back into the
kernel.  <a href="/Articles/650786/">Recent work</a> has made symlink
lookup largely lockless because, 
for some workloads, even requiring spinlocks for following a symlink
can be too expensive.  This was found to be particularly true when
compiling code, since searching for include files generates lots of
filename lookups.  Minnaar identified compilation as a problematic case for
FUSE-based variant symlinks too, and even the cost of that spinlock —
sufficient to justify a rewrite of the symlink lookup code — is tiny
compared to the cost of scheduling a user-space process to provide an
answer.</p>

<p>The situation with mount namespaces brings its own set of problems,
though of a very different kind.  A large part of the focus on namespaces
has been the creation of containers to contain processes — once 
in a container, the process shouldn't be able to get out.  Minnaar is
not interested in that side at all.  He is interested in convenience
rather than containment.

<p>
  The example he sketched was to support multiple versions of packages
   that require the use of fixed paths. Many packages, such as Perl and
   Emacs, include a version number in the path names used for finding
   support files, such as <tt>/usr/lib/perl5/site_perl/5.22.1</tt>.  This
   allows multiple versions to be installed side by side.  Many other
   packages are not so enlightened, allowing only one version to be installed
   at a time.  It would be possible to fix such packages to support
   parallel installations, but it seems it was easier to implement
   variant symlinks.  That way each package can behave as though it owns
   the standard path names and each user can select their preferred package
  version 
   by setting up some environment variables.

<p>When it comes to convenience, filesystem namespaces have two
problems, one that was mentioned and one that wasn't — yet.  The first
problem is that the Unix shell doesn't have a &quot;<tt>chns</tt>&quot; command to
change namespaces.  While you can certainly use <tt>nsenter</tt>, as David
Lang <a href="http://mid.gmane.org/alpine.DEB.2.02.1603111440160.1949@nftneq.ynat.uz">suggested</a>, this creates a new shell rather than adjusting the
state of the old shell.  There is a  good reason that <tt>cd</tt> or
<tt>chdir</tt> is built into the shell — having it external would be nowhere
near as convenient.  In the same way, <tt>nsenter</tt> would only be as
convenient as <tt>export UNIVERSE=/att</tt> if it was built-in.</p>

<p>The second problem is the inevitable combinatorial explosion that
namespaces would cause.   If there is only a need to select on one axis,
<tt>ucb</tt> 
or <tt>att</tt>, then namespaces could be made to work.  If
independently selecting between versions of a dozen packages is needed,
then there would be a need for
potentially thousands of namespaces, one for each
combination.  In practice, this explosion may not happen, but the need
to construct namespaces on demand might not be the most convenient
approach.</p>

<p>While variant symlinks may well be useful, it would help to have a
variety of concrete use-cases to examine so that we could see exactly
how they would be used and informed implementation choices could be
made.  It is easy to &quot;bikeshed&quot; some variations, like whether a
constant 
prefix should be provided at mount time so the environment variable
values don't need to start with &quot;/&quot;.  However, such bikeshedding is
likely to focus on the inconsequential and miss the essential.  What
we need, as Al Viro <a href="http://article.gmane.org/gmane.linux.kernel/2175270">indicated</a>, is to ask "<q>the right questions for
figuring out what requirements</q>" there are, so as to determine
"<q>the best way to do it</q>".  Whether anything like that
occurs remains to be seen.</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems">Filesystems</a></td></tr>
            <tr><td><a href="/Archives/GuestIndex/">GuestArticles</a></td><td><a href="/Archives/GuestIndex/#Brown_Neil">Brown, Neil</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/680705/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor681166"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 24, 2016 2:22 UTC (Thu)
                               by <b>k8to</b> (guest, #15413)
                              [<a href="/Articles/681166/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The most disturbing part of this article is the implicit acceptance of "hidden" directories by use of the intiial dot.  Surely we should have learned by now that hiding things this way just moves the mess around.  A fully normal target filepath should be used even for variant target locations like the article discusses.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681166/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor681174"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 24, 2016 6:22 UTC (Thu)
                               by <b>rsidd</b> (subscriber, #2582)
                              [<a href="/Articles/681174/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      Dragonfly BSD has supported variant symlinks for over 12 years now.  FreeBSD started a port a couple of years later but it never seems to have been officially released.  It would be nice if a Linux implementation would be compatible.  It works like this (from <A HREF="https://wiki.freebsd.org/200808DevSummit?action=AttachFile&do=get&target=variant-symlinks-for-freebsd.pdf">slides</A> by Brooks Davis of FreeBSD)
<PRE>
Symbolic links that change targets based on variables
$ echo bar &gt;  bar; echo baz &gt;  baz
$ ln -s ’${XXX}’ foo
$ ls -l foo
lrwxr-xr-x 1 brooks wheel ... foo -&gt;  ${XXX}
$ varsym XXX=bar cat foo
bar
$ varsym XXX=baz cat foo
baz
</PRE>
      
          <div class="CommentReplyButton">
            <form action="/Articles/681174/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681314"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 25, 2016 1:34 UTC (Fri)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/681314/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <p>But then we hit the problem of compatibility. Someone, somewhere have used ${XXX} as a filename, I'm sure. S/he'll be quite sad to find out that Linux just went and broke the world!</p>

<p>We may argue that it was a mistake to allow all symbols (except for '/') in the names of files, but at this point it's kinda too late to change that. Especially for such a "minor" reason: it'll be nice to have "Linux will be compatible with Dragonfly" but I'm pretty sure that "Linux should be compatible with Linux" takes precedence...</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/681314/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681461"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2016 3:59 UTC (Sun)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/681461/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
Someone, somewhere have used ${XXX} as a filename, I'm sure. S/he'll be quite sad to find out that Linux just went and broke the world!
</blockquote>
<p>
I think it's much more likely that someone is using 'resolve' as a filename, so the proposal in the article suffers from the same fundamental problem.

      
          <div class="CommentReplyButton">
            <form action="/Articles/681461/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681463"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2016 5:24 UTC (Sun)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/681463/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
FWIW, you can have a bunch of processes in different namespace with everything<br>
except one mountpoint shared.  /etc/var is bound to itself in all of them.  Have your session start with cloning the namespace, then mount --make-private /etc/var,<br>
mount --bind /etc/sessions/&lt;number&gt; /etc/var and you are all set.  Bind whatever you like on /etc/sessions/&lt;number&gt;/&lt;var&gt;, and /etc/var/foo will resolve for you to whatever's bound on /etc/sessions/&lt;number&gt;/foo.<br>
<p>
You want to switch to the context of session 42?  No problem, unshare namespace, mount --make-private /etc/var; mount --bind /etc/sessions/42 /etc/var  and there you are.  Anything mount/umount anywhere other than /etc/var itself will propagate to all sessions.  Want to switch to another sessions?  Do the same...  Want to change the meaning of /etc/var/splat for session 69?  No problem, umount /etc/sessions/69/splat; mount --bind your_new_target /etc/sessions/69/splat and you are all set.<br>
<p>
There's really no need for that thing.  And with all due respect to Matt, DFBSD occasionally suffers from "FBSD core team had been too willing to say no, somebody ought to try that feature, so let's be that somebody".   Sometimes it works, sometimes... AFAICS, variant symlinks had landed there with no better reason than that.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681463/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681513"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2016 21:48 UTC (Sun)
                               by <b>devkev</b> (subscriber, #74096)
                              [<a href="/Articles/681513/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The problem with doing it this way is that (last time I checked at least, which was a while ago now), doing things like mount --make-private and mount --bind requires root.  Because the target here is regular users, this means messing around with setuid, sudo or userns, which is terribly inconvenient.<br>
<p>
It also makes it hard/impossible for a user process (like an interactive shell) to switch at any time, because generally setuid helpers (and similar) will run before the process has started, and the process later has no way of re-escalating in order to change the filesystem.  (Again, I'm not sure if this is still the case; userns in particular seems like it aims to perhaps address this.)<br>
<p>
The idea here is to have something that is as convenient for regular users to change as $PATH or $EDITOR - but for software which is too dumb to respect an environment variable, and instead always goes looking for something at a fixed path like /foo/bar/baz.  Variant symlinks allow users to easily control what is actually found at that fixed path, just by changing the right environment variable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681513/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor681593"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2016 23:17 UTC (Mon)
                               by <b>koverstreet</b> (subscriber, #4296)
                              [<a href="/Articles/681593/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The trouble I see with the mount namespaces stuff is that it inherently requires pinning kernel memory O(# of variants) - this rules it out for a lot of interesting use cases and makes non root usage inherently problematic.<br>
<p>
I don't have any compelling use cases myself though, so I don't have any strong opinions here...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681593/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor681462"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2016 4:54 UTC (Sun)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/681462/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I've seen files with ${blah} in names. In my experience they usually come from failed substitutions in various log systems.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681462/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor681500"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2016 17:21 UTC (Sun)
                               by <b>joey</b> (guest, #328)
                              [<a href="/Articles/681500/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I remember using variant symlinks on linux circa 1997. Presumably via some shady kernel patch. To do crazy NFS client stuff with partially shared trees, IIRC. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681500/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681509"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2016 20:35 UTC (Sun)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/681509/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There was a user-space NFS server that supported variant symlinks - it interpolated the client hostname or something similar into properly marked symlinks.  I knew about it because someone wanted the kernel NFSd to do the same thing, but I couldn't see the point. Each client trivially has it's own mount namespace so mounting things differently on different clients can solve the same problem.<br>
<p>
Maybe you were using that NFS server?  I went looking for it recently and couldn't find it.  I just tried again and found  <a href="https://sourceforge.net/projects/clusternfs/">https://sourceforge.net/projects/clusternfs/</a> and <a href="http://marc.info/?t=99294659600001&amp;r=1&amp;w=2">http://marc.info/?t=99294659600001&amp;r=1&amp;w=2</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681509/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor681179"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 24, 2016 6:52 UTC (Thu)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/681179/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This article reminds me of Hurd's translators functionality. I'd love to have that in Linux.<br>
<p>
<a href="https://www.gnu.org/software/hurd/hurd/translator.html">https://www.gnu.org/software/hurd/hurd/translator.html</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681179/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor681198"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 24, 2016 10:15 UTC (Thu)
                               by <b>peter-b</b> (subscriber, #66996)
                              [<a href="/Articles/681198/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I've been using environment modules (<a href="http://modules.sourceforge.net/">http://modules.sourceforge.net/</a>) for a decade, and it's highly unclear from this article what problems variant symlinks solve that can't more-than-adequately be addressed by the use of environment modules...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681198/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681420"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 25, 2016 23:51 UTC (Fri)
                               by <b>reubenhwk</b> (guest, #75803)
                              [<a href="/Articles/681420/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Environment variable are a horrible way to provide a user interface...seems like variant symlinks are just as bad.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681420/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor681456"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 26, 2016 23:45 UTC (Sat)
                               by <b>devkev</b> (subscriber, #74096)
                              [<a href="/Articles/681456/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I agree that environment variables are an excellent user-configurable way of doing this, and that environment modules are ace.
<p>
As the article explains, not every piece of software is smart enough to be able to use environment variables to find their files.
<p>
"<em>... multiple versions of packages that <strong>require the use of fixed paths</strong>.</em>"
<p>
Environment modules can't address this problem.  Variant symlinks are a way of fixing all such software "at once", without needing to dig into the guts of each one individually to add the necessary calls to getenv().  <em>Then</em> you can use environment modules nicely with these packages.
      
          <div class="CommentReplyButton">
            <form action="/Articles/681456/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor681264"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 24, 2016 15:25 UTC (Thu)
                               by <b>madscientist</b> (subscriber, #16861)
                              [<a href="/Articles/681264/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I used variant symlinks (probably that's not what they were called, but the same idea) on DG/UX back in the late 1980's/early 1990's and they were extremely handy.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681264/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor681464"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2016 6:56 UTC (Sun)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/681464/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Is there any precedent for the kernel using a process' environment variables?

      
          <div class="CommentReplyButton">
            <form action="/Articles/681464/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681514"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2016 22:19 UTC (Sun)
                               by <b>devkev</b> (subscriber, #74096)
                              [<a href="/Articles/681514/">Link</a>] 
      </p>
      
      </div>
      </summary>
      The kernel module includes its own <a href="https://github.com/onslauth/varsymfs/blob/master/environment.c">code for searching through the process's environment</a>.  I can't seem to find any in-tree code which touches <tt>env_start</tt>/<tt>env_end</tt> in any meaningful or similar way.  So I think the answer is "no".
      
          <div class="CommentReplyButton">
            <form action="/Articles/681514/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor681546"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2016 11:50 UTC (Mon)
                               by <b>alankila</b> (guest, #47141)
                              [<a href="/Articles/681546/">Link</a>] (29 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
IMHO, better just fix the packages to support side-by-side installing, and not make filename lookups any tiny bit more complex and thus difficult to understand than they already are. I would in fact prefer symlinks to be removed altogether, because they tend to confuse the meaning of "..": is it the removal of the last path entry, or access to the actual parent directory dentry?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681546/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681548"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2016 14:33 UTC (Mon)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/681548/">Link</a>] (27 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I would in fact prefer symlinks to be removed altogether, because they tend to confuse the meaning of "..": is it the removal of the last path entry, or access to the actual parent directory dentry?</font><br>
<p>
I would rather keep the symlinks and instead remove the second meaning. Give up on the idea of a single canonical parent directory by eliminating "." and ".." as fixed entries in the directory listing, and instead interpreting them in the context of the stack of inodes actually traversed to reach the current point.<br>
<p>
Note that symlinks are not the only case that confuses "..": there are also bind mounts, and the occasional hard-linked directory. (I've run into this latter case often when using the Rational ClearCase filesystem for dynamic views... it won't let you create directory links per se with the "ln" command, but there are plenty of other ways to achieve the same effect, e.g. by moving a directory and then reverting the change to one parent directory and not the other, or by configuring a view to select the version of one directory before the move and the other directory after the move. The same situation could be created easily by any FUSE filesystem.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681548/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681573"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2016 16:44 UTC (Mon)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/681573/">Link</a>] (23 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you can get .. confused by mount --bind, report a bug.  It should not happen.  If your filesystem (be it ClearCase or an equally growth-promoting organic product of any other origin) has hardlinks to directories, it's broken.  Either due to outright fs image corruption or by design.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681573/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681594"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2016 23:33 UTC (Mon)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/681594/">Link</a>] (22 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The confusing part is that there is more than one legitimate parent directory for a bind mount: the directory containing the mount point, and the directory containing the bind target. The ".." entry for a bind mount points to the former, but there may well be cases where the latter would make more sense. For example, a symlink with a ".." relative path inside a bind mount will traverse the mount point rather than referring to the target in the original filesystem:<br>
<p>
$ mkdir a<br>
$ mkdir b/c<br>
$ sudo mount --bind a b/c<br>
$ ln -s ../x a/y<br>
$ ls -l a/y b/c/y<br>
lrwxrwxrwx 1 user user 4 Mar 28 00:00 a/y -&gt; ../x<br>
lrwxrwxrwx 1 user user 4 Mar 28 00:00 b/c/y -&gt; ../x<br>
$ touch a/y<br>
$ cat b/c/y<br>
cat: b/c/y: No such file or directory<br>
$ readlink -f a/y b/c/y<br>
/home/user/test/x<br>
/home/user/test/b/x<br>
<p>
As for other filesystems... you can call it "broken" all you want, but given the existence of network filesystems and FUSE, tools need to be able to deal with hard-linked directories anyway. In my opinion it would be better to normalize the arrangement rather than treat it as an exceptional condition.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681594/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681598"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 2:24 UTC (Tue)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/681598/">Link</a>] (21 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
'..' _always_ refers to the parent of mountpoint, no matter which kind of mount it is. Both when it occurs in symlink body and when it comes from the pathname itself. Binding is no different from other mounts.<br>
<p>
And filesystem with hardlinks to directories *is* broken, period.  Sure, NFS server (or FUSE, or...) can produce bogosities and we'd better avoid crashing on that.  The same goes for corrupted ISO image, etc.  We do avoid crashing, but you get all kinds of unpleasantness for userland.  Same as you do if e.g. NFS server ignores locks, etc.<br>
<p>
As for your example, it has nothing to do with symlinks.  a/../x and b/c/../x will also resolve to different things.   Same as they would if you mounted the same fs on a and on b/c - a/.. and b/c/.. already leave the filesystem(s) mounted on a/ and b/c/ resp.  And lead into different directories - parents of those mountpoints.<br>
<p>
'..' semantics is *NOT* plain "follow the link named '..'" and adding "... and pretend that this entry in root directory is patched at mount time" also isn't enough.  In fact, that appendix hadn't been done until v7 - v6 has /usr/../bin resolving to /usr/bin.   In v7 they'd fixed _that_ (essentially by faking .. in root directory), but chroot(2) was not handled by that - chroot to /mnt and /.. will refer to global root.  That got fixed about a year later, when somebody had spotted that bug - hard to tell who, but 4BSD went through two versions of fix, the later variant being a part of resync with what was to become v8.<br>
<p>
And old behaviour was just plain wrong.  They hadn't sorted the mount semantics out until _after_ v7, unfortunately.  Hell, just look at the mess that was heterogenous filesystems handling - everything from "boot this kernel if you want Berkeley filesystem support, this - if you want the Missed'em'V one, and if you need to access both, too bad, can't do that" to the fun still visible in  arch/alpha/kernel/osf_sys.c:osf_mount(), where we had to imitate the oh-so-wonderful API from OSF/1.  Research branch had introduced mixing filesystem types (had to - they wanted network filesystem, for starters, and the same work had allowed them to get procfs pretty much for free), but that had happened about 4 years too late ;-/   Pity, that...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681598/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681599"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 2:29 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/681599/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; And filesystem with hardlinks to directories *is* broken, period.</font><br>
Uhm... Why (apart from the problem with cyclical references)?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681599/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681600"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 4:13 UTC (Tue)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/681600/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Because POSIX has the notion of directory being an ancestor of another directory, and it becomes just about impossible to calculate - not without the full search of directory tree.  And no, "following .. links until we loop or reach root" does not yield the right semantics.  That's just for starters - you also get all kinds of fun problems with caching lookups, getcwd(2) behaviour, etc.  It's really a case of "doctor, it hurts when I do it".  The best we can do is to try and avoid crashes; if you have two links to a directory, chdir into a subdirectory of one, then lookup on a path going through another will end up either with lookup failing with EBUSY, or getcwd(2) flipping as if our directory had been moved to new location.  For rename() done on server it's the best approximation to the right thing, for real multiple links... at least it avoids kernel crashes/deadlocks/etc.  Can surprise the userland, but there's really fuck-all we *can* do in that situation.  And that's not just getcwd(2) - lookups on ../../../.. will match the other location as well.  Until somebody does a lookup going through the original link.  Or the third one, etc.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681600/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681602"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 4:39 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/681602/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm still not understanding it. We can already have cyclical links with bind mounts or good old symlinks.<br>
<p>
Ah... I see it, it's impossible to determine which parent should be used if a user wants to get the ancestor of a directory through getdents() or something similar (after fchdir() for additional fun).<br>
<p>
I believe that it's still possible to produce directory hardlinks if directories are always identified by their full paths. It should even be POSIX-compatible if opendir() and friends were saving the path information in the file descriptor metadata inside the kernel.<br>
<p>
However, it definitely looks like there's way too much overhead for such a niche feature.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681602/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681626"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 13:38 UTC (Tue)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/681626/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It should even be POSIX-compatible if opendir() and friends were saving the path information in the file descriptor metadata inside the kernel.</font><br>
<font class="QuotedText">&gt; However, it definitely looks like there's way too much overhead for such a niche feature.</font><br>
<p>
Doesn't the kernel do that anyway? How else could you have the /proc/*/fd entries with the original paths?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681626/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681769"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2016 17:28 UTC (Wed)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/681769/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Those are "just" soft symlinks - there's no guarantee that a procfs fd points to a currently-existing file, or even something that ever was a valid file (anon shm, sockets, eventfds...)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681769/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681791"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2016 19:19 UTC (Wed)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/681791/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Right, but for disk files the kernel does keep track of the location (vfsmount, dentry) for each FD, which isn't too different from what it would need to track for fchdir() etc.<br>
<p>
The /proc/*/fd/* entries are actually a bit special compared to normal symlinks. Even if the path returned by readlink() no longer exists, a process can still open /proc/*/fd/* and obtain a duplicate of the original file descriptor; the open() call operates on the file descriptor rather than following the link. This allows you to obtain a reference to an unlinked file, as long as it's still open somewhere.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681791/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681807"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2016 21:13 UTC (Wed)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/681807/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Egads...  Once more, with feeling: suppose a and b are links to the same directory.  Should a/x and b/x have the same dentry or separate ones?  If it's the same one, how do you reconstruct the path by it?  If not,  what should happen after rename("a/x", "c/z") to the dentry of b/x?<br>
<p>
Note that for different mounts you get the same dentry and separate vfsmounts.  However, cross-mount rename() is not allowed and for a very good reason; loop detection on rename is needed and it's hell in any graph other than a tree + some edges leading from that tree to terminal nodes.<br>
<p>
While we are at it, what about the questions I'd asked in <a href="http://lwn.net/Articles/681667?">http://lwn.net/Articles/681667?</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681807/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor681827"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2016 23:05 UTC (Wed)
                               by <b>bfields</b> (subscriber, #19510)
                              [<a href="/Articles/681827/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"How else could you have the /proc/*/fd entries with the original paths?"<br>
<p>
[bfields@pad ~]$ mkdir foo<br>
[bfields@pad ~]$ sleep 100 &gt;foo/P &amp;<br>
[1] 20041<br>
[bfields@pad ~]$ ls -l /proc/20041/fd/1<br>
l-wx------. 1 bfields bfields 64 Mar 30 15:35 /proc/20041/fd/1 -&gt; /home/bfields/foo/P<br>
[bfields@pad ~]$ mv foo bar<br>
[bfields@pad ~]$ ls -l /proc/20041/fd/1<br>
l-wx------. 1 bfields bfields 64 Mar 30 15:35 /proc/20041/fd/1 -&gt; /home/bfields/bar/P<br>
<p>
As others have said, it's storing a (vfsmount, dentry) pair and using that to walk up the root to create the path returned by readlink.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681827/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor682601"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 5, 2016 19:27 UTC (Tue)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/682601/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Which is also how it knows it is broken after (not real output, but just continuing the "session" from above):<br>
<p>
$ rm bar/P<br>
$ touch bar/P<br>
$ ls -l /proc/20041/fd/1<br>
l-wx------. 1 bfields bfields 64 Mar 30 15:35 /proc/20041/fd/1 -&gt; /home/bfields/bar/P (deleted)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/682601/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor681604"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 4:58 UTC (Tue)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/681604/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; '..' _always_ refers to the parent of mountpoint, no matter which kind of mount it is.</font><br>
<font class="QuotedText">&gt; As for your example, it has nothing to do with symlinks. a/../x and b/c/../x will also resolve to different things.</font><br>
<font class="QuotedText">&gt; Same as they would if you mounted the same fs on a and on b/c - a/.. and b/c/.. already leave the filesystem(s) mounted on a/ and b/c/ resp.</font><br>
<p>
I never said they didn't. It's still non-intuitive that the same symlink can refer to two different locations depending on how you get to it—the directory it's in no longer has a single canonical parent dentry. That is a relatively recent phenomenon (for non-networked, non-virtual filesystems) since it only occurs when the same filesystem is mounted in more than one place, which most commonly occurs with bind mounts. Before the addition of bind mounts you could generally only mount a given block device at one VFS path at a time. These days, of course, if you try that the result is the same as using mount --bind.<br>
<p>
The point wasn't about symlinks at all, it was that mount --bind already creates the equivalent of runtime directory hardlinks with semantics very similar to what I proposed—just at the VFS layer, rather than inside the filesystem, and using ad-hoc exceptions to the normal in-filesystem path lookup rules for ".." (like other mount points, yes) instead of a single set of rules that would apply to all uses of ".." in a pathname.<br>
<p>
<font class="QuotedText">&gt; And filesystem with hardlinks to directories *is* broken, period.</font><br>
<p>
Only because there is a rule saying "filesystems shall not have directory hardlinks". But everything that deals with filesystems has to allow for that possibility anyway, so why bother pretending? Just assume that there is no such thing as a single authoritative parent directory from the start.<br>
<p>
<font class="QuotedText">&gt; '..' semantics is *NOT* plain "follow the link named '..'" and adding "... and pretend that this entry in root directory is patched at mount time" also isn't enough. In fact, that appendix hadn't been done until v7 - v6 has /usr/../bin resolving to /usr/bin. In v7 they'd fixed _that_ (essentially by faking .. in root directory), but chroot(2) was not handled by that - chroot to /mnt and /.. will refer to global root. That got fixed about a year later, when somebody had spotted that bug - hard to tell who, but 4BSD went through two versions of fix, the later variant being a part of resync with what was to become v8.</font><br>
<p>
My point exactly. The current system, where ".." is part of the filesystem and selectively overridden by the VFS for mount points, chroot(2), etc., is overly complicated. Just make ".." go back to whichever directory you just came from. Then the chroot issue would be trivial: reset the process's "directory stack" and no ".." can possibly get out of the chroot, since there is no "back" reference to follow.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681604/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681606"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 5:22 UTC (Tue)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/681606/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Could you show me the place where we look at the contents of '..' directory entry on disk?  In pathname resolution, that is.  I believe that am reasonably familiar with the current system, and I am not aware of any place where we would do that.  We *do* look at that thing in one place - nfsd finding the pathname corresponding to fhandle it got from server does that in case of many local filesystem.  However, that is nowhere near any system calls that would take pathnames as arguments.<br>
<p>
As the matter of fact, .. is resolved entirely within fs/{namei,namespace}.c, without any calls of filesystem methods.  So may I ask what the hell are you talking about?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681606/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681608"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 5:45 UTC (Tue)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/681608/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
BTW, going back to where we'd just come from is not enough - consider e.g. ../.. for trivial counterexample.  You'll need more than that.<br>
<p>
Another fun issue to consider: there's no such thing as _the_ directory symlink is in - multiple hardlinks to a symlink are possible.<br>
<p>
And another: loop avoidance in rename(2) and sane locking order.<br>
<p>
Have fun.  If you come up with something workable, the list to post it on is linux-fsdevel.  I'm absolutely serious - any reasonable proposal with enough details to be possible to review (i.e. not a vague handwaving) will be discussed.  Knowing your way around the existing algorithms and data structures is a requirement, though - discussion will inevitably contain references to and comparisons with what's currently there, so you'll need to be reasonably familiar with at least the overall structure of the damn thing.  Neil's articles on lwn make a sane starting point and point to the areas to RTFS through...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681608/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681627"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 13:55 UTC (Tue)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/681627/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Could you show me the place where we look at the contents of '..' directory entry on disk?</font><br>
<p>
Why? I'm not claiming that anyone is using the ".." directory entry on disk. This is about the logical ".." entry which appears as a fixed entry in the directory listing, with the corresponding assumption that there is exactly one canonical parent for each directory. Nothing to do with how filesystems are stored on disk—or even whether they *are* stored on disk, as this also applies to network and FUSE filesystems.<br>
<p>
<font class="QuotedText">&gt; BTW, going back to where we'd just come from is not enough - consider e.g. ../.. for trivial counterexample. You'll need more than that.</font><br>
<p>
Yes, that's why I've been saying the system would use a stack of directories for context. "Going back to where we'd just come from" means popping the most local directory off that stack. ../.. means "go back two directories", not "go back and then return to the first directory". All of this is obvious from what has already been stated elsewhere in this thread.<br>
<p>
<font class="QuotedText">&gt; Another fun issue to consider: there's no such thing as _the_ directory symlink is in - multiple hardlinks to a symlink are possible.</font><br>
<p>
Yes, and this reinforces my point. We don't insist on a single parent directory for files, or device nodes, or symlinks—or even whole filesystems, given the existence of bind mounts—so why must there be a single parent directory for ordinary directories?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681627/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681629"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 14:34 UTC (Tue)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/681629/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
List of ancestor directories per _process_ won't be enough - consider fchdir(2).  It would have to be kept for each opened directory.  And that will give you chroot(2) problems right back, not to mention the joy you'll get when somebody does a cross-directory rename(2).  Or descriptor-passing between processes with different roots.  Now, consider what open(2) becomes in terms of grabbing references on everything in that list, and these *are* going to be heavily shared in the initial elements, so we are talking about cacheline bouncing from hell.<br>
<p>
BTW, as for the /proc/*/fd/*, we do not keep the _original_ pathnames for those; what we do keep is a (vfsmount,dentry) pair for opened file, with _current_ ancestors found by that.  With multiple links to directories you'd need to keep track of which links have you passed through.  What's more, unlink() becomes really messy in terms of cache coherency - if a and b are links to the same directory, and x and y are links to the same file, you want unlink a/x to make a/x and b/x negative, leaving a/y intact.  And it gets even more fun when you consider _negative_ cache entries - after that unlink, creation of (new) a/x should locate the negative cache entry for b/x and either turn it positive or evict it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681629/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681659"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 21:24 UTC (Tue)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/681659/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; List of ancestor directories per _process_ won't be enough - consider fchdir(2). It would have to be kept for each opened directory. And that will give you chroot(2) problems right back...</font><br>
<p>
Doesn't fchdir() already cause problems for chroot(2) environments, if you allow a process inside the chroot access to a file descriptor for an outside directory? How is this any different?<br>
<p>
<font class="QuotedText">&gt; ... not to mention the joy you'll get when somebody does a cross-directory rename(2).</font><br>
<p>
Relative paths based on an existing reference to the moved directory would retrace the original route and ignore the rename. This is more intuitive than entering a directory by one path and leaving it by another because some other process moved it elsewhere in the filesystem in the meantime.<br>
<p>
<font class="QuotedText">&gt; BTW, as for the /proc/*/fd/*, we do not keep the _original_ pathnames for those; what we do keep is a (vfsmount,dentry) pair for opened file, with _current_ ancestors found by that.</font><br>
<p>
Yes, that is exactly how I thought it worked. The pathnames are reconstructed from the dentries when the links are read. This part wouldn't change much, if at all. The dentry would indicate the path used to open the file.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681659/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681667"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 22:12 UTC (Tue)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/681667/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
1) fchdir() to something inside the subtree you are chrooted into does *not* cause any problems.<br>
<p>
2) define "retrace the original route".   I have a process with current directory in /tmp/foo/bar/baz; /tmp/foo is renamed to /tmp/foo2, either by this process or by any other.  What should ../barf resolve to before and after that rename?<br>
<p>
3) if for a and b being hardlinks to the same directory you want a/x and b/x to have different dentries, please explain how would you deal with operations on one of them affecting the rest, especially since if a/y is a hardlink to a/x, operations on b/x should affect a/x and a/y differently.  Starting with unlink(2), but rename a/x to c/z would also be an interesting one - where should an existing dentry for b/x end up?<br>
<p>
4) for extra fun, explain how to handle ELOOP in rename(2), and no, "just stop treating that as an error" is not an option - once you allow loops, preventing detached subgraphs on subsequent rename() becomes very hard.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681667/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681670"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 23:01 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/681670/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; 2) define "retrace the original route". I have a process with current directory in /tmp/foo/bar/baz; /tmp/foo is renamed to /tmp/foo2, either by this process or by any other. What should ../barf resolve to before and after that rename?</font><br>
<p>
You can store not the literal directory names but dentries. So simply renames won't be affected.<br>
<p>
The structure-changing renames are more complicated. The kernel will have to keep track of open path stacks and edit them. So:<br>
1) /tmp/foo/bar/baz is open. The kernel stores path stack information: &lt;1&gt;/&lt;2&gt;/&lt;3&gt;/&lt;4&gt; (dentry numbers)<br>
2) /tmp/qoo/bar/baz is another hardlink. The kernel stores: &lt;1&gt;/&lt;5&gt;/&lt;3&gt;/&lt;4&gt; (dentry numbers)<br>
3) When /tmp/foo is moved into /tmp/arr/yeah - the kernel checks for open references to foo's dentry &lt;2&gt;. And then edits only these path stacks, so &lt;1&gt;/&lt;2&gt;/&lt;3&gt;/&lt;4&gt; becomes &lt;1&gt;/&lt;6&gt;/&lt;3&gt;/&lt;4&gt; but the other open path (&lt;1&gt;/&lt;5&gt;/&lt;3&gt;/&lt;4&gt; - /tmp/qoo/bar/baz) is untouched.<br>
<p>
I don't see the problems with loop handling and I believe that it's possible to make it work without any _logical_ issues. Practical issues are another problem.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681670/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681674"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 23:35 UTC (Tue)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/681674/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
*UGH*<br>
<p>
So you need to be able to locate all those stacks containing given dentry at any point *and* atomically rewrite all of them, possibly extending or shrinking the damn things, and that is even before you start considering the games you need to play with dentry refcounts.  With total number of those stacks being that of opened files + running processes.  And you need that fun (including the updates of whatever search structures you use to locate the affected ones) on a non-priveleged syscall...<br>
<p>
As for the loop handling...  The absolute requirement is to have rename() preserving the connectivity of graph - if you can detach a piece of graph with all nodes having incoming edges (i.e. positive link count), you've got a trivial DoS, at the very least.  The obvious way to guarantee that is to keep it a directed acyclic graph with directories forming a tree - that's definitely going to satisfy our condition and this property is easy to maintain.  You just need to verify that you do not attempt to make a node its own descendent, which is trivial if you keep track of the (only) chain of ancestors.  For a single rename that's enough, so combined with fs-wide serialization of actual modifications done by rename(2) (finding the parents can be done outside of that exclusion) it solves the problem.<br>
<p>
Have fun doing that with directory hardlinks.  Solutions requiring (on any step) a full scan of directory tree do not count...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681674/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681677"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2016 2:02 UTC (Wed)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/681677/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; So you need to be able to locate all those stacks containing given dentry at any point *and* atomically rewrite all of them, possibly extending or shrinking the damn things, and that is even before you start considering the games you need to play with dentry refcounts. </font><br>
Well, I didn't say it's easy or efficient. <br>
<p>
I personally wouldn't mind hardlinked directories (I can see where they can be handy), but then I also want O_PONIES.<br>
<p>
<font class="QuotedText">&gt; You just need to verify that you do not attempt to make a node its own descendent, which is trivial if you keep track of the (only) chain of ancestors. </font><br>
But that holds just as well for the multi-hardlinked directories. To avoid cycles the FS has to uphold the invariant "no links from a directory to any of its parent directories". It doesn't require full tree scanning.<br>
<p>
If loops _are_ allowed then I'm pretty sure the filesystem will require a tracing garbage collector.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681677/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681685"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2016 3:14 UTC (Wed)
                               by <b>viro</b> (subscriber, #7872)
                              [<a href="/Articles/681685/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
... except that now you need to maintain the list of all parents through all operations.  What's worse, you can't just stop at direct parents - you need traverse all chains of ancestors, however long they might be.  With the unique chain to root you already have all of that in RAM - you either get them from pathname resolution, or you've started with fhandles and their decoding includes traversing the chain of ancestors until the damn thing is connected to the root.  With multiple links you could very well have never seen the majority of those ancestors, which means that loop detection turns into massive IO.  Now add the fact that you need to block all rename() (and link() to directories, and rmdir()) for the duration of that check, and it becomes _very_ unattractive.  Locking is also less than pleasant.  Once you add that to the costs of maintaining the crap attached to struct file, well...<br>
<p>
It's not impossible that somebody would eventually come up with a decent way of doing that stuff.  I've never been able to.  Neither had *BSD folks.  And Thompson, Pike et.al. flat-out decided that all that crap was just too much headache to bother with - even though they started their list of the bad ideas not to duplicate with cross-directory renames, overwriting renames, symlinks and fchdir.  On very different VFS architectures, including the one designed pretty much from scratch, with freedom to drop the syscalls considered to be misfeatures.  Which is something the rest of us couldn't afford - not without breaking arseloads of userland code.<br>
<p>
Again, maybe there is a decent way of doing that just waiting for somebody to invent it.  I would love to read it through and try to poke holes in it - got to be interesting.  But until somebody does come up with something that survives peer review...  Filesystem with multiple hardlinks to directories is a Bloody Bad Idea(tm).  Sorry.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681685/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681686"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2016 3:25 UTC (Wed)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/681686/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I have a feeling that it might be possible to devise a way for the "happy case" (no hardlinks in any parent) to be about as fast as the current case. But once hardlinks start appearing, it'll devolve rapidly (a nice DoS right there).<br>
<p>
And I feel that even alternative VFS designs are not going to help unless they introduce a full-scale garbage collector. Which might not even be such a bad idea once we switch to non-volatile memory.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681686/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor681576"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2016 17:48 UTC (Mon)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/681576/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I would rather keep the symlinks and instead remove the second meaning. Give up on the idea of a single canonical parent directory by eliminating "." and ".." as fixed entries in the directory listing, and instead interpreting them in the context of the stack of inodes actually traversed to reach the current point.</font><br>
<p>
This would cause all kinds of problems. Let's say that we know proj1 and proj2 directories are siblings on disk (so ../proj2), but proj1 has a convenience symlink:<br>
<p>
In [8]: abs(real('code/proj1/../proj2'))<br>
Out[8]: '/home/user/code/depot/group-foo/proj2'<br>
<p>
In [9]: real(abs('code/proj1/../proj2'))<br>
Out[9]: '/home/user/code/proj2'<br>
<p>
That second path is junk and doesn't exist. Without post-symlink resolution of .., that relative path is useless depending on how you got to that project's directory. Granted, mount --bind can make the relative path unhelpful (I think) if you bind mount proj1 directly, but that is *far* less common.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681576/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor681591"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2016 23:21 UTC (Mon)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/681591/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Let's say that we know proj1 and proj2 directories are siblings on disk (so ../proj2), but proj1 has a convenience symlink:</font><br>
<font class="QuotedText">&gt; In [8]: abs(real('code/proj1/../proj2'))</font><br>
<font class="QuotedText">&gt; Out[8]: '/home/user/code/depot/group-foo/proj2'</font><br>
<font class="QuotedText">&gt; In [9]: real(abs('code/proj1/../proj2'))</font><br>
<font class="QuotedText">&gt; Out[9]: '/home/user/code/proj2'</font><br>
<font class="QuotedText">&gt; That second path is junk and doesn't exist.</font><br>
<p>
I think you're skipping over the expansion of the symlink to get the second  path. The ".." wouldn't be handled first; you'd process each element of the pathname in turn, expanding symlinks as you go. An example, using "|" to represent where the parser is in the path:<br>
<p>
$PWD/ | code/proj1/../proj2 # initial state<br>
$PWD/code/ | proj1/../proj2 # traverse "code"<br>
$PWD/code/ | depot/group-foo/proj1/../proj2 # expand "proj1" -&gt; "depot/group-foo/proj1"<br>
$PWD/code/depot/ | group-foo/proj1/../proj2 # traverse "depot"<br>
$PWD/code/depot/group-foo/ | proj1/../proj2 # traverse "group-foo"<br>
$PWD/code/depot/group-foo/proj1/ | ../proj2 # traverse "proj1"<br>
$PWD/code/depot/group-foo/ | proj2 # remove "proj1" and ".."<br>
$PWD/code/depot/group-foo/proj2 | # traverse "proj2"<br>
<p>
(A real implementation would naturally use a stack of FDs (or equivalent) for the traversed directories rather than simply rewriting the text, to protect against renames.)<br>
<p>
Relative symlinks shouldn't be affected much by this change. You could get the sort of behavior you're describing with directory hardlinks, where the ".." in a symlink goes back to different locations depending on how you got to the link. Of course, that isn't a *change* in behavior since directory hardlinks aren't currently allowed, aside from bind mounts, which already do something very similar by synthesizing ".." based on how you got to the directory rather than using the native filesystem ".." entry.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681591/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor681595"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 0:00 UTC (Tue)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/681595/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<p>
For those interested in reading some history, this was posted just short of 30 years ago.<br>
<p>
<a href="https://groups.google.com/d/msg/comp.unix.wizards/rkPBbdTELl0/_Qxz3Va8R1EJ">https://groups.google.com/d/msg/comp.unix.wizards/rkPBbdT...</a><br>
<p>
Note that the thread is started by David Korn, author of "ksh".<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681595/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor681575"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2016 17:37 UTC (Mon)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/681575/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It is always the actual parent dentry. Unless you're in a shell with certain options set (CHASE_DOTS in zsh, bash does it by default, but can be overridden with cd -P and cd -L seems to be some kind of hybrid).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681575/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor681624"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A case for variant symlinks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2016 13:23 UTC (Tue)
                               by <b>mstone_</b> (subscriber, #66309)
                              [<a href="/Articles/681624/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
IIRC, a kind of variant symlink was used in some multi-level security (MLS) implementations to provide shared directories like /tmp at different levels. (Presumably to eliminate covert channels via filenames?) That dates back to at least the 90s, and clearly wasn't an idea that took the world by storm.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/681624/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2016, Eklektix, Inc.<BR>
            
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
