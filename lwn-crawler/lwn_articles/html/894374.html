        <!DOCTYPE html>
        <html lang="en">
        <head><title>Improving memory-management documentation [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/894374/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/894038/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/894374/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Improving memory-management documentation</h1>
</div>
<div class="ArticleText">
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>May 10, 2022</br>
           <hr>
<a href="/Articles/lsfmm2022/">LSFMM</a>
</div>
Like much of the kernel, the memory-management subsystem is under-documented,
and much of the documentation that does exist is less than fully current.
At the <a href="https://events.linuxfoundation.org/lsfmm/">2022 Linux
Storage, Filesystem, Memory-management and BPF Summit</a> (LSFMM), Mike
Rapoport ran a session on memory-management documentation and what can be
done to improve it.  The result was a reinvigorated interest in
documentation, but only time will tell what actual improvements will come
from that interest.
<p>
Rapoport started by noting that, a couple of years ago, he took a hard look
at the current state of memory-management documentation.  What he found was
summarized as "Mel's book and some text files".  The book in question, Mel
Gorman's <a href="https://www.kernel.org/doc/gorman/"><i>Understanding the
Linux Virtual Memory Manager</i></a>, is reminiscent of many old Unix books:
the basic concepts still apply to a great extent, but the details are all
out of date and, thus, wrong.  There are many important memory-management
features, such as transparent huge pages, that are not mentioned at all.
<p>
With regard to the text files in the kernel's documentation directory,
Rapoport made the effort to convert them over to restructured text and
integrate them into the kernel's documentation system, adding a bit of

<a href="/Articles/894376/"><img
src="https://static.lwn.net/images/conf/2022/lsfmm/MikeRapoport-sm.png" alt="[Mike Rapoport]"
title="Mike Rapoport" class="rthumb"></a>

much-needed organization in the process.  He added some coverage of
internal APIs, but there is a lot that is still in need of improvement.
So, he asked, what can be done to improve the documentation and encourage
the writing of more documentation?
<P>
One idea, he continued, was for reviewers to make a point of reviewing
the associated documentation when looking at memory-management patches.  He
has been making an effort in that direction, but has not seen other
reviewers following suit.  Matthew Wilcox jumped in to note that the <a
href="/ml/linux-kernel/20220504010716.661115-1-Liam.Howlett@oracle.com/">maple
tree patches</a> are well documented.  Rapoport agreed, but said that
doesn't change the fact that there is a lot of "tribal wisdom" in the
memory-management community that does not exist in written form.
<p>
Another developer noted that the documentation can be found in two distinct
places: in the code, and under the kernel's documentation directory (<tt>Documentation/</tt>).  The
latter documentation, he said, is not as good as it could be.  There are
some sections written in a clear narrative file, but it is mixed in with
"noise and horrible stuff".  The rendered documentation, which incorporates
kerneldoc comments from the code into the separate documents, can jumble
everything together and can be hard to work with.
Andrew Morton said that <tt>Documentation/</tt> is good for user-facing
material, but otherwise the right place for documentation is in the code
itself. 
<p><blockquote class="ad">
<b><tt>$ sudo subscribe today</tt></b>
<p>
Subscribe today and elevate your LWN privileges. You’ll have
access to all of LWN’s high-quality articles as soon as they’re
published, and help support LWN in the process.  <a href="https://lwn.net/Promo/nst-sudo/claim">Act now</a> and you can start with a free trial subscription.
</blockquote>
<p>
As the maintainer for the documentation directory, I felt the need to jump
in at this point; I had to disagree with Morton's assertion that separate
documentation is only good for end users.  There is a lot of information
that is relevant to developers, but which doesn't fit readily into
kerneldoc comments, and it is hard to tell a coherent 
story in the code that way.  The idea that comments in the code will be
better maintained than separate documentation is a poor match to reality at
best.
<p>
With regard to organization, it <i>is</i> possible to put introductory and
contextual 
information into kerneldoc comments and produce a coherent manual from
them, but extra effort must be made toward that end, and the end result
only appears in the documents after being rendered by the build system —
not in the code.
The <a href="https://docs.kernel.org/gpu/index.html">DRM
documentation</a> is a good example of what can be done when developers put
effort into it.
<p>
That said, organization has been an issue all along; when I became the documentation
maintainer, the kernel's documentation directory was a seemingly random
collection of independent files.  Over the years, developers working on
the documentation have been trying to
organize that material with a focus on who the readers are; thus the <a
href="https://docs.kernel.org/core-api/index.html">Core API manual</a>, the
<a href="https://docs.kernel.org/userspace-api/index.html">User-space API
guide</a>, the <a
href="https://docs.kernel.org/maintainer/index.html">Maintainer
handbook</a>, and several others.  The net effect has been to create a set
of smaller piles of unorganized and often outdated material, but it's a
start.  But people rarely find time to try to improve those manuals or to
turn each into a coherent document rather than a collection of related
files.
<p>
Wilcox mentioned <a href="/Articles/888715/">Neil Brown's readahead
documentation</a> as an example of another type of problem.  The new
documentation is "90% right"; Wilcox should have reviewed it but <strike>was not
copied on it</strike> was unable to find the time.  Brown, he said, did not
use the documentation that was
already present in the code when doing his work, and that is frustrating.
<p>
A recurring theme was that there are not enough people with the time and
expertise to work on documentation; developers were encouraged to lobby
their employers to support that work.  Michal Hocko said that you can't
bring in a "random tech writer" to work on memory-management documentation,
though; a lot of knowledge is needed to write useful documentation, so
experienced people need to write it.  Brown's approach was excellent,
since he is an expert user of the interface and can see it through
those eyes.  Meanwhile, Hocko said, he generally avoids looking through the
code when in search of documentation and digs through the LWN archives
instead.
<p>
I agreed with Hocko but had to add that writing documentation is a good
way to gain the needed expertise.  I learned much of what I know when
working on <a href="/Kernel/LDD3/"><i>Linux Device Drivers</i></a>; it's
fair to say that I was not well qualified when I began that project.
<p>
Davidlohr Bueso claimed that the best document in the kernel, the one that
others should emulate, is the infamous <a
href="https://www.kernel.org/doc/Documentation/memory-barriers.txt"><tt>memory-barriers.txt</tt></a>.
It is written by developers with a high level of expertise, is clear, and
actively maintained; even a newcomer can get something out of it.  Johannes
Weiner said that one of the strengths of <tt>memory-barriers.txt</tt> is
that the document has had an 
excellent structure from the beginning; that made it relatively easy for
others to come along and add to it.  The memory-management subsystem needs
somebody to come along and create a similar sort of documentation
structure.
<p>
Dan Williams asked what the near-term focus for memory-management
documentation should be; did Rapoport have specific APIs in mind?  Rapoport
answered that his goal was to make the documentation better in general so
that others could understand how Linux memory management works.  Williams
said that was "a good mission statement", but he was looking for actionable
tasks.  Rapoport suggested speculative page faults or the
multi-generational LRU (both of which are still out of tree) as examples.
<p>
Kent Overstreet said that developers are not bringing up documentation
during code review, and that the subsystem does not have a person who has a
coherent view of what the documentation should look like.  Liam Howlett
said that, as a new memory-management developer, he has encountered many
functions that he did not understand.  When he changes code, he tries to
improve its documentation.  He mentioned <a
href="https://elixir.bootlin.com/linux/v5.18-rc6/source/mm/mmap.c#L2269"><tt>find_vma()</tt></a>
specifically as a function whose behavior doesn't really match its name or
documentation.
<p>
David Hildenbrand asked what documents were wanted for memory management in
general.  Rapoport answered that he would like to see more material in the
<a href="https://docs.kernel.org/admin-guide/index.html">admin guide</a>
first, preferably a high-level overview of how it all works.
Improving the kerneldoc comments is rather lower on his list, but it is also
easier to do.  There was some discussion around whether there was a greater
need for internal or user-oriented documentation; it was suggested that
perhaps developers over-document some internal APIs, causing users to use them when
they really should not.  <tt>find_vma()</tt> was mentioned again as an
example of this sort of problem.

<p>
At the conclusion of the session, Wilcox suggested that a good first step
would be to create a new memory-management document using Gorman's book as
a guide, and volunteered to take a stab at it.  That book had a structure
that clearly worked; starting with that 
would solve the organizational problem and make it easy for developers to
improve things.  A ReStructured Text file could be created along those
lines, and the existing documentation could be slotted into it as
appropriate.

There was a general agreement that this was a good thing to do — no doubt
helped by the existence of a developer who was willing to take the initial
steps.  Wilcox has since posted <a
href="/ml/linux-mm/20220503063032.3680308-1-willy@infradead.org/">an
initial version</a> of the new documentation structure for review.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Documentation">Documentation</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Memory_management-Documentation">Memory management/Documentation</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Storage_Filesystem_Memory-Management_and_BPF_Summit-2022">Storage, Filesystem, Memory-Management and BPF Summit/2022</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/894374/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor894537"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Improving memory-management documentation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 10, 2022 14:17 UTC (Tue)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/894537/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Minor correction; I was copied on Neil&#x27;s readahead documentation rewrite, I just didn&#x27;t find time to review it before it went in.<br>
<p>
The pre-existing documentation can be found between get_next_ra_size() and count_history_pages(). Obviously...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/894537/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor894609"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Improving memory-management documentation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 10, 2022 20:21 UTC (Tue)
                               by <b>dcg</b> (subscriber, #9198)
                              [<a href="/Articles/894609/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As an user who sometimes wants to have a very high-level view of how MM things work, my go to source for documentation are LWN articles...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/894609/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor894653"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Improving memory-management documentation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 11, 2022 4:17 UTC (Wed)
                               by <b>unixbhaskar</b> (guest, #44758)
                              [<a href="/Articles/894653/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
....and you are not alone! Although, I am late to the party ... it seems worth the time to read some articles here. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/894653/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor894828"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Improving memory-management documentation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 11, 2022 17:27 UTC (Wed)
                               by <b>jezuch</b> (subscriber, #52988)
                              [<a href="/Articles/894828/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wonder... Do the LWN articles that we all love and enjoy actually end up as official documentation?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/894828/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor894830"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Official documentation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 11, 2022 17:57 UTC (Wed)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/894830/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Occasionally, yes; <a href="/Articles/889760/">this article</a> is the most recent example.


      
          <div class="CommentReplyButton">
            <form action="/Articles/894830/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor895089"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Improving memory-management documentation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 12, 2022 15:53 UTC (Thu)
                               by <b>tsr2</b> (subscriber, #4293)
                              [<a href="/Articles/895089/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
To get documentation correct may require a high level of expertise, but writing it from that perspective tends to result in documentation that also requires a high level of expertise to follow. To make it comprehensible to those with less expertise, perhaps it should be written by those with lesser expertise and reviewed for correctness/completeness by the experts?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/895089/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor895164"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Improving memory-management documentation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2022 11:24 UTC (Fri)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/895164/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>What it really needs is someone whose job is technical writing to talk to the experts and document it. There's a whole set of skills around writing good documentation, and getting that expertise involved is a lot more helpful than merely going for people with less expertise.
<p>Good tech writers are worth their weight in gold.


      
          <div class="CommentReplyButton">
            <form action="/Articles/895164/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2022, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
