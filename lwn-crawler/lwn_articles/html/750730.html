        <!DOCTYPE html>
        <html lang="en">
        <head><title>Kernel lockdown in 4.17? [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/750730/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/750429/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/750730/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Kernel lockdown in 4.17?</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ready to give LWN a try?</b>
<p>
With a subscription to LWN, you can stay current with what is happening in the Linux and free-software community and take advantage of subscriber-only site features.  We are pleased to offer you <b><a href="https://lwn.net/Promo/nst-trial/claim">a free trial subscription</a></b>, no credit card required, so that you can see for yourself.  Please, join us!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>April 2, 2018</br>
           </div>
The UEFI secure boot mechanism is intended to protect the system against
persistent malware threats — unpleasant bits of software attached to the
operating system or bootloader that will survive a reboot.  While Linux
has supported secure boot for some time, proponents have long said that
this support is incomplete in that it is still possible for the root user
to corrupt the system in a number of ways.  Patches that attempt to
close this hole have been circulating for years, but they have been
controversial at best.  This story may finally come to a close, though, if
Linus Torvalds accepts the "kernel lockdown" patch series during the 4.17
merge window.
<p>
In theory, the secure-boot chain of trust ensures that the system will
never run untrusted code in kernel mode.  On current Linux
systems, though, the root user (or any other user with sufficient
capabilities) can do exactly that.  For anybody who wants to use secure
boot to ensure the integrity of their systems (or, perhaps, to prevent
their customers from truly owning the system), this hole defeats the
purpose of the whole exercise.  Various kernel lockdown patches have been
proposed over the years (LWN first <a href="/Articles/514985/">covered
them</a> in&nbsp;2012), but these patches have run into two types of criticism:
(1)&nbsp;restricting what root can do goes against the design of Unix-like
systems, and (2)&nbsp;locking down the system in this way still does not
solve the problem.
<p>
Interest in this kind of lockdown persists, though, and the lockdown
patches have been quietly maintained and improved over the years.  These
patches were last publicly <a href="/Articles/738692/">posted</a> in
November.  They were <a href="/Articles/750761/">added to linux-next</a> at
the beginning of March, and found their way into the security tree on
March&nbsp;31.  Security maintainer James Morris has not yet pushed the
lockdown patches to Torvalds, but has <a
href="/Articles/750763/">indicated</a> his intent to do so in the near
future.  So, unless Torvalds objects, it would appear that kernel lockdown
will be a part of the 4.17 release.
<p>
<h4>How to lock down the kernel</h4>
<p>
The series of patches that implements this feature can be seen <a
href="https://git.kernel.org/pub/scm/linux/kernel/git/dhowells/linux-fs.git/log/?h=lockdown-20180330">on
kernel.org</a>.  It starts with <a
href="https://git.kernel.org/pub/scm/linux/kernel/git/dhowells/linux-fs.git/commit/?h=lockdown-20180330&id=1235d72fe1d34f9961051d159af3b48a1617ff0a">a
patch</a> adding a configuration option for the lockdown feature and a
<tt>kernel_is_locked_down()</tt> function to test whether lockdown is in
effect.  There is a <tt>lockdown</tt> boot parameter that can be used to
enable lockdown, but lockdown also happens automatically if the feature is
enabled and UEFI secure boot is detected.  After this patch, the mode is
implemented but it doesn't actually lock anything down yet.
<p>
No sooner was the lockdown option added than somebody wanted to be able to
turn it off.  Normally, the ability to defeat this kind of protection would
be considered undesirable.  In this case, it can only be done from the
system console with the magic <tt>SysRq-x</tt> key sequence.
<p>
After that, the real restrictions are added.  In lockdown mode, the kernel
will refuse to load modules unless they either have a recognized signature
or they can pass appraisal from the integrity measurement architecture (IMA)
subsystem.  Access to <tt>/dev/mem</tt> and <tt>/dev/kmem</tt> (which is
already heavily restricted on most systems) is disabled entirely.
<tt>/proc/kcore</tt>, which can be used to pull cryptographic keys from the
kernel, is disabled.
<p>
Access
to I/O ports via <tt>/dev/port</tt> is disallowed lest it be used to
convince a device to overwrite important memory via a DMA operation.
There are other places where hardware might be used to circumvent
lockdown.  To try to prevent that, any sort of access to PCI bus operations
or parameters (the location of the base address register, for example) must
be disabled.  The <a
href="http://man7.org/linux/man-pages/man2/ioperm.2.html"><tt>ioperm()</tt></a>
and <a
href="http://man7.org/linux/man-pages/man2/iopl.2.html"><tt>iopl()</tt></a>
system calls are disabled, as is direct access to x86 model-specific
registers (MSRs).
<p>
The <a
href="https://www.kernel.org/doc/Documentation/acpi/method-customizing.txt">ACPI
custom method mechanism</a> is also capable of overwriting memory, so it is
disabled.  There are a few other hazards in ACPI, including the
<tt>acpi_rsdp</tt> command-line parameter, which can be used to change the
<a href="https://wiki.osdev.org/RSDP">RSDP</a> structure.  The <a
href="https://www.kernel.org/doc/Documentation/acpi/initrd_table_override.txt">ACPI
table override</a> and <a
href="https://www.kernel.org/doc/Documentation/acpi/apei/einj.txt">APEI
error injection</a> mechanisms are turned off as well.
<p>
None of these changes will help in the case where a specific device driver
can be used to overwrite memory.  For example, the "eata" SCSI driver has a
set of command-line options that control many of its hardware-level
parameters; those must be disabled when lockdown is in effect.  If anybody
is trying to lock down a system that has PCMCIA hardware (younger readers
can ask their parents about this), the ability to replace the card
information structure (CIS) must be disabled.  The serial-port
<tt>TIOCSSERIAL</tt> <tt>ioctl()</tt> operation is problematic, since it
can change I/O port settings.  Many other hardware-controlling command-line
parameters were <a href="/Articles/708179/">annotated</a> in 2016; under
kernel lockdown they become unavailable.

<p>
There are a number of restrictions on the kexec mechanism (used to boot a
new kernel directly from a running kernel).  If the root user can switch to
an arbitrary kernel, the system is clearly not locked down, so that must be
prevented.  The <a
href="http://man7.org/linux/man-pages/man2/kexec_load.2.html"><tt>kexec_load()</tt></a>
system call is disabled entirely; <tt>kexec_file_load()</tt>, which <a
href="/Articles/603116/">can 
enforce signatures</a>, is still allowed.  A mechanism has been added to ensure
that the newly loaded kernel retains the secure-boot mode.  Once again, IMA
can be used as a substitute for signature verification.
<p>
"Hibernation" is the process of saving a snapshot of system memory to disk
and powering down the system, with the intent of resuming from that
snapshot in the future.  There is also a variant called "uswsusp" where
most of the work is done in user space.  In either case, the kernel
currently lacks a mechanism to ensure that the image it resumes from is the
same as the one it saved at hibernation time.  In other words, some clever
editing of the hibernation image could be used to bypass lockdown.  That is
addressed by disabling hibernation and uswsusp entirely.
<p>
This whole exercise will be in vain, though, if an attacker is able to
install kprobes into the running kernel, so that feature, too, is turned
off.  Some BPF operations that can read memory are also disabled.
These changes will adversely affect a number of tracing use cases.  The
debugfs filesystem is disabled entirely on locked-down systems.
<p>
<h4>A secure system?</h4>
<p>
The end result of all this work is intended to be a kernel that cannot be
subverted even by a privileged user.  As is often the case with such
features, kernel lockdown is a two-edged sword.  A cloud-hosting provider
has a strong incentive to ensure that its operating software has not been
compromised, but that is also true of a provider of Linux-based
consumer-electronics gadgets that simply wants to preserve a rent-seeking
business model.  It is hard to protect one type of system without
protecting the other.
<p>
It is also hard to imagine a scenario where the lockdown feature provides
complete protection.  If nothing else, there must be a lot of device
drivers that can still be used to get around restrictions.  But proponents
of the lockdown feature will argue that it raises the bar considerably, and
that is generally the best that can be hoped for in this world.  The one
bar that still has to be overcome, though, is acceptance into the
mainline.  Torvalds has not yet expressed an opinion on this patch set.  It
would seem that much of the opposition to its merging has been overcome (or
worn down), though, so merging into the mainline for 4.17 seems probable.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-UEFI_secure_boot">Security/UEFI secure boot</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Linux_kernel">Linux kernel</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Secure_boot">Secure boot</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/750730/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor750782"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 2, 2018 21:15 UTC (Mon)
                               by <b>fratti</b> (guest, #105722)
                              [<a href="/Articles/750782/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;In other words, some clever editing of the hibernation image could be used to bypass lockdown. That is addressed by disabling hibernation and uswsusp entirely.</font><br>
<p>
What is it about Linux and hating hibernation in so many different ways? I feel like kernel developers want me to feel ashamed for using a laptop.<br>
<p>
<font class="QuotedText">&gt;but that is also true of a provider of Linux-based consumer-electronics gadgets that simply wants to preserve a rent-seeking business model.</font><br>
<p>
That could be said of any security measure. Imagine a world where people use memory safe languages for systems programming; we couldn't run Linux on our PlayStations or what have you anymore.<br>
<p>
I think the solution should be a legal one.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750782/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor750787"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 2, 2018 22:22 UTC (Mon)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/750787/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Legal solutions won't work. The GPLv2 does allow locked-down kernels (or at least Linus publicly stated that he has no problem with that sort of thing), so what legal reason would there be for forcing manufacturers to allow you to replace a device's kernel? And even if there was such a reason, have fun enforcing it when you can't even get nominal GPL compliance from most makers of embedded systems. Or Android phones, for that matter.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750787/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor750792"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2018 4:06 UTC (Tue)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/750792/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I imagine it would be separate to copyright licenses and probably be more related to the Right to Repair movement, who violate the circumvention provisions of the DMCA to hack around the DRM in tractors. I can easily see that resulting in a right to control or replace the software running on devices you have purchased.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750792/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor750793"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2018 4:46 UTC (Tue)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/750793/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I think the solution should be a legal one.</font><br>
<p>
The solution to which problem? We have the freedom to choose between GPLv2 vs GPLv3 products. Yet for some reason the vast majority of people seem happy with products that restrict what they can do much more than with *either* GPL version: should that be regulated too/first? Prohibition of closed-source software, now that could be an interesting social experiment...<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750793/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor750799"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2018 9:07 UTC (Tue)
                               by <b>johan</b> (guest, #112044)
                              [<a href="/Articles/750799/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  What is it about Linux and hating hibernation in so many different ways? I feel like kernel developers want me to feel ashamed for using a laptop.</font><br>
<p>
I hope this is just for hibernation though, hopefully suspend (saves state to RAM instead of to disk) is still supported.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750799/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor750800"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2018 10:02 UTC (Tue)
                               by <b>ardbiesheuvel</b> (subscriber, #89747)
                              [<a href="/Articles/750800/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
My primary objection to these patches is that it gives a false sense of security, and when the patches were under review, I strongly argued for<br>
a) calling it a 'lockdown policy' rather than 'lockdown', emphasizing that it is best effort rather than absolute,<br>
b) logging specifics about what that policy means on the current system.<br>
<p>
In my experience, without such clarifications, there will be many users that assume that everything they do on a locked down system is magically more secure than it was before, and will act accordingly, resulting in a net decrease in security. Also, considering that lockdown will mean different things across architectures and across kernel versions, a locked down v4.17 arm64 kernel will be quite different from a, say, v5.1 x86 kernel, and you'll have to consult the kernel sources and your .config file to figure out what is being protected and what is not.<br>
<p>
<p>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750800/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor750810"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2018 14:16 UTC (Tue)
                               by <b>unixbhaskar</b> (guest, #44758)
                              [<a href="/Articles/750810/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Make absolute sense and I do agree. It should be a preferential policy for those, who wanted it. There is no point imposing something, which doesn't bring any solidarity in terms of security(I mean so-called security). Plus we need to measure how much overhead does it bring when in an active state or in an inactive state. The idea seems good but needs more work I believe.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750810/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor750804"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Calendrical quandary</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2018 11:36 UTC (Tue)
                               by <b>mbg</b> (subscriber, #4940)
                              [<a href="/Articles/750804/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So when 1 April falls on Easter Sunday (or should that be the other way around?), is it a "public holiday" in your jurisdiction?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750804/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor750817"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2018 14:45 UTC (Tue)
                               by <b>ju3Ceemi</b> (subscriber, #102464)
                              [<a href="/Articles/750817/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I do not see this as a dump feature<br>
However, I do see this as an ultra-niche feature, something that may, in theory, be useful, but will not be commonly used in the real world<br>
<p>
After all, one who wants to "lockdown" a machine with this must own and maintain the whole chain : he must master the bios ""secure boot"" features, for instance. He must compile himself every kernel updates.<br>
<p>
If a user can use his own kernel (or any kernel from Debian, redhat or any common distrib), then this user can recompile this kernel without the lockdown code, hence breaking the jail.<br>
<p>
<p>
I fear that many confusion will rise with such feature.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750817/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor750860"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2018 23:31 UTC (Tue)
                               by <b>nivedita76</b> (guest, #121790)
                              [<a href="/Articles/750860/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It would actually be used in the real world. Most linux installations are commercial servers/cloud providers who would probably find this useful.<br>
<p>
The individual user who recompiles his own kernel is the ultra-niche, actually.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750860/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor750866"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 4, 2018 7:37 UTC (Wed)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/750866/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think you're correct, this doesn't have good connotations. The threat model for this seems to be to prevent the system administrator from using the system in ways not approved by whoever controls the bootloader. And since the firmware owner can never be the same person who bought and rightfully owns the system — because UEFI/BIOS is still proprietary — this can *only* be used as a form of DRM (the greed kind, not the graphics one).<br>
<p>
If this is implemented in mainline it makes Microsoft's end goal significantly easier - “Linux”* (*approved distros) supports Secure Boot now, so would all the clueless UEFI implementers fall in line and kindly remove the unnecessary non-secure mode and user-enrolled keys? For your safety, of course.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750866/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor750869"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 4, 2018 8:07 UTC (Wed)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/750869/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Several years ago I've used DRM lockdown system to ensure the physical security of data, even if the server with them was stolen.<br>
<p>
I used a simple "remote attestation" model where the trusted code retrieved remote keys and used them to decrypt the root partition, load its kernel and kexec into it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750869/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor750910"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 4, 2018 17:06 UTC (Wed)
                               by <b>nilsmeyer</b> (guest, #122604)
                              [<a href="/Articles/750910/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      That's a pretty interesting idea, I was toying with a similar idea, using initramfs and a TTL based LUKS key to unlock my device after reboot. My idea was to do this:

<ul>
<li>Create a random key, store in separate luks key slot</li>
<li>Store random key in etcd (or similar) with TTL (5 minutes or so)</li>
<li>At boot, request password from etcd to auto-unlock</li>
<li>if the key is timed out, prompt for password</li>
</ul>
I only need a way to authenticate the initrd image. 

This is mainly so I don't have to manually unlock upon reboot while still maintaining some security, the timeout should be the time it takes to boot, so that when someone physically removes the server the key is no longer valid. 

Currently, I'm using dropbear in initramfs to login and unlock, but this doesn't verify the integrity of the initramfs either and the private key for dropbear has to be stored in initramfs. 
      
          <div class="CommentReplyButton">
            <form action="/Articles/750910/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor750916"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 4, 2018 17:54 UTC (Wed)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/750916/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Before reimplementing the wheel, please see Clevis/Tang solution used in Fedora; for example <a href="https://www.usenix.org/conference/lisa16/conference-program/presentation/atkisson">https://www.usenix.org/conference/lisa16/conference-progr...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750916/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor750927"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 4, 2018 19:01 UTC (Wed)
                               by <b>nilsmeyer</b> (guest, #122604)
                              [<a href="/Articles/750927/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks, that looks very interesting. Dracut isn't very well supported in Debian based distros but that part I can build myself if need be.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750927/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor750970"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 5, 2018 7:02 UTC (Thu)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/750970/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
dracut is available in Debian and is supposed to work, please report bugs if you find any issues. ISTR there was even some talk of switching to it by default a while back.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750970/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor751040"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 5, 2018 15:44 UTC (Thu)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/751040/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A couple of laptops ago, this was a Dell XPS 13, I had it set up to secure boot with an enrolled key of my very own. And I made a script wrapper for the kernel compile to sign everything. If there was some official Fedora way to do it, I didn't find it. I guess they have a separate signature action somewhere in their build process.<br>
<p>
But anyway, my method worked and booted a kernel signed by my key. Even though this wasn't great since the signing key was in my /root directory where anyone could find it.<br>
<p>
So nothing in secure boot stops the system administrator from using secure boot for their own purposes.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/751040/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor751207"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 8, 2018 4:14 UTC (Sun)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/751207/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It does help if the hardware manufacturer has the presence of mind to implement UEFI properly… the one system I own with it (some no-name board with an AMI firmware) doesn't even let me turn Secure Boot *on*, there's no hint of it anywhere in the setup (or efivarfs). I'm pretty sure that violates spec.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/751207/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor751243"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 8, 2018 18:21 UTC (Sun)
                               by <b>jem</b> (subscriber, #24231)
                              [<a href="/Articles/751243/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Secure Boot wasn't introduced until the 2.3.1 "Errata C" version of the UEFI spec. So if the manufacturer doesn't claim the firmware is newer than that, then it doesn't violate the spec.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/751243/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor751246"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 8, 2018 18:58 UTC (Sun)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/751246/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Umm … seriously? they really introduced a major feature in a micro release?<br>
<p>
Owch.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/751246/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor751688"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2018 16:11 UTC (Thu)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/751688/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It only violates common sense and good taste then… but that's nothing new for firmware.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/751688/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor750858"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not in 4.17 after all</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2018 22:39 UTC (Tue)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/750858/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      Discussion on the linux-kernel list has made it clear that there is not yet a consensus around the lockdown patches, so security maintainer James Morris has <a href="/Articles/750859/">said</a> that he no longer plans to push them for 4.17.
      
          <div class="CommentReplyButton">
            <form action="/Articles/750858/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor750864"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not in 4.17 after all</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 4, 2018 2:53 UTC (Wed)
                               by <b>unixbhaskar</b> (guest, #44758)
                              [<a href="/Articles/750864/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For everyone's sake, here is the pointer to the discussion in details... <br>
<p>
<a href="https://lkml.org/lkml/2018/3/30/602">https://lkml.org/lkml/2018/3/30/602</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750864/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor750968"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not in 4.17 after all</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 5, 2018 6:40 UTC (Thu)
                               by <b>ashkulz</b> (guest, #102382)
                              [<a href="/Articles/750968/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Further down the thread, Linus says he is unlikely to merge it at all:<br>
<p>
<a href="http://lkml.iu.edu/hypermail/linux/kernel/1804.0/01607.html">http://lkml.iu.edu/hypermail/linux/kernel/1804.0/01607.html</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750968/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor750995"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Not in 4.17 after all</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 5, 2018 11:24 UTC (Thu)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/750995/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Umm, not entirely. The part Linus is objecting to is the idea that auto-enabling the lockdown features when secure-boot is in effect makes any sense whatsoever. Linus' opinion is that whether you boot securely and whether the kernel is subsequently locked down are two independent concepts and it's stupid to conflate them.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750995/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor750994"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 5, 2018 11:21 UTC (Thu)
                               by <b>SLi</b> (subscriber, #53131)
                              [<a href="/Articles/750994/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; In theory, the secure-boot chain of trust ensures that the system will never run untrusted code in kernel mode. On current Linux systems, though, the root user (or any other user with sufficient capabilities) can do exactly that. For anybody who wants to use secure boot to ensure the integrity of their systems (or, perhaps, to prevent their customers from truly owning the system), this hole defeats the purpose of the whole exercise.</font><br>
<p>
Do I understand correctly that it not only defeats the purpose for Linux users, but actually for everybody anywhere ever using secure boot, if a signed kernel image allowing arbitrary kernel code to run exists? Couldn't such a kernel be used to boot another secure OS with a false assurance that the boot process has not been tampered with? Or is there some step where the signature of the booted kernel is measured by a TPM in a way that another secure boot targets in reality can detect (wouldn't that also prevent using Grub to boot them, since that's not distinguishable from the kernel in a meaningful way)?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/750994/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor751085"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel lockdown in 4.17?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 6, 2018 1:15 UTC (Fri)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/751085/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Do I understand correctly that it not only defeats the purpose for Linux users, but actually for everybody anywhere ever using secure boot, if a signed kernel image allowing arbitrary kernel code to run exists? </font><br>
<p>
Not really.<br>
With physical access, you can install the keys of your choice into your hardware (if you cannot, then it isn't your hardware).<br>
Each key should have some policy associated, with the meaning "This will only be used to sign code which abides by the given policy".  If anything else ever gets signed, then the key is compromised.<br>
If there is some particular policy that you want to impose, then you should disable any keys that have a broader policy, or that have been compromised.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/751085/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2018, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
