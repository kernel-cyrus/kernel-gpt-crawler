        <!DOCTYPE html>
        <html lang="en">
        <head><title>Still waiting for swap prefetch [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/242765/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/242237/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/242765/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Still waiting for swap prefetch</h1>
<div class="Byline">[Posted July 25, 2007 by corbet]
               <p>
               </div>
</div>
<div class="ArticleText">
It has been almost two years since LWN <a
href="http://lwn.net/Articles/153353/">covered the swap prefetch
patch</a>.  This work, done by Con Kolivas, is based on the idea that if a
system is idle, and it has pushed user data out to swap, perhaps it should
spend a little time speculatively fetching that swapped data back into
any free memory that might be sitting around.  Then, when some application
wants that memory in the future, it 
will already be available and the time-consuming process of fetching it
from disk can be avoided.  
<p>
The classic use case for this feature is a
desktop system which runs memory-intensive daemons (updatedb, say, or a
backup process) during the night.  Those daemons may shove a lot of useful
data to swap, where it will languish until the system's user arrives,
coffee in hand, the next morning.  Said user's coffee may well grow cold by
the time the various open applications have managed to fault in enough
memory to function again.  Swap prefetch is intended to allow users to
enjoy their computers <i>and</i> hot coffee at the same time.
<p>

There is a vocal set of users out there who will attest that swap prefetch
has made their systems work better.  Even so, the swap prefetch patch has
languished in the -mm tree for almost all of those two years with no path
to the mainline in sight.  Con <a href="/Articles/242768/">has given up</a>
on the patch (and on kernel development in general):
<p>
<div class="BigQuote">
	The window for 2.6.23 has now closed and your position on this is
	clear. I've been supporting this code in -mm for 21 months since
	16-Oct-2005 without any obvious decision for this code forwards or
	backwards.
<p>
	I am no longer part of your operating system's kernel's world; thus
	I cannot support this code any longer. Unless someone takes over
	the code base for swap prefetch you have to assume it is now
	unmaintained and should delete it.
</div>
<p>
It is an unfortunate thing when a talented and well-meaning developer runs
afoul of the kernel development process and walks away.  We cannot afford
to lose such people.  So it is worth the trouble to try to understand what
went wrong.  
<p>

Problem #1 is that Con chose to work in some of the trickiest parts of the
kernel.  Swap prefetch is a memory management patch, and those patches
always have a long and difficult path into the kernel.  It's not just Con
who has run into this: Nick Piggin's <a
href="http://lwn.net/Articles/147153/">lockless pagecache patches</a> have
been 
knocking on the door for just as long.  The <a
href="http://lwn.net/Articles/155510/">LWN article on Wu Fengguang's
adaptive readahead patches</a> appeared at about the same time as the swap
prefetch article - and that was after your editor had stared at them for
weeks trying to work up the courage to write something.  Those patches
were only merged earlier this month, and, even then, only after many of the
features were stripped out.  Memory management is not an area for
programmers looking for instant gratification.
<p>

There is a reason for this.  Device drivers either work or they do not, but
the virtual memory subsystem behaves a little differently for every
workload which is put to it.  Tweaking the heuristics which drive memory
management is a difficult process; a change which makes one workload run
better can, unpredictably, destroy performance somewhere else.  And that
"somewhere else" might not surface until some large financial institution
somewhere tries to deploy a new kernel release.  The core kernel
maintainers have seen this sort of thing happen often enough to become
quite conservative with memory management changes.  Without convincing
evidence that the change makes things better (or at least does no harm) in
all situations, it will be hard to get a significant change merged.

<p>

In <a
href="http://apcmag.com/6759/interview_with_con_kolivas_part_1_computing_is_boring">a
recent interview</a> Con stated:
<p>
<div class="BigQuote">
	Then along came swap prefetch. I spent a long time maintaining and
	improving it. It was merged into the -mm kernel 18 months ago and
	I've been supporting it since. Andrew [Morton] to this day remains
	unconvinced it helps and that it 'might' have negative consequences
	elsewhere. No bug report or performance complaint has been
	forthcoming in the last 9 months. I even wrote a benchmark that
	showed how it worked, which managed to quantify it!
</div>
<p>
The problem is that, as any developer knows, "no bug reports" is not the same
as "no bugs."  What is needed in a situation like this is not just
testimonials from happy desktop users; there also needs to be some sort of
sense that the patch has been tried out in a wide variety of situations.
The relatively self-selecting nature of Con's testing community (more on
this shortly) makes that wider testing harder to achieve.
<p>

A patch like swap prefetch will require a certain amount of support from
the other developers working in memory management before it can be merged.
These developers have, as a whole, not quite been ready to jump onto the
prefetch bandwagon.  A concern which has been raised a few times is that
the morning swap-in problem may well be a sign of a larger issue within the
virtual memory subsystem, and that prefetch mostly serves as a way of
papering over that problem.  And it fails to even paper things completely,
since it brings back some pages from swap, but doesn't (and really can't)
address file-backed pages which will also have been pushed out.  The
conclusion that this reasoning leads to is that it would be better to find
and fix the real problem rather than hiding it behind prefetch.

<p>

The way to address this concern is to try to get a better handle on what
workloads are having problems so that the root cause can be addressed.
That's why Andrew Morton <a href="/Articles/242775/">says</a>:
<p>
<div class="BigQuote">
	To attack the second question we could start out with bug reports:
	system A with workload B produces result C.  I think result C is
	wrong for &lt;reasons&gt; and would prefer to see result D.
</div>
<p>
and why Nick Piggin <a href="/Articles/242776/">complains</a>:
<p>
<div class="BigQuote">
	Not talking about swap prefetch itself, but everytime I have asked
	anyone to instrument or produce some workload where swap prefetch
	helps, they never do.
<p>
	Fair enough if swap prefetch helps them, but I also want to look at
	why that is the case and try to improve page reclaim in some of
	these situations (for example standard overnight cron jobs
	shouldn't need swap prefetch on a 1 or 2GB system, I would hope).
</div>
<p>
There have been a few attempts to characterize workloads which are improved
by swap prefetch, but the descriptions tend toward the vague and hard to
reproduce.  This is not an easy situation to write a simple benchmark for
(though Con has tried), so demonstrating the problem is a hard thing to
do.  Still, if the prefetch proponents are serious about wanting this code
in the mainline, they will need to find ways to better communicate
information about the problems solved by prefetch to the development
community.
<p>

Communications with the community have been an occasional problem with
Con's patches.  Almost uniquely among kernel developers, Con
chose to do most of his work on his own mailing list.  That has resulted in
a self-selected community of users which is nearly uniformly supportive of Con's work,
but which, in general, is not participating much in the development of that
work.  It is rare to see patches posted to the ck-list which were not
written by Con himself.  The result was the formation of a sort of
cheerleading squad which would occasionally spill over onto linux-kernel
demanding the merging of Con's patches.  This sort of one-way communication
was not particularly helpful for anybody involved.  It failed to convince
developers outside of ck-list, and it failed to make the patches better.
<p>

This dynamic became actively harmful when ck-list members (and Con)
continued to push for inclusion of patches in the face of real problems.
This behavior came to the fore after Con posted the RSDL scheduler.  RSDL
restarted the whole CPU scheduling discussion and ended up leading to some
good work.  But some users were reporting real regressions with RSDL and
were being told that those regressions were to be expected and would not be
fixed.  This behavior <a href="http://lwn.net/Articles/226963/">soured
Linus on RSDL</a> and set the stage for Ingo Molnar's CFS scheduler.  Some
(not all) people are convinced that Con's scheduler was the better design,
but refusal to engage with negative feedback doomed the whole exercise.
Some of Con's ideas made it into the mainline, but his code did not.

<p>

The swap prefetch patches appear to lack any obvious problems; nobody is
reporting that prefetch makes things worse.  But the ck-list members
pushing for its inclusion (often with Con's encouragement) have not been
providing the sort of information that the kernel developers want to see.
Even so, while a consensus in favor of merging this patch has
not formed, there are some important developers who support its inclusion.
They include <a href="/Articles/242935/">Ingo Molnar</a> and <a
href="/Articles/242936/">David Miller</a>, who says:
<p>
<div class="BigQuote">
	There is a point at which it might be wise to just step back and
	let the river run it's course and see what happens.  Initially,
	it's good to play games of "what if", but after several months it's
	not a productive thing and slows down progress for no good reason.
<p>
	If a better mechanism gets implemented, great!  We'll can easily
	replace the swap prefetch stuff at such time.  But until then swap
	prefetch is what we have and it's sat long enough in -mm with no
	major problems to merge it.
</div>
<p>

So swap prefetch may yet make it into the mainline - that discussion is
not, yet, done.  If we are especially lucky, Con will find a way to get back into
kernel development, where his talents and user focus are very much in need.
But this sort of situation will certainly come up again.  Getting major
changes into the core kernel is not an easy thing to do, and, arguably,
that is how it should be.  If the process must make mistakes, they should
probably happen on the side of being conservative, even if the occasional
result is the exclusion of patches that end up being helpful.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_model">Development model</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Memory_management-Swapping">Memory management/Swapping</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/242765/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor243022"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2007 22:55 UTC (Wed)
                               by <b>mgb</b> (guest, #3226)
                              [<a href="/Articles/243022/">Link</a>] (59 responses)
      </p>
      
      </div>
      </summary>
      "for example standard overnight cron jobs shouldn't need swap prefetch on a 1 or 2GB system"<br>
<p>
Now I've been programming since magnetic drums were hip so I may be a bit confused here but it seems to me that I can remember a time less than a decade ago when a system didn't need a couple of gigs to run Linux well.<br>
<p>
It seems that Linux may still be a little more efficient than Vista on most loads (but not Firefox) but back in the nifty nineties Linux was a _lot_ more efficient than Windows.  In short, Linux has been getting worse faster than Windows.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243022/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243025"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2007 23:04 UTC (Wed)
                               by <b>elanthis</b> (guest, #6227)
                              [<a href="/Articles/243025/">Link</a>] (33 responses)
      </p>
      
      </div>
      </summary>
      _Linux_ has been getting worse, or the shit that people use on their systems is getting worse?<br>
<p>
I run 2GB in my home machine, but I don't think I've ever seen the memory peak over 1GB of actual usage.  Over 60% of that is just file caches and the like - unnecessary but nice performance enhancements, basically.<br>
<p>
Now, there are some things that we use these days that eat up a shit load of memory.  My mail client has to track some 40,000 messages among all my folders.  Firefox has to deal with Youtube videos.  I have Tracker indexing my file system.  I have more data in a single file than a hard-drive 15 years ago could even hold.<br>
<p>
There is a lot of fat in the current desktop system, that is for sure.  Ubuntu and Red Hat both have this obsession with Python, which is about as bloaty a language as you can get, and then they write crappy apps in Python that would be slow as molasses even in C because they use crappy algorithms.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243025/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243028"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2007 23:20 UTC (Wed)
                               by <b>xorbe</b> (guest, #3165)
                              [<a href="/Articles/243028/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      When I have 2GB of ram in my home desktop system, I never ever want to see Linux drop binaries from ram, and swap them back in from the binary text file.  Or see it drop data pages to increase hdd cache in memory.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243028/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243029"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2007 23:40 UTC (Wed)
                               by <b>johnkarp</b> (guest, #39285)
                              [<a href="/Articles/243029/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Even when the disk-cache-pages are more frequently used than the <br>
program-text-pages? If I understand things correctly, a program has to <br>
wait ~9ms when the data it needs is on the disk, whether its program text <br>
or data. Also, programs often have pages that are *never* used after <br>
startup; the sooner those pages are evicted in favor of useful things the <br>
better.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243029/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor243030"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2007 23:47 UTC (Wed)
                               by <b>sjlyall</b> (guest, #4151)
                              [<a href="/Articles/243030/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <i>When I have 2GB of ram in my home desktop system, I never ever want to see Linux drop binaries from ram, and swap them back in from the binary text file. Or see it drop data pages to increase hdd cache in memory.</i>
<p>
Turn off swap then if you feel that way. I've got no problem with my system swapping out the getty copies which will never be used and instead using the RAM to cache my mail files.
<p>
I have a bunch of stuff that includes running programs, program data and files that the CPU has to deal with. I want everything to go as fast a possible so whenever possible if the CPU wants some of that data it should be able to get it as quickly as possible which means it should be in RAM if at all possible. The better the kernel does this, the faster everything will run.
      
          <div class="CommentReplyButton">
            <form action="/Articles/243030/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor244546"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 7, 2007 2:33 UTC (Tue)
                               by <b>xorbe</b> (guest, #3165)
                              [<a href="/Articles/244546/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Even with swap off, kernel can drop the program text, and swap it in from the backing binary on disk -- all without a swap file.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/244546/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor243038"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">OpenOffice comes with a &quot;pagein&quot; utility.</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 0:14 UTC (Thu)
                               by <b>dmarti</b> (subscriber, #11625)
                              [<a href="/Articles/243038/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      Why should the kernel have to guess what to page back in when you could use the "pagein" from OpenOffice, or something like it?   Here's a <a href="http://www.linuxworld.com/community/?q=node/1062">simple example</a>.
      
          <div class="CommentReplyButton">
            <form action="/Articles/243038/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243041"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">OpenOffice comes with a &quot;pagein&quot; utility.</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 0:39 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/243041/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Interesting.  It's doing something different, though: it's indiscriminately bringing in pages from the program's text area.  I can't see how it could do anything about process anonymous pages which have been shoved into swap.  Somebody who really wanted to enjoy their coffee hot would want to use both pagein (for text) and prefetch (for data) - and find some, currently unknown way to balance the two.
      
          <div class="CommentReplyButton">
            <form action="/Articles/243041/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243193"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">IWFM</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 16:13 UTC (Thu)
                               by <b>dmarti</b> (subscriber, #11625)
                              [<a href="/Articles/243193/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Subjectively, for me, running that shell function seems to get rid of the lag on alt-tab to Firefox, Gimp, or OpenOffice first thing in the morning.<br>
<p>
What would be better, for a desktop system, would be a "goodnight" script that would run housekeeping tasks such as updatedb and logrotate, then page back in whatever the user had been working on, then suspend.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243193/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243452"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">explicit pagein</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 22:12 UTC (Fri)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/243452/">Link</a>] 
      </p>
      
      </div>
      </summary>
      To avoid the manual step (either good morning or good night), I run this in a cron job every hour all day.  It doesn't matter that the interactive programs get paged in uselessly several times during the night; even if done right in the middle of updatedb, they just get paged right out again and the cost is insignificant.
<p>
I also send messages through some response-time-critical daemons regularly, to "loosen them up."  I.e. page in executables, anonymous pages, etc.

      
          <div class="CommentReplyButton">
            <form action="/Articles/243452/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor243312"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 0:05 UTC (Fri)
                               by <b>jschrod</b> (subscriber, #1646)
                              [<a href="/Articles/243312/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Then you will be surprised.<br>
<p>
When you get 2GB (I have them), just start Eclipse on a larger project, while Firefox and Thunderbird are running; and watch your memory getting used. And you didn't even start any VM (Xen or VMware)...<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243312/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor243031"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2007 23:50 UTC (Wed)
                               by <b>kune</b> (guest, #172)
                              [<a href="/Articles/243031/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      If Firefox is really faster on Windows than on Linux, then it should be easy to hack some benchmarks in Javascript to prove it. Nobody will be able to fix it, if he cannot measure the performance. And Internet network bandwidth has be taken out of the equation.<br>
<p>
Sure, you can write bad code in any language, but in my experience Python is not particularly slower than other script languages. Here is a benchmark that appears to validate that experience: <a href="http://www.timestretch.com/FractalBenchmark.html">http://www.timestretch.com/FractalBenchmark.html</a> Another one is here: <a href="http://acker3.ath.cx/wordpress/archives/7">http://acker3.ath.cx/wordpress/archives/7</a><br>
<p>
Lua might be something to look at.<br>
<p>
Of course you will always be able to write faster code in C, but this will take you some more time.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243031/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243033"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2007 23:53 UTC (Wed)
                               by <b>JoeBuck</b> (subscriber, #2330)
                              [<a href="/Articles/243033/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Besides, for a GUI program "written in Python" all the expensive code is actually in libraries that are written in C or C++, with a thin binding to allow calls from Python.  yum isn't slow because of Python, but because it does way too many system calls and I/O.

      
          <div class="CommentReplyButton">
            <form action="/Articles/243033/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor243036"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 0:09 UTC (Thu)
                               by <b>briangmaddox</b> (guest, #39279)
                              [<a href="/Articles/243036/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      "Of course you will always be able to write faster code in C, but this will take you some more time."<br>
<p>
Ya had me until you said this.  Why stop at C, when it could be written in ASM?  And heck, how do you know the assembler will generate fast code, better do it in hex instead.<br>
<p>
I would have thought that after all these years that people would learn more about computer science and programming than to troll the "C is always faster than everything else" line.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243036/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243084"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 5:15 UTC (Thu)
                               by <b>wilreichert</b> (guest, #17680)
                              [<a href="/Articles/243084/">Link</a>] 
      </p>
      
      </div>
      </summary>
      "Ya had me until you said this. Why stop at C, when it could be written in ASM? And heck, how do you know the assembler will generate fast code, better do it in hex instead."<br>
<p>
Hex?  No thanks, i prefer to hack the macro assembler and control the logic gates on my cpu directly.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243084/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor243114"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 9:46 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/243114/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      The thing to do is to generate the assembler and then munge it with a horrible perl script.<br>
<p>
(Hey, ghc does it, it must be good! :) )<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243114/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243138"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 12:04 UTC (Thu)
                               by <b>dcoutts</b> (subscriber, #5387)
                              [<a href="/Articles/243138/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Shh! You're not supposed to tell people about that, it's called the Evil Mangler for a good reason.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243138/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243161"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 13:51 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/243161/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Having just watched it use fifteen minutes of CPU time (on the ghc lexer, natch) I think it needs bringing into the light so it can be optimized by some hardier soul than I :)<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243161/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor243463"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">program speed vs programming language</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 23:06 UTC (Fri)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/243463/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
Why stop at C, when it could be written in ASM?
</blockquote>

<p>That's not a natural progression.  Code compiled from C is often faster than that compiled from assembly language, for the same reason that a computer can land an airplane more smoothly than a human.  Even code compiled from C by a naive compiler (e.g. gcc -O0) is unlikely to be slower than code compiled from assembly language.  C is that low-level a language.

<blockquote>
how do you know the assembler will generate fast code, better do it in hex instead
</blockquote>
<P>
We <em>do</em> know that.  The assembler will generate code that is not only the same speed as that generated by the hex editor, but is actually the same code.  That's the definition of assembly language.

<blockquote>
I would have thought that after all these years that people would learn more about computer science and programming than to troll the "C is always faster than everything else" line.
</blockquote>
<p>
The only line I saw was, "C is always faster than Python."  And it is, isn't it?

      
          <div class="CommentReplyButton">
            <form action="/Articles/243463/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243748"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">program speed vs programming language</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 31, 2007 12:08 UTC (Tue)
                               by <b>liljencrantz</b> (guest, #28458)
                              [<a href="/Articles/243748/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Depends on how you define your scope. I've seen situations where people solve the same problem in different languages, and because they have to spend so much time to do _anything_ in a low-level language, they are forced to chose a dumb algorithm, whereas people coding in a high level language can spend more time on the high level logic and can therefore chose a fast algorithm.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243748/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor243113"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 9:44 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/243113/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Benchmarks in Javascript will mostly show the performance of the JS interpreter and things it can block on, i.e. it's not a complete monitoring tool by any means.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243113/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor243096"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 7:46 UTC (Thu)
                               by <b>pointwood</b> (guest, #2814)
                              [<a href="/Articles/243096/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      "Ubuntu and Red Hat both have this obsession with Python, which is about as bloaty a language as you can get, and then they write crappy apps in Python that would be slow as molasses even in C because they use crappy algorithms." <br>
<p>
Could you elaborate on that? I'm not much of a coder, but it would be interesting to hear what the problem with python is since I have considered playing with it. <br>
<p>
In regards to Ubuntu and Redhat, well I bet they are open for improvements to their code though you don't say what apps it is. Your comment lacks facts.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243096/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243104"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 8:28 UTC (Thu)
                               by <b>rsidd</b> (subscriber, #2582)
                              [<a href="/Articles/243104/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      There's nothing wrong with python (or other high-level languages), and it worked fine on linux systems 10 years ago.  C is faster only for CPU-bound tasks, which hardly any system tasks are.  C <i>may</i> be less memory intensive (it depends on what libraries you're using, what your coding style is, and so on), but with C you have to be careful about all kinds of bugs and security holes (buffer overflows, memory leaks, etc) that even experts get bitten by, but don't occur with high-level languages.
      
          <div class="CommentReplyButton">
            <form action="/Articles/243104/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243140"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 12:23 UTC (Thu)
                               by <b>rwmj</b> (subscriber, #5474)
                              [<a href="/Articles/243140/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Oh dear no there's _plenty_ wrong with Python.  It's dynamic<br>
typing nature means that simple objects have huge amounts of<br>
baggage that they have to carry around, mostly never used.<br>
<p>
C sucks for programming too, for the reasons you outline.<br>
<p>
But guess what folks!  C and Python are not the only programming<br>
languages in the world!!  You won't believe it, but other<br>
programming languages have been invented.<br>
<p>
My personal fave at the moment is OCaml.  About as fast as C,<br>
statically typed, no buffer overflows, small memory footprint,<br>
access to Perl &amp; Python libraries, and loads of native libs.<br>
<p>
Rich.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243140/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243361"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 11:56 UTC (Fri)
                               by <b>IkeTo</b> (subscriber, #2122)
                              [<a href="/Articles/243361/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; C and Python are not the only programming</font><br>
<font class="QuotedText">&gt; languages in the world!! You won't believe it, but other</font><br>
<font class="QuotedText">&gt; programming languages have been invented.</font><br>
<p>
<font class="QuotedText">&gt; My personal fave at the moment is OCaml. About as fast as C,</font><br>
<font class="QuotedText">&gt; statically typed, no buffer overflows, small memory footprint,</font><br>
<font class="QuotedText">&gt; access to Perl &amp; Python libraries, and loads of native libs.</font><br>
<p>
Two suggestions.  Suggestion 1: start lobbying people all around to start using OCaml: universities, companies, etc.  If you are successful you have a bunch of people who *know* what it is (currently the people with that characteristics are so few that it doesn't matter).  Or choose suggestion 2: start implementing some *real cool* thing in OCaml, making sure that developing the equivalent thing (e.g., with same performance, flexibility, etc) is so expensive that nobody can do *because of a choice of different language*.  Then you serve as an example showing others the real benefit of the language.<br>
<p>
Before you do so, accept that languages behaving the same way as in C or Python are those who know by those who work on creating applications.  Problem is, money talks.  If the industry do need C and Python, that's what's university courses teach, that's what's people know, and that's what applications will be written in.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243361/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor244019"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 2, 2007 7:40 UTC (Thu)
                               by <b>renox</b> (guest, #23785)
                              [<a href="/Articles/244019/">Link</a>] 
      </p>
      
      </div>
      </summary>
      My problem with Ocaml is its syntax and its functional mindset: I tried once to learn Ocaml and I disliked the syntax plus the PDF book I used insisted on using functional way to solve everything which is strange as Ocaml is said to support both imperative and functional style, why the book insisted so much on the functional style is beyond me, bleach.<br>
<p>
So to be successful, Ocaml would need 2 things:<br>
1) replace the current default syntax  with a better one.<br>
There is already an alternative syntax for Ocaml (so apparently I'm not the only one who don't like the default syntax), it's quite better and F# (an Ocaml clone for .Net) 's syntax looks even better.<br>
2) improve tutorials book to teach both imperative style and functional style, without having such blatant bias towards functional style, it has its place but not for everything.<br>
<p>
Somehow I doubt that will happen, so Ocaml is bound to stay in the limelight..<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/244019/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor243189"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 15:15 UTC (Thu)
                               by <b>arjan</b> (subscriber, #36785)
                              [<a href="/Articles/243189/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; There's nothing wrong with python</font><br>
<p>
... except that even a simple "hello world" seems to take 40 megabytes of memory. It's not about a few cpu cycles that kills you in performance, it's the enormous overhead that even simple programs get....<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243189/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243231"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 17:11 UTC (Thu)
                               by <b>vmole</b> (guest, #111)
                              [<a href="/Articles/243231/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      That is so much crap.
<pre>
$ cat hello.py
import time
print "hello, world"
time.sleep(30)

% python hello.py &amp;
[1] 25243
hello, world
$ ps l -C python
F   UID   PID  PPID PRI  NI    VSZ   RSS WCHAN  STAT TTY        TIME COMMAND
0  1000 25446  2688  17   0   3844  2256 -      S    pts/0      0:00 python hello.py
</pre>
<p>So that's 2M resident, 4M virtual. And it exagerates a simple "hello world" program, because I had to import the time module for sleep() so I could run ps. Most of it is the interpeter itself, so multiple python programs don't actually take 4M each.
<p>Python isn't perfect - what language is? But don't make stuff up, it just ruins your argument.

      
          <div class="CommentReplyButton">
            <form action="/Articles/243231/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243251"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 19:01 UTC (Thu)
                               by <b>nevyn</b> (guest, #33129)
                              [<a href="/Articles/243251/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <p> Let's try longer than 30 secs, eh?</p>
<pre>
% ps ax -o cmd:50,vsz,rss,stime | egrep '[p]ython'
/usr/bin/python -E /usr/sbin/setroubleshootd       808024 12104 Jul06
python /usr/share/system-config-printer/applet.py  232764  6436 Jul06
/usr/bin/python -E /usr/bin/sealert -s             411728 18524 Jul06
python /usr/libexec/revelation-applet --oaf-activa 458328 55056 Jul06
python /usr/lib64/gdesklets/gdesklets-daemon       453980 65768 Jul23
python ./hpssd.py                                  171220  1176 Jul11
</pre>

<p>...that's 2_536_044 KB VSZ and 159_064 KB RSS, and as you can see I've rebooted gdesklets recently (it was roughly double that, I think).</p>
<p> Plus I'm not running pupplet/yum-updatesd atm. And for instance "revelation-applet" is just a text entry box 95% of the time.</p>

<p> I appreciate that the huge VSZ numbers are (hopefully) mostly unused shared libs. etc. but half a GB is still a lot for the OS to manage for a text box, and 40+MB of RSS for a simple GUI is far from "so much crap".
</p>

<p> For comparison my webserver uses two processes with a VSZ of about 12MB each and RSS of about 1MB each, and I'd prefer that to be smaller.</p>

      
          <div class="CommentReplyButton">
            <form action="/Articles/243251/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243259"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 19:24 UTC (Thu)
                               by <b>vmole</b> (guest, #111)
                              [<a href="/Articles/243259/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>You said "a simple hello world" program, and that's what I tested. Comparing GUI programs to a webserver is irrelevant. What you've mostly demonstrated is that that GNOME/GTK is huge. Blaming that on Python doesn't seem to make sense. I'd bet a Perl implemenation of the same programs would be equally huge.

      
          <div class="CommentReplyButton">
            <form action="/Articles/243259/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor243111"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 9:37 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/243111/">Link</a>] 
      </p>
      
      </div>
      </summary>
      The page cache is not an `unnecessary but nice performance enhancement'. The text pages of all your binaries are sitting in there while they run, as is all your other mmap()ed stuff. If your page cache was empty you'd not be able to run any userspace code to speak of.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243111/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor243154"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 13:22 UTC (Thu)
                               by <b>cate</b> (subscriber, #1359)
                              [<a href="/Articles/243154/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <i>_Linux_ has been getting worse, or the shit that people use on their systems is getting worse?</i>

<p>
Check the size of a Linux kernel, and you will see that the is a bigger increment (in percent) in 5 years than the memory used by mozilla.  We have more memory, so we can afford to use it more inefficiently.



      
          <div class="CommentReplyButton">
            <form action="/Articles/243154/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243211"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 16:19 UTC (Thu)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/243211/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>I was barely able to boot Linux on 2MB system back then. Today I need 8Mb for that. Netscape was quite useful on 12MB Linux system (8MB was too slow), today you can barely even start Firefox on 48MB system. Huge size of Linux kernel in real life is mostly page tables so I think Linux and Firefox grew in unison...</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243211/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor243582"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 30, 2007 8:35 UTC (Mon)
                               by <b>gouyou</b> (guest, #30290)
                              [<a href="/Articles/243582/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <i>We have more memory</i><br />
Not really take a look at the OLPC or at the new development on the embeded device scene (Nokia N770/N800, OpenMoko) ...
      
          <div class="CommentReplyButton">
            <form action="/Articles/243582/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor244162"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 3, 2007 4:04 UTC (Fri)
                               by <b>bersl2</b> (guest, #34928)
                              [<a href="/Articles/244162/">Link</a>] 
      </p>
      
      </div>
      </summary>
      "We have more memory, so we can afford to use it more inefficiently."<br><br>

That's badly worded. It would be more correct to say that memory efficiency has been sacrificed for time efficiency.
      
          <div class="CommentReplyButton">
            <form action="/Articles/244162/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor243034"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 25, 2007 23:56 UTC (Wed)
                               by <b>ronaldcole</b> (guest, #1462)
                              [<a href="/Articles/243034/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Let's clarify...  in a GNU/Linux system, the GNU part is getting bigger and slower.  I can still happily load and run Debian 4.0 on a DX4/100 with 32M of ram and a 2G hdd.  Can't do anything that involves a GUI, though.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243034/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor243035"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 0:03 UTC (Thu)
                               by <b>tomsi</b> (subscriber, #2306)
                              [<a href="/Articles/243035/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <p><em>It seems that Linux may still be a little more efficient than Vista on most loads (but not Firefox) but back in the nifty nineties Linux was a _lot_ more efficient than Windows. In short, Linux has been getting worse faster than Windows.</em>
</p>
<p>
I am not sure if I agree with that. I am writing this on a Dell laptop with a 1GHz CPU and 512MB of memory. It is a pain to use on Windows XP, and I wouldn't dare try to put Vista on it. But latest version of Ubuntu trundles along quite nicely. There are a few applications that struggles; like eclipse; but they struggled 3 years ago too.

Tom
</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243035/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243308"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Bloat</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 0:16 UTC (Fri)
                               by <b>jmorris42</b> (guest, #2203)
                              [<a href="/Articles/243308/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; I am writing this on a Dell laptop with a 1GHz CPU and 512MB of memory.</font><br>
<p>
You say that like you think that is a small machine.  It shouldn't be, and that is the problem.<br>
<p>
I remember running early GNOME based RedHat distributions on 300Mhz machines with 128M and it being totally usable.  Bumped it to 256MB and could run Win95 under VMWare. (Gave Windows 64MB)<br>
<p>
Now look at the pitiful state of bloat we have.  Anaconda pretty much requires 512MB now unless you install in text mode.  Red Hat won't even support a RHEL machine without a full GB.  And I know ps's memory stats aren't all that reliable but look at the memory and CPU needs to bring up a GNOME or KDE desktop and a browser.<br>
<p>
And speaking of insane, take a look at conglomerate. I have a test machine loaded up with F7 (Athlon64 2800 with 512MB) and tried using conglomerate to open up the Fedora 7 comps.xml file.  After several minutes of constant thrashing went by as the poor machine exhausted all memory and swap the OOM killer finally put it out of it's misery.  This is a 0.9 release so I'm assuming this sort of memory performace isn't considered a show stopper bug.  More likely none of the devels (who by definition have big enough machines to compile a hog like Conglomerate) noticed the memory consumption.<br>
<p>
I think the problem probably stems from the same source as Window's bloat.  The developers no longer feel the pain.  Ten years ago many key developers on every part of the stack from kernel to desktop (browser excluded prior to Mozilla becoming viable...) were private individuals, with a fair number outside the US/western Europe.  The upshot of that was that they had hardware closer to a 'typical' machine.  Now most of the key developers are using machines bought with OPM, i.e. corporate developer 'workstations' with big honking specs.<br>
<p>
Perhaps the key developers should be given a $1,500 budget to buy their workstation with and then give them assess via ssh to a 'compile host' so they don't have to sit and spin waiting for compiles but DO have to sit and spin waiting on OO.o or Firefox.  This would motivate them to care about resource consumption in more realistic desktop environments and not just care how well their quad Opteron monster squeezes the last percentage from all of it's CPUs.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243308/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243570"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Bloat</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2007 21:35 UTC (Sun)
                               by <b>njs</b> (guest, #40338)
                              [<a href="/Articles/243570/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt;Perhaps the key developers should be given a $1,500 budget to buy their workstation with</font><br>
<p>
Err... you can get 2GB of memory for &lt; $100 these days.  From a glance at dell.com, right now $550 low-end desktops come with 1GB of memory default, and $750 ones with 2GB.  There are still real cases where memory is limited (embedded devices, OLPC, people living in non first-world countries, ...), but your scale seems a bit miscalibrated.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243570/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor244532"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Bloat</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 6, 2007 20:49 UTC (Mon)
                               by <b>happycube</b> (guest, #42855)
                              [<a href="/Articles/244532/">Link</a>] 
      </p>
      
      </div>
      </summary>
      The real problem is with older hardware - it's impossible to get more than 512MB in an i815-based P3, for instance.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/244532/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor244851"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Bloat</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2007 2:28 UTC (Thu)
                               by <b>jmorris42</b> (guest, #2203)
                              [<a href="/Articles/244851/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I really hate this notion that a three year old computer should be tossed in the trash as so obsolete there is no use it can be put to.  Linux used to be a good way to get good use out of older hardware.  Not anymore.  Now you need hardware equal to, and prior to Vista shipping greater than, the minimum Windows baseline.<br>
<p>
And just throwing hardware at the problem doesn't make it go away.  Having 2GB of RAM will make it livable but hard drives aren't getting all that much faster.  Paging in enough of OO.o and all the libraries it needs to get to mapping the initial window means looking at a throbber almost as long on a hot new monster PC as it does on an older one.  Same for all the disc thrashing involved in logon as multi-megabyte blobs of libraries and executables are mapped in to provide what should be small crap like battery indicators and CPU speed monitor widgets in menu bar.<br>
<p>
Having more resources is no excuse for sloppy and wasteful practices.  And if we want our stuff to be an option for the coming world of smart phones, flash based laptops (without swap) and the embedded world we need to be thinking about getting our act together now.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/244851/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor243045"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">non-sequitur</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 1:14 UTC (Thu)
                               by <b>qu1j0t3</b> (guest, #25786)
                              [<a href="/Articles/243045/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Memory 'needs' increase exponentially in a Moore's Law like process that is entirely unrelated to Linux. You can still run Linux on tiny systems (I know people running 2.6 on systems smaller than 32MB), which is not true of any recent version of Windows.<br>
<p>
Your conclusion simply does not follow from Nick Piggin's quite reasonable postulate.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243045/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor243059"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 1:56 UTC (Thu)
                               by <b>sobdk</b> (guest, #38278)
                              [<a href="/Articles/243059/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <p><em>Now I've been programming since magnetic drums were hip so I may be a bit confused here but it seems to me that I can remember a time less than a decade ago when a system didn't need a couple of gigs to run Linux well.</em></p>

<p>I would say it still does.  I'm writing this as we speak from a PIII 700 MHz  with 256 MB of RAM and honest Linux runs great.  I even use Firefox which tends to eat up 50% of my RAM according to top, but still no complaints.  In fact even with Firefox using half my RAM I'm still not even touching swap.</p>

<p>Interestingly enough when I read some of the posts on lkml claiming that they had 1GB of RAM and swap prefetch drastically improved their workload, all I could think is "what on earth are these people running?"  Until a couple of months ago my dev-machine at work only had 512 MB of RAM and had all kinds of nasty things like Firefox, beagle, and Lotus Notes running but my swap was rarely used.  Conversely on days when I was forced to boot it into Windows XP for one reason or another I couldn't leave an application minimized for more than 10 minutes before Windows decided to swap it out.  Waiting 1 minute every time I switch apps on Windows is enough to make me go crazy and be thankful that Linux has a sane swapping algorithm.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243059/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243068"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 2:41 UTC (Thu)
                               by <b>Richard_J_Neill</b> (subscriber, #23093)
                              [<a href="/Articles/243068/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      Hmm - I've just upgraded to a 64-bit desktop machine. The principal reason is so that firefox can address &gt; 4GB of swap (!). Really, FF crashes on me about once a week, because although I have 2GB RAM  and 6GB of swap, firefox manages to malloc() 4 GB! No idea where it is going - admittedly I tend to have about 200 tabs open, but that alone shouldn't be the problem.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243068/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243181"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 14:51 UTC (Thu)
                               by <b>lysse</b> (guest, #3190)
                              [<a href="/Articles/243181/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      Well, 200 tabs at about 2Mb per tab would use up your 4Gb quite effectively...<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243181/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243283"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Off by an order of magnitude?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 20:29 UTC (Thu)
                               by <b>martinfick</b> (subscriber, #4455)
                              [<a href="/Articles/243283/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      200 * 2MB = 400MB != 4GB<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243283/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243331"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Off by an order of magnitude?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 6:04 UTC (Fri)
                               by <b>man_ls</b> (guest, #15091)
                              [<a href="/Articles/243331/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      Let's make it 20 MB then per tab. If each page is three screens high, and my screen is 1680x1050, with 4 bytes per pixel (3 colors + alpha):
<p>
1680 x 1050 (pixels/screen) x 4 (bytes/pixel) x 3 (screens) = 20672 MB.
<p>
We do want the pages to be cached when we switch tabs, don't we?
      
          <div class="CommentReplyButton">
            <form action="/Articles/243331/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243332"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Off by three orders of magnitude!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 6:06 UTC (Fri)
                               by <b>man_ls</b> (guest, #15091)
                              [<a href="/Articles/243332/">Link</a>] 
      </p>
      
      </div>
      </summary>
      That should read 20672 KB, sorry.
      
          <div class="CommentReplyButton">
            <form action="/Articles/243332/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor243380"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Off by an order of magnitude?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 14:36 UTC (Fri)
                               by <b>Los__D</b> (guest, #15263)
                              [<a href="/Articles/243380/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      Yeah we do, but does it really cache a bitmap of the page? That would seem a bit silly<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243380/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243449"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Bitmap cache</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 21:57 UTC (Fri)
                               by <b>man_ls</b> (guest, #15091)
                              [<a href="/Articles/243449/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <blockquote type="cite">
Yeah we do, but does it really cache a bitmap of the page?
</blockquote>
I don't know exactly, but I would say it does. Loading a couple of big JPEG files takes quite longer than changing tabs between them.
<blockquote type="cite">
That would seem a bit silly
</blockquote>
Why, exactly? If you have the RAM to spare, it seems to be as good as any other use. I seem to remember some discussion on LWN about Firefox caching even pages in the history.
<p>
When people complain that "Firefox eats up 2 GB" in a 4 GB machine, it gives the wrong impression. Firefox runs fine on my 128 MB laptop, and memory seldom goes above 80 MB.
      
          <div class="CommentReplyButton">
            <form action="/Articles/243449/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243512"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Bitmap cache</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2007 13:38 UTC (Sat)
                               by <b>Los__D</b> (guest, #15263)
                              [<a href="/Articles/243512/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      I would never (never EVER) suggest using JPEG for computer graphics, but caching in PNG would seem smarter than a bitmap, and not really that much slower. Of course, when you only have 3-4 tabs, it wouldn't really matter, but as the count goes up, you can much better afford the CPU than the memory. Plus, the CPU is only when you change, the memory usage is constant.<br>
<p>
I'm not completely sure how uncompressed PNG would handle the JPEG's on the page, but I couldn't imagine it getting worse (memory wise) than bitmap, just equal. (I've been known to be naive in my expectations from formats though).<br>
<p>
The browser (toolkit?) could of course also do some kind of checking of available memory, and change algorithm from that, but maybe that is an unneeded complexity.<br>
<p>
I don't know, maybe it's easiest/simplest and mostly correct to just keep the rendered pages as is in memory, but for some usage patterns, it does become a huge waste of memory.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243512/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243514"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Bitmap cache</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2007 13:51 UTC (Sat)
                               by <b>man_ls</b> (guest, #15091)
                              [<a href="/Articles/243514/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <blockquote type="cite">
I would never (never EVER) suggest using JPEG for computer graphics
</blockquote>
I wouldn't either. My little experiment with JPEG images involved decompressing a JPEG image vs. caching an uncompressed bitmap. Caching images in a lossy format would be ludicrous.
<p>
But caching in a lossless format such as PNG isn't such a good idea either. An important aspect of caches is that you should store an artifact which you already have, not one you have to generate. If you have to compress a bitmap to PNG before caching it, you are wasting a lot of CPU time just to generate a cache which you might as well never use again.
<p>
An example: you download a JPEG image, then uncompress it to show it, and then you compress it to PNG before caching it in memory. Messy.
      
          <div class="CommentReplyButton">
            <form action="/Articles/243514/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243516"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Bitmap cache</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2007 14:00 UTC (Sat)
                               by <b>Los__D</b> (guest, #15263)
                              [<a href="/Articles/243516/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      It really depends on the cost of CPU vs. the cost of memory.<br>
<p>
For most usage patterns, I agree, but for those that likes to have 30+ tabs open (for some reason), caching the uncompressed bitmap is a _big_ waste.<br>
<p>
The question is if the best approach wouldn't be to just forget or limit those caches for that kind of usage. At least the bitmap approach is asking for disk trashing.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243516/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253773"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Bitmap cache</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2007 18:49 UTC (Tue)
                               by <b>Blaisorblade</b> (guest, #25465)
                              [<a href="/Articles/253773/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I've read time ago a comment from a OLPC developer on exactly this issue. I'm writing a summary of his comments I recall.<br>
Basically, an application can store an uncompressed bitmap in the X server. And Firefox caches all images this way! That's the problem. Probably avoiding the caching would be even faster (due to no swapping).<br>
<p>
IMHO (and this is my opinion, I don't recall his one) a reasonable solution would be to extend the X protocol to allow caching compressed images in most reasonable formats (including especially JPEG). Then the X server can keep a cache of most shown decoded images.<br>
<p>
Since the JPEG compression ratio is huge, there would be a huge gain from this.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253773/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor244847"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Off by an order of magnitude?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 9, 2007 1:51 UTC (Thu)
                               by <b>lysse</b> (guest, #3190)
                              [<a href="/Articles/244847/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Quite right. Sorry. Oops.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/244847/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor243482"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2007 3:43 UTC (Sat)
                               by <b>roelofs</b> (guest, #2599)
                              [<a href="/Articles/243482/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <FONT COLOR="#880044"><I>Really, FF crashes on me about once a week, because although I have 2GB RAM and 6GB of swap, firefox manages to malloc() 4 GB!</I></FONT>

<P>
Geez, what are you doing to the poor thing??

<P>
<FONT COLOR="#880044"><I>No idea where it is going - admittedly I tend to have about 200 tabs open, but that alone shouldn't be the problem.</I></FONT>

<P>
OK, that might do it...  I have two FF windows containing a total of 9 tabs, and it's been running since early March.  Total memory usage (per ps(1)):  197M allocated, 157M resident.  (Of course, there's also X11 pixmaps, as was noted in another LWN article a while back.  I've forgotten how to check that, but even if FF were the sole X client--which it's not, by far--that's only another 194M allocated and 46M resident.)

<P>
Greg
      
          <div class="CommentReplyButton">
            <form action="/Articles/243482/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243868"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 1, 2007 2:23 UTC (Wed)
                               by <b>set</b> (guest, #4788)
                              [<a href="/Articles/243868/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      xrestop will show you the X memory usage, such as pixmaps.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243868/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243930"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 1, 2007 16:43 UTC (Wed)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/243930/">Link</a>] 
      </p>
      
      </div>
      </summary>
      One of these days someone needs to add the amount of CPU X spent per client to xrestop.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243930/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor244281"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 3, 2007 23:45 UTC (Fri)
                               by <b>roelofs</b> (guest, #2599)
                              [<a href="/Articles/244281/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <FONT COLOR="#008844"><I>xrestop will show you the X memory usage, such as pixmaps.</I></FONT>

<P>
Danke, sir!  That's the command I couldn't recall.

<P>
Greg
      
          <div class="CommentReplyButton">
            <form action="/Articles/244281/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor243063"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 2:14 UTC (Thu)
                               by <b>h2</b> (guest, #27965)
                              [<a href="/Articles/243063/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt;I can remember a time less than a decade ago when a system didn't need a couple of gigs to run Linux well.</font><br>
<p>
Don't worry, it's still fine, running 2.6.22.1 kernel on old hardware, with a light desktop, xfce4, running lots of little server things, nfs, vnc, streaming, etc, the system using... 90 mB ram, out of 192 mB total. I originally had 512 in it but it never got remotely close to using it so I pulled it out and put back in small sticks I had lying around. Once in a while it uses swap, a tiny bit, but not often.<br>
<p>
For full desktop like kde or gnome, 256 is what you need to avoid swapping.<br>
<p>
And more for dev work, vmware, heavy graphics, and so on. Just because you put in 2 gig doesn't mean you use it, this box has 2 and it's using 3/4 gig with 50 or so apps open on 8 virtual desktops. But fire up a vmware or vbox install or two and you're getting closer to 2 gigs.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243063/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor243060"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 2:21 UTC (Thu)
                               by <b>butlerm</b> (subscriber, #13312)
                              [<a href="/Articles/243060/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      Isn't this precisely the sort of thing that should be controlled from  user space?  i.e. let the kernel provide the mechanism and let a user space daemon implement the policy?<br>
<p>
For example, couldn't one create a virtual file called /proc/&lt;pid&gt;/swapin that when written to, fetches all the swapped data for that process back into ram?<br>
<p>
The advantage, of course, would be that no existing users would be affected, and the optimal swap prefetch policy could be adjusted according to the application.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243060/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243087"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 6:32 UTC (Thu)
                               by <b>sitaram</b> (guest, #5959)
                              [<a href="/Articles/243087/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      well I already do something like that :-)<br>
<p>
All my cron jobs finish by around 7am, so at about 8am (I usually come in to work around 8:15), cron runs "swapoff -a; swapon -a".<br>
<p>
Seems to be OK.  I guess one day I will leave FF running with a gazillion tabs and it will get OOM-killed on the swapoff command, but hasn't happened yet...<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243087/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243106"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 8:41 UTC (Thu)
                               by <b>tialaramex</b> (subscriber, #21167)
                              [<a href="/Articles/243106/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      What you've described isn't quite the Right Thing though.<br>
<p>
Eliminating swap with swapoff will force the kernel to bring back anonymous pages that had been pushed out, but not pages which are associated with existing storage, such as (almost all) program text, and mmap'd data files.<br>
<p>
It's obviously possible to arrange for the kernel to notice that there's a lot of free RAM and a lot of pages, anonymous or otherwise that aren't in RAM and fix that. Unfortunately merely having a good idea isn't enough in Free Software, and in the kernel it's not even enough to have a good idea and an implementation.<br>
<p>
One worry which swap prefetch people might be able to reassure me on - does it understand that if I have 2GB of as-yet unused RAM and a fresh 2GB mmap() I don't necessarily want it to try to pull all those pages off disk? ie does it know the difference between pages that have been pushed out and those which were simply never needed yet?<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243106/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243573"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 29, 2007 23:27 UTC (Sun)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/243573/">Link</a>] 
      </p>
      
      </div>
      </summary>
      but if the system is pulling the pages off of disk while the system is idle, and puts those pages at the end of the LRU list so that they are the first thing thrown away if you need more memory, what does it hurt you to pull them in and never use them?<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243573/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor243372"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 12:52 UTC (Fri)
                               by <b>IkeTo</b> (subscriber, #2122)
                              [<a href="/Articles/243372/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; The advantage, of course, would be that no existing users would be</font><br>
<font class="QuotedText">&gt; affected, and the optimal swap prefetch policy could be adjusted according</font><br>
<font class="QuotedText">&gt; to the application.</font><br>
<p>
The disadvantages are, of course, that (1) few programs will use that interface, since it is too system dependent, (2) few programs will use that interface at the time it matters, since developers usually cannot exactly know when their program will need a lot of memory (who knows that a crazy user create ten thousand bookmarks in his browser and call expand all...), and (3) large program with VM even larger than the available RAM will fail (or cause the whole system to run very slowly) the moment it calls that interface, and most unluckily, it happens only on some small systems that the developer doesn't have access to.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243372/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor243066"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 2:38 UTC (Thu)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/243066/">Link</a>] (19 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>But some users were reporting real regressions with RSDL and were being told that those regressions were to be expected and would not be fixed. This behavior soured Linus on RSDL and set the stage for Ingo Molnar's CFS scheduler. Some (not all) people are convinced that Con's scheduler was the better design, but refusal to engage with negative feedback doomed the whole exercise.</blockquote>
<p>
I was following most of that on LKML as it happened, and the way that I saw it was that a guy testing RSDL was reporting the fact that his X server now got 25% CPU instead of 75% as a regression.
<p>
Con did respond.  He said the scheduler was fair, that was the design, and that he (the tester) could renice X to -10 or -15 if he wished.
<p>
I don't see how else Con could respond to that.  RSDL was supposed to be fair.  Giving X 75% isn't fair.  There's just no way to resolve those two things.
      
          <div class="CommentReplyButton">
            <form action="/Articles/243066/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243103"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 8:29 UTC (Thu)
                               by <b>jospoortvliet</b> (guest, #33164)
                              [<a href="/Articles/243103/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      Indeed. Imho Corbet should've mentioned this properly - Con did get <br>
negative comments, but those where entirely silly. Complaining about the <br>
fairness of a fair scheduler???<br>
<p>
He might also have mentioned that by design, it is extremely unlikely to <br>
find negative consequences of using swap-prefetch (which explains why <br>
there are no real bugreports), and how the whole updatedb issue might be <br>
solved by other means, but that doesn't go for all things swap-prefetch <br>
helps.<br>
<p>
For example, start OO.o on a low-mem machine, work in it, close it. Now <br>
you've got 60 mb free ram. Swap prefetch will start filling that with <br>
your swapped-out pages pretty quick, and if those pages are firefox or <br>
some other app (which is likely, as swap-prefetch starts with the most <br>
important data), you're pretty happy. There is NO other way of doing this <br>
than swap-prefetch.<br>
<p>
I think the main reason SwPr didn't make it in is that those who have to <br>
decide over it have very very bulky hardware, and their employers are <br>
very afraid it MIGHT in some weird way influence the 1024-cpu linux <br>
deployments, and they don't care about the desktop at all.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243103/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243157"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 13:35 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/243157/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <blockquote><i> Indeed. Imho Corbet should've mentioned this properly - Con did get
negative comments, but those where entirely silly. Complaining about the
fairness of a fair scheduler???</i></blockquote>
<p>
That's just the sort of approach which created trouble for SD/RSDL.  If people see regressions with their workloads, stamping a "100% certified fair!" label on it will not make them feel better about it.  You have to address these problems; if you are unwilling to do so, your code will not make it into the kernel.
<p>
CFS is also a "fair" scheduler, but it has not drawn the same sort of complaints - though it will be interesting to see what happens as the testing community gets larger.  As I understand it, the CFS brand of "fairness" takes a longer-term view, allowing tasks to get their "fair" share even if they sleep from time to time.  That helps to prevent the sort of regressions seen with SD.
<p>
The real key, though, is what happens when things go wrong.  There will certainly be people reporting scheduler issues over the 2.6.23 cycle.  Ingo and the other CFS hackers could certainly dismiss them as "entirely silly," seeing as the scheduler is "completely fair," after all.  But they won't do that.  Instead, they will do their best to understand and solve the problems.  <i>That</i> is why CFS is in the kernel, and SD is not.
      
          <div class="CommentReplyButton">
            <form action="/Articles/243157/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243174"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 14:40 UTC (Thu)
                               by <b>nevyn</b> (guest, #33129)
                              [<a href="/Articles/243174/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      That is a very bad analogy, for a "fair" scheduler change requests along the lines of "app. X does Y, and gets an unfair amount of CPU" and should be dealt with promptly. Change requests like "app. X does Y, and I want it to get an unfair amount of CPU" should be solved another way. We didn't drop SELinux because random uid=0 processes could no longer re-write my /etc/shadow file, because that was a desired result.<br>
<p>
Looking at it another way if you create holes in the algo. so that Xorg can walk through them, then so can any other piece of code. The correct fix was pointed out, if Xorg needs more CPU time than "normal" then just tell the kernel that using the interfaces specially for that purpose (Ie. nice).<br>
<p>
IMNSHO CFS got into the kernel because Ingo wrote it, and basically no other reason. That's not entirely a bad thing, but it's not entirely a good thing either and doing "unbiased" reporting pretending otherwise isn't helping anyone.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243174/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243243"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 17:38 UTC (Thu)
                               by <b>erwbgy</b> (subscriber, #4104)
                              [<a href="/Articles/243243/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <p><i>"unbiased" reporting pretending otherwise isn't helping 
anyone.</i></p>

<p>Of course it is not unbiased reporting - we pay good money for Jon's 
opinion.  That's what an editorial is.  Jon explained quite clearly, and 
even-handedly in my opinion, why he came to the conclusion he did.  Agree 
with him or not (and I certainly don't always), but criticising his 
reporting because you don't agree with his conclusions is not helping 
anyone.</p> 
      
          <div class="CommentReplyButton">
            <form action="/Articles/243243/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243250"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 18:26 UTC (Thu)
                               by <b>nevyn</b> (guest, #33129)
                              [<a href="/Articles/243250/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      Maybe that sounded worse that I wanted it to. I didn't mean that Jon was biased against my view point, quite the opposite, it seemed more like he'd tried to "present both sides of an argument" instead of just saying what he thought was right.<br>
<p>
But maybe he really did/does believe that the "reported problem" was a regression and needed fixing, at which point I guess I'll just have to disagree.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243250/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243446"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 21:41 UTC (Fri)
                               by <b>jospoortvliet</b> (guest, #33164)
                              [<a href="/Articles/243446/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      Indeed. Top be honest, I don't get it why he re-stated that. I mean, it's <br>
lovely to try and fix things if they come up, but this was and is <br>
impossible to fix. And I'm sure Ingo won't try to fix it either. If <br>
someone complains X gets not enough CPU (because it gets 1/10th if 10 <br>
heavy processes are running), he will tell the person to renice X. Just <br>
like Con did. After all, it's what a fair scheduler does.<br>
<p>
Someone complaining about it simply doesn't understand it - a fair <br>
scheduler WILL lead to regressions. No way around it, period. It's unfair <br>
to attack Con on this one, imho, and again - I really don't see how <br>
Corbet can say these things.<br>
<p>
BTW not to say Corbet is stupid or anything negatively, I just think he's <br>
wrong here. Or there is something I utterly do NOT understand (and if <br>
that's the case, I hope he can explain).<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243446/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243451"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 21:51 UTC (Fri)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/243451/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      If somebody's workload works on 2.6.N, but fails on 2.6.N+1, it's a regression.  It doesn't matter if life is better for a lot of other folks, or whether you call it "fair," it's still a regression.  Regressions are bad news.  And yes, CFS does do a better job with that sort of workload.
      
          <div class="CommentReplyButton">
            <form action="/Articles/243451/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243454"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 22:21 UTC (Fri)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/243454/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      It may technically be a regression for that user, but if a change improves things for more other users than it hurts, I call that progress.<br>
<p>
It may be a case of two steps forward, one step back, but still progress and a good thing, not bad news.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243454/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243459"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Regressions and progress</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 22:41 UTC (Fri)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/243459/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Here's <a href="/Articles/243460/">a message from Linus</a> from a couple of weeks ago; I had considered it for the quote of the week:
<blockquote>
So we don't fix bugs by introducing new problems.  That way lies madness, 
and nobody ever knows if you actually make any real progress at all. Is it 
two steps forwards, one step back, or one step forward and two steps back? 
Different people will give different answers.
<p>
That's why regressions are _so_ much more important than new bugfixes. 
Because it's much more important to make slow but _steady_ progress, and 
have people know things improve (or at least not "deprove"). We don't want 
any kind of "brownian motion development".
</blockquote>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243459/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243466"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Regressions and progress</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 23:37 UTC (Fri)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/243466/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Linus' statement says regressions are much more important.  But that doesn't specify how much more important.  And when the benefits of the change build up, they override how important a regression is.<br>
<p>
Ingo's scheduler does not work as well as Con's on many 3D applications, like games.  That's a regression from Con's work.  Ingo's doesn't always schedule games as well as mainline either (Transgaming went to some work to make Cedega share work between processes and sleep enough to fake out the 2.6 scheduler).<br>
<p>
If I decide to complain about the regression (which I won't) should Linus hold up merging CFS until Ingo can meet my demand that the new thing work just like the old thing?  (Renicing Cedega is just *too* hard!  Poor me!)<br>
<p>
Another example: I've complained that 4K stacks aren't ready to be the default (stacking enough device mappers crash), but I strongly suspect that the kernel is going to change the default to 4K no matter what I think.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243466/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253798"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Regressions and progress</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2007 21:57 UTC (Tue)
                               by <b>Blaisorblade</b> (guest, #25465)
                              [<a href="/Articles/253798/">Link</a>] 
      </p>
      
      </div>
      </summary>
      This Linus quote is also from a couple of years ago, about drivers (when somebody fixed ACPI and broke suspend for most stuff). And he's a maintainer, and he must have this opinion (or the community should replace him).<br>
<p>
What matters is "how deep do you need to stack DM" (is it a real problem) and "4k is a default (other choices are kept, so *you* will make the 8k choice, which is mostly worse)".<br>
<p>
That is a known problem since years, and Device Mapper can be changed to be non-recursive; see the LWN articles about changes in link-resolution from recursive to iterative to understand what I mean - that's the same stuff. Technically, this is a tail-call optimization to reduce stack depth.<br>
<p>
After reading the discussion over Con's community management, and thinking to Reiser4, I think that Linux is not about politics, but about communities, or rather Social Networks of developers and their influence on community filtering they do (that's a lot of academic buzzwords).<br>
<p>
That said, it's known that many problem (including VM and I think scheduling) are computationally hard, so whichever solution you choose it has weak points (it's a theorem in some cases - you can prove that for each compressor there is a file the compressor expands). The point is how hard is the regression.<br>
<p>
Distributions had to be fixed not to renice X to -10 (as usual for 2.4) when 2.6 came out. A stable kernel cannot require such a big change. I can fix my X startup script (well, working my way through X startup is not fun, even for an experienced Linux developer like me), but the Ubuntu average user cannot (I know tens of such users, switching from Windows because Vista sucks and Linux had Beryl - they are good Physics students).<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253798/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor243501"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2007 12:08 UTC (Sat)
                               by <b>jospoortvliet</b> (guest, #33164)
                              [<a href="/Articles/243501/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I find that hard to believe if we're talking about the same person <br>
complaining. His problem can never be fixed by CFS, unless CFS <br>
automatically would renice his X, or would introduce unfairness some <br>
other way.<br>
<p>
CFS will cause regressions, because it doesn't do unfair scheduling - <br>
which is what users have come to expect. There is no way around it. <br>
<p>
Besides, CFS does worse on 3D gaming compared to SD and mainline, and ppl <br>
will complain about that as well.<br>
<p>
Note that I'm happy CFS got in mainline, as far as I can tell, it has a <br>
superior design. It's just that the mentioned reasoning for the choice <br>
doesn't work for me...<br>
<p>
Maybe this is worth reading, if you didn't already.<br>
<a href="http://osnews.com/story.php/18350/Linus-On-CFS-vs.-SD">http://osnews.com/story.php/18350/Linus-On-CFS-vs.-SD</a><br>
(don't forget the OTHER SIDE of the story ;-) )<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243501/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor243180"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">CFS and SD internals, design</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 15:08 UTC (Thu)
                               by <b>mingo</b> (guest, #31122)
                              [<a href="/Articles/243180/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
<i>
As I understand it, the CFS brand of "fairness" takes a longer-term view, allowing tasks to get their "fair" share even if they sleep from time to time.
</i>
</blockquote>
<p>
Correct, and i call this concept "sleeper fairness".
<p>
The simplest way to describe it is via an specific example: on my box if i run glxgears, it uses exactly 50% of CPU time. If i boot into the SD scheduler, and start a CPU hog in parallel to the glxgears task, the two tasks share the CPU: the CPU hog will get ~60% of CPU time, glxgears will get ~40% of CPU time. If i boot CFS, both tasks will get exactly 50% of CPU time.
<p>
I've described this mechanism and other internal details in another thread already, but i think it makes sense to paste that reply here too:
<p>
wait_runtime is a scheduler-internal metric that shows how much out-of-balance this task's execution history is compared to what execution time it could get on a "perfect, ideal multi-tasking CPU". So if wait_runtime gets negative that means it has spent more time on the CPU than it should have. If wait_runtime gets positive that means it has spent less time than it "should have". CFS sorts tasks in an rbtree with this value as a key and uses this value to choose the next task to run. (with lots of additional details - but this is the raw scheme.) It will pick the task with the largest wait_runtime value. (i.e. the task that is most in need of CPU time.)
<p>

This mechanism and implementation is basically not comparable to SD in any way, the two schedulers are so different. Basically the only common thing between them is that both aim to schedule tasks "fairly" - but even the definition of "fairness" is different: SD strictly considers time spent on the CPU and on the runqueue, CFS takes time spent sleeping into account as well. (and hence the approach of "sleep average" and the act of "rewarding" sleepy tasks, which was the main interactivity mechanism of the old scheduler, survives in CFS. Con was fundamentally against
sleep-average methods. CFS tried to be a no-tradeoffs replacement for the existing scheduler and the sleeper-fairness method was key to that.)
<p>
This (and other) design differences and approaches - not surprisingly - produced two completely different scheduler implementations. Anyone who has tried both schedulers will attest to the fact that they "feel" differently and behave differently as well.
<p>
Due to these fundamental design differences the data structures and algorithms are necessarily very different, so there was basically no opportunity to share code (besides the scheduler glue code that was already in sched.c), and there's only 1 line of code in common between CFS and SD (out of thousands of lines of code):
<p>
<pre>
  * This idea comes from the SD scheduler of Con Kolivas:
  */
 static inline void sched_init_granularity(void)
 {
         unsigned int factor = 1 + ilog2(num_online_cpus());
</pre>
<p>
This boot-time "ilog2()" tuning based on the number of CPUs available is a tuning approach i saw in SD and i asked Con whether i could use it in CFS. (to which Con kindly agreed.)
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243180/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243507"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">CFS and SD internals, design</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2007 12:30 UTC (Sat)
                               by <b>jospoortvliet</b> (guest, #33164)
                              [<a href="/Articles/243507/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Thanx, Ingo, an excellent explanation. I wonder if you could elaborate on <br>
the following you wrote:<br>
<p>
This mechanism and implementation is basically not comparable to SD in <br>
any way, the two schedulers are so different. Basically the only common <br>
thing between them is that both aim to schedule tasks "fairly" - but even <br>
the definition of "fairness" is different: SD strictly considers time <br>
spent on the CPU and on the runqueue, CFS takes time spent sleeping into <br>
account as well. (and hence the approach of "sleep average" and the act <br>
of "rewarding" sleepy tasks, which was the main interactivity mechanism <br>
of the old scheduler, survives in CFS. Con was fundamentally against <br>
sleep-average methods. CFS tried to be a no-tradeoffs replacement for the <br>
existing scheduler and the sleeper-fairness method was key to that.)<br>
<p>
How does this work, and effect fairness? I mean, can you tell a bit more <br>
on the difference between SD and CFS in this area? (I'm pretty <br>
interested, that's all)<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243507/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor250303"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">CFS and SD internals, design</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 18, 2007 9:25 UTC (Tue)
                               by <b>mingo</b> (guest, #31122)
                              [<a href="/Articles/250303/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>
<i>
How does this work, and effect fairness? I mean, can you tell a bit more
on the difference between SD and CFS in this area? (I'm pretty
interested, that's all)
</i>
</blockquote>
<p>
The practical difference is noticeable for something like the X server - Xorg is often a "sleepy" process but it's important that when it runs it gets its own maximum share of CPU time. With a "runners only" fairness model it will receive less CPU time than with a "sleepers considered too" (CFS) fairness model.
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/250303/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor243292"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 22:44 UTC (Thu)
                               by <b>bronson</b> (subscriber, #4806)
                              [<a href="/Articles/243292/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      SwPr didn't get in because some very rich employers don't want to destabilize their NUMA monsters?  Er, doesn't this sound really unlikely?<br>
<p>
The article mentions that Linus and some others feel that SwPr is just papering over a more fundamental problem.  So, why not spend time trying to fix the fundamental problem before hacking around it?<br>
<p>
That's a rhetorical question...  there could be a number of reasons: the root cause is too complex to be understood, or the proper fix is worse than SwPr, etc.  I just think that Linus &amp; crew would like to see someone attempt to fix the real problem before resorting to a SwPr hack.  If a proper fix is attempted and proves unweildy, then I bet SwPr will jump a lot higher on a number of kernel devs' priority queues.<br>
<p>
<font class="QuotedText">&gt; ...entirely silly.  Complaining about the fairness of a fair scheduler?</font><br>
<p>
They weren't complaining about the fairness, they were complaining about the quality.  Is a 100% fair scheduler actually the best scheduler?  Probably not.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243292/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243509"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2007 12:35 UTC (Sat)
                               by <b>jospoortvliet</b> (guest, #33164)
                              [<a href="/Articles/243509/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      No, but a 100% fair scheduler is the only way to ensure you won't have <br>
stalls and other problems brought by unfairness. You can't have your cake <br>
and eat it too.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243509/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243541"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2007 20:41 UTC (Sat)
                               by <b>bronson</b> (subscriber, #4806)
                              [<a href="/Articles/243541/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Sorry, I don't quite understand...  are you saying that a 100% fair scheduler actually *is* the best scheduler?  If so, then would you have any evidence/research to back this up?  I'm genuinely interested.<br>
<p>
My uneducated view: in schedulers, as with government and parenting, 100% fairness is unattainable and probably paradoxical.  The best policy may or may not be the most fair policy.  They're simply disconnected.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243541/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor244026"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">RDSL and ignoring feedback</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 2, 2007 8:00 UTC (Thu)
                               by <b>renox</b> (guest, #23785)
                              [<a href="/Articles/244026/">Link</a>] 
      </p>
      
      </div>
      </summary>
      The thing that this complaint show is that a 'fair scheduler' in itself is not good enough for enduser desktop..<br>
If you have an application APP that is important to you, you renice it so it has lots of CPU, fine, but then say that this application sends a lot of work to do for the X server (could be any server really), then there is a kind of 'priority inversion' which happens where APP is slowed down because the X server doesn't have a big enough CPU share..<br>
<p>
It's quite difficult to solve.. The only way would be to have some way to transfer the 'CPU token' that APP have to the server it's asking to do some work on its behalf, if it is a multi-threaded server which use a different thread for each client, then maybe the kernel could understand what's happening and boost the corresponding server's thread priority accordingly, but in a non-threaded server, I don't see how it could be solved even if the APP says gives my 'CPU token' to server X, how could the server X would be able to report/understand that currently he is supposed to be working for client APP and not for another client?<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/244026/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor243095"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for godot.</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 26, 2007 7:27 UTC (Thu)
                               by <b>error27</b> (subscriber, #8346)
                              [<a href="/Articles/243095/">Link</a>] 
      </p>
      
      </div>
      </summary>
      You know things are bad when Corbet starts breaking out the Beckett puns.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243095/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor243363"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Still waiting for swap prefetch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 27, 2007 12:32 UTC (Fri)
                               by <b>IkeTo</b> (subscriber, #2122)
                              [<a href="/Articles/243363/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; A concern which has been raised a few times is that the morning swap-in</font><br>
<font class="QuotedText">&gt; problem may well be a sign of a larger issue within the virtual memory</font><br>
<font class="QuotedText">&gt; subsystem, and that prefetch mostly serves as a way of papering over that</font><br>
<font class="QuotedText">&gt; problem. And it fails to even paper things completely, since it brings back</font><br>
<font class="QuotedText">&gt; some pages from swap, but doesn't (and really can't) address file-backed</font><br>
<font class="QuotedText">&gt; pages which will also have been pushed out. The conclusion that this</font><br>
<font class="QuotedText">&gt; reasoning leads to is that it would be better to find and fix the real</font><br>
<font class="QuotedText">&gt; problem rather than hiding it behind prefetch.</font><br>
<p>
My interpretation: there are 3 classes of systems:<br>
<p>
  1. Those that have loads of memory and very few programs requiring big memory that ever run, and as such never write anything to the swap.  Swap prefetch is of course a no-op in such systems.<br>
  2. Those that have loads of memory and very few programs requiring big memory that ever run, but still the swap is being written.  Swap prefetch improves the performance of such system, but developers would ask, "why the hell did it happen in the first place?"<br>
  3. Those that have not such much memory to run all the programs requiring big memory that ever run, and naturally swap prefetch does help, as expected.<br>
<p>
So because of the unclear reason that (2) happens, and perhaps because those systems in class (1) might see regressions and need to manually turn off prefetching via a kernel option (never mind that none is currently known after 18 months of testing), those (typically) systems among (3) have to suffer?  After all, prefetch is not something that is done only to the swap.  A block I/O system without prefetch also have horrible performance, and we have prefetch there for ages.  So why swap has to be treated differently?  Should we perfectly expect that an application being swapped (for whatever reason) should perform much worse than an application being loaded the first time if prefetching happens when the application is first being loaded and does not happen when the application is pushed to the swap due to uncontrollable memory pressure?  Is it such a surprise that swap prefetch is something needed anyway?<br>
<p>
And what is the consequence to (2) if swap can be prefetched?  It means there is no way to detect such a problem exists?  Of course not, the kernel keeps page fault counters, if developers care to write a script and collect the stats of each of the running processes.  The only thing that will happen is that people will no longer be so unhappy about the problem, because that doesn't hit their bottom line: enjoying hot coffee while working in the morning.  And the end result is, unsurprisingly, less attention to the problem.  But... is it really such a bad thing after all, that some hard problem can be put aside because the problem no longer cause serious user dismay?<br>
<p>
Perhaps I'm understanding something really wrong.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243363/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor243481"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Great article, thanks!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2007 2:54 UTC (Sat)
                               by <b>wruppert</b> (subscriber, #3041)
                              [<a href="/Articles/243481/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Thanks for explaining both sides of this issue so clearly.  I have not been following this and then read the interview about Con leaving kernel dev.  I was wondering what the other side of the story was.  Great job!<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243481/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor243508"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Great article, thanks!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 28, 2007 12:33 UTC (Sat)
                               by <b>jospoortvliet</b> (guest, #33164)
                              [<a href="/Articles/243508/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Imho this one isn't entirely fair either, but Corbet &amp; me &amp; others are <br>
still fighting this one out, so don't take my word for it.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/243508/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2007, Eklektix, Inc.<BR>
            
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
