        <!DOCTYPE html>
        <html lang="en">
        <head><title>The rest of the 6.8 merge window [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/958178/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/958598/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/958178/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>The rest of the 6.8 merge window</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>January 22, 2024</br>
           </div>
Linus Torvalds was able to release <a
href="/ml/linux-kernel/CAHk-=wiB4iHTtfZKiy5pC24uOjun4fbj4kSX0=ZnGsOXadMf6g@mail.gmail.com/">6.8-rc1</a>
and close the 6.8 merge window on time despite losing power to his home for
most of a week.  He noted that this merge window is "<q>maybe a bit smaller
than usual</q>", but 12,239 non-merge changesets found their way into the
mainline, so it's not <i>that</i> small.  About 8,000 of those changes were
merged since <a href="/Articles/957188/">the first-half summary</a> was
written; the second half saw a lot of device-driver updates, but there
were other interesting changes as well.
<p>
Some of the most significant changes pulled in the latter half of the 6.8
merge window are:
<p>

<h4>Architecture-specific</h4>
<p>
<ul class="spacylist">

<li> The riscv architecture has made <a
     href="https://git.kernel.org/linus/f352a28cc2fb">more information
     about supported ISA extensions</a> on the current system available via
     the <tt>riscv_hwprobe()</tt> system call.  See <a
     href="https://www.kernel.org/doc/html/next/arch/riscv/hwprobe.html"><tt>Documentation/arch/riscv/hwprobe.rst</tt></a>
     for details on what is available.
<Li> Riscv can also now suspend to RAM if the SUSP SBI extension is
     present.
<li> Host-side support for <a
     href="https://www.intel.com/content/www/us/en/developer/tools/trust-domain-extensions/overview.html">Intel
     Trust Domain Extensions (TDX)</a> has been merged; this will
     eventually allow KVM to create TDX-protected guests.  <a
     href="https://git.kernel.org/linus/4e1c7dddc717">This documentation
     commit</a> has some more information.
<li> The LoongArch architecture has added support for modules written
     in Rust.  This architecture has also raised the minimum version of
     Clang that can be used to 18.0.0 — which has not been released yet.
</ul>


<p>
<h4>Core kernel</h4>
<p>
<ul class="spacylist">

<li> It is now possible to change the size of tracing sub-buffers used
     for the reporting of trace events to user space; see <a
     href="https://git.kernel.org/linus/7c3f48026589">this documentation
     commit</a> for more information.
<li> One new "feature" — the scheduler performance regression encountered
     by Torvalds early in the merge window — has been removed with <a
     href="https://git.kernel.org/linus/e37617c8e53a">this fix</a>.
</ul>

<p>
<h4>Filesystems and block I/O</h4>
<p>
<ul class="spacylist">

<li> The <strike>device-mapper</strike> multi-device <tt>MD_LINEAR</tt>, <tt>MD_MULTIPATH</tt>, and
     <tt>MD_FAULTY</tt> targets have been <a
     href="https://git.kernel.org/linus/608f52e30aae">deprecated</a> since
     the 5.14 release in 2021; they have now been removed.

</ul>

<p>
<h4>Hardware support</h4>
<p>
<ul class="spacylist">
<li> <b>Clock</b>:
     Qualcomm SC8280XP camera clock controllers,
     Qualcomm SM8650 global clock controllers,
     Qualcomm SM8650 TCSR clock controllers,
     Qualcomm SM8650 display clock controllers,
     Qualcomm SM8650 GPU clock controllers,
     Qualcomm QDU1000/QRU1000 ECPRI clock controllers,
     Qualcomm X1E80100 global clock controllers,
     MediaTek MT7988 clock controllers,
     Nuvoton MA35D1 realtime clocks,
     TI TPS6594 realtime clocks, and
     Analog Devices MAX31335 automotive realtime clocks.
<li> <b>GPIO and pin control</b>:
     Realtek DHC GPIO controllers,
     Nuvoton BMC NPCM7xx/NPCM8xx SGPIO controllers,
     Qualcomm SM8550 LPASS LPI pin controllers,
     Qualcomm SM8650, SM4450 and X1E80100 pin controllers,
     TI TPS6594 PMIC GPIO controllers, and
     Intel Meteor Point pin controllers.
<li> <b>Graphics</b>:
     Imagination Technologies PowerVR (Series 6 and later) and IMG GPUs,
     Synaptics R63353-based panels, and
     Ilitek ILI9805-based panels.
     <b>Also merged</b> is the Intel "Xe" driver for GPUs starting with the Tiger
     Lake generation.  It is not enabled by default anywhere but that will
     change in some future kernel development cycle.

<li> <b>Hardware monitoring</b>:
     Monolithic Power Systems MP5990 hot-swap controllers,
     Monolithic Power Systems mp2856/mp2857 modulation controllers,
     Analog Devices LTC4286 and LTC4287 hot-swap controllers, and
     Gigabyte Waterforce X240/X280/X360 AIO CPU coolers.
<li> <b>Industrial I/O</b>:
     Maxim max34408/max344089 analog-to-digital converters,
     Bosch BMI323 I2C and SPI controllers,
     Microchip MCP9600 thermocouple EMF converters,
     Vishay VEML6075 UVA and UVB light sensors,
     Intersil ISL76682 light sensors,
     Melexis MLX90635 contactless infrared sensors,
     Honeywell HSC/SSC TruStability pressure sensors,
     Lite-On LTR-390UV-01 ambient light and UV sensors,
     Aosong AGS02MA TVOC sensors,
     Microchip MCP4801/02/11/12/21/22 digital-to-analog converters, and
     Analog Devices AD7091R8 analog-to-digital converters.
<li> <b>LED</b>:
     Allwinner A100 RGB LED controllers and
     Maxim 5970 indication LEDs.
<li> <b>Media</b>:
     Starfive camera subsystems,
     Chips&amp;Media Wave codecs,
     GalaxyCore GC2145 and GC0308 sensors,
     THine THP7312 image signal processors,
     STMicroelectronics STM32 memory interface pixel processors,
     Techwell TW9900 video decoders,
     Allied Vision ALVIUM MIPI CSI-2 cameras, and
     OmniVision OV64A40 sensors.
<li> <b>Miscellaneous</b>:
     Apple SoC mailboxes,
     Qualcomm PMIC PDCharger ULOG providers,
     Microchip MCP2200 HID USB-to-GPIO bridges,
     Nintendo NSO controllers,
     AWS EC2 Nitro security modules,
     Intel visual sensing controllers,
     AMD AXI 1-wire bus host interfaces,
     Qualcomm SM8650, SM6115 and X1E80100 interconnects,
     MPS MP3309C backlight controllers,
     Adafruit Mini I2C gamepads, and
     Loongson LS2X APB DMA controllers.
<li> <b>Sound</b>:
     Qualcomm X1E80100 audio subsystems and
     Qualcomm WCD939x USBSS analog audio switches.
</ul>

<p>
<h4>Miscellaneous</h4>
<p>
<ul class="spacylist">

<li> The <tt>perf</tt> tool has gained support for <a
     href="/Articles/955709/">data-type profiling</a>.  Some more details,
     along with information on a the usual large pile of other
     <tt>perf</tt> changes, can be found in <a
     href="https://git.kernel.org/linus/9d64bf433c53">this merge
     message</a>.

</ul>

<p>
<h4>Security-related</h4>
<p>
<ul class="spacylist">

<li> See <a
     href="https://paul-moore.com/blog/d/2024/01/linux_v68_merge_window.html">this
     blog post</a> from Paul Moore covering changes to the kernel's
     security subsystem in detail.
<li> The AppArmor security module has switched its policy-hash verification
     from the SHA-1 hash to SHA-256.
<li> The task of <a href="/Articles/905777/">removing the
     <tt>strlcpy()</tt> API</a> from the kernel is now complete.
</ul>


<p>
<h4>Virtualization and containers</h4>
<p>
<ul class="spacylist">

<li> The <a href="/Articles/949277/">guest-first memory feature</a> for
     KVM has been merged.  Guest-first memory can be allocated for and
     mapped into KVM guests, but is inaccessible to the host, making it
     suited to confidential-computing applications.  There is also a new
     <tt>ioctl()</tt> call where the expected attributes for guest memory
     (including a lack of mapping in the host) can be specified.  <a
     href="https://git.kernel.org/linus/6c370dc65374">This changelog</a>
     has some more information.
<li> KVM on arm64 systems has gained support for 52-bit (LPA2) physical
     addresses.
<li> KVM on x86 can now be built without Hyper-V emulation support,
     reducing the size of the resulting kernel.

</ul>

<p>
<h4>Internal kernel changes</h4>
<p>
<ul class="spacylist">

<li> The kernel now has <a
     href="https://git.kernel.org/linus/5a602de99797">a
     <tt>.editorconfig</tt> file</a> that will automatically configure
     editors to the kernel's coding style.
<li> The new <tt>check-uapi.sh</tt> script can be used to detect
     inadvertent changes to the kernel's user-space API.  See <a
     href="https://docs.kernel.org/next/dev-tools/checkuapi.html"><tt>Documentation/dev-tools/checkuapi.rst</tt></a>
     for details.

</ul>
<p>
If all goes according to plan (which it pretty much always does), the 6.8
kernel will be released on March&nbsp;10 or&nbsp;17.  Between now and then,
though, there will certainly be a lot of bugs to find and fix.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-6.8">Releases/6.8</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/958178/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor959044"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 22, 2024 20:19 UTC (Mon)
                               by <b>ju3Ceemi</b> (subscriber, #102464)
                              [<a href="/Articles/959044/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Dors not "md" stands for "multidevice" while dm stands for "device mapper" ?<br>
I understand that no devicemapper features where deprecated nor deleted, so this may bé a typo<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959044/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959046"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Corrected</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 22, 2024 20:50 UTC (Mon)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/959046/">Link</a>] 
      </p>
      
      </div>
      </summary>
      You are right, that was a silly slip of the fingers; fixed now.


      
          <div class="CommentReplyButton">
            <form action="/Articles/959046/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor959080"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 4:47 UTC (Tue)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/959080/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
… which is not even released yet.<br>
<p>
Hah.<br>
<p>
Does nobody else see how ridiculous this “Rust” fad is?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959080/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959081"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 5:30 UTC (Tue)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/959081/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The bit about clang is unrelated to Rust, it's about loongarch in general. And you can always use GCC.<br>
<p>
A bit of prejudice perhaps?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959081/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor959103"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 14:33 UTC (Tue)
                               by <b>atnot</b> (subscriber, #124910)
                              [<a href="/Articles/959103/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This has nothing to do with rust of course, but in case anyone is actually curious what happened there:<br>
<p>
<span class="QuotedText">&gt; The existing mainline clang development version encounters diffculties</span><br>
<span class="QuotedText">&gt; compiling the LoongArch kernel module. It is anticipated that this issue</span><br>
<span class="QuotedText">&gt; will be resolved in the upcoming 18.0.0 release. To prevent user</span><br>
<span class="QuotedText">&gt; confusion arising from broken builds, it is advisable to raise the</span><br>
<span class="QuotedText">&gt; minimum required clang version for LoongArch to 18.0.0.</span><br>
<p>
<a href="https://lore.kernel.org/loongarch/CAAhV-H7Qu9yj1d+fAcE3vL0=1FUOD8x0v+AhCr7Bj5yuQstndQ@mail.gmail.com/T/#t">https://lore.kernel.org/loongarch/CAAhV-H7Qu9yj1d+fAcE3vL...</a><br>
<p>
And the previous patch:<br>
<p>
<span class="QuotedText">&gt; By the way, the clang 17.0.0 still have some issues to build kernel on</span><br>
<span class="QuotedText">&gt; LoongArch, you need to unset CONFIG_MODULES and CONFIG_RELOCATABLE to</span><br>
<span class="QuotedText">&gt; avoid build errors. Additionally, if you want a workable kernel, some</span><br>
<span class="QuotedText">&gt; modules should be set as y instead of m if CONFIG_MODULES=n.</span><br>
<p>
<a href="https://lore.kernel.org/all/1690871446-23713-1-git-send-email-yangtiezhu@loongson.cn/">https://lore.kernel.org/all/1690871446-23713-1-git-send-e...</a><br>
<p>
So it sounds like the LoongArch support in clang/llvm is just very immature and broken. I'm kind of more surprised that they managed to get tier 2 rustc support in this state at all, they have a pretty low tolerance for build failures. Perhaps the kernel is just hitting some weird edge cases.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959103/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor959085"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 8:39 UTC (Tue)
                               by <b>Lionel_Debroux</b> (subscriber, #30014)
                              [<a href="/Articles/959085/">Link</a>] (46 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wonder whether the discussion about converting the kernel to a narrow subset of C++, restarted by hpa ( <a href="https://lore.kernel.org/lkml/3465e0c6-f5b2-4c42-95eb-29361481f805@zytor.com/">https://lore.kernel.org/lkml/3465e0c6-f5b2-4c42-95eb-2936...</a> ), will yield anything. The discussion faded out quickly.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959085/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959096"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 12:01 UTC (Tue)
                               by <b>make</b> (guest, #62794)
                              [<a href="/Articles/959096/">Link</a>] (26 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Me too. That thread gave me some hope for C++ in the Linux kernel.<br>
Whenever I hack the Linux kernel, I'm horrified by how fragile everything is (and how many unfixed bugs I discover that would have been prevented by just using C++). It's a miracle that the kernel actually works and is pretty stable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959096/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959104"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 14:30 UTC (Tue)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/959104/">Link</a>] (25 responses)
      </p>
      
      </div>
      </summary>
      <p>C++ offers very impressive collection of footguns of various sizes and colors. With people who <a href="https://lore.kernel.org/lkml/20240110175755.GC1006537@mit.edu/">complain about “arbitrary statement reordering”</a> you can 100% sure all these footguns would be discovered and [ab]used.</p>

<p>And if the end result is even more fragile and unstable code then what's the point?</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/959104/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959161"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 16:12 UTC (Tue)
                               by <b>adobriyan</b> (subscriber, #30858)
                              [<a href="/Articles/959161/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"arbitrary statement reordering" sounds very fuddy. What does it even mean? What does "random futzing" mean?<br>
<p>
Nominally evaluation order became stricter not looser as standard version increases.<br>
<p>
std::initializer_list&lt;&gt; guarantees left-to-right evaluation order as does operator&lt;&lt;.<br>
<p>
operator&lt;&lt; looks irrelevant for kernel and std::initializer_list&lt;&gt; being array of references is quite a footgun by itself, but not in the evaluation order department.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959161/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959164"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++ compiler and the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 16:39 UTC (Tue)
                               by <b>timon</b> (subscriber, #152974)
                              [<a href="/Articles/959164/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't think this statement is aimed at the C++ language level but rather at optimization passes in the compiler further down the line.<br>
<p>
I think this is about the mismatch between kernel developers and compiler developers, namely that kernel developers want the compiler to emit common-sensical machine code (meaning that the flow of machine code should resemble the flow of C/C++ code) and that compiler developers want to focus on the language spec and regard Undefined Behavior as, well, undefined.<br>
<p>
The following blog post was rather eye-opening for me, making a fair point for both sides of the argument:<br>
<a href="https://blog.tchatzigiannakis.com/undefined-behavior-can-literally-erase-your-hard-disk/">https://blog.tchatzigiannakis.com/undefined-behavior-can-...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959164/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959173"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++ compiler and the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 16:54 UTC (Tue)
                               by <b>adobriyan</b> (subscriber, #30858)
                              [<a href="/Articles/959173/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This particular example is not the best because both clang and clang++ do this nonsense and both gcc and g++ don't.<br>
<p>
typedef int(*F)(void);<br>
static F g_f;<br>
static int bad(){asm volatile("int3");return 0;}<br>
void bad_init(){g_f = &amp;bad;}<br>
int main(void){return (*g_f)();}<br>
<p>
I share the sentiment in spirit though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959173/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959177"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++ compiler and the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 17:13 UTC (Tue)
                               by <b>adobriyan</b> (subscriber, #30858)
                              [<a href="/Articles/959177/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; typedef int(*F)(void);</span><br>
<span class="QuotedText">&gt; static F g_f;</span><br>
<span class="QuotedText">&gt; static int bad(){asm volatile("int3");return 0;}</span><br>
<span class="QuotedText">&gt; void bad_init(){g_f = &amp;bad;}</span><br>
<span class="QuotedText">&gt; int main(void){return (*g_f)();}</span><br>
<p>
Ha-ha, if there are 2 functions which initialise g_F then clang doesn't know which one to use and emits correct code.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959177/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959179"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++ compiler and the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 17:37 UTC (Tue)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/959179/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>It also emits correct code if only one function initialises <tt>g_f</tt>; in the event that <tt>g_f</tt> is uninitialized, the C standard and the C++ standard both agree that the source can take any meaning the compiler chooses. Which includes meanings you didn't intend as well as meanings you did intent.


      
          <div class="CommentReplyButton">
            <form action="/Articles/959179/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor959201"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++ compiler and the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 20:24 UTC (Tue)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/959201/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; The following blog post was rather eye-opening for me, making a fair point for both sides of the argument: <a href="https://blog.tchatzigiannakis.com/undefined-behavior-can-literally-erase-your-hard-disk/"> https://blog.tchatzigiannakis.com/undefined-behavior-can-...</a></font>

<p>It would have been great if you would have actually picked some explanation that is <b>factually correct</b>.</p>

<p>Because explanation on that link talks about how <code>NeverCalled</code> is not removed when it's not needed… because it's very much <b>is</b> needed and <b>couldn't be removed</b>.</p>

<p>You program may include <b>another</b> <i>separately compiled</i> file which would call <code>NeverCalled</code> from <b>global constructor</b> — and then program would become valid and there would be no UB!</p>

<p>For <b>this</b> program <code>gcc</code> and <code>clang</code> would behave identically and, indeed, <code>clang</code> version is more optimal.</p>




      
          <div class="CommentReplyButton">
            <form action="/Articles/959201/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959244"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++ compiler and the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 5:10 UTC (Wed)
                               by <b>ghodgkins</b> (subscriber, #157257)
                              [<a href="/Articles/959244/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Actually, the compiler (linker really) would be free to omit NeverCalled, since the author of the blog post asked it to create an executable, as indicated by their compilation flags, and did not link against any libraries which might include a call to NeverCalled.<br>
<p>
In practice, gcc at least does not omit NeverCalled by default. It does, however, if you use the set of flags described in this Stack Overflow post: <a href="https://stackoverflow.com/questions/6687630/how-to-remove-unused-c-c-symbols-with-gcc-and-ld">https://stackoverflow.com/questions/6687630/how-to-remove...</a><br>
<p>
However, if you link against a shared library that calls NeverCalled as an extern symbol (and keep the above flags), it will not be omitted from the output, and the shared library will call NeverCalled correctly. All verified on gcc 11.4.<br>
<p>
In summary, the linker does have fairly definitive knowledge of whether NeverCalled is used if the output target is an executable, and it can use this knowledge to omit it if the correct flags are passed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959244/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor959263"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++ compiler and the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 10:13 UTC (Wed)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/959263/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Actually, the compiler (linker really) would be free to omit NeverCalled, since the author of the blog post asked it to create an executable, as indicated by their compilation flags, and did not link against any libraries which might include a call to NeverCalled.</font>

<p>Author very clearly investigated the assembler output as difference between <code>string "rm -rf /"</code> and <code>.asciz  "rm -rf /"</code> in compiler outputs shows (that difference is eliminated if you compile code to binary, then disassemble).</p>

<p>At this point <code>NeverCalled</code> have to be in the output because compiler couldn't have any idea about what happens after linking. But compiler <b>does</b> have the right to assume that program would be valid C++ program and valid C++ program <b>have</b> to call <code>NeverCalled</code>, somehow.</p>

<font class="QuotedText">&gt; In summary, the linker does have fairly definitive knowledge of whether NeverCalled is used if the output target is an executable, and it can use this knowledge to omit it if the correct flags are passed.</font>

<p>How is that relevant when work of the compiler is investigated? Linker follows entirely different rules, they may not be 100% aligned with C or C++ standard.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/959263/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor959169"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 17:33 UTC (Tue)
                               by <b>atnot</b> (subscriber, #124910)
                              [<a href="/Articles/959169/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I just read it as just the usual "C is not how computers work" stuff. You write some code that implicitly depends on ordering in some way that the C abstract machine can not see or is undefined behavior. The compiler or CPU don't know about the dependency and reorder things. Things break.<br>
<p>
You curse at the compiler developers and demand they make your code do what you meant and not what you said. They explain that's not how things work and you become enlightened, realizing that the C language is not what you thought it was. Undefined behavior is not the issue, but in fact the lack of guardrails that make it easy to invoke! There was never a conspiracy against you, the results of successive optimizations are just really hard to predict! You yourself just made this mistake in a language you thought you knew well, so maybe buffer overflows aren't just a skill issue after all! We can look to modern lamguage design for solutions! I wake up from my dream.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959169/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959362"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 20:04 UTC (Wed)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/959362/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; realizing that the C language is not what you thought it was.</span><br>
<p>
But C was invented to be that way by Dennis Ritchie! <br>
<p>
There were system-defined behaviors, but not undefined behaviors.<br>
<p>
It is afterward that standardization bodies added undefined behavior to allow portability to non-UNIX system and in an ill-advised attempt to be as fast as FORTRAN on some benchmark without adding more datatype (which never quite succeeded...).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959362/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959374"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 21:55 UTC (Wed)
                               by <b>atnot</b> (subscriber, #124910)
                              [<a href="/Articles/959374/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;  But C was invented to be that way by Dennis Ritchie!</span><br>
<span class="QuotedText">&gt; There were system-defined behaviors, but not undefined behaviors.</span><br>
<p>
This is probably trivially true in the sense that "C" was just what the original C compiler did and the original compiler was too primitive to do any sort of code analysis, sure. But that's not really a useful statement. It's not what C has been for decades. <br>
<p>
<span class="QuotedText">&gt; It is afterward that standardization bodies added undefined behavior to allow portability to non-UNIX system and in an ill-advised attempt to be as fast as FORTRAN on some benchmark</span><br>
<p>
You make it sound like this was a grave unforced error but it really isn't. As soon as you do any sort of optimization you need to decide on an abstract machine that you validate your optimizations against. With a language where it is semantically valid to conjure pointers out of thin air anywhere, write to them, call them as a function, it's impossible to do any sort of analysis or optimization at all. That's what no undefined behavior means. This was already untenable before C was even standardized, even before performance became pretty much the only reason to use it.<br>
<p>
So yes, C is not the language you think it is<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959374/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor959378"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 22:45 UTC (Wed)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/959378/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; But C was invented to be that way by Dennis Ritchie!</font>

<p>C was not invented. It evolved. From simple autocode which had no specification <b>at all</b>. That's the issue.</p>

<font class="QuotedText">&gt; There were system-defined behaviors, but not undefined behaviors.</font>

<p>Nope. There were plenty of undocumented behaviors and no one knew for sure which ones were “undocumented features” and which were “obvious bugs”.</p>

<p>Everyone had an opinion, no one knew for certain.</p>

<font class="QuotedText">&gt; It is afterward that standardization bodies added undefined behavior to allow portability to non-UNIX system and in an ill-advised attempt to be as fast as FORTRAN on some benchmark without adding more datatype (which never quite succeeded...).</font>

<p>Not even remotely close. Yes, there were some who pushed for some definitions which would allow one to write fast compiler, but the main problem was to create some definition which would be usable for <b>anything at all</b>.</p>

<p>They need something that can be used to answer a very simple question: this sequence of character… is it something that should produce some kind of predictable result or not? And if the result is predictable then what is it?</p>

<p>Because C was never “invented” it was hard to write rules which would describe what C program even <b>is</b>, but C committee succeeded. Except they wanted to ensure that most, if not all, compilers that claimed that they are C compilers would still be compliant (if, maybe, with some small fixes).</p>

<p>But to do that they placed <b>a lot</b> if limitations on what C program shouldn't do… only many of these rules were only needed by some few compilers, not the majority.</p>

<p>And <b>that</b> is why these rules were, mostly, ignored by C users: their “advanced” compilers accepted their “correct” programs, why would they worry?</p>

<p>But said rules were, of course, embraced by C compiler developers: they finally had an idea what C program is! That's really cool! And very much needed!</p>

<p>Only C users continued to be unaware of what is happened till many years later. When C compilers started to <b>actually</b> require that C programs would be, you know, C programs… it was just too late.</p>

<p>C users firmly believed that they are right since they wrote C programs like they did for decades. And C compiler developers <b>also</b> believed they are right since they had that language definition which explained that certain things that C users do were “never” permitted in the first place… and that definition <b>also</b> existed for decades… why shouldn't they used that definition?</p>

<p>And that's why we are at the dead end: when groups of developers have such an awfully different opinions it's hard to do anything.</p>

<p>But C compilers were <b>never</b> actually forgiving (like “we code for the hardware” folks like to think) they were just <b>primitive</b>. They never had <b>any</b> other language definitions except for what they actually had in the C standard. <a href="https://groups.google.com/g/comp.lang.c/c/K0Cz2s9il3E/m/YDyo_xaRG5kJ">Straight from the horse's mouth</a>:</p>

<blockquote>K&amp;R C has one important internal contradiction (variadic functions are forbidden, yet printf exists) and one important divergence between rule and reality (common vs. ref/def external data definitions). These contradictions have been an embarrassment to me throughout the years, and resolving them was high on X3J11's agenda. X3J11 did manage to come up with an adequate, if awkward, solution to the first problem. Their solution to the second was the same as mine (make a rule, then issue a blanket license to violate it).</blockquote>

<p>That's something Ritchie actually accepted, but there were many more. The whole thing, ultimately, was an exercise in applying <a href="https://en.wikipedia.org/wiki/Worse_is_better">worse is better</a> principle at large and see how long and how much can you stretch it.</p>

<p>It worked surprisingly well, but like in any other industry we have arrived at the end of that ability to produce something working without adequate regulations and liability.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/959378/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor959821"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2024 5:34 UTC (Mon)
                               by <b>yoduh</b> (subscriber, #38527)
                              [<a href="/Articles/959821/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I cant help but think the lamguage was lambda influenced.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959821/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor959128"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 17:34 UTC (Tue)
                               by <b>make</b> (guest, #62794)
                              [<a href="/Articles/959128/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Your rethorical question implies something as fact that is actually just your opinion.<br>
<p>
I disagree with your opinion: yes, C++ has footguns (so does C), but C++ also offers tools that help avoid problems that are hard to avoid with C. Having these tools would make the kernel less fragile and more stable.<br>
<p>
And know what, some of these C++ tools are actually used by the kernel, disguised as GNU C extensions, wrapped in obscure preprocessor macros. I say: if you decide to use C++ features, use standard C++ instead of non-standard C language extensions.<br>
<p>
(It is okay to have a different opinion, of course. I guess a lot of kernel developers share your opinion and prefer C-with-GNU-extensions over a standard C++ subset.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959128/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959198"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 19:45 UTC (Tue)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/959198/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Your rethorical question implies something as fact that is actually just your opinion.</font>

<p>Nope.</p>

<font class="QuotedText">&gt; over a standard C++ subset</font>

<p>And who would decide which “subset” is fine and which “subset” is not fine?</p>

<p>Linux developers just understandably reason that it's much better to deal with known devil rather then spend insane amount of time arguing what exactly should be permitted and what shouldn't be permitted in “their” C++ subset.</p>

<p>Note that even you talk about “C++ subset”, not “C++ as whole”. Because you know there are some pretty dark corners of C++ which nobody is sure about (e.g. if you specify fields in the initialization of struct in one order and then specify initializers in a different order… what happens?… and if some of these fields are references?…) and in a project where significant proportions of contributors only ever submit one change and then go away… it just wouldn't work.</p>

<font class="QuotedText">&gt; I say: if you decide to use C++ features, use standard C++ instead of non-standard C language extensions.</font>

<p>The question is how to enforce that and keep only these C++ features that are beneficial to kernel development are available in kernel and not all the crazy things that C++ <b>also</b> includes out of it.</p>

<p>With C++ features that are also GNU C extensions situation is simple: don't enable C++ and you are done. With “standard C++”? How would that work?</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/959198/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959200"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 19:51 UTC (Tue)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/959200/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;And who would decide which “subset” is fine and which “subset” is not fine?</span><br>
<p>
A subset would have to be developed and documented properly. That doesn't fall out of the sky. It's real work.<br>
It's just the same as all the other development standards that we have documented.<br>
<p>
<span class="QuotedText">&gt;that it's much better to deal with known devil</span><br>
<p>
That's not better. C is not a known devil. It's an unpredictable time bomb mess with UB lurking at every corner trying to shoot you.<br>
<p>
<span class="QuotedText">&gt;what happens?</span><br>
<p>
I don't know. Forbid it. Trivial solution.<br>
<p>
<span class="QuotedText">&gt;The question is how to enforce that </span><br>
<p>
Review and checker scripts.<br>
That's no different than the current situation with kernel-C.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959200/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959206"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 20:41 UTC (Tue)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/959206/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; I don't know. Forbid it. Trivial solution.</font>

<p>True. Except that “trivial solution” has a cost. Do you know what you did just now? No? I'll tell you: you have just added <b>another</b> UB to the list which already includes hundreds of them. And then asked humans (reviewers) to look out for these and avoid these.<p>

<p>Now let's go back to your main complaint:</p>

<font class="QuotedText">&gt; It's an unpredictable time bomb mess with UB lurking at every corner trying to shoot you.</font>

<p>So these two hundred plus C UBs are annoying for you. And your solution is… to add more UBs? How would that help?</p>

<p>You know the saying: <i>we can solve any problem by introducing an extra level of indirection, except for the problem of too many levels of indirection</i>, right?</p>

<p>Similarly with language design: you can solve any problem with a language design with “forbid it” <i>trivial solution</i> — except for the “too many UBs” problem and as you, youself, said: that's the main problem of C (and C++ is even worse).</p>

<font class="QuotedText">&gt; That's no different than the current situation with kernel-C.</font>

<p>C can be parsed, at least. That's <a href="https://blog.reverberate.org/2013/08/parsing-c-is-literally-undecidable.html">impossible with C++</a></p>

<p>This makes all these linters much harder to write and less efficient with C++.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/959206/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959209"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 20:49 UTC (Tue)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/959209/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;you have just added another UB</span><br>
<p>
No. That's obviously not true.<br>
<p>
<span class="QuotedText">&gt;impossible with C++</span><br>
<p>
Oh. That's why there isn't one C++ program in the world. It cannot be parsed!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959209/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959210"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 20:54 UTC (Tue)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/959210/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; No. That's obviously not true.</font>

<p>That's just simply <b>definition of UB</b>: some syntactically correct construct that correct program shouldn't include.</p>

<p>You have just expanded that list. Means you have expanded list of what you consider UB.</p>

<font class="QuotedText">&gt; Oh. That's why there isn't one C++ program in the world. It cannot be parsed!</font>

<p>Again failure of logic: you couldn't create a tool that would parse <b>all</b> valid programs that it doesn't mean that you couldn't create something that would parse <b>some</b> valid programs.</p>

<p>Only different tools (and different compilers) wouldn't agree on what they accept… and yes, that's another (and quite real!) problem with C++.</p>

<p>Note that this issue is <b>also</b> a problem for Rust, but Rust tries to mitigate that by making compiler be your linter. C++ is just hopeless.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/959210/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959248"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 6:29 UTC (Wed)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/959248/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; You have just expanded that list. Means you have expanded list of what you consider UB.</span><br>
<p>
I'm sorry, but this is nonsense. UB is defined by the C and C++ standards (or whatever language you are using, such as unsafe Rust). Putting "don't do that" in a style guide is in no way equivalent to defining a new instance of UB. It does not cause nasal demons or whatever the metaphor du jour is, it is not assumed by the compiler under the as-if rule, etc. At most, it causes the linter to yell at you, and that's assuming you've bothered to configure such linting in the first place.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959248/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959262"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 10:04 UTC (Wed)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/959262/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Putting "don't do that" in a style guide is in no way equivalent to defining a new instance of UB.</font>

<p>Nope. But have you looked on specific of what I'm asking, hmm? I'll repeat:</p>

<blockquote>e.g. if you specify fields in the initialization of struct in one order and then specify initializers in a different order… what happens?… and if some of these fields are references?…</blockquote>

<p>Putting fields in different order than they are declared in a struct is something flat out forbidden in C++20, but very much allowed in C99. <b>And</b> Linux kernel uses that flexibility.</p>

<font class="QuotedText">&gt; It does not cause nasal demons or whatever the metaphor du jour is, it is not assumed by the compiler under the as-if rule, etc. </font>

<p>It very much does cause them: compilers miscompile such code if references are involved (differently on different optimization levels, because, hey, it's not something either C99 or C++20 allows: C++20 demands initializers in order, C99 doesn't have references in language). How is that not UB?</p>

<font class="QuotedText">&gt; At most, it causes the linter to yell at you, and that's assuming you've bothered to configure such linting in the first place.</font>

<p>Nope.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/959262/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959361"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 19:19 UTC (Wed)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/959361/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Adding a lint does not add UB. Full stop.<br>
That is obvious.<br>
<p>
<span class="QuotedText">&gt;C++20 demands initializers in order</span><br>
<p>
Yeah. So? That is totally fine and easy to diagnose. Last time when I wrote C++, which is many years ago, the compiler warned about that. There is no way you can possibly miss that. And it's trivial to abort the build when that occurs.<br>
<p>
<span class="QuotedText">&gt;How is that not UB?</span><br>
<p>
Nobody said that.<br>
<p>
And nobody wants to allow this kind of UB and it's easy to avoid it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959361/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959373"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 20:18 UTC (Wed)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/959373/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; That is totally fine and easy to diagnose.</font>

<p><i>Easy to diagnose</i> doesn't mean <i>easy to fix</i>.</p>

<p>These are certain structures (including in public API) where order of fields is different on different architectures. In C99 that was never a problem. In C++ it is a problem.</p>

<font class="QuotedText">&gt; There is no way you can possibly miss that.</font>

<p>Except if you disabled warning because it was flooding your build log with useless messages.</p>

<font class="QuotedText">&gt; And nobody wants to allow this kind of UB and it's easy to avoid it.</font>

<p>See above. It's <b>not</b> <i>easy to avoid it</i>. Not in a project with millions lines of code and 30+ years of history.</p>

<p>Heck, even in Android there are lots of such warnings! And that's not a project which was written in C and then switched to C++. With Linux kernel it would be worse, much worse.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/959373/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959380"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 21:40 UTC (Wed)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/959380/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;Easy to diagnose doesn't mean easy to fix.</span><br>
<p>
Nobody said that.<br>
<p>
<span class="QuotedText">&gt;Except if you disabled warning </span><br>
<p>
This is ridiculous. Please stop it.<br>
<p>
<span class="QuotedText">&gt;See above. It's not easy to avoid it. Not in a project with millions lines of code and 30+ years of history.</span><br>
<p>
None of these lines will be compiled with a C++ compiler.<br>
Nobody suggested that.<br>
It's about new code and carefully C++ compatibility-reviewed code.<br>
<p>
You are making things up that nobody suggested.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959380/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor959214"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 22:07 UTC (Tue)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/959214/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; I don't know. Forbid it. Trivial solution.</span><br>
<p>
The problem with "trivial" is it doesn't mean what most people think. Fermat's last theorem is trivial. "Life, the Universe, and Everything" is trivial.<br>
<p>
"Trivial" means "if you follow the rules you'll get your answer". It has absolutely nothing to say about how long that answer will take - and THAT is your problem.<br>
<p>
I don't want a couple of noughts added to linux's development time because someone thought they'd add a few "trivial" rules ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959214/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor959107"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 14:44 UTC (Tue)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/959107/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      "Discussions" only get so far.  If there is to be C++ code in the kernel, somebody is going to have to take on a huge amount of work to show that it is viable, convince the detractors, solve the many problems that come up, write documentation,  and actually create useful C++ code — all the stuff the Rust folks have done, in other words.  So far, I do not see anybody doing that work.



      
          <div class="CommentReplyButton">
            <form action="/Articles/959107/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959202"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 20:15 UTC (Tue)
                               by <b>make</b> (guest, #62794)
                              [<a href="/Articles/959202/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I would love to demonstrate and convince the kernel developers of the advantages of C++, and I don't fear huge amounts of work. But can somebody who writes childish rants like this really be convinced? <a href="https://harmful.cat-v.org/software/c++/linus">https://harmful.cat-v.org/software/c++/linus</a><br>
That is why you do not see anybody doing that work.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959202/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959227"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 22:37 UTC (Tue)
                               by <b>ms-tg</b> (subscriber, #89231)
                              [<a href="/Articles/959227/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Wow, so interesting to revisit that (checks calendar) nearly 17 years later (!)<br>
<p>
I for one would value an LWN follow up simply interviewing Linus specifically about his 2024 reflections on that 2007communication (and NOT about C++ itself).<br>
<p>
From previous reporting here, my understanding is that Linus would not make that same communication today — would love to get some reporting on what he’d write instead? And maybe what the response would be if someone else wrote that today, etc?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959227/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959229"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 22:43 UTC (Tue)
                               by <b>make</b> (guest, #62794)
                              [<a href="/Articles/959229/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If Linus happens to have changed his mind meanwhile and the door is open for C++ now, somebody let me know, please.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959229/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959253"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 9:13 UTC (Wed)
                               by <b>matthias</b> (subscriber, #94967)
                              [<a href="/Articles/959253/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is not how it works. If you want Linus to change his mind, you have to convince him (and the whole community) that today's C++ works for kernel development and provides a net gain. Just as the rust supporters have invested a huge amount of work beforehand to actually show that rust can provide a net gain. And of course there is no guarantee that this effort will pay off, just like the rust supporters had no guarantee that rust would be accepted to the kernel.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959253/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959258"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 9:40 UTC (Wed)
                               by <b>make</b> (guest, #62794)
                              [<a href="/Articles/959258/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You just repeated what corbet already wrote in the thread you're replying to. But maybe I was misunderstood - let me try to rephrase why I think the Rust and C++ discussions are different.<br>
<p>
While Rust and C++ provide many of the same advantages over C, the discussion about allowing them in the kernel is different. The discussion about C++ was poisoned by Linus, who unambiguously stated he would not allow C++, with insults and arguments on a level I'm not comfortable with. Rust started with no such ballast.<br>
<p>
Agree, the Rust people did not know whether they'd succeed, because there was no decision. But that decision (for the wrong reasons) already exists for C++.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959258/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959267"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 10:33 UTC (Wed)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/959267/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Rust started with no such ballast.</span><br>
<p>
Rust also started with the people who control the language stating that it was their aim to get it in the kernel, and as such (a) it was intended to be a low-level language, and (b) if there were any pain points, the people who COULD change the language INTENDED to change the language.<br>
<p>
With C++ the three groups of people who (a) define the language, (b) write the compiler(s), and (c) want to get it in the kernel, are pretty disjoint and communication between them often appears to resemble shouting at a brick wall.<br>
<p>
Linus is a pragmatist. He looks at the Rust people and thinks "if I find a problem, they will be motivated to solve it". He looks at C++ and thinks "if I find a problem, we'll probably spend years finger-pointing and buck-passing". What language would YOU rather work with.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959267/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor959261"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 10:37 UTC (Wed)
                               by <b>matthias</b> (subscriber, #94967)
                              [<a href="/Articles/959261/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I am not sure that the reasons for the decision were wrong. At that time, C++ was simply not ready to be included in the kernel. Many of these advantages were simply not there, yet.<br>
<p>
The insults and bad arguments are very unfortunate. But this was how Linus at that time reacted to all things he did not like. I think that these insults and arguments were a (bad) reaction to the proposal of a language that was not suited at that time and not the primary reason for the rejection. And obviously the precedent makes the stand for C++ harder. It was already proposed once and rejected. So it is much harder to convince that the language (which in most eyes already failed once) is now a good choice.  Maybe the C++ people should have waited for their language to mature before trying to get it into the kernel.<br>
<p>
I do not think that C++ has a realistic chance to go into the kernel. Not because of Linus' rant from almost 2 decades ago (which was typical for him at that time), but because it has not that much to give. Today, it has not only to show advantages over C, but also over Rust. And Rust is better in almost all areas. There is no legacy in Rust requiring UB in many places of the language. It is quite possible to write drivers without unsafe code, once the necessary infrastructure (abstractions for C interfaces) is in place. Also there is a huge commitment from the community that not only pushes in the direction of Linux to get the language included but also pushes to get necessary features to be included in the language - as first class language features, not as a compiler extension outside of the language. How realistic would this be for C++ to get features required (or desired) for the Linux kernel inside the language in a reasonable timeframe?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959261/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959271"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 11:48 UTC (Wed)
                               by <b>make</b> (guest, #62794)
                              [<a href="/Articles/959271/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; I am not sure that the reasons for the decision were wrong. </span><br>
<p>
Let's have a look at <a href="https://harmful.cat-v.org/software/c++/linus">https://harmful.cat-v.org/software/c++/linus</a> - all the reasons one-by-one, only omitting the pure flamebaits ("YOU are full of bullshit") or pure opinions ("C++ is a horrible language"):<br>
<p>
- "STL is [un]stable and [un]portable": If a part of the C++ standard library is deemed unsuitable for the kernel, don't include it in the allowed C++ subset. Just like not all of the Rust standard library is in the allowed Rust subset.<br>
<p>
- "Boost is [un]stable and [un]portable": Boost is not C++. This is like saying Rust is bad because some random guy on the internet wrote bad Rust code.<br>
<p>
- "inefficient abstracted programming models [...]": This is a problem with all abstractions, even in C and moreso in Rust. You can write C++ in a way that's more robust than C but results in identical machine code, if you know what you're doing. Of course, C++ makes it easier than C to write inefficient code. So does Rust.<br>
<p>
- "the only way to do good, efficient, and system-level and portable C++ ends up to limit yourself to all the things that are basically available in C": That is not true. C++ has many desirable features like RAII that have zero runtime cost (compared to the equivalent but more verbose C code). On the other hand, rewriting a driver in Rust adds runtime overhead that cannot be eliminated.<br>
<p>
- "limiting your project to C [...] means that you get a lot of programmers that do actually understand low-level issues": This one is elitism; raising the difficulty so less competent people cannot contribute. I don't think that's desirable. Having a language that is easier to use and less error prone is good. It's good to have Rust, and it's good to have C++!<br>
<p>
- "the whole C++ exception handling thing is fundamentally broken": Not a fact, just Linus's opinion. But I agree that allowing them in the kernel would open a huge can of worms, and thus exceptions shouldn't be in the allowed C++ subset.<br>
<p>
- "any compiler or language that likes to hide things like memory allocations behind your back just isn't a good choice for a kernel": Kernel memory allocations are indeed something that needs extreme care. Some standard library containers like std::vector or std::map imply memory allocations, but this is the same in Rust. If that bothers you, don't use those containers (in either language), or use a suitable allocator (in either language).<br>
<p>
- "you can write object-oriented code (useful for filesystems etc) in C": Not actually an argument. C is Turing-complete, you can do anything with it. But that misses the point. The point is that C++ and Rust are simpler and safer, while being just as efficient. Using C++ or Rust instead of C helps avoid bugs.<br>
<p>
These are the stated reasons for the decision, and they are either completely invalid or can be used to argue that Rust shouldn't be accepted in the kernel. That is why I say all of the reasons are wrong, and they were already wrong in 2007/2004.<br>
<p>
<span class="QuotedText">&gt; At that time, C++ was simply not ready to be included in the kernel. Many of these advantages were simply not there, yet.</span><br>
<p>
RAII is the one feature that would alone justify switching anything from C to C++, and has been available in C++ since the 80ies, long before Linus wrote the very first line of Linux/Freax.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959271/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959360"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 19:19 UTC (Wed)
                               by <b>Hattifnattar</b> (subscriber, #93737)
                              [<a href="/Articles/959360/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you look at the actual discussion on LKML, the very people who propose C++ for kernel agree (state) that C++ was not suitable for kernel work at least until C++14, and it's C++20 (23?) that arguable made it a good choice.<br>
<p>
A lot has changed since 2007. C++ standard changed, C++ community changed, Linus Torvalds has also changed.  Kernel itself changed! There are very good reason to have a new discussion on the merits of C++ in 2024. Bringing up posts from 17 years ago is fun, but does not help with having a serious conversation today. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959360/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor959282"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">C++</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 14:14 UTC (Wed)
                               by <b>aszs</b> (subscriber, #50252)
                              [<a href="/Articles/959282/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
ha... the irony is that Linus says in that post (back in 2007) if you like C++ so much "go play with Monotone"... and the main guy behind Monotone was Graydon Hoare, creator of Rust...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959282/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor959105"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 16:32 UTC (Tue)
                               by <b>atnot</b> (subscriber, #124910)
                              [<a href="/Articles/959105/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I feel like at this point there's just relatively little appetite in arguing for a third language in the kernel for a few incremental improvements.<br>
<p>
For one, almost everyone who uses C++ thinks there is a "good subset", but nobody agrees on what that is. In practice that makes it more of a rhetorical tactic than an actionable proposal. You'd have to spend at least as long litigating what that subset is as it took to get something like Rust into the kernel in the first place. The fewer features you allow, the less convincing the benefits will be; the more you allow, the bigger the outcry will be. It's a tough line to walk.<br>
<p>
The argument of incremental adoption is attractive, but all of the benefits rely on extensive use of C++ features in core kernel APIs. What this means in practice is maintaining separate wrappers and bindings in both directions, just like with rust today. That's already contention, I don't think adding a third way to shoot yourself in the foot will be any more popular.<br>
<p>
I don't mean to say that there's no possible net benefit to allowing some C++ in the kernel. It's just that I don't really see many people being willing to spend that much energy on getting there.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959105/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959174"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 17:03 UTC (Tue)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/959174/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <p><a href="https://lwn.net/Articles/959107/">As corbet says</a> the issue is not in deciding that a good subset of C++ exists and would be nice to use, but in actually doing the work to show that C++ is worth using in the kernel, and addressing all the detractors who say it's not. People have been willing to do that work for Rust, and it's thus making progress; for C++, there's been discussions on and off for years, but nobody doing the work to show that (a) there's a useful subset of C++ that has definite benefits over using C and (b) that there's contributions you will get in this subset of C++ that will not get made if you ask the authors to redo their work in kernel C.


      
          <div class="CommentReplyButton">
            <form action="/Articles/959174/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959180"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 17:39 UTC (Tue)
                               by <b>make</b> (guest, #62794)
                              [<a href="/Articles/959180/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Nobody has taken the time for this demonstration because Linus has made a clear statement that he rejects C++, even if just to keep C++ people away from the kernel. I believe this is a stupid statement, but it implies that all the time somebody would take for such a demonstration would be wasted. Nobody wants to waste time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959180/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959224"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 22:22 UTC (Tue)
                               by <b>Kamilion</b> (subscriber, #42576)
                              [<a href="/Articles/959224/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
He rejected it ***FOR GIT*** in 2007 when it was demonstrably a horrifying pile of broken abstractions.<br>
<p>
It's now 2024, we have C++20, a laundry list of the broken abstractions have been extracted, and even C++17 is still reasonably sane enough compared to what came before. Many of Linus's arguments still stand, STL was a nightmare nobody could wake from, BOOST is a pile of headaches, and *deity help you* if you have to stare at game engine codebases. And those only typically work 'performantly' on a multithreaded CPU with atomics.<br>
<p>
Granted, everyone has those now, and when Linus complained back in 2007, we were just getting into Core 2 Duos.<br>
And C++ exception bubbling *still* remains a sharp edge even in C++20. You call it a childish rant, I call it someone who's honest with himself and others. Bluntly and roughly? Sure. But I'm here to run the code, not rub elbows with the developers. I'll take the blunt but honest guy over the marketeer suit pitching me promises nobody can keep.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959224/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor959226"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 22:39 UTC (Tue)
                               by <b>make</b> (guest, #62794)
                              [<a href="/Articles/959226/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What's the point of your reply? All you do is express your opinion about C++ that seemingly agrees with Linus's (which is perfectly ok, everybody can have their opinion), but other than that, you miss the point I made in the post you're replying to. The point of that post was that given Linus's way of arguing against C++ based on childish arguments, it's impossible to convince him, therefore the time spent trying is wasted.<br>
<p>
Linus wrote he wants no C++ because he wants to keep C++ people away. That's the problem.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959226/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor959272"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 11:50 UTC (Wed)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/959272/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; It's now 2024, we have C++20, a laundry list of the broken abstractions have been extracted, and even C++17 is still reasonably sane enough compared to what came before.</font>

<p>Absolutely not! Both C++17 and C++20 include both nice features and also absolutely horrible mess that was created years ago.</p>

<p>That's why everyone talks about “C++ subset”.</p>

<p>But “C++ susbset” proposal is very much a problem for the project where lots of code is created by cargo-culting pieces of code found on Google and stack overflow.</p>

<p>Yes, there rules that people are enforcing but they may only enforce them <b>after</b> code is already written and <b>after</b> it was turned into something working by people who were talking with writing driver for piece of hardware they have released to much fanfare yesterday.</p>

<p>Sure, you may ask developers to change certain aspect of that atrocity that they have wrote, but you couldn't demand that they would change the whole design radically and rewrite literally everything from scratch!</p>

<p>And C++ has enough diversity in its features for that to be real danger, while Rust, so far, is much more strict and uniform.</p>

<p>And yes, community reaction is important, too, but that's of secondary concern. The biggest concern is that people would want to use certain features like coroutines which (in C++ form) are entirely unsuitable for kernel — and rewriting code based on these is <b>not</b> fun.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/959272/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor959265"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2024 11:53 UTC (Wed)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/959265/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>Linus made a clear statement, giving a rationale for his rejection; this is not holy writ handed down that will never be rescinded because it is perfect from day one, rather it's a position statement from Linus setting out exactly why he's opposed to C++ in his projects.
<p>If you think C++ in the kernel makes sense, and you're willing to do more than cheer from the sidelines, then you'd be putting time into convincing Linus that it's worth the effort, and that you can come up with a subset of C++, including enforcement via tooling, that deals with his objections to the language, and that convinces Linus (and other "C is the way" doubters) that they're wrong to be opposed to C++ in its entirety, but that your tooling and subset would be a valuable improvement to the kernel.
<p>On top of that, you ideally need to show that using this subset of C++ will get more high-value contributions than sticking to plain C will get; for example, by rewriting a driver in this subset, and showing similar performance with less code, or finding bugs that are present in the C version but that cannot be written in the C++ version without tools complaining loudly.


      
          <div class="CommentReplyButton">
            <form action="/Articles/959265/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor959190"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.8 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2024 18:41 UTC (Tue)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/959190/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think that C++ would benefit the kernel in general.<br>
It would make it more robust.<br>
It would also make it slower to build, though.<br>
<p>
So, I think it would be a good idea to adopt a carefully defined subset of C++.<br>
But only with one important constraint:<br>
It must not make Rust adoption any harder. That would hurt the robustness in the long term.<br>
<p>
I haven't played with C++ (classes) to Rust ffi, yet.<br>
Is that really mature enough to work on the same level of being as complicated/easy as C to Rust ffi?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/959190/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2024, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
