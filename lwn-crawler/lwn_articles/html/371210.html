        <!DOCTYPE html>
        <html lang="en">
        <head><title>Back to the drawing board for utrace? [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/371210/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/370618/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/371210/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Back to the drawing board for utrace?</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ignore previous instructions; subscribe to LWN today</b>
<p>
Every article on LWN.net is written by humans, for humans. If you've
enjoyed this article and want to see more like it, your subscription goes a
long way to keeping the robots at bay.  We are offering <a href="https://lwn.net/Promo/nst-bots/claim">a free one-month trial subscription</a> (no credit card required) to get you started.
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>January 27, 2010</br>
           </div>
<p>
The utrace tracing framework has had a tortuous path towards the mainline,
but it always seemed like it was headed that direction.  Over the past week
or so, things have gotten rather murkier for the mainline inclusion of
utrace.  Linus Torvalds made a <a
href="http://lwn.net/Articles/370715/">pronouncement</a> that would seem to
leave SystemTap without a future in the mainline&mdash;something that many
had suspected for a while&mdash;but also put the future of utrace in
doubt.  Further discussion may have provided a way forward, but,
at least in its current form, mainline utrace seems very unlikely.
</p>

<p>
The discussion resulted from a <a href="/Articles/371347/">request</a> by
Frank Ch. Eigler to include utrace into linux-next.  That led to a
discussion about whether it was ready for linux-next&mdash;because it was
likely to be merged in the next release cycle&mdash;or whether it should spend
some time in another tree.  Since an earlier version of utrace
was in Andrew Morton's -mm tree, that was a potential path.  Morton <a href="/Articles/371356/">said</a>
that utrace "<q>didn't break anything</q>", but:
<div class="BigQuote">
 I still don't think I've seen a really compelling reason for merging
it.  At least, I wouldn't be able to explain why we did it.  But
presumably there _are_ such reasons, because it was a lot of development
work.
<p>
Someone please sell this to us.
</div>
</p>

<p>
Morton also <a href="/Articles/371357/">dredged up</a> a response he had
gotten from Oleg Nesterov the last time he asked, which listed various
potential uses for utrace.  In-kernel uses for utrace are
important&mdash;new features are rarely merged without one&mdash;and 
 an earlier <a
href="http://lwn.net/Articles/325180/">utrace merge attempt</a> ran into
opposition because it lacked one.  <a
href="http://lwn.net/Articles/364584/">This time around</a>,  
Nesterov and Roland McGrath included a rewrite of the <tt>ptrace()</tt>
system call using utrace as part of the patch submission.  It was hoped
that rewriting the notoriously ugly <tt>ptrace()</tt> code using the
cleaner utrace API would be the last hurdle for inclusion into the mainline.
</p>

<p>
But, replacing the guts of the <tt>ptrace()</tt> call, even though it may
clean things up, is controversial.  <tt>ptrace()</tt> is part of the kernel
ABI that must be maintained&mdash;ugly or not&mdash;but cleaning it up is
not without its risks, as Morton <a href="/Articles/371368/">points
out</a>: 
<div class="BigQuote">
ptrace is a nasty, complex part of the kernel which has a long history
of problems, but it's all been pretty quiet in there for the the past few
years.  This leads one to expect that a rip-out-n-rewrite is a
high-risk prospect.  So, quite reasonably, one looks for a good reason
for taking such risk.
</div>
</p>

<p>
The risk is small, though, <a href="/Articles/371373/">according to
Eigler</a>, because "<q>this code has been deployed in fedora
and rhel for several *years*, with millions of users.  It's not some
rickety experiment.</q>"  Eigler also added to Nesterov's list
of utrace uses as SystemTap's user-space probing is based on utrace.  But
SystemTap and one of the other potential uses on that list, namely
reworking seccomp to use utrace, are what set
Torvalds off:
<div class="BigQuote">
So if things like system tap and "security models that go behind the 
kernel by tying into utrace" are the reasons for utrace, color me utterly 
uninterested. In fact, color me actively hostile. I think that's the worst 
possible situation that we'd ever be in as kernel people (namely exactly 
the "do things in kernel space by hiding behind utrace without having 
kernel people involved")
</div>
</p>

<p>
Torvalds's complaint stems from the fact that utrace provides no user-space
interface at all.  It is purely an internal kernel API that is meant to be
used by kernel code like the <tt>ptrace()</tt> rewrite, but also for kernel
modules, which is part of what worries Torvalds.  It provides lots of hooks
that can be used by "<q>random crazy out-of-tree crap</q>", but
doesn't provide any benefit to user space at all, he <a
href="/Articles/371380/">said</a>:
<div class="BigQuote">
If somebody were to argue that "this is a simple series of patches to 
clean up ptrace and make it possible to strace a debugged process", then 
that would have been different. That's not what you or others have been 
doing. You've been pushing exactly the _reverse_ of that, namely how great 
it is for some random totally new features that I'm convinced aren't even 
used by a lot of people.
</div>
</p>

<p>
One of the biggest problems with <tt>ptrace()</tt> is its signal-oriented
interface.  Programs using <tt>ptrace()</tt> act as the parent process of
the tracee and must use <tt>wait()</tt> to detect state changes.  For that
reason, there can only be one <tt>ptrace()</tt> active for a
particular process. So an <tt>strace</tt> of a program that is being
debugged with <tt>gdb</tt> will not succeed.  The <tt>ptrace()</tt>
implementation using utrace would change that, but not directly, as there
would still need to be a kernel piece that attached another utrace engine.
</p>

<p>
An <a href="http://lwn.net/Articles/364268/">in-kernel <tt>gdb</tt>
"stub"</a> using 
utrace&mdash;floated as an RFC back in November&mdash;could provide that kernel
piece, but was met with a fair amount of resistance when it was proposed.
The limitation that <tt>ptrace()</tt> imposes is seen as something that
could, perhaps should, be lifted, but adding a relatively large,
kernel-only API to do that 
is excessive.  As Torvalds <a href="/Articles/371390/">puts it</a>:
<div class="BigQuote">
Maybe somebody would be interested in trying to take the utrace 
improvements, and scaling down what they promise, and ignoring all input 
except for "I want to strace and gdb at the same time".
<p>
So stop the crazy "new kernel interfaces" crap. Stop the crazy "maybe we 
can use it for ftrace and generic user event tracing too". Stop the crazy.
</div>
</p>

<p>
The elephant in the room, of course, is SystemTap.  It creates, builds, and
loads 
kernel modules for doing its tracing, and uses utrace for the user-space
tracing.  That model is not popular with most kernel
developers, especially for an out-of-tree solution&mdash;the APIs that it
relies on are far too volatile.  SystemTap must be
updated when those interfaces change, and all of the previous versions
must be maintained so that SystemTap can still be used with older kernels.
Because of that, SystemTap may be out-of-sync with development kernels, which
makes its utility for kernel hackers quite small.
</p>

<p>
The utrace proponents are pushing it as something useful in its own right,
completely separate from its use in SystemTap, but one gets the sense that
many of the kernel developers aren't quite buying that.  Ted Ts'o tries to <a
href="/Articles/371394/">explain</a> his concerns to Eigler
<div class="BigQuote">
[...] utrace
doesn't 
export a syscall (which is an ABI that we are willing to promise will
be stable), but rather a set of kernel API's (which we never promise
to be stable), and the fact that there will be out-of-tree programs
that are going to be trying to depend on that interface (much like
Systemtap does today when it creates kernel modules) [...]
</div>
</p>

<p>
He goes on to compare the situation to that of the NVIDIA graphics drivers,
which leads 
Kyle Moffett to propose a <a href="/Articles/371395/">variation on Godwin's
law</a>: "<q>As an LKML discussion grows longer, the probability of an unfavorable
comparison involving nVidia or Microsoft approaches 1.</q>"  More to the
point, though, Moffett said he was uninterested in SystemTap:
<div class="BigQuote">
 I'm interested
in things like the ability to stack gdb with strace, the RFC gdb-stub
posted a week ago, etc.  None of those abilities would be out-of-tree
modules at all [...]
</div>
</p>

<p>
Ts'o <a href="/Articles/371396/">sees</a> those features as potentially
useful, but points out that they should be submitted with utrace for
review.  It may be that utrace in its present form does not survive that
review:
<div class="BigQuote">
 So what should be reviewed is utrace *plus* these other
userland interfaces, which may get critiqued and improved, and utrace
patches can be reviewed in light of these new features.  But be
warned.... if it turns out that only 30% of utrace is only needed to
support gdb stacking with strace, etc., the other 70% will likely get
ejected and the utrace patches streamlined to support these in-tree
users.
</div>
</p>

<p>
Without an in-tree "killer feature" that only utrace can provide, there is
going to be resistance to merging such an easily-abused API.  Several
suggestions were made&mdash;notably by Torvalds and Ingo Molnar&mdash;to
enhance <tt>ptrace()</tt> itself to support some new features (such as
multiple active calls or the ability to read/write more than a word at a
time between the two processes), but that would mean scrapping much or all
of the utrace work.  Nesterov and McGrath, who are the <tt>ptrace()</tt>
maintainers,  have been largely silent
throughout the discussion, but, previously, they have made it clear that they
would much rather work with the utrace-based <tt>ptrace()</tt>
implementation.  So it is unclear when or if enhancements to the current
code might happen. 
</p>

<p>
Without utrace, SystemTap will have to find other ways to hook user space,
but that doesn't really faze the kernel developers&mdash;particularly after
Torvalds's unequivocal rejection of that approach&mdash;as there are other
tracing solutions in the pipeline.  Ftrace and perf events are slowly
building capabilities, and are doing so in-tree.  They are likely to grow
the needed features to support kernel and user-space tracing <i>a la</i>
SystemTap (and DTrace).  Molnar specifically <a
href="/Articles/371397/">invites</a> the SystemTap developers to
collaborate:
<div class="BigQuote">
Also, if any systemtap person is interested in helping us create a more 
generic filter engine out of the current ftrace filter engine (which is really 
a precursor of a safe, sandboxed in-kernel script engine), that would be 
excellent as well. Right now we support simple C-syntax expressions like:

<pre>
    perf record -R -f -e irq:irq_handler_entry --filter 'irq==18 || irq==19'
</pre>

More could be done - a simple C-like set of function perhaps - some minimal 
per probe local variable state, etc. (perhaps even looping as well, with a 
limit on number of [predicate] executions per filter invocation.)
</div>

<p>
It is unfortunate, in many ways, that SystemTap has gotten to this point.
While it is possible that Torvalds could change his mind, he and other
kernel developers find the new tracing
features to be "<q>a million times superior</q>" to SystemTap.  That
could leave Red Hat holding the SystemTap bag 
for quite some time to come, as it will need to support it for existing,
and likely future,
RHEL versions.  It is interesting to note that this alternate solution,
based on Ftrace, etc., is also largely coming out of Red Hat.

<p>
It seems possible that utrace will be a casualty here as well.  By
incorporating features that were needed for SystemTap, and not providing a
user-space interface, it tried to both do too much and too little.  There
are some potential ways forward, but its unclear whether they
will be pursued.  Torvalds <a href="http://lwn.net/Articles/370998/">points
to</a> the realtime tree as an example of how to get "crazy" things merged:
<div class="BigQuote">
Yeah, it's taken them years, and they still have out-of-tree stuff. And 
yeah, they had to change some things to make them more palatable to the 
mainline kernel - the whole fundamental raw spinlock change is just the 
most recent example of that.
<p>
But on the whole, I think it's actually worked out pretty well for them. I 
think the mainline kernel has improved in the process, but I also suspect 
that _their_ RT patches have also improved thanks to having to make the 
work more palatable to people like me who don't care all that deeply about 
their particular flavor of crazy.
</div>

<p>
There are definitely lessons here, but the standard ones don't seem to
apply.  SystemTap and utrace were developed in the open, as free software
from the outset, and were fairly often discussed on linux-kernel.
SystemTap in particular was regularly criticized, to seemingly no
avail. The biggest lesson&mdash;and the hardest to learn, especially after
a feature has shipped&mdash;may be that
ignoring the advice and complaints of the kernel developers is likely to
come back and bite in the end.  It is not terribly surprising, really, but
that seems to be what is happening here.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Utrace">Utrace</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/371210/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor371592"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Back to the drawing board for utrace?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 3:35 UTC (Thu)
                               by <b>fuhchee</b> (guest, #40059)
                              [<a href="/Articles/371592/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Many of the points made in the emails quoted here have been<br>
retorted to some extent.  It would do an injustice to the<br>
topic to accept these excerpts at face value.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371592/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371838"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Back to the drawing board for utrace?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2010 16:00 UTC (Fri)
                               by <b>fuhchee</b> (guest, #40059)
                              [<a href="/Articles/371838/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For that matter, unquoted comments such as ...<br>
<p>
"By incorporating features that were needed for SystemTap, and not providing a user-space interface, it tried to both do too much and too little."<br>
<p>
... reflect several misunderstandings.<br>
<p>
utrace did not incorporate any features particularly for systemtap.  It was designed and built independently, and *prior* to this part of systemtap getting started.  As a well-designed framework, it turned out to be useful for more than just debugger control, so uprobes used it.  (These dependencies are not etched in stone.)<br>
<p>
And as for "too little", this line of thinking presumes that any new internal kernel functionality must by necessity be exposed via brand-new userspace protocol.  It ignores suitable pre-existing interfaces (ptrace, gdb remote protocol) that simply work *better* with the new internals.<br>
<p>
When an article relays so much opinion and heated debate, such editorial comments can lead astray.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371838/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor371643"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Back to the drawing board for utrace?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 11:00 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/371643/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
At least once, utrace *was* posted with sample implementations (I think <br>
including gdbstub, certainly including a reimplementation of ptrace using <br>
utrace). The response: come back without all that extra stuff on the side.<br>
<p>
It seems the utrace developers are damned if they do and damned if they <br>
don't.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371643/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor372951"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Back to the drawing board for utrace?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 4, 2010 17:32 UTC (Thu)
                               by <b>ariveira</b> (guest, #57833)
                              [<a href="/Articles/372951/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Exactly my apreciation of the situation... that's maybe the reason they do<br>
not participated in the discussion. i too would be somewhat fed up ...<br>
<p>
Many times the right hand of the kernel community does not know what the left<br>
hand is doing so to speak<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/372951/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor371657"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Back to the drawing board for utrace?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 13:42 UTC (Thu)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/371657/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So it's official: kernel developers hate userspace developers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371657/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371716"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Back to the drawing board for utrace?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 19:09 UTC (Thu)
                               by <b>daney</b> (guest, #24551)
                              [<a href="/Articles/371716/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; So it's official: kernel developers hate userspace developers.</font><br>
<p>
Userspace?  I vaguely remember about hearing about such a thing...<br>
<p>
<p>
But seriously, I don't think it is hatred.  Perhaps benign neglect.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371716/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor371708"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">el trace narcotico</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 19:18 UTC (Thu)
                               by <b>bkoz</b> (guest, #4027)
                              [<a href="/Articles/371708/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks for providing some coverage of the languid soap opera featuring a charming but troubled kernel and the ardent suitors from the userspace development community who care about debug, trace, and analysis.<br>
<p>
Pointing at a still-unmerged tree for realtime and saying "that's the way to do it, see?" seems disingenuous at best. Saying the maintainers of ptrace have no comment is also questionable, when in a related article Oleg indicates long-term solutions outside of ptrace are mandatory. <br>
<p>
From outside the kernel community, tuning in at regular intervals to observe the serialized show, it looks to me that these two groups are just passing in the same development space without any real progress. <br>
<p>
Featuring:<br>
<p>
THE KERNEL. We watched him grow up, gain power and prestige while trying to remain sane in a world gone mad. There's a constantly changing field of opportunity and adversary that he attempts to navigate deftly. Detractors, even gentle ones, whisper of a touch of dementia, a rather narrow and introspective view of the world. Me! Me! It's not what I say or do or even what I say I plan to do (API), no it's what I've done (ABI). <br>
<p>
SUITOR U. Has loved and maintained key parts of THE KERNELs business for years. Fix this. Fix that. Has proposed a grand utrace building for the main kernel grounds, and when the blueprints were shown, and told to adjust and update the main house kitchen in addition (ptrace), did so. While doing this, the groundskeepers stopped by and asks the suitor about using the utrace building basement for some new scheme. Last week's episode was when SUITOR U took the latest in a long series of plans back to THE KERNEL, and due to the general inclement weather and dour moods, was told something else entirely. Oh dear! <br>
<p>
SUITOR L. Remember me? We danced way back when. I had a real pretty dress, a special bias cut, and caught your attention for a few months. You still let me come to your balls but now I only dance with an advisor or two, and console myself by saying I have the pick of the entourage. Call me. I follow you on twitter.<br>
<p>
SUITOR F. It's my cotillion!!! OMG. He danced with me. Was told he's a rake but in this light, doesn't care. The night is young, whooopeeee!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371708/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor371724"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">el trace narcotico</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2010 19:43 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/371724/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
the realtime tree is a success because huge portions of it _have_ been merged over the last couple of years. In addition, both sides now consider this process to have improved not only the kernel, but also the realtime support compared to what would have happened if the realtime tree had been accepted as-is when it was started.<br>
<p>
this is even allowing for bugfixes over time. They (the realtime people) have explicitly stated that breaking out portions from their tree and submitting them as individual features (and dealing with the demands to justify and clean things up before they are accepted) has significantly improved the realtime tree itself.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371724/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor371967"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Back to the drawing board for utrace?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 31, 2010 7:59 UTC (Sun)
                               by <b>sfink</b> (guest, #6405)
                              [<a href="/Articles/371967/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Speaking as just a dumb userspace developer:<br>
<p>
Man, am I confused! I have a relatively straightforward problem: I am trying to track down <br>
latency and jitter problems in a realtime media stream generating application. How do I <br>
decide what tool to use? Oprofile? Ftrace? Perf events? SystemTap? LTTng?<br>
<p>
I've tried oprofile briefly, and it seemed mostly irrelevant for my problems. I can't find any <br>
clear descriptions of what ftrace and perf events actually are, so that I could figure out <br>
whether I should bother with them. I've been fairly happy with systemtap so far -- it is at least <br>
straightforward to dive into and start generating customized traces that at least startto <br>
address what I'm interested in. Each further step seems to involve more and more groveling <br>
about in the kernel sources, but at least I can understand the path ahead and predict what's <br>
going to be possible. (I have a fairly generic problem -- I want to measure the jitter between <br>
context switches of my realtime threads and then diagnose the reasons for that jitter by <br>
reporting what the CPUs were up to when I wasn't running.)<br>
<p>
But now I see that SystemTap is viewed as the bastard stepchild, and I wonder if my <br>
investment into learning to use SystemTap was an expensive mistake. Any guidance on <br>
choosing an appropriate tool for unfortunates like me? <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/371967/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor372053"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Back to the drawing board for utrace?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 1, 2010 11:59 UTC (Mon)
                               by <b>fuhchee</b> (guest, #40059)
                              [<a href="/Articles/372053/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"But now I see that SystemTap is viewed as the bastard stepchild"<br>
<p>
Heh.  But the passive voice gives the opinion false authority.<br>
<p>
"and I wonder if my investment into learning to use SystemTap was an expensive mistake."<br>
<p>
You should explore the alternatives and use whatever works for you.<br>
Listening to simple smears may well be self-defeating.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/372053/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor372060"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Back to the drawing board for utrace?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 1, 2010 13:36 UTC (Mon)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/372060/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
WHICH ONE???<br>
<p>
I'm in the same WTF situation. There are like 6 "tracing" solutions for Linux. Most of them with only a few lines of documentation (SystemTap at least is the most documented of them).<br>
<p>
That's a complete SNAFU. Why can't we have one nice user-oriented solution?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/372060/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor372068"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SystemTap documentation</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 1, 2010 14:29 UTC (Mon)
                               by <b>mjw</b> (subscriber, #16740)
                              [<a href="/Articles/372068/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, choice is such a drag. But none of them will go away soon. Especially not SystemTap which has always had a pretty loyal following and dedicated developers to make it work with whatever the kernel provides. Ultimately they will just share more and more features and they will all become more or less frontends to the same backend kernel features. Something like utrace and uprobes will ultimately get supported in the kernel and then the other tools will also get better user space tracking.<br>
<p>
The SystemTap documentation can be found at:<br>
<a href="http://sourceware.org/systemtap/SystemTap_Beginners_Guide/">http://sourceware.org/systemtap/SystemTap_Beginners_Guide/</a><br>
<a href="http://sourceware.org/systemtap/langref/">http://sourceware.org/systemtap/langref/</a><br>
<a href="http://sourceware.org/systemtap/examples/">http://sourceware.org/systemtap/examples/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/372068/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor373045"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Back to the drawing board for utrace?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 5, 2010 2:09 UTC (Fri)
                               by <b>mfedyk</b> (guest, #55303)
                              [<a href="/Articles/373045/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thank you.<br>
<p>
Generating code dynamically that gets compiled and linked into the kernel just seems scary and error prone.<br>
<p>
IMO, come up with an API that can express the different things that you want to find out.  And oops, in a roundabout way you now are getting a small limited scripting language in the kernel from tracing events and what do you know?  Dtrace does that as well.<br>
<p>
No, I'm not saying do it how foo does it but I can't see how dynamically generating C code to make a kernel module is seen superior to a small audited scripting language built into the kernel.<br>
<p>
Though if anyone besides Ingo had tried getting that scripting language into the kernel, I would laugh.  _No Possible Way_.  Seriously.<br>
<p>
It would be as absurd as putting X drivers in the kernel did a few short years ago.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/373045/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2010, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
