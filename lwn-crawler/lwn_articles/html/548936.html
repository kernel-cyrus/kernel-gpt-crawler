        <!DOCTYPE html>
        <html lang="en">
        <head><title>LSFMM: NFS status [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/548936/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/548936/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>LSFMM: NFS status</h1>
</div>
<div class="ArticleText">
<div class="FeatureByline">
           By <b>Jake Edge</b><br>May 1, 2013</br>
           <hr>
<a href="/Articles/LSFMM2013/">LSFMM Summit 2013</a>
</div>
<p>
Trond Myklebust and J. Bruce Fields opened the 2013 LSFMM Summit's
Filesystem-only track with 
an update on the status of NFS.  On the client side, NFS 4.1 is a "done
deal at this point", Myklebust said, and he has spent the last few months
finding the "last few corner-case deadlocks".  There are a few patches for
the 3.9 kernel and a few more queued for 3.10, but it is basically done.
</p>

<p>
Development on the NFS client has moved over to NFS 4.2, where one of the biggest new
features is <a href="/Articles/548347/">copy offload</a>. The main thing
holding that back is the lack of a new system call.  Jeremy
Allison noted that Samba is already doing copy offload using a Btrfs
<tt>ioctl()</tt>.  If all goes well, copy offload will be merged in the
next six months or so, Myklebust said.
</p>

<p>
The other big 4.2 feature is <a
href="http://selinuxproject.org/page/Labeled_NFS">labeled NFS</a>, which
adds SELinux mandatory access control (MAC) to NFS.  The main application
is for virtualization, and the KVM users want to use labeled NFS to improve
security on systems shared by multiple virtual machines.  Myklebust said he had hoped to have it
ready for the 3.10 merge window, but there were still "some niggles".  It
should be in 3.11, he said, "unless we are doing something really wrong".
</p>

<p><blockquote class="ad">
<b><tt>$ sudo subscribe today</tt></b>
<p>
Subscribe today and elevate your LWN privileges. You’ll have
access to all of LWN’s high-quality articles as soon as they’re
published, and help support LWN in the process.  <a href="https://lwn.net/Promo/nst-sudo/claim">Act now</a> and you can start with a free trial subscription.
</blockquote>
<p>
Myklebust also gave a plug for the <a
href="http://fedoraproject.org/wiki/Features/NFSometer">NFSometer</a> tool,
which takes statistics from <tt>/proc</tt> and "makes fancy graphs".  It is
useful to visualize the NFS performance of systems.  It can also compare
multiple sets of stats in bar charts to help users compare performance
between various NFS versions (e.g. v3 vs. v4) as well as between Linux
kernel versions.
</p>

<p>
On the server side, Fields said that 4.0 is "ancient history" at this
point, while the 4.1 RFC has been out for four or five years.  4.1 has
parallel NFS (pNFS) and a bunch of mandatory features that are mostly
invisible to users.  4.2 is what the working group is polishing off right
now.  It contains copy offload, labeled NFS, hole detection and punching,
as well as a
"non-<tt>fallocate()</tt>-compatible space reservation".   All of the
substantive features are optional in 4.2, Fields said.
</p>

<p>
For Linux, the NFS server code has had 4.1 support for some time; it became
 the default in the 3.9 kernel.  No optional features, including
pNFS, are available, though.  Fields would like to start working on 4.2
features like labeled NFS soon.
</p>

<p>
Fields said that he is trying to get VFS support for <a
href="http://docs.oracle.com/cd/E19253-01/816-4555/rfsrefer-140/index.html">delegations</a>
(which are somewhat similar to leases) merged.  The difficulty is in
getting cycles from Al Viro, Linus Torvalds, and "whoever else" to review
the code.  A delegation implementation was tried for ext4, but there were
serious performance implications.
</p>

<p>
The <a href="/Articles/544298/">problem</a> with ext4 <tt>readdir()</tt> cookies
and GlusterFS was also mentioned by Fields.  A fix has been put in for
GlusterFS on ext4 that is rather 
fragile, Ted 
Ts'o said.  Zach Brown called it a "just for now fix".  The basic problem
is GlusterFS's need for some extra bits in the directory offset to store
the ID of the "brick" where the file resides, Fields 
said.  The 
infinite lifetime of <tt>readdir()</tt> cookies is also part of the
problem, Ts'o said.  Allison pointed out that Samba had the same problem
for DOS, but the solution there was to require an update to Windows&nbsp;95.
</p>

<p>
The last topic was <a href="http://en.wikipedia.org/wiki/Richacls">rich
access control lists</a> (ACLs).  Fields said that the 
developers know how to add rich ACLs, but a volunteer is needed to look at
the code and review comments from Christoph Hellwig and others.  It is
something that is "totally doable".  Allison cautioned that Windows ACLs
are different from NFSv4 ACLs, even though the NFS version was based on the
specification documented by Microsoft.  Unfortunately, the specification is
not what 
Microsoft actually implemented, so a mapping between them will be required.
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems-NFS">Filesystems/NFS</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Network_filesystems">Network filesystems</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Storage_Filesystem_and_Memory-Management_Summit-2013">Storage, Filesystem, and Memory-Management Summit/2013</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/548936/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor549200"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LSFMM: NFS status</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 3, 2013 14:03 UTC (Fri)
                               by <b>bfields</b> (subscriber, #19510)
                              [<a href="/Articles/549200/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A couple corrections.  (I'll take blame for the confusion; I need to prepare better and maybe have some slides next time!):<br>
<p>
"For Linux, the NFS server code has had 4.1 support for some time; it became the default in the 3.9 kernel."<br>
<p>
Server 4.1 is not on by default.  I was hoping to turn it on for 3.10, but it looks like that will be 3.11 now.<br>
<p>
"A delegation implementation was tried for ext4, but there were serious performance implications."<br>
<p>
"Delegation" should have been "change attribute" in the above.  (The delegation code isn't really filesystem-specific.)  ext4 does already have a change attribute implementation, but it's turned off by default (mount with the "i_version" option to turn it on).  Josef Bacik looked into turning it on by default, but eventually confirmed performance problems (<a href="http://marc.info/?l=linux-nfs&amp;m=133709258223770&amp;w=2">http://marc.info/?l=linux-nfs&amp;m=133709258223770&amp;w=2</a> and followups).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/549200/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2013, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
