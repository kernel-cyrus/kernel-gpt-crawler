        <!DOCTYPE html>
        <html lang="en">
        <head><title>Merging drivers early [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/270960/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/270339/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/270960/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Merging drivers early</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>This article brought to you by LWN subscribers</b>
<p>
Subscribers to LWN.net made this article &mdash; and everything that
       surrounds it &mdash; possible.  If you appreciate our content, please
       <a href="/Promo/nst-nag3/subscribe">buy a subscription</a> and make the next
       set of articles possible.
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>February 27, 2008</br>
           </div>
<p>
Drivers tend to be a world unto themselves, with bugs only affecting a
subset&mdash;often a tiny subset&mdash;of kernel users.  Until a driver
gets merged into the kernel though, anyone wishing to test it, or help clean it
up, has to jump through some hoops.  To try and help reduce those barriers,
Linus Torvalds and others have been advocating early merging of drivers;
getting them into the kernel and incrementally improving them from there.
</p>

<p>
This policy of early merging of drivers is not universally embraced, with a
recent remote DMA (RDMA) ethernet driver, which lives in the <tt>infiniband</tt>
tree, getting singled
out.  Based on the problems he observed in the driver, Adrian Bunk <a
href="/Articles/271004/">asked</a>: "<q>Is it really intended to merge
drivers without _any_ kind of review?</q>"  This was, perhaps, an overly
dramatic question as the driver <i>has</i> undergone review, but not all of the
changes have been reflected in the mainline version.  There is
still work to do, as Infiniband maintainer Roland Dreier points out:
<div class="BigQuote">
Just to be clear, this driver was reviewed.  Many issues were found,
and many were fixed while others are being worked on.

<p>
It's a judgment call when to merge things, but in this case given the
good engagement from the vendor, I didn't see anything to be gained by
delaying the merge.
</div>
</p>

<p>
It is a sentiment shared by other kernel hackers as well.  When there is a
developer who is responding to the feedback along with a working driver,
getting it into the mainline kernel&mdash;where more eyes can scrutinize
it&mdash;is seen as a positive step.  Torvalds is very interested in seeing
drivers earlier so that more collaboration can happen:
<div class="BigQuote">
I'd really rather have the driver merged, and then *other* people can send 
patches!
<p>
The thing is, that's what merging really means - people can work on it 
sanely together. Before it's merged, it's a lot harder for people to work 
on it unless they are really serious about that driver, so before 
merging, the janitorial kind of things seldom happen.
</div>
</p>

<p>
Other maintainers explained their criteria for accepting drivers that are
not quite up to usual kernel standards.  The consensus seems to be that
drivers with the following characteristics are acceptable:
<ul>
<li>compiles and seems to work</li>
<li>has no obvious security holes</li>
<li>has an active maintainer</li>
<li>does not affect people who don't have the hardware</li>
<li>does not introduce unnecessary or not fully thought out user space interfaces</li>
</ul>
</p>

<p>
There is little in the way of a downside to making drivers available
earlier.  Since they are self-contained, they generally don't cause problems
elsewhere in the kernel.  As long as reviewers are keeping an eye out for
security problems, which could lead to an unsuspecting user's box being
compromised, there are not many ways for a driver to negatively impact the
kernel as a whole.
User space interfaces via <tt>ioctl()</tt>, sysfs, or other means also need
to be closely examined as they will have to be maintained as part of
the kernel interface.
</p>

<p>
Along the way, much grumbling was heard about <tt>checkpatch</tt>, the perl
script that complains about various stylistic problems with a patch.
Notably absent from the list above is any kind of requirement that
<tt>checkpatch</tt> errors or warnings be handled.
The
main complaint against <tt>checkpatch</tt> is its checks for line length; the resulting
"fixes" to kernel source sometimes leave much to be desired.  While it is generally agreed that too many
overly long lines can result in code that is difficult to read, exactly
what constitutes such a line tends to be an aesthetic judgment.
Slavish adherence to a fixed number of characters on a line in order to appease
<tt>checkpatch</tt> is clearly seen as a problem.
</p>

<p>
To some, this makes <tt>checkpatch</tt> less than useful, bordering on dangerous to
readability.  Torvalds stated that he has <a href="/Articles/271051/">considered removing it from
the kernel tree</a> on more than one occasion.  Human judgment is required to
interpret the warnings from <tt>checkpatch</tt> and sometimes it is not
being applied.  On the other hand, Ingo Molnar gives an <a
href="http://lwn.net/Articles/270620/">impassioned defense of the tool</a>:
<div class="BigQuote">
Based on this first hand experience, my opinion about checkpatch has 
changed, rather radically: i now believe that checkpatch is almost as 
important to the long term health of our kernel development process as 
BitKeeper/Git turned out to be. If i had to stop using it today, it 
would be almost as bad of a step backwards to me as if we had to migrate 
the kernel source code control to CVS.
</div>
<p>
Molnar goes on to outline the pros and cons of <tt>checkpatch</tt>, all of which
stands in stark contrast to some of his <a
href="http://article.gmane.org/gmane.linux.kernel/585411">earlier
complaints about the tool</a>.
</p>

<p>
For most drivers, the path into the
kernel has been made a lot easier.  This will have the effect of
getting working, or mostly working, drivers into the hands of users more
quickly. More importantly, it will also get the code into the hands of the Linux kernel
community faster.  The likely result is a fully working, cleanly
coded driver sooner than it might have happened in the past.  An already
quick turnaround for hardware support in Linux may have just gotten faster.
</p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_model-Driver_merging">Development model/Driver merging</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Device_drivers">Device drivers</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/270960/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor271126"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Checkpatch</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 28, 2008 2:21 UTC (Thu)
                               by <b>vomlehn</b> (guest, #45588)
                              [<a href="/Articles/271126/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
A consistent coding style means that you do not have to spend as much cognitive energy on
deciding which things are unimportant distinctions. Thus, even though I don't agree with all
of the kernel code style guidelines, the kernel code I write adheres to it and I have begun
using checkpatch religiously to ensure I get it right. I'm definitely a checkpatch fan.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/271126/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor271201"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">here, here!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 28, 2008 16:17 UTC (Thu)
                               by <b>sbishop</b> (guest, #33061)
                              [<a href="/Articles/271201/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
I worked as an assistant/tutor in my university's computer science lab.  We had two professors
who taught the introductory courses, one who enforced a coding style and one who didn't.  The
other assistants and I often commented on how much easier it was to help the students in the
class where a consistent style was enforced.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/271201/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor271205"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">hear, hear!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 28, 2008 16:52 UTC (Thu)
                               by <b>JoeBuck</b> (subscriber, #2330)
                              [<a href="/Articles/271205/">Link</a>] 
      </p>
      
      </div>
      </summary>
      The expression is "Hear, hear!", meaning "everybody listen to what this guy said".

      
          <div class="CommentReplyButton">
            <form action="/Articles/271205/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor271405"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Consistent coding style</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 29, 2008 19:37 UTC (Fri)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/271405/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
We had two professors
who taught the introductory courses, one who enforced a coding style and one who didn't.  The
other assistants and I often commented on how much easier it was to help the students in the
class where a consistent style was enforced.
</blockquote>
<p>
Was it because the style was consistent or because the professor picked a good style?
<p>
I spent the early part of my software engineering career at a large company that had company-wide coding standards.  I was taught, and believed, that it is easier for someone to read code where the indentations are where one expects them, the variable names in the case one is used to, etc.  Later, I started working with open source code written by the public at large and found that it's actually trivial to adjust to someone else's style, as long as we're just talking about arbitrary style differences.

<p>Adjusting to a bad style, such as using global variables or 500 line subroutines, is obviously another matter.

      
          <div class="CommentReplyButton">
            <form action="/Articles/271405/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor271504"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Consistent coding style</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 3, 2008 3:48 UTC (Mon)
                               by <b>jzbiciak</b> (guest, #5246)
                              [<a href="/Articles/271504/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
I'm sure part of it is due to picking a reasonable style.  Inexperienced programmers don't
necessarily know what "reasonable" is yet.  I wouldn't doubt, though, that a good part of it
comes from the benefits of consistency across a code base.

Part of the reason it's often easy to adjust to a given FOSS project's style is that it's very
likely to be reasonable and consistent across the source base.  Once you get accustomed to the
particular style/flavor, it's easy to see through it to the code.  The fact that each source
file has the same style helps.  Sure you have to switch gears when you come to the project,
but you're not doing it file to file.  You're doing it project to project, which is a pretty
coarse grain.

In the context of grading coursework, I see both aspects playing a role.  You've gotten the
students off on the right path by giving them a (hopefully) reasonable style.  Also, since
each assignment should be using the same style, you aren't having to switch gears with every
source file.  When you are grading 100 assignments, I'm sure that makes a lot of difference.


</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/271504/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor271216"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Nouveau</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Feb 28, 2008 17:41 UTC (Thu)
                               by <b>nim-nim</b> (subscriber, #34454)
                              [<a href="/Articles/271216/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
I *so* wish the nouveau people could hear the merge early wisdom
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/271216/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor272181"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging drivers early</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 7, 2008 12:44 UTC (Fri)
                               by <b>bloke</b> (guest, #50942)
                              [<a href="/Articles/272181/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment"><pre>
I have a few bits of code in mainline for an arachaic system - not many users or testers.
Subsystem maintainers are generally quite strict about things like coding style but, in my
view, often miss some quite big bugs in drivers they ACK.

I'm all in favour of early merging but I think there are a lot of device drivers out there
where the number of users might be quite literally counted on one hand.

Still, it's fun. Nobody pays me for it and probably never will.
</pre></div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/272181/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2008, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
