        <!DOCTYPE html>
        <html lang="en">
        <head><title>Respite from the OOM killer [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/104179/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/103367/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/104179/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Respite from the OOM killer</h1>
<div class="Byline">[Posted September 28, 2004 by corbet]
               <p>
               </div>
</div>
<div class="ArticleText">
Thomas Habets had an unfortunate experience recently.  His Linux system ran
out of memory, and the dreaded "OOM killer" was loosed upon the system's
unsuspecting processes.  One of its victims turned out to be his screen
locking program, leaving his session open to whoever might happen to walk
by.  His response was <a href="/Articles/104145/">the oom_pardon patch</a>,
which allows the system administrator to exempt certain processes from the
OOM killer's revenge.  It turns out that SUSE has <a
href="/Articles/104180/">a similar patch</a> which allows administrators to
set the "OOM score" of specific processes, increasing or decreasing their
chances of being chosen for an untimely demise.
<p>

The OOM killer exists because the Linux kernel, by default, can commit to
supplying more memory than it can actually provide.  Overcommitting memory
in this way allows the kernel to make fuller use of the system's resources,
because processes typically do not use all of the memory they claim.  As an
example, consider the <tt>fork()</tt> system call, which copies all of a
process's memory for the new child process.  In fact, all it does is to
mark the memory as "copy on write" and allow parent and child to share it.
Should either change a page shared in this way, a true copy is made.  In
theory, the kernel could be called upon to copy all of the copy-on-write
memory in this way; in practice, that does not happen.  If the kernel
reserved all of the necessary virtual memory (which includes swap space),
some of that space would certainly go unused.  Rather than waste that space
- and fail to run programs or memory allocations that, in practice, it
could have handled - the kernel overcommits itself and hopes for the best.
<p>

When the best does not happen, the OOM killer comes into play; its job is
to kill processes and free up some memory.  Getting it to kill the right
processes has been an ongoing challenge, however.  One person's useless
memory hog is another's crucial application.  Thus, over the years,
numerous efforts have been made to refine the OOM killer's heuristics, and
patches like "oom_pardon" have been created.
<p>

Not everybody agrees that this is a fruitful use of developer time.
Andries Brouwer <a href="/Articles/104185/">came up with this analogy</a>:
<p>
<div class="BigQuote">
	An aircraft company discovered that it was cheaper to fly its
	planes with less fuel on board. The planes would be lighter and use
	less fuel and money was saved. On rare occasions however the amount
	of fuel was insufficient, and the plane would crash. This problem
	was solved by the engineers of the company by the development of a
	special OOF (out-of-fuel) mechanism. In emergency cases a passenger
	was selected and thrown out of the plane. (When necessary, the
	procedure was repeated.)  A large body of theory was developed and
	many publications were devoted to the problem of properly selecting
	the victim to be ejected.  Should the victim be chosen at random?
	Or should one choose the heaviest person? Or the oldest? Should
	passengers pay in order not to be ejected, so that the victim would
	be the poorest on board? And if for example the heaviest person was
	chosen, should there be a special exception in case that was the
	pilot? Should first class passengers be exempted?  Now that the OOF
	mechanism existed, it would be activated every now and then, and
	eject passengers even when there was no fuel shortage. The
	engineers are still studying precisely how this malfunction is
	caused.
</div>
<p>

Overcommitting memory and fearing the OOM killer are not necessary parts of
the Linux experience, however.  Simply setting the sysctl parameter
<tt>vm/overcommit_memory</tt> to <tt>2</tt> turns off the overcommit
behavior and keeps the OOM killer forever at bay.  Most modern systems
should have enough disk space to provide an ample swap file for most
situations.  Rather than trying to keep pet processes from being killed
when overcommitted memory runs out, it might be easier just to avoid the
situation altogether.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Memory_management-Out-of-memory_handling">Memory management/Out-of-memory handling</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#OOM_killer">OOM killer</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/104179/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor104408"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Embrace the OOM killer!</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2004 2:35 UTC (Thu)
                               by <b>dank</b> (guest, #1865)
                              [<a href="/Articles/104408/">Link</a>] 
      </p>
      
      </div>
      </summary>
      At my last job, it turned out after much experimentation that the best<br>
way to handle OOM conditions in our embedded system was to panic and <br>
halt the system, and alert the developers that their application software <br>
had misbehaved.<br>
<p>
'Course, you can't do that on a regular PC, where the user might<br>
get a bit ticked off :-)<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/104408/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor104441"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2004 9:20 UTC (Thu)
                               by <b>rjw</b> (guest, #10415)
                              [<a href="/Articles/104441/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      Could you also post a link to the message in an archive rather than just a bare mail? I have always found this to be an annoying feature of LWN - sometimes it is very useful to see the mail in context, and read the thread.<br>
<p>
Especially when it is a Hans Reiser classic, I like to see what caused it ;-)   <br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/104441/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor104523"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Archive links</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2004 13:51 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/104523/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      That is a pretty common request.  If I had an automated way of making archive links, I would be glad to.  I really don't have the time to go digging through archive site pages trying to fish particular messages out of the discussions, though.      Anything which slows down the writing of the kernel page can only result in less content there...  I continue to ponder on how this could be done, however.
      
          <div class="CommentReplyButton">
            <form action="/Articles/104523/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor104540"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Archive links</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2004 14:39 UTC (Thu)
                               by <b>southey</b> (guest, #9466)
                              [<a href="/Articles/104540/">Link</a>] 
      </p>
      
      </div>
      </summary>
      How about just adding a Google Groups search on the email subject and <br>
perhaps author or identifier?  <br>
 <br>
Usually it provides a link to the message in the thread and visiting that <br>
message has a link to the full thread (30 messages). <br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/104540/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor104554"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Archive links</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2004 16:21 UTC (Thu)
                               by <b>cgray4</b> (guest, #11599)
                              [<a href="/Articles/104554/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I suppose if you used <a href="http://gmane.org">gmane</a> to read your mailing lists, then you could link to the article in the gmane web interface pretty easily.  
      
          <div class="CommentReplyButton">
            <form action="/Articles/104554/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor104457"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2004 11:18 UTC (Thu)
                               by <b>copsewood</b> (subscriber, #199)
                              [<a href="/Articles/104457/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      I think in most situations it would make sense for the kernel to extend swap space by creating swap files on any filesystem with free space to which it has write access. OK, there will be marginal cases where there is overcommitted memory and insufficient free disk space to prevent serious thrashing due to the reducing free disk space this approach causes. However, system admins who want a more reliably-performing system have long known that they need to provide adequate memory and disk resources in any case. Why not have swap space dynamically extensible in this manner ?<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/104457/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor104508"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2004 12:54 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/104508/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      This means that any malicious user without sufficiently vicious ulimits can exhaust not just memory but disk space as well, even on disks he can't write to.<br>
<p>
Is this entirely wise?<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/104508/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor104522"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2004 13:39 UTC (Thu)
                               by <b>fergal</b> (guest, #602)
                              [<a href="/Articles/104522/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Right now, such a user would cause random processes to be killed, which is arguably worse. Well written programs can gracefully handle a lack of disk space, they cannot gracefully handle being killed by the OOM killer.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/104522/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor104550"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2004 15:32 UTC (Thu)
                               by <b>hppnq</b> (guest, #14462)
                              [<a href="/Articles/104550/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <blockquote><em>However, system admins who want a more reliably-performing system have long known that they need to provide adequate memory and disk resources in any case.</em></blockquote>
<p>
And that they should forbid overcommitting memory. ;-)
      
          <div class="CommentReplyButton">
            <form action="/Articles/104550/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor104867"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 2, 2004 20:35 UTC (Sat)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/104867/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <i>
<blockquote>
<blockquote>
However, system admins who want a more reliably-performing system have long known that they need to provide adequate memory and disk resources in any case.
</blockquote>
And that they should forbid overcommitting memory. ;-)
</blockquote>
</i>

<p>Does forbidding overcommitting memory make a more reliably performing system?  When you forbid overcommitting memory, all you do is make a different process fail at a different time.  A process that's minding its own business, using a small amount of memory and doing something very important fails when its fork() gets "out of memory."  And this happens even though there's only a 1% chance that letting the fork() go through would lead to trouble.  And it happens to dozens of applications while one broken application sucks up all the virtual memory resources.

<p>But in the overcommiting case, the program would work fine and 1% of the time some other process which is likely to be doing something unimportant and/or likely to be the cause of the memory shortage dies.

<p>I think you could say the overcommitting system is performing more reliably.

      
          <div class="CommentReplyButton">
            <form action="/Articles/104867/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor104970"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2004 17:22 UTC (Mon)
                               by <b>jzbiciak</b> (guest, #5246)
                              [<a href="/Articles/104970/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      ...and both are broken.<br>
<p>
But, just like my car, which currently idles rough, has an exhaust leak, and the "service engine" light's on, it still gets me to and from work.<br>
<p>
The difference is in the failure mode.  Do you degrade gracefully, or do you start to blow up at the first sign of error?  If you're a user, you probably want graceful degradation--you can tolerate some excessive swapping to a point, and if it gets too bad, you reboot.  At least OOo didn't implode taking your document with it.  If you're a developer, you probably want to know ASAP something's wrong so you can fix it.<br>
<p>
Thankfully, my car still runs (albeit not entirely happily), rather than flashing "service engine" and shutting down.<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/104970/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor105059"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2004 3:50 UTC (Tue)
                               by <b>mbp</b> (subscriber, #2737)
                              [<a href="/Articles/105059/">Link</a>] 
      </p>
      
      </div>
      </summary>
      OK, graceful degradation is nice.  But it's hard to tell whether overcommit helps or hurts.<br>
<p>
Even car designers have this problem: some modern cars will refuse to start if the engine is getting into a state where there is a chance of permanent damage.  If it's approaching zero oil pressure, I think I would rather have an electronic cutout than an engine seizure.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/105059/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor105359"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 6, 2004 15:51 UTC (Wed)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/105359/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>If you're a user, you probably want graceful degradation--you can tolerate some excessive swapping to a point, and if it gets too bad, you reboot.  At least OOo didn't implode taking your document with it. 
</blockquote>
<p>
True, but that's not an option with either of the cases being discussed -- overcommit or no overcommit.  This choice comes into play only when there's no place left to swap to.
<p>
The no-overcommit case <em>can</em> cause OOo to fail more gracefully.  If OOo is written to tolerate a failed fork (et al) and give you the chance to kill some other process and then save your document, then no-overcommit could be a good thing for OOo.  

<p>On the other hand, if you don't have the technical skills to find the right process to kill, you're going to have to reboot anyway and lose your document.  By contrast, with overcommit, you probably wouldn't have lost the document.  Either there never would have been a crisis in the first place, or the OOM killer would have killed some other process and let OOo continue normally.

      
          <div class="CommentReplyButton">
            <form action="/Articles/105359/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor105839"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 8, 2004 20:05 UTC (Fri)
                               by <b>tmcguire</b> (guest, #25295)
                              [<a href="/Articles/105839/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      You know, back in the old days when I was working with AIX (3.2.5, if that means anything to you), it had the policy of overcommitting memory and then randomly killing processes when it discovered that it was out.<br>
<p>
Of course, the process that it seemed to kill first was always inetd, which made the system completely useless and didn't take up much resources anyway.    So AIX had to go on and kill other stuff, too.<br>
<p>
And naturally system calls like sbrk would never fail, so no application had any opportunity to gracefully handle any problems.  But then, no developer ever had the interest or the incentive to actually handle errors, so the situation was nicely symmetrical.<br>
<p>
One of the programs best known for allocating memory and then not using it (in large amounts) was the X server, so turning off overallocation wasn't really an option.  Fixing *that* bug probably wasn't an option either.<br>
<p>
It's always nice to see modern systems learning from their elders, so to speak.  But if Linux is going to repeat previous mistakes, it really should go all the way.  It's much more fun.  Or has someone introduced SIGDANGER*, and I've just missed the memo?<br>
<p>
* The SIGDANGER signal was sent to all processes just before the OOM killer started to work.  Theoretically, a process handling SIGDANGER could reduce its memory allocation.  If it had time.  And, if the programmer wanted to.  The inetd maintainers apparently didn't.  Or, a process could have a handler for SIGDANGER and then just ignore it---the OOM killer would skip any process that handled SIGDANGER.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/105839/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor854641"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2021 18:31 UTC (Tue)
                               by <b>hendrikboom3</b> (guest, #151927)
                              [<a href="/Articles/854641/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For some users, the SIGDANGER signals could be useful to launch a process informing them that things are filling up and asking the if there are any processes they would like to terminate.<br>
<p>
If I were to get such a polite message, I&#x27;d open an xterm and kill firefox-esr (the most common culprit), which will usually restore its windows and tabs gracefully when I restart it after the crisis is over.<br>
<p>
-- hendrik<br>
 <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/854641/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor854681"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2021 23:47 UTC (Tue)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/854681/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sometimes I forget to contain my builds (yay C++ templates) in a systemd unit with lower memory limits and I&#x27;d like the notice to go and kill it rather than it killing my entire tmux session (since it&#x27;s in the same slice/process group).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/854681/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor854805"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 28, 2021 21:24 UTC (Wed)
                               by <b>MrWim</b> (subscriber, #47432)
                              [<a href="/Articles/854805/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I have a bash alias for make and ninja to run them via systemd-run. It also sends a desktop notification when they complete. It works well.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/854805/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor104598"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2004 18:17 UTC (Thu)
                               by <b>mongre26</b> (guest, #4224)
                              [<a href="/Articles/104598/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      Extending swap dynamically has performance issues I would rather avoid. <br>
<p>
First you would have to move from a disk partition swap to a disk file swap. That hurts you because you are reading and writing not from a custom swap file system but a file simulating a swap file system placed on a regular file system. That means your file systems ability to handle swap like files will impact swap performance. <br>
<p>
Also when a swap file changes size it has to re-organize itself somehwat. This an hurt performance while the swap is resizing. If the swap resizes too much you waste a lot of disk activity unecessarily. <br>
<p>
Microsoft does dynamic swap allocation, and I think it is one of the weaknesses of the OS. For performance reasons I lock my swap file to a specific min and max so it does not do this on my gaming system. <br>
<p>
In all cases I simply allocate sufficient swap to handle all my RAM and then some, often 4-8GB of swap. Since disks are massive these days committing 2-5% of the main disk for swap is not a problem. <br>
<p>
Just allocate enough swap at install time to accomodate your expectations. If you really find you need more swap add another disk and make another swap partition. Linux can use multiple swap partitions. You may even get a performance boost by load balancing swap across spindles.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/104598/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor104730"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2004 15:48 UTC (Fri)
                               by <b>Luyseyal</b> (guest, #15693)
                              [<a href="/Articles/104730/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <i>First you would have to move from a disk partition swap to a disk file swap. That hurts you because you are reading and writing not from a custom swap file system but a file simulating a swap file system placed on a regular file system. That means your file systems ability to handle swap like files will impact swap performance.</i>

<p>Actually, this is not true anymore. On recent kernels (2.4+) swap file performance is exactly the same as swap partition performance because the kernel bypasses the filesystem layer (I believe it relies on the magic of 'dd' creating files without holes). The only annoying thing with swap files is if you have a large one, it takes awhile to initialize on boot.

<p><i>Also when a swap file changes size it has to re-organize itself somehwat. This an hurt performance while the swap is resizing. If the swap resizes too much you waste a lot of disk activity unecessarily.</i>

<p>This is true. If you're going to allow overcommit, disallow OOM, and allow the kernel to create new swap files on the fly, it would probably be best done in its own subdirectory using a number of smaller swap files as adding a new swap is probably cheaper than resizing an existing one.

<p>As an aside, I recently converted a swap partition to a swap file on a dedicated ext2 partition so I could use e2label to make swap still work in case of SCSI name reordering. Since performance is identical -- except the longer boot time -- it was worth it.

<p>Cheers!
<br>-l

      
          <div class="CommentReplyButton">
            <form action="/Articles/104730/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor105700"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 7, 2004 23:29 UTC (Thu)
                               by <b>nobrowser</b> (guest, #21196)
                              [<a href="/Articles/105700/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; it would probably be best done in its own subdirectory using </font><br>
<font class="QuotedText">&gt; a number of smaller swap files as adding a new swap is probably </font><br>
<font class="QuotedText">&gt; cheaper than resizing an existing one.</font><br>
<p>
It already exists.  Look for swapd in the ibiblio archive.<br>
The response was completely underwhelming when it was young (long ago),<br>
and I don't see why that should have changed.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/105700/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor104866"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 2, 2004 20:21 UTC (Sat)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/104866/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p><i>In all cases I simply allocate sufficient swap to handle all my RAM and then some,
</i>
<p>
If by RAM you mean physical memory, as most people do, swapping doesn't handle RAM -- it handles virtual memory.  So the correct calculation isn't amount of RAM plus something, it's (roughly) amount of virtual memory minus amount of RAM.  And there's no practical way to put a limit on the amount of virtual memory.  The best you can do normally is watch your swap space and when you see it approaching full, add more.

<p><i>Just allocate enough swap at install time to accomodate your expectations.</i>

<p>I agree that is the policy for which Linux is designed.  The OOM killer is specifically to handle the pathological case that your expectations are exceeded.  That's always a possibility.  Consider program bugs.  

<p>The question of what to do when, despite the sysadmin's best intentions, the system runs out of virtual memory resources, is a difficult one; the various approaches (kill the system, kill some memory-using process, fail any attempt to get more virtual memory, make new swap space, etc.) all have their advantages and disadvantages.

      
          <div class="CommentReplyButton">
            <form action="/Articles/104866/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor104538"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A limit on overcommit?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 30, 2004 15:16 UTC (Thu)
                               by <b>aashenfe</b> (guest, #12212)
                              [<a href="/Articles/104538/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Is there a limit on the overcommit?  For instance the kernel will only commit a percentage of available memory (swap + ram).  For instance 150% would allow allowcated memory to grow to 1 and a half time the total available memory?<br>
<p>
If their is, is their a tunable parameter?<br>
<p>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/104538/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor104661"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A limit on overcommit?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 1, 2004 0:44 UTC (Fri)
                               by <b>ilmari</b> (guest, #14175)
                              [<a href="/Articles/104661/">Link</a>] 
      </p>
      
      </div>
      </summary>
      It is tunable, almost exactly as you suggest. Quoting Documentation/vm/overcommit-accounting:
<pre>
	[S]trict overcommit. The total address space commit
	for the system is not permitted to exceed swap + a
	 configurable percentage (default is 50) of physical RAM.
	Depending on the percentage you use, in most situations
	this means a process will not be killed while accessing
	pages but will receive errors on memory allocation as
	appropriate.

    The overcommit policy is set via the sysctl `vm.overcommit_memory'.

    The overcommit percentage is set via `vm.overcommit_ratio'.
</pre>

      
          <div class="CommentReplyButton">
            <form action="/Articles/104661/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor105060"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2004 4:12 UTC (Tue)
                               by <b>mbp</b> (subscriber, #2737)
                              [<a href="/Articles/105060/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Turning off overcommit will cause the process that tried to allocate the last page to fail.  This was considered for the OOM killer earlier on, and rejected as an insufficient solution: it may happen that the unlucky process is the most important one on the system.<br>
<p>
If I remember correctly, it can be theoretically demonstrated that it is impossible to avoid exhaustion unless all resource requirements are known in advance.  That is to say, the kernel always needs to handle the possibility of being unable to complete all the operations that are underway.  There are various responses: panicing, killing various tasks, failing operations, etc, but there is no perfect solution.<br>
<p>
If you want to avoid exhaustion, then turn off overcommit and design critical applications to avoid resource exhaustion: they must allocate or reserve everything up front, and handle failure gracefully.  It may be hard to design general-purpose machines to do that, but it might be done in an embedded machine.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/105060/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor105507"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 7, 2004 8:10 UTC (Thu)
                               by <b>oever</b> (guest, #987)
                              [<a href="/Articles/105507/">Link</a>] 
      </p>
      
      </div>
      </summary>
      This seems like a robust approach. Unfortunately, it requires all vital <br>
programs to be adapted to allocate memory in advance. It would be nice to <br>
be able to allocate an amount of memory for vital processes that cannot <br>
be taken by other programs without needing to change the code. <br>
 <br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/105507/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor583318"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2014 6:15 UTC (Thu)
                               by <b>CameronNemo</b> (guest, #94700)
                              [<a href="/Articles/583318/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You can specify in Upstart jobs to leave a service alone by adding the statement `oom score never`. There are more fine grained tuning values as well (-999 to 1000). Check it out here: <a rel="nofollow" href="http://upstart.ubuntu.com/cookbook/#oom-score">http://upstart.ubuntu.com/cookbook/#oom-score</a><br>
<p>
It would be cool to have that in systemd.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/583318/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor583319"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2014 6:34 UTC (Thu)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/583319/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<a href="http://www.freedesktop.org/software/systemd/man/systemd.exec.html#OOMScoreAdjust=">http://www.freedesktop.org/software/systemd/man/systemd.e...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/583319/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor583320"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2014 6:43 UTC (Thu)
                               by <b>CameronNemo</b> (guest, #94700)
                              [<a href="/Articles/583320/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I was looking in systemd.service (specifically). My fault for skimm/pping the description.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/583320/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor583329"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Respite from the OOM killer</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2014 8:11 UTC (Thu)
                               by <b>cortana</b> (subscriber, #24596)
                              [<a href="/Articles/583329/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
FYI, systemd.directives is a master index of everything you can do to a unit, so if you are unsure whether a feature exists, you can look there first..<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/583329/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2004, Eklektix, Inc.<BR>
            
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
