        <!DOCTYPE html>
        <html lang="en">
        <head><title>The AppArmor debate begins [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/181508/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/180775/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/181508/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>The AppArmor debate begins</h1>
<div class="Byline">[Posted April 26, 2006 by corbet]
               <p>
               </div>
</div>
<div class="ArticleText">
Novell <a href="http://lwn.net/Articles/166975/">announced</a> the release
of the AppArmor security module last January.  Then everything went quiet;
in particular, no attempt was made to get the AppArmor code merged into the
mainline kernel.  The silence was broken last week, however, as a result of
<a href="http://lwn.net/Articles/180194/">the discussion on the possible
removal of the Linux security module (LSM) API</a>.  The submission of the
AppArmor code has had the desired short-term effect: the discussion has
moved away from removal of the LSM interface and toward the merits of
AppArmor.  The AppArmor developers may not see that shift as a blessing at
the moment, however.
<p>

As expected, AppArmor has taken a fair amount of criticism.  The largest
complaint is the fact that AppArmor uses pathnames for its security
policies.  Using AppArmor, a system administrator can provide a list of
files accessible by a given application; anything not on the list becomes
inaccessible.  Other things - such as capabilities - are also configurable,
but there is no controversy over that aspect of the system.  It is the use
of path names which raises the red flags.
<p>

The sticking point is that a given file name is not the file itself.  So,
while <tt>/etc/shadow</tt> might identify the shadow password file, that
<i>name</i> is not the shadow password file.  If an attacker is able to
create another name for that file (through the use of links or namespaces,
perhaps), that other name could become a way for the attacker to access the
shadow password file.  So, even if AppArmor forbids access to
<tt>/etc/shadow</tt> for a given application, that application might still
have access to other pathnames which could be made to refer to the same
file.
<p>

AppArmor thus differs from the SELinux approach, which attaches labels to
objects and enforces access control rules based on the labels.  With
SELinux, the shadow password file has the same label (and, thus, the same
access rules) regardless of the name by which it is accessed.  So SELinux
lacks a possible failure mode (rule bypass through different file names)
that exists in AppArmor.  Of course, as any
SELinux administrator knows, maintaining file labels in a consistent and
correct state poses challenges of its own.
<p>

The other problem with the AppArmor approach is that the LSM API is not
well suited to pathname-based security policies.  As a result, AppArmor
must often go through a fair amount of (potentially expensive) pain to
obtain the names corresponding to files.  The impedance mismatch between
AppArmor and LSM is not generally seen as a reason to keep AppArmor out of
the kernel, but it has led to suggestions that the AppArmor developers
should either extend LSM for pathname-based policies or just add their own
patches and drop LSM altogether.  If AppArmor gets past the other
objections, some work will almost certainly have to be done in this area.
<p>

At this point, how any decision will be made on merging AppArmor is far
from clear.  It has not escaped notice that some of the strongest criticism
of AppArmor is coming from the SELinux camp; SELinux developer Stephen
Smalley has <a href="/Articles/181515/">defended</a> that criticism this
way:
<p>
<div class="BigQuote">
	We're not threatened by alternatives.  We're concerned about a
	technically unsound approach.  The arguments being raised against
	pathname-based access control are about the soundness of that
	technical approach, not whether there should be any alternatives to
	SELinux.
</div>
<p>

The proponents of AppArmor claim that the approach is sound.  Unlike
SELinux, AppArmor does not attempt to be the ultimate security solution for
all situations.  Instead, it simply puts a lid on applications which might
be compromised by an attacker.  AppArmor raises the bar by limiting what a
broken application might do; it does not attempt to regulate the
interactions between every application and every object in the system.
This approach is, it is claimed, enough to significantly raise the security
of a system while maintaining an administrative interface which is
accessible to mere mortals.  And, for AppArmor's goals, a pathname-based
access control mechanism is said to be good enough.  It will probably be
some time before we will see whether the kernel development community
agrees with that claim.
<p>

(See also: <a
href="http://securityblog.org/brindle/2006/04/19/security-anti-pattern-path-based-access-control/">this
detailed criticism of pathname-based access control</a> by Joshua Brindle).<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#AppArmor">AppArmor</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-Security_technologies">Security/Security technologies</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/181508/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor181608"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 3:47 UTC (Thu)
                               by <b>jamesm</b> (guest, #2273)
                              [<a href="/Articles/181608/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      I'd like to address the idea AppArmor is simple for "mere mortals" to administer in comparison with SELinux, which I believe to be a myth.

In <a href="http://marc.theaimsgroup.com/?l=full-disclosure&m=114429157431167&w=2">this thread</a>, the creator of AppArmor admits that he doesn't understand the thunderbird policy on his own machine, and alarmingly, why it has setuid capability.

Quote:
<pre>
  > but as you posted an example profile with "capability setuid", I must
  > admit I am curious as to why an email client needs that.

  Well now that is a very good question, but it has nothing to do with
  AppArmor. The AppArmor learning mode just records the actions that the
  application performs. With or without AppArmor, the Thunderbird mail
  client is using cap_setuid. AppArmor gives you the opportunity to *deny*
  that capability, so you can try blocking it and find out. But for
  documentation on why Thunderbird needs it, you would have to look at
  mozilla.org not the AppArmor pages.
</pre>

As they add more policy coverage for things like IPC and networking, it will only become more complicated, but without the strong security assurance features of SELinux.

This also demonstrates the way the AppArmor tool encapsulates existing behavior, without any real design or understanding of the security implications of the policy being generated.

      
          <div class="CommentReplyButton">
            <form action="/Articles/181608/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181625"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 6:56 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/181625/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      This is the *point* of the learning system. The idea is that you run your target app in learning mode while it is *not* being attacked (which basically runs it with everything banned, but with the system set to log, not deny failed operations, and then analyzes the logfile). The resulting policy will only allow the target app to do what it did while you were running it in learning mode, which may include... unexpected things.<br>
<p>
If you want to know *why* those unexpected things are being done, you'll have to examine the app's source code: and oddly enough Crispin didn't want to do that for a monster like Thunderbird.<br>
<p>
This is (yet another place) where *exactly* the same criticism can be made of SELinux, except that of course because it doesn't have a learning mode you'll have to do the log analysis yourself.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181625/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181636"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 8:58 UTC (Thu)
                               by <b>james</b> (subscriber, #1325)
                              [<a href="/Articles/181636/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      audit2allow is a "learning mode" for SELinux -- it takes the audited failures and creates rules to allow them.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181636/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181733"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">audit2allow: more details</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 17:10 UTC (Thu)
                               by <b>bkoz</b> (guest, #4027)
                              [<a href="/Articles/181733/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <p>
Thanks.<br>
<p>
Huh. Interesting. This tool looks quite useful.<br>
<p>
I found more details here:<br>
<a href="http://www.samag.com/documents/s=9820/sam0508a/0508a.htm">http://www.samag.com/documents/s=9820/sam0508a/0508a.htm</a><br>
<p>
Is there other documentation about this? (Targeted at non-studly sys admin types such as myself?)<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181733/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181762"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">audit2allow: more details</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 19:36 UTC (Thu)
                               by <b>jamesm</b> (guest, #2273)
                              [<a href="/Articles/181762/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Try the SELinux wiki:
http://fedoraproject.org/wiki/SELinux

Dan Walsh's blog:
http://danwalsh.livejournal.com/

There's also a comprehensive book coming out, soon.

      
          <div class="CommentReplyButton">
            <form action="/Articles/181762/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor181672"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 13:10 UTC (Thu)
                               by <b>jamesm</b> (guest, #2273)
                              [<a href="/Articles/181672/">Link</a>] 
      </p>
      
      </div>
      </summary>
      The exact same criticism cannot be made, as this is not the primary way that policy is developed under SELinux (it comes with the apps).  You can use audit2allow, but I would not recommend it as anything but an adjunct to designing policy and then only if you understand what it's doing.  (I know that it's mentioned in a lot of the online documentation -- possibly without enough caveats).

I was discussing something similar to a learning mode for SELinux with another developer last year at OLS, and it can definitely be done, say, with per-process permissive mode.  I don't think it's the right approach alone, but could be useful when used by a trained policy developer with some other features such as static analysis of the source code, peeking inside RPMs etc.

There are tools now being developed for SELinux which operate at a higher level, with a wizard-like interface which allows security goals to be defined by the user, from which a security policy is generated.

      
          <div class="CommentReplyButton">
            <form action="/Articles/181672/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor182002"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 1, 2006 16:04 UTC (Mon)
                               by <b>Method</b> (guest, #26150)
                              [<a href="/Articles/182002/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Congratulations, you identified the precise problem with this type of system. For comparison the SELinux Thunderbird policy *does not* include this capability, proof positive that iterative active policy development will yeild higher quality policies than 'status quo encapsulation'. If thunderbird functions properly without this permission then it should not be there.<br>
<p>
See <a rel="nofollow" href="http://securityblog.org/brindle/2006/03/25/security-anti-pattern-status-quo-encapsulation/">http://securityblog.org/brindle/2006/03/25/security-anti-...</a><br>
for more commentary on that sort of policy development.<br>
<p>
The point mentioned in your post about using learning mode while the app is not being attacked is talked about in the above article but I'll refute it here incase people don't want to read it. Once your system is active (eg., thunderbird is fetching mail from your server) it is no longer in a known good state, you have no idea if it is being attacked or otherwise compromised. The fact that blindly writing policies in this manner can actually create channels for the attackers to operate on after the policy is active is disturbing and IMHO a very compelling argument against this type of behavior.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/182002/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor181640"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 10:19 UTC (Thu)
                               by <b>jschrod</b> (subscriber, #1646)
                              [<a href="/Articles/181640/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      It would help to get your critique in context to know if you're an independent observer or if you're working on SElinux.<br>
<p>
Your past comments about SElinux, in previous stories on lwn.net, showed that you are very familiar with that topic. You brushed away several times the criticue of SElinux's complexity. So, how involved are you in SELinux? (That's not to say that your critic is invalid. It is about the expectation if you will represent both sides or one side of the discussion, with your arguments.)<br>
<p>
For the record, I'm involved in neither SELinux nor AppArmor, but try to follow the developments.<br>
<p>
Joachim<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181640/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181671"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 12:58 UTC (Thu)
                               by <b>jamesm</b> (guest, #2273)
                              [<a href="/Articles/181671/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I'm James Morris and a long time SELiunx developer (I thought that was well known).
      
          <div class="CommentReplyButton">
            <form action="/Articles/181671/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor181752"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 18:24 UTC (Thu)
                               by <b>wcooley</b> (guest, #1233)
                              [<a href="/Articles/181752/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      It's a little bit disingeneous to call Crispin the "creator" of AppArmor.  Crispin writes papers, not code (I've heard him say as much myself when I worked at WireX [the company's name before Immunix and the Novell purchase]).  He's a PhD theorist, not a programmer, and he tends to not get mired in details--so it would come as no surprise that he doesn't understand the Thunderbird profile on his machine.<br>
<p>
Yes, he led the development of the higher-level aspects of AppArmor and wrote papers and secured funding, but most of the actual implementation details were handled by Greg Kroah-Hartman, Chris Wright, Steve Beattie, Seth Arnold and Jesse Michael (maybe others now too).<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181752/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181764"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 19:46 UTC (Thu)
                               by <b>jamesm</b> (guest, #2273)
                              [<a href="/Articles/181764/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Well, that's never been my impression, and doesn't seem to match the way he describes himself.<br>
<p>
"developed the StackGuard C compiler buffer overflow defensev and the AppArmor application security system. He lead the effort to build the LSM (Linux Security Modules) feature into Linux 2.6,"<br>
<p>
<a href="http://www.linuxworldexpo.com/live/12/events/12BOS06A/conference/bio//CMONYA00BFPX">http://www.linuxworldexpo.com/live/12/events/12BOS06A/con...</a><br>
<p>
"Architect of the AppArmor Project"<br>
<p>
<a href="http://www.fosdem.org/index/speakers/speakers_cowan">http://www.fosdem.org/index/speakers/speakers_cowan</a><br>
<p>
"Crispin Cowan is the chief architect of SubDomain, and CTO at WireX Communications."<br>
<p>
<a href="http://www.seifried.org/security/products/20010912-immunixos-7.html">http://www.seifried.org/security/products/20010912-immuni...</a><br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181764/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor181620"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 6:39 UTC (Thu)
                               by <b>drag</b> (guest, #31333)
                              [<a href="/Articles/181620/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      I don't understand how this is a problem with AppArmor. <br>
<p>
It would be a definate problem for SELinux, but it looks like AppArmor and SELinux are doing different things.<br>
<p>
Apparmor is for creating a sort of hardenned 'shell' around a application, right? So by default it has 'DENY ALL' type setting. Then you allow access to this or that file, right?<br>
<p>
So if you want to deny access to /etc/shadow, you simply do not allow access to it. It's denied by default.<br>
<p>
So if a attacker figured out how to make shadow appear as /etc/toffu  or /tmp/taco to the application or whatever then it still doesn't matter. AppArmor would not allow access to that either; it's denied by default.<br>
<p>
A attacker would have to figure out a way to make the file appear as a file you specificly allowed the application access to, right? What is the likelihood of that? In what possible way would a attacker make your shadow file or any other file appear as a library file or maybe a .config file in your home directory while working in a environment everything is set to 'deny all' by default.<br>
<p>
The problem is only a you have the default setup of 'access everything', then you try to deny this or that file. Which seems a realy crappy way of doing things. <br>
<p>
At least that's how I see it. Is is possible that I am confused about what is going on (which is likely)?<br>
<p>
And if AppArmor dies and everybody ends up using SELinux then would it be possible in the selinux framework for me to do what AppArmor does? <br>
<p>
I want to make a profile for each and every desktop application that interacts with anything on the network. I want to make a profile for Firefox, Evolution, my IRC client, GAIM, and my RSS reader. This is because my time is important and I only care about hardenning applications that are likely vectors of attack for my day to day activities on the desktop.<br>
<p>
Now what is the best way to do that, to do what Apparmor does fairly easily right now, in SELinux?<br>
<p>
To me it's always seemed that SELinux is for situations were you have a experianced administrator that wants to setup MAC for a server or whatnot.<br>
<p>
AppArmor seems more like a application-level firewall, to block applications from behaving badly and accessing information  or writing fradulent information that they shouldn't.<br>
<p>
It doesn't seem that one is suited to do what the other does...<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181620/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181666"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 12:02 UTC (Thu)
                               by <b>jamesh</b> (guest, #1159)
                              [<a href="/Articles/181666/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      For some applications you might be able to restrict them enough for this to be true, but many apps will need fairly liberal policies.<br>
<p>
Consider a text editor for example.  The user expects to be able to edit files all over the system, so even if there is a final "deny all" rule, there will be many paths that the policy needs to allow.  Each of these paths is a potential attack vector (assuming that they manage to create the hardlink or bind mount).<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181666/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor182059"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 1, 2006 18:56 UTC (Mon)
                               by <b>perbu</b> (guest, #14372)
                              [<a href="/Articles/182059/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I would think text editors are not the primary target of Apparmor. Talks and demos given seem to indicate that their focus seems to be on network-enabled services, such as Apache, Tomcat, PostgreSQL and lots of closed-source services. <br>
<p>
I've been working as a sysadmin for 8 years and I must say I welcome Apparmor with open arms. It seems to be dead simple to set up - and you can do so without to much knowledge of the application you are trying to secure. It does not try to secure every aspect of every application - they seem to rule out support for complex beasts as shared memory because it would make the configuration process to complex - which I think is a good thing.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/182059/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor181704"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 15:16 UTC (Thu)
                               by <b>vmole</b> (guest, #111)
                              [<a href="/Articles/181704/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <p>Lots of applications need temporary files with unpredictable names. For these, your AppArmor profile will have something like "/tmp/*" allowed. Or consider a mail reader, that might allow access to "/var/mail/**" (AA designation for all subdirs of "/var/mail", IIRC). Or, consider one that was pointed out on the LKML: The bind9 profile was "/**", i.e. everything, under the assumption that it would be running chroot("/var/named"), but there's no way for AA to enforce that expectation.

<p> Another thing to realize is that a lot of the objections are to AA using paths <i>in the kernel</i>. This leads to AA trying to convert dentry values to paths, which is both expensive and unreliable.
      
          <div class="CommentReplyButton">
            <form action="/Articles/181704/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181824"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 28, 2006 5:49 UTC (Fri)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/181824/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      note that AppArmor is planning to make all paths be absolute paths, so if you chroot bind in /bind then it's profile would be /bind/** to close this exact vunerability.<br>
<p>
don't mistake a weakness in the current implementation with a fundamental flaw in the design<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181824/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181890"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 28, 2006 17:28 UTC (Fri)
                               by <b>MenTaLguY</b> (guest, #21879)
                              [<a href="/Articles/181890/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Since Linux supports per-process namespaces, there ARE no globally absolute paths.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181890/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor182440"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 4, 2006 9:13 UTC (Thu)
                               by <b>renox</b> (guest, #23785)
                              [<a href="/Articles/182440/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      I disagree: the kernel has to do the translation so it has 'absolute' paths.<br>
<p>
That each process can have a different view doesn't imply that there is no absolute path.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/182440/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor182518"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The AppArmor debate begins</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 4, 2006 16:58 UTC (Thu)
                               by <b>MenTaLguY</b> (guest, #21879)
                              [<a href="/Articles/182518/">Link</a>] 
      </p>
      
      </div>
      </summary>
      No, it doesn't.  As I recall (it's been a long time since I've messed with filesystem stuff), each namespace can have its own root dentry, and dentries are mostly used used for looking up inodes by their path within a particular namespace.<br>
<p>
There is no real "absolute" path to a file because the kernel doesn't need it.  Most interesting things happen at the filesystem/inode level.<br>
<p>
(One of the reasons that people object to AppArmor is that it'd require pushing a lot of things up into dentry-land, when the whole system was designed around inodes.)<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/182518/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor181629"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">turn the /etc/shadow argument on it's head</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 7:48 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/181629/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      if AppArmor won't protect you if you manage to create a new name for the file /etc/shadow, SELinux (which doesn't care about filenames, only the files themselves) won't protect you if you manage to change the name /etc/shadow to point at a new file.<br>
<p>
you know what? every other program in the system will try to access whatever file /etc/shadow is pointing at, they won't care about the object that used to be called /etc/shadow that SELinux is still protecting, they'll happily use the new file<br>
<p>
any way that you mark all things that access /etc/shadow to only access the 'true' /etc/shadow file requires active work to maintain over time (every program that modifies it, including vi/emacs, will need to set the correct SELinux label, and if any of them get it wrong, the whole system stops)<br>
<p>
while AppArmor doesn't try to do everything that SELinux attempts to do, in some ways it's far more useful.<br>
<p>
David Lang<br>
<p>
P.S. I still haven<br>
t seen an example of how to set and maintain permissions along the lines of /home/*/public_html/* to pull an example the AA people have used to show the power of the path based approach<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181629/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181720"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">turn the /etc/shadow argument on it's head</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 15:59 UTC (Thu)
                               by <b>JoeBuck</b> (subscriber, #2330)
                              [<a href="/Articles/181720/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      I know only a little about SELinux, but I believe that you are incorrect.  Programs that use /etc/shadow for password authorization can check the security label; if it is not set to the proper value, authorization can be made to fail.  So if you manage to make /etc/shadow point to a new file, you only achieve denial-of-service: no one can log in.
<p>
But even if this check is not made, ordinary users can make a hard link to /etc/shadow if they have write access to a directory in the same filesystem as /etc.  Ordinary users cannot make /etc/shadow point to a different file unless they have already cracked root.  So you haven't quite turned the argument on its head: it is easier to add new names than to change what a name refers to.

      
          <div class="CommentReplyButton">
            <form action="/Articles/181720/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181825"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">turn the /etc/shadow argument on it's head</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 28, 2006 6:01 UTC (Fri)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/181825/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      and AppArmor only allows you to create a link to a file if you have permission to modify the file itself so creating a new name isn't as trivial<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181825/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor182487"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">turn the /etc/shadow argument on it's head</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 4, 2006 14:48 UTC (Thu)
                               by <b>anLWNreader</b> (guest, #36915)
                              [<a href="/Articles/182487/">Link</a>] 
      </p>
      
      </div>
      </summary>
      That would break POSIX. I hope AppArmor doesn't do that.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/182487/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor181719"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Raising the Bar</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 27, 2006 16:00 UTC (Thu)
                               by <b>Baylink</b> (guest, #755)
                              [<a href="/Articles/181719/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <blockquote><P>The proponents of AppArmor claim that the approach is sound. Unlike SELinux, AppArmor does not attempt to be the ultimate security solution for all situations. Instead, it simply puts a lid on applications which might be compromised by an attacker. AppArmor raises the bar by limiting what a broken application might do; it does not attempt to regulate the interactions between every application and every object in the system. This approach is, it is claimed, enough to significantly raise the security of a system while maintaining an administrative interface which is accessible to mere mortals. And, for AppArmor's goals, a pathname-based access control mechanism is said to be good enough. It will probably be some time before we will see whether the kernel development community agrees with that claim.</blockquote>
<P>
My personal opinion on this is that if you create a security system that makes things only a little harder, then crackers will work a little harder.
<P>
If you're going to provide new security facilities, and you have a choice between ones which have a fairly clear path to get around, and ones which will be substantially harder to break (at, perhaps, the expense of being substantially harder to configure), you go deep.  Not doing so penalizes the smart people in favor of the dumb ones -- just because <b>I</b> don't know how to configure SELinux doesn't mean I can't find someone who <b>does</b> ... but if it's not <i>there</i>, it doesn't <i>matter</i> whether I can do it myself <i>or</i> find help, does it?
      
          <div class="CommentReplyButton">
            <form action="/Articles/181719/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181826"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Raising the Bar</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 28, 2006 6:03 UTC (Fri)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/181826/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      nobody is suggesting that SELinux should not be available if you want it. however some people are arguing that since AppArmor isn't perfect security it shouldn't be an option for anyone to use.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181826/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor181851"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Raising the Bar</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 28, 2006 13:08 UTC (Fri)
                               by <b>jamesm</b> (guest, #2273)
                              [<a href="/Articles/181851/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Just to be clear (seeing as I'm an SELinux developer and involved in the debate) -- this is not my position, rather, whether the mechanism used by AppArmor is suitable for merging with the mainline kernel.<br>
<p>
Of course, people are free to do whatever they want with Linux, but it doesn't mean every idea belongs in the mainline kernel.  There are a couple of paths to investigate to fix the problems with AppArmor, which have been discussed.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/181851/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor182516"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SELinux shortcomings</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 4, 2006 16:56 UTC (Thu)
                               by <b>alogghe</b> (subscriber, #6661)
                              [<a href="/Articles/182516/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      As I understand it- <br>
<p>
You can't secure a mounted nfs share with SELinux because it can't apply its labels (and I wonder which other filesystem types that wouldn't work either).<br>
<p>
AppArmor would allow you to secure (to the level apparmor does) pretty much any path in the system and so you can secure an nfs/smb/anything mount.<br>
<p>
For me this is pretty critical in making a choice of security systems. <br>
<p>
Attention captain obvious- nfs security shortcomings are offtopic in replies ;) .<br>
<p>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/182516/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor182596"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SELinux shortcomings</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 5, 2006 1:10 UTC (Fri)
                               by <b>sshimko</b> (guest, #37560)
                              [<a href="/Articles/182596/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      SELinux supports context based mounts so while it is not currently possible to label NFS files (although this has been explored) it is possible to label the entire mounted file system.<br>
<p>
So what you're saying is that you'd rather have security policy enforced across arbitrary mount points?  So if I mount a NFS share on /mnt, /media, and /home the security policy is completely different for each?  This doesn't sit well with me...<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/182596/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor182605"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SELinux shortcomings</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 5, 2006 5:13 UTC (Fri)
                               by <b>alogghe</b> (subscriber, #6661)
                              [<a href="/Articles/182605/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Yes we would need security enforced at different levels/files in the mount points and selinux would be too course grained (just on/off at the mount point itself).<br>
<p>
Network based filesystems provide a great deal of flexibility that we need here in the trenches ;)<br>
<p>
Heh it's funny how some of us see the different policy against the different pathname/same share as a useful feature and it makes other people paranoid. <br>
<p>
It's dangerous I agree but so is any powertool.<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/182605/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2006, Eklektix, Inc.<BR>
            
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
