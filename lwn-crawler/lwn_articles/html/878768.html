        <!DOCTYPE html>
        <html lang="en">
        <head><title>SA_IMMUTABLE and the hazards of messing with signals [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/878768/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/878857/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/878768/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>SA_IMMUTABLE and the hazards of messing with signals</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Benefits for LWN subscribers</b>
<p>
The primary benefit from <a href="/Promo/nst-nag5/subscribe">subscribing to LWN</a>
       is helping to keep us publishing, but, beyond that, subscribers get
       immediate access to all site content and access to a number of extra
       site features.  Please sign up today!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>December 17, 2021</br>
           </div>
There are some parts of the kernel where even the most experienced and
capable developers fear to tread; one of those is surely the code that
implements signals.  The nature of the signal API almost guarantees that
any implementation will be full of subtle interactions and complexities,
and the version in Linux doesn't disappoint.  So the inclusion of a
signal-handling change late in the 5.16 merge window might have been
expected to have the potential for difficulties; it didn't disappoint
either.
<p>
<h4>Forced signals</h4>
<p>
The signal API normally allows any process to control what happens on
receipt of a signal; that can include catching the signal,
masking it temporarily, or
blocking it outright.  There are a few exceptions, of course, including for
<tt>SIGKILL</tt>, which cannot be blocked or caught.  Within the kernel,
there is a more subtle exception wherein a process can be forced to take
a signal and exit regardless of any other arrangements that process may
have made. Most of 
these situations come about in response to hardware problems that cannot be
recovered from, but the signals sent by the <a
href="https://man7.org/linux/man-pages/man2/seccomp.2.html"><tt>seccomp()</tt></a>
mechanism are also forced in this way.  At times, a signal is so important
that it simply cannot be ignored.
<p>

The kernel has a function to force a signal in this way called <a
href="https://elixir.bootlin.com/linux/v5.15.8/source/kernel/signal.c#L1307"><tt>force_sig_info_to_task()</tt></a>.
It will unblock the intended signal if need be and deliver the signal to
the target process; it can also remove the process's handler for this
signal, resetting it to the default action (which is normally to kill the
process for the signals in question).  Interestingly, though, this 
function wasn't always 
being used in forced-signal situations; instead, the kernel would just kill
the target process and set its exit status to look like the signal had done
it.  In October, Eric Biederman sent out <a
href="/ml/linux-kernel/87y26nmwkb.fsf@disp2133/">a patch set</a> causing
the kernel to do what it was pretending to do and actually deliver the signal
rather than fake it.
<p>
This change works as intended — except for a small problem that
was <a
href="/ml/linux-kernel/b5d52d25-7bde-4030-a7b1-7c6f8ab90660@www.fastmail.com/">pointed
out</a> by Andy Lutomirski.  It seems that, in current
kernels, a call to <a
href="https://man7.org/linux/man-pages/man2/sigaction.2.html"><tt>sigaction()</tt></a>
in the target process can re-block a signal in the window between when
<tt>force_sig_info_to_task()</tt> unblocks it and the actual delivery of
that signal.  A call to <a
href="https://man7.org/linux/man-pages/man2/ptrace.2.html"><tt>ptrace()</tt></a>
can also race with forced signals in this way. 
This race can cause misbehavior at best; in some cases (such
as the delivery of a signal from <tt>seccomp()</tt>) it may be a security
problem.
<p>
Not wanting to introduce potential vulnerabilities, Biederman set out to
close this race; <a 
href="/ml/linux-kernel/87k0hvkgvj.fsf_-_@disp2133/">the solution</a> took
the form of 
a new flag (<tt>SA_IMMUTABLE</tt>) that can be applied to a process's
internal signal-handling information.  This flag is normally not set; if
that changes, then any subsequent attempts to change the handling of the
signal 
in question will fail with an <tt>EINVAL</tt> error.  The flag is hidden
from user space and can only be set by the kernel, and that only happens in
<tt>force_sig_info_to_task()</tt>.  There is no way to clear
<tt>SA_IMMUTABLE</tt> once it has been set; the assumption is that the process
is on its way out anyway.  This change fixes the race in question
and, since the flag is invisible to user space, there are no user-space ABI
concerns.  Or so it was thought.
<p>
This patch was posted on October 29, and <a
href="https://git.kernel.org/linus/5147da902e0dd">found its way into the
mainline</a> on November&nbsp;10 — near the end of the 5.16 merge window —
as part of a set of "exit cleanups".  Once the 5.16-rc1 kernel was released, the
patch was picked up by the stable series and appeared in <a
href="/ml/linux-kernel/163726325011777@kroah.com/">5.15.3</a> on
November&nbsp;18.
<p>
<h4>Debugger bugs</h4>
<p>
Unfortunately, the day before the 5.15.3 release, Kyle Huey <a
href="/ml/linux-kernel/CAP045AoMY4xf8aC_4QU_-j7obuEPYgTcnQQP3Yxk=2X90jtpjw@mail.gmail.com/">reported</a>
that the <tt>SA_IMMUTABLE</tt> change breaks debuggers.  It is common for
interactive debuggers to catch signals on behalf of the debugged process,
including some of the signals that are forced by the kernel (not all of
which are fatal).  With this
change, <tt>ptrace()</tt> is no longer able to change the handling of
<tt>SA_IMMUTABLE</tt> signals and, in fact, is no longer even notified of
them.  The patch,
Huey said, should be reverted.  It was nonetheless shipped in 5.15.3 the
next day.
<p>
After some discussion, it was concluded that the <tt>SA_IMMUTABLE</tt>
change was indeed overly broad; it blocked some legitimate signal-related
operations that were possible before.  Biederman <a
href="/ml/linux-kernel/87h7c9qg7p.fsf_-_@email.froward.int.ebiederm.org/">posted
a pair of patches</a> on the 18th to address the problems.  <a
href="https://git.kernel.org/linus/e349d945fac7">The first of those</a>
reflects the conclusion that not all signals forced by the kernel should
have the <tt>SA_IMMUTABLE</tt> flag set on them; instead, that should be
restricted to situations where the kernel intends for the target process to
exit.  That intent is communicated via a new parameter to
<tt>force_sig_info_to_task()</tt>; the call from within the
<tt>seccomp()</tt> subsystem is changed to indicate that intent.  The <a
href="https://git.kernel.org/linus/fcb116bc43c8">second patch</a> adds a
new function (<tt>force_exit_sig()</tt>) to be used in other places where a
forced exit is intended, and adds a number of callers.
<p>
It's worth noting that, in the forced-exit case, <tt>ptrace()</tt> is still
unable to trap the signal after these changes.  But that is no different from
the way things worked before all of these patches went in.  The previous
implementation, remember, bypassed the signal-delivery mechanism entirely,
so there was never any opportunity for a debugger to influence things.  The
kernel, as seen from user space, now behaves as it did before.

<p>
These patches appear to have fixed the problem; they were merged for
5.16-rc2, then found their way into <a
href="/ml/linux-kernel/163783193343224@kroah.com/">5.15.5</a> on
November&nbsp;25.  The regression caused by the original patch, in other
words, existed for a full week in the 5.15-stable kernel.  The rules state
that no patch should go into a stable kernel until after it has appeared in
a mainline -rc release.  That rule was followed in this case;
5.16-rc1 came out between the patch landing in the
mainline and it showing up in a stable update.  That same rule may have
delayed the inclusion of the fixes into the stable 5.15 releases; it could
not be considered until after 5.16-rc2 came out on November&nbsp;21.
<p>
The relevant question may well be: is the one-release rule enough to
prevent this kind of regression in the stable kernels?  That rule was added
in response to previous problems, and may well have prevented some bugs
from being backported, but some still clearly get through.  There is an
argument to be made that, for patches that reach into tricky subsystems like
signals, a more cautious approach to backporting would make sense.  In the
absence of the developer resources to make those decisions, though, the
current policy is unlikely to change and the occasional regression will
make a (hopefully brief) appearance in stable kernels.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-5.16">Releases/5.16</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-seccomp">Security/seccomp</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Signal_handling">Signal handling</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/878768/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor879090"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2021 8:10 UTC (Sat)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/879090/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What is actually needed here is not &quot;a more cautious approach to backporting&quot;, but automated tests of basic functionality, which are actually run on every &quot;stable&quot; kernel at least once before it is released, and whose failure blocks the release of that &quot;stable&quot; kernel.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879090/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879163"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2021 2:29 UTC (Mon)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/879163/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <p>How exactly would tests help? This is clear case of <a href="https://www.hyrumslaw.com/">Hyrum's Law</a>: feature which developers haven't designed, planned or even expected to work… yet which users discovered and started using.</p>

<p>Tests rarely (if ever!) help in cases like that. They only verify that aspects of the implementation which developers <b>know</b> about work.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/879163/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879166"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2021 5:00 UTC (Mon)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/879166/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Tests not only *could have* caught this regression, they *actually did*: rr has an extensive automated test suite which caught this regression (and has caught many other kernel regressions). There is no reason why kernel CI tests shouldn&#x27;t cover at least as much kernel functionality as rr&#x27;s tests --- they could even just run rr&#x27;s tests.<br>
<p>
As it happens, this isn&#x27;t Hyrum&#x27;s Law. Ptracers are supposed to be notified every time a signal is delivered to a tracee (other than SIGKILL). It&#x27;s clearly documented in the man page:<br>
<p>
<font class="QuotedText">&gt; While being traced, the tracee will stop each time a signal is delivered, even if the signal  is being ignored. (An exception is SIGKILL, which has its usual effect.)</font><br>
<p>
The changes here broke that guarantee.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879166/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879232"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 21, 2021 16:10 UTC (Tue)
                               by <b>walters</b> (subscriber, #7396)
                              [<a href="/Articles/879232/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Robert, I happen to agree with you overall.  However, I am doubtful that LWN comments are going to make someone just wake up tomorrow and try to gate kernel commits on rr&#x27;s test suite.<br>
<p>
What is more likely to work (I&#x27;d say) is directly getting in touch with one of the CI groups.  Maybe <a href="https://01.org/lkp/documentation/0-day/lkp-test-suites-description">https://01.org/lkp/documentation/0-day/lkp-test-suites-de...</a> ?<br>
<p>
Bear in mind that this type of &quot;reverse dependency testing&quot; also incurs a maintenance burden; for example, any flakes in the rr test suite suddenly become flakes that kernel maintainers need to deal with.  There&#x27;s questions of versioning (pin to rr commit or track git main), build system, etc.<br>
<p>
So if you&#x27;re serious about this then I think some effort on your side would need to happen both initially to drive it, then there&#x27;s an ongoing maintenance commitment.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879232/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879416"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 22, 2021 2:04 UTC (Wed)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/879416/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You&#x27;re right that there&#x27;s a certain amount of shouting into the wind on my part.<br>
<p>
<font class="QuotedText">&gt; I think some effort on your side would need to happen both initially to drive it then there&#x27;s an ongoing maintenance commitment.</font><br>
<p>
I&#x27;m sure you&#x27;re right about this too. Unfortunately I&#x27;m not confident the expected value *for us* of doing this would actually be greater than what we&#x27;re currently doing; we could easily do a bunch of work and then the CI test failures end up being ignored (unless we do the work to diagnose and chase down each regression, which is not all that different from what we have to do today). At a less rational level, it grates to be a tiny, unpaid team doing work to clean up the messes of people being paid megabucks to do kernel development; this is already the case, but upping the stakes in the hope of a net win makes it more so.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879416/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor879418"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 22, 2021 2:16 UTC (Wed)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/879418/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Bear in mind that this type of &quot;reverse dependency testing&quot; also incurs a maintenance burden; for example, any flakes in the rr test suite suddenly become flakes that kernel maintainers need to deal with. There&#x27;s questions of versioning (pin to rr commit or track git main), build system, etc.</font><br>
<p>
This is all true too.<br>
<p>
Ideally there would be a standard test harness and repository for user-space tests of kernel APIs, and we would be able to merge tests from rr into that system. We wouldn&#x27;t have to merge all of them, and we could run them hundreds of times pre-merge and reject any that failed even once. But as far as I know that harness and repository don&#x27;t actually exist. Or am I wrong?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879418/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879419"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel API test harnesses</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 22, 2021 3:01 UTC (Wed)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/879419/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <a href="https://www.kernel.org/doc/html/latest/dev-tools/kselftest.html">kselftest</a> is probably the droid you are looking for here.  I am sure they would welcome contributions!
<p>
The <a href="https://linux-test-project.github.io/">Linux Test Project</a> might also be a good home.


      
          <div class="CommentReplyButton">
            <form action="/Articles/879419/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879440"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel API test harnesses</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 22, 2021 9:41 UTC (Wed)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/879440/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks.<br>
<p>
Thinking about it some more, I guess I was wrong to suggest that merging rr tests into an existing test framework makes sense. Maybe 0-Day CI is the place for this after all.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879440/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879466"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel API test harnesses</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 22, 2021 14:09 UTC (Wed)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/879466/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      Getting tests merged into kselftest is a good way to get them run in a number of the current testing operations, including those that run for stable kernel candidates.  


      
          <div class="CommentReplyButton">
            <form action="/Articles/879466/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879585"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel API test harnesses</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 22, 2021 20:59 UTC (Wed)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/879585/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah, but you wouldn&#x27;t want to merge a copy of rr itself into kselftest, and that&#x27;s what would be needed.<br>
<p>
Most rr tests are small programs that exercise certain kernel functionality. Running the test requires recording execution of the small program, followed by replaying it, and we verify that the replay worked correctly. Some of the kernel regressions rr caught could have been detected just by running the small programs normally --- because the kernel functionality they use regressed --- and those could be trivially added to kselftest. But many of the kernel regressions rr caught were related to ptrace, signals, etc that were exercised by rr itself.<br>
<p>
rr isn&#x27;t huge (50K-ish lines) but it&#x27;s written in C++ and I doubt it would be acceptable to paste it into the kernel tree.<br>
<p>
I think 0-Day-CI is really the right approach here. But do test failures there block kernel &quot;stable&quot; releases?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879585/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879586"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel API test harnesses</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 22, 2021 21:10 UTC (Wed)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/879586/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      My suggestion would be to submit tests that only run if rr is available.  But I'm not the kselftest maintainer, so I can't guarantee they would accept such a thing; some of those folks have been known to read here, maybe they could speak up.
<p>
As for blocking stable releases: regression reports will delay them and cause the offending patches to be fixed or  removed; see the discussion that follows any of the review postings to see how that works.  You can see an example <a href="https://lwn.net/ml/linux-kernel/20211213092939.074326017@linuxfoundation.org/">here</a>.  The problem is not (usually) responding to reports of regressions, it's knowing that the regressions exist in the first place.
As you have often (rightly) pointed out, more and better tests would help a lot in that regard.



      
          <div class="CommentReplyButton">
            <form action="/Articles/879586/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879725"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel API test harnesses</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 23, 2021 20:59 UTC (Thu)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/879725/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks for pointing that out. It looks like 0-Day CI results were not reported there. But results from <a href="https://lkft.linaro.org/">https://lkft.linaro.org/</a> were reported there --- and despite the site saying &quot;the mission of LKFT is to improve the quality of the Linux kernel by performing functional testing on Arm hardware&quot; they actually run tests on x86 as well. Maybe that&#x27;s the right place to add a new test suite.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879725/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor879100"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2021 12:32 UTC (Sat)
                               by <b>smcv</b> (subscriber, #53363)
                              [<a href="/Articles/879100/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The recent FUSE regression triggered by &quot;fuse: fix page stealing&quot; in 5.16-rc2, 5.14.20, 5.15.3(?) and contemporary stable kernels, subsequently fixed by &quot;fuse: release pipe buf after last use&quot; in 5.16-rc3, 5.15.6, 5.10.83, 5.4.163 and and 4.19.219, is another example of a fix in mainline kernels being backported and then found to cause a regression.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879100/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879101"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2021 12:41 UTC (Sat)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/879101/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
To me, saying it needs to appear in one mainline rc kernel is just asking for trouble.<br>
<p>
It&#x27;s been released to mainline FOR TESTING. To me that means it is definitely NOT known to be stable. So why is it being cherry-picked into stable? The requirement should be it needs to make it into a .0 kernel ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879101/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879109"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2021 17:31 UTC (Sat)
                               by <b>matthias</b> (subscriber, #94967)
                              [<a href="/Articles/879109/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There cannot be one requirement that is appropriate for all patches. How fast a patch is backported to stable (if at all) should depend on the complexity of the patch and on the importance of the fix. Just as an example: Delaying the backport of KPTI until after the next kernel release would have been a very bad idea, meltdown was just too important. And there is the obvious problem that there are not enough developers to determine for each and every patch how much testing that needs and how important it is.<br>
<p>
But yes, cherry-picking directly after rc1 seems not to be the safest option.<br>
<p>
Best,<br>
Matthias<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879109/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor879113"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2021 20:00 UTC (Sat)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/879113/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If a signal falls in the forest, but nobody can hear it, does it make a sound?<br>
<p>
More prosaically, what exactly is the *observable* difference between sending a signal that can&#x27;t be caught or ignored, and &quot;faking it?&quot; If there is no observable difference, why bother?<br>
<p>
This is a genuine question, not a rhetorical &quot;they wasted a bunch of time&quot; argument. I don&#x27;t know enough about the kernel&#x27;s internals to answer it for myself.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879113/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879115"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2021 21:42 UTC (Sat)
                               by <b>matthias</b> (subscriber, #94967)
                              [<a href="/Articles/879115/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I just quote Eric from this (<a href="https://lwn.net/ml/linux-kernel/87sfwqxv8g.fsf@disp2133/">https://lwn.net/ml/linux-kernel/87sfwqxv8g.fsf@disp2133/</a>) mail:<br>
<p>
<font class="QuotedText">&gt; The why is that do_exit as an interface needs to be refactored.</font><br>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt; As it exists right now &quot;do_exit&quot; is bad enough that on a couple of older</font><br>
<font class="QuotedText">&gt; architectures do_exit in a random location results in being able to</font><br>
<font class="QuotedText">&gt; read/write the kernel stack using ptrace.</font><br>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt; So to addresses the issues I need to get everything that really</font><br>
<font class="QuotedText">&gt; shouldn&#x27;t be using do_exit to use something else.</font><br>
<p>
Also it seems that there is indeed a difference: The &quot;fake signal and do_exit()&quot;-approach only terminates a single thread, however the signal should bring down the whole process.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879115/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879614"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 23, 2021 4:51 UTC (Thu)
                               by <b>mmirate</b> (guest, #143985)
                              [<a href="/Articles/879614/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Also it seems that there is indeed a difference: The &quot;fake signal and do_exit()&quot;-approach only terminates a single thread, however the signal should bring down the whole process.</font><br>
<p>
Ah, so *that* is why my multithreaded program isn&#x27;t working on new kernels anymore. Whenever each thread finished its assigned work, it would clean itself up by committing a seccomp violation. Very annoying I have to change the program now. I&#x27;m going to complain on the mailing list.<br>
<p>
/s<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879614/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor879152"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 19, 2021 19:48 UTC (Sun)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/879152/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Within the kernel, there is a more subtle exception wherein a process can be forced to take a signal and exit regardless of any other arrangements that process may have made.</font><br>
<p>
Imagine &quot;forcing&quot; a specific interruption and interrupting a piece of kernel code that explicitly requested for it to be temporarily ignored. What could possibly go wrong!?<br>
<p>
<p>
Oh wait, this is just user space code, so who cares :-)<br>
<p>
<font class="QuotedText">&gt; The nature of the signal API almost guarantees that any implementation will be full of subtle interactions and complexities, and the version in Linux doesn&#x27;t disappoint.</font><br>
<p>
A lost cause then...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879152/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879153"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 19, 2021 22:18 UTC (Sun)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/879153/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The forcing behavior makes sense where it&#x27;s used. For example if a process ignores/masks SIGILL and then executes an illegal instruction, that cannot really be &quot;ignored&quot;, so there&#x27;s no obviously better alternative to the kernel&#x27;s approach unblocking the signal and then delivering it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879153/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879154"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 19, 2021 23:03 UTC (Sun)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/879154/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; For example if a process ignores/masks SIGILL and then executes an illegal instruction, that cannot really be &quot;ignored&quot;, so there&#x27;s no obviously better alternative to the kernel&#x27;s approach unblocking the signal and then delivering it.</font><br>
<p>
So why can SIGILL be ignored in the first place?<br>
<p>
<p>
This ignore/force &quot;arms race&quot; demonstrates the lack of clear, top-down classification of signals. For instance the fact that SIGKILL cannot be ignored is always mentioned &quot;in passing&quot; deep down in the SIGKILL-specific section. That always struck me as incredibly bad documentation and/or design: the distinction between signals that can be ignored versus not should be made _at the very top_ with further subsections for the various other classes of signals-that-can-be-ignored-except-when-not. In fact they should even have different prefixes, I mean SIGKILL should not even be called SIGKILL but something else like UNMASKABLE_KILL.<br>
<p>
<font class="QuotedText">&gt; The forcing behavior makes sense where it&#x27;s used.</font><br>
<p>
And what is the formal definition of &quot;makes sense where it&#x27;s used&quot;? As long as there&#x27;s none, race conditions and unanticipated corner cases will keep happening. Do we still need proof in 2021 that concurrency is hard and requires very careful and formal design? I heard that the high level design of signals was botched 50 years ago but Linux is now in a unique, quasi-monopolistic position to clean things up without caring about portability. However this requires a whiteboard and some computer _science_, not everything can be solved with a hands-on, incremental, &quot;send patches&quot; approach.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879154/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879164"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2021 4:40 UTC (Mon)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/879164/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is almost entirely unrelated to concurrency so I&#x27;m not sure why you&#x27;re bringing that up.<br>
<p>
<font class="QuotedText">&gt; So why can SIGILL be ignored in the first place?</font><br>
<p>
Yes, arguably it shouldn&#x27;t be ignorable. However, it does make sense to install a signal handler for SIGILL (e.g. to emulate the instruction or recover in some other way). I don&#x27;t know the history of the development of Unix signal handling, but it&#x27;s easy to imagine that once signal handlers were invented, it was convenient to use a single mechanism for both async signals (e.g. SIGINT, SIGTERM) and &quot;deterministic&quot; signals such as SIGILL and SIGSEGV.<br>
<p>
I certainly agree that when we look at what signals and signal handling have evolved into, the design looks pretty nasty.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879164/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879168"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2021 6:54 UTC (Mon)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/879168/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; This is almost entirely unrelated to concurrency </font><br>
<p>
When you need exclusive access to some data, there is not much difference between 1. another thread accessing the data concurrently on a different core 2. another thread/handler pausing you to access the data on the same core. The concepts and tools are the same and people usually try to write code that handles both cases indifferently.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879168/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879177"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2021 11:15 UTC (Mon)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/879177/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The concepts and tools are the same</font><br>
<p>
I don&#x27;t agree with this at all. Signal-safety and thread-safety are actually very different concepts with very different constraints. For example, you can make code thread-safe by using mutexes, but that actually doesn&#x27;t work at all for signal handlers because you will instantly deadlock if a signal handler tries to acquire a mutex held by the thread it interrupted (assuming non-reentrant mutexes; if your mutexes are reentrant the situation is even worse since you won&#x27;t get mutual exclusion).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879177/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879242"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2021 16:14 UTC (Mon)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/879242/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Please try to describe the problems and solutions using concepts and terms not used when dealing with concurrency.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879242/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor879322"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 21, 2021 14:34 UTC (Tue)
                               by <b>jrtc27</b> (subscriber, #107748)
                              [<a href="/Articles/879322/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
To add to the ways in which OpenSSL is a terrifying piece of software, it also installs a SIGILL handler in order to probe hardware features on Arm. Most are covered by AT_HWCAP* these days, but apparently not all, at least on 32-bit Arm. This makes debugging OpenSSL-using software particularly fun on Arm, since it breaks on the SIGILL during initialisation, and you have to continue past it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879322/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879716"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 23, 2021 19:38 UTC (Thu)
                               by <b>pm215</b> (subscriber, #98099)
                              [<a href="/Articles/879716/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Using SIGILL for that on Arm is a bad idea which has been disrecommended for more than a decade (the alternatives today being hwcaps or directly reading the ID registers, which the kernel trap-and-emulates). There is at least one case I know of where trying an insn might succeed without causing a SIGILL but where it is not safely available for userspace. (To be fair, that case is a bit old and obscure now -- a few early Cortex-A8 based boards had issues with Neon, so the kernel reported &quot;no Neon&quot; to userspace, but since there was no way to make Neon trap separately from VFP, code that took the &quot;see if it SIGILLs&quot; approach would get the wrong answer.)<br>
<p>
On the bright side, openssl seems to skip all but one of the SIGILL tests if it can get the hwcaps through getauxval. Maybe the kernel needs to grow another hwcap for that last test?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879716/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879975"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 29, 2021 3:22 UTC (Wed)
                               by <b>foom</b> (subscriber, #14868)
                              [<a href="/Articles/879975/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There are also arm devices which have heterogeneous sets of CPU cores, e.g. it might have two armv8.0 and two armv8.2 cores available.<br>
<p>
The kernel hwcaps mechanism ensures that only the capabilities available on all cores are reported available (modulo buggy kernels, sigh). But, if you ignore that, and just try executing instructions to see what looks like it works, you&#x27;ll be in for a bad time when your process happens to get moved to a different core with fewer instructions available later on.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879975/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor880045"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 30, 2021 17:24 UTC (Thu)
                               by <b>pm215</b> (subscriber, #98099)
                              [<a href="/Articles/880045/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah, I thought of the heterogenous-cluster case, but I couldn&#x27;t remember whether the kernel reported a lowest-common-denominator hwcaps or just flatly refused to boot (as a &quot;don&#x27;t do this silly thing&quot; hint to hardware designers :-)), so I didn&#x27;t mention it.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/880045/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor879165"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2021 4:42 UTC (Mon)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/879165/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Linux is now in a unique, quasi-monopolistic position to clean things up without caring about portability.</font><br>
<p>
Linux does have to care about compatibility though, so at this point creating something brand-new in place of signals would only increase complexity since the existing signal system would still need to be supported.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879165/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879169"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2021 7:01 UTC (Mon)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/879169/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wrote &quot;clean things up&quot;, not &quot;something brand new&quot;. I meant: clean up the documentation, add a couple cleaner APIs while keeping the old ones for backward compatibility, define and document undefined behaviors, explicitly forbid the sequences that never worked... I think design decisions like these already happened in other, dark POSIX areas?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879169/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor879178"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2021 11:15 UTC (Mon)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/879178/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sure, I guess, but it&#x27;s not clear to me you can make things much better this way.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879178/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor879896"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 27, 2021 16:56 UTC (Mon)
                               by <b>ebiederm</b> (subscriber, #35028)
                              [<a href="/Articles/879896/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The deep issue with area of the kernel is it has been extended many times since it has been written to the point much of what happens is not well expressed in the code, and the number of active kernel developers who can figure it out is dwindling.<br>
<p>
My goal is to clean up the implementation in the kernel so it is more straight forward and less error prone to touch.<br>
<p>
<p>
There is also the challenge that &quot;Fixes:&quot; is the new &quot;CC: stable@kernel.org&quot;.  Which means that code that has no need to be backported (because no one has seen the bug in practice) gets backported amplifying any mistakes made in cleanups, or new features meant to address old issues.<br>
<p>
<p>
<p>
I don&#x27;t know of any solutions other than keep plodding along and make the code less error prone to use.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/879896/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor881187"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SA_IMMUTABLE and the hazards of messing with signals</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2022 0:13 UTC (Thu)
                               by <b>sammythesnake</b> (guest, #17693)
                              [<a href="/Articles/881187/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Greg KH gave a talk a while back that was reported here on LWN describing some of his process for deciding what goes into -stable. He mentioned that his criteria vary depending on the source of the code. <br>
<p>
It might be worth getting in touch with him and agreeing the right process for your contributions when you have an opinion regarding -stable suitability. He doesn&#x27;t want to make mistakes any more than you want him to :-P<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/881187/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2021, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
