        <!DOCTYPE html>
        <html lang="en">
        <head><title>The curious case of O_DIRECTORY|O_CREAT [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/926782/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/926933/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/926782/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>The curious case of O_DIRECTORY|O_CREAT</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>March 27, 2023</br>
           </div>
The <a
href="https://man7.org/linux/man-pages/man2/openat.2.html"><tt>open()</tt></a>
system call offers a number of flags that modify its behavior; not all
combinations of those flags make sense in a single call.  It turns out,
though, that the kernel has responded in a surprising way to the
combination of <tt>O_CREAT</tt> and <tt>O_DIRECTORY</tt> for a long time.
After a 2020 change made that response even more surprising, it seems
likely that this behavior will soon be fixed, resulting in a rare user-visible
semantic change to a core system call.
<p>
The <tt>O_CREAT</tt> flag requests that <tt>open()</tt> create a regular
file if the named path doesn't exist (adding <tt>O_EXCL</tt> will cause the
call to fail if the path <i>does</i> exist).  <tt>O_DIRECTORY</tt>,
instead, indicates that the call should only succeed if the path exists and
is a directory.  It is not possible to create a directory with
<tt>open()</tt>; that is what <a
href="https://man7.org/linux/man-pages/man2/mkdir.2.html"><tt>mkdir()</tt></a>
is for.  So the combination of <tt>O_CREAT</tt> and <tt>O_DIRECTORY</tt>
requests the kernel to create a directory (which is supposed to already
exist) as a regular file — which clearly does not make sense.
<p>
Since time immemorial, the kernel's response to the combination of those
two flags has been to flag an error in most situations.  If the path exists and
is a regular file, <tt>open()</tt> fails and returns with an
<tt>ENOTDIR</tt> error.  If, instead, the path is an existing directory, the
error is <tt>EISDIR</tt> — perhaps a bit surprising, given that
<tt>O_DIRECTORY</tt> indicates that the path is expected to be a directory.
If, however, the path does not exist at all, the <tt>open()</tt> call will
succeed after creating a regular file with the indicated name, which is
also a surprising result.
<p>
Recently, though, Pedro Falcato <a
href="/ml/linux-kernel/20230320071442.172228-1-pedro.falcato@gmail.com/">noticed</a>
that the behavior in the final case above had changed; the kernel will now
return <tt>ENOTDIR</tt> if the path does not exist — but it also still
creates a regular file.  It is fair to say that this behavior is even more
surprising than what happened before.  Christian Brauner <a
href="/ml/linux-kernel/20230320115153.7n5cq4wl2hmcbndf@wittgenstein/">tracked
the behavioral change down</a> to <a
href="https://git.kernel.org/linus/973d4b73fbaf">this commit from Al
Viro</a>, which was merged for the 5.7 release.
<p>
Falcato included a patch to restore the previous behavior, which arguably
makes a bit more sense than what the kernel does now and is, in any case,
what the kernel did for a long time.  But Brauner wondered if the right
thing to do was to fix the kernel to do something more rational with that
combination of flags:
<p>
<blockquote class="bq">
	So before we continue down that road should we maybe treat this as
	a chance to fix the old bug? Because this behavior of returning
	-ENOTDIR has existed ever since v5.7 now. Since that time we had
	three LTS releases all returning ENOTDIR even if the file was
	created.
</blockquote>
<p>
Since, he said, nobody seems to have noticed the change over this time, it
seems likely that nobody is actually counting on the strange semantics
given to that combination of flags in the past.  Linus Torvalds <a
href="/ml/linux-kernel/CAHk-=wjifBVf3ub0WWBXYg7JAao6V8coCdouseaButR0gi5xmg@mail.gmail.com/">agreed</a>
that actually fixing the kernel's behavior seemed like a sensible path:
"<q>I think we can pretty much assume that there are no actual users of it,
and we might as well clean up the semantics properly</q>".
<p>
Falcato <a
href="/ml/linux-kernel/CAKbZUD2Y2F=3+jf+0dRvenNKk=SsYPxKwLuPty_5-ppBPsoUeQ@mail.gmail.com/">did
some research</a> on what other systems do in response to that combination
of flags.  NetBSD, it seems, will simply fail an <tt>open()</tt> call in
that situation, returning <tt>EINVAL</tt>.  FreeBSD, instead, will
allow the call to succeed if the path exists and is a directory; otherwise
it will fail.  He also noted that all of the behaviors seen — Linux pre-
and post-5.7, NetBSD, and FreeBSD — are allowed by POSIX: "<q>I would not
call the old Linux behavior a *bug*, just really odd semantics</q>".
<p>
Torvalds <a
href="/ml/linux-kernel/CAHk-=wgc9qYOtuyW_Tik0AqMrQJK00n-LKWvcBifLyNFUdohDw@mail.gmail.com/">answered</a>
that either of the BSD behaviors would make sense, while the kernel's
current behavior "<q>has no excuse</q>".  The NetBSD response is "<q>the
clearest case</q>", he said, but FreeBSD's behavior is closer to what Linux
did before the 5.7 change.  Brauner <a
href="/ml/linux-kernel/20230321142413.6mlowi5u6ewecodx@wittgenstein/">favored</a>
the NetBSD behavior, and put together <a
href="/ml/linux-kernel/20230321161736.njmtnkvjf5rf7x5p@wittgenstein/">a
patch</a> to implement it.

As part of that work, he put some effort into searching through code
looking for cases that would be broken by the change in semantics; he came
up nearly empty:
<p>
<blockquote class="bq">
	Time was spent finding potential users of this
	combination. Searching on codesearch.debian.net showed that
	codebases often express semantical expectations about O_DIRECTORY |
	O_CREAT which are completely contrary to what our code has done and
	currently does.
<p>
	The expectation often is that this particular combination would
	create and open a directory. This suggests users who tried to use
	that combination would stumble upon the counterintuitive behavior
	no matter if pre-v5.7 or post v5.7 and quickly realize neither
	semantics give them what they want
</blockquote>
<p>
Included in the patch are some links to places where developers had
attempted this combination; see <a
href="https://sources.debian.org/src/flatpak-builder/1.2.3-1/subprojects/libglnx/glnx-shutil.c/?hl=251#L251">this
libglnx comment</a> for an example.  
<p>
As the result of Brauner's patch, the combination of <tt>O_CREAT</tt> and
<tt>O_DIRECTORY</tt> will cause an <tt>open()</tt> call to fail with
<tt>EINVAL</tt> regardless of whether the given path exists or not.
Chances are that nothing will break with this change, but he is asking for
widespread testing to be sure of that.  It would, after all, be annoying to
have to revert this change if a problem report surfaces at some point in
the future.  The patch has not actually been applied as of this writing;
given that there is a semantic change involved, it would be a bit
surprising to see it land for 6.3.  That said, your editor has been
surprised by such things before.
<p>
This is one of those cases where the subtleties in the kernel's API
policies come into play.  In a real sense, this fix is an incompatible API
change, and it will indeed break any program that is relying on the current
behavior.  But, in cases where no program does rely on a specific behavior,
that behavior can indeed be changed.  This fix seems unlikely to break
anything, and so is permissible for the kernel developers to do.  Should
the assumption that nothing will break prove true, it may even be possible,
someday, to make that flag combination do what developers evidently expect
and create a directory.  But first it is necessary to demonstrate that
there are indeed no problems resulting from the removal of the current,
strange semantics.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_model-User-space_ABI">Development model/User-space ABI</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#System_calls-open">System calls/open()</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/926782/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor927498"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2023 22:49 UTC (Mon)
                               by <b>jhoblitt</b> (subscriber, #77733)
                              [<a href="/Articles/927498/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why does open() need the O_DIRECTORY flag at all? It seems like unnecessary overlap with opendir(), mkdir(), and possibly access().<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927498/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927499"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2023 23:08 UTC (Mon)
                               by <b>mpr22</b> (subscriber, #60784)
                              [<a href="/Articles/927499/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
opendir(3) is implemented on top of open(2), and the man page for open(2) on my Linux system says:<br>
<p>
<span class="QuotedText">&gt;O_DIRECTORY</span><br>
<span class="QuotedText">&gt;</span><br>
<span class="QuotedText">&gt;If pathname is not a directory, cause the open to fail. This flag was added in kernel version 2.1.126, to avoid denial-of-service problems if opendir(3) is called on a FIFO or tape device.</span><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927499/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor927500"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2023 23:26 UTC (Mon)
                               by <b>atnot</b> (subscriber, #124910)
                              [<a href="/Articles/927500/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In general, the reason why open() has all of these flags is because of the lack of concurrency semantics of the unix file system API. There is no way to guarantee that whatever check you have made before still applies to that file by the time you open it. The only way you can guarantee that is to move the check into the kernel, where it can use the secret transaction system built into the filesystem to provide atomicity for your open call. <br>
<p>
Accordingly, the kernel must provide every combination of checks or requests one might want to do in it's flags. This does lead to a lot of duplication, but it is also the only way to write correct and secure code without some sort of major change to the filesystem API. It turns out that sometimes, checking whether something is a directory is just one of those things.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927500/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927567"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 16:11 UTC (Tue)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/927567/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, technically, there is also the option of exposing an API for the secret transaction system that's built into the filesystem. Microsoft actually did that for NTFS, and shortly thereafter turned around and published documentation telling everyone not to use it because they were going to deprecate it next week,[1] although to my knowledge this deprecation never officially happened. Perhaps someone with deeper filesystem knowledge than me can explain why this is so fraught, but from my perspective as an application developer, the whole thing seems a bit silly. You have a series of functions that amount to "atomically read X and then write Y" for numerous different values of X and Y - why not just let userspace directly express the "atomically" part instead?<br>
<p>
The obvious concern is about blocking the system, but you could still provide optimistic concurrency control, so that doesn't seem like a valid problem to me. There's also the problem of "this is too complicated and userspace might do something dumb with it" - but that hasn't stopped mmap and similarly weird syscalls from existing. And there's also "we don't know if we made the best possible transaction system, so to avoid breaking backcompat, we'll just avoid exposing it" - but SQL servers have exposed transaction systems since the beginning, and they seem to be doing just fine on the backcompat side of things. I get the sense that the real problem is "this isn't worth the engineering effort in our judgment," but nobody wants to say that out loud.<br>
<p>
[1]: <a href="https://learn.microsoft.com/en-us/windows/win32/fileio/deprecation-of-txf">https://learn.microsoft.com/en-us/windows/win32/fileio/de...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927567/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927580"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 19:40 UTC (Tue)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/927580/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You don't want userspace code execution to be part of the transaction, that seems really dangerous even with optimistic concurrency. You would want to be able to submit the complete transaction for validation and execution by the kernel. Actually these days you could probably cobble something together using io_uring and eBPF to do this.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927580/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927690"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2023 14:59 UTC (Wed)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/927690/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; You don't want userspace code execution to be part of the transaction, that seems really dangerous even with optimistic concurrency. You would want to be able to submit the complete transaction for validation and execution by the kernel.</span><br>
<p>
Isn't that exactly what SQL does with COMMIT right now?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927690/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927705"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2023 16:50 UTC (Wed)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/927705/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No SQL doesn't do it ... Oracle or PostGreSQL or ScarletDME or whatever do it.<br>
<p>
The database batches things up until userspace/SQL/DataBASIC says "okay I'm done". At present, the kernel does not have the ability to do that.<br>
<p>
And actually, it might be quite tricky for the kernel, in general, because with a database COMMIT, the database maintains different versions of reality. Yes I know Posix mandates some sort of reality distortion field, but when you're trying to get VFS, and btrfx, and ext?, and whatever whatever whatever all to agree, life gets rather hard ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927705/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927718"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2023 18:30 UTC (Wed)
                               by <b>jhoblitt</b> (subscriber, #77733)
                              [<a href="/Articles/927718/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; No SQL doesn't do it ... Oracle or PostGreSQL or ScarletDME or whatever do it.</span><br>
<p>
AFAIK, ANSI/ISO SQL includes transactions.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927718/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927730"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2023 19:49 UTC (Wed)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/927730/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes it does. But ANSI/ISO SQL doesn't *DO* transactions - it's an interpreted/jit'd language. In the words of the GP, it is "user space code" that shouldn't go anywhere near doing transactions.<br>
<p>
COMMIT merely tells the underlying layer (and it doesn't have to be SQL, ScarletDME is NoSQL and there are a heck of a lot of NoSQL databases out there that have "commit" - without it you can't really claim to be a database at all) "this series of actions are supposed to be carried out in an atomic manner".<br>
<p>
This is basically the big problem that everything has with transactions. It's easy for COMMIT (or my case, more likely START TRANSACTION / END TRANSACTION) to *define* *what* *is* *SUPPOSED* *to* *be* *atomic*, it's a much bigger problem for the underlying layer to actually implement it atomically.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927730/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor927719"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2023 18:36 UTC (Wed)
                               by <b>jhoblitt</b> (subscriber, #77733)
                              [<a href="/Articles/927719/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes and transactions can be a useful feature in a filesystem.  A few years prior to the existence of AWS S3, I wrote an object store like pseudo filesystems by basically converting the kernel's ext3 headers into a sql schema.  Transactions were useful in several situations, such as atomic "file" renames where the target name was an existing "file" which needed to be unlinked.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927719/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor927587"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 20:12 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/927587/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Well, technically, there is also the option of exposing an API for the secret transaction system that's built into the filesystem. </span><br>
<p>
Uhm, it was not secret at any point. Moreover, MS was pushing it pretty hard around the Vista time. The API was actually pretty cool, you could even do distributed transactions (using the Microsoft Distributed Transaction Coordinator) that involved the filesystem and SQL server. We used it to do transactional file operations in our CRM running under the IIS.<br>
<p>
There were some problems with it:<br>
1. It was slow as hell. NTFS is not a speed daemon in the best of times, and additional journaling slowed it down even more.<br>
2. Pretty much nobody used it, even Microsoft's own Windows Update. So it got dropped from the ReFS.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927587/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor928061"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">secret transaction system?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 1, 2023 5:08 UTC (Sat)
                               by <b>moxfyre</b> (guest, #13847)
                              [<a href="/Articles/928061/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; The only way you can guarantee that is to move the check into the kernel, where it can use the secret transaction system built into the filesystem to provide atomicity for your open call. </span><br>
<p>
The Linux kernel contains a "secret transaction system" for filesystem operations…? By "secret", do you just mean that there's no API exposed to userspace to manage such transactions?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/928061/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor930092"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">secret transaction system?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 25, 2023 13:21 UTC (Tue)
                               by <b>Rudd-O</b> (guest, #61155)
                              [<a href="/Articles/930092/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If we told ya, it wouldn't be a secret anymore, would it?<br>
<p>
😂<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/930092/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor927522"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 11:03 UTC (Tue)
                               by <b>aaronmdjones</b> (subscriber, #119973)
                              [<a href="/Articles/927522/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
opendir(3) is not a system call. It's a C library function implemented on top of open(2) (which returns a file descriptor referring to that directory) and getdents(2) (which takes a file descriptor referring to that directory).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927522/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor927505"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 2:03 UTC (Tue)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/927505/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; The expectation often is that this particular combination would create and open a directory.</span><br>
<p>
Given the indication that the behavior of this combination can have its behavior changed/fixed, is there some strong reason *not* to make it successfully create a directory? That seems like *useful behavior*: create a directory and atomically return an fd for that directory.<br>
<p>
Would that break some existing software? It doesn't sound like it would, given<br>
<p>
<span class="QuotedText">&gt; "I think we can pretty much assume that there are no actual users of it, and we might as well clean up the semantics properly"</span><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927505/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927507"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 3:53 UTC (Tue)
                               by <b>brauner</b> (subscriber, #109349)
                              [<a href="/Articles/927507/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I already proposed that when I fixed the bug:<br>
<p>
"(As a sidenote, posix made an interpretation change a long time ago to<br>
at least allow for O_DIRECTORY | O_CREAT to create a directory (see [3]).<br>
<p>
But that's a whole different can of worms and I haven't spent any<br>
thoughts even on feasibility. And even if we should probably get through<br>
a couple of kernels with O_DIRECTORY | O_CREAT failing with EINVAL first.)"<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927507/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927508"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 4:11 UTC (Tue)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/927508/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thank you! Sorry I missed that.<br>
<p>
But in any case, Linus pointed out open's hard-to-extend semantics (the same ones that motivated O_TMPFILE), which make it less worthwhile to attempt to make this work.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927508/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927512"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 8:40 UTC (Tue)
                               by <b>smcv</b> (subscriber, #53363)
                              [<a href="/Articles/927512/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Perhaps openat2() (which always rejected unknown flags) could interpret O_DIRECTORY|O_CREAT as "open a directory, creating it if it doesn't exist", even if plain open() and openat() don't? Or would it be more confusing for openat2() and openat() to differ on that?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927512/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927514"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 9:36 UTC (Tue)
                               by <b>brauner</b> (subscriber, #109349)
                              [<a href="/Articles/927514/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
openat2() can very well differ from the other variants. But if we wanted it to be the only open* syscall to open and create a directory then we should add an openat2() specific flag instead of reusing O_DIRECTORY | O_CREAT. Otherwise userspace might rightly be confused why O_DIRECTORY|O_CREAT works on openat2() but not on other open() variants. Reusing O_DIRECTORY|O_CREAT really only makes sense when we provide consistent behavior for all open syscalls imho.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927514/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927518"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 9:49 UTC (Tue)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/927518/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah, agreed; might as well make O_CREATE_DIR.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927518/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927525"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 11:58 UTC (Tue)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/927525/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I like how you give "create" back its "E" but then steal "ectory" again.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927525/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927529"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 12:54 UTC (Tue)
                               by <b>brauner</b> (subscriber, #109349)
                              [<a href="/Articles/927529/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The API giveth, and the API taketh away.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927529/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927591"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 20:44 UTC (Tue)
                               by <b>Villemoes</b> (subscriber, #91911)
                              [<a href="/Articles/927591/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
O_LORD_WONT_YOU_BUY_ME_PONIES<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927591/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor928771"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">open(, O_DIRECTORY|O_CREAT) should create and open a file descriptor to a directory</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 11, 2023 16:39 UTC (Tue)
                               by <b>meuh</b> (guest, #22042)
                              [<a href="/Articles/928771/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes please<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/928771/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor927568"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 16:19 UTC (Tue)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/927568/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You don't, strictly speaking, need it. mkdirat(2) and openat(2) should be able to resolve any race condition that might otherwise be possible. Here's a possible sequence of events:<br>
<p>
0. Thread A opens the parent directory. This may or may not race with something, but let's call it out of scope for now and just assume that it happens.<br>
1. Thread A calls mkdirat and creates /path/to/foo/<br>
2. Thread B renames it to /path/to/bar/ (or removes it or whatever)<br>
3. Now if thread A tries to openat /path/to/foo/, it gets ENOENT, so it would know to start over and try again.<br>
<p>
Alternatively:<br>
<p>
2. Thread B renames it to /path/to/bar/<br>
3. Thread B creates a new /path/to/foo/<br>
4. Thread A successfully openats /path/to/foo/. It's a different directory than the one that it created, but from thread A's perspective, this makes no practical difference. One newly-created directory is just as good as another, right?<br>
<p>
Alternatively alternatively:<br>
<p>
3. Thread B creates /path/to/foo as a symlink to something else.<br>
4. Thread A tries to openat /path/to/foo/, but it fails because of O_NOFOLLOW. A knows that something is wrong and aborts the operation.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927568/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927576"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 18:35 UTC (Tue)
                               by <b>zev</b> (subscriber, #88455)
                              [<a href="/Articles/927576/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; One newly-created directory is just as good as another, right?</span><br>
<p>
Not if they have different metadata (permissions or ownership, which could arise with multiple processes accessing /tmp, say).  Also, is there any guarantee B even left it empty and didn't also start populating it with things that would conflict with A's plans for it?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927576/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927606"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2023 0:46 UTC (Wed)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/927606/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Not if they have different metadata (permissions or ownership, which could arise with multiple processes accessing /tmp, say). </span><br>
<p>
A can fstat it after opening it, if A cares.<br>
<p>
<span class="QuotedText">&gt; Also, is there any guarantee B even left it empty and didn't also start populating it with things that would conflict with A's plans for it?</span><br>
<p>
If the permissions on the original dir allow it, then B can do this anyway. If not, then see previous reply.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927606/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor927609"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2023 2:12 UTC (Wed)
                               by <b>interalia</b> (subscriber, #26615)
                              [<a href="/Articles/927609/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I could be wrong but I imagine that even if A managed to create the directory atomically first, process B could create files in there before A gets control again. So there's guarantee the newly created directory is empty by the time that A reads it. Most programs probably just don't care, of course, as long as the directory serves their purposes.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927609/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927623"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2023 5:37 UTC (Wed)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/927623/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It is possible for A to use unlinkat(2) to remove the directory immediately after creating it (with AT_REMOVEDIR). In principle, I imagine that you might be able to continue using other fooat syscalls on the unlinked directory until you close it, thus creating a "true" temporary directory, but I have not tried it.<br>
<p>
That still doesn't work because you race against someone else opening the directory before you can unlink it, but it's a neat party trick (if it works).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927623/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927752"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2023 2:20 UTC (Thu)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/927752/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sadly, that doesn't work. Once you've unlinked a directory, attempting to create something in that directory produces ENOENT.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927752/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor927761"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2023 6:50 UTC (Thu)
                               by <b>donald.buczek</b> (subscriber, #112892)
                              [<a href="/Articles/927761/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, anonymous directories would be nice to have. Of course, with `dfd = mkdirat(parentfd, optional_name, mode, O_TMPDIR)` ínstead of a non-atomic `mkdir()`, `unlinkat()` combination. But I assume, that would be far from trivial to implement, because filesystems are not prepared to handle trees of unlinked directories.<br>
<p>
If you want a directory tree and its contents to go away by kernel cleanup when the last access is gone and have privilege, you can use a lazily unmounted mount on top of a lazily detached loop device on top of an unlinked file like this:<br>
<p>
root@theinternet:~# fallocate -l 10G /tmp/x.dat<br>
root@theinternet:~# losetup --find --show /tmp/x.dat<br>
/dev/loop0<br>
root@theinternet:~# mkfs.ext4 -q /dev/loop0<br>
root@theinternet:~# mount /dev/loop0 /mnt<br>
root@theinternet:~# cd /mnt<br>
root@theinternet:/mnt# umount -l /mnt<br>
root@theinternet:/mnt# losetup -d /dev/loop0<br>
root@theinternet:/mnt# rm /tmp/x.dat<br>
root@theinternet:/mnt# ls -l<br>
total 16<br>
drwx------ 2 root root 16384 Mar 30 08:43 lost+found<br>
root@theinternet:/mnt# df /tmp<br>
Filesystem     1K-blocks     Used Available Use% Mounted on<br>
/dev/sda1      268304384 44856232 223448152  17% /<br>
root@theinternet:/mnt# cd<br>
root@theinternet:~# df /tmp<br>
Filesystem     1K-blocks     Used Available Use% Mounted on<br>
/dev/sda1      268304384 44786364 223518020  17% /<br>
<p>
But there is no way to create this stack atomically.<br>
<p>
Another ugliness here is, that the system will unnecessarily flush modified data during (auto-)umount. <br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927761/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor927566"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 16:02 UTC (Tue)
                               by <b>mb</b> (subscriber, #50428)
                              [<a href="/Articles/927566/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think it would be a good idea to add the O_DIRECTORY|O_CREAT combination to a unit test as well.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927566/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor927573"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 17:37 UTC (Tue)
                               by <b>brauner</b> (subscriber, #109349)
                              [<a href="/Articles/927573/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
See my request for this in the thread and the discussion following that. TL;DR we'll have some as part of xfstests.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927573/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor927578"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The curious case of O_DIRECTORY|O_CREAT</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2023 18:50 UTC (Tue)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/927578/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'd also be interested in fuzz tests that report if a file gets created by open() without an fd for it being returned. If you pick a random combination of flags and permissions and starting state, I'm not sure what should happen, but I don't think that's ever an expected result.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/927578/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2023, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
