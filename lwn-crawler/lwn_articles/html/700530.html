        <!DOCTYPE html>
        <html lang="en">
        <head><title>Backports and  long-term stable kernels [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/700530/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/700154/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/700530/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Backports and  long-term stable kernels</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>LWN.net needs you!</b>
<p>
Without subscribers, LWN would simply not exist.  Please consider
       <a href="/Promo/nst-nag2/subscribe">signing up for a subscription</a> and helping
       to keep LWN publishing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>September 14, 2016</br>
           </div>
One of the longest running debates in the kernel community has to do with
the backporting of patches from newer kernels to older ones.  Substantial
effort goes into these backports, with the resulting kernels appearing in
everything from enterprise distributions to mobile devices.  A recent
resurgence of this debate on the <a
href="https://lists.linuxfoundation.org/pipermail/ksummit-discuss/2016-September/thread.html">Kernel
Summit discussion list</a> led to no new conclusions, but it does show how
the debate has shifted over time.
<p>
Anybody wanting to use the kernel in a production setting tends to be torn
between two conflicting needs.  On one hand, the desire for stability and a
lack of surprises argues for the use of an older kernel that has been
maintained under a fixes-only policy for some time.  But such kernels tend
to lack features and hardware support; one needs to run a recent kernel for
those.  The answer that results from that conflict is backporting: pick a
long-term support (LTS)
stable kernel as a base, then port back the few things from newer kernels
that one simply cannot do without.  With luck, this process will produce a
kernel that is the best of both worlds.  In practice, the results are
rather more mixed.
<p>
The problems with backporting are numerous.  It will never be possible to
pick out all of the important patches to port, so these kernels will always
lack important fixes, some of which could leave open severe security
holes.  The mainline kernel benefits from widespread testing, but a
backported kernel is a unique beast that certainly contains bugs introduced
by the backporting process itself.  The effort that goes into
the creation of backport-heavy kernels is unavailable for the  task of
getting vendor changes upstream, with costs to both
the vendor and the community as a whole.  Users of highly divergent kernels
are dependent on their vendor for support and updates; the community lacks
the ability to help them.  And so on.
<p>
<h4>Backports in the embedded industry</h4>
<p>

Alex Shi <a
href="https://lists.linuxfoundation.org/pipermail/ksummit-discuss/2016-September/003790.html">started
the discussion</a> with a mention of Linaro's <a
href="https://wiki.linaro.org/LSK">LSK backporting effort</a> and asking if
there were ways that groups doing this sort of backporting could
collaborate.  The development community wasn't much interested in
discussing backporting collaboration, though; the conversation turned
quickly to the value of backporting efforts in general instead.  Sasha
Levin <a
href="https://lists.linuxfoundation.org/pipermail/ksummit-discuss/2016-September/003791.html">got
there first</a> with a statement that "<q>what LSK does is just
crazy</q>" and suggesting that, if vendors want the latest features and
fixes, the best way to get them is to run mainline kernels.  He was not
alone in this opinion.
<p>
James Bottomley <a
href="https://lists.linuxfoundation.org/pipermail/ksummit-discuss/2016-September/003798.html">pointed
out</a> that the backporting happening in the embedded industry looks a lot
like what the enterprise vendors did in the 2.4 kernel era.  They ended up
with patch sets that were, in some cases, larger than the kernel itself and
were a nightmare to maintain.  To get away from these issues, the kernel's
development model was changed in 2.6 and the distributors focused on
getting features upstream prior to shipping them.  That has greatly reduced
the load of patches they have to carry, allowed them to run newer kernels,
and reduced fragmentation in the kernel community.  Why, he asked, can't embedded
vendors do the same?
<p>
From the discussion, it would seem that, while there are many reasons cited
for shipping backported kernels, there is one overwhelming issue that keeps
vendors stuck on that model: out-of-tree code.  A typical kernel found in
an embedded or consumer electronics setting has a vast pile of patches
applied, the bulk of which have never made their way into a mainline
kernel.  Every time that a vendor moves to a new base kernel, this
out-of-tree code, perhaps millions of lines of it, must be forward-ported.
That is a huge effort with risks of its own.  It is unsurprising that
vendors will tend to delay doing that work as long as possible; if an older
kernel can support a new device through the addition of a few more
backported drivers, that is what they will do.
<p>
The longstanding "upstream first" policy says that these vendors should
have pushed their code into the mainline before shipping it in their
devices; then they would have no forward-porting issues when moving to a
newer kernel.  But "upstream first" has never been the rule in this part of
the market.  These products are designed, built, shipped, and obsoleted on
an accelerated schedule; there is no space in that schedule for the process
of getting code upstream, even if the process goes quickly â€” which is not
always the case.  Upstreaming after shipping can be done, but the vendor's
attention has probably moved on to the next product and the business case
for getting the code upstream is not always clear.  Five or ten years in,
when vendors find themselves struggling under millions of lines of
out-of-tree code, they might have cause to wish they had worked more with
the development community, but the people making these decisions rarely
look that far ahead.
<p>
There was some talk about how the out-of-tree code problem could be
addressed, but with few new solutions.  As Linus Walleij <a
href="https://lists.linuxfoundation.org/pipermail/ksummit-discuss/2016-September/003884.html">noted</a>,
the only reliable solution seems to be customers demanding upstream support
from their suppliers.  He suggested that if Google would ever make such a
requirement for its Nexus Android devices, "<q>then things will
happen</q>".  Until then, the best that can be done is to continue to
talk to and pressure companies and help them to change slowly.  Some of
this pressure could yet take the form of changes in how stable kernels are
managed. 
<p>
<h4>How stable kernels fit in</h4>
<p>
While much of the conversation talked about the evils of backporting,
another branch was focused on the role that stable kernels play in that
ecosystem.  Vendors naturally gravitate toward kernels with long-term
support, including LSK, the <a
href="http://ltsi.linuxfoundation.org/">Long-Term Support Initiative (LTSI)</a>,
or the mainline LTS kernels, as the base for their backports, though,
as it turns out, they don't use those kernels as their maintainers might
wish.
<p>
As Tim Bird <a
href="https://lists.linuxfoundation.org/pipermail/ksummit-discuss/2016-September/003925.html">described</a>,
the kernels shipped in devices are often subject to more than one level of
backporting.  The system-on-chip (SoC) within the device will have been provided
with a kernel containing plenty of backported code, but then the integrator
who is building a product from that system will have another set of patches
to add.  The value of initiatives like LSK and LTSI is that they have
reduced the number of kernel versions being provided by SoC vendors, making
life easier for those doing backports at the integrator level.  Projects
like LTSI also list upstreaming of vendor code among their goals, and some
of that has been done, but their most important role seems to be to serve
as a common base for vendor-specific kernel forks.

<p>
There was a certain amount of unhappiness with how these
long-term-supported kernels are used, though.  An LTS kernel like 4.4 will be
supported for at least two years; the LSK and LTSI kernels, based on LTS
kernels, will have a similar support period.  But SoC vendors are not
actually making use of that support.  Instead, they grab whatever version
of the kernel is available at the time and simply stick with it going
forward, ignoring any further updates to that kernel.  Should a fix land in
the kernel they started from that cannot be done without (a highly
publicized security fix, for example), the vendors will, naturally,
backport it. Product vendors then take a snapshot of the SoC vendor's kernel and
ignore any updates from the SoC vendor in a similar manner.  This pattern
has led developers like Ted Ts'o to <a
href="https://lists.linuxfoundation.org/pipermail/ksummit-discuss/2016-September/003797.html">question
the value</a> of the entire stable-kernel process and suggest, once again,
that vendors would be better off just using mainline kernels:
<p>
<div class="BigQuote">
	Why not just encourage them to get their device drivers into
	staging, and just go to a newer LTS kernel?  Because I guarantee
	that's going to be less risky than taking a random collection of
	features, and backporting them into some ancient kernel.
</div>
<p>
Or, he said, SoC vendors could just start with a mainline release and pick their
patches from subsequent releases rather than from the LTS kernel.
<p>
<h4>Time for a change?</h4>

<p>
Greg Kroah-Hartman, the maintainer of the long-term support kernels, <a
href="https://lists.linuxfoundation.org/pipermail/ksummit-discuss/2016-September/003923.html">agreed</a>
with this assessment of the situation, noting that even serious security
fixes don't find their way through to the kernels shipped by vendors
despite being promptly included in the LTS kernels.  So he is mulling the
idea of stopping the the maintenance of the LTS kernels entirely:
<P>
<div class="BigQuote">
	But if we didn't provide an LTS, would companies constantly update
	their kernels to newer releases to keep up with the security and
	bugfixes?  That goes against everything those managers/PMs have
	ever been used to in the past, yet it's actually the best thing
	they could do.
</div>
<P>
Getting to the point where companies might actually see the wisdom of that
approach will take some time, he acknowledged, and there will be a great
deal of education required.  But, he said, he has been talking to people at
some vendors in the hope of improving the situation.  He closed by saying
there might not be a long-term support kernel next year, since it wouldn't
be needed.  Or, at least, "<q>one has to dream</q>".
<p>
In this context, it's interesting to look at <a
href="http://techsingularity.net/blog/?p=16">this recent post</a> from Mel
Gorman, which talks about the problem of performance regressions in newer
kernels.  The performance hit caused by moving to a newer kernel can often
be surprisingly large.  It can also be difficult to fix, since it is
usually the result of many patches adding a 0.1% cost rather than one or
two big mistakes.  The work required to get that performance back is
significant, and it helps him to understand why vendors in general might be
reluctant to move to newer kernels:
<p>
<div class="BigQuote">
	This is unrelated to the difficulties embedded vendors have when
	shipping a product but lets just say that I have a certain degree
	of sympathy when a major kernel revision is required. That said, my
	experience suggests that the effort required to stabilise a major
	release periodically is lower than carrying ever-increasing numbers
	of backports that get harder and harder to backport. 
</div>
<p>
If embedded-systems vendors were to come to a similar conclusion, the
result could be significant changes in how that part of the market works.
The benefits could be huge.  The upstream kernel would, hopefully, gain the
best of the work that those vendors are carrying out of tree for now; the
rest would be replaced with more general solutions that would better serve
all users.  Kernels shipped with devices would have more features and fewer
bugs while being more secure than what is shipped now.  It might actually
become possible to run mainline kernels on these devices, opening up a
range of possibilities from third-party support to simply enabling hobbyist
developers to do interesting hacking on them.  The considerable energy that
goes into backporting now could be directed toward testing and improving
the mainline kernel.  And so on.
<p>
All of this seems like a distant dream at the moment, but our community
has made a number of dreams come true over the years.  It has also been
quite successful in convincing companies that working with the community is
the best approach for long-term success with Linux.  Perhaps we are getting
closer to a point where embedded-systems vendors will be willing to rethink
their approach to the Linux kernel and find ways to work more closely with
the development community that, in the end, they depend on to produce the
software they ship.  One does indeed have to dream.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_model-Stable_tree">Development model/Stable tree</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Long-term_support_initiative">Long-term support initiative</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/700530/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor700705"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 14, 2016 22:44 UTC (Wed)
                               by <b>zblaxell</b> (subscriber, #26385)
                              [<a href="/Articles/700705/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>Because I guarantee that's going to be less risky than taking a random collection of features, and backporting them into some ancient kernel.</blockquote>

<p>Backporters review changes <em>in the context of the embedded device they are to be installed on</em> in order to avoid a number of problematic behaviors that are typical of software upgrades on embedded devices--i.e. things catching fire and people getting hurt.

<p>I'm curious to hear the kernel maintainers' proposal for achieving <em>guaranteed</em> better results from mainline kernel rebases.  They still manage to push out a vX.Y Linux kernel with terrible regressions for boring old x86 PCs a couple of times a year, and those are orders of magnitude cheaper and easier to test than some random ARM device.
      
          <div class="CommentReplyButton">
            <form action="/Articles/700705/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700741"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 8:44 UTC (Thu)
                               by <b>ovitters</b> (guest, #27950)
                              [<a href="/Articles/700741/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; things catching fire and people getting hurt</font><br>
<p>
In the article they're commenting that embedded industry is often NOT even applying security fixes. So your suggestion that the status quo is good I doubt. It's likely a case of "if it isn't broken don't fix it" (as minimal amount of work on it as possible). That's also what's noted in the article.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700741/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700746"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 9:18 UTC (Thu)
                               by <b>kiko</b> (guest, #69905)
                              [<a href="/Articles/700746/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think he makes a valid point, though: introducing new kernels regularly invites instability. On standard x86 systems you hardly feel this because, besides being low-variation, it gets great beta-style test coverage and outstanding maintenance by the kernel community and in particular Intel. In the embedded world none of that is true, so every rebase means a ton of work.<br>
<p>
It's true that work is even harder due to fact they carry so much out of tree, but it's a self-reinforcing pattern. To break out of it requires an external injection of energy. Linaro's drive to get vendors to rebase constantly, simplifying and merging their out of tree codebases, has been a major driver of change, but I really don't like the LSK effort, because it introduces incentives in the opposite direction.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700746/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700842"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 17:47 UTC (Thu)
                               by <b>broonie</b> (subscriber, #7078)
                              [<a href="/Articles/700842/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Linaro isn't really pushing vendors to upstream exactly - we've got no stick to use there, it's all positive encouragement and really by the time a company comes to the point of joining Linaro they've probably got at least some motivation towards upstream already. <br>
<p>
The goal with LSK is to reduce the amount of effort people are spending time backporting generic code and get newer driver APIs into older kernel so it's easier for people to stay in touch with mainline and hopefully can spend more effort upstreaming (or at least not duplicating backports).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700842/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor700777"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 15:11 UTC (Thu)
                               by <b>zblaxell</b> (subscriber, #26385)
                              [<a href="/Articles/700777/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      I'm not arguing that the status quo is <em>good</em>.  We agree the status quo is bad.  I'm arguing that the proposed alternative is <em>worse</em>.

<p>Security doesn't matter if the kernel panics in the middle of mounting the root filesystem, or if the embedded device doesn't work (or catches fire, or fails to detect or prevent a fire) because of an obscure change in the default settings for a GPIO controller.  Mainline needs to find a way to solve that kind of problem because it still happens more than once a year on PCs, and other platforms tend to work less often than not.  Solve those problems and the barriers to security fixes will melt away.

<p>Mainline complains that vendors don't consume security fixes they provide.  Vendors complain that security fixes are not provided to them in a form that they are able to consume.  To me the whole thing sounds like a lot of pots and kettles arguing about shades of black instead of finding ways to solve their problems.
      
          <div class="CommentReplyButton">
            <form action="/Articles/700777/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700795"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 15:48 UTC (Thu)
                               by <b>pizza</b> (subscriber, #46)
                              [<a href="/Articles/700795/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Vendors complain that security fixes are not provided to them in a form that they are able to consume. </font><br>
<p>
AKA "a fix already backported to, and tested on, our specific frankenkernel and hardware"<br>
<p>
I've been on both sides of this, and IME the underlying problem is that Vendors typically don't care about anything once it ships (ie gets to the "good enough" point) and will only go back and "fix" something when it starts negatively affecting their bottom line.  (Usually in the form of legal action)<br>
<p>
<font class="QuotedText">&gt; Security doesn't matter if the kernel panics in the middle of mounting the root filesystem, or if the embedded device doesn't work (or catches fire, or fails to detect or prevent a fire) because of an obscure change in the default settings for a GPIO controller. </font><br>
<p>
So you're saying that this vendor performs no testing at all before they ship something?  Because everything you've described here would be caught by even a trivial amount of smoke testing -- and anything remotely safety-critical has *extensive* testing/certification requirements.  There is no such thing as a "trivial update" in that context.<br>
<p>
More to the point though, upstream kernel developers can't test hardware which they don't have, or something that relies on out-of-tree (if not outright proprietary) code.  (IME it's that latter stuff that turns out to be excessively brittle, and I say that as someone who's been on both sides of this)<br>
<p>
This situation will only change once the lawyers convince the suits that it's cheaper to be proactive about these things than to react after the fact.  I'm not holding my breath.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700795/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700823"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 16:23 UTC (Thu)
                               by <b>zblaxell</b> (subscriber, #26385)
                              [<a href="/Articles/700823/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; So you're saying that this vendor performs no testing at all before they ship something?</font><br>
<p>
From the point of view of the product vendor, mainline performs no testing at all before they ship.  This is where a lot of vendors' resistance to mainline comes from.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700823/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor700999"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 17, 2016 7:25 UTC (Sat)
                               by <b>eduard.munteanu</b> (guest, #66641)
                              [<a href="/Articles/700999/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The situation will change if companies realize there's money to be made from providing a good post-marketing experience to the customer. There are two ways of doing that: either the vendor remains seriously involved with the product after launch, or the product is designed from the very beginning to be maintainable (e.g. upstream-first, an open design etc.). However, most vendors only plan ahead to make the launch day. It sort of makes sense if you're aiming to cram as many features, outrun the competition, gather as much hype and sell cheap to less-concerned customers. But there are certainly many customers not satisfied with those prospects.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700999/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor700707"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 14, 2016 22:57 UTC (Wed)
                               by <b>broonie</b> (subscriber, #7078)
                              [<a href="/Articles/700707/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This does miss out the issues with the time taken to get mainline supporting framework level features (things beyond just the direct device support) for newer system designs into mainline - this is distinctly non-trivial and a real blocker to shipping mainline in production in some applications. People are working on these things but it's not particularly fast going for all sorts of reasons (like the need to consider all systems) which make this a lot more complicated than it is for the enterprise systems.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700707/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor700728"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 5:34 UTC (Thu)
                               by <b>alison</b> (subscriber, #63752)
                              [<a href="/Articles/700728/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Munekata of Renesas has spoken several times at Embedded Linux Conference about his company's practice of always developing against mainline, and only then backporting their own patches against mainline to their internal kernels.   This work is performed by two teams, one developing needed features against Linus' master/HEAD and one doing the backporting.   That strikes me as a superior method.<br>
<p>
As far as upstreaming patches from the day-job goes, I keep hearing the comments about kdbus and AF_BUS before echoing in my head.   Apparently the car industry is a special interest, while enterprise computing is not.   The problem is that sometimes maintainers don't see that embedded is a *collection* of  diverse special interests.   What automotive needs is often not what phones need.     Many of the patches that automotive devs might suggest would be useful for other parts of IOT, but those folks don't all read LKML and won't rush forward to defend us if our patches are rejected as serving the needs of just one industry.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700728/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor700731"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 6:24 UTC (Thu)
                               by <b>mjthayer</b> (guest, #39183)
                              [<a href="/Articles/700731/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In defense of embedded vendors, people in the FLOSS community tend to dislike it when they receive huge monolithic change "dumps" as patches.  But for an embedded vendor, a new stable kernel release is much the same - a huge change set which they have no hope of fully understanding.  This one is of course nicely broken into hundreds (thousands?) of clean changes, but that does not reduce the overall volume.  And I don't see how this can change as long as the kernel stays monolithic code-wise, with no stable API between components.  This is not a suggestion that that needs changing, just pointing out that that is a consequence.<br>
<p>
Then again, perhaps users are getting more used to the fact that things which worked yesterday suddenly no longer work today after the latest automatic update of their device.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700731/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700734"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 6:50 UTC (Thu)
                               by <b>mjthayer</b> (guest, #39183)
                              [<a href="/Articles/700734/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In fact the API instability is presumably also (one) factor which makes embedded developers less likely to push their local tree changes upstream.  Developing against a stable target is much more comfortable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700734/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor700742"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 8:49 UTC (Thu)
                               by <b>ovitters</b> (guest, #27950)
                              [<a href="/Articles/700742/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Vendors should test all of their updates. No matter if they apply a local patch or something else. If they work upstream, then the next kernel version they take will be of higher quality. If they basically fork a version each time then it'll be more work to maintain all of that.<br>
<p>
I'm not seeing the "suddenly breaks" with newer stable kernels. The kernel is quite aggressive with ensuring distributions always update to the latest stable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700742/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700745"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 9:11 UTC (Thu)
                               by <b>mjthayer</b> (guest, #39183)
                              [<a href="/Articles/700745/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Vendors should test all of their updates.</font><br>
<p>
Quite agree, but testing all of their user's possible use cases is unrealistic, and any change, even something seemingly innocent and well tested in other use cases, is something that might break one of them.  Which obviously does not change benefits of working against upstream.<br>
<p>
<font class="QuotedText">&gt; I'm not seeing the "suddenly breaks" with newer stable kernels. The kernel is quite aggressive with ensuring distributions always update to the latest stable.</font><br>
<p>
Reminds me to check whether the screen flicker which I have been experiencing since I upgraded to Ubuntu 16.10 happens in the current upstream kernel.  I assume it is due to something they backported to their 4.4...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700745/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700755"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 10:46 UTC (Thu)
                               by <b>johannbg</b> (guest, #65743)
                              [<a href="/Articles/700755/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Oh the joy of i915 screen flickering which regresses every other kernel release . Those of us that have evolved with it over the years have added multiple monitors and docking station to the mix just for added thrill so we dont have to break the morning routing of turning one monitor off and back on again, docking and un-docking the laptop then play turn on and off with the monitors and re-allocation of the screens in Gnome to get the order corrected again. Once it's finally stable you have reach your laptop upgrade cycle which introduces new docking station and new display ports which breaks this all over again. <br>
I915 were drm.debug=14 has become standard kernel parameter ;) <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700755/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor700792"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 16:20 UTC (Thu)
                               by <b>zblaxell</b> (subscriber, #26385)
                              [<a href="/Articles/700792/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; If they work upstream, then the next kernel version they take will be of higher quality. </font><br>
<p>
Only if the current version is really awful.  OK, we're talking about embedded, so that's probably true, but there are limits to what we can expect.<br>
<p>
Mainline quality hit a plateau some years ago and has stayed there for PC platforms.  Extremely popular embedded platforms are getting close to this, but even then, the best they can currently hope for is a breaking change every year and "only a few" dozen patches for hardware customization and application-domain-specific bug fixes.<br>
<p>
<font class="QuotedText">&gt; I'm not seeing the "suddenly breaks" with newer stable kernels.</font><br>
<p>
You are clearly not testing hard enough.<br>
<p>
With only a relatively small hardware pool, a handful of application workloads, and basic smoke testing (basically "how often does it crash or need human attention, and why, and was that more or less than last month?"), we still find regressions in stable kernels bad enough to abort deployment.  Usually regressions quietly disappear in the next stable release, so we don't commit our own effort to analyzing the failures unless the problem affects two consecutive stable kernels.  While we're waiting for a new usable stable kernel, we backport patches to whichever kernel last got through testing.  Usually that's two or three stable kernels ago, but some test configurations have not seen a working stable kernel since 2013.<br>
<p>
We find that "upstream kernel + backported patches for things we care about" easily wins over both "upstream kernel with no patches" and "upstream stable or LTS kernel" by our simple "does the damned thing work?" testing metric.<br>
<p>
Interestingly, we find no correlation between the set of kernels that work well for us, the set of kernels that work well for anyone else running a similar testing regime with different hardware or applications, and the set of kernels receiving LTS support patches.  It's a little frustrating when GKH announces that the best kernel we've tested in a year is getting its last stable update ever, but also totally understandable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700792/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700887"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 23:54 UTC (Thu)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/700887/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; &gt; I'm not seeing the "suddenly breaks" with newer stable kernels.</font><br>
&gt;<br>
<font class="QuotedText">&gt; You are clearly not testing hard enough.</font><br>
<p>
Definitely. Mainline kernel regressions are routinely found by RHEL's testing department. Luckily RHEL is very aggressive in backporting new features, so the delay is bearable (around 3 upstream releases I'd say). But the turnaround of the upstream kernel is too quick for Red Hat's testers.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700887/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor700774"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 12:50 UTC (Thu)
                               by <b>bandrami</b> (guest, #94229)
                              [<a href="/Articles/700774/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It seems odd, though, for an embedded system to want to backport hardware support, unless they've added new hardware since the original deployment (in which case you might as well rebase anyways). Even "improved" (always a nebulous term) hardware support is problematic, since it will be different from what you tested, certified, and shipped, and even an arguable improvement is a regression if it changes now-expected behavior. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700774/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700778"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 13:57 UTC (Thu)
                               by <b>JanC_</b> (guest, #34940)
                              [<a href="/Articles/700778/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The new hardware support might be needed for new devices that get connected to the original device (USB, Bluetooth, SATA, PCIE, etc.), not for hardware in the (original) device itself.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700778/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor700831"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 16:57 UTC (Thu)
                               by <b>excors</b> (subscriber, #95769)
                              [<a href="/Articles/700831/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It seems odd, though, for an embedded system to want to backport hardware support, unless they've added new hardware since the original deployment (in which case you might as well rebase anyways)</font><br>
<p>
A device has lots of hardware components outside the main SoC, which all need drivers - displays, touchscreens, backlights, IMU sensors, cameras, etc.<br>
<p>
As a device manufacturer, if you've built a working device and you want to keep the same SoC vendor but replace a few of those other hardware components with new (better or, more importantly, cheaper) ones that already have drivers in a recent mainline release, backporting those drivers is likely to be much easier than rebasing the entire kernel. If the kernel API changed enough that the drivers can't be backported, even rewriting the drivers from scratch is likely to be much easier than rebasing.<br>
<p>
(Looking at kernels from a bunch of modern Android-based devices using SoCs from several different vendors, and diffing against the corresponding upstream linux-stable releases, I see patch sizes of 1.5M lines up to 4M lines. Those devices are all based on the 3.0, 3.10 and 3.14 branches. Some are close to the latest release on those branches, some are very much not (but have some security patches backported). They're all a long way from mainline - rebasing would be very hard.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700831/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor700853"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2016 18:14 UTC (Thu)
                               by <b>Chris_Lesiak</b> (subscriber, #4179)
                              [<a href="/Articles/700853/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
For embedded systems, the vendor supplied hardware is often integrated into a larger system.  This system will add additional chips attached via spi, i2c, or other bus.  It is common that an upstream kernel will have drivers for these chips that aren't in the older vendor supplied kernel.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700853/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor701073"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 19, 2016 7:26 UTC (Mon)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/701073/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The mainline kernel benefits from widespread testing,</font><br>
<p>
More "spread" than "wide"...<br>
<p>
<font class="QuotedText">&gt; In this context, it's interesting to look at this recent post from Mel Gorman, which talks about the problem of performance regressions in newer kernels.</font><br>
<p>
Why just performance?<br>
<p>
<font class="QuotedText">&gt; &gt; That said, my experience suggests that the effort required to stabilise a major release periodically is lower than carrying ever-increasing numbers of backports that get harder and harder to backport.</font><br>
<p>
It depends. The "ever-increasing numbers" can be low if one is only interested in security and other major  bug fixes. Unless one assumes that the kernel is so horribly broken that it needs a large and steady stream of major fixes; but now if overall quality were that low then severe regressions would be frequent too.<br>
<p>
A key advantage of backports compared to upgrades: they keep version control and continuous integration useful.<br>
<p>
<font class="QuotedText">&gt; The considerable energy that goes into backporting now could be directed toward testing and improving the mainline kernel. </font><br>
<p>
Maybe; they're quite different skills and jobs.<br>
<p>
<font class="QuotedText">&gt; All of this seems like a distant dream at the moment, but our community has made a number of dreams come true over the years. </font><br>
<p>
Another dream: mainline releases gated by some traditional and *extensive* sort of QA. Good luck coordinating that.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/701073/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor701747"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 23, 2016 14:44 UTC (Fri)
                               by <b>gmatht</b> (subscriber, #58961)
                              [<a href="/Articles/701747/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <i>Another dream: mainline releases gated by some traditional and *extensive* sort of QA. Good luck coordinating that.</i><p/>

A start might be to generate statistics only failures by version. For example, make a Live CD/USB, that downloads the latest Kernel, loads it using Two Kernel Monte, does a few stress tests and regressions tests, and upload the results somewhere along with details on the hardware in the machine. Also include git bisect results where possible.<p/>

Hand out the Live USB like candy, and if there is a significant spike in crashes, try to fix the regression before releasing.

      
          <div class="CommentReplyButton">
            <form action="/Articles/701747/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor701846"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 25, 2016 10:28 UTC (Sun)
                               by <b>gregkh</b> (subscriber, #8)
                              [<a href="/Articles/701846/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Another dream: mainline releases gated by some traditional and *extensive* sort of QA. Good luck coordinating that.</font><br>
<p>
Sweet, can you define "traditional and extensive"?  I'll be glad to run any tests that people provide me.<br>
<p>
We do already do a lot of build/boot tests on lots and lots of different architectures already for the stable releases, is there some gap that you see with what we do today that we should do more of?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/701846/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor701794"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Backports and  long-term stable kernels</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 24, 2016 0:34 UTC (Sat)
                               by <b>toyotabedzrock</b> (guest, #88005)
                              [<a href="/Articles/701794/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Mantain a dev and stable branch. Merge all dev changes every other release into the stable kernel. That should still fit into the product cycle. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/701794/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2016, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
