        <!DOCTYPE html>
        <html lang="en">
        <head><title>Huge pages, slow drives, and long delays [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/467328/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/466703/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/467328/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Huge pages, slow drives, and long delays</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>This article brought to you by LWN subscribers</b>
<p>
Subscribers to LWN.net made this article &mdash; and everything that
       surrounds it &mdash; possible.  If you appreciate our content, please
       <a href="/Promo/nst-nag3/subscribe">buy a subscription</a> and make the next
       set of articles possible.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>November 14, 2011</br>
           </div>
It is a rare event, but it is no fun when it strikes.  Plug in a slow
storage device - a USB stick or a music player, for example - and run
something like <tt>rsync</tt> to move a lot of data to that device.  The
operation takes a while, which is unsurprising; more surprising is when
random processes begin to stall.  In the worst cases, the desktop can lock
up for minutes at a time; that, needless to say, is not the kind of
interactive response that most users are looking for.  The problem can
strike in seemingly arbitrary places; the web browser freezes, but a
network audio stream continues to play without a hiccup.  Everything
unblocks eventually, but, by then, the user is on their third beer and
contemplating the virtues of proprietary operating systems.  One might be
forgiven for thinking that the system should work a little better than that.
<p>
Numerous people have reported this sort of behavior in recent times; your
editor has seen it as well.  But it is hard to reproduce, which means it
has been hard to track down.  It is also entirely possible that there is
more than one bug causing this kind of behavior.  In any case, there should
now be one less bug of this type if <a href="/Articles/467332/">Mel
Gorman's patch</a> proves to be effective.  But a few developers are
wondering if, in some cases, the cure is worse than the disease.
<p>
The problem Mel found appears to go somewhat like this.  A process (that
web browser, say) is doing its job when it incurs a page fault.  This is
normal; the whole point of contemporary browsers sometimes seems to be to
stress-test virtual memory management systems.  The kernel
will respond by grabbing a free page to slot into the process's address
space.  But, if the transparent huge pages feature is built into the kernel
(and most distributors do enable this feature), the page fault handler will
attempt to allocate a huge page instead.  With luck, there will be a huge
page just waiting for this occasion, but that is not always the case; in
particular, if there is a process dirtying a lot of memory, there may be no
huge pages available.  That is when things start to go wrong.
<p>
Once upon a time, one just had to assume that, once the system had been
running for a while, large chunks of physically-contiguous memory would
simply not exist.  Virtual memory management tends to fragment such chunks
quickly.  So it is a bad idea to assume that huge pages will just be
sitting there waiting for a good home; the kernel has to take explicit
action to cause those pages to exist.  That action is <a
href="/Articles/368869/">compaction</a>: moving pages around to defragment
the free space and bring free huge pages into existence.  Without
compaction, features like transparent huge pages would simply not work in
any useful way.
<p>
A lot of the compaction work is done in the background.  But current
kernels will also perform "synchronous compaction" when an attempt to
allocate a huge page would fail due to lack of availability.  The process
attempting to perform that allocation gets put to work migrating pages in
an attempt to create the huge page it is asking for.  This operation is not
free in the best of times, but it should not be causing multi-second (or
multi-minute) stalls.  That is where the USB stick comes in.
<p>
If a lot of data is being written to a slow storage device, memory will
quickly be filled with dirty pages waiting to be written out.  That, in
itself, can be a problem, which is why the recently-merged <a
href="/Articles/456904/">I/O-less dirty throttling code</a> tries hard to
keep pages for any single device from taking too much memory.  But
writeback to a slow device plays poorly with compaction; the memory
management code cannot migrate a page that is being written back until the
I/O operation completes.  When synchronous compaction encounters such
a page, it will go to sleep waiting for the I/O on that page to complete.
If the page is headed to a slow device, and it is far back on a queue of
many such pages, that sleep can go on for a long time.
<p>
One should not forget that producing a single huge page can involve
migrating hundreds of ordinary pages.  So once that long sleep completes,
the job is far from done; the process stuck performing compaction may find
itself at the back of the writeback queue quite a few times before it can
finally get its page fault resolved.  Only then will it be able to resume
executing the code that the user actually wanted run - until the
next page fault happens and the whole mess starts over again.
<p>
Mel's fix is a simple one-liner: if a process is attempting to allocate a
transparent huge page, synchronous compaction should not be performed.  In
such a situation, Mel figured, it is far better to just give the process an
ordinary page and let it continue running.  The interesting thing is that
not everybody seems to agree with him.
<p>
Andrew Morton was the first to <a href="/Articles/467338/">object</a>,
saying "<q>Presumably some people would prefer to get lots of
huge pages for their 1000-hour compute job, and waiting a bit to get
those pages is acceptable.</q>"  David Rientjes, presumably thinking of
Google's throughput-oriented tasks, <a href="/Articles/467339/">said</a>
that there are times when the latency is entirely acceptable, but that some
tasks really want to get huge pages at fault time.  Mel's change makes it
that much less likely that processes will be allocated huge pages in
response to faults; David does not appear to see that as a good thing.
<p>
One could (and Mel did) respond that the transparent huge page mechanism
does not only work at fault time.  The kernel will also try to replace
small pages with huge pages in the background while the process is running;
that mechanism should bring more huge pages into use - for longer-running
processes, at least - even if they are not available at fault time.  In
cases where that is not enough, there has been talk of adding a new knob
to allow the system administrator to request that synchronous compaction be
used.  The actual semantics of such a knob are not clear; one could argue
that if huge page allocations are that much more important than latency,
the system should perform more aggressive page reclaim as well.
<p>

Andrea Arcangeli <a
href="/Articles/467667/">commented</a> that he does not like how Mel's
change causes failures to use huge pages at fault time; he would rather
find a way to keep synchronous compaction from stalling instead.  Some
ideas for doing that are being thrown around, but no solution has been
found as of this writing.

<p>

Such details can certainly be worked out over time.  Meanwhile, if Mel's
patch turns out to be the best fix, the decision on merging should be clear
enough.  Given a choice between (1)&nbsp;a system that continues to be
responsive during heavy I/O to slow devices and (2)&nbsp;random, lengthy
lockups in such situations, one might reasonably guess that most users
would choose the first alternative.  Barring complications, one would
expect this patch to go into the mainline fairly soon, and possibly into
the stable tree shortly thereafter.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Huge_pages">Huge pages</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Memory_management-Huge_pages">Memory management/Huge pages</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/467328/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor467691"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 2:12 UTC (Thu)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/467691/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How hard would it be to locate another potential hugepage when a subpage cannot be migrated immediately?<br>
<p>
In my opinion, in-core operations should never be forced to wait on disk I/O unless it's necessary to prevent the entire operation from failing. On the other hand, there is definite value in allocating a hugepage up front, so it might make sense to put some effort toward locating a candidate hugepage which *can* be migrated rather than immediately falling back to individual pages.<br>
<p>
If it's possible to try another hugepage, or fall back to individual pages, these options should come first.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467691/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor467694"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 2:21 UTC (Thu)
                               by <b>naptastic</b> (guest, #60139)
                              [<a href="/Articles/467694/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It sounds like another case of desktop users needing different things than server administrators.<br>
<p>
Why not tie this behavior to the kernel preemption setting? If it's set to anything higher than voluntary, then Mel's change (and perhaps some others?) should be in place; if it's set to no preemption, then go ahead and stall processes while you're making room for some hugepages.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467694/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467717"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">It's not server vs desktop</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 8:10 UTC (Thu)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/467717/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <p>Actually it does not always make sense on server either. If you have some batch-processing operation (slocate indexer on desktop, map-reduce on server) then it's Ok to wait for the compaction - even if it'll take a few minutes.</p>

<p>But if you need response right away (most desktop operations, live request in server's case) then latency is paramount.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/467717/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467753"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">It's not server vs desktop</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 13:21 UTC (Thu)
                               by <b>mennucc1</b> (guest, #14730)
                              [<a href="/Articles/467753/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So the decision should depend on niceness. Usual process should not wait for compaction. Nice process should. Just my 2Â€. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467753/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467879"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">It's not server vs desktop</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 21:26 UTC (Thu)
                               by <b>lordsutch</b> (guest, #53)
                              [<a href="/Articles/467879/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But isn't part of the problem that even if you're only compacting when nice processes try to get a huge page, non-nice processes may be queue up waiting for the compaction to complete before they can do things, due to resource contention (for example, non-nice process may want to read from the USB drive to play back video, while you're doing a nice'd backup of $HOME to it).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467879/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467944"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">It's not server vs desktop</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 18, 2011 2:16 UTC (Fri)
                               by <b>naptastic</b> (guest, #60139)
                              [<a href="/Articles/467944/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hmm.<br>
<p>
I see two questions. First; can we infer from a process's niceness or scheduler class whether it would prefer waiting for a hugepage or taking what's available now? Second; are memory compaction passes preemptible? Is this the behavior you're looking for?<br>
<p>
1. A low-priority, sched_idle process (1) tries to allocate memory. The kernel starts compacting memory to provide it with a hugepage.<br>
2. A higher-priority, sched_fifo process (2) becomes runnable and tries to allocate. Because it's higher priority, the kernel puts the request for (1) on the back burner. Because (2) is sched_fifo, the kernel doesn't wait for compaction but just gives it what's available now<br>
3. With that request satisfied, the kernel goes back to compacting in order to satisfy (1)'s needs.<br>
<p>
As someone who only uses -rt kernels, this is the behavior I think I would want. The network can get hugepages, and it can wait for them; but jackd and friends better get absolute preferential treatment for memory Right Now.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467944/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor467698"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 3:09 UTC (Thu)
                               by <b>smoogen</b> (subscriber, #97)
                              [<a href="/Articles/467698/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This somehow reminds me of Emacs Garbage Collecting.. which in the bad old days would cause you to spend 2-3 minutes watching the window freeze if you had a really slow system. I wonder how close garbage collecting and compaction match up and various fixes on how to fix it in GC languages could be used.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467698/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor467714"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 7:42 UTC (Thu)
                               by <b>iq-0</b> (subscriber, #36655)
                              [<a href="/Articles/467714/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Wouldn't it be logical to always try a non-blocking attempt and if that's not easily possible fallback to normal page allocation? And perhaps one could hint using madvise or so that one is willing to wait for huge page allocation, no master what...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467714/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor467731"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Writeback caching for USB sticks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 10:15 UTC (Thu)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/467731/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Perhaps slow devices such as USB sticks should not get writeback caching.  Writes to them should happen synchronously - that would also avoid the user-unfriendly extra step of unmounting the stick before unplugging it.  If you ask to copy a file to a USB stick, the OS shouldn't lie when reporting that the operation has completed; it should only say it's done when it's done.<br>
<p>
Or at least, have at most a fixed small amount of dirty pages for removable and slow devices (those that can be written within one second, say).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467731/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor472265"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Writeback caching for USB sticks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 15, 2011 13:43 UTC (Thu)
                               by <b>hpro</b> (subscriber, #74751)
                              [<a href="/Articles/472265/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Isn't that just backwards? The whole point of the writeback cache is to spare the user/process from having to wait for the slow write to hit disk?<br>
<p>
On a related note, have you ever tried to do some useful work on files on a stick mounted 'sync'? It is quite painful, I assure you.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/472265/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor467734"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 10:31 UTC (Thu)
                               by <b>mjthayer</b> (guest, #39183)
                              [<a href="/Articles/467734/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm sure that this is a hopelessly naive thought, but presumably not all of the pages which are in cache waiting to be written out to the USB stick are actually actively being written at any given time.  Can't they be moved elsewhere in the meantime?  Or in a similar vein, the process faulting memory in could initially be given small pages and they could be compacted after the fact as huge pages became available.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467734/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor467736"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ha-Ha-Only-Serious</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 11:09 UTC (Thu)
                               by <b>CChittleborough</b> (subscriber, #60775)
                              [<a href="/Articles/467736/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <blockquote><font color="DarkRed">[T]he whole point of contemporary browsers sometimes seems to be to stress-test virtual memory management systems.</font></blockquote>
Can I submit this as a quote of the week?
<p>
This really is a classic "ha-ha-only-serious" quip. For me (and, I guess, most people) the browser is the only thing that uses large amounts of memory, so any memory-related misconfiguration shows up as browser slowdowns, freezes and crashes. (With Firefox 3 and Firefox 4, the OOM killer used to startle me once or twice a month.) Is there a good HOWTO on this topic?</p>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467736/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467858"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ha-Ha-Only-Serious</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 20:11 UTC (Thu)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/467858/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <p>
<i>the browser is the only thing that uses large amounts of memory</i>
<p>
You obviously don't use Evolution.
      
          <div class="CommentReplyButton">
            <form action="/Articles/467858/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467869"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ha-Ha-Only-Serious</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 20:51 UTC (Thu)
                               by <b>chuckles</b> (guest, #41964)
                              [<a href="/Articles/467869/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <i>You obviously don't use Evolution. </i><br><br>

Does anyone?  I didn't realize it was still being worked on.
      
          <div class="CommentReplyButton">
            <form action="/Articles/467869/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467876"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ha-Ha-Only-Serious</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 21:10 UTC (Thu)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/467876/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You make me chuckle, chuckles.<br>
<p>
I still use it, and I sometimes wish they would stop working on it, as they keep making it harder to use after every update. I guess they have the gnome mind set too.<br>
<p>
I never cared much for mutt. I do like alpine, but too many people send me html crap that I need to read, and tbird always screws up patches I try to send.<br>
<p>
Evolution seems to work the best with imap and it's trivial to send sane patches.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467876/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467919"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ha-Ha-Only-Serious</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 23:33 UTC (Thu)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/467919/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I never cared much for mutt.</font><br>
<p>
I didn't at first either, mainly because the bindings were crazy and inconsistent. I've gotten it to be pretty well vim-ish, but it's not a 1:1 translation. It is certainly more consistent though and that makes it much better for me.<br>
<p>
<font class="QuotedText">&gt; I do like alpine</font><br>
<p>
I couldn't get the hang of alpine. Too much not-mail clutter around.<br>
<p>
<font class="QuotedText">&gt; but too many people send me html crap that I need to read</font><br>
<p>
For HTML, I have a bindings to toggle plain text or w3m -dump viewing for HTML mails (Ctrl-U and Ctrl-I, respectively). It works fairly well, not perfect, but better than any web interface.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467919/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467931"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ha-Ha-Only-Serious</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 18, 2011 0:40 UTC (Fri)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/467931/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The thing is. I actually like the GUI part of Evolution. mutt just looks damn ugly. I use it to read LKML but that's it. I place reading email up there with web browsing, and I personally think they both do better with a GUI interface than plain text.<br>
<p>
I like to have a preview screen. I move mail all the time by dragging a message over to a folder with the mouse. I do wish Evolution had better keyboard short cuts, as I probably could move messages faster with typing. I did with alpine. But mutt still seems hackish to me, and I never got past it. I've been using it for LKML for a few years now, and I still don't care much for it.<br>
<p>
Evolution is big and slow, and I need to kill it as often as I do my browsers, but other than that, it works well for me. If it had better key bindings, I would dare call it an awesome application.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467931/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467974"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ha-Ha-Only-Serious</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 18, 2011 7:53 UTC (Fri)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/467974/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I agree that the default mutt colorscheme is...less than pleasant. Of course, any UI with many elements tends to do poorly with just 8 colors. I converted the vim colorscheme I use (neverland-darker) over to it[1].<br>
<p>
I could see a 'hackish' feeling, but the bindings were the biggest part of that for me. Moving messages is = and then I have tab completion and (session-local) history in the prompt. Tagging files with searches works wonders too to do batch processing of a sort.<br>
<p>
I don't imagine we'll convince each other as I find gut feelings are hard to explain and uproot besides and I've been using mutt happily for over a year since moving from KMail.<br>
<p>
[1]<a href="http://blipper.dev.benboeckel.net/files/mutt.png">http://blipper.dev.benboeckel.net/files/mutt.png</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467974/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor469245"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ha-Ha-Only-Serious</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 24, 2011 20:40 UTC (Thu)
                               by <b>jospoortvliet</b> (guest, #33164)
                              [<a href="/Articles/469245/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I afew months ago I would've said - try KMail. Much faster than Evolution, highly efficient keyboard shortcuts and layout options, nice security integration etc.<br>
<p>
Until they came with an Akonadi based KMail2 - now it's as slow, if not slower, than Evolution, and eating lots of RAM. Now I have to wait until they fix it and muddle through in the mean time; or give up and go back to webmail :(<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/469245/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor470515"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Ha-Ha-Only-Serious</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 3, 2011 23:25 UTC (Sat)
                               by <b>Los__D</b> (guest, #15263)
                              [<a href="/Articles/470515/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p><i>Now I have to wait until they fix it and muddle through in the mean time; or give up and go back to webmail :(</i></p>
<p>In that case, I'd give RoundCube a try. It has worked perfectly for me by keeping much of the desktop mail client feel. Certainly, that feel sometimes break down, but in general I'm very pleased, especially compared to my old webmail client, Squirrelmail.</p>

<p>SquirrelMail is way more configurable though, if you need that (although RoundCube might be more configurable than I think, currently I'm just running the default Synology DSM version).</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/470515/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor467882"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Evolution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 21:36 UTC (Thu)
                               by <b>shane</b> (subscriber, #3335)
                              [<a href="/Articles/467882/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I use Evolution. It has a few features I haven't found in other e-mail clients:<br>
<p>
* Ability to specify only a part of the message as "preformatted text", so they don't get word-wrapped. Useful for pasting console output in support messages, for example.<br>
* Nice "bullet list"/"number list" support.<br>
* Pretty good IMAP support.<br>
* Multiple-language spell-checking in a single mail.<br>
<p>
It's bloated and slow, but newer versions actually do fix lots of bugs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467882/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467920"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Evolution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 23:44 UTC (Thu)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/467920/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Ability to specify only a part of the message as "preformatted text", so they don't get word-wrapped. Useful for pasting console output in support messages, for example.</font><br>
Do you mean when writing mails or viewing them? Mutt takes whatever $EDITOR gives back, verbatim. For viewing, I have bindings to toggle between 78 width and $COLUMNS-2 (300+ here which is a little much for a default wrap boundary).<br>
<p>
<font class="QuotedText">&gt; Nice "bullet list"/"number list" support.</font><br>
I tend to just do ASCII lists in vim myself.<br>
<p>
<font class="QuotedText">&gt; Pretty good IMAP support.</font><br>
I use offlineimap here.<br>
<p>
<font class="QuotedText">&gt; Multiple-language spell-checking in a single mail.</font><br>
I'm not bilingual (or anything more for that matter), so I've not had to solve this one.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467920/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467943"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Evolution</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 18, 2011 1:59 UTC (Fri)
                               by <b>mgedmin</b> (subscriber, #34497)
                              [<a href="/Articles/467943/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Vim does multilingual spell-checking.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467943/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor468006"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Stress-testers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 18, 2011 12:27 UTC (Fri)
                               by <b>CChittleborough</b> (subscriber, #60775)
                              [<a href="/Articles/468006/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <p>
You're right, I don't use Evolution. I use (and highly recommend) <a href="http://fastmail.fm/">fastmail.fm</a>, via their excellent webmail interface. So my mail program is just as memory-hungry as Firefox, because it <em>is</em> Firefox.</p>
<p>
Slightly more on topic: Mozilla has been working on reducing memory usage in recent versions of Firefox, with good success AFAICT. So we may need to find another stress-tester for the memory subsystem ... :-)</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/468006/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor469248"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Stress-testers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 24, 2011 20:42 UTC (Thu)
                               by <b>jospoortvliet</b> (guest, #33164)
                              [<a href="/Articles/469248/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Don't worry, Firefox still has no problem eating over 500 mb of ram for just a few web pages :D<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/469248/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor467837"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 19:19 UTC (Thu)
                               by <b>ejr</b> (subscriber, #51652)
                              [<a href="/Articles/467837/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Allocating huge pages transparently and immediately gives a large performance boost on the Graph500 benchmark.  The boost was big enough that other people compared results on our system (at Georgia Tech) with their own results and thought their hardware was broken.<br>
<p>
But it's a server / HPC system.  No browsers running, and no USB sticks hanging off.  I wouldn't mind having to set a sysctl at boot...  Also, our heap space often is allocated once.  Dynamic compaction is less interesting, but doesn't seem to be hurting performance.  I should measure that sometime.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467837/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor467864"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Optimize for desktop</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 20:32 UTC (Thu)
                               by <b>Velmont</b> (guest, #46433)
                              [<a href="/Articles/467864/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Optimize for desktop/laptop users. The server people already know how to tweak their system for what they want.<br>
<p>
sysctl-knob, yes, yes, yes.<br>
<p>
I hate that this is getting pushback. I hope it's the kind "yes we need this, but in another way" and not the "no, we don't want this unless it doesn't hurt us at all".<br>
<p>
Really, really. The HPC-crowd, Google et al; they have the resources to configure their systems. Let them.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467864/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor467872"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Optimize for desktop</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 21:01 UTC (Thu)
                               by <b>Ben_P</b> (guest, #74247)
                              [<a href="/Articles/467872/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A quick google didn't turn up anything, can sysctl parameters be cgroup specific?  If we should be separating of applications into cgroups anyway, this seems like a nice place for this type of mm tuning.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467872/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor467907"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">USB sticks</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 17, 2011 23:11 UTC (Thu)
                               by <b>dougg</b> (guest, #1894)
                              [<a href="/Articles/467907/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Unless one uses industrial grade flash devices (very unlikely) then anything using low cost flash (e.g. USB sticks) can be extremely horrible with large scattered writes. And it gets worse if the file system is other than VFAT. Think seconds per write operation.<br>
<p>
And I suspect the performance degradation is non-linear: hit it with too many writes and you will be punished accordingly (and then some). Any efficiencies up stream (e.g. huge pages) may just make things worse.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/467907/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor468013"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 18, 2011 13:39 UTC (Fri)
                               by <b>foom</b> (subscriber, #14868)
                              [<a href="/Articles/468013/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Awesome timing on this article, this is almost certainly exactly what's slowing down a big server workload I run when transparent hugepages are enabled.<br>
<p>
We tried experimentally enabling the THP feature in the latest kernel but it made things *much* slower, which seemed really mysterious. Now, knowing that the kernel is unnecessarily blocking processes on writing some pages to disk explains the whole issue. (Note: no USB sticks here; normal hard drives are already slow enough for me...).<br>
<p>
So yeah, that argument about how it's desirable for long-running server workloads? Not so much.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/468013/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor468378"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 19, 2011 20:56 UTC (Sat)
                               by <b>Ben_P</b> (guest, #74247)
                              [<a href="/Articles/468378/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Are long running server workloads considered those who hold large chunks of memory for a long time?  Almost any Java application would fall under this due to it's own internal memory management.  It does seem very plausible there are some server loads that actually malloc/free per-request or something similar which could make this problem seem worse.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/468378/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor469185"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why not the obvious solution?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 24, 2011 13:18 UTC (Thu)
                               by <b>slashdot</b> (guest, #22014)
                              [<a href="/Articles/469185/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The obvious solution is to allow the mm code to move pages that are queued for I/O, temporarily blocking the actual hardware submission, instead of waiting until the hardware completes the I/O.<br>
<p>
In addition the number of pages actually submitted to hardware simultaneously number of such pages needs to be limited, or they must be copied to a compact bounce buffer before submitting to the hardware, unless they are already contiguous.<br>
<p>
Also, with a suitable IOMMU, it should be possible to move pages even while they are actively read by the hardware.<br>
<p>
The fix proposed instead seems to make no sense, as it doesn't fix the issue and introduces unpredictable performance degradation.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/469185/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor469295"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 25, 2011 7:33 UTC (Fri)
                               by <b>set</b> (guest, #4788)
                              [<a href="/Articles/469295/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, just a comment as a desktop user that had no trouble reproducing this problem:<br>
<p>
I have a usb stick which has poor write speed, which I periodicly copy ~16gb of linear data to. If I just left the machine alone, it would struggle along at a rate of perhaps 1mb/s - 3mb/s, with occasional pauses where almost no data moved. If, however I were to try and use a browser, not only would the browser hang for upto minutes, but other applications would hang, not updating their windows, AND the copy process really went to hell, trickling out a few kb/s and requiring hours to complete. Oddly, the only way I could get things going again after it entered this IO hell state, was to just cat gigs of disk files. (this just got the copy going again-- no help for hanging applications.)<br>
<p>
This seems the definition of unacceptable behaviour on what is an otherwise capable dual core amd64 box with 4gb of ram. Eventually, after trying many things to tune swap/page and even formating the USB sticks to start their data clusters on 128k clusters, etc. (before that, the IO was even slower...) I finally just rebuilt the kernel without transparent huge pages. I wish I had heard they might be at fault earlier, but for me that was just a guess.<br>
<p>
So, unless some fix is implemented, it would seem to me that transparent huge pages is simply an option that should at least be documented as being potentially completely destructive to desktop usage.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/469295/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor469390"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 25, 2011 19:45 UTC (Fri)
                               by <b>jospoortvliet</b> (guest, #33164)
                              [<a href="/Articles/469390/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What I wonder if this can also hit you on a internal SSD which has performance issues... My system stalls frequently like this when an app tries to allocate memory.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/469390/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor469739"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 29, 2011 9:21 UTC (Tue)
                               by <b>Thomas</b> (subscriber, #39963)
                              [<a href="/Articles/469739/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Exactly the same behaviour here on my laptop at work with a 32GB SD-card connected via a built-in MMC/SD-card reader.  After having written more than 8GB of a 16GB git repository via rsync to the SD card, I have lock-ups for minutes (system load &gt; 8 according to xosview).  I have to try out and disable this huge pages feature and try again.<br>
<p>
Thanks to Jonathan for the very enlightening article!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/469739/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor469431"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 26, 2011 12:43 UTC (Sat)
                               by <b>mcfrisk</b> (guest, #40131)
                              [<a href="/Articles/469431/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Now this sounds exactly what I've been suffering from. Using Thinkpad T60 with a SAMSUNG MMCRE64G5MXP-0VB SSD disk. Music playing, video editing, web browsing etc was smooth while kernel compilation was in background until link time comes and whole machine freezes for minutes. Sometimes music continued to play but even keyboard leds where not reacting to caps or numlock presses. But after a few minutes it's over with nothing in the logs indicating a problem.<br>
<p>
Lately I tried to get rid of the problem with ext4 options like noatime, data=writeback etc which did speed the system up a bit but did not remove<br>
the lockups completely. Hope this really gets resolved.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/469431/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor472043"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2011 22:11 UTC (Tue)
                               by <b>khc</b> (guest, #45209)
                              [<a href="/Articles/472043/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Isn't that what /sys/kernel/mm/transparent_hugepage/defrag is supposed to control?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/472043/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor473569"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 24, 2011 0:20 UTC (Sat)
                               by <b>tristangrimaux</b> (guest, #26831)
                              [<a href="/Articles/473569/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Mel Gorman's patch is slick, but is not elegant.<br>
<p>
Elegant should be to make sure synchronous operations are quick and do not wait for ANY device to signal, only should reserve and set flags and then go out without further ado.<br>
 <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/473569/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor476455"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Huge pages, slow drives, and long delays</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 21, 2012 5:22 UTC (Sat)
                               by <b>swmike</b> (guest, #57335)
                              [<a href="/Articles/476455/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I dont't understand when people say it's hard to reproduce. I have posted several times to the linux-mm list how to reproduce this problem. I can do it 100% of the time. My ubuntu laptop (currently running 11.10), unplug the power, put in a usb stick with FAT or NTFS, and start writing to it. As soon as the process has written about 1/4 to 1/2 of my physical memory, my browser starts randomly blocking. Happens every time.<br>
<p>
My workaround is "watch -n 5 sync" when I copy files. Makes the problem go away completely.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/476455/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2011, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
