        <!DOCTYPE html>
        <html lang="en">
        <head><title>2.6 swapping behavior [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/83588/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/82759/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/83588/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>2.6 swapping behavior</h1>
<div class="Byline">[Posted May 5, 2004 by corbet]
               <p>
               </div>
</div>
<div class="ArticleText">
There has, recently, been a new round of complaints about how the 2.6
kernel swaps out memory.  Some users have been very vocal in their belief
that, if they 
have sufficient physical memory, their applications should never be swapped
out.  These people get annoyed when they sit down at their display in the
morning and find that their office suite or web browser is unresponsive,
and stays that way for some time.  They get even more annoyed when they look
and see how much memory the kernel is using for caching file contents
rather than process memory.  The obvious question to ask is: couldn't the
kernel cut back a bit on the file caches and keep applications in memory? 
<p>
The answer is that the kernel can be made to behave that way by tweaking a
runtime parameter, but it is not necessarily a good idea.  Before getting
into that, however, it's worth noting that recent 2.6 kernels have a memory
management problem which can cause serious problems after an application
which reads through entire filesystems (updatedb, say, or a backup) has
run.  The problem is the slab cache's tendency to request allocations of
multiple, contiguous pages; these allocations, when done at the behest
of filesystem code, can bring the system to a halt.  <a
href="/Articles/83591/">A patch</a> has been merged which fixes this
particular problem for 2.6.6.
<p>

The bigger issue remains, however: should the kernel swap out user
applications in order to cache more file contents?  There are plenty of
arguments in favor of this behavior.  Quite a few large applications set up
big areas of memory which they rarely, if ever use.  If application memory
is occasionally forced to disk, the unused parts will remain there, and
that much physical memory will be freed for more useful contents.  Without
swapping application memory to disk and seeing what gets faulted back in,
it is almost impossible to figure out which pages are not really needed.

A large file cache is also a performance enhancer.  The speedups that come
from having frequently-accessed data in memory are harder to see than the
slowdowns caused by having to fault in a large application, but they can
lead to better system throughput overall.

<p>
Still, there are users who insist that, for example, a system backup should
never force OpenOffice out to disk.  They don't care how quickly a system
maintenance application runs at 3:00 in the morning, but they care a lot
about how the system responds when they are at the keyboard.  This wish was
expressed repeatedly until Andrew Morton <a
href="/Articles/83593/">exclaimed</a>:
<p>
<div class="BigQuote">
	I'm gonna stick my fingers in my ears and sing "la la la" until
	people tell me "I set swappiness to zero and it didn't do what I
	wanted it to do".
</div>
<p>
This helped quiet the debate as the parties involved looked more closely at
this particular parameter.  Or, perhaps, it was just fear of Andrew's
singing.  Either way, it has become clear that most people are unaware of
what the "swappiness" parameter does; the fact that it has never been documented may
have something to do with that.
<p>
So...  swappiness, which is exported to
<tt>/proc/sys/vm/swappiness</tt>, is a parameter which sets the kernel's
balance between reclaiming pages from the page cache and swapping out
process memory.  The reclaim code works (in a very simplified way) by
calculating a few numbers:
<p>
<ul>

<li> The "<tt>distress</tt>" value is a measure of how much trouble the kernel 
     is having freeing memory.  The first time the kernel decides it needs
     to start reclaiming pages, <tt>distress</tt> will be zero; if more
     attempts are required, that value goes up, approaching a high value of
     100. 
<p>
<li> <tt>mapped_ratio</tt> is an approximate percentage of how much of the
     system's total memory is mapped (i.e. is part of a process's address
     space) within a given memory zone.
<p>
<li> <tt>vm_swappiness</tt> is the swappiness parameter, which is set to 60
     by default.
</ul>
<p>
With those numbers in hand, the kernel calculates its "swap tendency":
<p>
<pre>
	swap_tendency = mapped_ratio/2 + distress + vm_swappiness;
</pre>
<p>

If <tt>swap_tendency</tt> is below 100, the kernel will only reclaim page
cache pages.  Once it goes above that value, however, pages which are part
of some process's address space will also be considered for reclaim.  So,
if life is easy, swappiness is set to 60, and <tt>distress</tt> is zero,
the system will not swap 
process memory until it reaches 80% of the total.  Users who would like to
never see application memory swapped out can set swappiness to zero; that
setting will cause the kernel to ignore process memory until the
<tt>distress</tt> value gets quite high.
<p>

The swappiness parameter should do what a lot of users want, but it does
not solve the whole problem.  Swappiness is a global parameter; it affects
every process on the system in the same way.  What a number of people would
like to see, however, is a way to single out individual applications for
special treatment.  Possible approaches include using the process's "nice"
value to control memory behavior; a low-priority process would not be able
to push out significant amounts of a high-priority process's memory.
Alternatively, the VM subsystem and the scheduler could become more tightly
integrated.  The scheduler already makes an effort to detect "interactive"
processes; those processes could be given the benefit of a larger working
set in memory.  That sort of thing is 2.7 work, however; in the mean time,
people who are unhappy with the kernel's swap behavior may want to try
playing with the knobs which have been provided.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Memory_management-Swapping">Memory management/Swapping</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Swappiness_parameter">Swappiness parameter</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/83588/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor83830"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How do you set 'swappiness'?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 6, 2004 16:19 UTC (Thu)
                               by <b>southey</b> (guest, #9466)
                              [<a href="/Articles/83830/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      As a ordinary user (with root access), how do you actually set swappiness? Especially every reboot. Also, what performance problems would be expected? I would there just be intense disk swapping when required.
      
          <div class="CommentReplyButton">
            <form action="/Articles/83830/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor83835"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How do you set 'swappiness'?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 6, 2004 16:27 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/83835/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      To set it to zero, type:
<p>
<pre>
    echo 0 > /proc/sys/vm/swappiness
</pre>
<p>
All there is to it.
      
          <div class="CommentReplyButton">
            <form action="/Articles/83835/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor83854"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How do you set 'swappiness'?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 6, 2004 17:32 UTC (Thu)
                               by <b>southey</b> (guest, #9466)
                              [<a href="/Articles/83854/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Many thanks, I'll give it a whirl. It is not always clear what to do for less technical user. This is one of the best sections on Linux (web or print based) that allows at least me to understand what the kernel is and what is it doing in the past, present and future!
      
          <div class="CommentReplyButton">
            <form action="/Articles/83854/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor83856"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How do you set 'swappiness'?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 6, 2004 17:38 UTC (Thu)
                               by <b>thomas_d_stewart</b> (subscriber, #4328)
                              [<a href="/Articles/83856/">Link</a>] 
      </p>
      
      </div>
      </summary>
      And if you want it set at every reboot try:-<p>echo &quot;vm/swappiness=0&quot; &gt;&gt; /etc/sysctl.conf<p>(Thats how to do it in debian and fedora, its part of the procpc package)<p>HTH<br>--<br>Tom
      
          <div class="CommentReplyButton">
            <form action="/Articles/83856/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor85177"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How do you set 'swappiness'?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2004 22:55 UTC (Thu)
                               by <b>ArsonSmith</b> (guest, #5695)
                              [<a href="/Articles/85177/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      edit /etc/sysctl.conf<p>add:<br>vm.swappiness = &lt;value&gt;<p>replace &lt;value&gt; with a number 1 to 100<p>Many people say just to add an echo &lt;value&gt; &gt; /proc/sys/vm/swappiness<p>but this wont persist after a reboot.  sysctl is a utility provided by most distributions to set this up after reboot.  You can also see what all the configurable peramiters are but running<p>sysctl -A<p>I am a fan of sysctl as it also keeps your runtime kernel configuration stuff in a central location /etc/sysctl.conf and not in various places /etc/init.d/kernel_custom_stuff or /etc/rc5.d/local or what ever other places people like to make up to put this kind of stuff.
      
          <div class="CommentReplyButton">
            <form action="/Articles/85177/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor85178"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How do you set 'swappiness'?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2004 22:56 UTC (Thu)
                               by <b>ArsonSmith</b> (guest, #5695)
                              [<a href="/Articles/85178/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Sorry that should be value 0-100 not 1-100
      
          <div class="CommentReplyButton">
            <form action="/Articles/85178/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor83840"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 6, 2004 17:05 UTC (Thu)
                               by <b>guinan</b> (subscriber, #4644)
                              [<a href="/Articles/83840/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      I've felt this - it is highly annoying when I come down to continue my work in the morning, and each of the 8 tabs in my Galeon window takes 10 seconds to page back in because updatedb and various other things that have no business leaving pages in the cache ran overnight.  <p>I will try setting swappiness to 0, but why couldn't the kernel let processes provide a hint about page cache policy themselves?  It would take a while for applications to catch up, but it keeps policy in userspace, on a per-application basis, instead of leaving it up to heuristics in the kernel.  Examples,<p>   updatedb,makewhatis,etc. - DISPOSABLE<br>      galeon,evolution,etc. - INTERACTIVE<p>Use an ioctl(), /proc/self/ entry, whatever.<p>-Jamie<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/83840/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor83883"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 6, 2004 19:31 UTC (Thu)
                               by <b>abatters</b> (<b>&#x272D; supporter &#x272D;</b>, #6932)
                              [<a href="/Articles/83883/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Well, there is mlock() et al., but that would be like trying to swat a fly with a sledgehammer.<p>After closing a memory-hog program that was causing swapping, sometimes I just do &quot;swapoff -a; swapon -a&quot; to get the system responsive again.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/83883/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor84133"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">mlock</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 8, 2004 17:44 UTC (Sat)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/84133/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Actually, mlock is conceptually exactly what's required here.  We're talking about a case where the following assumption inherent in real memory allocation policy fails:  the pages for which fast access will be most appreciated are those that were most recently used.

<p>Here, we have a user who is willing to let 32MB of memory sit idle overnight, even at the cost of slowing down other things, just so he can have immediate response every time he clicks his web browser.  That's what mlock is about.

<p>I do a similar (but rather opposite) thing with a ramdisk.  I copy various files that are used in tasks that I want to be responsive into a ramdisk.  Ramdisk is just file cache that is locked in memory.  That way, no matter how much memory pressure there has been since the last time I used these files, they're always right there when I click for them.

      
          <div class="CommentReplyButton">
            <form action="/Articles/84133/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor85108"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2004 16:50 UTC (Thu)
                               by <b>jonsmirl</b> (guest, #7874)
                              [<a href="/Articles/85108/">Link</a>] 
      </p>
      
      </div>
      </summary>
      What about simply adding &quot;swapoff -a; swapon -a&quot; to the end of updatedb and prelink chron scripts?
      
          <div class="CommentReplyButton">
            <form action="/Articles/85108/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor83860"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Speculative swap-in?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 6, 2004 17:45 UTC (Thu)
                               by <b>Ross</b> (guest, #4065)
                              [<a href="/Articles/83860/">Link</a>] 
      </p>
      
      </div>
      </summary>
      On an otherwise idle system with large amounts of free or cache-only<br>pages it might be useful if the kernel would speculatively load some of<br>the swapped pages back into memory.  It should leave them in swap too in<br>case the memory is needed again (much faster to just throw it out than to<br>write it to disk).  This would help restore the system to its previous<br>state after backups well before the person gets back to their computer.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/83860/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor83861"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 6, 2004 17:50 UTC (Thu)
                               by <b>xorbe</b> (guest, #3165)
                              [<a href="/Articles/83861/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      &quot;Without swapping application memory to disk and seeing what gets faulted back in, it is almost impossible to figure out which pages are not really needed.&quot;<p>Oh come on.<p>You mark the app's pages inaccessible.  When the app touches it, the OS notes that the app really does have permissions, changes, and resumes the app.  Pages that are never touched after a while can be dropped to swap.
      
          <div class="CommentReplyButton">
            <form action="/Articles/83861/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor83873"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 6, 2004 18:21 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/83873/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>"<i>You mark the app's pages inaccessible. When the app touches it, the OS notes that the app really does have permissions, changes, and resumes the app. Pages that are never touched after a while can be dropped to swap.</i></blockquote>
<p>
That sounds vaguely like what the 2.4 VM did.  It works, but you have to mess around with a lot of page table entries, keep track of which pages you have invalidated (in affected process's page tables), and know when to get around to cleaning them up.
<p>
To an extent, things are pretty much still done that way, actually; pages are pulled from pages tables and put into the inactive list.  Eventually they find their way to swap.  If some process wants them in the mean time, they are soft-faulted back in.
      
          <div class="CommentReplyButton">
            <form action="/Articles/83873/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor83871"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 6, 2004 18:42 UTC (Thu)
                               by <b>Duncan</b> (guest, #6647)
                              [<a href="/Articles/83871/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Some weeks ago, as I was reading about yet more machinations and hoops the <br>kernel has to go thru to efficiently handle swap, I realized that with a <br>gig of memory and seldom more than half of it used by apps, I really <br>didn't need swap at all, so I turned it off. <br> <br>I've been running without swap since then, to no bad effect and perhaps a <br>slightly more responsive system, if I'm to believe the &quot;feel&quot; of things.  <br>The biggest surprise, however, was when I did the recompile with swap <br>compiled out of the kernel.  Normally, changing a single option in a tree <br>that's already compiled the kernel and hasn't been cleaned from doing so <br>means a rather speedy recompile, as only a couple of C files worth of code <br>actually has to be recompiled.  Not so with the swap option!  Just that <br>single config change meant recompiling almost the entire kernel, it would <br>seem.  I didn't realize swapping code was THAT deeply interwoven into <br>nearly every aspect of kernel operation, but it obviously is.  Thus, <br>without all that extra swapping code to deal with, the kernel SHOULD be <br>faster. <br> <br>I DID have to modify my startup and shutdown scripts, as it seems unlike <br>everything ELSE, where Mandrake (my current distrib) checks to see if the <br>files are actually there before attempting to operate on them, their init <br>scripts simply ASSUME the swap related /proc files will be there, and I'd <br>just turned them off.  However, that was easily done, and I've been swap <br>free for a month or possibly six weeks, now. <br> <br>My system is for desktop use, mainly, altho I AM running an AMD64 so have <br>64-bit code taking up a bit more memory than 32-bit would.  Still, running <br>the not exactly light KDE, and all my regular apps, I seldom use more than <br>half a gig for app memory, with the other half in cache.  Thus, the system <br>works well without swap.  I'd not recommend the solution for graphical <br>X-system desktop use, however, for anyone with less than half a gig of <br>memory, and preferably more, 768M, leaving plenty of caching room, even <br>with a decent compliment of desktop apps running.  That half-apps <br>half-cache rule of thumb seems pretty good, but with a lighter window <br>manager and 32-bit, 384M for each seems reasonable, yielding the 768M I <br>mentioned.  Console mode only or lighter X use may well use only 256M of <br>app memory, which leaving the same for cache means 512M.  With modern <br>graphical apps, that may be a bit small and keeping a swap around may be a <br>good idea, but that's where the 0 swapability config this article <br>mentions, comes in.  However, with the cost of memory, now days, unless <br>one is stuck on an old hardware platform with limited memory <br>upgradability, there's little reason not to have at least half to 3/4 gig <br>of memory in the system, and upgrading to a gig is likely to increase <br>performance more than that last notch in CPU speed would. <br> <br>When I upgrade to 2 or 4 gig, 6 months or a year from now, I'll probably <br>turn tmpfs back on, and put /tmp and /var/tmp in physical memory rather <br>than disk, as well. <br> <br>Duncan <br> 
      
          <div class="CommentReplyButton">
            <form action="/Articles/83871/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor83893"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 6, 2004 20:47 UTC (Thu)
                               by <b>thyrsus</b> (guest, #21004)
                              [<a href="/Articles/83893/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      In olden days, the sticky bit on binary executables gave the kernel a hint that it should avoid swapping/paging out the memory for that executable.  Might that still be appropriate today?<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/83893/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor83943"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 7, 2004 5:12 UTC (Fri)
                               by <b>maney</b> (subscriber, #12630)
                              [<a href="/Articles/83943/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I'm afraid you've been misinformed.  The sticky bit told the kernel not to purge the executable <b>from swap</b> when it wasn't running (until there was no non-sticky swap available to avoid an out of memory panic, of course).  IIRC, this actually goes back to the days when it wasn't swapping as we know it, but the wholesale paging of an app's executable memory in one chunk.  (recall that on the PDP-11, executable space was less than 64KB maximum, and the memory management didn't support page swapping anyway)
<p>
So the traditional use of the sticky bit is actually rather the opposite of what's wanted here!  It's also less than clear that attaching the <i>swap me only under duress</i> property statically to the source file is the best choice even if it turns out to be practical to prioritize non-cache pages at that granularity.  One obvious complication (that also wasn't present in the PDP-11 paging model) is shared libraries.

      
          <div class="CommentReplyButton">
            <form action="/Articles/83943/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor83903"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 6, 2004 21:47 UTC (Thu)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/83903/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      I think the issue is really that stuff used for a minute five hours ago is preferred to stuff used for an hour six hours ago. Stuff that's of lasting significance is more likely to be needed again after a period of the system being idle, although it may be good to evict while the system is busy.<p>Ideally, things would get swapped out while updatedb ran, and then swapped back in when nothing had used the memory cached for updatedb. But it wouldn't just be program memory getting swapped back in; it would be clever to pull into cache files and directories that get used a lot, so that (for example), your Mozilla cache would be in memory again when you got up.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/83903/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor83950"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 7, 2004 7:59 UTC (Fri)
                               by <b>njhurst</b> (guest, #6022)
                              [<a href="/Articles/83950/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      I don't understand why updatedb needs so much cache memory?  Surely it only needs to keep a stack of inodes from root to the current point in the filesystem in memory.  Once it has looked at a file that file's memory should be returned to the pool immediately.  I don't know how to force the kernel to do this though.<p>(This is obviously updatedb specific information, but maybe it would be easier to fix updatedb than everything else?)
      
          <div class="CommentReplyButton">
            <form action="/Articles/83950/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor84090"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 7, 2004 21:53 UTC (Fri)
                               by <b>addw</b> (guest, #1771)
                              [<a href="/Articles/84090/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      Trouble is that the kernel doesn't know that the updatedb is not going to look at those files ever again (well, 'till it runs again tomorrow). But the blocks from the file system are left in memory on the grounds that something recently used it likely to be used again in the near future.<p>Simple prediction doesn't always work.
      
          <div class="CommentReplyButton">
            <form action="/Articles/84090/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor84955"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2004 0:19 UTC (Thu)
                               by <b>njhurst</b> (guest, #6022)
                              [<a href="/Articles/84955/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I agree, my point is just that maybe some thought could be put into making updatedb more well behaved, rather than trying to get that behaviour directly out of the kernel?<p>I think it is allowable to have user space programs try to optimise their behaviour with the kernel :)
      
          <div class="CommentReplyButton">
            <form action="/Articles/84955/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor85236"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 14, 2004 11:17 UTC (Fri)
                               by <b>forthy</b> (guest, #1525)
                              [<a href="/Articles/85236/">Link</a>] 
      </p>
      
      </div>
      </summary>
      IMHO the initial priority of a just-allocated or just-loaded buffer is too <br>high. That's why memory hogs (which claim a page once and never look at it <br>again) swap out everything else in Linux, and updatedb also does the same <br>thing. The pages of OpenOffice, which have been used and reused all day <br>long over and over again have lower priority for the kernel than a newly <br>allocated use-once page. <br> <br>But as long as kernel developer stick their thumbs in their ears and sing <br>&quot;lalala&quot;, this won't change. <br> <br>Another note: updatedb *only* reads the names of a file system. Well, it <br>also checks if a name is a directory, and that forces it to read the <br>entire inode. The real problem here is that updatedb tries to solve <br>something the file system should do itself (especially if you think of it <br>like Hans Reiser does). Why is it impossible for the file system to keep <br>the file names in a database like updatedb, and answer queries like locate <br>directly? Hint: BeOS did something like that. 
      
          <div class="CommentReplyButton">
            <form action="/Articles/85236/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor84352"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 11, 2004 1:28 UTC (Tue)
                               by <b>mcelrath</b> (guest, #8094)
                              [<a href="/Articles/84352/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      updatedb (and many other applications) need to be using O_DIRECT or some other flag that indicates explicitly that files will be read exactly once, and putting the file in the buffer cache isn't necessary.<p>There is no way for the kernel to predict that some process named 'updatedb' will read every file exactly once, but another process named 'mozilla' likes to read the same file over and over.  It's up to the application to specify that.<p>AFAIK O_DIRECT is not the appropriate flag for this, because read/write buffers must be page aligned to use it.  An O_NOCACHE flag has been proposed before (especially by streaming video folks) but has not been added, though I did see an implementation once.  I think an O_NOCACHE or O_READONCE is the solution to this...
      
          <div class="CommentReplyButton">
            <form action="/Articles/84352/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor85168"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 13, 2004 21:00 UTC (Thu)
                               by <b>jzhao</b> (guest, #2865)
                              [<a href="/Articles/85168/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Robert Love had a patch which does exactly this:<p>http://www.kernel.org/pub/linux/kernel/people/rml/O_STREAMING/README
      
          <div class="CommentReplyButton">
            <form action="/Articles/85168/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor699627"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 6, 2016 12:48 UTC (Tue)
                               by <b>sbergman27</b> (guest, #10767)
                              [<a href="/Articles/699627/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ancient thread, I know. But the relatively recent "nocache" command is now available to solve this problem:<br>
<p>
# nocache rsync -avx / /media/backupdisk/<br>
<p>
will not fill the page cache with mostly useless data. I just found out about it this morning, and it has made my day.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/699627/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor699629"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 6, 2016 13:18 UTC (Tue)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/699629/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What package / project provides that? util-linux?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/699629/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor699631"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">2.6 swapping behavior</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 6, 2016 13:43 UTC (Tue)
                               by <b>chirlu</b> (guest, #89906)
                              [<a href="/Articles/699631/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In Debian, the package is called “nocache”. The upstream is at <a href="https://github.com/Feh/nocache">https://github.com/Feh/nocache</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/699631/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2004, Eklektix, Inc.<BR>
            
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
