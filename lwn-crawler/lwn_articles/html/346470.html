        <!DOCTYPE html>
        <html lang="en">
        <head><title>Fun with tracepoints [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/346470/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/345533/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/346470/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Fun with tracepoints</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Please consider subscribing to LWN</b>
<p>
Subscriptions are the lifeblood of LWN.net.  If you appreciate this
content and would like to see more of it, your subscription will
help to ensure that LWN continues to thrive.  Please visit
<a href="/Promo/nst-nag1/subscribe">this page</a> to join up and keep LWN on
the net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>August 12, 2009</br>
           </div>
Tracepoints are a marker within the kernel source which, when enabled, can
be used to hook into a running kernel at the point where the marker is
located.  They can be used by a number of tools for kernel debugging and
performance problem diagnosis.  One of the advantages of the DTrace system
found in Solaris is the extensive set of well-documented tracepoints in the
kernel (and beyond); they allow administrators and developers to monitor
many aspects of system behavior without needing to know much about the
kernel itself.  Linux, instead, is rather late to the tracepoint party;
mainline kernels currently feature only a handful of static tracepoints.  
Whether that number will grow significantly is still a matter of debate
within the development community.
<p>
LWN last <a href="http://lwn.net/Articles/330402/">looked at the tracepoint
discussion</a> in April.  Since then, the disagreement has returned with
little change.  The catalyst this time was Mel Gorman's <a
href="http://lwn.net/Articles/345727/">page allocator tracepoints
patch</a>, which further instruments the memory management layer.  The
mainline kernel already contains tracepoints for calls to functions like
<tt>kmalloc()</tt>, <tt>kmem_cache_alloc()</tt>, and <tt>kfree()</tt>.
Mel's patch adds tracepoints to the low-level page allocator, in places
like <tt>free_pages_bulk()</tt>, <tt>__rmqueue_fallback()</tt>, and
<tt>__free_pages()</tt>.  These tracepoints give a view into how the page
allocator is performing; they'll inform a suitably clueful user if
fragmentation is growing or pages are being moved between processors.  Also
included is a postprocessing script which uses the tracepoint data to
create a list of which processes on the system are putting the most stress
on the memory management code.
<p>
As has happened before, Andrew Morton <a
href="/Articles/346483/">questioned the value</a> of these tracepoints.  He
tends not to see the need for this sort of instrumentation, seeing it
instead as debugging code which is generally useful to a single developer.
Beyond that, Andrew asks, why can't the relevant information be added to
<tt>/proc/vmstat</tt>, which is an established interface for the provision
of memory management information to user space?
<p>
There are a couple of answers to that question.  One is that
<tt>/proc/vmstat</tt> has a number of limitations; it cannot be used, for
example, to monitor the memory-management footprint of a specific set of
processes.  It is, in essence, pre-cooked information about memory
management in the system as a whole; if a developer needs information which
cannot be found there, that information will be almost impossible to get.
Tracepoints, instead, provide much more specific information which can be
filtered to give more precise views of the system.  Mel bashed out one <a
href="/Articles/346484/">demonstration</a>: a SystemTap script which uses
the tracepoints to create a list of which processes are causing the most
page allocations.
<p>
Ingo Molnar posted <a href="/Articles/346487/">a lengthy set of
examples</a> of what could be done with tracepoints; some of these were
later taken by Mel and incorporated into <a href="/Articles/346488/">a
document on simple tracepoint use</a>.  These examples merit a look; they
show just how quickly and how far the instrumentation of the Linux kernel
(and associated tools) have developed.
<p>
One of the key secrets for quick use of tracepoints is the <tt>perf</tt>
tool which is shipped with the kernel as of 2.6.31-rc1.  This tool was written
as part of the performance monitoring subsystem; it can be used, for
example, to run a program and report on the number of cache misses
sustained during its execution.  One of the features slipped into the
performance counter subsystem was the ability to treat tracepoint events
like performance counter events.  One must set the
<tt>CONFIG_EVENT_PROFILE</tt> configuration option; after that,
<tt>perf</tt> can work with tracepoint events in exactly the same way it
manages counter events.
<p>
With that in place, and a working <tt>perf</tt> binary, one can start by
seeing which tracepoint events are available on the system:
<p>
<pre>
    $ perf list
      ...
      ext4:ext4_sync_fs                        [Tracepoint event]
      kmem:kmalloc                             [Tracepoint event]
      kmem:kmem_cache_alloc                    [Tracepoint event]
      kmem:kmalloc_node                        [Tracepoint event]
      kmem:kmem_cache_alloc_node               [Tracepoint event]
      kmem:kfree                               [Tracepoint event]
      kmem:kmem_cache_free                     [Tracepoint event]
      ftrace:kmem_free                         [Tracepoint event]
      ...
</pre>
<p>
How many <tt>kmalloc()</tt> calls are happening on a system?  The question
can be answered with:
<p>
<pre>
    $ perf stat -a -e kmem:kmalloc sleep 10

     Performance counter stats for 'sleep 10':

           4119  kmem:kmalloc            

     10.001645968  seconds time elapsed
</pre>
<p>
So your editor's mostly idle system was calling <tt>kmalloc()</tt> almost
420 times per second.  The <tt>-a</tt> option gives whole-system results,
but perf can also look at specific processes.  Monitoring allocations
during the building of the <tt>perf</tt> tool gives:
<p>
<pre>
    $ perf stat -e kmem:kmalloc make
      ...
 Performance counter stats for 'make':

           5554  kmem:kmalloc            

  2.999255416  seconds time elapsed
</pre>
<p>
More detail can be had be recording data and analyzing it afterward:
<p>
<pre>
    $ perf record -c 1 -e kmem:kmalloc make
      ...
    $ perf report
    # Samples: 6689
    #
    # Overhead          Command                         Shared Object  Symbol
    # ........  ...............  ....................................  ......
    #
      19.43%             make  /lib64/libc-2.10.1.so                 [.] __getdents64
      12.32%               sh  /lib64/libc-2.10.1.so                 [.] __execve
      10.29%              gcc  /lib64/libc-2.10.1.so                 [.] __execve
       7.53%              cc1  /lib64/libc-2.10.1.so                 [.] __GI___libc_open
       5.02%              cc1  /lib64/libc-2.10.1.so                 [.] __execve
       4.41%               sh  /lib64/libc-2.10.1.so                 [.] __GI___libc_open
       3.45%               sh  /lib64/libc-2.10.1.so                 [.] fork
       3.27%               sh  /lib64/ld-2.10.1.so                   [.] __mmap
       3.11%               as  /lib64/libc-2.10.1.so                 [.] __execve
       2.92%             make  /lib64/libc-2.10.1.so                 [.] __GI___vfork
       2.65%              gcc  /lib64/libc-2.10.1.so                 [.] __GI___vfork
</pre>
<p>
Conclusion: the largest source of <tt>kmalloc()</tt> calls in a simple
compilation process is <tt>getdents()</tt>, called from <tt>make</tt>,
followed by the <tt>execve()</tt> calls needed to run the compiler.
<p>
The <tt>perf</tt> tool can take things further; it can, for example,
generate call graphs and disassemble the code around specific
performance-relevant points.  See Ingo's mail and Mel's document for more
information.  Even then, we're just talking about statistics on
tracepoints; there is a lot more information available which can be used in
postprocessing scripts or tools like SystemTap.  Suffice to say that
tracepoints open a lot of possibilities.
<p>
The obvious question is: was Andrew impressed by all this?  Here's <a
href="/Articles/346521/">his answer</a>:
<p>
<div class="BigQuote">
	So?  The fact that certain things can be done doesn't mean that there's
	a demand for them, nor that anyone will _use_ this stuff.
<p>
	As usual, we're adding tracepoints because we feel we must add
	tracepoints, not because anyone has a need for the data which they
	gather.
</div>
<p>
He suggested that he would be happier if the new tracepoints could be used
to phase out <tt>/proc/vmstat</tt> and <tt>/proc/meminfo</tt>; that way
there would not be a steadily-increasing variety of memory management
instrumentation methods.  Removing those files is problematic for a couple
of reasons, though.  One is that they form part of the kernel ABI, which is
not easily broken.  It would be a multi-year process to move applications
over to a different interface and be sure there were no more users of the
<tt>/proc</tt> files.  Beyond that, though, tracepoints are good for
reporting events, but they are a bit less well-suited to reporting the
current state of affairs.  One can use a tracepoint to see page allocation
events, but an interface like <tt>/proc/vmstat</tt> can be more
straightforward if one simply wishes to know how many pages are free.
There is space, in other words, for both styles of instrumentation.
<p>
As of this writing, nobody has made a final pronouncement on whether the
new tracepoints will be merged.  Andrew has made it clear, though, that,
despite his concerns, he's not firmly opposing them.  There is enough
pressure to get better instrumentation into the kernel, and enough useful
things to do with that instrumentation, that, one assumes, more of it will
go into the mainline over time.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_tools-Kernel_tracing">Development tools/Kernel tracing</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Performance_monitoring">Performance monitoring</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Tracing">Tracing</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/346470/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor346800"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 13, 2009 2:45 UTC (Thu)
                               by <b>karim</b> (subscriber, #114)
                              [<a href="/Articles/346800/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<p>
Maybe I'm just missing something but ... I can't help but feel somewhat cynical about this. I released the Linux Trace Toolkit on July 22nd 1999, over 10 years ago - and yet still, this was quite some time before DTrace came to be FWIW. The value of static tracepoints seemed obvious at the time (for me at least). I can't believe this debate is still going on. In fact, I can't help but think that Linux in this case could have been way much further ahead of DTrace. Of course the worst part is that early on all this static tracing was turned down because it would result in unmaintainable bloat. The irony is that the vast majority of initial trace-points suggested are still valid today.<br>
<p>
As to the argument that nobody wants to "use" this stuff, I've never bought this. You can't expect users to come asking for tools they've never seen before -- that's rare. That doesn't mean they won't find those tools very useful if they were made available to them. It just so happens that those feeling the need for these tools have no way to show mass user adoption of these tools because they can never get those tools to the users in the 1st place (if it's not mainlined, it's likely not if your latest distro ...) So one can only point at other  OSes delivering same functionality ... The fact of the matter is that in this specific case users don't get enough credit for acting smart when given the right information. Even Windows allows me to get more information about what's going on than Linux does. There has to be a point where users are given the tools to find out what *they* want to know about what's going on, not what some maintainer somewhere decides they should see through /proc/foo.<br>
<p>
I seriously hope this issue can be settled to Linux's benefit at some point in time in the future. Though I've stopped maintaining LTT quite a few years ago, I still hope one day being able to have a tool in Ubuntu to have the tools that give me the power to get full control over the information *I* want to see.<br>
<p>
Karim Yaghmour<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/346800/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor346841"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 13, 2009 7:52 UTC (Thu)
                               by <b>mjthayer</b> (guest, #39183)
                              [<a href="/Articles/346841/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One of the arguments I've heard against adding static trace points is that they become part of the kernel ABI and can no longer be removed if they prove not to be useful.  Perhaps a way around this argument would be to initially add tracepoints with a mangled name that depends on the current kernel release?  That way, until a given set of tracepoints have proved themselves, any scripts using them would have to be updated with every kernel release in order to keep working.  The mangling needn't be very complex (e.g. all tracepoints in 2.6.32 which might be removed at a later time could have "dot32" pre-pended to their names), it just needs to be unpredictable in future kernel releases.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/346841/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor346870"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 13, 2009 9:59 UTC (Thu)
                               by <b>addw</b> (guest, #1771)
                              [<a href="/Articles/346870/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't see a problem with making it clear that static trace points are NOT part of the ABI, ie that they may come &amp; go. If you are getting that close to the kernel you have got to expect things to change. But how do people use traces ? Probably to look at particular problems, not as general monitoring.<br>
<p>
In practice most people use Distro X, version Y. The release people for this will ensure that trace points don't get removed during the 5/... year lifetime of Y, thus you can install new distro provided kernels without worrying. When you rebuild your machine in 5 years time you redo your traces.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/346870/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor346850"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LTTng</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 13, 2009 8:33 UTC (Thu)
                               by <b>alex</b> (subscriber, #1355)
                              [<a href="/Articles/346850/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
FWIW I've used your LTT code on embedded systems and found it very useful in understanding the pseudo-realtime behaviour of my system. The optimist in me likes to think when we finally have a full tracing solution in the kernel it will be a much more powerful and refined experience for the 10 years of experience and experimenting done leading up to the final solution.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/346850/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor346891"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 13, 2009 12:20 UTC (Thu)
                               by <b>fuhchee</b> (guest, #40059)
                              [<a href="/Articles/346891/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <i>As to the argument that nobody wants to "use" this stuff, I've never bought this. You can't expect users to come asking for tools they've never seen before -- that's rare. That doesn't mean they won't find those tools very useful if they were made available to them.</i>
<p>
I think it goes even beyond that.  The very fact that certain subsystem maintainers have found certain tracepoint suites <b>already useful to themselves</b> does not seem to carry any weight.  A satisfactory burden/level of proof is not stated, just a counterfactual caricature "I don't think anyone needs this".
      
          <div class="CommentReplyButton">
            <form action="/Articles/346891/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor346961"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 13, 2009 16:24 UTC (Thu)
                               by <b>SEJeff</b> (guest, #51588)
                              [<a href="/Articles/346961/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why don't you (as a systemtap developer) get a list of random joes, developers, and actual subsystem maintainers to write a small blurb mentioning how static tracepoints helped them out?<br>
<p>
Then you can say look, these are not random uses? Remember all of the push against the memleak detector stuff inkernel? It seems to have pulled it's weight already by helping find plenty of bugs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/346961/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor346973"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 13, 2009 18:18 UTC (Thu)
                               by <b>karim</b> (subscriber, #114)
                              [<a href="/Articles/346973/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sorry, this has been tried and has failed. Check out the list of companies who have contributed to LTTng:<br>
Google, IBM, Ericsson, Autodesk, Wind River, Fujitsu, Monta Vista, STMicroelectronics, C2 Microsystems, Sony, Siemens, Nokia.<br>
<p>
But, hey, who are they to know, the kernel developers know better. And the hell with Sun, Apple, IBM, Microsoft, etc. who spent large gobs of money on implementing tracing infrastructure in their OSes (Apple by the way ported DTrace to MacOS ... :/ ) and maintaining it through the years. They're wrong too. The Linux kernel developers surely are better than the collective intelligence of the engineers and product managers of the aforementioned.<br>
<p>
I forgot to mention that apart from pushing and maintaining LTT for a number of years, I also worked/defended a number of ideas which were dear to my heart. Take for example real-time. Very early on I came to the LKML pointing out that the tacit laissez-faire towards the RTLinux patent was not good for Linux. This was dismissed off-hand: the uses, I was told, were so narrow and the applications so specific that this is a non-issue ("real time apps are a niche market and they're not mainstream" ... i.e. those users don't matter). Skip a few years and there were two approaches being discussed Ingo's and the iPipe (my idea); at the subsequent OLS I asked a prominent developer whether what he thought were the chances of success of Ingo's very invasive approach, his reply was clear: Ingo has got the clout to make it happen. Just about then I knew iPipe wasn't likely to "win". And have his lunch he did.<br>
<p>
That along with other things I witnessed (such as Con Kolivas quitting kernel development because he saw little interest in helping desktop interactivity) made me increasingly feel there's a NIH-syndrome. If nothing else, it distills from this that Linux' development has become highly politicized. You're either part of the in-crowd or you're not. And if you're not part of the in-crowd you're going to have a hell of a time trying to push something in if it's the least bit unconventional. Don't get wrong, being part of the in-crowd doesn't guarantee a radical change's acceptance. But being an outsider clearly ensures that you've got zero chances of success. It might have changed since I've stopped keeping track of it all, but juxtapose the previous with the fact that most kernel developers work for/on big iron and you've got a huge disconnect with the realities of real-life mainstream users. It's not that user preoccupations aren't eventually taken care or fixed (ex.: udev/sysfs/devfs), it's just that an absolute non-priority. And *that* is a serious issue. Last I checked, Linux has been flatlining in the end-user market for a very long time. If the diagnosis I'm making out of the symptoms I've witnessed is the least bit right (and I really hope I'm wrong), this isn't about to change any time soon.<br>
<p>
I sincerely apologize if I've offended anyone with the above, but this is a case where *everything* ***EVERYTHING*** has been tried to convince the kernel development community. The ball is in their camp.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/346973/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor347539"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2009 18:33 UTC (Tue)
                               by <b>karim</b> (subscriber, #114)
                              [<a href="/Articles/347539/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Just so there's no misunderstanding, please note that I don't speak on behalf on LTTng in way shape or form; the above opinions are mine and mine alone. LTTng and the now defunct LTT, which I used to maintain, have nothing but part of the name in common. I could have used any other of the tracing projects as an example, it just so happens that this is the one I'm most familiar with :)<br>
<p>
Karim<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/347539/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor347565"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2009 21:40 UTC (Tue)
                               by <b>oak</b> (guest, #2786)
                              [<a href="/Articles/347565/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; If nothing else, it distills from this that Linux' development has</font><br>
<font class="QuotedText">&gt; become highly politicized. You're either part of the in-crowd or</font><br>
<font class="QuotedText">&gt; you're not.</font><br>
<p>
I think the problem is more that individual kernel developers don't really <br>
(need to) look at the whole system or be responsible for it, just a one <br>
corner of it.  On commercial operating systems, there are dedicated people <br>
who look after the whole thing and need to make sure that the whole thing <br>
works fine (and this responsibility gives them influence over the <br>
operating system implementation to make sure that these tools get done &amp; <br>
available).<br>
<p>
If you're looking just at one or some parts of the whole system, things <br>
like LTT (or to some extent Systemtap[1]) that try to get an overview of <br>
what happens in the whole system may seem too large / complex / <br>
intrusive / bloated.  "I just need this specific info from the block <br>
layer" (or memory subsystem, or ...).  And then they write their own NIH <br>
tracing for that single thing that doesn't much benefit others, or <br>
somebody who wants to make sense out of the whole system.<br>
<p>
Note: I have gotten useful info both from LTT and LTTng (lttng.org) + it's <br>
finally getting easier to apply to kernel...  LTTv plays a large part in <br>
this too as one can easily zoom into details etc.<br>
<p>
[1] Systemtap seems nice, but it doesn't have the post-processing / <br>
visualization for the whole system like LTT does. I see it more like a <br>
tool to do more specific analysis tools.  However, for this kind of stuff <br>
it's a bit too complicated (e.g. in embedded environments where you don't <br>
want to  run stap / compile the scripts on the device itself etc), so no <br>
wonder devs write their own tracing...<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/347565/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor347652"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 19, 2009 16:18 UTC (Wed)
                               by <b>fuhchee</b> (guest, #40059)
                              [<a href="/Articles/347652/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <i>[1] Systemtap seems nice, but it doesn't have the post-processing /
visualization for the whole system like LTT does. I see it more like a
tool to do more specific analysis tools.</i>
<p>
I see what you mean.  systemtap people are working on some GUI data
graphing tools, but are just starting.  (I got the impression though
that LTTV was being deprecated in favour of eclipse-based widgets,
which systemtap and other tools could feed data into also.)
<p>
<i>
However, for this kind of stuff it's a bit too complicated (e.g. in embedded environments where you don't want to run stap / compile the scripts on the device itself etc)</i>
<p>
We hope to ease that pain by more automated cross-compilation/execution.

      
          <div class="CommentReplyButton">
            <form action="/Articles/347652/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor347901"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 20, 2009 19:29 UTC (Thu)
                               by <b>oak</b> (guest, #2786)
                              [<a href="/Articles/347901/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I got the impression though that LTTV was being deprecated in favour of </font><br>
eclipse-based widgets<br>
<p>
Do you have any pointers to more information about this?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/347901/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor347903"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 20, 2009 19:32 UTC (Thu)
                               by <b>fuhchee</b> (guest, #40059)
                              [<a href="/Articles/347903/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't want to misrepresent LTTng, so please do take all this<br>
with a grain of salt, but this is what I gathered from the presentations<br>
given at <a href="http://ltt.polymtl.ca/tracingwiki/index.php/TracingMiniSummit2009/">http://ltt.polymtl.ca/tracingwiki/index.php/TracingMiniSu...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/347903/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor347906"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 20, 2009 19:34 UTC (Thu)
                               by <b>fuhchee</b> (guest, #40059)
                              [<a href="/Articles/347906/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Grr, URL screwup, try this:<br>
<a href="http://ltt.polymtl.ca/tracingwiki/index.php/TracingMiniSummit2009">http://ltt.polymtl.ca/tracingwiki/index.php/TracingMiniSu...</a><br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/347906/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor347914"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 20, 2009 20:58 UTC (Thu)
                               by <b>oak</b> (guest, #2786)
                              [<a href="/Articles/347914/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks!  According to this: <br>
<a rel="nofollow" href="http://eclipse.org/linuxtools/projectPages/lttng/">http://eclipse.org/linuxtools/projectPages/lttng/</a><br>
<p>
"The first release, scheduled for September 2009 (code name: Vanilla), <br>
will provide feature parity with the LTTng Viewer (LTTV) v0.12.12."<br>
<p>
And this seemed to have a screenshot of the LTTng plugin:<br>
<a rel="nofollow" href="http://ltt.polymtl.ca/tracingwiki/images/0/00/TMF_-_Tracing_Summit_2009.pdf">http://ltt.polymtl.ca/tracingwiki/images/0/00/TMF_-_Traci...</a><br>
<p>
This was pretty good overview of past &amp; present tracing:<br>
<a rel="nofollow" href="http://ltt.polymtl.ca/tracingwiki/images/5/57/Ts2009-hellwig.odp">http://ltt.polymtl.ca/tracingwiki/images/5/57/Ts2009-hell...</a><br>
<p>
Architecture bit here was annoying:<br>
<a rel="nofollow" href="http://ltt.polymtl.ca/tracingwiki/images/4/46/Ts2009-SystemTracingView.pdf">http://ltt.polymtl.ca/tracingwiki/images/4/46/Ts2009-Syst...</a><br>
<p>
As it assumes that one has a working user-space in problematic cases one <br>
wants to analyze.  Kernel should be able to optionally get the data out <br>
also through some high-speed HW interface without going through user-space <br>
and filling of the flight record buffer would better not rely on <br>
user-space.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/347914/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor348239"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fun with tracepoints</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 22, 2009 16:23 UTC (Sat)
                               by <b>compudj</b> (subscriber, #43335)
                              [<a href="/Articles/348239/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
About your comment on the architecture, I just want to clarify a few points. First, the architecture diagram you see at <a href="http://ltt.polymtl.ca/tracingwiki/images/4/46/Ts2009-SystemTracingView.pdf">http://ltt.polymtl.ca/tracingwiki/images/4/46/Ts2009-Syst...</a> focuses on tracing of userland. In this diagram, kernel tracing is contained within the "kernel trace facilities" box. For user-space tracing, where the goal is to get data out of the applications, it makes sense to consider than user-space is working. As you point out, this assumption makes less sense when we talk about tracing the kernel.<br>
<p>
Second, more specifically about the LTTng kernel tracer, you are right in that the current mechanism used to extract data is a splice() system call controlled by a user-space daemon. However, alternate implementations of ltt-relay-alloc.c and ltt-relay-lockless.c could easily permit to use a high-speed debug interface. This has already been done with earlier LTTng versions for ARM.<br>
<p>
The core of the LTTng kernel tracer therefore does not depend on userland. It's only the peripheral data extraction and trace control modules which depend on working userland. But they could be replaced easily by built-in kernel objects interacting directly with the LTTng kernel API. I made sure all operations we allow from interfaces presented to user-space are also doable from within the kernel.<br>
<p>
Mathieu<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/348239/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2009, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
