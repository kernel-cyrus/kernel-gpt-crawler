        <!DOCTYPE html>
        <html lang="en">
        <head><title>Extended attributes for special files [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/868505/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/868746/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/868505/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Extended attributes for special files</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>This article brought to you by LWN subscribers</b>
<p>
Subscribers to LWN.net made this article &mdash; and everything that
       surrounds it &mdash; possible.  If you appreciate our content, please
       <a href="/Promo/nst-nag3/subscribe">buy a subscription</a> and make the next
       set of articles possible.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>September 9, 2021</br>
           </div>
The Linux extended-attribute mechanism allows the attachment of metadata to
files within a filesystem.  It tends to be little used — at least, in the
absence of a security module like SELinux.  There is interest in how these
attributes work, though, as evidenced by the discussions that have
followed the posting of revisions of <a
href="/ml/linux-kernel/20210902152228.665959-1-vgoyal@redhat.com/">this
patch by Vivek Goyal</a>, which seeks to make a seemingly small change to
the rules regarding extended attributes and special files.
<p>
Specifically, extended attributes (often referred to as "xattrs") are
name-value pairs that can be attached to a file.
The name of an extended attribute is divided into a namespace and an
identifier within the namespace.  The namespace is currently one of
<tt>security</tt>,
<tt>system</tt>, <tt>user</tt>, or <tt>trusted</tt>; each namespace has its
own special rules.  As a general rule, <tt>system</tt> and <tt>trusted</tt>
see little use.  The <tt>security</tt> namespace, instead, is used by a
number of Linux security modules.  An example of a <tt>security</tt>
attribute can be seen by running <tt>getfattr</tt> on a system that is set
up for SELinux:
<p>
<pre>
    cd /; getfattr -d -m - .
    # file: .
    security.selinux="system_u:object_r:root_t:s0"
</pre>
<p>
This is the SELinux label, which is used to determine which access policies
apply to this directory.
A process must have the <tt>CAP_SYS_ADMIN</tt> capability to change
attributes in the <tt>security</tt> namespace; even then, a running
security module might have its own ideas regarding whether to allow a
change to happen.
<p>
The <tt>user</tt> namespace is entirely unprivileged; users may assign
whatever attributes they like to any files they are capable of writing.
There is an exception, though: it is not possible to attach <tt>user</tt>
extended attributes to symbolic links or device special files.  The <a
href="https://man7.org/linux/man-pages/man7/xattr.7.html">man page</a>
describes this restriction as a control on resource consumption; if any
process that can write to <tt>/dev/null</tt> can attach extended attributes
to it, the disk could quickly fill with attribute data.  It is still possible
for a suitably privileged process to attach <tt>security</tt> extended
attributes to those files.
<p>
Goyal's patch relaxes that restriction slightly, so that a process that
owns a symbolic link or device special file would be able to attach
<tt>user</tt> extended attributes to that file.  That allows users to
change files they have control over anyway while avoiding the
<tt>/dev/null</tt> problem.  It seems to many like a reasonable change to
make, but Andreas Gruenbacher <a
href="/ml/linux-kernel/CAHc6FU4foW+9ZwTRis3DXSJSMAvdb4jXcq7EFFArYgX7FQ1QYg@mail.gmail.com/">opposed
it</a>:
<p>
<blockquote class="bq">
	The idea behind user.* xattrs is that they behave similar to file
	contents as far as permissions go. It follows from that that
	symlinks and special files cannot have user.* xattrs. This has been
	the model for many years now and applications may be expecting
	these semantics, so we cannot simply change the behavior.
</blockquote>
<p>
The possibility of breaking user space in subtle ways is indeed worrisome;
Goyal has <a
href="/ml/linux-kernel/YTEcYkAA2F1FhOvF@redhat.com/">suggested</a> that the
new behavior could be made opt-in to avoid creating such surprises.  But
the bigger sticking point has to do with the intended use case for this
feature.  Kernel developers will normally ask why a new behavior is needed;
that information is necessary to evaluate whether the proposed solution is
indeed the best way to solve the problem.  In this case, not all of them
were happy with the answer.
<p>
Goyal is working on virtualization and, in particular, with use cases
where guests want to share a filesystem with the host.  The kernel's <a
href="https://www.kernel.org/doc/html/latest/filesystems/virtiofs.html">virtiofs
filesystem</a> is designed for this application; it functions as a sort of
FUSE filesystem that runs over  Virtio, so it performs
reasonably well.  On the host side, the <a
href="https://qemu.readthedocs.io/en/latest/tools/virtiofsd.html">virtiofsd
daemon</a> performs the actual filesystem access needed by the client.
<p>
Virtiofsd tries to drop as many capabilities as possible, though it must
still be able to manipulate files owned by any user and group ID.  It seems
to work well, except for one little problem: <tt>security</tt> extended
attributes.  The client may want to manipulate those attributes within the
filesystem, but the host may prevent virtiofsd from carrying out those
changes.  In particular, if the host is running a security module like
SELinux, that module will be placing its own interpretation on those
attributes and may not be appreciative of the changes that virtiofsd is
trying to make.  Changing those extended attributes requires
<tt>CAP_SYS_ADMIN</tt> in any case, and virtiofsd is trying to run without
that capability.
<p>
The answer to the problem, naturally, is another layer of indirection.
When properly configured, virtiofsd is able to remap extended attributes
between the guest and the host; it can, for example, be made to turn the
<tt>security</tt> attributes managed by the guest into <tt>user</tt>
attributes on the host.  No privilege is required for virtiofsd to change
<tt>user</tt> attributes, so everything works as desired.
<p>
More accurately, <i>almost</i> everything works as desired.  As Goyal
notes, when the guest 
goes into the dreaded relabeling coma that SELinux seems to require from
time to time, errors result.  The problem is the restriction on
<tt>user</tt> extended attributes for special files; the guest is trying to
relabel its devices, but the host cannot assign those labels (remapped as
<tt>user</tt> extended attributes) to the appropriate special files.  That
problem is what is driving
Goyal's patch relaxing the restrictions, which makes this use case work.
<p>
Casey Schaufler <a
href="/ml/linux-kernel/79dcd300-a441-cdba-e523-324733f892ca@schaufler-ca.com/">let
it be known</a> that he had no problem with assigning <tt>user</tt>
extended attributes to special files.  But the remapping done in virtiofsd,
he said, is "<q>unreasonable</q>":
<p>
<blockquote class="bq">
	As I have stated before, this introduces a breach in security.  It
	allows an unprivileged process on the host to manipulate the
	security state of the guest. This is horribly wrong. It is not
	sufficient to claim that the breach requires misconfiguration to
	exploit.  Don't do this.
</blockquote>
<p>
Schaufler and Goyal have gone around on this topic numerous times over the
three revisions of this patch set.  Schaufler contends that the only secure
way to handle a situation like this is for host-side changes to require the
same level of privilege as is required on the guest.  So, for example, it
would be acceptable to remap the <tt>security</tt> extended attributes into the
<tt>trusted</tt> namespace (which also requires <tt>CAP_SYS_ADMIN</tt>)
instead.  Goyal, meanwhile, continues to look for a solution that does not
require additional privilege in virtiofsd.
<p>
That solution, in the end, may take a bit of a different form, inspired by <a
href="/ml/linux-kernel/YTYoEDT+YOtCHXW0@work-vm/">this observation</a> from
David Alan Gilbert:
<p>
<blockquote class="bq">
	IMHO the real problem here is that the user/trusted/system/security
	'namespaces' are arbitrary hacks rather than a proper namespacing
	mechanism that allows you to create new (nested) namespaces and
	associate permissions with each one.
<p>
	Each one carries with it some arbitrary baggage (trusted not working on
	NFS, user. having the special rules on symlinks etc).
</blockquote>
<p>
Miklos Szeredi <a
href="/ml/linux-kernel/CAJfpegvbkmdneMxMjYMuNM4+RmWT8S7gaTiDzaq+TCzb0UrQrw@mail.gmail.com/">suggested</a>
a next step (evidently originally proposed by Eric Biederman) to adapt
<tt>trusted</tt> extended attributes for use within <a
href="/Articles/532593/">user namespaces</a>.  If a given user namespace is
owned by user ID 1000, then <tt>trusted.foo</tt> within the namespace would
be stored (and visible) in the initial namespace as something like
<tt>trusted&lt;1000&gt;.foo</tt>.  Virtiofsd could be run within a user
namespace and use the <tt>trusted</tt> extended attributes without any
extra privilege, and security modules on the host would still have a say in
how those attributes are managed.  Goyal <a
href="/ml/linux-kernel/YTfcT1JUactPhwSA@redhat.com/">agreed</a> that this
approach might work.
<p>
The only problem is that somebody has to implement the new behavior for
user namespaces — a complex part of the system where it is easy to make
security-wrecking mistakes.  Biederman has already <a
href="/ml/linux-kernel/87lf47tahb.fsf@disp2133/">pointed out</a> one
potential problem related to nested namespaces.  But, assuming that feature
can be safely provided, Goyal's original problem should be solvable.
<i>This</i> is why kernel developers tend to be inquisitive about the use
cases driving a proposed change: the best solution to a problem is often
not the first one that comes to mind.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems-Extended_attributes">Filesystems/Extended attributes</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Virtualization">Virtualization</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/868505/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor868787"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 9, 2021 22:45 UTC (Thu)
                               by <b>xecycle</b> (subscriber, #140261)
                              [<a href="/Articles/868787/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
&quot;system and trusted see little use&quot; --- well, no idea about system, but I have seen trusted.overlay* just this week; I guess it is being used by a huge portion of the docker/OCI community.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868787/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868803"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2021 0:25 UTC (Fri)
                               by <b>vgoyal</b> (subscriber, #49279)
                              [<a href="/Articles/868803/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes trusted.* is used by overlay. But I think with unprivileged mounting of overlayfs that was not possible as mounter did not have CAP_SYS_ADMIN in init_user_ns. So overlay had to switch to using user.* extended attributes. (Check mount option -o userxattr) to support unprivileged mounting.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868803/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor868800"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2021 0:22 UTC (Fri)
                               by <b>pabs</b> (subscriber, #43278)
                              [<a href="/Articles/868800/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I would go with namespace.1000.trusted.foo rather than trusted&lt;1000&gt;.foo, or are there size limits on xattr names?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868800/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868836"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2021 13:20 UTC (Fri)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/868836/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Whatever the limitations are, I agree that something that could be produced via concatenation of a prefix and the original name would be preferable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868836/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor868825"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2021 9:04 UTC (Fri)
                               by <b>scientes</b> (guest, #83068)
                              [<a href="/Articles/868825/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Attributes are not files. A file is an ordered byte stream with a size, and files are organized into a tree with a root. Attributes break the abstraction that make files useful.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868825/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868826"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2021 9:05 UTC (Fri)
                               by <b>scientes</b> (guest, #83068)
                              [<a href="/Articles/868826/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And sparse files are fine.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868826/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868881"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2021 16:38 UTC (Fri)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/868881/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sparse files are nothing more than an optimization. If the kernel went around opportunistically poking holes in files with lots of consecutive zeros, it would not break anything as far as I can tell (except for apps that assume that SEEK_HOLE always returns offsets which you can predict based on where you intentionally poked holes from userspace, a notion which the lseek(2) man page flatly contradicts).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868881/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868900"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2021 18:49 UTC (Fri)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/868900/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; If the kernel went around opportunistically poking holes in files with lots of consecutive zeros, it would not break anything as far as I can tell….</font><br>
<p>
I think that would break swap files. The swapon(8) manual page[0] suggests that they are still required to be fully allocated, without holes.<br>
<p>
Sometimes non-sparseness is better for performance, since filling holes in sparse files requires block allocation and can lead to fragmentation. One can also easily imagine workflows that would break if writing to file which was fully allocated returned ENOSPC because consecutive zeros were replaced with a hole and the space was subsequently reallocated to something else.<br>
<p>
[0] <a href="https://manpages.ubuntu.com/manpages/eoan/en/man8/swapon.8.html#notes">https://manpages.ubuntu.com/manpages/eoan/en/man8/swapon....</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868900/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor868906"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2021 19:02 UTC (Fri)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/868906/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I think that would break swap files. The swapon(8) manual page[0] suggests that they are still required to be fully allocated, without holes.</font><br>
<p>
I&#x27;m pretty certain you&#x27;re right. I seem to remember something about swap digging through the file system layer to get the raw blocks. The swap mechanism apparently writes directly to the disk layer. I think that because it hibernates to swap, it needs to know the disk blocks, a bit like lilo did/does.<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868906/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor868968"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 11, 2021 22:22 UTC (Sat)
                               by <b>NYKevin</b> (subscriber, #129325)
                              [<a href="/Articles/868968/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, sure, but that&#x27;s mostly because swap files are terrible and weird. They&#x27;re also part of the kernel, so arguably the kernel could just not poke holes in them in the first place.<br>
<p>
<font class="QuotedText">&gt; Then how would the kernel know whether you&#x27;re about to run swapon(8) on some random file in e.g. /home/whoever?</font><br>
<p>
And that&#x27;s *why* swap files are terrible. The kernel has no way of knowing whether something is going to be swapon&#x27;d, so if you do any funny business with block allocation, including COW stuff that btrfs (and zfs?) actually want to do, then you break swap files, swapon randomly fails, and whatever userspace utility is invoking it just has to deal with not having a usable swap file (or it has to recreate it and hope the filesystem plays nice this time around). For now, said COW stuff is sufficiently rare that it&#x27;s not a Real Problem™ yet, but give it time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868968/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor868984"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 12, 2021 11:27 UTC (Sun)
                               by <b>eru</b> (subscriber, #2753)
                              [<a href="/Articles/868984/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>
&gt;<i>One can also easily imagine workflows that would break if writing to file which was fully allocated returned ENOSPC because consecutive zeros were replaced with a hole</i>
<p>
I think the same thing can happen with transparently compressed files, such as those supported by btrfs. In fact, the poking holes method would just be a simple form of transparent file compression.


      
          <div class="CommentReplyButton">
            <form action="/Articles/868984/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor869255"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 15, 2021 9:26 UTC (Wed)
                               by <b>geert</b> (subscriber, #98403)
                              [<a href="/Articles/869255/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
SEEK_HOLE sounds like a great side-channel to store hidden information in a file containing all zeroes ;-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/869255/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor868915"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2021 23:42 UTC (Fri)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/868915/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;A file is an ordered byte stream with a size, and files are organized into a tree with a root. Attributes break the abstraction that make files useful.</font><br>
<p>
Unix has always stored attributes like access time in the filesystem, and while the Unix-style file has won out, many systems have had files with heavy attributes like file types or even non-byte stream oriented, always quite useful to the users of that OS.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/868915/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor869034"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 13, 2021 5:18 UTC (Mon)
                               by <b>raof</b> (subscriber, #57409)
                              [<a href="/Articles/869034/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Yeah. It turns out that there are lots of pieces of generally useful information you can have about an ordered byte stream with a known size. Name, access times, owner, permissions, an <i>entirely different</i> way of specifying permissions, and so on.


      
          <div class="CommentReplyButton">
            <form action="/Articles/869034/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor869122"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 13, 2021 20:08 UTC (Mon)
                               by <b>ballombe</b> (subscriber, #9523)
                              [<a href="/Articles/869122/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Under Unix, to change metadata like the filename, you need write permission to the directory, not to the file itself, but this is the opposite for extended attributes (which cause the /dev/null problem in the first place!).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/869122/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor869158"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 14, 2021 6:10 UTC (Tue)
                               by <b>jem</b> (subscriber, #24231)
                              [<a href="/Articles/869158/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <q>Under Unix, to change metadata like the filename, you need write permission to the directory, but this is the opposite for extended attributes.</q>

<p>
Changing the filename is the <b>only</b> piece of metadata you need write permission to the directory, it is the opposite for all other metadata. Also, it is arguable whether the filename is part of the file metadata at all, under the Unix model.</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/869158/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor869178"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 14, 2021 12:20 UTC (Tue)
                               by <b>anselm</b> (subscriber, #2796)
                              [<a href="/Articles/869178/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote><em>Also, it is arguable whether the filename is part of the file metadata at all, under the Unix model.</em></blockquote>
<p>
I'd say it's pretty clear that in Unix-like systems, the filename is <em>not</em> part of the file metadata. After all, a file “knows” how <em>many</em> names it has, but not what these names are. To actually figure those out you have to examine the whole directory tree on that device to check for hard links to the file's inode – there's no way of getting the names directly from the file itself.
</p>



      
          <div class="CommentReplyButton">
            <form action="/Articles/869178/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor869484"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 17, 2021 13:18 UTC (Fri)
                               by <b>jschrod</b> (subscriber, #1646)
                              [<a href="/Articles/869484/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Having been raised at a time when OS/370 was the prominent OS, I take exception to the notion that files are &quot;an ordered stream of bytes&quot;.<br>
<p>
And I don&#x27;t even take into account that we would first have to define what a &quot;byte&quot; is. Maybe you take octets for granted - they aren&#x27;t.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/869484/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor869329"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 16, 2021 2:37 UTC (Thu)
                               by <b>jamesmorris</b> (subscriber, #82698)
                              [<a href="/Articles/869329/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Interesting definition of little-used -- RHEL, CentOS, Fedora, and billions Android devices.<br>
 <br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/869329/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor869335"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 16, 2021 3:10 UTC (Thu)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/869335/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Interesting definition of little-used -- RHEL, CentOS, Fedora, and billions Android devices.</font><br>
<p>
Yeah but that&#x27;s because of SELinux.  I believe the intent of the statement in context, is that it is not widely used outside of it&#x27;s use in SELinux.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/869335/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor869362"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 16, 2021 11:09 UTC (Thu)
                               by <b>mbunkus</b> (subscriber, #87248)
                              [<a href="/Articles/869362/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Samba stores Windows ACLs in extended attributes.<br>
<p>
Linux (POSIX) ACLs are stored in extended attributes (as &quot;system.posix_acl_access&quot; and &quot;system.posix_acl_default&quot;).<br>
<p>
Special capabilities such as cap_net_raw for the ping command are stored in extended attributes (as &quot;security.capability&quot;). A lot of distributions use these.<br>
<p>
See &quot;man 7 xattr&quot; for further examples. It&#x27;s not just SELinux.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/869362/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor870052"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 22, 2021 20:46 UTC (Wed)
                               by <b>rwmj</b> (subscriber, #5474)
                              [<a href="/Articles/870052/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
While it&#x27;s certainly convenient for virtiofsd to store the security attributes as xattrs, does it really need to do that?  Couldn&#x27;t it store them in a cache somewhere else entirely?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/870052/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor870330"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Extended attributes for special files</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 24, 2021 10:48 UTC (Fri)
                               by <b>njs</b> (guest, #40338)
                              [<a href="/Articles/870330/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I suspect you&#x27;d run into nasty cache consistency issues. For example, the guest expects rename() to be atomic, which is difficult if the host has to convert it into a rename() + a separate metadata db update.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/870330/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2021, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
