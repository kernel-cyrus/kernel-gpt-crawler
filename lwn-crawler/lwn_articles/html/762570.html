        <!DOCTYPE html>
        <html lang="en">
        <head><title>Meltdown strikes back: the L1 terminal fault vulnerability [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/762570/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/762218/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/762570/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Meltdown strikes back: the L1 terminal fault vulnerability</h1>
</div>
<div class="ArticleText">
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>August 14, 2018</br>
           </div>
The Meltdown CPU vulnerability, first <a
href="/Articles/742702/">disclosed</a> in early January, was frightening
because it allowed unprivileged attackers to easily read arbitrary memory
in the system.  Spectre, disclosed at the same time, was harder to exploit
but made it possible for guests running in virtual machines to attack the
host system and other guests.  Both vulnerabilities have been mitigated to
some extent 
(though it will take a long time <a href="/Articles/744287/">to even find
all of the Spectre 
vulnerabilities</a>, much less protect against them).  But now the <a
href="https://software.intel.com/security-software-guidance/software-guidance/l1-terminal-fault">newly 
disclosed</a> "L1 terminal fault" (L1TF) vulnerability
(also going by the name <a
href="https://foreshadowattack.eu/">Foreshadow</a>) brings back both
threats: relatively
easy attacks against host memory from inside a guest.  Mitigations are
available (and have been <a
href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=958f338e96f874a0d29442396d6adf9c1e17aa2d">merged
into the mainline kernel</a>), but they will be expensive for some users.
<p>
<h4>Page-table entries</h4>
<p>
Understanding L1TF requires an understanding of the x86 page-table entry
(PTE) format.  Remember that, in a virtual-memory system, the memory
addresses used by both user space and the kernel do not point directly into
physical memory.  Instead, the hierarchical page-table structure is used to
translate between virtual and physical addresses.  At the bottom level of
this structure, the PTE tells the processor whether the page is actually
present in physical memory, where it is, and a few other details.  It looks
like this for a 4KB page on an x86-64 system:
<p>
<blockquote>
  <img src="https://static.lwn.net/images/2018/pte64.png" alt="[page-table entry]" class="photo">
</blockquote>  
<p><blockquote class="ad">
<b><tt>$ sudo subscribe today</tt></b>
<p>
Subscribe today and elevate your LWN privileges. You’ll have
access to all of LWN’s high-quality articles as soon as they’re
published, and help support LWN in the process.  <a href="https://lwn.net/Promo/nst-sudo/claim">Act now</a> and you can start with a free trial subscription.
</blockquote>
<p>
The page-frame number (PFN) tells the processor where to find the page in
physical memory.  The other bits control which <a
href="/Articles/689395/">memory protection</a> key is assigned to the page,
access permissions, whether and how the page is cached, whether it is
dirty, and more.  All of this, though, depends on the present ("P") bit in
the least-significant position.  If that bit is not set, the page is not
actually present in physical memory, and any attempt to reference it
will generate a page fault.
<p>
For non-present pages, none of the other bits in the page-table entry
are meant to be used by the processor, so the kernel can use those
bits to store useful information; for example, for pages that
have been swapped out, the location in the swap area is stored in the PTE.  In
other cases, the data left in non-present PTEs is essentially random.

<p>
<h4>Ignoring the present bit</h4>
<p>

If the present bit in a given PTE is not set, the PFN number field of that
PTE has no defined meaning and the CPU has no business trying to use it.
So, naturally, Intel CPUs do exactly that during speculative execution (it
would appear that Intel is the only vendor to make this particular
mistake).  During speculative execution, non-present PTEs are treated as if
they were valid, so non-present PTEs can be used to speculatively
read whatever data lives in the indicated PFN — but, importantly, only if
that data is in the processor's L1 cache.  The access is speculative only;
the processor will eventually notice that the page is not actually present
and generate a page fault instead.  But, by the time that happens, the
usual sorts of covert channels can be used to exfiltrate the data in
whatever page the PTE might have pointed to.

<p>
Since this attack goes directly to a physical address, it can in theory
read any memory in the system.  Notably, that includes data kept within an
<a href="/Articles/686808/">SGX encrypted enclave</a>, which is supposed to
be protected from this kind of thing.
<p>
Exploiting this vulnerability requires the ability to run code on the
target system.  Even then, on its face, this bug is
somewhat hard to exploit.  Attackers cannot directly create non-present
PTEs pointing to a page of interest, so they must depend on such PTEs
already existing in their address space.  By filling the address space with
pages that will eventually get reclaimed or by playing tricks with
<tt>PROT_NONE</tt> mappings, an attacker can essentially throw
darts at the system and hope that one hits in an interesting place, but
it's a non-deterministic process where it's  even hard to tell if one has
succeeded.
<p>
Nonetheless, the potential for the extraction of important secrets exists,
and thus this bug must be defended against.  The approach taken here is to
simply invert all of the bits in a PTE when it is marked as being not
present; that will cause that PTE  to point into a nonexistent region of memory.
The fix is easy, and the performance cost is almost zero.  A quick kernel
upgrade, and this problem is solved.
<p>
<h4>Virtualization</h4>
<p>
At least, the problem is solved on systems where virtualization is not in
use.  On systems with virtualized guests then, at a minimum, those guests 
must also run a kernel using the PTE-inversion 
technique to protect against attacks.  If guests are trusted, or if they
cannot install their own kernels, the problem stops here.
<p>
But if the system is running with untrusted guests and, in
particular, if that system allows those guests to provide their own kernels
(as many hosting services do), the situation changes.  An attacker can then
run a kernel that creates arbitrary non-present PTEs on demand, turning a
shot-in-the-dark attack into something that can be targeted with
precision.  To make an attacker's life even easier, the speculative
data reference bypasses the <a
href="https://en.wikipedia.org/wiki/Second_Level_Address_Translation">extended
page tables</a> in the guest, allowing direct access to physical memory.
So an attacker who can install a kernel in a guest instance can attack the
host (or other guests) with relative ease.  In this context, L1TF can be
seen as a limited form of Meltdown that can escape virtualization.
<p>

Protecting against hostile guests is a harder task, and the correct answer
will depend on the specifics of the workload being run.  The first step is
to take advantage of the fact that L1TF can only read data that is in the
processor's L1 cache.  If that cache is cleared every time the kernel
transfers control to a virtual machine, there will be no data available for
the attacker to read.  That is indeed what the kernel will do.  This
mitigation will be rather more costly, needless to say; how much it costs
will depend on the workload.  On systems where entries into (and exits
from) guests are relatively rare, the cost will be low.  On systems where
those events are common, the cost could approach a 50% performance hit.
<p>
Unfortunately, just clearing the L1 cache is not a complete solution if the
CPU is running symmetric multi-threading (SMT or "hyperthreads").  The
threads running on that processor share the L1 cache.  So, while the
hostile guest is running in one thread, an unrelated process could be
repopulating the L1 cache with interesting data in the other thread.  That
clearly reopens the can of worms.
<p>
The obvious solution here is to disable SMT, which can potentially protect
against other security issues as well.  But that clearly comes with a
significant performance cost of it own.  It is not as bad as simply removing
half of the system's processors, but, in a virtual sense, that is exactly
what is happening.  An alternative is to use CPU affinities to restrict
guests to specific processors and to not allow anything else (including,
for example, kernel functionality like interrupt handling) to run on those
processors.  This approach might gain back some performance for specific
workloads, but it clearly requires a lot of administrator knowledge about
what those workloads are and a lot of manual configuration.  It also seems
somewhat error-prone.
<p>
There is another approach that can be taken to protect hosts from hostile
guests: rather than do all of the above, simply disable the use of the
extended page-table feature.  That forces the system back to the older
"shadow page table" mechanism, where the hypervisor retains the ultimate
control over all PTEs.  This, too, will slow things down significantly, but
it provides complete protection since the attacker is no longer able to
create non-present PTEs pointing to pages of interest.
<p>
As an aside, it's worth pointing out an interesting implication of this
vulnerability.  Virtualization is generally seen as being more secure than
containers due to the extra level of isolation used.  But, as we see here,
virtualization also requires an extra level of processor complexity that
can be the source of security problems in its own right.  Systems running
container workloads will be only lightly affected by L1TF, while those
running virtualization will pay a heavy cost.

<h4>Kernel settings</h4>

Patched kernels will perform the inversion on non-present PTEs
automatically.  Since there is no real cost to this technique, there is no
reason (and no ability) to turn it off.  The flushing of the L1 cache on
entry to virtual guests will be done if extended page tables are enabled.
The disabling of SMT, though, will not be done by default; administrators
of systems running untrusted guests will have to examine the tradeoffs and
decide what the best approach is to protect their systems.  For people
faced with this kind of choice, some more information can be found in
<a href="/Articles/762569/">Documentation/admin-guide/l1tf.rst</a>.

<p>
The 4.19 kernel will contain the mitigations, of course.  As of this
writing, the <a href="/Articles/762571/">4.18.1</a>, <a
href="/Articles/762572/">4.17.15</a>,
<a href="/Articles/762573/">4.14.63</a>,
<a href="/Articles/762574/">4.9.120</a>, and
<a href="/Articles/762575/">4.4.148</a>
updates, containing the fixes, are in
the review process with release planned on August&nbsp;16.

<p>
As was the case with the previous rounds, the mitigations for L1TF were
worked out under strict embargo.  The process appears to have worked a
little better this time around, with no real leakage of information to
force an early disclosure.  One can only wonder how many more of these are
known and under embargo now — and how many are yet to be discovered.  It
seems likely that we will be contending with speculative-execution
vulnerabilities for some time yet.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-Meltdown_and_Spectre">Security/Meltdown and Spectre</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Hardware_vulnerabilities">Hardware vulnerabilities</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Meltdown_and_Spectre">Meltdown and Spectre</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/762570/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor762580"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 14, 2018 18:29 UTC (Tue)
                               by <b>clopez</b> (guest, #66009)
                              [<a href="/Articles/762580/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This only affects Intel CPUs... AMD is safe.. right?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762580/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762581"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 14, 2018 18:32 UTC (Tue)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/762581/">Link</a>] 
      </p>
      
      </div>
      </summary>
      That is my understanding, yes; this only only affects Intel.
      
          <div class="CommentReplyButton">
            <form action="/Articles/762581/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor762583"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 14, 2018 18:58 UTC (Tue)
                               by <b>danpb</b> (subscriber, #4831)
                              [<a href="/Articles/762583/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Correct, this only affects Intel x86 CPUs.   AMD x86 is not affected, nor are non-x86 architectures.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762583/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor762708"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 15:31 UTC (Wed)
                               by <b>Curan</b> (subscriber, #66186)
                              [<a href="/Articles/762708/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <a href="https://www.kernel.org/doc/html/latest/admin-guide/l1tf.html#affected-processors">Yes, only Intel is affected</a>, according to the kernel documentation.
      
          <div class="CommentReplyButton">
            <form action="/Articles/762708/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762740"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 23:25 UTC (Wed)
                               by <b>rahvin</b> (guest, #16953)
                              [<a href="/Articles/762740/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The developer of the hack only evaluated Intel, they think AMD does it different so it's probably not vulnerable but I would like to see someone come out and say they tested this hack and it's variants of this technique on AMD before we completely clear it. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762740/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor762584"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 14, 2018 19:16 UTC (Tue)
                               by <b>smoogen</b> (subscriber, #97)
                              [<a href="/Articles/762584/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Systems running container workloads will be only lightly affected by L1TF, while those running virtualization will pay a heavy cost.</font><br>
<p>
This may be obvious, but are you talking about containers in any environment or only if they are running on baremetal? Many of the container systems I have seen run them inside a virtualized environment sitting on top of baremetal to allow for one thing to do what its best at, and the other to do something else. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762584/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762589"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 14, 2018 20:31 UTC (Tue)
                               by <b>ssl</b> (guest, #98177)
                              [<a href="/Articles/762589/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The ownership is crucial here. If you own both the virtual infrastructure (=hypervisor) and the container hosting VM's (and all the other guests) then it's not as big problem for you. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762589/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762629"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 11:48 UTC (Wed)
                               by <b>danpb</b> (subscriber, #4831)
                              [<a href="/Articles/762629/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Even if the same person/organization owns the guest VM and host, the "trusted" guest VM can become "untrustworthy" if some software component in it gets compromised (through one of the countless bugs all complex software has). So if they're relying on use of VMs to isolate their applications from each other, the risk is still notable even in the single owner case.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762629/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762745"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 16, 2018 3:08 UTC (Thu)
                               by <b>Rearden</b> (subscriber, #35172)
                              [<a href="/Articles/762745/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But, there would be no reason for a "friendly" VM to run the unpatched kernel in the virtualized environment.  The issue for hostile hosts only manifests when the "attacker" can run an un-patched kernel in the VM.  As long as the VM's kernel is patched to invert the PFN, then it doesn't matter if someone attempts the attack against the VM kernel, it won't be affected.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762745/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762836"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 16, 2018 18:42 UTC (Thu)
                               by <b>jcm</b> (subscriber, #18262)
                              [<a href="/Articles/762836/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A "trusted" VM doesn't exist in reality. There are always going to be new bugs discovered that a determined attacker can use to compromise and perform privilege escalation. Then that "trusted" kernel becomes whatever they want very quickly. This is a nuance that isn't getting the necessary attention because it's a boring detail...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762836/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762859"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2018 0:01 UTC (Fri)
                               by <b>Rearden</b> (subscriber, #35172)
                              [<a href="/Articles/762859/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think that argument is pretty reductive, and goes well past individual mitigation for this particular threat, and the reason why it's not strictly required to take extra steps in the case where both the Host and Guest OS's are "trusted".  <br>
<p>
Of course some futher privilege escalation vulnerability could expose the VM host OS to this, but a further privilege escalation vulnerability would likely also expose all sorts of other things as well, this vulnerability being just one of many.  <br>
<p>
Big picture security comes down to risk mitigation through a layered approach, depending on the resources available and the risk associated with a particular breach.  Some future, possible "privilege escalation" vulnerability must be planned for outside of the rememdy for this specific vulnerability.  What I mean is, if your workflow and risk for a system that you own both the VM and Host OS is high enough that a compromise of one could impact imporant data, you probably need to be taking the steps associated with "untrusted" guest VMs anyway.  <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762859/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor769342"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 24, 2018 6:48 UTC (Wed)
                               by <b>alejluther</b> (subscriber, #5404)
                              [<a href="/Articles/769342/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, it does exist. You are thinking in a VM with a server role serving client requests, so clients specifically access the system, so vulneravilities  can be exploited. But VMs could have other services not directly connected or accessible to clients. For example, telcos have VMs working with packets where those packets do not have the VM as the endpoint.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/769342/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor762587"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 14, 2018 19:40 UTC (Tue)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/762587/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Note that the "conditional cache flushes" mode should incur only a modest performance penalty (on top of what you get from disabling SMT).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762587/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor762588"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 14, 2018 20:19 UTC (Tue)
                               by <b>nilsmeyer</b> (guest, #122604)
                              [<a href="/Articles/762588/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Was this the same type of anti-competitive embargo that has been employed with Metldown, giving unfair advantage to the bigger cloud providers? <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762588/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor762594"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 14, 2018 21:46 UTC (Tue)
                               by <b>Sesse</b> (subscriber, #53779)
                              [<a href="/Articles/762594/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Is there a way to enable SMT but only schedule threads from the same user/VM on the hyperthread pair? That would seem to keep security, while still keeping most of the performance advantages.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762594/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762597"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 14, 2018 22:35 UTC (Tue)
                               by <b>nilsmeyer</b> (guest, #122604)
                              [<a href="/Articles/762597/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You will also need to take care that nothing outside the VM is scheduled there (kernel threads, interrupts etc.). <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762597/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762598"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 14, 2018 22:37 UTC (Tue)
                               by <b>Sesse</b> (subscriber, #53779)
                              [<a href="/Articles/762598/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes—one would think this would be a good feature for a scheduler to have in general. (Think side-channel attacks in general.)<br>
<p>
OpenBSD “solves” this by simply not supporting hyperthreading, but that seems too heavy-handed to me.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762598/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762718"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 18:32 UTC (Wed)
                               by <b>jcm</b> (subscriber, #18262)
                              [<a href="/Articles/762718/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It would be nice if we could guarantee no secrets were loaded, track, and flush them, but this isn't something most general purpose OS stacks running a full environment on a host do today. It is something some hypervisors are doing to mitigate against L1TF, and obviously is going to be investigated over time to improve the state of available mitigations on Linux, but it's very non-trivial.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762718/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762719"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 18:34 UTC (Wed)
                               by <b>Sesse</b> (subscriber, #53779)
                              [<a href="/Articles/762719/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
FWIW, my request was for just “not at the same time” (to make timing attacks much harder), not flushing L1 on every context switch. That's too heavy-handed for most userspace.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762719/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor762614"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 8:00 UTC (Wed)
                               by <b>vbabka</b> (subscriber, #91706)
                              [<a href="/Articles/762614/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Looks like Microsoft went with this approach for Hyper-V: <a href="https://blogs.technet.microsoft.com/virtualization/2018/08/14/hyper-v-hyperclear/">https://blogs.technet.microsoft.com/virtualization/2018/0...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762614/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762635"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 14:02 UTC (Wed)
                               by <b>nilsmeyer</b> (guest, #122604)
                              [<a href="/Articles/762635/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Which also goes to show that they had advance knowledge of the vulnerability. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762635/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762638"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 14:17 UTC (Wed)
                               by <b>JoelWilliamson</b> (guest, #105956)
                              [<a href="/Articles/762638/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It looks like the Core Scheduler for Hyper-V was introduced in 2016. I'm sure Microsoft had some advance knowledge, but I doubt they knew about this before Project Zero discovered Meltdown/Spectre. More likely, Microsoft introduced this as a general mitigation against any leaking between threads sharing a core, or simply to give guests a bit more control of their own scheduling.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762638/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762721"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 18:46 UTC (Wed)
                               by <b>jcm</b> (subscriber, #18262)
                              [<a href="/Articles/762721/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
We should give kudos to Microsoft here. They thought about the potential risks from tight resource sharing some time ago and obviously were able to invest significantly ahead of any one vulnerability such as this one in secret scrubbing/address space isolation/core scheduling/etc. This is something that we'll need to look at in Linux and other OSes over time if we want to make HT totally safe as well. It's a great example of what's possible, but a big lift. We do need to also get over the mindset that SMT threads are "cores". Especially in projects like OpenStack. An SMT thread is not a core, and we should never treat it as such, but it's easy to think in those terms when looking at /proc/cpuinfo output and just counting "cpus".<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762721/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor763357"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 23, 2018 22:56 UTC (Thu)
                               by <b>ssmith32</b> (subscriber, #72404)
                              [<a href="/Articles/763357/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You are correct. Reading the article makes that clear. The default in server 2016 is the classic scheduler, which does not bind LP to VP 1:1. The core scheduler was introduced as an option in Server 2016, both for security &amp; performance SLA reasons.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/763357/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor762602"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 0:52 UTC (Wed)
                               by <b>ncm</b> (guest, #165)
                              [<a href="/Articles/762602/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
More top-quality reporting, reminding us how valuable our subscriptions are.<br>
<p>
I wonder, though. If we zero out the empty page table entries, how do we know where to look for backing store, in swap, when we fault?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762602/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762605"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 2:03 UTC (Wed)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/762605/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      PTEs are not zeroed out, they are bitwise inverted, so the information is still there. Sorry if that wasn't clear.
      
          <div class="CommentReplyButton">
            <form action="/Articles/762605/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762608"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 7:09 UTC (Wed)
                               by <b>HIGHGuY</b> (subscriber, #62277)
                              [<a href="/Articles/762608/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One thing that I haven't come across anywhere is: how can we be sure that the inverted pte never points into something valid? Doesn't this just shift the problem around?<br>
<p>
(I'm sure this was thought through, I just couldn't find why this is ok to do)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762608/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762609"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 7:23 UTC (Wed)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/762609/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It would require several terabytes of swap.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762609/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762612"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 7:55 UTC (Wed)
                               by <b>vbabka</b> (subscriber, #91706)
                              [<a href="/Articles/762612/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The swap size is in fact limited on vulnerable CPU's so that it's not possible to exceed it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762612/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor762720"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 18:36 UTC (Wed)
                               by <b>jcm</b> (subscriber, #18262)
                              [<a href="/Articles/762720/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There is a limit depending upon configured MAXPHYADDR and the number of bits/translation levels supported. Effectively, even with things like Superdome, there are no boxes shipping today where it's a problem. In theory, it /could/ become a problem prior to future platforms with 5-level paging (extra PA bits) but I raised this very corner case a few months ago to keep an eye on it. Now this is public, I'll ping the vendors I can think of who might be impacted and ask them to further consider for future platforms.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762720/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor762923"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2018 21:47 UTC (Fri)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/762923/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One of the bits that is inverted is the "Uncached" bit. The CPU will not attempt to speculatively bring a cache line in from an uncached page.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762923/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor762610"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 7:41 UTC (Wed)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/762610/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; PTEs are not zeroed out, they are bitwise inverted, so the information is still there. </font><br>
<p>
So for decades hardware has tried really hard to hide from software crazy optimizations like instruction-level parallelism, out of order and of course speculative execution. <br>
<p>
Now software is more and more hiding data from hardware to indirectly block some of that.<br>
<p>
I just can't stop admiring the irony.<br>
<p>
<font class="QuotedText">&gt; Sorry if that wasn't clear.</font><br>
<p>
It was all there, just not super mega obvious why.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762610/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor762623"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 10:51 UTC (Wed)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/762623/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One very important issue that the article didn't discuss (maybe it deserves its own article?) --- by extracting secrets from Intel's architectural enclaves, the existence of these attacks has severely damaged the SGX remote attestation ecosystem.<br>
<p>
<font class="QuotedText">&gt; Was the remote attestation protocol affected by Foreshadow?</font><br>
<font class="QuotedText">&gt; Yes. Using Foreshadow we have successfully extracted the attestation keys, used by the Intel Quoting Enclave to vouch for the authenticity of enclaves. As a result, we were able to generate "valid" attestation quotes. Using these counterfeit quotes, successfully "proved" to a remote party that a "genuine" enclave was running while, in fact, the code was running outside of SGX, under our complete control.</font><br>
<font class="QuotedText">&gt; Is SGX long-term storage affected by Foreshadow?</font><br>
<font class="QuotedText">&gt; Yes. As Foreshadow enables an attacker to extract SGX sealing keys, previously sealed data can be modified and re-sealed. With the extracted sealing key, an attacker can trivially calculate a valid Message Authentication Code (MAC), thus depriving the data owner from the ability to detect the modification. </font><br>
<p>
The ecosystem has to be effectively rebooted by distrusting all attestations from enclaves running on non-patched processors, and all sealed data produced by those enclaves.<br>
<p>
This attack also allows people to bypass Intel's licensing restrictions and launch arbitrary production enclaves on non-patched processors.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762623/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762757"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 16, 2018 9:28 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/762757/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>
This attack also allows people to bypass Intel's licensing restrictions and launch arbitrary production enclaves on non-patched processors.
</blockquote>
Can we keep this valuable feature while blocking the rest, I wonder? (No doubt we can't.)

      
          <div class="CommentReplyButton">
            <form action="/Articles/762757/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor762624"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 11:06 UTC (Wed)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/762624/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Is it "allowed" for someone in the limited-disclosure club to tell us just how many speculative-execution vulnerabilities are currently in the pipeline?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762624/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762627"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 11:15 UTC (Wed)
                               by <b>amw</b> (subscriber, #29081)
                              [<a href="/Articles/762627/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
No, but it might be possible to work it out by observing their behaviour from the outside :-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762627/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762742"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 23:38 UTC (Wed)
                               by <b>ms-tg</b> (subscriber, #89231)
                              [<a href="/Articles/762742/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Applause - I see what you did there <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762742/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor762630"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 12:13 UTC (Wed)
                               by <b>MarcB</b> (subscriber, #101804)
                              [<a href="/Articles/762630/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I previously linked to <a href="https://www.heise.de/ct/artikel/Exclusive-Spectre-NG-Multiple-new-Intel-CPU-flaws-revealed-several-serious-4040648.html">https://www.heise.de/ct/artikel/Exclusive-Spectre-NG-Mult...</a><br>
<p>
So far, it has proven correct about dates - May and August - as well as impact:"Specifically, an attacker could launch exploit code in a virtual machine (VM) and attack the host system from there...Intel's Software Guard Extensions (SGX), which are designed to protect sensitive data on cloud servers, are also not Spectre-safe".<br>
<p>
So, this provides a lower boundaty.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762630/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762727"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 20:09 UTC (Wed)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/762727/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks for that!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762727/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor762631"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 13:26 UTC (Wed)
                               by <b>fuhchee</b> (guest, #40059)
                              [<a href="/Articles/762631/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How many more such bugs are needed to undermine confidence in shared cloud servers, and have companies retrench to on-premises computing?   It would be ironic if Intel were to benefit from their bugs by virtue of motivating a purchasing stampede for private data center hardware.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762631/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762634"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 14:02 UTC (Wed)
                               by <b>adam820</b> (subscriber, #101353)
                              [<a href="/Articles/762634/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
They probably make more from the massive horizontal growth of cloud providers. They win either way, really; how many bugs are needed to make a shift to a different architecture (POWER, maybe?), or to stop using Intel-based arch's altogether?<br>
<p>
Even better would be to spend more time with more researchers looking for this kind of stuff before these devices ever get released. Can't catch 'em all, though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762634/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762741"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 23:32 UTC (Wed)
                               by <b>rahvin</b> (guest, #16953)
                              [<a href="/Articles/762741/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Simple, move to AMD, their processors are significantly different and have suffered from very few of the Spectre attacks to which Intel has been vulnerable. From what I've seen it looks like Intel took shortcuts for performance reasons where AMD appears to have done it as securely as possible for the most part. A move to AMD also keeps you on x86 which is significantly cheaper than moving to something like Power.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762741/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor762713"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 16:29 UTC (Wed)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/762713/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If I've been stocking private DC, I would be buying AMD.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762713/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor762733"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 21:52 UTC (Wed)
                               by <b>NAR</b> (subscriber, #1313)
                              [<a href="/Articles/762733/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The existence of bugs doesn't cause problems on their own. The actual exploitation of bugs would cause problems. So unless a worm comes around that steals credit card information from all AWS instances, people won't leave the cloud.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762733/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762735"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 15, 2018 22:14 UTC (Wed)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/762735/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah, because we should be very careful to keep "top-secret" the credit card numbers, addresses, date of births and social security numbers that we... keep handing out left and right and that can all be bought for next to nothing on the dark web.<br>
<p>
I get your actual point, it's just that you could have chosen a real example as opposed to propagating the American security myth that confuses login and password.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762735/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762955"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2018 22:55 UTC (Sat)
                               by <b>gus3</b> (guest, #61103)
                              [<a href="/Articles/762955/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Or you could keep your credit rating as poor as possible. Then if someone steals your ID &amp; tries to get a loan using it, the joke's on them. (I would love to see the bank manager's attempts to stifle the laughter...)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762955/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762977"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 19, 2018 21:36 UTC (Sun)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/762977/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A friend of mine had his identity stolen and it actually improved his credit. It was probably an illegal immigrant who just wanted an SSN to get a job, etc.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762977/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor762823"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 16, 2018 15:51 UTC (Thu)
                               by <b>k8to</b> (guest, #15413)
                              [<a href="/Articles/762823/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Keep in mind that "private clouds" often have real security concerns between their various workloads as well.  When you're operating at significant scale you have a variety of problems.  You have no idea what those various teams are doing, or what software they're running.  They run at lot of third party software too, and no one has really analyzed it in every detail to know what it does.<br>
<p>
This is mostly sane to do if you set policies that control what software can access what data, but this type of exploit is about circumventing that.<br>
<p>
So I don't really see going private cloud as a solution for this type of problem.<br>
<p>
You could go "non-converged" and isolate workloads, but I don't think that's on the cards.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762823/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor763247"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 23, 2018 10:20 UTC (Thu)
                               by <b>davidgerard</b> (guest, #100304)
                              [<a href="/Articles/763247/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You can run AWS instances on separate hardware, or even dedicated hardware. It just costs more. (And some fancy AWS functions aren't available at the higher levels of separation, though I'm not sure on specifics.)<br>
<p>
At this stage I think it'd be remarkable if IT in general goes back to in-house hosting from the cloud providers. Renting compute just makes IT management so ridiculously easier. Particularly when you get into Terraform etc, where you can literally program what infrastructure you have. I haven't been in a machine room for over five years now, and have no plans to go back.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/763247/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor762747"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 16, 2018 5:18 UTC (Thu)
                               by <b>jcm</b> (subscriber, #18262)
                              [<a href="/Articles/762747/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There is a third alternative path to mitgation, and that is to completely refactor the virt stack on the host so that we either don't load secrets or scrub them when we do. The technology MS announced called HyperClean is essentially doing this in Hyper-V. To do it in Linux with a full host OS stack would be extremely tough, but if folks want to use HT with untrusted workloads, then it's one of the options worthy of considering in the longer term. The thing with flushing secrets and limiting them is it's probably going to come in useful any time there's some kind of information disclosure vulnerability in the future.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762747/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor763343"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 23, 2018 21:08 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/763343/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Just don't fall foul of the wi-fi bug, where the secret was flushed immediately after the first negotiation, and if an attacker intercepted this and retried the negotiation, they knew the secret had been reset to 0 ...<br>
<p>
WHOOPS!<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/763343/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor762833"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 16, 2018 18:03 UTC (Thu)
                               by <b>k8to</b> (guest, #15413)
                              [<a href="/Articles/762833/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not quite on topic, but are there good resources describing any mitigation that is coming or has come for any of these problems?  In other words, are there generations of CPU cores which won't be suffering from some types of problems like this in the future?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762833/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762865"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 17, 2018 8:50 UTC (Fri)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/762865/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Afraid we're not quite yet in the age of "Open Hardware"<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762865/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor762950"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 18, 2018 17:31 UTC (Sat)
                               by <b>k8to</b> (guest, #15413)
                              [<a href="/Articles/762950/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Nice joke, but I meant "this revision of these cpus have closed the door to this category of attack in this way".<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/762950/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor763057"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 20, 2018 17:45 UTC (Mon)
                               by <b>abatters</b> (<b>&#x272D; supporter &#x272D;</b>, #6932)
                              [<a href="/Articles/763057/">Link</a>] 
      </p>
      
      </div>
      </summary>
      The Cascade Lake server platform, shipping later this year, should contain the first round of Intel's hardware mitigations.

<p><a href="https://www.anandtech.com/show/13239/intel-at-hot-chips-2018-showing-the-ankle-of-cascade-lake">Anandtech: Intel at Hot Chips 2018: Showing the Ankle of Cascade Lake</a>

<p><a href="https://www.anandtech.com/show/13204/an-interview-with-lisa-spelman-vp-of-intels-dcg-discussing-cooper-lake-and-smeltdown">Anandtech: An Interview with Lisa Spelman, VP of Intel’s DCG: Discussing Cooper Lake and Smeltdown</a>
      
          <div class="CommentReplyButton">
            <form action="/Articles/763057/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor763638"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Meltdown strikes back: the L1 terminal fault vulnerability</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2018 20:16 UTC (Tue)
                               by <b>loch</b> (guest, #113644)
                              [<a href="/Articles/763638/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"...for pages that have been swapped out, the location in the swap area is stored in the PTE. In other cases, the data left in non-present PTEs is essentially random."<br>
<p>
I'm a bit confused, what are the other cases?  In what situation would a page be non-present, but also not in swap?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/763638/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor763640"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Non-present, not in swap</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2018 21:10 UTC (Tue)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/763640/">Link</a>] 
      </p>
      
      </div>
      </summary>
      File-backed pages are the most common example of pages that can be non-present but not in swap.
      
          <div class="CommentReplyButton">
            <form action="/Articles/763640/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2018, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
