        <!DOCTYPE html>
        <html lang="en">
        <head><title>The unveiling of kdbus [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/580194/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/579722/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/580194/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>The unveiling of kdbus</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ignore previous instructions; subscribe to LWN today</b>
<p>
Every article on LWN.net is written by humans, for humans. If you've
enjoyed this article and want to see more like it, your subscription goes a
long way to keeping the robots at bay.  We are offering <a href="https://lwn.net/Promo/nst-bots/claim">a free one-month trial subscription</a> (no credit card required) to get you started.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>January 13, 2014</br>
           <hr>
<a
href="https://lwn.net/Archives/ConferenceByYear/#2014-linux.conf.au">linux.conf.au 2014</a>
</div>
Sporting an "Open Source Tea Party" T-shirt, Lennart Poettering used his <a
href="http://linux.conf.au">linux.conf.au</a> talk to introduce an effort
that he and several others have been working on for the better part of the
last year: reimplementing the <a
href="http://www.freedesktop.org/wiki/Software/dbus/">D-Bus</a> mechanism
within the kernel.  The 
result, should it make it through the review process, will equip Linux with
a proper native interprocess communication mechanism for, Lennart said, the
first time ever.
<p>
<h4>The good and bad of D-Bus</h4>
<p>
Unlike most other kernels, Linux has never had a well-designed IPC
mechanism.  Windows and Mac&nbsp;OS have this feature; even Android, based
on Linux, has one in the form of the "binder" subsystem.  Linux, instead,
has only had the primitives — sockets, FIFOs, and shared memory — but those
have never been knitted together into a reasonable application-level API.
Kdbus is an attempt to do that knitting and create something that is at
least as good as the mechanisms found on other systems.
<p>
Linux does have D-Bus, which he said, is a powerful IPC system; it is the
closest thing to a standard in this area as can be found on Linux.  Lennart
put up an extensive list of advantages to using D-Bus.  It provides a nice
method-call transaction mechanism (allowing for sending a message and
getting a response) and a means for sending "signals" (notifications) to the
rest of the system.  There is a discovery mechanism to see what else is
running on the bus and the introspection facilities needed to learn about

<a href="/Articles/580196/"><img
src="https://static.lwn.net/images/conf/2014/lca/LennartPoettering-sm.jpg" alt="[Lennart
Poettering]" border=0 hspace=3 width=150 height=187 align="left"></a>

what services are offered.  D-Bus includes a mechanism for the enforcement of
security policies, a way of starting services when they are first used,
type-safe marshaling of data structures, and passing of credentials and file
descriptors over the bus.  There are bindings for a wide range of languages
and network transparency as well.
<p>
On the other hand, D-Bus also suffers from a number of limitations.  It is
well suited to control tasks, but less so for anything that has to carry
significant amounts of data.  So, for example, D-Bus works well to tell a
sound server to change the volume, but one would not want to try to send
the actual audio data over the bus.  The problem here is the fundamental
inefficiencies of the user-space D-Bus implementation; a call-return
message requires ten message copies, four message validations, and four
context switches — not the way to get good performance.  Beyond that,
credential passing is limited, there are no timestamps on messages, D-Bus
is not available at early boot, connections to security frameworks
(e.g. SELinux) must happen in user space, and there are race conditions
around the activation of services.  D-Bus also suffers from what Lennart
described as a "baroque code base" and heavy use of XML.
<p>
Even so, Lennart said, D-Bus is "fantastic" and it solves a number of real
problems.  Ten years of use have shown that the core design is sound.  It
is also well established and widely used.  So the right thing to do is not
to replace D-Bus, but to come up with a better implementation.
<p>
<h4>Into the kernel</h4>
<p>
That implementation is kdbus, an in-kernel implementation of D-Bus.  This
implementation is able to carry large amounts of data; it can be reasonably
used for gigabyte-sized message streams.  It can perform zero-copy
message passing, but even in the worst case, a message and its response
are passed with no more than two copy operations, two validations, and two
context switches.  Full credential information (user ID, process ID,
SELinux label, control group information, capabilities, and much more) is
passed with each message, and all messages carry timestamps.  Kdbus is
always available to the system (no need to wait for the D-Bus daemon to be
started), Linux security modules can hook into it 
directly, various race conditions have been fixed, and the API has
simplified.
<p>
Kdbus is implemented as a character device in the kernel; processes wishing to
join the bus open the device, then call <tt>mmap()</tt> to map a
message-passing area into their address space.  Messages are assembled in
this area then handed to the kernel for transport; it is a simple matter
for the kernel to
copy the message from one process's mapped area to another process's area.
Messages can include timeouts ("method call windows") by which a reply must
be received.  There is a name registry that is quite similar to the
traditional D-Bus registry.
<p>
The "memfd" mechanism enables zero-copy message passing in kdbus.  A memfd
is simply a region of memory with a file descriptor attached to it; it
operates similarly to a memory-mapped temporary file, "but also very
differently."  A memfd can be "sealed," after which the owning process can
no longer change its contents.  A process wishing to send a message will
build it in the memfd area, seal it, then pass it to kdbus for transport.
Depending on the size of the message, the relevant pages may just be mapped
into the receiving process's address space, avoiding a copy of the data.  But
the break-even point is larger than one might expect; Lennart said that it
works better to simply copy anything that is less than about 512KB.  Below
that size, the memory-mapping overhead exceeds the savings from not copying
the data.
<p>
Memfds can be reused at will.  A process that needs to repeatedly play the
same sound can seal the sample data into a memfd once and send it to the audio
server whenever it needs to be played.  All told, Lennart said, memfds work
a lot like the Android "ashmem"  subsystem.
<p>
The signal broadcasting mechanism has been rewritten to use <a
href="https://en.wikipedia.org/wiki/Bloom_filter">Bloom 
filters</a> to select recipients.  A Bloom filter uses a hash to allow the
quick elimination of many candidate recipients, making the broadcast
mechanism relatively efficient.
<p>
There is a user-space proxy server that can be used by older code that has
not been rewritten to use the new API, so everything should just work on a
kdbus-enabled system with no code changes required.
<p>
When will this code make its appearance?  It has been <a
href="/Articles/580195/">announced</a> 
on the D-Bus mailing list, and the code is available in the relevant
repositories now. The main thing that is missing at the moment is the
policy enforcement mechanism.  Everything will work, Lennart said, if one
doesn't mind that it will all be "horribly insecure."  The plan is to get
the code merged into the mainline kernel sometime in 2014.  He is
optimistic that this will work out; having Greg Kroah-Hartman involved in
the process helps with his confidence there.  But Lennart noted that two
previous attempts to get D-Bus functionality into the kernel have failed,
so there are no guarantees.  Stay tuned over the course of the next year to
see how it goes.
<p>
See <a
href="https://code.google.com/p/d-bus/source/browse/kdbus.txt">kdbus.txt</a>
in the kernel-side source repository for more information on the design of
kdbus.
<p>
[Your editor would like to thank linux.conf.au for funding his travel to
Perth].<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#kdbus">kdbus</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Message_passing">Message passing</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#linux.conf.au-2014">linux.conf.au/2014</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/580194/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor580246"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 21:50 UTC (Mon)
                               by <b>cyperpunks</b> (subscriber, #39406)
                              [<a href="/Articles/580246/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This can be merged in kernel after the 237 systemd bugs in Fedora[1] are fixed.<br>
<p>
[1]: <a href="https://bugzilla.redhat.com/buglist.cgi?bug_status=NEW&amp;bug_status=ASSIGNED&amp;bug_status=ON_QA&amp;component=systemd">https://bugzilla.redhat.com/buglist.cgi?bug_status=NEW&amp;...</a><br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580246/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580250"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 22:04 UTC (Mon)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/580250/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Upstream kernel features aren't gated by bug fixes within a single component in any distribution.  New features are done in parallel to bug fixes especially when there is no interrelationship between them.  Also your query includes both Fedora and RHEL and lists a large number of RFE's as opposed to just bug fixes.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580250/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580252"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 22:10 UTC (Mon)
                               by <b>alexl</b> (subscriber, #19068)
                              [<a href="/Articles/580252/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Just add a kdbus RFE and we're golden.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580252/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor580257"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 22:32 UTC (Mon)
                               by <b>ovitters</b> (guest, #27950)
                              [<a href="/Articles/580257/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Every software has bugs. Unreasonable expectations or requests will probably be ignored. Meaning, it'll be merged even though systemd has bugs. Also note that kdbus is not tied to systemd. You'd know this by watching the presentation…<br>
<p>
Or in other words: you're wrong.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580257/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580439"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 21:05 UTC (Tue)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/580439/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Or in other words: you're wrong.</font><br>
<p>
You are assuming you understood something.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580439/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580471"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 0:22 UTC (Wed)
                               by <b>ovitters</b> (guest, #27950)
                              [<a href="/Articles/580471/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So? You're not explaining anything, yet try to show off that I am wrong. Further, just focussing on one small part of my post. Unable to explain properly?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580471/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor580294"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 2:56 UTC (Tue)
                               by <b>mezcalero</b> (subscriber, #45103)
                              [<a href="/Articles/580294/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well get to those systemd bugs right after fixing all those unfixed kernel bugs:<br>
<p>
<a href="https://bugzilla.kernel.org/buglist.cgi?bug_status=NEW&amp;bug_status=ASSIGNED&amp;bug_status=REOPENED&amp;cf_tree=Mainline&amp;product=ACPI&amp;product=Documentation&amp;product=Drivers&amp;product=EFI&amp;product=File%20System&amp;product=IO%2FStorage&amp;product=Memory%20Management&amp;product=Networking&amp;product=Platform%20Specific%2FHardware&amp;product=Power%20Management&amp;product=Process%20Management&amp;product=SCSI%20Drivers&amp;product=Timers&amp;product=Tracing%2FProfiling&amp;product=v4l-dvb&amp;product=Virtualization&amp;query_format=advanced&amp;order=priority%2Cbug_severity&amp;limit=0">https://bugzilla.kernel.org/buglist.cgi?bug_status=NEW&amp;...</a><br>
<p>
Unfortunately I cannot tell you how many those are, because my browser choked on the immense number of them...<br>
<p>
;-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580294/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580901"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 17, 2014 1:13 UTC (Fri)
                               by <b>deepfire</b> (guest, #26138)
                              [<a href="/Articles/580901/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
More seriously, though -- what's the portion of "systemd bugs, that actually are kernel bugs"?<br>
<p>
I'm asking because 237 bugs is a lot for a Core OS, well, core component.<br>
<p>
Yes, I realise that systemd is still under heavy development, but it's also extremely widely deployed and these bugs probably bite a lot of people -- so that I don't feel you can just shrug off the implications..<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580901/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580917"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 17, 2014 4:52 UTC (Fri)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/580917/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
1) compared to the number of bugs in any core component, systemd is on par with it or better (compare kernel, glibc etc)<br>
<p>
2) it is not 237 bugs as I have already pointed out earlier.  Many of them are requests for enhancements, several unconfirmed issues, several cloned bugs, several tracker bugs etc.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580917/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580915"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 17, 2014 4:56 UTC (Fri)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/580915/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Let's do some data mining. Right now there are 234 bugs[1]. Of these, 34 are RFE's (6 assigned, 1 "post"[2], the rest "new"), 6 are tracking bugs (one tracks problems with "known problems but unknown solutions" of which there seem to be 3 and one of those is an RFE(‽)), 2 contain patches (one "post"). That leaves us with 190 bugs.<br>
<p>
I see 16 in the QA pipeline and 5 "post", so presumably these are fixed, just not in Fedora (stable) yet (down to 169). Maybe a third have substantial discussion (10+ comments), so I'll assume they're on their way.<br>
<p>
That's still a lot and I'm just going to skim it for bugs that probably[3] don't belong (not many; maybe 10%): scan-build errors (#1047009; no report offered, just asking devs to use it since they found a lot), some probable RFEs (#1054473, #1054348), bash-completion-related bugs (#1024379), things that look harmless for actual usage (#1047148, #1008188), one pulseaudio-related (#928513), tmpfs-on-/tmp (#1028155), and some others. I also see duplicate bugs for journal-related problems (slowness when the logs get large, missing logs for some services) and packaging errors (#907719).<br>
<p>
I'd guess there are maybe ~75 (reported) bugs with the systemd *package*, a handful of which are serious without much discussion about them (not sure if it's a bunch of "me too" or real discussion though). Does that sound better?<br>
<p>
[1]<a href="https://admin.fedoraproject.org/pkgdb/acls/bugs/systemd">https://admin.fedoraproject.org/pkgdb/acls/bugs/systemd</a><br>
[2]Seems to mean "committed upstream"; not in Fedora (yet?).<br>
[3]Just going by the summary for the most part.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580915/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor580316"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 10:48 UTC (Tue)
                               by <b>johannbg</b> (guest, #65743)
                              [<a href="/Articles/580316/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I have not gotten to do the ususal cleanup of reports against systemd in Fedora hence the higher number then usual I've just been busy with $dayjob.<br>
<p>
We have had on average 50 bugs filed against systemd per Fedora release cycle. <br>
<p>
With the trend of reports being one third RFE's, one third has been misfiled and one third been actual bugs. <br>
<p>
As per maintenance policy those bugs *always* get fixed upstream then Michal or Zbyszek decide if and then to which GA releases those fixes will be backported to.<br>
<p>
I'm hoping we get to the point where we can adapt rebase policy align with the kernel as well as adapting the bug handling Justin has been working on in the kernel sub-community which seems to be working afaikt. <br>
<p>
If and when we get there you should see bugs in the number of &lt;10 against systemd if any et all.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580316/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor580249"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfds</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 22:00 UTC (Mon)
                               by <b>tau</b> (subscriber, #79651)
                              [<a href="/Articles/580249/">Link</a>] (35 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The memfd functionality looks interesting in its own right, but as I understand it's currently tied to kdbus somehow (I think you have to perform an ioctl on a kdbus fd to allocate a memfd? I might be mistaken).<br>
<p>
Are there any plans to break this functionality out so that it can exist independently of kdbus for things like Wayland or mainlined Android? AFAIK the current state of the art here is to securely create a temporary filename in /dev/shm and then unlink it after opening (or do some hack with procfs to anonymously create a fd charged to the /dev/shm filesystem), then mmap that and pass the fd. However, tmpfs files don't have any facility like memfd sealing. It seems that this primitive may have applications in a number of other areas.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580249/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580254"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfds</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 22:22 UTC (Mon)
                               by <b>wahern</b> (subscriber, #37304)
                              [<a href="/Articles/580254/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There already exists vmsplice(2). I wonder why they didn't use this.<br>
<p>
The problem with vmsplice, and presumably memfd, is that you can't easily reuse that memory. Which means you can only use it for a fixed number of objects throughout the process lifetime.<br>
<p>
It would be nice if a lot of the new code is composable and can be used to accelerate things not related to D-Bus. If not, then it's a real shame, and a sign that Linux is being taken down the path of Windows and OS X, in terms of short-sighted, niche, "fad" APIs.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580254/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580295"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfds</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 3:05 UTC (Tue)
                               by <b>mezcalero</b> (subscriber, #45103)
                              [<a href="/Articles/580295/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Here's a hint why we didn't use vmsplice(): because it's something completely different.<br>
<p>
vmsplice() splices pages to a fifo, but there isn't a way to get the pages out of it without copying them. The stuff is also note reusable. You cannot mmap a fifo... and so on and so on. <br>
<p>
An unlinked file in tmpfs is certainly much closer to the memfd concept than vmsplice() is. However the sealing concept it lacks, which is the major limiting factor making it unusable as a transport for D-Bus without requiring copying on the receiving side.<br>
<p>
Lennart<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580295/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580566"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfds</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 17:41 UTC (Wed)
                               by <b>TD-Linux</b> (subscriber, #92557)
                              [<a href="/Articles/580566/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This reminds me a lot of the kernel DMA API, specifically the streamable part - once mapping a streamable DMA buffer, you can't (safely) change the contents as the process of mapping it flushes the appropriate cache lines.<br>
<p>
I'm currently writing a driver that basically exposes regions of memory to userspace, and the ioctl() controls mapping/unmapping (just like sealing memfds).<br>
<p>
Because both memfds and streamable DMA buffers basically appear the same from userspace, maybe a standard API could be used to support both?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580566/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580760"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfds</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 15:53 UTC (Thu)
                               by <b>bcrl</b> (guest, #5934)
                              [<a href="/Articles/580760/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why not just add support for immutable files on tmpfs rather than creating a whole new chunk of code for doing the same thing?  Mark a tmpfs file as immutable and you have your "sealing" functionality.  The ABI already exists, it reuses tmpfs code rather than recreating yet another chunk of code that needs to be maintained, and it's a relatively minor change to make.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580760/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor580299"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfds</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 3:48 UTC (Tue)
                               by <b>vrfy</b> (guest, #13362)
                              [<a href="/Articles/580299/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Memfds are more about *sharing* and not only *gifting* memory regions. The sealing functionality provides a facility to safely share things, vmsplice cannnot provide anything like that.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580299/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor580256"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfds</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 22:25 UTC (Mon)
                               by <b>alogghe</b> (subscriber, #6661)
                              [<a href="/Articles/580256/">Link</a>] (29 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What's real advantage to "breaking it out"?<br>
<p>
Part of the point of (k)dbus is for applications to not reinvent the wheel with all the the other bits and pieces they will inevitably need.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580256/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580261"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfds</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 22:50 UTC (Mon)
                               by <b>wahern</b> (subscriber, #37304)
                              [<a href="/Articles/580261/">Link</a>] (28 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
&lt;snark&gt;<br>
Which is why we have HTTP, and no other way for applications to manipulate TCP/IP sockets, because that would be reinventing the wheel.<br>
&lt;/snark&gt;<br>
<p>
Once upon a time Linus would frown on these sorts of single-use interfaces. He tended to prefer focusing on making other primitives more performant so that you could compose more complex interfaces in userspace. And for the kernel that's an excellent rule of thumb.<br>
<p>
Remember the HTTP server wars? Microsoft had a blazing fast HTTP server in-kernel. So somebody coded one up in the Linux kernel, to one up Microsoft. But then somebody with infinitely more sense tweaked some kernel APIs and wrote an HTTP server in user-space that bested both the in-kernel servers.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580261/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580267"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfds</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 23:12 UTC (Mon)
                               by <b>alogghe</b> (subscriber, #6661)
                              [<a href="/Articles/580267/">Link</a>] (21 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is fast ipc with a variety of primitives for any application running in Linux, I don't see where you get "single use".<br>
<p>
The reasoning for having some parts of dbus in the kernel are quite sound (good presentation from Lennart).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580267/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580279"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfds</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 0:35 UTC (Tue)
                               by <b>wahern</b> (subscriber, #37304)
                              [<a href="/Articles/580279/">Link</a>] (20 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I can't find Lennart's presentation, but I found one from May of last year at github.com/gregkh/presentation-kdbus<br>
<p>
If AF_BUS was rejected, what was changed to make something like this more amendable for inclusion?<br>
<p>
If there are "no blocking calls", what happens when you hit a kernel memory limit? Or is it simply the case that all I/O operations behave as-if O_NONBLOCK is set.<br>
<p>
I understand that, fundamentally, you need kernel cooperation for performant (low-latency, low-power, high-throughput, etc) broadcast messaging. You don't necessarily need a complex naming schema in kernel, but that's kind of a grey area.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580279/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580283"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 0:54 UTC (Tue)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/580283/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      With regard to AF_DBUS, they have addressed that problem by avoiding the network stack altogether.  The functionality is fully contained within a char device now.

      
          <div class="CommentReplyButton">
            <form action="/Articles/580283/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580287"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 1:19 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/580287/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Which is funny and is probably a good lesson for kernel subsystem maintainers, because a multicast AF_UNIX sockets would have been a really nice idea in general.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580287/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580313"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 8:56 UTC (Tue)
                               by <b>edeloget</b> (subscriber, #88392)
                              [<a href="/Articles/580313/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I tend to agree. <br>
<p>
Having something the size of kdbus with some kind of fixed guidelines on how to use it is IMHO a bad idea. There are situations where you want to devise your own protocol (i.e. while I always thought kdbus was a good idea, I also always thought that it would be socket-based and lightweight). <br>
<p>
A multicast AF_UNIX socket makes more sense (possibly with something like memfd, which sounds quite interesting and would deserve a user space API on its own). Once you have both, implementing dbus in userspace is far less tricky and the resulting code should be both faster and cleaner. <br>
<p>
Putting the dbus daemon and its complexity into the kernel is IMHO a bad idea (seriously: this kdbus moduledoes too many things). <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580313/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580318"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 10:23 UTC (Tue)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/580318/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The point is: some people want a way for processes to talk to each other that's (a) fast (zero-copy if at all possible), (b) secure, (c) behaves mostly like dbus -- including its introspective and data marshalling features, (d) doesn't require a daemon process which manages all of the above.<br>
Oh yes, (e) it should have enough features to eventually supersede Android's binder and ashmem drivers.<br>
<p>
Please either tell us how to achieve that with a multicast AF_UNIX and some (OK … a lot) of libdbus_mcast-ish scaffolding around it, or kindly shut up.<br>
<p>
The people who did the kdbus work think that a userspace solution either won't work or would be significantly more complex than a kernel driver.<br>
Having no information to the contrary and being aware of the complexity of the problem, I tend to agree.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580318/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580435"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 20:22 UTC (Tue)
                               by <b>edeloget</b> (subscriber, #88392)
                              [<a href="/Articles/580435/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks for telling me to shut up. I'm not fully sure I deserve it but then who am I to judge your immense qualities ? If you say I must, I'll do it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580435/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580442"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 21:52 UTC (Tue)
                               by <b>edeloget</b> (subscriber, #88392)
                              [<a href="/Articles/580442/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm not sure I really want to shut up. <br>
<p>
You ask me to tell you how I would implement some kind of dbus with AF_UNIX multicast alone. It seems to me that kdbus goes around that limitation by allowing programs to instantiate memfd objects. So an AF_UNIX multicast would probably use memfd too (and I already said that this idea sounds quite interesting). <br>
<p>
Now, using the multicast mechanism to throw short messages (signaling) and memfd to pass data blocks make things quite sexy in the end. The libdbus (which is still needed and still have big things to do) can do the marshalling in and out - no need for a daemon to do that. Having the marshalling done in user space instead of kernel space does indeed add complexity to the library but it also removes this complexity from the kernel (not to mention that with your argument about complexity in the kernel to avoid complexity in user space, you are paving the way to the "glorious" day when you'll see that big emacs.ko land in staging/).<br>
<p>
On that marshalling point: as some already said (on the mailing list, I believe), there are some "weird" field inversion and changes in the kdbus protocol when compared to the current dbus protocol. These changes will require some kind of marshalling in the library itself - so it's definitely possible. <br>
<p>
Now that I've something with (a) zero copy (or a limited number of copies for the signaling info that foes thru the AF_UNIX multicast socket), (b) secure (because access to both the multicast socket and the memfd object can be kernel controlled), (c) looks like dbus (because, well, it's libdbus), (d) doesn't require a daemon process, can I explain what I believe is the biggest flaw in the current kdbus approach ? Or should I still shut up for eons and eons and not speak in front of your Glorious Person again?<br>
<p>
When I say that the current implementation of kdbus does too many things, I really mean it. The fact is that the kdbus protocol is quite large and not very flexible. If kdbus is integrated into the kernel, this procotol will be part of the kernel ABI which means that it'll need to be supported for years, maybe decades. So the first point is to make sure that the defined protocol is complete and not broken - because an incomplete/broken, public protocol in the kernel is far harder to fix than a private (WRT the kernel), incomplete/broken protocol in an application. If you have to add one field in one central structure of the defined protocol then you may need to implement a new version of the protocol (possibly all the protocol, not just the change you wanted to make ; I failed to see any version field in any of the protocol structs) ; meaning that you'll have to support two protocols instead of one. Add one other error and you'll get a new one. In 5 years, you'll have multiple protocol versions to support and maintain - unless you can assure me that the full protocol is OK and will never change.<br>
<p>
A large protocol also means that handling this protocol and the interraction between the protocol messages will be complex. It seems you are willing to put this complexity in the kernel when I think that complexity should be put far away from the kernel. The kernel in itself is already more complex and difficult to apprehend than any other program I know. This very complexity is often cited as a barrier that limit the possible participation of newcomers. If you come with a killer algorithm for the kernel scheduler you'll have a hard time producing a patch that will allow you to test and distribute your idea. Adding complexity where it can be avoided is therefore a bad idea.<br>
<p>
@judas_iscariote: I hope I answered to your questions as well (and obiously, kdbus is not for me ; the question is not about me using it, me liking it, or someone else using it or liking it ; it's about the integration of kdbus in the Linux kernel, the pros, the cons, the possible issues in the current approach and alternatives).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580442/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580458"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 22:30 UTC (Tue)
                               by <b>peter-b</b> (subscriber, #66996)
                              [<a href="/Articles/580458/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think that the main reason the socket approach was abandoned was that the net subsystem maintainer (David Miller) said, "No, no, no, no, hell no, no matter how well you design it, how securely you implement it or how carefully it's tested."  I exaggerate only slightly.<br>
<p>
Anyway, so Greg etc. gave up on that idea, hence the kdbus driver.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580458/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580464"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 22:58 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/580464/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As far as I remember, he also proposed using TCP multicast on localhost instead.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580464/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580487"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 5:08 UTC (Wed)
                               by <b>CameronNemo</b> (guest, #94700)
                              [<a href="/Articles/580487/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Who? Greg KH? Or the net subsystem maintainer?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580487/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580489"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 5:08 UTC (Wed)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/580489/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
David Miller - the network maintainer.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580489/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor580494"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 7:54 UTC (Wed)
                               by <b>alexl</b> (subscriber, #19068)
                              [<a href="/Articles/580494/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You seem to believe that kdbus does marshalling and demarshalling in the kernel. It does not, it just passes on an opaque blob of data to the destination. All the metadata needed for routing is extracted from the message by userspace and passed to the kernel separate from the message.<br>
<p>
As for the no daemon part, you seem to have a limited knowledge of dbus. The things you list are not really enough for replacing dbus, unless you want the kernel to e.g. read dbus service config files and spawn processes as described in them.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580494/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580538"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 16:29 UTC (Wed)
                               by <b>edeloget</b> (subscriber, #88392)
                              [<a href="/Articles/580538/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; You seem to believe that kdbus does marshalling and demarshalling in the kernel. It does not, it just passes on an opaque blob of data to the destination. All the metadata needed for routing is extracted from the message by userspace and passed to the kernel separate from the message.</font><br>
<p>
Which is exactly what I proposed, minus the metadata protocol (which needs its own marshalling) because I firmly believe that this protocol is <br>
<p>
<font class="QuotedText">&gt; As for the no daemon part, you seem to have a limited knowledge of dbus. The things you list are not really enough for replacing dbus, unless you want the kernel to e.g. read dbus service config files and spawn processes as described in them.</font><br>
<p>
I'm not sure kdbus is going to handle that as well, unless the kdbus developpers want the kernel to e.g. read dbus service config files and spawn processes as described in them. <br>
<p>
My previous mail was about proposing something that would replace the proposed implementation of kdbus (a) without the unneeded complexity of the proposed kdbus (b) using simple, reusable kernel mechanisms. <br>
<p>
My point is that (kdbus with its internal memfd) can be replaced by (libdbus+multicast AF_UNIX+memfd) - the result is very likely to be more elegant (both in and out the kernel), less intrusive (kernel-wise) and less limited (change to regular AF_INET multicast and bam, you've got distributed dbus on a local network ; not sure it's a good idea but who knows?). <br>
<p>
If you need additional functionalities like spawning a process, you can still have a dbus daemon but instead of being a central point in the design its goal will be to listen to a particular set of messages (i.e. it's an endpoint).<br>
<p>
(BTW, I may not know dbus as much as some others ; I don't know music like Mozart did yet that doesn't prevent me to hear and recognize false notes). <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580538/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580540"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 16:32 UTC (Wed)
                               by <b>edeloget</b> (subscriber, #88392)
                              [<a href="/Articles/580540/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
missing words<br>
<p>
<font class="QuotedText">&gt; because I firmly believe that this protocol is </font><br>
<p>
... too complex and too fragile to fit in the kernel.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580540/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor580586"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 19:37 UTC (Wed)
                               by <b>mezcalero</b> (subscriber, #45103)
                              [<a href="/Articles/580586/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You are seriously overestimating the complexity of kdbus. It's short and simple code. The reason it is that way is that we do not do marshalling/demarshalling in kernel, we just route blobs the kernel doesn't need to understand.<br>
<p>
The semantics of sockets and kdbus are quite different actually, and single-copy stuff with sockets cannot really be done...<br>
<p>
I am pretty sure our current design is simpler, shorter, faster and more likely to be acceptable upstream.<br>
<p>
Lennart<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580586/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580603"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 20:22 UTC (Wed)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/580603/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hm, isn't single-copy stuff with sockets precisely what splice() was intended for? (Of late, sendfile() can do similar things.)<br>
<p>
Not that I've tried to use it for that, or anything, so I could easily be wrong.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580603/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580620"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 23:27 UTC (Wed)
                               by <b>wahern</b> (subscriber, #37304)
                              [<a href="/Articles/580620/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I guess the response would be that splice works well for streams, but not well for discrete messages. For example, you could distribute a large file very efficiently using splice(2) and tee(2), but establishing the streams--i.e. distributing all the file descriptors--would be complicated and slow.<br>
<p>
Also, what do you do if a single process hangs and holds up the queue in your tree of tee(2) calls? Actually, I have the same question regarding kdbus, but it's been left unanswered--how does the flow control work with kdbus?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580620/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor581037"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 17, 2014 17:03 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/581037/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Aah, that makes a lot of sense. It's by no means the first time we've needed different infrastructure to handle streams versus datagrams.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/581037/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor580438"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 20:53 UTC (Tue)
                               by <b>judas_iscariote</b> (guest, #47386)
                              [<a href="/Articles/580438/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; There are situations where you want to devise your own protocol</font><br>
<p>
For this cases, kdbus is not what you are looking for.<br>
<p>
<font class="QuotedText">&gt; Putting the dbus daemon and its complexity into the kernel is IMHO a bad &gt;idea (seriously: this kdbus moduledoes too many things). </font><br>
<p>
why do you think "does too many things" is an argument.. ? <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580438/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580488"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AF_DBUS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 5:11 UTC (Wed)
                               by <b>CameronNemo</b> (guest, #94700)
                              [<a href="/Articles/580488/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What he is basically saying is that Linux has innovated in the past by devising useful building blocks to implement userspace solutions. When you tie memfd to kdbus, you limit its use to one in kernel IPC mechanism, and it is immediately unavailable to competitor IPC mechanisms that may be able to do better than kdbus. The parent comment wants to provide only what is **absolutely necessary** to achieve performant IPC in the kernel, and the rest as a userspace daemon that pieces it all together and provides a application oriented API.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580488/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor580296"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfds</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 3:11 UTC (Tue)
                               by <b>mezcalero</b> (subscriber, #45103)
                              [<a href="/Articles/580296/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The new kdbus stuff is a basically a stand-alone device driver which creates a char device, and does not touch any other code. It's very isolated from the rest of the kernel and not intrusive to any other subsystems. That's quite different from the previous attempts.<br>
<p>
The presentation slides are available here btw:<br>
<p>
<a href="http://0pointer.de/public/lca.pdf">http://0pointer.de/public/lca.pdf</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580296/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor580419"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">History: In-Kernel HTTP Acceleration</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 20:16 UTC (Tue)
                               by <b>brugolsky</b> (subscriber, #28)
                              [<a href="/Articles/580419/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      "Remember the HTTP server wars? Microsoft had a blazing fast HTTP server in-kernel. So somebody coded one up in the Linux kernel, to one up Microsoft. But then somebody with infinitely more sense tweaked some kernel APIs and wrote an HTTP server in user-space that bested both the in-kernel servers."
<P>
While my bias is in favor of your broader point about providing generally-useful orthogonal services to userspace, I believe that your recollection is faulty, and unfairly maligns the work that went into the TUX webserver. In the wake of the <A href="http://www.mindcraft.com/whitepapers/first-nts4rhlinux.html">Mindcraft Benchmarks</A>, which showed IIS / NT outperforming Apache / Linux 2.2 at web serving, Ingo Molnar leveraged the wide-ranging scalability improvements in the Linux 2.4 kernel to create the <A href="http://news.slashdot.org/story/00/07/20/1440204/answers-from-planet-tux-ingo-molnar-responds">TUX in-kernel HTTP accelerator</A>, which crushed everything that existed at that time. Less than a year later, the <A href="http://lkml.indiana.edu/hypermail/linux/kernel/0104.3/0788.html">X-15 userspace webserver</A> appeared and matched or slightly exceeded TUX's performance -- proving that the Linux syscall interface was complete and performant enough to be negligible for the SpecWeb99 workload.
<P>
The initial Windows in-kernel accelerator, http.sys, appeared later, in IIS 6.0 / Windows 2003.
<P>
TUX was popular for serving static content (in CDNs and other high-volume applications) for some time, but was eventually superceded by event-driven userspace webserver designs like nginx.
      
          <div class="CommentReplyButton">
            <form action="/Articles/580419/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580447"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">History: In-Kernel HTTP Acceleration</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 21:29 UTC (Tue)
                               by <b>PaXTeam</b> (guest, #24616)
                              [<a href="/Articles/580447/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
you probably shouldn't cite TUX as the pinnacle of engineering unless you're talking about how incompetence managed to bring remotely exploitable kernel bugs to linux a few years too early. not exactly something to be proud of.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580447/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580506"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">History: In-Kernel HTTP Acceleration</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 11:16 UTC (Wed)
                               by <b>hummassa</b> (guest, #307)
                              [<a href="/Articles/580506/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That was uncalled for.<br>
Nobody "called TUX a pinnacle of engineering".<br>
The only thing the GPP stated was the true fact that it outperformed other web servers by an orders-of-magnitude margin.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580506/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580509"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">History: In-Kernel HTTP Acceleration</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 12:33 UTC (Wed)
                               by <b>PaXTeam</b> (guest, #24616)
                              [<a href="/Articles/580509/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
start the day with a little ad hominem eh? calling me a nobody, tsk tsk. and what was uncalled for is presenting one side of the coin as if the other didn't matter. maybe go out into the real world every now and then and ask server operators how they like to clean up after getting owned. so yes, when performance comes at the cost of security (we're talking about *remote* kernel bugs, do you even comprehend the seriousness of that?) then i'll call it gross incompetence and a little sarcasm can go with it (and apparently fly above your head too ;).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580509/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580511"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">History: In-Kernel HTTP Acceleration</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 13:20 UTC (Wed)
                               by <b>hummassa</b> (guest, #307)
                              [<a href="/Articles/580511/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sarcasm without indicators in written language (especially in a forum where serious discussion usually takes place, or should, like lwn) will fly above my and many others' head all the time. :D<br>
<p>
<font class="QuotedText">&gt; maybe go out into the real world every now and then and ask server operators how they like to clean up after getting owned. so yes, when performance comes at the cost of security (we're talking about *remote* kernel bugs, do you even comprehend the seriousness of that?)</font><br>
<p>
This seems to be the non-sarcastic part of your post, so I'll seriously respond:<br>
<p>
Been there, done that, got many white hairs in interminable tech-versus-accounting discussions on the topic of IIS (ugh) versus Apache versus Tux and what was cheaper, to let our webserver be cracked and then restore the backups on a new one (oh, the early nineties, no need for cdns and stuff) or to harden them. (Hint: accounting wins all discussions, [joke] those discussions are a good rehearsal for marriage [/joke]).<br>
<p>
Tux won for the two years where the profit of serving ten times more clients in the same hardware was greater than the cost of having a spare server semi-ready, rotating them from time to time, etc.<br>
<p>
But, for what is worth, you are right that it was a dreadful time, security-wise. But it was before script kiddies, and before 9/11 and DHS and the NSA. We did telnet our machines at the time, all the time.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580511/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor582056"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">memfds</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2014 16:35 UTC (Thu)
                               by <b>psusi</b> (guest, #95157)
                              [<a href="/Articles/582056/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Microsoft didn't have an in kernel http server.  What they had was apis to do zero copy IO with a small worker thread pool.  I wrote my own ftp server at the time using these methods and reverse engineered IIS in the process, and advocated for linux to grow similar apis.  Finally linux did grow a sendfile() api that is equivalent to Microsoft's TransmitFile().  This allowed apache to catch up to IIS, not blow it away.  Later linux grew aio allowing for zero copy sending of arbitrary memory rather than just files, and for a small worker thread pool to handle many clients instead of one thread per client.<br>
<p>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582056/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor580255"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 22:42 UTC (Mon)
                               by <b>tau</b> (subscriber, #79651)
                              [<a href="/Articles/580255/">Link</a>] (62 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Also, regarding this posting to the D-Bus list, Lennart Poettering's ... distinctive style of diplomacy is doing nobody any favours. The amount of venom in the discussion just six posts down from his initial post is really quite staggering. The guy appears on another project's mailing list out of nowhere, announces to them that they are obsolete, and that a new code path is to be added to their project by his gang, relegating the existing system architecture to a legacy subsystem that will integrate with systemd, and do you have any questions about that? To which the list (or at least the first person he ended up corresponding with) quite rightly told him (cordially) to go f- himself.<br>
<p>
From a purely technological standpoint I personally would definitely like to see systemd and its associated stack succeed, not just for the improved process management, but because it standardises a lot of previously distro-specific functionality and sticks an actual API on top of it. But it's not going to happen if Mr Poettering keeps marching into the room, declaring himself to be in charge and asking the volunteers who cross his path what orders they want to receive first. Or if it does, then it will happen with far more hard feelings than it strictly needs to.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580255/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580266"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 22:58 UTC (Mon)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/580266/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Your interpretation of the list discussions seems way too negative.  In any case, for reference<br>
<p>
<a href="http://lists.freedesktop.org/archives/dbus/2013-December/015902.html">http://lists.freedesktop.org/archives/dbus/2013-December/...</a><br>
<p>
It continues well into Jan for those who want to follow and make up their own minds.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580266/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580271"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 23:43 UTC (Mon)
                               by <b>ovitters</b> (guest, #27950)
                              [<a href="/Articles/580271/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm not any of what you're describing after reading 30+ messages. You said it is quite staggering plus easily visible after 6. I've read way more and didn't see it.<br>
<p>
Think you're biased, especially the way you describe things. I'm guessing you're not used to different communication styles?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580271/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580291"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 2:05 UTC (Tue)
                               by <b>hazmat</b> (subscriber, #668)
                              [<a href="/Articles/580291/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
i've spent the last hr reading the whole thread and frankly i have to agree with the grand parent. it maybe there's too politic in this. but if the kdbus is trying to adhere to dbus semantic (with zero benchmark outside of the obvious), then the cost of moving a few metadata headers to the benefit of all lsm is miniscule. a central point of control is the nature of security, devolving all this to untrusted apps is inane.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580291/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580329"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 13:57 UTC (Tue)
                               by <b>ovitters</b> (guest, #27950)
                              [<a href="/Articles/580329/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <p>You agree that after 6 messages it got extremely messy? I read 30+ and saw none of it. Only after loads and loads more messages I saw the Canonical discussion.</p>

<blockquote>then the cost of moving a few metadata headers to the benefit of all lsm is miniscule. a central point of control is the nature of security, devolving all this to untrusted apps is inane</blockquote>

<p>According to the kdbus developers (Lennart, Greg, Kay) it should NOT be done. They've suggested people try and write patches to understand this. Yet you so easily say that it is miniscule. Suggest to write patches instead. Further, as suggested in the same thread, this bit can be implemented by a LSM / linux security module.</p>

<p>Your argument seem to boil down to "everything should be in the kernel" / "please everyone". LSM would be in the kernel.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/580329/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580331"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 15:02 UTC (Tue)
                               by <b>hazmat</b> (subscriber, #668)
                              [<a href="/Articles/580331/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
mostly i'm agreeing that lennart has an abrasive style, the thread with him and ted early in the december archives qualifies for under 6 messages to messy. The more reasoned discussion in january also has some qualifiers.<br>
<p>
reading through more of the messages with fresh eyes, its pretty clear that the kernel impl wants to be lean and clean with tight focus, which is perfectly normal. Also normal is the desire for a message bus to be a policy attachment point as its pretty natural and indeed there is discussion there from lennart on direct extension of the acl mechanism with selinux tags (<a href="http://thread.gmane.org/gmane.comp.freedesktop.dbus/15499">http://thread.gmane.org/gmane.comp.freedesktop.dbus/15499</a>). The issue is that for those wanting fine grained security (down to method invocations) the use of kdbus is going to be problematic without extension of the headers. The issue with patches here is that they've explicitly already stated they'll be rejected, so what's the point of producing them?<br>
<p>
its not so much about putting everything in the kernel as it about an implementation than satisifies a general set of use cases such as those that the existing dbus already does. its unfortunate the previous impl didn't make it past the net maintainers (binder/ashmem compatible). anyways given the kdbus impl and the desire for not wanting to extend its routing headers with additional message attributes its clear that those who want fine grain will either have to implement payload  parse in particular lsms or more likely fallback to dbus daemon and not get the benefit of kdbus.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580331/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580371"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 16:57 UTC (Tue)
                               by <b>gregkh</b> (subscriber, #8)
                              [<a href="/Articles/580371/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The reason you should still write patches, even if someone has said that they will reject them is that it makes it easier for you to use the entire infrastructure, with just a small patch, for your use cases.<br>
<p>
Also, it allows you to be able to persuade the original developers that such a change really isn't a big deal.<br>
<p>
And, it also might just prove to yourself that asking for such a feature, really was a bad idea as the patches to implement it was horrible and caused major problems.<br>
<p>
That's why the Linux kernel mailing list very rarely has "idea" discussions, real patches are what matters.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580371/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580455"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 22:14 UTC (Tue)
                               by <b>ovitters</b> (guest, #27950)
                              [<a href="/Articles/580455/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Greg also explained the patch bit in other comment, but there was an email explaining this in the thread: I think it doesn't make sense, but if you can do it in a good clean way without performance impact/whatever, then we'll rethink.<br>
<p>
Initially they were quite firm on the no. But seems more like "no, that'll be bad", followed by a later "but convince me with code if you can". That's pretty much kernel style way of discussing design. Maybe too used to the kernel mailing list though (even though I haven't read it for many years, I rely on LWN).<br>
<p>
I really like a flat out "no" though. Much clearer.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580455/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580503"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 10:53 UTC (Wed)
                               by <b>jonnor</b> (guest, #76768)
                              [<a href="/Articles/580503/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I really prefer a "no, because ...". Just saying "no" is not very helpful.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580503/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor582340"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 25, 2014 15:24 UTC (Sat)
                               by <b>makomk</b> (guest, #51493)
                              [<a href="/Articles/582340/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There's also stuff like the discussion later on, where Lennart makes it clear that he doesn't think users should have more than one session open at once and will refuse patches that make this work. He talks about their views as being political and portrays them as having some kind of unneccesary attachment to the idea this should work, whilst spinning his own insistence on dictating how people use their computers as an entirely technical "design choice" - yet one that he will not budge from even if other people do the hard work and come up with patches to make it possible. Frankly, the whole thing reminds me of the tactics that some of the more unpleasant ideologues use to dismiss people who won't go along with their ideology. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582340/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor582351"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 25, 2014 16:11 UTC (Sat)
                               by <b>kmacleod</b> (guest, #88058)
                              [<a href="/Articles/582351/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I misunderstood the "one session" part too.<br>
<p>
Lennart's design goal appears to be (from his comments to the ml and irc) that there is only one user bus (and one process manager per user) and that each login on any graphical display be merged into one compositor+shell, xinerama-style.<br>
<p>
The GNOME guys are insistent on having only one logical session (where session in this context means the compositor+shell doesn't treat multiple displays as independently usable workplaces).<br>
<p>
It seems to me that a different compositor+shell could easily support merging multiple logins into one user bus (and one process manager) but still treat some displays as independent workplaces by presenting a menu/topbar/hot-spots and attached devices on separate workspace displays, even to the point of allowing someone to simply throw a running app from one workplace to another.<br>
<p>
So having one user bus and one process manager per user seems like a very reasonable low-level approach that allows the desktop environments to handle multiple workplaces however they want.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582351/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor582510"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 26, 2014 20:46 UTC (Sun)
                               by <b>ovitters</b> (guest, #27950)
                              [<a href="/Articles/582510/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
He said the lower levels would allow it, just that the higher levels (GDM) would turn everything back into one session.<br>
<p>
<font class="QuotedText">&gt; Frankly, the whole thing reminds me of the tactics that some of the more</font><br>
<font class="QuotedText">&gt; unpleasant ideologues use to dismiss people who won't go along with their</font><br>
<font class="QuotedText">&gt; ideology. </font><br>
<p>
Frankly, that kind of comments are inappropriate.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582510/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor582540"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 26, 2014 23:22 UTC (Sun)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/582540/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wonder what the use case of having multiple sessions per user is.<br>
Power users can easily create another login if they need a separate session for whatever reason.<br>
<p>
Everybody else should just get attached to their existing session. That already happens today, you get a strongly-worded "either you use your existing session or something might break" warning (I cannot remember which desktop environment does that, as I usually only use the login screen directly after boot-up).<br>
<p>
What's the problem, beside "it has always worked that way and now Lennart says it's nonsense, therefore Lennart is full of it"?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582540/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor582563"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 27, 2014 1:50 UTC (Mon)
                               by <b>kmacleod</b> (guest, #88058)
                              [<a href="/Articles/582563/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>Use cases I see:</p>

<ul>
<li>Remote desktop: When I VNC/RDP into my desktop from another location (home or conference room).  This shouldn't "replace" my primary session (log me off or mess up all my apps on my desktop screen) and I should get my own menu and hot-spots.

<li>Remote apps: Same thing, but just one app thrown rootless to my phone or TV, which has its own input and audio devices.  In reverse: where I'm running apps on a VM back to desktops.

<li>Microsoft's PixelSense (nee Surface):  All about having multiple user's remote apps on shared displays, moving between common workspaces and personal workspaces.

<li>Multiple terminals: Seats/workplaces in the kitchen, bedroom, bathroom, wallscreen.  Might be a dumb USB seat or a tablet/laptop/wireless touchscreen not running the same OS or version of Linux (ie. you can't just migrate the running app container to the other location, only the I/O).

<li>Development/testing: With one user bus and user process manager it's still necessary to run different "desktop sessions" to develop and test alternate desktop environments, compositors, and shells on the same host (with containers and, given the above, with VMs).  They need to be able to function reasonably (or better) under one bus and manager.
</ul>

<p>As I said in my comment earlier, one user bus and one process manager per user/host is good, I'll go further to say one "instance" of GNOME/other DE is good too but there should be (probably freedesktop.org-level) support for multiple session-like support for different desktops, seats, workplaces, apps, etc.</p>

<p>This might take the form of namespace hierarchies in the D-Bus user bus or, more likely across different machines, some other way to provide "localilty" to apps that need to know.</p>

<p>X11 was originally intended to fulfill this and did extremely well for years (and for many legacy cases still works great).  Over time as apps got closer to the hardware X started performing poorly and really doesn't work well for this anymore.  Wayland and remote display protocols are much better placed for doing this today.</p>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582563/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor580290"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 1:43 UTC (Tue)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/580290/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Please name names. Or, in this case, post URLs to messages you think are too abrasive.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580290/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580297"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 3:25 UTC (Tue)
                               by <b>mezcalero</b> (subscriber, #45103)
                              [<a href="/Articles/580297/">Link</a>] (47 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'll not discuss with you whether I am a dick or not. However, let me point out one thing you definitely didn't get right:<br>
<p>
"Another project's mailing list out of nowhere" --- well, I have been the maintainer of the dbus package for a while before Simon took over. Not for long, and I didn't do a good job at it, except for doing a few releases, but well, I have contributed my small share to it.<br>
<p>
Quite the opposite to that "first person" you are refering to as "the list", who contributed the staggering amount of ... zero patches to dbus over all those years....<br>
<p>
That said, this game is stupid. Regardless whether somebody has contributed something in the past or is an "outsider", I am quite sure that in Open Source we should accept and review everybody's patches. At least for systemd we try hard to judge by quality of code and the concepts behind it, and not by anything else...<br>
<p>
The discussion on the dbus mailing list was messy and certainly not overly productive (except for the good stuff Simon posted), however, try to see the from our perspective for an instant, if the first mails you get are from some random folks who never contributed anything, contain no technical comments but tell you that you shouldn't call this "dbus", and tell you that your code should not have been written in the first place.<br>
<p>
Lennart <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580297/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580317"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 10:19 UTC (Tue)
                               by <b>tsmithe</b> (guest, #57598)
                              [<a href="/Articles/580317/">Link</a>] (46 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
To me, as a layman, kdbus seems superior; so does systemd. The upstart event model strikes me as interesting, but not necessarily how you want to write your unit files. PulseAudio is brilliant.<br>
<p>
Yet -- watching these sagas evolve is fascinating (and by the number of comments they attract here on LWN, clearly I am not alone in thinking this). There is something Machiavellian in it: I don't understand all the technicalities (though I enjoy learning), and so I watch the power struggle.<br>
<p>
It is a power struggle that seems to exist only because the people on the edges have willed it. I think you just want to write good software -- but because you have originated so much good software, your actions are misconstrued. And yet, now, because of such misperceptions, fights really do break out, and there really do seem to be clans of people pro and versus you.<br>
<p>
It must be unsettling.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580317/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580513"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 14:12 UTC (Wed)
                               by <b>NAR</b> (subscriber, #1313)
                              [<a href="/Articles/580513/">Link</a>] (38 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
PulseAudio might be brilliant, but definitely broke lots of peoples audio (including mine) back in the day. The actual bugs might have been in ALSA drivers (at least this was what the PulseAudio developers said), but from the user perspective it looked like PulseAudio was introduced in the system, then the system no longer produced sounds. This was the last straw that made me go back to Windows on the desktop. I think episodes like this founded Lennart's bad reputation: introduces new "revolutionary" technology that breaks "everyone's" system.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580513/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580516"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 15:20 UTC (Wed)
                               by <b>johannbg</b> (guest, #65743)
                              [<a href="/Articles/580516/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
With my QA hat on in Fedora 90% of audio issues where alsa related issues exposed by pulseaudio when it got introduced which is consisted with what the pulseaudio developers say.<br>
<p>
If the alsa maintainers had manned up, stepped up and admitted this when people where flaming Lennart his reputation might be better intact. <br>
<p>
The fact is Lennart has been working hard to make people lives easier but people are working hard to make his life harder by discouraging his work and the project he works ( which he never works on alone btw ) and that has gone far enough already and people should stop flaming Lennart period<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580516/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580636"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 1:23 UTC (Thu)
                               by <b>eean</b> (subscriber, #50420)
                              [<a href="/Articles/580636/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  alsa related issues exposed by pulseaudio</font><br>
<p>
Which was why it was inappropriate for the distributions to deploy pulseaudio when it was deployed. There are other ways to fix ALSA drivers. You don't have the make sound unfun for thousands of users. :)<br>
<p>
That said I don't see the same mistakes being made with systemd at all. It was completely unnoticed when I upgraded to the version where openSUSE started using systemd. I'm guessing it's a combination of lessons-learned and no dependency on device drivers. <br>
<p>
Mostly the comparisons to PulseAudio is ad hominem attack on Pottering. I've never heard any substantive comparison. There's no equivalent to "broken ALSA drivers, but let's ship anyways" in systemd. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580636/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580640"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 3:01 UTC (Thu)
                               by <b>mchapman</b> (subscriber, #66589)
                              [<a href="/Articles/580640/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Which was why it was inappropriate for the distributions to deploy pulseaudio when it was deployed. There are other ways to fix ALSA drivers. You don't have the make sound unfun for thousands of users. :)</font><br>
<p>
I'm not sure if most of the problems would have been found if PulseAudio had had a more limited initial release. Sometimes you need thousands of users with thousands of different hardware combinations.<br>
<p>
I'm wondering how many problems were actually ALSA bugs and how many were just due to the settings Ubuntu had chosen. The PA developers made it quite clear that those settings were suboptimal.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580640/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580714"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 14:41 UTC (Thu)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/580714/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah, the way it was distributed in Ubuntu was a problem for the longest time (I don't know the details though). I got PulseAudio when I upgraded to Fedora 9 Alpha and had issues, but they were pretty well figured out by Fedora 11's release (or so). So something like one year of issues for me.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580714/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor581201"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 19, 2014 2:22 UTC (Sun)
                               by <b>krakensden</b> (subscriber, #72039)
                              [<a href="/Articles/581201/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I'm wondering how many problems were actually ALSA bugs and how many were just due to the settings Ubuntu had chosen. The PA developers made it quite clear that those settings were suboptimal.</font><br>
<p>
I've heard this a million times but I've never actually seen a list of what they did wrong. I've honestly started to chalk it off more to PA-developer deflection than truth.<br>
<p>
That said, I've certainly seen Debian and Ubuntu developers screw up packaging before.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/581201/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor581204"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 19, 2014 3:04 UTC (Sun)
                               by <b>mchapman</b> (subscriber, #66589)
                              [<a href="/Articles/581204/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I've heard this a million times but I've never actually seen a list of what they did wrong. I've honestly started to chalk it off more to PA-developer deflection than truth.</font><br>
<p>
I don't use Ubuntu, so I only got to watch the debacle from the sidelines. It's rather hard to piece together the story now some 5 years later.<br>
<p>
As far as I can tell it was a confluence of several problems.<br>
<p>
* <a href="https://bugs.launchpad.net/ubuntu/+source/pulseaudio/+bug/452458">https://bugs.launchpad.net/ubuntu/+source/pulseaudio/+bug...</a><br>
Ubuntu had not backported a kernel patch that would allow rtkit to run properly, so PA was unable to get realtime priority.<br>
<p>
* <a href="http://ubuntuforums.org/showthread.php?t=789578">http://ubuntuforums.org/showthread.php?t=789578</a><br>
This HOWTO suggests that they didn't divert ALSA apps to use PA, which meant those apps' audio would not be mixed with the audio from PA-using apps.<br>
<p>
There might have been other issues too. It's complicated, because this all coincided with the time PA implement so-called "glitch-free" audio, which as I understand it exercised a lot of code in the ALSA drivers that was rarely used before.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/581204/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor580725"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 15:08 UTC (Thu)
                               by <b>HelloWorld</b> (guest, #56129)
                              [<a href="/Articles/580725/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; There are other ways to fix ALSA drivers.</font><br>
Like what? <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580725/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor580526"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 15:26 UTC (Wed)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/580526/">Link</a>] (29 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There is a reason everyone keeps bringing up the same example of PulseAudio in 2008 or whenever it first landed in a widely-used distro, it's because they don't have examples from more recent development such as systemd.<br>
<p>
There is one lesson to be learned though, Lennart has a visceral rejection of cluttering up his services with workarounds when the problems are in other open-source software which can be changed to fix the bugs instead.  His pushback to fix the bugs where they lie at the source has made the whole stack more robust.<br>
<p>
What is unfortunate is that there is not a large enough desktop Linux ecosystem to have the vendors of consumer hardware do their own testing and bug fixes rather than requiring things to break on end-user desktops before bugs can be discovered and fixed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580526/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580534"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 16:06 UTC (Wed)
                               by <b>NAR</b> (subscriber, #1313)
                              [<a href="/Articles/580534/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That first impression made the bad reputation, that's why that is brought up all the time.<br>
<p>
Also, "no workarounds" is understandable from the engineer's perspective, but from the user's perspective it looks like "that *** broke my system and doesn't even want to fix it!". In proprietary environment this is the time when a manager intervenes one way or other to avoid public relation disaster.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580534/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580541"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 16:56 UTC (Wed)
                               by <b>niner</b> (subscriber, #26151)
                              [<a href="/Articles/580541/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Lennart did not break any systems. Pulseaudio did not break any systems. Distributions that switched on Pulseaudio before the problems in ALSA were fixed and did not provide simple ways to turn it off broke people's systems.<br>
<p>
As an openSUSE user I found the whole discussions about Pulseaudio rather strange. It was just one easily discoverable click to turn Pulseaudio off when it didn't work and one click to turn it on again when the problems were fixed. And nowadays I have a wonderful system and can use the very nice features Pulseaudio provides.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580541/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580903"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 17, 2014 1:56 UTC (Fri)
                               by <b>deepfire</b> (guest, #26138)
                              [<a href="/Articles/580903/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
..and of course Lennart did not have any way to influence the Pulseaudio rollout by the distributions:<br>
<p>
  - no rollout strategy discussions were possible<br>
  - he couldn't even predict there'd be any problems!<br>
<p>
Sorry, this view doesn't fly.  Lennart had a meaningful power to specify the pulseaudio use scenarios -- but he didn't exercise it.  Probably because everything worked fine on his systems.<br>
<p>
I'm not saying it's an uncommon mistake -- but it's an uncommon situation as a whole -- the impact was tremendous, since, well, everybody uses sound.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580903/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580906"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 17, 2014 2:20 UTC (Fri)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/580906/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
" - he couldn't even predict there'd be any problems!"<br>
<p>
On the contrary, he predicted that any such rollout will have to deal with issues and those issues would likely only surface with mass deployments of the software under different real world configurations due the wildly different set of hardware out there.  This is the nature of complex software (compatibility layering requirements) and the amount of investment commercial Linux vendors are willing to make to move the desktop oriented technology forward. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580906/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580911"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 17, 2014 3:55 UTC (Fri)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/580911/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Lennart is involved with Fedora and things were bad there (at least among my machines with pretty well-supported hardware) for at most a year (Fedora 11 was fine). The Ubuntu deployment was one of the worse ones and AFAIK (though I have no details though), it was mentioned (on fedora-devel) that they weren't following upstream guidelines for whatever reason. Maybe jspaleta has some links or such handy? ;)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580911/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor580543"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 17:16 UTC (Wed)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/580543/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Current example:<br>
<p>
I fired up an old CPC emulator the other day, to play an old game I like. It used to play sound last time, via /dev/dsp. It doesn't today. Pulseaudio keeps /dev/dsp open, preventing others using it, even when not playing anything. The pulseaudio wrapper binary causes the whole thing to segfault somewhere.<br>
<p>
Re the "Those weren't my bugs" attitude of earlier pulseaudio days, that might have been technically correct at some deep engineering level, but it wasn't at all what the end-user considered correct behaviour.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580543/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580561"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 17:19 UTC (Wed)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/580561/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
/dev/dsp is OSS. There are no OSS drivers for many new audiochips at all (including the popular Intel HD), so you'd still be out of luck.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580561/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580563"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 17:24 UTC (Wed)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/580563/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not so. ALSA supports the OSS interfaces.<br>
<p>
The OSS → ALSA transition was fairly pain-free. ALSA → Pulse not so. IME.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580563/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580573"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 18:01 UTC (Wed)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/580573/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Nope. ALSA dropped OSS compatibility shims in favor of a CUSE-based driver long time ago, they never worked correctly and nobody wanted to maintain them. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580573/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580574"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 18:06 UTC (Wed)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/580574/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That's news to me. <br>
<p>
<p>
# ls /dev/dsp*<br>
/dev/dsp  /dev/dsp1<br>
# lsmod |grep oss<br>
snd_seq_oss            38268  0 <br>
snd_seq_midi_event     14437  1 snd_seq_oss<br>
snd_pcm_oss            53613  0 <br>
&lt;etc&gt;<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580574/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580693"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 13:18 UTC (Thu)
                               by <b>cortana</b> (subscriber, #24596)
                              [<a href="/Articles/580693/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'd not go as far to say snd-pcm-oss and friends are dropped, but of the two distributions I have in front of me, Debian hasn't loaded them by default since 2008, and Ubuntu doesn't even build them any more.<br>
<p>
The major shortcoming with the snd-pcm-oss module is precisely the problem you observe; unless your sound card has hardware mixing, the kernel will only permit one process to open either /dev/snd/pcm/pcm* or /dev/dsp at a time. The last such card I had the displeasure to use was a SoundBlaster Live! almost a decade ago.<br>
<p>
You should look in to the CUSE solution (Debian package: osspd) if you still need /dev/dsp; if it's not available for your distro and you don't feel like packaging it yourself then you can always run your OSS-using program via pasuspender, which politely tells pulseaudio to get out of the way while your program runs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580693/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580884"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 22:13 UTC (Thu)
                               by <b>ms-tg</b> (subscriber, #89231)
                              [<a href="/Articles/580884/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
(applause for gently and politely introducing a solution to his problem)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580884/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor580571"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 18:00 UTC (Wed)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/580571/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is how it always worked on Linux (AFAIK): only one thing could output audio. Hence using things like aRts and (today) PulseAudio. Now I can have audio streaming through mplayer and mute it to play something else. Before, the second program wouldn't be able to use audio because the first had a hold on it. I don't know what multi-seat does these days (system-wide Pulse?).<br>
<p>
I don't know if there's a way to get OSS programs to use PulseAudio. If not, kill PulseAudio and use the CPC emulator then. PulseAudio tends to get started on-demand (and will block if the emulator is running), so getting back to normal is implict there.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580571/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580575"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 18:11 UTC (Wed)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/580575/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes indeed, OSS only ever supported one user. Apps back in the day used to be good about relinquishing sound devices when not using them precisely for that reason. :) And yes I can and did kill pulseaudio - though that sometimes leads to hard to pin down oddness later in the session with volume and stuff, so I generally prefer not to.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580575/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580582"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 19:14 UTC (Wed)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/580582/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Rather than killing PulseAudio, you can run your program through pasuspend, which will cause PulseAudio to relinquish the audio device while the program is running. If you have CUSE[1] enabled in your kernel, you can also use OSSProxy[2] to route audio from /dev/dsp to PulseAudio rather than using ALSA's OSS emulation layer.<br>
<p>
[1] "Character devices in user space" &lt;<a href="http://lwn.net/Articles/308445/">http://lwn.net/Articles/308445/</a>&gt;<br>
[2] &lt;<a href="https://fedoraproject.org/wiki/Features/OSSProxy">https://fedoraproject.org/wiki/Features/OSSProxy</a>&gt;<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580582/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580665"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 9:32 UTC (Thu)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/580665/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ah, pasuspend. Very interesting. I ran "pasuspender sleep 100d", then ran my CPC emulator and it still crashes, so that strongly suggests the problem is in the OSS ALSA emulation not being what the emulator expects. I'll look into why that is. <br>
<p>
Thanks!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580665/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor580765"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 16:00 UTC (Thu)
                               by <b>ThinkRob</b> (guest, #64513)
                              [<a href="/Articles/580765/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>Yes indeed, OSS only ever supported one user. </blockquote>

Just as clarification: <i>Linux's built-in implementation</i> of OSS only ever supported one user.  Other implementations (such as 4Front's OSS4 for Linux) did and do support multiple concurrent applications producing sound.
      
          <div class="CommentReplyButton">
            <form action="/Articles/580765/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580826"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 18:33 UTC (Thu)
                               by <b>pizza</b> (subscriber, #46)
                              [<a href="/Articles/580826/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Just as clarification: Linux's built-in implementation of OSS only ever supported one user. Other implementations (such as 4Front's OSS4 for Linux) did and do support multiple concurrent applications producing sound. </font><br>
<p>
...and OSS4 wasn't free, in both meanings of the term.<br>
<p>
...that is, until long after ALSA had come to dominate.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580826/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor580578"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 18:54 UTC (Wed)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/580578/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's rather easy to tell pulseaudio to release the audio device. The reason nobody does that out of the bix is very simple: many audio drivers produce loud and/or ugly-sounding klicks when you open and/or close them.<br>
<p>
Did you try the padsp wrapper?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580578/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580604"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 20:25 UTC (Wed)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/580604/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
He said that caused it to segfault somewhere. I bet the thing was mmap()ping /dev/dsp, which is nearly impossible to virtualize (you need CUSE and the like, anyway padsp doesn't and can't do it).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580604/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor582252"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 25, 2014 0:01 UTC (Sat)
                               by <b>makomk</b> (guest, #51493)
                              [<a href="/Articles/582252/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
PulseAudio now, in 2014, is still bad enough that I'm seriously considering switching back to Windows after almost a decade of primarily running Linux just so that I don't have to suffer through dealing with it anymore. If anything, it's managed to develop new forms of brokenness over the years. For example I have all kinds of fun issues with it crashing randomly or using 100% CPU or randomly mangling audio output until I kill and restart it which weren't there a few years ago. (I'm 80% sure the code in the PulseAudio daemon that supports volume meters is plain wrong in a way that causes random crashes, but all the comments are missing and the variable names misleading so it's impossible to tell - and that's after reverting an optimisation in the latest official release that was included despite being literally incomplete and breaking it further.) Oh, and naturally restarting PulseAudio for any reason randomly kills all sound output in many applications until they're restarted.<br>
<p>
Likewise, flat volumes breaks in random and amusing new ways with every version, and I've never encountered any of the mythical hardware it actually works on without annoying pops and glitches and random bursts of excessively loud audio when an app starts or exits. Hell, I've even tried it on hardware with no hardware volume control at all and somehow it still managed to screw that up by trying to adjust the non-existent hardware volume control - so lowering the application volume level had no effect until suddenly it muted the output entirely. So far as I can tell, the entire feature relies on hardware behaving in ways that isn't part of any specification and cannot ever be relied on. Though at least that can be disabled if you edit the right obscure configuration file as root.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582252/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor582272"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 25, 2014 1:07 UTC (Sat)
                               by <b>pizza</b> (subscriber, #46)
                              [<a href="/Articles/582272/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; PulseAudio now, in 2014, is still bad enough that I'm seriously considering switching back to Windows after almost a decade of primarily running Linux just so that I don't have to suffer through dealing with it anymore.</font><br>
<p>
I counter your anectdote with one of my own; half a dozen or so systems over as many years, all working without an audio-related hitch. All using bog-standard onboard AC97 or HD Audio codecs.<br>
<p>
So, what applications are having problems?  What were already streaming?  What pulseaudio version?  What hardware?  Have you filed any bug reports?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582272/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor582768"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 27, 2014 22:50 UTC (Mon)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/582768/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I do have one problem, and it's an annoying one. When programs try to adjust the master volume themselves, PA automatically tweaks all the per-application volumes to compensate -- but when you try to move the master volume back down (in e.g. pavucontrol) the per-application volumes are all reduced, so you have to tweak them up by hand: system boots restore the master volume to a consistent level, but do not change the per-application volumes. The net effect is that every system reboot followed by e.g. a QEMU startup halves the volume of every application playing sound at that time. This is not sane behaviour :(<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582768/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor582787"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2014 1:22 UTC (Tue)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/582787/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ah, this behaviour of PA drives me batty - so it's not just me? I'm never quite sure what is going to happen with the volume when I adjust it. :(<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582787/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor582796"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 28, 2014 2:19 UTC (Tue)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/582796/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This sounds like flat-volumes. I have this in my .config/pulse/daemon.conf:<br>
<p>
<font class="QuotedText">&gt; flat-volumes = no</font><br>
<p>
Try and see if that fixes it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582796/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor583248"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2014 23:35 UTC (Wed)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/583248/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The thing is, I *like* flat volumes in all other respects. It's just that I wish programs that modified the master volume could be faked into adjusting only their own per-app volume instead. The master volume is the user's, and no app should be allowed to fiddle with it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/583248/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor583255"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 29, 2014 23:55 UTC (Wed)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/583255/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I wonder if an option in PulseAudio to enforce that behavior would be accepted by upstream. It doesn't sound like an awful plan. The question, I guess, is how do you change the master volume then? pacmd?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/583255/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor583275"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 30, 2014 0:49 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/583275/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm using pavucontrol... but in general whatever the desktop environment uses to control the master volume should change it: random programs shouldn't futz about with it, particularly not if there's no easy way for the user to reverse what they did. (If I as a user change the master volume in pavucontrol, everything changes volume -- i.e. it does *not* automatically shift the volume of everything else to compensate. So errant programs can do things I cannot reverse.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/583275/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor582285"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 25, 2014 4:18 UTC (Sat)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/582285/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
PA has been stable for a long time now, I would guess there is something interesting about your hardware or your config and the PA developers would grateful if you worked with them to figure out what it is.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582285/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor581644"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 21, 2014 22:10 UTC (Tue)
                               by <b>pgoetz</b> (subscriber, #4931)
                              [<a href="/Articles/581644/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Are we really still talking about PulseAudio ... in a kdbus comment section?  Seriously?  Lennart's !fanboys have become white noise point sources.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/581644/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor582083"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 23, 2014 18:06 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/582083/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The problem with Lennart is that he is intolerant of other peoples' bugs.<br>
<p>
"Be conservative in what you send, and liberal with what you accept" just doesn't fit his way of working. If the spec says "when you do X, then Y should happen" then Lennart assumes that Y will happen. Far too much software is far too accepting when Y doesn't happen - Lennart just says "your software is broken, FIX IT!"<br>
<p>
I gather that's why PulseAudio was such a mess when it first appeared - it kept tickling *other* *peoples* bugs. And Lennart insisted they fix their bugs, rather than him work around them.<br>
<p>
Looked at at a technical level, that's the only approach that makes sense. But it does rather ruffle a lot of feathers.<br>
<p>
That seems to have been one major reason for writing SystemD - SysVInit just contains too many design flaws to be even fixable ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582083/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor582172"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2014 12:55 UTC (Fri)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/582172/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
We need more people who are intolerant of bugs in other software.  The danger of working around bugs is that they never get *fixed*, because the workarounds are good enough that users don't notice the bugs and complain until they get fixed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582172/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor582176"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2014 13:40 UTC (Fri)
                               by <b>anselm</b> (subscriber, #2796)
                              [<a href="/Articles/582176/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>Working around other people's bugs basically gets you HTML. You have to figure out everybody else's workarounds to put those in your code, too, and it never stops.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/582176/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor582223"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2014 19:26 UTC (Fri)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/582223/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
what software that is completely intolerant of any bugs in other implementations has every become significant?<br>
<p>
In theory you are correct, in practice being intolerant of bugs in other people's code just doesn't work very well and causes your users a LOT of pain.<br>
<p>
unless you are really able to force your users to use your code even when it's a worse experience than what you are replacing, (by getting a major distro to remove the old option and ship yours for example), you are really not likely to gain a lot of users. You will definitely earn your users ire and distrust. This distrust will take a LONG time to go away, if it ever does.<br>
<p>
As this subthread is showing with the complaints years later about PulseAudio <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582223/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor582228"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2014 20:33 UTC (Fri)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/582228/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Workarounds for other people's bugs are OK if you don't lose your core features that way. If Pulse had tolerated higher latency to work around the bugs it managed to trigger, nobody would have wanted to use it in the first place.<br>
<p>
Plus, you really cannot blame the distros. The features pulseaudio offered were too compelling. Remember that there basically was no hotplugging of audio devices at the time. Today I can pair up my Bluetooth headphones and immediately switch over my background soundtrack without even hearing an audio glitch.<br>
<p>
Likewise, some of the things systemd does are somewhat annoying, but once you start taking even a third of its features for granted you won't ever switch back. (IMHO.) I suspect it'll be much the same with kdbus.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/582228/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor582229"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2014 20:38 UTC (Fri)
                               by <b>anselm</b> (subscriber, #2796)
                              [<a href="/Articles/582229/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>
»Be strict when you send and tolerant when you receive« wasn't such a great idea in the first place. It serves more as an excuse for sloppy implementations than it does improve interaction between programs. It is better to be just as strict when you're receiving stuff as when you're sending stuff so bugs can be found earlier. If everybody is being tolerant then the sloppy senders never get fixed, and if you write new receiving code to the specs you will have to figure out all the workarounds that are required to handle the entrenched sloppiness. (And of course the workarounds will be different in different implementations such that sloppy stuff leads to different results.) This sucks but fixing it can be an uphill battle – for example, the W3C came up with XHTML to get rid of the ingrown sloppiness in HTML, but we all know what became of that idea.
</p>
<p>
It is tough being the only strict person when all around you everyone is complacent about sloppy code – even if your code is a lot better, people won't like it if <em>their</em> stuff breaks, and they will make you the culprit even if they themselves are technically at fault. Nobody likes a stickler for the rules because those make their life more difficult. But that doesn't change the fact that the rules are there for a reason.
</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/582229/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor582235"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 24, 2014 21:19 UTC (Fri)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/582235/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote><font class="QuotedText">what software that is completely intolerant of any bugs in other implementations has every become significant?</font></blockquote>

<p>Not software but a specification: XML. <a href="http://www.w3.org/TR/REC-xml/">Violations of well-formedness constraints are fatal errors</a> which means when you try to feed non-well-formed document to an application usually you see flat-out rejection.</p>

<p>Works pretty damn well in practice.</p>

<blockquote><font class="QuotedText">unless you are really able to force your users to use your code even when it's a worse experience than what you are replacing, (by getting a major distro to remove the old option and ship yours for example), you are really not likely to gain a lot of users. You will definitely earn your users ire and distrust. This distrust will take a LONG time to go away, if it ever does.</font></blockquote>I think you've just justified Lennart's position. If you introduce a new software which does not tolerate mistakes (e.g. pulseaudio or expat) then people may adopt it or refuse it but they will be forced to keep everything straightened out. If you'll introduce “temporary” workarounds then you'll be forced to carry them more-or-less forever.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/582235/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor580263"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 13, 2014 22:55 UTC (Mon)
                               by <b>error27</b> (subscriber, #8346)
                              [<a href="/Articles/580263/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Earlier this week, I was reviewing vmbus which is similar to dbus but used for talking to hyperv clients.  If we had had kdbus in 2011, then vmbus would have been written as a frontend to kdbus.  This seems like a useful thing to me.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580263/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580284"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 1:10 UTC (Tue)
                               by <b>dw</b> (guest, #12017)
                              [<a href="/Articles/580284/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I find it shockingly hard to believe that this needs to go into the kernel – to say D-bus needs to live in the kernel is to say that there are no existing efficient userspace&lt;-&gt;userspace IPC interfaces, which is obviously nonsense.<br>
<p>
There is little preventing an ABI-compatible libdbus that does little but coordinate a directory held in shared memory or similarly stashed elsewhere, having just enough logic to setup mappings or socket pairs between peers, with all validation done by the library code at the receiver. There is even no requirement for the filesystem to be present thanks to e.g. the SO_UNIX abstract namespace that's been around since forever.<br>
<p>
For similar reasons I've never understood the value of the DBUS daemon – does it manage some super secret policy that its clients aren't allowed to peruse directly?<br>
<p>
Reminds me a lot of devfs<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580284/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580289"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 1:40 UTC (Tue)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/580289/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
We don't have multicast Unix sockets.<br>
<p>
I strongly suspect that by the time you implemented that, then write the userspace library to coordinate everything so that it presents roughly the same interface as userspace dbus, you'd have more code with less security than what kdbus will offer.<br>
<p>
For instance, proper message marshalling can be checked once - by the kernel - or by every recipient. Guess which is going to be more efficient.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580289/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580293"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 2:49 UTC (Tue)
                               by <b>hp</b> (guest, #5220)
                              [<a href="/Articles/580293/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
When something is as widely adopted and used as dbus it's obviously solving some problem, so why not work to understand what it is?<br>
<p>
Not everything called "IPC" is the same thing with the same properties and requirements.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580293/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580298"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 3:36 UTC (Tue)
                               by <b>mezcalero</b> (subscriber, #45103)
                              [<a href="/Articles/580298/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What dbus does, that naked AF_UNIX doesn't is this: broadcasting, introspectability, policy, activation, synchronization, method call transactions, signals, properties, OO, type-safe marshalling, monitoring, global ordering, ...<br>
<p>
The difference between kdbus and dbus-daemon otoh are: performance, support for exchanging extensive payload not just control, timestamping, more credentials, kernel-side hookup with LSMs, race-free deactivation for services, ... -- The big one however is certainly the first mentioned: performance.<br>
<p>
Lennart<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580298/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580309"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 7:50 UTC (Tue)
                               by <b>edomaur</b> (subscriber, #14520)
                              [<a href="/Articles/580309/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I really like the idea. The only thing I am a bit cautious is : what will happens to integration of D-BUS in other platforms than Linux ? <br>
<p>
I know that's not your problem and I even agree to your point of view regarding other platforms, but desktop environments are not for Linux only, and D-BUS must be working the same way everywhere it is ported. How kdbus is working and how its new protocol addons must be documented in a way abstracted from the code.<br>
<p>
(Anyway, I'm not a coder anymore, so I will not take the task.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580309/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580498"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 9:18 UTC (Wed)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/580498/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Other platforms can keep using the old AF_UNIX protocol with the system dbus daemon.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580498/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580585"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 19:29 UTC (Wed)
                               by <b>mezcalero</b> (subscriber, #45103)
                              [<a href="/Articles/580585/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Other platforms can continue to use the old implementation, and we are pretty much compatible to that, with minor exceptions which shouldn't matter much. That is of course, unless apps start making use of kdbus features directly or indirectly. For example, an app that starts to send huge amounts of data across kdbus will work great and fast, but if you replace the backend by dbus-daemon, then it will still work, but very slowly.<br>
<p>
So, there's basically going to be a dbus "baseline", which includes certain features and perfomance expectations. If people stick to that (and a lot probably will) then things stay perfectly portable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580585/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor580323"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Why?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 11:58 UTC (Tue)
                               by <b>bokr</b> (subscriber, #58369)
                              [<a href="/Articles/580323/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I am wondering how kdbus will play with a hypervisor and its guests.<br>
<p>
E.g., imagine that you have built a signed (by yourself) UEFI-bootable kernel that can serve as a jailhouse[1] hypervisor.<br>
[1] <a href="http://lwn.net/Articles/574273/">http://lwn.net/Articles/574273/</a><br>
<p>
Then imagine that you can trigger a Secure Attention signal by pushing a button with tamper-evident direct path to a NMI that the hypervisor sees. (Ok, for now, trust the hypervisor kernel to detect Ctl-Alt-Del in kb input ;-)<br>
<p>
Imagine that the hypervisor loads a signed trusted login process image into a separate jailhouse, and you log in. Now you are in a user shell sort of like bash after Alt-F2 plus login, only you are a self-contained booted hypervisor guest process in a jailhouse cell.<br>
<p>
How would kdbus support secure communication with other on-the-metal guests in other cells? I am visualizing a truly paranoid system where all apps and kernel services are signed bootable monolith images that need to communicate securely.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580323/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor580304"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Yielding CPU time to destination</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 6:22 UTC (Tue)
                               by <b>mitchskin</b> (guest, #32405)
                              [<a href="/Articles/580304/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Lennart didn't have time for it in the talk, but I'm interested in hearing more about the "Yielding CPU time to destination" part.  I vaguely recall reading (probably on an LWN comment thread) that another system's IPC mechanism (QNX's?) was hooked into the scheduler this way.  Sending and receiving messages without having to wait for the scheduler to run seems like a nice win, at least for some loads.<br>
<p>
I'm not sure how much sense that makes if you have an async API, though.  Context switching on a blocking call seems fairly straightforward, but it's not clear to me how the CPU-yielding would work in the async case.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580304/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580305"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Yielding CPU time to destination</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 6:33 UTC (Tue)
                               by <b>jonabbey</b> (guest, #2736)
                              [<a href="/Articles/580305/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I believe it was some Windows API.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580305/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580307"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Yielding CPU time to destination</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 7:31 UTC (Tue)
                               by <b>wahern</b> (subscriber, #37304)
                              [<a href="/Articles/580307/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah, I believe the Windows completion API can execute an asynchronous callback in the process, not unlike Unix signals. This can be very performant in some scenarios, but also ridiculously ugly, bug prone, difficult to compose (i.e. hard to create transparent components which don't leak the low-level details), and forces you to use particular threading design patterns which may not be optimal or desirable.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580307/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor580308"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Yielding CPU time to destination</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 7:37 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/580308/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Lots of IPCs can do this. QNX naturally has it, Solaris Doors can do this and even Windows LPC (which is used to implement most of Win32 API, btw)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580308/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580324"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Yielding CPU time to destination</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 11:39 UTC (Tue)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/580324/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Windows LPC was used to implement the GUI in userspace in NT 3.5 times.  That was moved to kernel space (together with all the TOCTTOU bugs it had) in NT 4.0.<br>
<p>
Nowadays, the LPC implementation is still used by some system processes, and under the hood by DCOM RPC when the source and destination reside on the same host.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580324/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor580375"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Yielding CPU time to destination</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 16:59 UTC (Tue)
                               by <b>gregkh</b> (subscriber, #8)
                              [<a href="/Articles/580375/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The Android binder code works this way, it yields the CPU to the destination, which is one big reason why binder will not be able to be easily replaced with kdbus.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580375/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580427"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Yielding CPU time to destination</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 19:56 UTC (Tue)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/580427/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why not? Seems to me it'd be rather trivial to add that feature.<br>
<p>
Also, I wonder whether we need it in the first place. Today's phones have multiple CPUs, presumably one of them is idle; besides, the source task will probably go to sleep, waiting for the reply, within a msec or two.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580427/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580433"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Yielding CPU time to destination</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 20:16 UTC (Tue)
                               by <b>gregkh</b> (subscriber, #8)
                              [<a href="/Articles/580433/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Why not? Seems to me it'd be rather trivial to add that feature.</font><br>
<p>
Patches gladly accepted :)<br>
<p>
<font class="QuotedText">&gt; Also, I wonder whether we need it in the first place</font><br>
<p>
The Binder interface relies on this process flow for how it works.  If you want to, just change the kernel binder code and see if anything breaks in your Android system...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580433/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor580490"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Yielding CPU time to destination</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 5:21 UTC (Wed)
                               by <b>mitchskin</b> (guest, #32405)
                              [<a href="/Articles/580490/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Could you expand on specifically why it's hard to replace binder with kdbus, and why you designed kdbus in a way that makes it difficult?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580490/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580519"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Yielding CPU time to destination</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 14:48 UTC (Wed)
                               by <b>gregkh</b> (subscriber, #8)
                              [<a href="/Articles/580519/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The models are totally different, I'll write up a blog post about all of the reasons why later on, it's a non-trivial thing.<br>
<p>
And Kay and Lennard really did try to be able to replace binder with kdbus, but everyone agrees, the binder developers included, that this just will not work, so no one involved is unhappy or upset about it at all.<br>
<p>
Just remember, never use binder for any code outside of an Android-only system, it is very dangerous to do so, and you get to own the pieces of your kernel if you happen to do so.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580519/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor580667"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Yielding CPU time to destination</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 9:54 UTC (Thu)
                               by <b>renox</b> (guest, #23785)
                              [<a href="/Articles/580667/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; but I'm interested in hearing more about the "Yielding CPU time to destination" part.</font><br>
<p>
Last time I read about it is here: <a href="http://lwn.net/Articles/576691/">http://lwn.net/Articles/576691/</a><br>
<p>
<font class="QuotedText">&gt; but it's not clear to me how the CPU-yielding would work in the async case.</font><br>
It wouldn't, otherwise it's not async.. That said, if you fill the buffer an async IPC "degenerate to synchronous" (if you see what I mean), so it could still be interesting to yield the CPU if/when this happen.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580667/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor580310"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">kdbus, for dbus only?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 8:02 UTC (Tue)
                               by <b>nhippi</b> (subscriber, #34640)
                              [<a href="/Articles/580310/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So, from the article and slides, it seems kdbus and memfd aren't designed to provide building blocks that can be used by binder and ashmem? Kernel developers wouldn't accept new drivers that are inspired by other drivers but don't share any code/functionality. But here it seems a new userspace api is being proposed that is tailored for dbus and dbus only.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580310/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580311"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">kdbus, for dbus only?</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 8:16 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/580311/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As I understand the last attempt to make a generic API resulted in network subsystem maintainer flatly refusing it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580311/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor580312"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 8:30 UTC (Tue)
                               by <b>djc</b> (subscriber, #56880)
                              [<a href="/Articles/580312/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm hoping the kdbus guys will communicate with Martin Sustrik (the inventor of the pretty successful ZeroMQ) on what kind of thing he would need for e.g. nanomsg. nanomsg is basically a rewrite (in the good sense!) of ZeroMQ, and pretty awesome. IIRC Martin has proposed patches for kernel-level support for nanomsg, but that hasn't gone anywhere so far.<br>
<p>
<a href="http://www.slideshare.net/jamesskillsmatter/martin-sustrik-futureofmessaging">http://www.slideshare.net/jamesskillsmatter/martin-sustri...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580312/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580322"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 10:55 UTC (Tue)
                               by <b>ms</b> (subscriber, #41272)
                              [<a href="/Articles/580322/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, there are plenty of interesting messaging products on the market from the closed source SonicMQ and friends, to the open source (and extremely widely used) RabbitMQ (disclaimer: which I co-wrote), Kafka and ZeroMQ. Different products focus on different things; for example Rabbit's never focussed on speed outright, always more on reliability and offering guarantees about message loss/preservation. ZeroMQ certainly takes a different approach. But yes, I would hope the kdbus designers have spent some time looking at what other people need and use - DBus is a rather small part of the picture. That said, my reading so far (albeit very brief) is that kdbus is really focussed on IPC, and not in the distributed sense. But I may be wrong.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580322/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor580326"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 13:43 UTC (Tue)
                               by <b>jspaleta</b> (subscriber, #50639)
                              [<a href="/Articles/580326/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Greetings from the southpole,<br>
<p>
So reading through the thread in full, and I'm only seeing one really interesting point of contention. It appears that the app sandbox model being used for Unity treads into a bit of a grey area with regard to security policy enforcement.  The functionality they are relying on appears to be an implementation detail of dbus-daemon and not part of the D-Bus spec which all daemons are expected to provide. <br>
Quoting the spec:<br>
<a href="http://dbus.freedesktop.org/doc/dbus-specification.html">http://dbus.freedesktop.org/doc/dbus-specification.html</a><br>
"Message bus implementations may impose a security policy which prevents certain messages from being sent or received"<br>
<p>
Up till now its not really come up, because we haven't had a second implementation of the spec for the "may" clause to come into effect. But now, kdbus as a second implementation of the spec, doesn't include that optional security policy check. It doesn't have to, as the D-Bus spec allows this to be an implementation by implementation choice to make. <br>
<p>
And so the concern is, the sandbox model Ubuntu is using is layered over dbus-daemon in Ubuntu isn't going to work with kdbus as designed. Noone is at fault here. Decisions were made to rely on optional implementation functionality not covered by the protocal spec. And the kdbus design decisions preclude the optional security policy check.<br>
<p>
The only salient question is this.  Will Ubuntu's sandbox model continue to require the reference dbus-daemon implementation, or can modifications be done to either Ubuntu's user space or to kdbus design so Ubuntu can take advantage of kdbus performance benefits in later releases?  The irony of course is that Ubuntu's mobile push would probably benefit the most from kdbus's performance gains, but at the same time its also where their sandbox model is most useful as well. <br>
<p>
-jef<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580326/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580340"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 15:41 UTC (Tue)
                               by <b>paulj</b> (subscriber, #341)
                              [<a href="/Articles/580340/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Wow, you're trying to turn even a kdbus article into a discussion on Unity/Ubuntu. Please try harder to control this obsessive behaviour of yours. :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580340/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580365"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 16:56 UTC (Tue)
                               by <b>ovitters</b> (guest, #27950)
                              [<a href="/Articles/580365/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Someone else mentioned that email thread, suggesting all kinds of inaccuracies. E.g. that within 6 posts it was bad. Jef seems to pretty accurately describe the concerns that were raised in this email thread IMO. I find it fairly important to highlight such concerns.<br>
<p>
Also quite interesting is the difference between the how Ubuntu app sandboxing will work and the one envisioned for kdbus/gnome/whatever to call it. You'll note that both sides tried to work together, though didn't pan out in the end.<br>
<p>
Then you have tidbits about Samsung already using an old version of kdbus. Further, that kdbus won't be used easily by Binder (the Android thing). I thought it would be able to be used for Binder as well, so interesting to read. It makes me wonder what Samsung is using it for (guessing Tizen, but would be nice to know for sure). <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580365/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580413"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 19:25 UTC (Tue)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/580413/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I just read through part of the discussion started by Lennart's announcement at <a href="http://thread.gmane.org/gmane.comp.freedesktop.dbus/15499">http://thread.gmane.org/gmane.comp.freedesktop.dbus/15499</a><br>
<p>
As far as I understand, if somebody (Ted Gould in this case) says to Lennart that<br>
<p>
<font class="QuotedText">&gt;&gt; I see you as delivering an ultimatum to the DBus community about how they've been replaced.</font><br>
<p>
then I guess I can understand why Lennart doesn't want to continue that kind of "discussion". The responsibility to keep a discussion civil and factual is shared by both sides of a debate; blaming Lennart for that subthread's ultimate failure to commuicate is unfair.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580413/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580444"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 21:14 UTC (Tue)
                               by <b>tanuk</b> (guest, #71154)
                              [<a href="/Articles/580444/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It makes me wonder what Samsung is using it for (guessing Tizen, but would be nice to know for sure).</font><br>
<p>
Yes, Tizen, judging from this message (Tizen git repo referenced): <a href="http://thread.gmane.org/gmane.comp.freedesktop.dbus/15499/focus=15516">http://thread.gmane.org/gmane.comp.freedesktop.dbus/15499...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580444/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580505"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 11:31 UTC (Wed)
                               by <b>jspaleta</b> (subscriber, #50639)
                              [<a href="/Articles/580505/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think the idea is that kdbus can replace Binder and binder-native semantics entirely. The idea I think is to be able to make kdbus be functionally equivalent to what Binder does. Not drop-in compatible, but functionally equivalent, using D-Bus semantics.  So eventually...if Google buys in to kdbus, they can retool their userspace to use D-Bus semantics and Binder goes away. Eventually..Android, and everyone else, can use D-Bus semantics to get the job done. <br>
<p>
Here's a good article from May 2013 to recap the dev thinking on this from the kernel-side: <a href="http://lwn.net/Articles/551969/">http://lwn.net/Articles/551969/</a><br>
<p>
Note the brief discussion about Binder's security issues. I think that's very interesting. I would think Google would want in the long term to have both ChromeOS and Android being able to use the same IPC securely. kdbus might be that long term solution for them, on some timescale. But who knows.. Google will cross that bridge or not in due time. The point I think is a transition to kdbus from binder is not out of the question for Google. Google won't have to completely changing the design of their intents system.  <br>
<p>
-jef<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580505/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580583"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 19:24 UTC (Wed)
                               by <b>mezcalero</b> (subscriber, #45103)
                              [<a href="/Articles/580583/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
kdbus cannot replace the binder kernel bits for android. The semantics are too different. Binder's name registry works entirely different. It has more a topology of direct connections rather than a true bus. It's more focussed on "pubsub" rather then multicasting the way kdbus does. <br>
<p>
Binder doesn't really queue things so much, it's synchronous by default, and its backend is dispatched by worker threads (i.e. fully unordered), while dbus is more focussed on async stuff, and gives global ordering guarantees.<br>
<p>
Maybe some lower-level work can be shared between binder and kdbus, but kdbus itself is not suitable as a backend for binder, and won't be.<br>
<p>
Lennart<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580583/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580623"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 23:04 UTC (Wed)
                               by <b>ovitters</b> (guest, #27950)
                              [<a href="/Articles/580623/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I assume you already saw it, but this blog by Greg explains it clearly: <a href="http://kroah.com/log/blog/2014/01/15/kdbus-details/">http://kroah.com/log/blog/2014/01/15/kdbus-details/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580623/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580624"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 15, 2014 23:12 UTC (Wed)
                               by <b>jspaleta</b> (subscriber, #50639)
                              [<a href="/Articles/580624/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
no i hadn't seen that yet... I'm not able to cover the same ground in terms of resource material while I'm at the pole. So thanks for that. It clears up the evolving thinking nicely.<br>
<p>
-jef<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580624/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580670"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Waiting for Da BUS at South Pole</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 10:18 UTC (Thu)
                               by <b>sdalley</b> (subscriber, #18550)
                              [<a href="/Articles/580670/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
So, you're at the south pole? Awesome...<br>
<p>
Any nice pix you'd fancy sharing? What do they do for internet service down there?<br>
<p>
Just curious.<br>
<p>
Wishing you a pleasant summer holiday.<br>
<p>
Simon<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580670/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580674"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Waiting for Da BUS at South Pole</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 10:48 UTC (Thu)
                               by <b>jspaleta</b> (subscriber, #50639)
                              [<a href="/Articles/580674/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Internet is entirely polar orbitting sats. There is effectively about a half days coverage in chunks that range from 1 hour blocks to about 4 hour blocks. Though the bandwidth varies depend on the particular sat, though none of it is good enough band to enjoy watching embedded vids or animated gifs.  Most enriched websites...like facebook or even gmail's default interface..are too heavy to load fully. Forget about doing anything like a google hangout.  LWN being particular devoid of the web equivalent of JJ Abrams cinematic lens flare, is one of the things I can get to reliably and I am grateful for it.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580674/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580756"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Waiting for Da BUS at South Pole</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 15:37 UTC (Thu)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/580756/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  LWN [...] is one of the things I can get to reliably and I am grateful for it.</font><br>
<p>
Ha ha, that explains why you are here so much but what excuse do the rest of us have 8-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580756/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor580430"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 14, 2014 20:04 UTC (Tue)
                               by <b>jonabbey</b> (guest, #2736)
                              [<a href="/Articles/580430/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>The video is up now:</p>

<p><a href="http://mirror.linux.org.au/pub/linux.conf.au/2014/Friday/104-D-Bus_in_the_kernel_-_Lennart_Poettering.mp4">http://mirror.linux.org.au/pub/linux.conf.au/2014/Friday/104-D-Bus_in_the_kernel_-_Lennart_Poettering.mp4</a></p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/580430/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor580678"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 11:20 UTC (Thu)
                               by <b>lainfinity</b> (guest, #94972)
                              [<a href="/Articles/580678/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The fundamental question of kdbus is how to convert monolithic linux kernel to a microkernel architecture.<br>
<p>
Linux is Linux because of its monolithic architecture, even though less secure Linux microkernel is no longer Linux may be it will eventually be transformed to Lennarix.<br>
<p>
Android vs GNU/Linux even though both is based on Linux kernel, there is a big difference in terms of stability. I prefer a less secure and stable monolithic than more secure microkernel.<br>
<p>
History always repeats (Monolithic vs Microkernel).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580678/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580687"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 12:47 UTC (Thu)
                               by <b>alexl</b> (subscriber, #19068)
                              [<a href="/Articles/580687/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
kdbus is fundamentally a userspace&lt;-&gt;userspace IPC mechanism, similar (on a very very high level) to unix domain sockets or shared memory. It is not a kernel&lt;-&gt;kernel ipc mechanism, and thus it is completely irrelevant to whether linux is a microkernel or not.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580687/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor580709"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The unveiling of kdbus</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 16, 2014 14:41 UTC (Thu)
                               by <b>lainfinity</b> (guest, #94972)
                              [<a href="/Articles/580709/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The kdbus is very similar in architecture to Android Binder except for more bandwidth, complexity and ram based.The model of Binder was created for a microkernel-like device.<br>
<p>
<a href="http://kroah.com/log/blog/2014/01/15/kdbus-details/">http://kroah.com/log/blog/2014/01/15/kdbus-details/</a><br>
<p>
Eventually because of the compexity and functional capabilities of the IPC like kdbus Linux will tend to behave more like a  microkernel in the long run.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/580709/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2014, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
