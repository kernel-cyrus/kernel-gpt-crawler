        <!DOCTYPE html>
        <html lang="en">
        <head><title>Merging the kvm tool [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/456132/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/455634/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/456132/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Merging the kvm tool</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ready to give LWN a try?</b>
<p>
With a subscription to LWN, you can stay current with what is happening in the Linux and free-software community and take advantage of subscriber-only site features.  We are pleased to offer you <b><a href="https://lwn.net/Promo/nst-trial/claim">a free trial subscription</a></b>, no credit card required, so that you can see for yourself.  Please, join us!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>August 23, 2011</br>
           </div>
The "native Linux KVM tool" (which we'll call "NLKT") is a hardware
emulation system designed to support virtualized guests running under the
KVM hypervisor.  It offers a number of nice features, but an attempt to get
this code merged into the 3.1 kernel was deferred by Linus, who did not
want to deal with another controversial development at that time.  This
tool's developers have let it be known that it will be back for the 3.2
merge window; controversy is sure to follow.  The core question raised by
this project is: what code is appropriate for the kernel tree, and which
projects should live in their own repositories elsewhere?
<p>
NLKT was started in response to <a href="/Articles/379869/">unhappiness
about QEMU</a>, the state of its code, and the pace of its development.  It
was designed with simplicity in mind; NLKT is meant to be able to boot a
basic Linux kernel without the need for a BIOS image or much in the way of
legacy hardware emulation.  Despite its simplicity, NLKT offers "just
works" networking, SMP support, basic graphics support, copy-on-write block
device access, host filesystem access with 9P or overlayfs, and more.  It
has developed quickly and is, arguably, the easiest way to get a Linux
kernel running on a virtualized system.
<p>
Everybody seems to think that NLKT is a useful tool; nobody objects to its
existence.  The controversy comes for other reasons, one of which is the
name: the tool simply calls itself "kvm."  The potential for confusion with
the kernel's KVM subsystem is clear - that is why this article made up a
different acronym to refer to the tool.  "KVM" is already seen as an
unfortunate name - searches for the term bring in a lot of information
about keyboard-video-mouse switches - so adding more ambiguity seems like a
bad move.  It is also seemingly viewed by some as a move to be the
"official" hardware emulator for KVM.  The NLKT developers have, thus far,
resisted a name change, though.
<p>
The bigger fight is over whether NLKT belongs in the kernel at all.  It is
not kernel code; it is a program that runs in user space.  The
question of whether such code should be in the kernel's repository is
certainly the one that will decide whether it is merged for 3.2 or not.
<p>
NLKT would not be the first user-space tool to go into the mainline kernel;
several others can be found in the <tt>tools/</tt> directory.  Many of
them are testing tools used by kernel developers, but not all.  The
"cpupower" tool was merged for 3.1; it allows an administrator to tweak
various CPU power management features.  The most actively developed tool in
that directory, though, is perf, which has grown by leaps and bounds since
being merged into the mainline.  The developers working on perf have been
very outspoken in their belief that putting the tool into the mainline
kernel repository has helped it to advance quickly.

<p>
Proponents say that, like perf, NLKT is closely tied to the kernel and
heavily used by kernel developers; like perf, it would benefit from being
put into the same code repository.  KVM, they say, is also under heavy
development; having NLKT and KVM in the same tree would help both to
improve more quickly.  It would bring more review of any future KVM
ABI changes, since a user of that ABI would be merged into the kernel as
well.  Keeping the hardware emulation code near the drivers that code has
to work with is said to be beneficial to both sides.  All told, they say,
perf would not have been nearly as successful outside of the mainline tree
as it has been internally; merging NLKT can be expected to encourage the
same sort of success.
<p>
That success seems to be one of the things that opponents are worried
about; some have <a href="/Articles/456135/">worried</a> that the main
purpose is to increase the project's visibility so that it succeeds at the
expense of competing projects.  The ABI development benefits are
challenged; any changes would clearly still have to work with tools like
QEMU regardless of whether NLKT is in the kernel, so QEMU developers would
have to remain in the loop.  It is even better, some
say, to separate the implementation of an ABI from its users; that forces
the implementers to put more effort into documenting how the ABI should be
used. 
<p>
There is also concern that, once we start seeing more user-space tools
going into the kernel tree, there will be an unstoppable flood of them.
Where does it stop, they ask - should we pull in the C library, the GNU
tools, or, maybe, LibreOffice?  Linux is not BSD, they say; trying to put
everything into a single repository is not the right direction to take.
The answer to that complaint is that there is no interest in merging
arbitrary tools; only those that are truly tied to the kernel would
qualify.  By this reasoning, NLKT is an easy decision.  A C library is
something that could be considered; perhaps even graphics if the relevant
developers wanted to do that.  But office suites are not really
eligible; there are limits to what should go into the mainline.
<p>
That was where the discussion stood at the beginning of the 3.1 merge
window; Linus <a href="/Articles/453957/">decided</a> not to pull NLKT at
that time.  Instead, he clearly wanted the discussion to continue; he told
the NLKT developers that they would have to convince him in the 3.2 merge
window instead.  It looks like that process is about to begin; the NLKT
repository is about to be added to linux-next in anticipation of a pull
request once the merge window opens.  This time, with luck, we'll have a
resolution of the issue that gives some guidance for those who would merge
other user-space tools in the future.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#KVM">KVM</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Virtualization-KVM">Virtualization/KVM</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/456132/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor456308"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2011 2:27 UTC (Thu)
                               by <b>dberkholz</b> (guest, #23346)
                              [<a href="/Articles/456308/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Has anyone considered using the kernel tree like an incubator? Let things live there while the API is "growing up" and then move them out into independent repos once they've matured.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456308/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor456349"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2011 11:09 UTC (Thu)
                               by <b>mingo</b> (guest, #31122)
                              [<a href="/Articles/456349/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      That's exactly what we've done with tools/perf/ and it has worked very well for us.
<p>
Except for the detail that we've indefinitely postponed the 'moving out into a separate project' step:
<p>
<li>
<b>Dependable release schedule</b>: the kernel gives us and our users a perfectly timed, externally enforced stable release heartbeat every 3 months.
</li>
<li>
<b>No monopoly on maintenance</b>: we cannot abandon the repository and kill/sabotage development that way. If we make a mess of tools/perf/ within the kernel repo others will pick it up and Linus will start merging them.
</li>
<li>
<b>Dependable development model</b>: well-understood and constantly evolving coding style and review/discussion methodology
</li>
<li>
<b>Easy access to early adopters</b>: Kernel testers and kernel developers are pretty curious by nature and doing 'cd tools/perf; make -j;' is not something they are scared of trying or lazy to perform, in the kernel repository they already have anyway.
</li>
<li>
<b>Widespread distribution</b>: the Linux kernel is widely distributed and packaged, so it's easy for anyone to get started hacking on tools/perf/.
</li>
<p>
These are IMO some of the most important attributes of a good user-space project and by living in the kernel repository we get these benefits without having to fight much to enforce them. (Where the 'fight' would often be against ourselves.)
<p>
So I am not surprised at all that the tools/kvm/ developers (disclaimer, I write the occasional patch for tools/kvm/ myself and review their patches) are feeling about it in a similar way.

      
          <div class="CommentReplyButton">
            <form action="/Articles/456349/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor456358"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2011 13:10 UTC (Thu)
                               by <b>dberkholz</b> (guest, #23346)
                              [<a href="/Articles/456358/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I agree, tools where devs are the primary/only audience might be more fitting for bundling with the kernel for longer periods of time. I don't really see KVM that way, though.<br>
<p>
The problem with not leaving is obvious; there's a never-ending growth of semi-random packages distributed with the kernel, and pretty soon they'll call it LinuxBSD because it includes the whole OS.<br>
<p>
Making it explicit that the kernel tree is an incubator rather than a permanent home means that it's not unbounded growth but instead more of an adolescence for new userspace code, which will eventually move out and go to college instead of sucking your resources forever.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456358/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor456367"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2011 14:37 UTC (Thu)
                               by <b>deater</b> (subscriber, #11746)
                              [<a href="/Articles/456367/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One thing not addressed is the stable-ABI issue.<br>
<p>
External tools trying to use the perf_event ABI tend to struggle, as the perf_event developers are primarily interested in perf working.  Breaks in the ABI (and there have been many, though most are minor) are not deemed important if you don't catch them fast enough.  And since the perf_event developers never feel the need to use the ABI from outside the kernel tree, it ends up meaning that userspace developers need to be running bleeding-edge kernels at all times or risk their tools being broken.<br>
<p>
Kernel and userspace development are very different processes, and if your code isn't in the kernel tree you face an extreme disadvantage.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456367/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor456368"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2011 14:45 UTC (Thu)
                               by <b>deater</b> (subscriber, #11746)
                              [<a href="/Articles/456368/">Link</a>] 
      </p>
      
      </div>
      </summary>
      To add an example: the whole <a href="http://lwn.net/Articles/441209/">OFFCORE_EVENTS issue on Nehalem processors</a> with perf.
<br><br>
Currently it is impossible for external tools to detect if this feature is enabled or not.  If you try to use it, sometimes it will return 0, sometimes not (depending which generalized event you've used due to a buggy leak of MSR state).  This bug has been there since 2.6.39.  What should happen is an error code returned.
<br><br>
If RAW OFFCORE_EVENT support is ever added, then there is no possible way for an external tool to detect this properly, as correct behavior is indistinguishable from the current buggy disabling.
<br><br>
Does the perf tool care?  No.  Why?  Because when it gets support it will happen at the same time that the kernel is updated, so as long as kernel/perf are updated at the same time you'll never notice.  perf never has to worry about backward compatability, which is a bit of an unfair advantage.

      
          <div class="CommentReplyButton">
            <form action="/Articles/456368/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor456309"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Zawinski's Law</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2011 2:31 UTC (Thu)
                               by <b>cesarb</b> (subscriber, #6266)
                              [<a href="/Articles/456309/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Where does it stop, they ask - should we pull in the C library, the GNU tools, or, maybe, LibreOffice?</font><br>
<p>
"Every program attempts to expand until it can read mail. Those programs which cannot so expand are replaced by ones which can."<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456309/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor456320"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Zawinski's Law</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2011 4:00 UTC (Thu)
                               by <b>jzbiciak</b> (guest, #5246)
                              [<a href="/Articles/456320/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I suspect if this law were stated anew today, you would have "browse the web" in place of "read mail."<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456320/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor456355"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Zawinski's Law</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2011 11:41 UTC (Thu)
                               by <b>cesarb</b> (subscriber, #6266)
                              [<a href="/Articles/456355/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I suspect if this law were stated anew today, you would have "browse the web" in place of "read mail."</font><br>
<p>
That is only because now we have webmail.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456355/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor456386"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Zawinski's Law</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2011 16:25 UTC (Thu)
                               by <b>jzbiciak</b> (guest, #5246)
                              [<a href="/Articles/456386/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And LWN.  ;-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456386/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor456526"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Zawinski's Law</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2011 17:17 UTC (Fri)
                               by <b>sorpigal</b> (guest, #36106)
                              [<a href="/Articles/456526/">Link</a>] 
      </p>
      
      </div>
      </summary>
      In that case, since I don't want Linux to be relaced any time soon, I hereby request that Firefox be moved into the kernel git repo.
      
          <div class="CommentReplyButton">
            <form action="/Articles/456526/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor456338"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2011 9:29 UTC (Thu)
                               by <b>Lennie</b> (subscriber, #49641)
                              [<a href="/Articles/456338/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"..the easiest way to get a Linux kernel running on a virtualized system."<br>
<p>
Yes, a kernel maybe. But if you don't need a kernel. Which most people don't, A container solution (LXC, Jails, OpenVZ/Linux-VServer, Zones) is much better.<br>
<p>
I'm glad Linus thinks the same thing, atleast then there is the will by Linus to accept great checkpoint/restart and live-migration ?:<br>
<p>
<a href="http://www.networkworld.com/community/node/77850">http://www.networkworld.com/community/node/77850</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456338/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor456361"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2011 13:29 UTC (Thu)
                               by <b>Klavs</b> (guest, #10563)
                              [<a href="/Articles/456361/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Agreed - LXC is def. a good fit for tools/lxc - if tools/kvm is suppose to be there.<br>
<p>
I def. depend on LXC - as I have vserver in the past.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456361/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor456686"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2011 13:28 UTC (Mon)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/456686/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
LXC is the "Linux" container technology.  It's very tied to the Linux kernel that hosts the containers.  Instead, the KVM userspace part actually uses KVM just as an accelerator: it has been ported to Solaris with very little changes to QEMU, and reuses almost all of the device models that QEMU uses in it dynamic-recompilation mode.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456686/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor456388"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 25, 2011 16:40 UTC (Thu)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/456388/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't think an actual full C library would make sense to have in the kernel source; there's a ton of stuff that the C library provides that's only tangentially related to the host kernel. On the other hand, shipping the syscall stubs and such would probably save a whole lot of hassle.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456388/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor456473"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2011 7:29 UTC (Fri)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/456473/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; There is also concern that, once we start seeing more user-space tools going into the kernel tree, there will be an unstoppable flood of them. Where does it stop, they ask.</font><br>
<p>
Where to draw this line is indeed a difficult question. Re-using the existing line between kernel and user-space is a lazy answer.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456473/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor456545"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 26, 2011 20:10 UTC (Fri)
                               by <b>meyert</b> (subscriber, #32097)
                              [<a href="/Articles/456545/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
so what is the advantage of this tool compared to user mode linux (UML)?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456545/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor456645"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2011 20:10 UTC (Sun)
                               by <b>robbe</b> (guest, #16131)
                              [<a href="/Articles/456645/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
kvm (native or otherwise) runs a plain, vanilla Linux as its guest OS. UML on the other hand is quite heavily modified. It may also lag the current kernel.<br>
<p>
For testing your kernel-patch-du-jour, kvm is most certainly the better choice.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/456645/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor457062"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 31, 2011 15:16 UTC (Wed)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/457062/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What? UML is just another architecture, that is all. It's upstream: it is not meaningful to say that it is 'heavily modified' or that it 'may lag', any more than any other userspace program 'may lag'. If you want a matching version, compile with ARCH=um and you have it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/457062/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor456618"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2011 3:20 UTC (Sun)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/456618/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
A C library is something that could be considered; perhaps even graphics if the relevant developers wanted to do that. But office suites are not really eligible; there are limits to what should go into the mainline.
</blockquote>
<p>
Another important category is programs whose function is to control or analzye a Linux kernel.  E.g. procps, schedutils, mount.

      
          <div class="CommentReplyButton">
            <form action="/Articles/456618/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor456633"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2011 15:42 UTC (Sun)
                               by <b>Julie</b> (guest, #66693)
                              [<a href="/Articles/456633/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <p><i>procps, schedutils, mount</i></p>
Wouldn't the use of these imply that they count as being 'tied to the kernel' as suggested earlier on in the paragraph?
      
          <div class="CommentReplyButton">
            <form action="/Articles/456633/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor456639"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 28, 2011 19:12 UTC (Sun)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/456639/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>
<blockquote>
procps, schedutils, mount
</blockquote>
Wouldn't the use of these imply that they count as being 'tied to the kernel' as suggested earlier on in the paragraph?
</blockquote>
<p>
Right, that was my point.  The article suggests things tied to the kernel could be distributed with it and gives examples of things that may or may not be tied enough to the kernel to warrant inclusion.  But it omitted one important category of things tied to the kernel.

      
          <div class="CommentReplyButton">
            <form action="/Articles/456639/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor456679"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 29, 2011 13:23 UTC (Mon)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/456679/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      I must say I have never read a worse article on LWN.  Take it as a compliment, as I have learnt so much from LWN that I just cannot enumerate everything.  Also, Jon is in all likelihood not the only one that has misunderstood the matter, so it probably helps other people if some of the problematic points in the article are corrected.<p>

Here is a short list of observations:

<ul><li><p><b>NLKT was started in response to unhappiness about QEMU, the state of its code, and the pace of its development</b>: NLKT was started in response to Ingo complaining about QEMU and because it's undoubtedly fun to hack on, but <i>no one</i> ever constructed any proof of the problems with QEMU. The command-line problem is obviously solvable with a <a href="http://lists.gnu.org/archive/html/qemu-devel/2011-08/msg02728.html">simple wrapper script</a>.</li>

<li><p><b>NLKT is meant to be able to boot a basic Linux kernel without the need for a BIOS image or much in the way of legacy hardware emulation</b>: It's worse than that. NLKT doesn't emulate anything close to a modern PC.  For example, it does not support ACPI.  This means that even if it is mostly touted as a developer tool, developers of some subsystems would still not be able to use it (unlike QEMU).  NLKT is also developing hardware models against Linux kernel source code rather than against the spec; this is very wrong because it is vulnerable to improvements to the drivers.  In fact, when QEMU did it this way, newer versions of Linux and/or Windows revenged later (one example is in the ATAPI implementation).

<li><p><b>Everybody seems to think that NLKT is a useful tool; nobody objects to its existence</b>.  As you correctly point out later in the article, for KVM developers the NLKT is useful because it's an independent user of the same ABI.  But for the general public (developers and users) it's about as useful as lguest; it would be useful as a proof of concept tool, but the NLKT developers are expanding it way beyond that.  At the same time, they are leaving out features that would obviously be very useful for Linux kernel developers.  For example, NLKT does not support a gdbstub for totally transparent debugging of guest kernels.

<li><p><b>It is also seemingly viewed by some as a move to be the "official" hardware emulator for KVM</b>: it's open source and we all know that there is nothing "official" but what people use.  NLKT so far has 10% of the features that are needed to test real-world guests (all of them, not just Linux), which in turn is what is needed to test KVM kernel changes.

<li><p><b>like perf, NLKT is closely tied to the kernel and heavily used by kernel developers"</b>.  But perf is used a lot by non-kernel developers as a profiling tool.  NLKT simply won't work for most Linux enthusiasts who want to check out FreeBSD every once in a while, or have some hardware with Windows-only drivers.<p>

Another problem is that while NLKT is indeed getting some things right, it is doing too many mistakes that QEMU already did, and its roadmap includes too many features that contradict its original goal.  From the recent talk at KVM forum, Grub support stands out: a boot loader is all about legacy device support.</li>

<li><p><b>there is no proof that perf would not have been nearly as successful outside of the mainline tree as it has been internally</b>: There is actually no proof for this.  Unlike oprofile, perf was developed by several core kernel maintainers.  It seems to me like a much stronger factor impacting the success of perf vs. oprofile.<p>

You even say <b>That success seems to be one of the things that opponents are worried about</b>, but that's absolutely not a factor.  Everybody is amazed at the lengths at which NLKT has come, but still NLKT is a solution in search of a problem (except if your problem is to find something fun to hack on, of course! :).  The kernel component of KVM is very mature, and so is the ABI.  Unlike perf, KVM would not have benefits from forcing lockstep upgrades of the kernel and userspace components.  The part of KVM that is more in flux is the host-guest ABI, which you must preserve anyway since you cannot break compatibility with existing guests.<p>

NLKT is also repeating the same mistakes as early QEMU, and a few others: for example, unlike KVM itself, NLKT is strictly limited to x86.  While undoubtedly a burden for QEMU developers, non-x86 support helps keeping you honest about the specs you are trying to implement, and it can also be extremely helpful for kernel developers.  (A few years ago Ingo was suggesting that Linux be compiled with its own compiler, but now he objects to QEMU because it includes a just-in-time compiler ;)). See also the point above about developing hardware models against Linux kernel source code.</ul>

I hope this long comment helps understanding the situation better. I look forward to the replies!
      
          <div class="CommentReplyButton">
            <form action="/Articles/456679/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor456989"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Merging the kvm tool</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 31, 2011 1:35 UTC (Wed)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/456989/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <i>there is no proof that perf would not have been nearly as successful outside of the mainline tree as it has been internally: There is actually no proof for this. Unlike oprofile, perf was developed by several core kernel maintainers. It seems to me like a much stronger factor impacting the success of perf vs. oprofile.</i>
<p>
I actually believe there's proof that perf would have done just as good if not better outside the tools directory. Sure, it has lots of developers, but most of them are kernel developers and very few userspace developers. The proof that perf would have done well outside of the kernel is based on the fact that the tool that influenced perf's development model was done outside the kernel. That tool is called <b>git</b>.
<p>
git did not need to be in the tools directory to become popular. I'm sure perf would have followed git's success if it was also outside the kernel tree. In fact, I believe it would attract more userspace developers, and it would have probably grown a graphical user interface as well if it was outside the kernel.
<p>
If perf and NLKT wants to be mostly developed by kernel developers, than perhaps it should stay in the kernel. I wounder how many more user space developers perf would have if it was outside the kernel tree.
      
          <div class="CommentReplyButton">
            <form action="/Articles/456989/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor457869"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Building the kernel bundled user-space en-masse</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 7, 2011 6:56 UTC (Wed)
                               by <b>alex</b> (subscriber, #1355)
                              [<a href="/Articles/457869/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
With this growth in userspace code in the kernel git tree is there an easy way to build them all. Given that they are potentially linked to the kernel ABI should I be thinking of installing them in /lib/modules/`uname -r`/bin?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/457869/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2011, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
