        <!DOCTYPE html>
        <html lang="en">
        <head><title>A 2023 DAMON update [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/931769/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/931576/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/931769/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>A 2023 DAMON update</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>This article brought to you by LWN subscribers</b>
<p>
Subscribers to LWN.net made this article &mdash; and everything that
       surrounds it &mdash; possible.  If you appreciate our content, please
       <a href="/Promo/nst-nag3/subscribe">buy a subscription</a> and make the next
       set of articles possible.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>May 16, 2023</br>
           <hr>
<a href="/Articles/lsfmmbpf2023">LSFMM+BPF</a>
</div>
<a href="/Articles/812707/">DAMON</a> is a framework that allows user space
to influence and control the kernel's memory-management operations.  It
first entered the kernel with the 5.15 release, and has been gaining
capabilities ever since.  At the <a
href="/Articles/lsfmmbpf2023">2023 Linux Storage, Filesystem,
Memory-Management and BPF Summit</a>, DAMON author Seongjae Park provided
an overview of the current status of DAMON development and where it can be
expected to go in the near future.
<p>
At its core, Park began, DAMON provides access-frequency monitoring of
memory in both the physical and virtual address spaces.  It includes a
number of methods to reduce the overhead of that monitoring.  <a
href="/Articles/863753/">DAMOS</a> is an add-on that allows this access
information to be turned into memory-management decisions.  It works by
identifying regions of memory that match a specified access pattern, then
applying policies to that region.  DAMOS includes a quota mechanism that
limits its own CPU overhead and can prioritize certain types of regions.
Park has added various APIs over time, enhancing the user-space API and
adding actions for control of memory-reclaim operations.
<p>

<a href="/Articles/931771/"><img
src="https://static.lwn.net/images/conf/2023/lsfmm/SeongJaePark-sm.png" alt="[SeongJae Park]"
title="SeongJae Park" class="rthumb"></a>

A number of features have been added in the last year.  DAMON gained online
tuning in 5.19, making it easier to tweak its operating parameters in a
running system.  <a href="/Articles/905370/">LRU-list manipulation</a>
arrived in 5.20; it works by detecting hot regions of memory and marking
the pages found therein as active.  This mechanism, Park said, can reduce
memory-pressure stalls by 20% when properly fine-tuned.  "DAMOS tried
regions" showed up in 6.2; it allows for inspection of memory regions in
detail and supersedes an older API based on tracepoints.  Tried regions are
mostly useful for debugging DAMOS policies, he said.  DAMOS filters, merged
for 6.3, allow policies to limit actions to given types of pages — only
anonymous pages, for example, or those belonging to a specific control
group.
<p>
Looking forward, Park is planning to add a feature for the monitoring of
read-only and write-only access patterns.  This could be used, for example,
to identify processes that should be migrated to different types of backing
store or those that would benefit from <a
href="https://www.kernel.org/doc/html/latest/admin-guide/mm/ksm.html">kernel
samepage merging</a>.  He has posted a patch set implementing this
feature in the past, but it was blocked due to unrelated memory-management
problems; perhaps that situation has been resolved by now, he said.  David
Hildenbrand pointed out that write-only tracking would not be possible with
pages that are pinned in memory, so that data could be incomplete; Park
answered that, since DAMON uses sampling to limit overhead, it can't track
every single page in any case and pinning doesn't make things any worse.
<p>
Park's top priority, he said, might be "feedback-based quota auto tuning".
Getting the most out of DAMON requires fine-tuning it to just the right
level of aggressiveness; that can be tricky, and the optimal tuning may
change over time.  A poorly tuned implementation may impose too much
overhead on the system, or it may not produce the desired results.  To make
life easier for administrators, Park intends to add a feedback mechanism
telling DAMON about how effective it is being and adjusting parameters
automatically.  Someday, hopefully, it can be entirely self-tuning.
<p>
There are a number of other features in the works as well.  A mechanism to
control reclaim via the virtio-balloon driver is planned, for example; that
could provide better memory allocation on overcommitted hosts.
<p>
Park would like to add an in-tree user-space tool for control of the
system; this tool currently lived out-of-tree in a GitHub repository.
Moving it in-tree would help users to understand how to manage the DAMON
ABI, he said, and might also help developers avoid breaking that ABI.  Dan
Williams answered that moving a tool in-tree doesn't increase the
flexibility of the ABI, and might well create more problems than it solves.
It is easier to tie tooling to specific kernel versions when that tooling
lives in the kernel tree — breaking out-of-tree users in the process, but
that is exactly the kind of ABI break that must be avoided.
Andrew Morton said that he would need to see a strong argument before he
would accept an in-tree tool like that.
<p>
Michal Hocko commented that he finds DAMON hard to understand; it is a
complex memory-management system that lives outside of the kernel's
memory-management subsystem.  It would appreciate some good documentation
that pulls it all together and shows how a use case might work.  An article
on "a certain Internet site" might also be beneficial, he said.
<p>
Park had more future plans to discuss, but ran out of time in which to
cover them.  He has <a
href="https://drive.google.com/file/d/10nsd4fq01On9p-oTmCS5KSW6qESmB6ER/view">posted
his slides</a> for those who are interested in looking further.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Memory_management-DAMON">Memory management/DAMON</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Storage_Filesystem_Memory-Management_and_BPF_Summit-2023">Storage, Filesystem, Memory-Management and BPF Summit/2023</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/931769/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor932065"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A 2023 DAMON update</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 16, 2023 16:17 UTC (Tue)
                               by <b>sjpark</b> (subscriber, #87716)
                              [<a href="/Articles/932065/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Great summary, thank you!  Please note that the slides have also uploaded to a github repo[1].  The Google Drive link to the slides, which used on this article, might be expired later[2].<br>
<p>
[1] <a href="https://github.com/damonitor/talks/blob/master/2023/lsfmmbpf/damon_lsfmmbpf_2023.pdf">https://github.com/damonitor/talks/blob/master/2023/lsfmm...</a><br>
[2] <a href="https://lore.kernel.org/damon/20230513145314.84505-1-sj@kernel.org/">https://lore.kernel.org/damon/20230513145314.84505-1-sj@k...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/932065/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor932071"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">A 2023 DAMON update</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted May 16, 2023 20:45 UTC (Tue)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/932071/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Michal Hocko commented that he finds DAMON hard to understand; it is a complex memory-management system that lives outside of the kernel's memory-management subsystem. It would appreciate some good documentation that pulls it all together and shows how a use case might work.</span><br>
<p>
I get the same impression, every time I read about this I'm not clear what it can be used for. But that isn't a complaint, having more system introspection tools is never a bad thing.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/932071/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2023, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
