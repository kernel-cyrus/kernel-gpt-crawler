        <!DOCTYPE html>
        <html lang="en">
        <head><title>Timer slack for slacker developers [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/463357/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/463153/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/463357/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Timer slack for slacker developers</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>October 17, 2011</br>
           </div>
The "timer slack controller" is a proposed mechanism that would allow a
session management program to adjust the timer tolerances of a group of
processes with a single knob.  It seems like a relatively obscure and
harmless feature, but it has been the focus of an intense debate on the
kernel mailing lists.  The core question has been seen before: what
measures should the kernel take, if any, to keep poorly-written
applications from hurting performance?

<p>

Timers allow a process to request a wakeup at some future time; timer slack
gives the kernel some leeway in its implementation of those timers.  If the
kernel can delay specific timers by a bounded amount, it can often expire
multiple timers at once, minimizing the number of wakeups and, thus,
reducing the system's power consumption.  Some processes need more
precise timing than others; for this reason, the kernel allows a process to
specify its maximum timer slack with the <tt>prctl()</tt> system call.
There is, currently, no mechanism to allow one process to adjust another
process's timer slack value; it is generally assumed that any given
process knows best when it comes to its own timing requirements.
<p>
The <a href="/Articles/462566/">timer slack controller</a> allows a
suitably privileged process to set the timer slack value for every process
contained within a control group.  The patch has been circulating for some
time without generating a great deal of interest; it recently resurfaced in
response to the "<a href="/Articles/462076/">plumber's wish list for
Linux</a>" which requested such a feature.  The reasoning behind the
request was <a href="/Articles/463367/">explained</a> by Lennart
Poettering:
<p>
<div class="BigQuote">
	Consider you have one or more desktop user sessions logged in, each
	one in a timer slack cgroup. Now, userspace already tracks when
	sessions become idle (i.e. currently desktop userspace then starts
	a screensaver, or turns off the screen, or similar), and we'd like
	to increase the timer slack for the session cgroups individually as
	the individual session becomes idle, and decrease it again if the
	session stops being idle.
</div>
<p>
It is, in other words, a power-saving mechanism.  When the session manager
determines that nothing special is going on, it can massively increase the
slack on any timers operated by desktop applications, effectively
decreasing the number of wakeups.  Applications need not be aware of
whether the user is currently at the keyboard or not; they will simply slow
down during the boring times.
<p>
There is some stiff opposition to merging this controller.
Naturally, the fact that the timer slack controller uses control groups is
part of the problem; some kernel developers have still not made their
peace with control groups.  Until that situation resolves itself - if it
ever does - features based on control groups are going to have a bumpy ride
on their way into the mainline.

<p>
Beyond the general control group issue, though, two complaints have been
heard about this approach to power management. 
One is that applications running on the desktop may have timing
requirements that are not dependent on whether the user is actually there
or not.  One could imagine a data acquisition application that does not
have stringent response requirements, but which will still lose data if its
timers suddenly gain multiple seconds of slack.  Lennart's <a
href="/Articles/463374/">response</a> is that such applications should be
using the realtime scheduler classes, but that answer is unlikely to please
anybody.  There is likely to be no shortage of applications that have never
needed to bother with realtime scheduling but which still will not work
well with arbitrary delays.  Imposing such delays could lead to any number
of strange bugs.
<p>
The big complaint, though, as <a href="/Articles/463376/">expressed</a> by
Peter Zijlstra and others, is that this feature makes it easier for
developers to get away
with writing low-quality applications.  If the pressure to remove
badly-written code is removed, it is said, that code will never get fixed.
Peter suggests that, rather than papering over poor behavior in the kernel,
it would be better to simply kill applications that waste power.  He was
especially strident about applications that continue to draw when their
windows are not visible; such problems should be fixed, he said, before
adding workarounds to the kernel.
<p>
The massive improvements in power behavior that resulted from the release
and use of PowerTop is often pointed to as an example of how things should
be done.  This situation is a little different, though.  The wakeup
reductions inspired by PowerTop were low-hanging fruit - processes waking
up multiple times per second for no useful purpose.  The timer slack
controller is aimed at a different problem: wakeups which <i>are</i> useful
when somebody is paying attention, but which are not useful otherwise.
That is a trickier problem.
<p>

Determining when the user is paying attention is not always
straightforward, though there some obvious signs.  If the screen has been
turned off because the input devices are idle, the user probably does not
care.  Other cases - non-visible tabs in web browsers, for example - have
been cited as well, but the situation is not so obvious there.  As Matthew
Garrett <a href="/Articles/463390/">put it</a>: buried tabs still need
timer events "<q>because people expect gmail to provide them with status
updates even if it's not the foreground tab.</q>"  Fixing the problem in
applications would require figuring out when nothing is going on, finding a
way to communicate it to applications, then fixing large numbers of them
(some of which are proprietary) to respond to those events.
<p>
It is not surprising that developers facing that kind of challenge might
choose to improve the situation with a simple kernel patch instead.  It is,
certainly, a relatively easy path toward better battery life.  But the
patch does raise a fundamental policy question that has never been answered
in any definitive way.  Does mitigating the effects of (what is seen as)
application developer sloppiness encourage the distribution of low-quality
code and worsen the system in the long run?  Or, instead, does the "tough
love" approach deter developers and impoverish our application environment
without actually fixing the underlying problems?
<p>
An answer to that question is unlikely to come in the near future.  What
that probably means is that the current fuss will be enough to keep the
timer slack controller from getting in through the 3.2 merge window.  It
also seems unlikely to go away, though; we are likely to see this topic
return to the mailing lists in the future.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Control_groups">Control groups</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Timers">Timers</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/463357/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor463409"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2011 22:20 UTC (Mon)
                               by <b>josh</b> (subscriber, #17465)
                              [<a href="/Articles/463409/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I agree entirely with the point of view that this supports applications which abuse timers to poll for events rather than blocking until those events occur.  We should fix those applications.<br>
<p>
Why should the gmail client-side code require a timer event?  It should simply receive notifications from the gmail server when mail arrives, via one of the many mechanisms browsers now offer for server push.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463409/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463413"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2011 22:38 UTC (Mon)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/463413/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
gmail doesn't - what I was replying to there was a query about why javascript is run at all in background tabs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463413/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463415"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2011 22:54 UTC (Mon)
                               by <b>brother_rat</b> (subscriber, #1895)
                              [<a href="/Articles/463415/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The N900 browser suspends Javascript if you switch away from the browser view (there's an option for how quickly to do it I think). It does seem to break a not insignificant number of websites, such as 'live updating' news/sport stories on the BBC. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463415/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463478"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 9:38 UTC (Tue)
                               by <b>ab</b> (subscriber, #788)
                              [<a href="/Articles/463478/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
N900 (and N9, N950 as well) do have a user-space framework to coordinate wakeups from applications themselves. This is used by almost all networking applications to coordinate their wakeups. <a href="https://meego.gitorious.org/meego-middleware/libiphb/blobs/master/iphbd/libiphb.h">https://meego.gitorious.org/meego-middleware/libiphb/blob...</a> is client side API, while <a href="https://meego.gitorious.org/meego-middleware/dsme/trees/master">https://meego.gitorious.org/meego-middleware/dsme/trees/m...</a> is server-side part of overall device state management.<br>
<p>
Of course, it requires changes from the application side and also a common coordination mechanism. Adding such changes to applications isn't that hard, the API is rather simple. What is more important is that apps will anyway need changes to determine their own periods of inactivity.<br>
<p>
Perhaps it will be helpful to have a kernel-side mechanism to get overall configuration easier but the situation as described in the article wakes memories of Android kernel vs upstream kernel debates for the similar use on the kernel side.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463478/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor463418"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2011 23:14 UTC (Mon)
                               by <b>idupree</b> (guest, #71169)
                              [<a href="/Articles/463418/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"There is likely to be no shortage of applications that have never needed to bother with realtime scheduling but which still will not work well with arbitrary delays. Imposing such delays could lead to any number of strange bugs."<br>
<p>
I can attest to something similar.  When my system pauses multiple seconds due to heavy swapping pressure, now and then something weird happens (like Amarok forgetting my metadata or crashing or something).  Though recently, my system's been pretty stable in that regard.<br>
<p>
Is there a testing tool, akin to Valgrind, that can insert random multi-second delays in applications in order to help test/debug them under such conditions?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463418/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463425"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2011 23:29 UTC (Mon)
                               by <b>yoe</b> (guest, #25743)
                              [<a href="/Articles/463425/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
trace it in a debugger, and stop/restart it at random?<br>
<p>
note that gdb is scriptable, if I'm not mistaken...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463425/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463433"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 0:21 UTC (Tue)
                               by <b>idupree</b> (guest, #71169)
                              [<a href="/Articles/463433/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
(Not that I would have much idea how to debug timing issues, possibly race conditions, in a program I've haven't already worked with the code of!  But I really should look into this for my own programs sometime... provided I can concoct some useful tests within an hour or two, which may or may not work out.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463433/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor463519"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 15:58 UTC (Tue)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/463519/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You don't need a debugger for that: just hit it with SIGSTOP and SIGCONT at random.<br>
<p>
(You'd probably need to hit whole process groups at once -- using negative PIDs -- to attempt to simulate the way the kernel fires slacked timers in groups.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463519/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor468467"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2011 19:56 UTC (Sun)
                               by <b>oak</b> (guest, #2786)
                              [<a href="/Articles/468467/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Valgrind can at least slow the apps a lot, so it can be used for flushing out &amp; detecting some timing related race conditions.  Additionally you could add some dummy higher priority program to delay tested program's wakeups.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/468467/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor468472"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Most of the time it's some races...</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2011 20:07 UTC (Sun)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/468472/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>In most cases it's better to run program in question under <a href="http://code.google.com/p/data-race-test/">TSAN</a> and fix data races found.</p>

<p>Of course if people are suing sleep(3) as sychronization primitive it'll not help, but then little can be done with such programs anyway.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/468472/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor463416"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2011 23:16 UTC (Mon)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/463416/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think that this would be a very useful thing to have available for mobile devices.<br>
<p>
there are a lot of things that you really do want to have the system do when it's otherwise asleep<br>
<p>
check for alarms<br>
<p>
check for new mail<br>
<p>
check for ...<br>
<p>
currently all of the apps that do these things schedule their own wakeup, and so if you have several apps that do these sorts of things, the system is waking up quite a few times.<br>
<p>
If it was possible to set the timer slack for a group of apps to 60 seconds, then all the apps that would wake up in that minute could be processed in one wakeup call<br>
<p>
even the things that want to happen far more frequently could probably be forced to live with a 1 second slack (one wakeup per second)<br>
<p>
<p>
<p>
yes, this can be misused, but most features can, that shouldn't eliminate the cases where it can be used properly.<br>
<p>
the counter position of "force every programmer to implement linux-specific calls to properly take advantage of possible power savings on every different type of device out there, for every user's priorities" is just not realistic.<br>
<p>
first off, different devices are going to have different sensitivies to wakeups, so what is a significant power saving on one device will have little effect other than making things less responsive on another device.<br>
<p>
Secondly, the amount of slack that is appropriate for the app will vary on the running conditions. Is the device plugged into mains power and connected to a external screen and keyboard (aka desktop replacement), or is it on battery power, and is that battery power running low so the user is willing to accept being less up-to-date in exchange for the battery lasting longer? It would be horribly inefficient for each application to be trying to run these calculations (not to mention the horrible problem of trying to define the policy for every application)<br>
<p>
this is completely ignoring the cynical statement that many of these programmers are not that good and are not going to 'fix' their applications.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463416/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463505"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 14:48 UTC (Tue)
                               by <b>mjthayer</b> (guest, #39183)
                              [<a href="/Articles/463505/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; the counter position of "force every programmer to implement linux-specific calls to properly take advantage of possible power savings on every different type of device out there, for every user's priorities" is just not realistic.</font><br>
<p>
As Lennart suggested, one could go the other way and expect applications which need realtime performance to use the (standard as far as I know) realtime APIs.  This would be the finger-pointing approach to getting people to fix their applications, but directed at those that can't take the slack rather than those that can but don't.<br>
<p>
Educating users about which applications do things right and which do not always did wonders for Apple and so far the experience has been that it can work for the Linux/FLOSS world as well.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463505/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor463427"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2011 23:40 UTC (Mon)
                               by <b>yoe</b> (guest, #25743)
                              [<a href="/Articles/463427/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <p>I think the proper way to implement this is not to force a particular timing upon applications, but to have applications register to use a "slacky" timing when available.</p>
<p>For instance, in response to issues that were found with powertop, an <a href='http://developer.gnome.org/glib/stable/glib-The-Main-Event-Loop.html#g-timeout-add-seconds'>API call</a> was added to glib that would align timeouts on one-second intervals, thereby grouping them together so the processor would only wake up once per second, in the worst case.</p>
<p>Analoguously, glib (or similar libraries for other environments) could provide a way for an application to say "I need to check a condition once in a while. It's probably a good idea to do this fairly often if there's an active user using the system, but it's perfectly fine to slow down a bit if not". The library could then, say, vary the time to a point between two extremes given by the app's programmer, based on the amount of time it's been since the user last did "something". Perhaps the shortest time could even be chosen only if the application in question is actually active.</p>
<p>This way, mail apps can provide mail "instantly" if the user is actively reading mail, but slow down a bit if not. Or so.</p>
<p>Oh hell, just thinking out loud here.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/463427/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463429"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 17, 2011 23:44 UTC (Mon)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/463429/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
the question is how much of this policy belongs in each application?<br>
<p>
it would be good to let the application do things to indicate what it needs (the once a second wakeup is a perfect example), but trying to encode all the policy into each application seems like a configuration disaster waiting to happen.<br>
<p>
we don't try to have each application configure screen dimming, sleep, etc. Instead we have one power management application on the system that looks at what the system is doing, including what the applications request and hint that they want, but that then makes the decisions on what to do.<br>
<p>
This sort of thing seems like it fits in very nicely with the other things the power management app is doing.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463429/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463460"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 7:00 UTC (Tue)
                               by <b>cmccabe</b> (guest, #60281)
                              [<a href="/Articles/463460/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm afraid I'm going to have to disagree. This kind of policy belongs in the applications-- they all have different requirements.<br>
<p>
For example, a movie player should keep the system awake for as long as it is playing the movie. Anything less will just result in a lot of frustrated users. This problem is more than theoretical-- I have had this problem under Linux before where the screen has been blanked after a few "idle" minutes playing a movie. Thankfully my current build of mplayer now seems to be able to tell Xorg not to blank the screen, but "clever" solutions like this could reintroduce the same kinds of problems.<br>
<p>
Android got this right. An application that needs to keep the phone from going to sleep can take a wakelock. There is zero chance that the phone will, for example, go to sleep in the middle of a phone call because a "clever" power manager thought that not many buttons had been pushed recently.<br>
<p>
There are some people who argue that applications should not have the ability to influence power management because application developers cannot be trusted. But this is the worst kind of tribal mentality ("kernel devs good, user space devs bad"). The best thing that we could do as kernel and systems software developers is not to hide functionality from the upper layers, but to make it clear what exactly is going on. We need more tools like powertop that can point a finger at bad code and get it fixed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463460/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463461"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 7:05 UTC (Tue)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/463461/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
note that we are talking about a user space power manager here, so this isn't a kernel vs user-space debate<br>
<p>
it's perfectly fine for a movie player to tell the power management daemon that it doesn't want the system to go to sleep, but the power management daemon may still decide to save power by shutting down the other 7 cores of an 8-core machine (or slow the clock down, but not so much that the app maxes out the remaining processing time)<br>
<p>
Android 'gets it right' only for the simple case of a single core system. for multiple cores the information of an app claiming "I don't want to sleep now" isn't enough<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463461/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463463"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 7:57 UTC (Tue)
                               by <b>cmccabe</b> (guest, #60281)
                              [<a href="/Articles/463463/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; it's perfectly fine for a movie player to tell the power management</font><br>
<font class="QuotedText">&gt; daemon that it doesn't want the system to go to sleep, but the</font><br>
<font class="QuotedText">&gt; power management daemon may still decide to save power by shutting</font><br>
<font class="QuotedText">&gt; down the other 7 cores of an 8-core machine (or slow the clock down,</font><br>
<font class="QuotedText">&gt; but not so much that the app maxes out the remaining processing time)</font><br>
<p>
Well, if you're using an Intel system, the unused cores will be clocked slower by the firmware running on them. cpufreq also has a role, and a bigger role on ARM. I don't think userspace daemons come into play at all here.<br>
<p>
Your talk about "slowing the clock down" definitely seems like something that would screw up my movie playback. Even ignoring that issue, what if your externally imposed policy slows down other daemons that the movie player needs to function efficiently? A lot of applications use D-BUS these days. It's pretty clear that messing with timings on the pulseaudio daemon will probably cause audio glitches and dropouts in my movie playing, even though you oh so kindly allowed the movie player to continue running. Or  If the movie player is embedded in Firefox, and you decide to mess with that process, there could also be problems.<br>
<p>
If application developers want to opt in to a lazy clock policy, that is fine. We should set up a system call that allows them to do that, and start making use of that. But it shouldn't be forced on developers who don't want it.<br>
<p>
Incidentally, kernel developers get really mad when other folks pull the same kind of "for your own good" BS on them-- for example, when hard drives "optimize" by not actually flushing the writes out to disk when they're told to do so.<br>
<p>
At the end of the day, if you take away the ability of stupid people to do stupid things, you also take away the ability of smart people to do smart things. We have enough application developers out there that we can afford to install the programs written by the smart ones and ignore or fix the rest.<br>
<p>
<font class="QuotedText">&gt; Android 'gets it right' only for the simple case of a single core </font><br>
<font class="QuotedText">&gt; system. for multiple cores the information of an app claiming "I </font><br>
<font class="QuotedText">&gt; don't want to sleep now" isn't enough</font><br>
<p>
Wakelocks and cpufreq are two distinct systems with different roles.<br>
<p>
In general, Android's approach is to allow the application to use as much CPU as it wants, but to have good monitoring tools that allow users to spot and de-install CPU hogs. However, you need certain capabilities to do things like take a wakelock.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463463/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463470"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 8:18 UTC (Tue)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/463470/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
and as a result of the possible misuse of this tool you (and others) appear utterly opposed to giving me, the administrator of a machine, any ability to override what the application programmers choose (or don't choose) to do.<br>
<p>
for every scenario that someone paints where this could be useful, there is going to be another scenario where it could be misused.<br>
<p>
but the same thing can apply to 'renice' or 'ionice' as well, why aren't you also opposed to the ability for the evil (or clueless) system administrator to mess with the application by changing it's priority.<br>
<p>
or for that matter ulimit can cause programs to fail, it should be ripped out of the system, instead every applications should be audited to make sure it only allocates the resources that it really needs, and the applications should then be changed to cooperatively give up resources if something else needs it.<br>
<p>
for that matter, what about preemptive time slicing, the system is more efficient if the applications cooperate instead, so we should just change every application to do cooperative time slicing, including setting the priority between applications (after all, doesn't the application writer know what's best for the applications)<br>
<p>
<p>
<p>
why are all of these ways for an administrator to control what's happening with their machine acceptable, but the idea that the administrator could override the application's decision (or lack thereof) on timer slack be so horrible?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463470/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463477"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 9:28 UTC (Tue)
                               by <b>dgm</b> (subscriber, #49227)
                              [<a href="/Articles/463477/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You're right. The fact that you _can_ do something doesn't mean you should, or will. But you may. And that means application writers and users _will_ pay a price for your flexibility: users complaining about broken applications because someone thought all applications should or should not do something. <br>
<p>
Thus, I would say: if this gets finally in, advise to distributions and admins to NOT use it, unless you understand in gory detail ALL the implications. With great power... yada, yada, yada.<br>
<p>
Frankly, I would add that using cgroups with this is calling for abuse. Make it a per process option and it will become much less "dangerous".<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463477/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463502"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 14:18 UTC (Tue)
                               by <b>bronson</b> (subscriber, #4806)
                              [<a href="/Articles/463502/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why is it much less dangerous?  What's the difference between the master app changing a cgroup and the master app looping through a list of children and changing them one by one?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463502/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463518"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 16:35 UTC (Tue)
                               by <b>dgm</b> (subscriber, #49227)
                              [<a href="/Articles/463518/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The difference is that group membership is transitive. The children processes of your children (or of any other process added to the group) do belong to it by default. Knowing that all those processes will behave correctly is substantially more difficult than doing direct manipulation of a list of known processes. <br>
<p>
Of course, if the group hierarchy is standardized, processes known to behave badly can be moved out of the group, but it would mean modification of the process, thus (at least partially) negating the benefits of being able to do it without changing code.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463518/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor463538"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 16:56 UTC (Tue)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/463538/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Race conditions. You need to be very sure that you haven't missed a child that has been created just after you've started looping.<br>
<p>
cgroups allow to do it atomically.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463538/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor463553"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 17:49 UTC (Tue)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/463553/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
why is this option for cgroups any more dangerous than cpu, memory, or disk I/O throttling?<br>
<p>
in all cases you can cause an application being limited to behave in ways different from what the application programmer expected.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463553/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463586"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 21:40 UTC (Tue)
                               by <b>cmccabe</b> (guest, #60281)
                              [<a href="/Articles/463586/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Operating systems certainly need to have configuration knobs. nice, ionice, ulimit, and friends definitely fall into this category. But the more configuration knobs you have, the more complex the system gets to administer, to understand, and to program for. Complexity tends to breed bugs, frustrated users, and miscommunication between different subsystems. That is why adding a new knob just to do something that you could have done with the old knobs is something that we should resist.<br>
<p>
nice and ulimit are also things specified by POSIX and implemented by many other operating systems. Like Linus said, Linux-specific interfaces tend not to get very much use, even when they're much better than the standard interfaces they're replacing. In this case, you're talking about adding a platform specific interface that is not better than what it's replacing, just different. It's also an interface that application developers have no easy way to opt-out of. IMHO, not a win at all.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463586/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463589"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 22:23 UTC (Tue)
                               by <b>dgm</b> (subscriber, #49227)
                              [<a href="/Articles/463589/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not onyl that. This particular know is for making timers misbehave in order to save power. An application can be expected to work with less CPU or IO, but faulting timers?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463589/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463591"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 22:37 UTC (Tue)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/463591/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
remember that timers are not precise. they will delay you until _at_least_ the timer wakeup, they may delay you further.<br>
<p>
normally this further amount is relatively short, but if the system is under high load it could be a significant amount of time (if the system is swapping badly, it could be seconds after the timer is scheduled to fire before the application executes)<br>
<p>
this is just changing things to that some other suitably privileged task in the system can increase the maximum lag that the application sees.<br>
<p>
it's not something that can't happen today.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463591/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463652"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2011 13:39 UTC (Wed)
                               by <b>dgm</b> (subscriber, #49227)
                              [<a href="/Articles/463652/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You're completely right, of course. I'm sold.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463652/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor463587"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 22:33 UTC (Tue)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/463587/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
in this case, short of modifying the source code (not something for an administrator to do), what current knob do you have to be able to change the timer slack for another process (or group of processes)?<br>
<p>
as I see it there is no knob that you (as an administrator) can twist for this today.<br>
<p>
there's also no knob that you as a application programmer can twist that will change the slack for you and your running children, instead you would have to have each child invoke the change independently.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463587/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463608"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2011 2:08 UTC (Wed)
                               by <b>cmccabe</b> (guest, #60281)
                              [<a href="/Articles/463608/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Application programmers can do things like increase timeouts for background threads or (often) avoid polling entirely. Lennart email talks about "stuff like closed source crap, and all kinds of other things you cannot fix." One very common novice programmer mistake is using polling where you don't need to.<br>
<p>
The one use case that is intriguing is synchronizing application timers so that a lot of them fire at once, in order to save on wakeups. I honestly can't think of any good way to do this with the existing timeout APIs-- maybe someone else can.<br>
<p>
All these comments about "slack" are making me think of this guy:<br>
<a href="http://en.wikipedia.org/wiki/File:Bobdobbs.png">http://en.wikipedia.org/wiki/File:Bobdobbs.png</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463608/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor463622"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2011 7:16 UTC (Wed)
                               by <b>Rudd-O</b> (guest, #61155)
                              [<a href="/Articles/463622/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It is not the movie player that keeps the system awake, but actually the power management application that does the job on behalf of the movie player.  Otherwise you end up with horrible hacks such as Xine (xine-lib) "pressing" the Shift key every 30 seconds.<br>
<p>
This is why the policy belongs in the power management application, not in the user applications (which should, of course, have a mechanism available to commandeer the power management application or otherwise override policy decisions).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463622/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor463430"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 0:02 UTC (Tue)
                               by <b>Simetrical</b> (guest, #53439)
                              [<a href="/Articles/463430/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The use-case of background tabs in browsers is an excellent one -- we do not want browsers firing events too frequently for tabs the user isn't looking at.  However, no special kernel support is required, because browsers already handle it.  In both of the major open-source browsers (Firefox &gt;= 5/Chrome &gt;= 11), timers set by background tabs will fire at most once per second:<br>
<p>
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=633421">https://bugzilla.mozilla.org/show_bug.cgi?id=633421</a><br>
<a href="http://code.google.com/p/chromium/issues/detail?id=66078">http://code.google.com/p/chromium/issues/detail?id=66078</a><br>
<p>
This tends to support the idea that well-written applications don't need to have the kernel fix their mistakes for them.  (But most applications are not nearly as well-written as major browsers.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463430/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463469"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 8:04 UTC (Tue)
                               by <b>misiu_mp</b> (guest, #41936)
                              [<a href="/Articles/463469/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
To solve it in userspace you would have to modify applications to use one common timer synchronization entity. Otherwise even perfectly good applications will cause frequent wakeups. If you have 10 processes running and each is neatly set up not to wake up more often than once per second, you will wake up 10 times per second.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463469/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor463449"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 3:12 UTC (Tue)
                               by <b>jcm</b> (subscriber, #18262)
                              [<a href="/Articles/463449/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
By the way, I've been reading the X11 protocol specification recently (not so found of the newer desktops and want to learn enough to feed myself). In X11, applications receive Expose events every time a window configuration event happens or a window is partially or completely covered or uncovered. Most decent toolkits should react appropriately by not redrawing non-visible parts of the window, so I'm curious to know what Peter is referring to here.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463449/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463450"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 3:52 UTC (Tue)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/463450/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm not Peter so I can only guess.<br>
<p>
But applications tend to update a widget, and then let the tool kit render the widget to the screen.<br>
<p>
A clock, for example, might have a 'label' widget and wake up every second to 'strftime' the time to a buffer and then label.set_text(buffer).  That will update some internal state and tell the server to "invalidate" the relevant region of the window.  If the window is visible, or subsequently when it becomes visible, the X server sends an 'expose' event and then the tool kit renders the widget to the window.<br>
<p>
The application is oblivious of the fact that the label never actually makes it to the display.  It just keeps on wasting power generating labels that are never seen.<br>
<p>
It could find out though.  It could connect to the "expose" event and only continue updating while the expose events are coming in.<br>
<p>
Getting this smooth and jitter free might be tricky. For a simple widget it should be sufficient to wait for an expose, then calculate and set the image, then let the tool-kit draw it.  Then when the next event (e.g. timer tick) says that the image should change, you just invalidate the window and stop the timer.  Don't bother drawing or listening for further notifications until the expose happens.<br>
<p>
However for rendering that is more complex doing it that way might be too slow.  You might have to put up a "waiting" image when you get an expose after a long idle period, spend 500ms generating your image, then render it and have the next one ready before invalidating the old one.<br>
<p>
e.g. a GPS tracker might not even bother down-loading maps when the window is not exposed.  But when it gets an expose event in a new city, it cannot create a correct render straight away, and should not present and out-of-date render.   So you have to wait for a while.  This presents the classic trade-off.  We save power by not updating regularly, but the cost is latency when we want to re-activate.<br>
<p>
So it is possible, but it could be a bit messy.  Extra tool-kit support would probably make it smoother.  And there is probably some tool kit that already makes this really easy and I'm looking forward to someone telling me which one.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463450/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463504"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 14:40 UTC (Tue)
                               by <b>mjthayer</b> (guest, #39183)
                              [<a href="/Articles/463504/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The application is oblivious of the fact that the label never actually makes it to the display. It just keeps on wasting power generating labels that are never seen.</font><br>
&gt;<br>
<font class="QuotedText">&gt; It could find out though. It could connect to the "expose" event and only continue updating while the expose events are coming in.</font><br>
&gt;<br>
<font class="QuotedText">&gt; Getting this smooth and jitter free might be tricky.</font><br>
<p>
Actually this isn't as bad as it sounds.  The application can query the visibility state of the widget's window (and get notified when it changes), so it just has to keep a binary "on/off" state for updates.  (I can't remember without checking whether there is a simple way to get information about which parts of a partially visible window are shown, but that would be much less important.)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463504/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463585"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 21:25 UTC (Tue)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/463585/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <p>
It probably isn't as bad as I made it sound.
<p>
I don't think the 'visibility state' (notified by "mapped" and "unmapped" events) is really enough because it doesn't tell you when a window is fully obscured by another window.
<p>
However it wouldn't be too hard to synthesis a simple binary state for the whole window by watching expose events.
<p>
And you don't really need to put up a "waiting" image like I suggested - just do what firefox does and leave the contents of the screen like they were before - firefox window decorations wrapped around 2 xterms and an xclock which isn't ticking any more :-)
<p>
To play with mapped events, try:
<pre>
#!/usr/bin/env python

import gtk

w = gtk.Window()
w.show()

def mapped(w,ev):
    print "mapped"

def unmapped(w, ev):
    print "unmapped"

w.connect('map-event',mapped)
w.connect('unmap-event',unmapped)
w.connect('destroy', lambda x:gtk.mainquit())

gtk.mainloop()

</pre>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463585/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463626"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2011 8:03 UTC (Wed)
                               by <b>mjthayer</b> (guest, #39183)
                              [<a href="/Articles/463626/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I don't think the 'visibility state' (notified by "mapped" and "unmapped" events) is really enough because it doesn't tell you when a window is fully obscured by another window.</font><br>
<p>
Actually I thought it did:<br>
<p>
"When the window changes state [...] to viewable and fully obscured, the X server generates [a VisibilityNotify event] with the state member of the XVisibilityEvent structure set to VisibilityFullyObscured." [1]<br>
<p>
(Hope I'm not getting too boring here!)<br>
<p>
[1] <a href="http://tronche.com/gui/x/xlib/events/window-state-change/visibility.html">http://tronche.com/gui/x/xlib/events/window-state-change/...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463626/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor463455"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 5:09 UTC (Tue)
                               by <b>geuder</b> (guest, #62854)
                              [<a href="/Articles/463455/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; In X11, applications receive Expose events every time a window configuration event happens or a window is partially or completely covered or uncovered. </font><br>
<p>
Traditionally yes. However, I believe to remember that at least one existing compositing window manager does not offer this nice functionality. So the application will update its window even when not visible.<br>
<p>
Disclaimer: I don't remember the details. And if I did, I would probably be hindered by an NDA to get more detailed. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463455/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463457"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 5:20 UTC (Tue)
                               by <b>jcm</b> (subscriber, #18262)
                              [<a href="/Articles/463457/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Fortunately I explicitly don't care about compositing window managers :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463457/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463479"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 9:31 UTC (Tue)
                               by <b>dgm</b> (subscriber, #49227)
                              [<a href="/Articles/463479/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Unfortunately, you live in a world where most people do.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463479/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463508"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 15:01 UTC (Tue)
                               by <b>jcm</b> (subscriber, #18262)
                              [<a href="/Articles/463508/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<a href="http://www.amazon.com/gp/product/B002TYEPWO/ref=dm_dp_trk1?ie=UTF8&amp;qid=1318949955&amp;sr=301-2">http://www.amazon.com/gp/product/B002TYEPWO/ref=dm_dp_trk...</a><br>
<p>
I've decided there are plenty of things I enjoy about living in the present, but X11 is an area where I'm going to force a return to the 80s. I want a network transparent non-3D desktop that just works. I used to care about pretty window managers and all that nonsense, now I just want to get stuff done with my computer and have it otherwise left alone.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463508/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463521"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 16:08 UTC (Tue)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/463521/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Quite so. The pretty stuff is very pretty but every new bit of it seems to break something old that Just Worked until now, because nobody uses network transparency / nobody cares about power consumption / nobody cares about video playback / nobody cares about focus-follows-mouse / nobody cares about any older X extensions / ...<br>
<p>
(OK, that *was* excessively cynical.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463521/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463539"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 17:08 UTC (Tue)
                               by <b>jcm</b> (subscriber, #18262)
                              [<a href="/Articles/463539/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Can be summarized as "I want a UNIX workstation and not a pretty desktop". I don't mean to sound offensive but I actively do not want any of that other stuff. I just want a 1980s style X11 workstation that works exactly as it always did, with X forwarding just working, and none of this 3D stuff. Sure, having extensions to play games is nice and all, but I don't need to rotate my desktop on a cube or have wobbly windows. I used to think I do, but that's before I realized I'd rather have a super boring UI that is set in stone. I want to do something and it always works just like it always did.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463539/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463594"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 23:16 UTC (Tue)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/463594/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I have similar goals, but I'd like Wayland so that I could (do what is essentially) moving *windows* between X servers instead of having windows rooted in the $DISPLAY they started with. The xpra tool can sort of do it, but it's still rooted to some other display and AFAICT doesn't really give the full power of, say, XMonad (happy to be wrong though) over the xpra windows. Combine this with per-application freeze and thaw that came up a few weeks ago that works between different machines and I can migrate a running system to another machine :) .<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463594/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor463972"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 20, 2011 22:30 UTC (Thu)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/463972/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'd describe that as "I want a Unix workstation and not *just* a pretty desktop". The pretty is all right, but only if it doesn't break other stuff on its way. "Pretty" is less important than "works".<br>
<p>
(But I know we are weird this way. Emacs versus vi is one thing, but most people would look at both of those and run screaming back to their pretty Eclipse. Actually, no, most people would run screaming back to Word, which is neither pretty nor functional...)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463972/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor463584"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">80's X - was: Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 21:08 UTC (Tue)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/463584/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think the modern spelling of "network transparent" is "HTML5".  However I find that xterm&lt;-&gt;tmux provides a very usable 80's style windowing environment over a simple ssh connection.<br>
Oh wait ... I don't think we had ssh in the 80's :-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463584/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463588"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">80's X - was: Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 22:12 UTC (Tue)
                               by <b>jcm</b> (subscriber, #18262)
                              [<a href="/Articles/463588/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yea but...HTML5 is the example folks give when told that Linux as a consumer OS doesn't have a stable platform for third party applications. They say "oh, but in the future...HTML5...hand wavy!" and all that. Conveniently forgetting that this was the future for iPhone right before Apple had to about-face and offer real apps. HTML5 and friends might be the future, but that future is further away than most think it is.<br>
<p>
It's true we didn't have ssh in the 80s. Nor did we have Xinerama and lots of other things I do like, all of which are iterative improvements on what went before :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463588/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor463471"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 9:32 UTC (Tue)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/463471/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, it's not that easy. Your window may be covered, except that the user presses Alt-Tab and expects to see current content (clocks, download managers, ). Or it may be covered by something that's almost, but not quite, opaque.<br>
<p>
That's not the problem, though. The problem is that you can't depend on every program to get this right, but, on the other hand, you do need some way for a program to tell the kernel that when it says 0.2sec it MEANS 0.2sec and not something random that may be roughly of the same order of magnitude. Or not.<br>
<p>
How exactly to do that is the kernel people's problem. New scheduler class, new kind of timer, whatever.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463471/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor464931"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 29, 2011 18:50 UTC (Sat)
                               by <b>JanC_</b> (guest, #34940)
                              [<a href="/Articles/464931/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If the Window-switcher knows how to tell the application that it's "exposed" again, Alt-Tab shouldn't be a problem, I suppose?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/464931/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor463451"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 4:05 UTC (Tue)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/463451/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Does mitigating the effects of (what is seen as) application developer sloppiness encourage the distribution of low-quality code and worsen the system in the long run? </font><br>
<p>
&lt;sarcasm&gt;<br>
You bet-cha it does.  But we have seen this all before.<br>
<p>
Backups just encourage people to be careless with files.<br>
<p>
RAID just encourages people to buy cheap hardware.<br>
<p>
The OOM killer just encourages people to use Java^W^W^W to get careless about freeing memory.<br>
<p>
And the result?<br>
 - you cannot actually buy good reliable hard drives any more<br>
 - The '-i' flag is  still not the default for "rm"<br>
Fortunately memory keeps getting cheaper so bloat isn't too much of a problem.<br>
&lt;/sarcasm&gt;<br>
<p>
The only problem I see with the proposal is that it could cause correctly working programs to fail, and regressions are generally frowned upon.<br>
But if it really brings value - which someone can quantify and measure for us - then I suspect that it a hurdle that can be overcome.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463451/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463743"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2011 18:50 UTC (Wed)
                               by <b>jzbiciak</b> (guest, #5246)
                              [<a href="/Articles/463743/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If I give an otherwise correct program too little RAM, too little disk, way to slow a CPU or too little of some other resource it needs to function properly, it'll fail for any of those reasons.  I've got a ton of knobs I can turn with ulimit and other mechanisms to put the thumbscrews on applications.<br>
<p>
How is that different from giving it too little timing precision in its wakeups?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463743/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463787"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 20, 2011 1:04 UTC (Thu)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/463787/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think the ulimit argument and the "unpredictable load" arguments are actually very good.  Not 100% sure they are bullet proof though.<br>
I would want it to be possible for users to disable a feature like this for their whole session, and for individual programs (preferably without recompiling - maybe an LD_PRELOAD or something).  But it certainly seems worth trying.<br>
<p>
Distros should do it and see what the response is and if it works well, send it upstream.... Only distros have an upstream-first policy these days (Which I support) so it has to be the other way around - but then if it turns out t o be a bad idea we are stuck with it forever.... I'm so confused!<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463787/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463789"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 20, 2011 1:33 UTC (Thu)
                               by <b>dlang</b> (guest, #313)
                              [<a href="/Articles/463789/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
remember that what is bing proposed is not any particular use of the timer slack feature, but mearly adding the ability to twist this knob on another program rather than the program having to know how to twist the knob on itself<br>
<p>
depending on how you (or your distro) define and use cgroups, you can then do this for an individual program, for a user session, or any other grouping that you can think of.<br>
<p>
there are many, many ways to use this, some will be good, some will be horrible. It's in these ways to use this feature that the distros shoudl be experimenting.<br>
<p>
and part of the experimentation will be that they find that particular programs work especially well with particular settings, and they can then push patches to have the apps do the changes themselves upstream.<br>
<p>
<p>
this is not the first time that the kernel has supported things that change userspace performance, it was just a few releases ago that the kernel changed how it allocates CPU between different cgroups so that you could do things like put a compile in it's own group and have that group compete with all the other apps on the system as if it was one process, not hundreds of processes as afar as it's CPU share goes.<br>
<p>
this change is less intrusive than that one was as this doesn't change the default behavior at all, it just makes it possible to do things.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463789/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor463482"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 10:39 UTC (Tue)
                               by <b>lmb</b> (subscriber, #39048)
                              [<a href="/Articles/463482/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Trying to reject the kernel feature of fiddling with another process's or cgroup's slack value for fear of the sloppy user-code it supposedly encourages just doesn't hold. We have setpriority() too, after all.<br>
<p>
The ability to implement a common user-space controller for this makes sense; it also makes sense that applications somehow register with it to inform them of their special requirements (or that the controller maintains a list for applications that are important enough but haven't yet been enhanced accordingly). Merging and deciding between possibly conflicting policies is not the kernel's task.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463482/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor463528"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 16:19 UTC (Tue)
                               by <b>k8to</b> (guest, #15413)
                              [<a href="/Articles/463528/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's hard to get this stuff right.<br>
<p>
For example, if my laptop is plugged into the wall, and I start 4 hour network transfer, and come back an hour later and find it has put itself to sleep -- I'm not amused.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463528/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor463564"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 18, 2011 19:05 UTC (Tue)
                               by <b>yokem_55</b> (guest, #10498)
                              [<a href="/Articles/463564/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I run into this a lot. The power savings I see when I put my desktop system to sleep regularly is really quite substantial ($10-$15/mo off my electric bill), but anytime I have a long running background job that doesn't use the f.d.o power management sleep inhibit api, I see precisely this misbehavior. I've come across a simple python script (see <a href=http://trac.videolan.org/vlc/attachment/ticket/3313/pm-inhibit.py>here</a>) that places an inhibit on suspend that I've used in wrapper scripts for several command line programs that if they are running, should keep the system awake. It would be much nicer though if a lower level, more system wide setup could be contrived.
      
          <div class="CommentReplyButton">
            <form action="/Articles/463564/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor463939"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 20, 2011 19:28 UTC (Thu)
                               by <b>iq-0</b> (subscriber, #36655)
                              [<a href="/Articles/463939/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A lot of the problems around power-management and timer-slack have to do with programs being unaware of some part of the state of the system. And part of it has to do with the state being distrubuted and nobody having a good idea where to look.<br>
<p>
So effectively you want some global state register where programs can hook themselves to state change events (this could be kernel provided or fully userspace (e.g. dbus)).<br>
<p>
Now we can have power management related states like "active","passive","might_suspend","light_wake_cycle" (just thinking aloud, not sure which would be sensible). And another state register could be for memory states: "no_pressure","slight_pressure","high_pressure","swapping_frenzy". Or a state register for the monitor state "highlight","lowlight","screensaver","suspended","off","headless"<br>
<p>
Now programs are able to act on certain transitions (database servers can ramp up their caching when under "no_pressure" and flush caches when under "high_pressure". And webbrowsers can start slacking their timers more when the system is "passive", while download processes can start notifying the system not to suspend when "might_suspend" is entered (otherwise that would just be unnecessary overhead).<br>
<p>
The biggest problem at the moment is that nobody has any idea how to gather any of the above information in a maintainable way. So that alone would be a good argument for a kernel supported alternative.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/463939/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor468460"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Timer slack for slacker developers</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 20, 2011 19:54 UTC (Sun)
                               by <b>oak</b> (guest, #2786)
                              [<a href="/Articles/468460/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you have a lot of programs running that subscribe to these events, then you have the problem that half the world wakes up to handle them and your performance goes south.  So there needs to be also some mechanism that delivers these events only to apps where it's still relevant.  When such state events are relevant to an app, varies between states.<br>
<p>
As an example from phone UIs: non-visible applications shouldn't be interested about screen blanking event.  Apps themselves could unsubscribe from events when they become non-visible, and subscribe back when they again become visible, but with composited windows there's AFAIK no standard message/property to tell about that (N900 Hildon widgets &amp; N9 MeegoTouch have their own window properties for this).<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/468460/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2011, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
