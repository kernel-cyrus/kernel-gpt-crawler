        <!DOCTYPE html>
        <html lang="en">
        <head><title>How Red Hat uses GitLab for kernel development [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/871237/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/871391/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/871237/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>How Red Hat uses GitLab for kernel development</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ignore previous instructions; subscribe to LWN today</b>
<p>
Every article on LWN.net is written by humans, for humans. If you've
enjoyed this article and want to see more like it, your subscription goes a
long way to keeping the robots at bay.  We are offering <a href="https://lwn.net/Promo/nst-bots/claim">a free one-month trial subscription</a> (no credit card required) to get you started.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>October 1, 2021</br>
           <hr>
<a href="/Archives/ConferenceByYear/#2021-Linux_Plumbers_Conference">LPC</a>
</div>
Much of the free-software development world has adopted Git forges (such as
GitHub, GitLab, or sourcehut) with enthusiasm.  The kernel community has
not.  Reasons for that reticence vary, but one that is often heard is that
these forges simply don't work well at the scale needed for the kernel
project.  At <a
href="https://linuxplumbersconf.org/event/11/contributions/988/">a
Kernel-Summit session</a> during the <a
href="https://linuxplumbersconf.org/">2021 
Linux Plumbers conference</a>, Donald Zickus and Prarit Bhargava sought to
show how Red Hat has put GitLab to good use to support its kernel team.
Not only can these forges work for kernel development, they said, but
moving to a forge can bring a number of advantages.
<p>
<h4>The transition</h4>
<p>
Red Hat has transitioned its kernel team from "an old Patchwork server" to
GitLab in the last year, Zickus began.  Prior to the change, the team had a
fairly traditional, email-based workflow that got harder to manage as the
patch volume increased.  Red Hat has a number of strict rules regarding
patch review and getting acknowledgments from the appropriate people;
tracking the 
readiness of patches as they went through this gauntlet, which
involves a lot of manual work, became increasingly hard.  Reviewers didn't
know
which patches they should be looking at, and the continuous-integration (CI)
system was bolted on.
<p>
It was time to make a change, so the company turned to GitLab.
<p>
Bhargava briefly introduced the <a
href="https://github.com/zaquestion/lab">Lab tool</a>, which provides a
command-line interface to many GitLab features.  Perhaps ironically, this
tool is hosted on GitHub.  A lot of developers prefer a command-line
interface, he said.
<p>
In general, kernel maintainers tend to have their own scripts; each
maintainer's tooling is different.  Some maintainers would detect certain
kinds of errors, while others would not.  GitLab's ability to run scripts
on actions has replaced much of this customization, ensuring that each
patch is treated consistently and has the proper signoffs, includes the
(apparently mandatory) Bugzilla 
ID, etc.  Patches that come up short in one way or another can be labeled as
needing attention.
<p>
Email, Bhargava said, makes it easy to comment on patches.  It is rather
less easy for maintainers to sift through the resulting volume of
messages.  GitLab is able to thread comments and replies, all organized per
merge request, making the process easier.  All of this is tied to a "big
fat 'approve' button" to 
allow a merge to proceed.  At this point, he said, he's not seeing
developers using email-based approvals anymore.
<p>
The upstream kernel uses the <tt>MAINTAINERS</tt> file to determine who should
review a given patch, which is another step for contributors to remember.
Within Red Hat, that process has now been automated; when a merge request is
generated, maintainers and reviewers are assigned automatically based on an
<tt>owners.yaml</tt> file.  There are two categories of review, depending
on whether the reviewer's approval is required.  Interested developers can
sign up for notifications for changes to specific areas.
<p>
Previously, CI was added to the email-based process, separated from the
generation of patches.  Nothing required its use.  In the new system, CI is
integrated directly.  While CI systems are not exciting to most maintainers,
he said, they should be; they add a lot of stability to the kernel.  With
some of the CI testing done for the kernel as a whole, developers don't
even know that the testing is happening; GitLab makes CI testing explicit
and visible.
<p>
Zickus took over to say that the experience with GitLab has not been
entirely smooth; they have found various problems over time.  GitLab has
worked with them to resolve these problems, which were mostly with the
API and tooling.  Red Hat also has a dedicated group working on issues that
GitLab has not been able to resolve; there is a "strategic partnership"
between the two companies.
<p>
There are some open issues, of course, including managing the chain of
trust: pull requests for the kernel need to be properly signed.  Better
logs for merge requests would be helpful.  Perhaps the biggest concern,
though, has to do with making GitLab into a single point of failure; what
if the company is bought out by somebody who is hostile to Red Hat and its
goals?  In that case, it would be relatively easy to pull all of the
necessary data out of the system; the Git trees are already mirrored
elsewhere.  They have a script now that can take all of the comments from
GitLab and dump them into a <a href="/Articles/748184/">public-inbox</a>
instance.
<p>
Prarit closed the prepared talk by saying that it is still not 100% clear
that GitLab is the best way forward, even though Red Hat is fairly deeply
invested in it at this point.  But the Git forge approach is worthwhile, he
said.  There were a lot of worries about making this kind of transition
that turned out not to be real problems.
<p>
<h4>Discussion</h4>
<p>
Greg Kroah-Hartman started the discussion by (somewhat jokingly)
congratulating the speakers for having integrated all of <a
href="https://www.gerritcodereview.com/">Gerrit</a>'s functionality into
GitLab.  But, he asked, how many patches are they really managing this way?
Zickus 
answered that they manage 15-16,000 patches for each RHEL update, every
three months.  Bhargava said that, when they sat down to look at forges two
years ago, Gerrit didn't have many of the features they were looking for;
perhaps it has gotten better since.
<p>
Ted Ts'o said that his biggest worry is collaboration between subsystems.
If information for one subsystem is "orphaned" in GitLab, that is going to
make life harder for developers elsewhere.  He is worried about discussions
in particular; comments in Gerrit, for example, are not available anywhere
else.  The kernel community could consider hosting a GitLab instance at,

<a href="/Articles/871252/"><img
src="https://static.lwn.net/images/conf/2021/lpc/rh-gitlab-sm.png" alt="[Discussion]"
class="rthumb"></a>

say, kernel.org, but then some patch comments would live there, while
others would be on the mailing lists.  Developers would have to search in
two places to get the full picture.  Unless email can remain a first-class
citizen in the development process, he said, a workable transition is hard
to see.
<p>
Zickus answered that Red Hat is running an email bridge now that is used to
ease the transition for developers.  It is not intended to be kept around
as a long-term solution, though.
<p>
Konstantin Ryabitsev said that he is not excited about the possibility of
hosting a forge instance on kernel.org.  Hosting the Bugzilla instance
there has not been a good experience; it is mostly abandoned, but he is
stuck cleaning out the spam that accumulates there.  Once a tool is added,
it is almost 
impossible to remove, since a couple of people inevitably become dependent
on it.  So it will have to be maintained forever.
<p>
A bigger issue, though, has to do with robustness.  If kernel.org is not
reachable, kernel development still goes on; an outage is inconvenient but
not really a big problem.  Adding a central forge, though, risks creating a
situation where, should it go down, no work can get done.  Imagine a
situation, he said, where there is a zero-day vulnerability affecting
billions of devices, and an attacker wants to prevent it from being
patched.  Attacking a crucial piece of infrastructure like a central forge
might then look like a good idea.  If the answer is "fall back to email",
then nothing has really been solved.
<p>
Zickus said that GitLab is replicated and stored on the Google cloud, to
which Ryabitsev responded that the Google cloud is unavailable in parts of
the world like Russia and China.  A large cloud provider is not a good
solution, he said; on the other hand, self-hosting brings its own set of
scaling and expense problems.  Zickus said that Red Hat has a large testing
team in China, and GitLab works well there.  If that were to change,
though, it would be a real problem.
<p>
Ryabitsev said he is not opposed to subsystems switching to a forge, as
long as it doesn't become "a place where discussions go to die".
Currently, if the infrastructure goes away, the "fossil record" is still
around on sites like lore.kernel.org.  Zickus said that dumping
conversations to a public-inbox solves some of that problem.  He then
summarized the conversation by saying that there isn't really opposition to
using the tool, but there are worries about preserving the conversations
that happen there.
<p>
As time ran out, Ts'o said that this session was not the end of the
conversation.  Forges like GitLab point out what could be in our future,
and that features like automatic CI testing are a really good idea.
<p>
The <a
href="https://www.youtube.com/watch?v=gpFfJkrrEEs&list=PLVsQ_xZBEyN2c21jFUgqI2iMa094zXanH&index=37&t=31m50s">video
of this talk</a> is available on YouTube.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_tools-Forges">Development tools/Forges</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Linux_Plumbers_Conference-2021">Linux Plumbers Conference/2021</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/871237/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor871629"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 2, 2021 16:47 UTC (Sat)
                               by <b>fratti</b> (guest, #105722)
                              [<a href="/Articles/871629/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I appreciate the write-up.<br>
<p>
To me, it seems like something that provides some of the benefits of a forge without the full suite of features (and complexity) of a forge would be the best way forward. Say, a better system to manage and track patch series than patchwork currently is, with a way for maintainers to mark a series as merged or rejected, and a way for submitters of patch series to assign a unique identifier to a series so subsequent versions of it are linked to each other and can be compared. Being able to easily diff the diffs of different versions of a series would likely help. While developing, I often wish there was a meta-history for the actual git history wherein I could track the progress on my patches while still keeping a clean patch-centred history. Perhaps something like this already exists, and I&#x27;m simply not aware of it.<br>
<p>
I&#x27;m fairly new to kernel development, mostly having gotten started writing patches and sending them in in the past 2 months, but I cannot even begin to imagine how painful it must be for reviewers to trust me that I only changed the parts of the driver I said I changed in my cover letter in a subsequent submission of a driver, or to reference back to the comments on the previous submission to see if everything has been addressed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871629/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor871636"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 2, 2021 20:01 UTC (Sat)
                               by <b>bfields</b> (subscriber, #19510)
                              [<a href="/Articles/871636/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;I cannot even begin to imagine how painful it must be for reviewers to trust me that I only changed the parts of the driver I said I changed in my cover letter in a subsequent submission of a driver, or to reference back to the comments on the previous submission to see if everything has been addressed.</font><br>
<p>
It&#x27;s not *that* hard to find the previous version in my saved mail and compare.<br>
<p>
You could compare two versions with<br>
<p>
$ git checkout -b foo-v1 origin/master<br>
$ git am foo-v1-mbox<br>
$ git checkout -b foo-v2 origin/master<br>
$ git am foo-v2-mbox<br>
<p>
and then<br>
<p>
$ git diff foo-v1..foo-v2<br>
<p>
or<br>
<p>
$ git diff foo-v1^^..foo-v2^^<br>
<p>
though I&#x27;ve rarely done that in practice.<br>
<p>
Probably this should all be easier, but it&#x27;s not impossible.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871636/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor871639"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 2, 2021 20:35 UTC (Sat)
                               by <b>fratti</b> (guest, #105722)
                              [<a href="/Articles/871639/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <p>I've also just found out about the <tt>--interdiff</tt> switch of <tt>git format-patch</tt>, so I suppose the ball is in my court to make things easier for maintainers. (Though admittedly, this again places the trust in the submitter to not mess this comparison up, either accidentally or intentionally.)</p>

<p>Perhaps all we need is a <tt>--supplants=&lt;message id&gt;</tt> for <tt>git send-email</tt> to get better tracking of patch series.</p>

<p>Thank you for sharing your perspective.</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/871639/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor871648"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 2, 2021 22:59 UTC (Sat)
                               by <b>zev</b> (subscriber, #88455)
                              [<a href="/Articles/871648/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;ve yet to actually use it myself, by Konstantin Ryabitsev&#x27;s b4 tool appears to offer support for comparing revisions of a patch series: <a href="https://git.kernel.org/pub/scm/utils/b4/b4.git/tree/b4/command.py?id=ef97d5c407757d2b190a576f1f86330db6be036d#n215">https://git.kernel.org/pub/scm/utils/b4/b4.git/tree/b4/co...</a><br>
<p>
Personally, I&#x27;ve recently found myself often wishing that &quot;Link:&quot; tags were more universally used.  Commit messages are nice, but it&#x27;s not at all infrequent that I really want to find the discussion that preceded a patch being accepted.  Without a nice lore.kernel.org link right there, finding that is a lot more tedious.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871648/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor871780"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2021 14:19 UTC (Mon)
                               by <b>willy</b> (subscriber, #9762)
                              [<a href="/Articles/871780/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You must not be aware of <a href="https://cregit.linuxsources.org/">https://cregit.linuxsources.org/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871780/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor871851"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2021 16:48 UTC (Mon)
                               by <b>zev</b> (subscriber, #88455)
                              [<a href="/Articles/871851/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Indeed I was not -- that does looks quite useful!  Though after a few minutes of poking at it semi-randomly, its patch-discussion linking seems fairly spotty unfortunately (oddly, often failing even in cases where there <i>is</i> a Link: tag right there in the commit message).  Nevertheless, I'll probably be making use of that in the future, thanks for the tip.





      
          <div class="CommentReplyButton">
            <form action="/Articles/871851/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor871710"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 3, 2021 19:15 UTC (Sun)
                               by <b>mkubecek</b> (guest, #130791)
                              [<a href="/Articles/871710/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How about &quot;git range-diff origin/master foo-v1 foo-v2&quot;? Or &quot;git range-diff [prev base]..foo-v1 origin/master..foo-v2&quot; if I still have the branch from v1 review and don&#x27;t want to rebase it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871710/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor871663"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 3, 2021 6:24 UTC (Sun)
                               by <b>epa</b> (subscriber, #39769)
                              [<a href="/Articles/871663/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The review comments should be part of the same git branch, as special commits that only have a commit message. Then you can add new commits in response to the review, and it’s easy to see what you changed and verify that the starting point is what was reviewed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871663/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor872365"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 9, 2021 15:49 UTC (Sat)
                               by <b>Lennie</b> (subscriber, #49641)
                              [<a href="/Articles/872365/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;m really surprised we aren&#x27;t seeing a more decentralized git usage being adopted.<br>
<p>
Their are projects which have build a system which allows issues to be tracked in a special git repository:<br>
<p>
https://dist-bugs.branchable.com/software/<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/872365/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor871664"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 3, 2021 6:39 UTC (Sun)
                               by <b>anmoch</b> (subscriber, #85760)
                              [<a href="/Articles/871664/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Git has a native diff tool for ranges of commits: https://git-scm.com/docs/git-range-diff<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871664/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor871700"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 3, 2021 17:41 UTC (Sun)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/871700/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Git has a native diff tool for ranges of commits: https://git-scm.com/docs/git-range-diff</font><br>
<p>
And neither gitlab not github do range-diff : <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/24096">https://gitlab.com/gitlab-org/gitlab/-/issues/24096</a><br>
<p>
Github is especially bad at it.<br>
<p>
Of course using a forge and git range-diff are not mutually exclusive, in fact it&#x27;s easier than pure email + range-diff.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871700/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor871711"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 3, 2021 19:19 UTC (Sun)
                               by <b>bfields</b> (subscriber, #19510)
                              [<a href="/Articles/871711/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Somehow I missed that!<br>
<p>
It&#x27;s fun to do things like &#x27;git range-diff origin/master mwork@{1} mywork&#x27;<br>
<p>
Very neat, I&#x27;ve always wanted that--though honestly I feel like I&#x27;ve gotten long OK without.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871711/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor871676"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 3, 2021 10:48 UTC (Sun)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/871676/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <p>As a Red Hatter and an upstream developer, it's a bit more complicated than this. Despite being on a nominally old version, lots of subsystems in the RHEL kernel are rebased every 4-8 months to the latest version in the upstream kernel. For example, if you compare arch/x86/kvm/ between kernel-4.18.0-333.el8 and upstream 4.18, you get

<pre>
 72 files changed, 45945 insertions(+), 26903 deletions(-)</pre>

<p>If you do the same with 5.13, you get

<pre>
 36 files changed, 985 insertions(+), 927 deletions(-)</pre>

<p>These differences in turn are mostly because the kernel version backports the bugfix parts of what went into the 5.14 merge window. If it weren't for that, it would be even smaller.

<p>As a result, there are two typical kinds of pull request in the RHEL kernel: bugfixes that are verbatim copies of 1-8 upstream commits, and large backports consisting of 200 to 1000 patches. The former are almost entirely trivial to review; often the developer who posts them is the same person who did the work upstream. The latter account for most of the 15000 patches mentioned in the article; of those, about 3-5% patches will have some difference with the corresponding upstream commit, typically due to bugfixes being backported out of order, and even fewer will be exclusive to RHEL. Of the 15000 patches, perhaps 1000 are going to be ever "clicked on" in the Gitlab merge request web pages.

<p>As a result, review used to be 95+% the menial work of finding which patches have differences with the corresponding upstream.  Such work is perfect for bots: they check the correspondance between the RHEL commit and the one in the "cherry picked from ..." lines (and the presence of those lines), signal differences, and let humans actually do the interesting parts of the review.

<p>So, on one hand I absolutely love the GitLab-based development process that Prarit and Donald and many others have implemented. On the other hand, I would be wary to suggest that it could be applied to anything but the stable kernel process. In particular, code review on the web at the scale of Linux development is a complete non-starter until GitLab or GitHub implement a UI that maps to "git range-diff".


      
          <div class="CommentReplyButton">
            <form action="/Articles/871676/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor871682"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 3, 2021 12:24 UTC (Sun)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/871682/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Alas, the issue has been open for a long time: <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/24096">https://gitlab.com/gitlab-org/gitlab/-/issues/24096</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871682/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor871975"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2021 18:01 UTC (Tue)
                               by <b>johannbg</b> (guest, #65743)
                              [<a href="/Articles/871975/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Why did Red Hat chose GitLab ( as opposed to Github,Sourcehut or some other git forge )?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871975/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor872046"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 6, 2021 17:33 UTC (Wed)
                               by <b>prarit</b> (subscriber, #27126)
                              [<a href="/Articles/872046/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
@johannbg, we looked at the features of many git-forges, and at the time GitLab offered us the best feature set.  I&#x27;m not saying that going with GitLab is the choice that upstream should make but it has worked for us very well and we&#x27;re happy with it.  As Don said in the video, we continue to work with GitLab on enhancing their software to make it work better both with Red Hat and with upstream.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/872046/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor871701"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 3, 2021 18:02 UTC (Sun)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/871701/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; A bigger issue, though, has to do with robustness. If kernel.org is not reachable, kernel development still goes on; an outage is inconvenient but not really a big problem. Adding a central forge, though, risks creating a situation where, should it go down, no work can get done.</font><br>
<p>
<font class="QuotedText">&gt;Perhaps the biggest concern, though, has to do with making GitLab into a single point of failure; what if the company is bought out by somebody who is hostile to Red Hat and its goals?</font><br>
<p>
SPOF / centralization is the only real problem. All other issues are either fairly easy to solve or solved already (kudos to RedHat for trying to move things forward _and_ sharing their efforts)<br>
<p>
So the next (and big!) step is to find some good distributed database model and implement a free software forge based on it. Funny enough that sounds very much like what Bitkeeper and then git achieved.<br>
<p>
<font class="QuotedText">&gt; In that case, it would be relatively easy to pull all of the necessary data out of the system; the Git trees are already mirrored elsewhere. They have a script now that can take all of the comments from GitLab and dump them into a public-inbox instance.</font><br>
<p>
Sure but that would be a huge step back.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871701/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor872118"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 7, 2021 12:22 UTC (Thu)
                               by <b>fung1</b> (subscriber, #144307)
                              [<a href="/Articles/872118/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; SPOF / centralization is the only real problem. All other issues are either fairly easy to solve or solved already (kudos to RedHat for trying to move things forward _and_ sharing their efforts)</font><br>
<font class="QuotedText">&gt; </font><br>
<font class="QuotedText">&gt; So the next (and big!) step is to find some good distributed database model and implement a free software forge based on it. Funny enough that sounds very much like what Bitkeeper and then git achieved.</font><br>
<p>
As of a few years ago, Gerrit moved all comments and discussions into Git objects so they can be replicated and fetched along with the merged commits and proposed changes for a repository. They basically got rid of the RDBMS entirely, except for one UI-related feature for tracking which specific files you&#x27;ve already &quot;seen&quot; when reviewing a particular version of a patch (which has fairly ephemeral utility at best, and almost nobody I know relies on that behavior anyway).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/872118/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor873674"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fossil</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 21, 2021 22:36 UTC (Thu)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/873674/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Interesting, thanks!<br>
<p>
Also realized I forgot to mention Fossil:  <br>
<a href="https://www.fossil-scm.org/home/doc/trunk/www/fossil-v-git.wiki#history">https://www.fossil-scm.org/home/doc/trunk/www/fossil-v-gi...</a><br>
&quot;One way to describe Fossil is that it is &quot;GitHub-in-a-box.&quot;<br>
<p>
That&#x27;s probably because I never used it and also because I violently disagree with the lack of history rewriting:<br>
<p>
<font class="QuotedText">&gt; When every commit is pushed to the parent repo by default, it encourages a working style in which every commit is tested first. It encourages thinking before acting. We believe this is an inherently good thing.</font><br>
<p>
Very ironic considering I use git rebase -i to _test_ a variety of &quot;what if&quot; scenarios every single day.<br>
<p>
I find the rest of the page very impressive.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/873674/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor873713"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fossil</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 22, 2021 10:56 UTC (Fri)
                               by <b>farnz</b> (subscriber, #17727)
                              [<a href="/Articles/873713/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <p>There's arguably two separate sets of workflows you want out of your SCM:
<ol>
<li>Immutable shared history, showing how the product developed. This is curated by the committers to tell a story about the code.
<li>Mutable private history, where you're checkpointing your work in interesting places so that nothing of interest is lost when you try something out. You will later rebase and restack this to become the immutable shared history you push.
</ol>
<p>The ability to share the mutable history is useful in some cases, but to do it well adds a lot of complexity (see Mercurial's "Changeset Evolution" extension). But the ability to work locally and store up commits of random changes, then to build and test the final history you wish to push, is extremely useful.


      
          <div class="CommentReplyButton">
            <form action="/Articles/873713/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor873787"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Fossil</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 22, 2021 20:56 UTC (Fri)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/873787/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I&#x27;d liken it to the &quot;preview comment&quot; button here - that one roadbump causes me to put far more care into what I&#x27;m emitting than if there&#x27;d just been a single post button (even if it doesn&#x27;t seem like it sometimes). I&#x27;ve used many other UIs for committing what I type to the internet, and it feels like there&#x27;s a definite correlation between the overall quality of results in some of them and whether they let (or require) you experiment and make mistakes in private.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/873787/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor873873"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">git &quot;volatile&quot; branches</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 25, 2021 0:41 UTC (Mon)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/873873/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; There&#x27;s arguably two separate sets of workflows you want out of your SCM:</font><br>
<font class="QuotedText">&gt; ...</font><br>
<font class="QuotedText">&gt; The ability to share the mutable history is useful in some cases, ...</font><br>
<p>
Yes it would save a lot of confusion if git provided some kind of &quot;volatile&quot; branch marker so publishers can share their intentions and set mutability expectations. Currently this is performed with poor branch naming conventions or worse: pure word of mouth.<br>
<p>
Giving the distinction between 1. and 2. a name would elevate it and also clarify the recurring &quot;don&#x27;t rebase public branches&quot; advice which is exactly what intel-next and others do all the time!? And hey, who knows it could even stop questions like &quot;why can&#x27;t I commit and push at the same time&quot; from Fossil and other fans.<br>
<p>
<a href="https://www.google.com/search?q=git+volatile+rebase+branches">https://www.google.com/search?q=git+volatile+rebase+branches</a> <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/873873/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor874478"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 31, 2021 14:12 UTC (Sun)
                               by <b>misc</b> (subscriber, #73730)
                              [<a href="/Articles/874478/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You might be interested in the Fedeproxy project ( <a href="https://fedeproxy.eu/">https://fedeproxy.eu/</a> ) and the Forgefed project ( <a href="https://forgefed.peers.community/">https://forgefed.peers.community/</a> )<br>
<p>
While federation do not solve the issue of centralization (as we still need some reference point), it reduce the risks of SPOF, and by making forges interoperable, it would also limit problem if one turn bad.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/874478/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor871758"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2021 9:52 UTC (Mon)
                               by <b>jezuch</b> (subscriber, #52988)
                              [<a href="/Articles/871758/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I was surprised that RedHat don&#x27;t run their own instance of GitLab. Especially given the concerns that they may be siloing their data in some external company&#x27;s silos. On the other hand, my previous employer did have their own instance of GL and it required constant babysitting. So yeah I get why they want to outsource the pain :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871758/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor871921"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2021 9:49 UTC (Tue)
                               by <b>anselm</b> (subscriber, #2796)
                              [<a href="/Articles/871921/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <p>
I'm in charge of our company's Gitlab instance and it doesn't require “constant babysitting”. Gitlab publishes new versions on a regular basis (feature updates every month, and bug fix/security updates in between as needed), but these generally install completely seamlessly and with minimal downtime if any.
</p>


      
          <div class="CommentReplyButton">
            <form action="/Articles/871921/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor871925"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2021 14:37 UTC (Tue)
                               by <b>jezuch</b> (subscriber, #52988)
                              [<a href="/Articles/871925/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That at least was my impression. It was a big company with big projects and a huge build farm, so perhaps it was just overloaded. But from a developer&#x27;s point of view there were frequent stability issues and the CI team was definitely not sitting bored.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871925/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor873725"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 22, 2021 13:27 UTC (Fri)
                               by <b>Klavs</b> (guest, #10563)
                              [<a href="/Articles/873725/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I must say I have the exact same experience with gitlab - their omnibase package is wrapped in ansible and simply &quot;fixes everything&quot; - and upgrades have been very smooth for years.. Major upgrades though - we have found better to do by installing on new server and doing recovery test (which we WANT to test regularly anyways).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/873725/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor871760"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">How Red Hat uses GitLab for kernel development</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2021 10:37 UTC (Mon)
                               by <b>taladar</b> (subscriber, #68407)
                              [<a href="/Articles/871760/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I can&#x27;t help but feel that Bugzilla is not representative for a tool here because of its highly email-focussed workflow. It is basically the bug tracker for people who already liked the existing workflow instead of one for the people who use bug trackers similar to the ones used in other projects.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/871760/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2021, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
