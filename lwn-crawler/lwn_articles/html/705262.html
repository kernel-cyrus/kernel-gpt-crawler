        <!DOCTYPE html>
        <html lang="en">
        <head><title>The status of kernel hardening [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/705262/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/704819/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/705262/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>The status of kernel hardening</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Benefits for LWN subscribers</b>
<p>
The primary benefit from <a href="/Promo/nst-nag5/subscribe">subscribing to LWN</a>
       is helping to keep us publishing, but, beyond that, subscribers get
       immediate access to all site content and access to a number of extra
       site features.  Please sign up today!
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>November 2, 2016</br>
           <hr>
<a href="/Articles/KernelSummit2016/">2016 Kernel Summit</a>
</div>
At the <a href="/Articles/662219/">2015 Kernel Summit</a>, Kees Cook said,
he talked mostly about the things that the community <i>could</i> be doing
to improve the security of the kernel.  In 2016, instead, he was there to
talk about what had actually been done.  Kernel hardening, he reminded the
group, is not about access control or fixing bugs.  Instead, it is about
the kernel protecting itself, eliminating classes of exploits, and reducing
its attack surface.  There is still a lot to be done in this area, but the
picture is better than it was one year ago.
<p>
One area of progress is in the <a href="/Articles/691102/">integration of
GCC plugins</a> into the build system.  The plugins in the kernel now are
mostly examples, but there will be more interesting ones coming in the
future.  Plugins are currently supported for the x86, arm, and arm64
architectures; he would like to see that list grow, but he needs help from
the architecture maintainers to validate the changes.  Plugins are also not
yet used for routine kernel compile testing, since it is hard to get the
relevant sites to install the needed dependencies.
<p>
Linus asked how much plugins would slow the kernel build process;
linux-next maintainer Stephen Rothwell also expressed interest in that
question, noting that "some of us do compiles all day."  Kees responded
that there hadn't been a lot of benchmarking done, but that the cost was
"not negligible."  It is, though, an important part of protecting the
kernel.
<p>
<h4>Probabilistic protections</h4>
<p>
The kernel has adopted a number of probabilistic protections over the last
year.  These protections only work if the attacker doesn't know something
about the system.  They include kernel address-space layout randomization
(KASLR) 
and stack protection.  Probabilistic protections can be defeated if the
information leaks out, but they are still effective and worth doing.
<p>
One improvement is in the randomization of the kernel text base; it was
added to arm64 in the 4.6 release and MIPS in 4.7.  But the text base is
only the beginning, more memory areas need to be randomized.  One
possibility is to randomize the kernel's link order at boot time.  That
would be a lot of work, but it would mean that an attacker would need more
than a single information leak to defeat the whole thing.
<p>
Linus said that randomization can be a pain for debugging; it is not fun to
track down a problem that only happens in one boot out of every 300 or so.  Al
Viro worried that changing the link order would also change the order in
which the kernel's initialization calls are made, with unpredictable

<a href="/Articles/705268/"><img src="https://static.lwn.net/images/conf/2016/ks/KeesCook-sm.jpg"
class="lthumb" alt="[Kees Cook]" title="Kees Cook"></a>

effects.  Kees responded that this particular change isn't coming anytime
soon.  Andi Kleen suggested just doing the link randomization and dropping
KASLR altogether; the kernel's addresses tend to leak via all kinds of paths
anyway.  Linus responded that, while the address leaks are being plugged
over time, KASLR does indeed work poorly against local
attackers, but it is more useful against remote attackers.  
<p>
Kees went on to say that the kernel got KASLR for its memory areas in 4.8
for the x86_64 architecture.
<p>
Work is being done on free-list randomization, which makes the layout of
the heap less predictable.  Perhaps more controversial is struct layout
randomization.  That cannot be done in a general way without causing all
kinds of problems, but there is one place where it is especially useful:
structs consisting of only function pointers.  Such structs are one of the
most prized targets for attackers, and the kernel has a lot of them.  A GCC
plugin can be used to detect these structures and randomize their order.
In general, the kernel shouldn't care about that ordering, and changing it
should not have performance effects.
<p>
Linus was not entirely convinced; he said that most people are running
distributor kernels, so the specific ordering used will always be available
to an attacker.  The value, Kees responded, is forcing attackers to
identify specific kernel builds; that is "excruciating" for them.  It
greatly expands the number of settings their exploit has to work in.
<p>
<h4>Deterministic protections</h4>
<p>
While probabilistic protections only work if some key data remains secret,
Kees said, deterministic protections work all the time.  These include
things like read-only memory; if memory is read-only, it is always
protected from being changed.  Bounds checking to head off overflows is
another form of deterministic protection.
<p>
One useful protection is the <tt>CONFIG_DEBUG_RODATA</tt> configuration
option which, Kees said, is badly named.  It ensures that executable memory
is not writable anywhere in the kernel; it should be mandatory on all
systems that support it.  It is turned on by default on the x86
architecture as of 4.6, and will be for arm64 as of 4.9.
<p>
Another important protection is protection of user space against access by
the processor when it is running in a privileged mode.  By far the most
common way 
to exploit the kernel, he said, is to get the kernel to execute code
that has been placed somewhere in user-space memory.  If the kernel cannot
access that memory, such exploits will not work.  Processor vendors have
worked to provide such protections using technologies like SMAP and SMEP
(on x86) and PAN (on ARM), but there is a problem: such protections are not
widely available yet.  There are no Xeon processors with
<strike>SMEP</strike> SMAP on the
market; PAN was added to the ARMv8.1 specification, but no hardware is
shipping yet.
<p>
So, he said, the kernel needs emulation of those features instead; it is,
he said, a fundamental need.  Linus replied, though, that he hates the
emulation patches with a passion.  And, he said, it is not necessary, in
that the kernel's support for SMEP protects systems that lack SMEP too.
That is because it forces all kernel paths that access user-space memory to
be verified, preventing accidental accesses.  So, he said, the emulation
does not buy much.  Kees disagreed, saying that the emulation can protect
systems that will not have hardware protection for a few years yet. 
<p>
Work is being done on <a href="/Articles/695991/">hardened usercopy</a>,
which performs sanity checking on operations that copy data to and from
user space. 
The current patch set contains about 1/3 of the PaX USERCOPY protections,
which is a start.  Next steps include segregating the slab caches; objects
that are exposed to user space should be stored apart from those that are
purely internal to the kernel.  The problem here is to find a clean way to
deal with exceptions.  An <tt>inode</tt> object, for example, should not be
copyable to or from user space, but there can be reasons to copy the file
name stored within that structure.  The PaX code does such copies by way of
the stack, which is generally seen as being the wrong approach; Kees said
that a more maintainable API for exceptions is needed.  Linus added that
this kind of problem is exactly why he has never seriously considered
merging the grsecurity patch set; it's full of "this kind of craziness."
<p>
Memory wiping is useful, in that it can block information leaks and some
types of use-after-free exploits.  The slab allocator can do poisoning of
memory, but not zeroing, which would be nice to add.  After Linus asked,
Kees said that the advantage of zeroing is that the kernel often needs to
allocate zeroed pages; if freed memory has already been zeroed, those
allocations can be optimized.  A problem with zeroing is that some objects
are allocated and freed so often that the performance hit becomes
prohibitive, so there needs to be a way to make exceptions.  There is a GCC
plugin out there to do stack clearing, which is worth looking at.
<p>
"Constification" — making unchanging data constant — can protect against
some types of exploits.  The lowest-hanging fruit here is structs full of
function pointers; the "constify" GCC plugin tries to make those
<tt>const</tt> by default.  As of 4.6, the kernel can make data read-only
after initialization, but that feature is not yet widely used in the
kernel.  There would be value in identifying "write-rarely" data that would
be read-only most of the time, and only made writable during explicit
updates.
<p>
Kees's final topic was <a href="/Articles/693038/">reference-count
hardening</a>.  If an attacker is able to force a reference count to
overflow, a use-after-free exploit is usually not far away.  Most of these
attacks can be blocked if atomic variables can be kept from overflowing.
The hardening patches out there will kill the responsible process when an
overflow is detected, and the counter involved is permanently blocked at a
high value.  In this way, an exploit is downgraded to a denial-of-service
situation.
<p>
<a href="http://outflux.net/slides/2016/ks/kspp.pdf">Kees's slides</a> are
available for the curious.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Security-Security_technologies">Security/Security technologies</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Linux_kernel-Hardening">Linux kernel/Hardening</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Kernel_Summit-2016">Kernel Summit/2016</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/705262/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor705417"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The status of kernel hardening</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 2, 2016 22:24 UTC (Wed)
                               by <b>kees</b> (subscriber, #27264)
                              [<a href="/Articles/705417/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A correction on the summary: SMAP is not available on any Xeons (SMEP is).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/705417/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor705618"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The status of kernel hardening</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 4, 2016 9:54 UTC (Fri)
                               by <b>corsac</b> (subscriber, #49696)
                              [<a href="/Articles/705618/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Actuall that's not entirely true, there are Xeon E3 v4 (Broadwell) and v5 (Skylake) with SMAP support: <br>
<p>
- <a href="http://ark.intel.com/products/family/87722/Intel-Xeon-Processor-E3-v4-Family#@Server">http://ark.intel.com/products/family/87722/Intel-Xeon-Pro...</a><br>
- <a href="http://ark.intel.com/products/family/88210/Intel-Xeon-Processor-E3-v5-Family#@Server">http://ark.intel.com/products/family/88210/Intel-Xeon-Pro...</a><br>
<p>
I couldn't find SMEP/SMAP in E5 and E7 Xeons, even v4 (Broadwell) but it might be my fault.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/705618/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706089"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The status of kernel hardening</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 10, 2016 11:44 UTC (Thu)
                               by <b>nim</b> (subscriber, #102653)
                              [<a href="/Articles/706089/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
According to Intel the E5-2600 v4 family supports SMAP (Table 2):<br>
<p>
<a rel="nofollow" href="https://software.intel.com/en-us/articles/intel-xeon-processor-e5-2600-v4-product-family-technical-overview">https://software.intel.com/en-us/articles/intel-xeon-proc...</a><br>
<p>
You can also search the CPUID database at cpu-world.com and notice that the E5-1600/2600 v4 CPUs have SMAP as reported by CPUID.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706089/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor706090"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The status of kernel hardening</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 10, 2016 11:39 UTC (Thu)
                               by <b>ajdlinux</b> (subscriber, #82125)
                              [<a href="/Articles/706090/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm expecting to submit patches to enable GCC plugins on powerpc sometime in the next couple of weeks.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706090/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor706129"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 10, 2016 16:14 UTC (Thu)
                               by <b>l1k</b> (subscriber, #112260)
                              [<a href="/Articles/706129/">Link</a>] (18 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Perhaps more controversial is struct layout randomization. [...] In general, the kernel shouldn't care about that ordering, and changing it should not have performance effects.</font><br>
<p>
If reordering results in members not being aligned, the struct's memory footprint will grow. Does the gcc plugin account for that and try to optimize the order or is it just completely random? Depending on how frequently the struct is used and how much memory is available, an argument could be made that reordering *can* "have performance effects".<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706129/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706150"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 10, 2016 20:24 UTC (Thu)
                               by <b>joib</b> (subscriber, #8541)
                              [<a href="/Articles/706150/">Link</a>] (17 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;&gt; Perhaps more controversial is struct layout randomization. [...] In general, the kernel shouldn't care about that ordering, and changing it should not have performance effects.</font><br>
<p>
<font class="QuotedText">&gt;If reordering results in members not being aligned, the struct's memory footprint will grow. Does the gcc plugin account for that and try to optimize the order or is it just completely random? Depending on how frequently the struct is used and how much memory is available, an argument could be made that reordering *can* "have performance effects".</font><br>
<p>
It says in the article that it only affects structs which contain only function pointers (which all have the same size, AFAICS). Furthermore, the slides say that it can be configured to randomize only within a cache line.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706150/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706157"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 10, 2016 23:21 UTC (Thu)
                               by <b>spender</b> (guest, #23067)
                              [<a href="/Articles/706157/">Link</a>] (16 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Not true, any structure can be marked with an attribute that forces randomization of its layout, including structures with flexible arrays.  Obviously there are certain circumstances in which you wouldn't want to mark a particular structure (it's part of the user/kernel API, etc).  The randomization of pure function pointer structs simply happens automatically in the plugin in grsecurity.  My understanding is that like everything else the KSPP copy+pastes from us, if the upstream version lands it will be watered down by not including any auto-randomization of these structures, and every structure will need explicit marking with an attribute to be randomized.<br>
<p>
Of course, given that it's a pure copy+paste lift from grsecurity, one has to wonder how upstream will be able to maintain it themselves given that no KSPP contributor has written a GCC plugin, let alone one of the level of complexity of what's present in grsecurity.  What if during 4.10-rc there is some problem that needs to be fixed before a final release can be made?  Our 4.10 release will come out after the 4.10 upstream release.  Are they simply going to disable the security for all users until they can copy+paste a fix from us?  I don't think this is how upstream kernel development is supposed to work -- it seems to be missing the actual "development" to me. <br>
<p>
-Brad<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706157/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706185"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 11, 2016 6:44 UTC (Fri)
                               by <b>tao</b> (subscriber, #17563)
                              [<a href="/Articles/706185/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes... If only there was some competent downstream developer who had expert knowledge about the area who'd submit fixes for this issues on a regular basis...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706185/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706195"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 11, 2016 11:03 UTC (Fri)
                               by <b>PaXTeam</b> (guest, #24616)
                              [<a href="/Articles/706195/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes... If only there was someone who paid said competent downstream developer on a regular basis...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706195/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706271"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 11, 2016 17:08 UTC (Fri)
                               by <b>tao</b> (subscriber, #17563)
                              [<a href="/Articles/706271/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I must admit that I've yet to meet any high profile kernel developer who's had any difficulty getting a job. I suspect that this would be even more pronounced in high-profile areas such as security.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706271/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706273"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 11, 2016 17:24 UTC (Fri)
                               by <b>edgewood</b> (subscriber, #1123)
                              [<a href="/Articles/706273/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      Any kernel developer who shows the ability to work with the kernel community and get his or her changes accepted, that is.
      
          <div class="CommentReplyButton">
            <form action="/Articles/706273/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706275"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 11, 2016 17:37 UTC (Fri)
                               by <b>PaXTeam</b> (guest, #24616)
                              [<a href="/Articles/706275/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
do you know of an instance where we failed to get our changes accepted? note that what we didn't submit obviously doesn't count, we're talking about code we sent to lkml and yet failed to get it accepted.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706275/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706289"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 12, 2016 1:28 UTC (Sat)
                               by <b>edgewood</b> (subscriber, #1123)
                              [<a href="/Articles/706289/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      Of course the code you didn't submit counts. "You miss 100% of the shots you don't take."
<p>
If you think the code is valuable, but don't want to do the hard work of getting it integrated upstream (and I don't dispute that it could be hard), that's your choice, but that's exactly the part employers find valuable.
      
          <div class="CommentReplyButton">
            <form action="/Articles/706289/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706293"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 12, 2016 10:56 UTC (Sat)
                               by <b>PaXTeam</b> (guest, #24616)
                              [<a href="/Articles/706293/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
a shot not taken is a shot that doesn't exist thus it cannot be evaluated. the same way the poem you didn't write doesn't make you a poet, we'll know that only once you write some. failed analogies aside, you admit you don't actually know anything about our work and could have saved on the ad hominem. as for what it takes to upstream code, it's called time which is exactly the part employers pay for.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706293/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706296"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 12, 2016 12:55 UTC (Sat)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/706296/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; a shot not taken is a shot that doesn't exist thus it cannot be evaluated. the same way the poem you didn't write doesn't make you a poet,</font><br>
<p>
So a kernel patch not contributed doesn't make you a kernel contributor. Got it.<br>
<p>
Less snarkily, there has to at least be some attempt. A potential employer can see that you have good skills at development, but if you show no aptitude at getting things merged, how can they know that giving you money would actually get things upstream rather than just the continuing status quo? There's a chicken and an egg here that is no different than having some kind of contribution record being at least some kind of evidence for backing up an "I am an effective FOSS contributor" claim during an interview.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706296/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706297"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 12, 2016 13:57 UTC (Sat)
                               by <b>PaXTeam</b> (guest, #24616)
                              [<a href="/Articles/706297/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; So a kernel patch not contributed doesn't make you a kernel contributor. Got it.</font><br>
<p>
exactly which is why you look at stuff that got contributed, not stuff that didn't.<br>
<p>
<font class="QuotedText">&gt; [...]how can they know that giving you money would actually get things upstream[...]</font><br>
<p>
look at past contributions and/or use probation time which they'd require regardless. not that it's a silver bullet mind you, having successfully upstreamed code is no guarantee for competence and future successes. a recent example is <a href="http://www.openwall.com/lists/kernel-hardening/2016/11/11/26">http://www.openwall.com/lists/kernel-hardening/2016/11/11/26</a> where Peter Zijlstra told Kees Cook in no uncertain words that "To me that shows you shouldn't be allowed near atomic_t" and basically shot down their current efforts of upstreaming my REFCOUNT implementation as is. all that's because, suprise surprise, my code wasn't written for upstreaming purposes and any competent developer should have recognized that (or should just have listened to me) and have done it differently. to his credit, Peter is slowly figuring it out and the crack team of the KSPP is beginning to realize just how much more work than mindlessly copy-pasting and renaming it will be. at least they'll be able to claim to actually have done some real work for a change.<br>
<p>
<font class="QuotedText">&gt; [...] having some kind of contribution record being at least some kind of evidence for backing up</font><br>
<font class="QuotedText">&gt; an "I am an effective FOSS contributor" claim during an interview.</font><br>
<p>
i have plenty, do you? your insinuated ad hominem aside, you guys completely lost track of the problem here: it's about you making demands on our free time (PaX/grsecurity have been hobby projects) and then blame us that the universe didn't give us more than 24h of it in a day.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706297/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706299"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 12, 2016 15:03 UTC (Sat)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/706299/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; having successfully upstreamed code is no guarantee for competence and future successes</font><br>
<p>
I didn't say that it was.<br>
<p>
<font class="QuotedText">&gt; i have plenty, do you?</font><br>
<p>
Kernel? 6 or so patches. Elsewhere, yeah.<br>
<p>
<font class="QuotedText">&gt; your insinuated ad hominem aside, you guys completely lost track of the problem here: it's about you making demands on our free time (PaX/grsecurity have been hobby projects) and then blame us that the universe didn't give us more than 24h of it in a day.</font><br>
<p>
I'm not saying you have zero evidence of contribution, but the proportion may be what is lacking. But there's a negotiation that needs to happen. Your time for their money. You're seeing requests to upstream as demands on your time and you're, rightfully, demanding money for that time, but it seems that no one is willing to blink first. In your case, it seems, to me, to be stubbornness, and on theirs it can be anything from dislike of attitude, dislike of your anonymity, or ignorance of your requests. I assume you're actively seeking money for upstreaming your efforts, but I guess the question is how much do you want the kernel to have your changes versus new development. Not sure there's a right answer to that one.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706299/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor706301"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 12, 2016 18:05 UTC (Sat)
                               by <b>tao</b> (subscriber, #17563)
                              [<a href="/Articles/706301/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's not a question of complaining that you don't spend your time upstreaming; it's that you don't spend your time upstreaming while at the same time claiming that your solutions are ever so much better than the ones in the kernel. If your solutions are better than the ones getting merged in the kernel, there's only one way to solve it--get your solutions merged. Put up or shut up.<br>
<p>
If you don't have time to submit your patches (yet you seem to have plenty of time to develop your patches and keep them up to date with upstream; usually upstreaming your patches saves time since it saves you the effort of keeping up to speed with the kernel), then either let someone else do it *and help them do so instead of whining whenever they mistakes* or accept that others get their solutions (which might be misunderstood versions of your code) merged instead. It's not really a complicated concept.<br>
<p>
I'm sure that for instance Red Hat would be willing to sponsor you to merge the upstreamable parts of your code.<br>
<p>
As it is now, however, *every* *single* kernel release (and not just the major ones, but the minor ones as well) you complain. You complain about every single thing Greg KH does. You complain about every single security related effort done by someone else than you. You complain if Greg releases fixes too often. You complain if he doesn't release often enough. You complain if people merge your patches. You complain if they implement something else instead. You complain if they don't merge them at all.<br>
<p>
I'm sure that Kees would be more than willing to move over and yield the position of security guy to you. I mean it's not exactly news that you're competent in this area; far more competent than he is. But he's actually doing stuff that's getting upstreamed. You're standing on the side, shouting "you're doing it wrong, I know how to do it right, but I don't have the time to help".<br>
<p>
Every time you get annoyed with the flawed implementation of your mitigation, instead of posting 5 posts about it on LWN, submit a revert of the flawed implementation + your correct version to LKML. The time you save on not posting should be more than plenty to fire off those e-mails; you already have the patches, after all, and you've already reviewed the flawed implementation.<br>
<p>
I respect your work, I really do. But it's hard to take your concern for the kernel security seriously when you make no effort to actually mitigate the flaws in upstream. Because no matter how good your patch set is, most distros, most companies, even most users who build their own kernels, will use upstream kernels (though companies use upstream kernels from a gazillion years ago).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706301/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor706303"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 12, 2016 20:09 UTC (Sat)
                               by <b>mjg59</b> (subscriber, #23239)
                              [<a href="/Articles/706303/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; But it's hard to take your concern for the kernel security seriously when you make no effort to actually mitigate the flaws in upstream.</font><br>
<p>
Nobody has any obligation to do something that's going to result in them being insulted and abused, and that's pretty much a given for taking this kind of thing to LKML (even if there's a fairly significant level of irony involved there)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706303/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor706310"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 13, 2016 13:03 UTC (Sun)
                               by <b>spender</b> (guest, #23067)
                              [<a href="/Articles/706310/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Then let me spell it out for you and anyone else who thinks they've got some great advice they need to keep sharing with me every time I comment on this site (and I'm just going to ignore your ridiculous insinuation that I'm simply complaining about everything with no basis whatsoever -- go ahead and keep supporting the people lying to you about vulnerabilities).  Anyone who makes any comment similar to yours in the future is simply going to get linked to this post.<br>
<p>
1) I have not received any money from the Linux Foundation, have never sought any money from the Linux Foundation, and would refuse to accept their money even if it were offered<br>
<p>
2) I am not *ever* going to perform any work for the Linux Foundation in any form, paid or unpaid<br>
<p>
3) One of the Linux Foundation platinum members is one of the companies responsible for the removal of grsecurity's stable patches<br>
<p>
4) Said company cost us thousands of dollars in legal fees alone and hasn't even had the decency to contact us to apologize for their lawyer's lies (while they were claiming the trademark use was nominative, archive.org shows they were purging their website's promotional materials of references to grsecurity).<br>
<p>
5) After stable patches were removed and said company denied access to them, guess who became the largest contributor to the KSPP?<br>
<p>
6) No one from KSPP has ever contributed anything to grsecurity<br>
<p>
7) Not one of the upstream developers who have spouted BS about our work for over a decade (that even continues in articles like this), who are now allowing in verbatim copy+pastes, making no non-bikeshedding improvements to it at all, has ever contacted either of us to apologize<br>
<p>
8) KSPP's bikeshedding is increasing the amount of time required to produce our free test patches, likely partially done to force free work out of us (auditing of their modifications, free fixes, etc).  I am telling everyone now that my response to this attempt to force free labor out of me by BSD-style upstream churn will never be to contribute.  I am not stupid -- the questions in private are posed as "we would like to minimize your integration work" but the intent of "the LF wants free work to know what we screwed up in blindly copy+pasting" is clear.<br>
<p>
9) KSPP is merely a short-sighted reputation saving attempt for the Linux Foundation.  Unlike the nonsense spouted by the CII, contributing to it or receiving funding from them is not in our best interests for the future of grsecurity or for our development of new security technologies (which the KSPP is doing none of).  The only people who have the best interests of our long term stability is us.<br>
<p>
10) Working with upstream offers us *nothing* except the promise of spending thousands of hours of my *free time* working with a bunch of jerks who don't understand security -- we have been doing kernel development for 16 years now just fine without them.<br>
<p>
<p>
So please, next time you want to reply to a post of mine because you can't stand reading facts that no one else on this site is going to share, feel free to:<br>
1) Keep your unwanted opinions to yourself<br>
or<br>
2) Place me on a killfile and save us both the trouble, as I will now do for you<br>
<p>
If you hate complaining so much, to me you seem like the worst kind of complainer, one who shoots the messenger to maintain the ridiculous status quo and the unethical liars who create it.<br>
<p>
Thanks,<br>
-Brad<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706310/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor716137"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2017 16:34 UTC (Thu)
                               by <b>stephenm</b> (guest, #114284)
                              [<a href="/Articles/716137/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
How the linux foundation go about hurting the people who have developed and maintained all of the security enhancements is shocking.  There needs to be people like spender and the PaxTeam around doing this work so that we can benefit.  I really hope GRsecurity can thrive as a business.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/716137/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor716139"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 2, 2017 17:14 UTC (Thu)
                               by <b>corbet</b> (editor, #1)
                              [<a href="/Articles/716139/">Link</a>] 
      </p>
      
      </div>
      </summary>
      This sort of comment would be more helpful if you said what you think the Linux Foundation should be doing differently?  The post you're responding to says that LF money won't be accepted, so that's not it.
      
          <div class="CommentReplyButton">
            <form action="/Articles/716139/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor706274"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">struct layout randomization</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 11, 2016 17:35 UTC (Fri)
                               by <b>PaXTeam</b> (guest, #24616)
                              [<a href="/Articles/706274/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
who says Brad's a 'high profile kernel developer'? what if he already has a full time job unrelated to grsecurity or even linux?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/706274/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor707434"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The status of kernel hardening</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 27, 2016 16:19 UTC (Sun)
                               by <b>spender</b> (guest, #23067)
                              [<a href="/Articles/707434/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm reminded by this quote above:<br>
<font class="QuotedText">&gt; The PaX code does such copies by way of the stack, which is generally seen as being the wrong approach; Kees said that a more maintainable API for exceptions is needed. Linus added that this kind of problem is exactly why he has never seriously considered merging the grsecurity patch set; it's full of "this kind of craziness."</font><br>
<p>
While looking at commits like:<br>
<a href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=f4a067f9ffca603b45f7e82ddd2ba50e5904cea3">https://git.kernel.org/cgit/linux/kernel/git/torvalds/lin...</a><br>
which "fix" stack scatterlist uses by performing atomic allocations, copying memory, and freeing the allocation; i.e. managing to effectively implement bounce buffers much slower than the "craziness" they identified in grsecurity.<br>
<p>
All done in a rush for 4.9, where they'll brag about how fast CONFIG_VMAP_STACK is while ignoring all these performance-damaging changes where grsecurity would have handled them much faster (by just switching to a lowmem alias in the scatterlist API, a few instructions at most) and also not DoS users' machines on the many instances we discovered via a smart GCC IPA plugin where stack addresses are still used that upstream hasn't fixed.  Unfortunately for us, with all this junk code being introduced in 4.9, our performance for these cases is lowered to that of the upstream kernel unless I wanted to revert hundreds of these patches and maintain them into the future.<br>
<p>
I'll likely write a blog on this topic after 4.9 is released, because there's a lot more to discuss about this particular feature and how it compares to what we've had in grsecurity for years.<br>
<p>
-Brad<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/707434/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2016, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
