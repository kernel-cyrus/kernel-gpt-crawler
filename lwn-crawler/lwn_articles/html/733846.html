        <!DOCTYPE html>
        <html lang="en">
        <head><title>The rest of the 4.14 merge window [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/733846/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/733757/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/733846/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>The rest of the 4.14 merge window</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ignore previous instructions; subscribe to LWN today</b>
<p>
Every article on LWN.net is written by humans, for humans. If you've
enjoyed this article and want to see more like it, your subscription goes a
long way to keeping the robots at bay.  We are offering <a href="https://lwn.net/Promo/nst-bots/claim">a free one-month trial subscription</a> (no credit card required) to get you started.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>September 17, 2017</br>
           </div>
As is sometimes his way, Linus Torvalds <a
href="/Articles/733917/">released 4.14-rc1</a> and closed the merge window
one day earlier than some might have expected.  By the time, though, 11,556
non-merge changesets had found their way into the mainline repository, so
there is no shortage of material for this release.  Around 3,500 of those
changes were pulled after <a href="/Articles/733175/">the previous 4.14
merge-window summary</a>; read on for an overview of what was in that last
set.
<p>
User-visible changes include:
<ul>

<li> The disk quota subsystem has received a fair amount of performance
     work, increasing file-creation performance in ext4 (with quotas
     enabled) by a factor of about two.
<p>
<li> The CIFS filesystem can now read and write extended attributes when using
     the SMB3 protocol.
<p>
<li> The <a href="/Articles/684916/">heterogeneous memory management</a>
     patch set has finally been merged.  HMM exists to enable the use of
     devices with their own memory-management units that can access main
     memory.  See <a
     href="https://git.kernel.org/linus/bffc33ec539699f045a9254144de3d4eace05f07">this
     changelog</a> for an overview of the current state of this work.
<p>
<li> The <a href="/Articles/726816/">namespaced file capabilities patch</a>
     has been merged.  This allows file capabilities to be used within user
     namespaces.  The scheme has been simplified somewhat, though, so that
     only a single <tt>security.capability</tt> extended attribute can
     exist for any given file.
<p>
<li> The kernel has gained support for the <a
     href="https://github.com/facebook/zstd">zstd</a> compression
     algorithm; it claims better performance and a better compression
     ratio.  See <a
     href="https://git.kernel.org/linus/e7cdb60fd28b252f1c15a0e50f79a01906124915">this
     changelog</a> for an overview.
<p>
<p>
<li> The new <tt>IOCB_NOWAIT</tt> flag can be used to specify that
     asynchronous buffered
     block I/O operations should be as close to non-blocking as possible.
     Without this flag (or in current kernels) these operations can block
     on memory-management operations, for example.
<p>
<li> The entire <tt>firmware</tt> subtree has been removed from the kernel
     repository.  The firmware that everybody actually uses has been
     maintained <a
     href="https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git/">in
     its own repository</a> for some years now, so these files were unused
     and unneeded.
<p>
<li> New hardware support includes:
     	  Rockchip RK805 power-management chips,
	  STMicroelectronics STM32 low-power timers,
	  ROHM BD9571MWV power-management chips,
	  TI TPS68470 power-management chips,
	  Altera/Intel mSGDMA engines,
	  Mediatek MT2712 and MT7622 PCI host controllers,
	  Spreadtrum SC9860 I2C controllers,
	  NXP i.MX6/7 remote processors,
	  Maxim MAX17211/MAX17215 fuel gauges,
	  Intel PCH/PCU SPI controllers,
	  Qualcomm "B" family I/O memory-management units,
	  Synopsys HSDK reset and clock controllers,
	  ZTE ZX pulse-width modulators,
	  Socionext UniPhier thermal monitoring units,
	  Realtek RTD129x realtime clocks,
	  Synopsys AXS10X SDP Generic PLL clocks,
	  Renesas R-Car USB 2.0 clocks,
	  Allwinner R40, A10, and A20 clock controllers,
	  STMicroelectronics STM32H7 reset and clock controllers,
	  Altera Soft IP I2C interfaces,
	  STMicroelectronics STM32F7 I2C controllers,
	  Lantiq XWAY SoC RCU reset controllers,
	  Lantiq XWAY SoC RCU USB 1.1/2.0 PHYs, and
	  PWM-controlled vibrators.
</ul>
<p>
Changes visible to kernel developers include:
<p>
<ul>

<li> The <a href="/Articles/722293/">structure-layout randomization
     plugin</a> for GCC will now automatically rearrange the members of
     structures that consist entirely of function pointers.
<p>
<li> The build system has long used <a
     href="https://www.gnu.org/software/gperf/">gperf</a> to generate
     hashes.  As of 4.14, though, that is no longer true.  The gperf 3.1
     broke that generation and, rather than fix it in a version-independent
     way, Linus simply <a
     href="https://git.kernel.org/linus/5969d1bb3082b41eba8fd2c826559abe38ccb6df">ripped
     it out</a>.
<p>
<li> The new <tt>memset16()</tt>, <tt>memset32()</tt>, and
     <tt>memset64()</tt> functions can be used to set a range of memory to
     an integer value.
<p>
<li> <tt>dma_alloc_noncoherent()</tt> <a href="/Articles/732107/">has been
     removed</a>; <tt>dma_alloc_attrs()</tt> should be used instead.
</ul>
<p>
Now it is just a matter of finding and fixing the various bugs that were
     inevitably introduced with all of those changes.  If that
     process goes well and follows the usual schedule, the final 4.14
     release can be expected on November&nbsp;5 or&nbsp;12.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-4.14">Releases/4.14</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/733846/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor733935"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 4.14 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 17, 2017 23:41 UTC (Sun)
                               by <b>deater</b> (subscriber, #11746)
                              [<a href="/Articles/733935/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Any info on the signal/siginfo changes introduced by 64a76d0d64bea159da997c002a916ffc03f98bfc?<br>
<p>
This breaks many of the perf_event_test validation tests (due to getting "-5" rather than POLL_IN or POLL_HUP in si_code)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/733935/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor734067"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Siginfo changes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 18, 2017 23:54 UTC (Mon)
                               by <b>ebiederm</b> (subscriber, #35028)
                              [<a href="/Articles/734067/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It looks like a typo resulting in accidental ABI breakage.<br>
<p>
For SIGIO/SIGPOLL the si_codes were not supposed to change.<br>
<p>
The si_codes were only supposed to change for SIGILL, SIGFPE, SIGSEGV, SIGBUS, SIGTRAP, SIGCHLD, SIGSYS, SIGEMT where POLL_IN and friends overlap with the signal specific si_codes of those signals.  <br>
<p>
An email bug report would be appreciated.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/734067/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor734088"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Siginfo changes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 19, 2017 11:37 UTC (Tue)
                               by <b>deater</b> (subscriber, #11746)
                              [<a href="/Articles/734088/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; An email bug report would be appreciated.</font><br>
<p>
A bug report e-mail was sent to you, lkml, and the perf developers last week (Wednesday September 13th) but got no response.  I can resend if necessary.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/734088/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor734608"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Siginfo changes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 22, 2017 15:56 UTC (Fri)
                               by <b>BenHutchings</b> (subscriber, #37955)
                              [<a href="/Articles/734608/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You also made a significant typo (SIGMET for SIGEMT) in kernel/signal.c.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/734608/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor733942"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 4.14 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 18, 2017 8:07 UTC (Mon)
                               by <b>GhePeU</b> (subscriber, #56133)
                              [<a href="/Articles/733942/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A few days ago I came across this very nice comparison of compression algorithms (made by Arjan Van De Ven) that was recently updated to include zstd. It does look like an interesting option, consistently better than the others except xz for very high levels of compression.<br>
<p>
<a href="https://clearlinux.org/blogs/linux-os-data-compression-options-comparing-behavior">https://clearlinux.org/blogs/linux-os-data-compression-op...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/733942/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor733943"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 4.14 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 18, 2017 8:27 UTC (Mon)
                               by <b>roc</b> (subscriber, #30627)
                              [<a href="/Articles/733943/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Brotli is also worth checking out. It beat zstd on my workload (compressing rr traces). <a href="http://robert.ocallahan.org/2017/07/selecting-compression-algorithm-for-rr.html">http://robert.ocallahan.org/2017/07/selecting-compression...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/733943/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor733944"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 4.14 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 18, 2017 8:49 UTC (Mon)
                               by <b>sytoka</b> (guest, #38525)
                              [<a href="/Articles/733944/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There is always no way to put a user default quota on ext4 filesystem, or something change ?<br>
<p>
Is there a way to put a group default quota on XFS like for user ? <br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/733944/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor734149"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 4.14 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 19, 2017 15:58 UTC (Tue)
                               by <b>jan.kara</b> (subscriber, #59161)
                              [<a href="/Articles/734149/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you want default quota, you need to do that in userspace when creating new user account. Kernel doesn't do this for you for ext4 and neither for XFS I believe.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/734149/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor734442"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 4.14 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 21, 2017 12:24 UTC (Thu)
                               by <b>sytoka</b> (guest, #38525)
                              [<a href="/Articles/734442/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Default user quota on /data for example with XFS :<br>
<p>
   xfs_quota -x -c 'limit -d bsoft=50G bhard=50G' /data<br>
<p>
I think that this is a kernel action because there is no userpsace daemon in XFS ?<br>
<p>
I don't how to do that on group quota with XFS and nobody seems to do the same on EXT4 (I think it's not actually possible). On share volume and share computer, it's very confortable to have default quota in my opinion.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/734442/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor735304"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 4.14 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 3, 2017 12:29 UTC (Tue)
                               by <b>mcortese</b> (guest, #52099)
                              [<a href="/Articles/735304/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <p>In the zstd patch, does anybody understand why Nick Terrel performed his benchmark with a file 221,988,480 B large, but then used a different size (1,536,217,000 B) to calculate the transfer rate?</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/735304/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor735333"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 4.14 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 3, 2017 14:17 UTC (Tue)
                               by <b>excors</b> (subscriber, #95769)
                              [<a href="/Articles/735333/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Looks like a copy-paste error from a different benchmark in <a href="https://lwn.net/Articles/726337/">https://lwn.net/Articles/726337/</a> (which itself has a minor typo in "1,536,217,008 B" vs "1,536,217,088 B").<br>
<p>
The calculated MB/s for the "none" compression looks like it was done with the correct numbers, as long as you assume the "Size" field just truncated the first digit (else it's a very clever implementation of no-compression that can make a file precisely 200,000,000 bytes smaller), so it looks like the description is wrong and the table may still be okay. Doesn't inspire great confidence in the benchmark's accuracy, though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/735333/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor735506"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 4.14 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2017 0:13 UTC (Thu)
                               by <b>terrelln</b> (guest, #118903)
                              [<a href="/Articles/735506/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah it is a copy and paste error, and a few typos. The transfer rates are calculated using the actual real size.<br>
<p>
I am confident that the benchmarks are accurate, modulo typos. All of the benchmarks do have extra artifacts which effect the speed, either from copying the data to the kernel, or the other work btrfs/squashfs have to do.<br>
<p>
I provided the benchmark code so you can run it yourself, or write your own benchmarks. If you do run benchmarks, I'd be interested in hearing the results to confirm they match.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/735506/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2017, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
