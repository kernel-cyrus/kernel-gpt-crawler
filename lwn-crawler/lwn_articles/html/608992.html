        <!DOCTYPE html>
        <html lang="en">
        <head><title>One year of Coverity work [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/608992/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/608617/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/608992/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>One year of Coverity work</h1>
</div>
<div class="ArticleText">
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>August 20, 2014</br>
           <hr>
<a href="/Articles/KernelSummit2014/">Kernel Summit 2014</a>
</div>
For the last year, Dave Jones has been working with the <a
href="https://scan.coverity.com/">Coverity scanner</a> to 
identify and fix possible bugs in the kernel.  Like many developers, he
worried that things could get worse over time; with all the code that is
going into the kernel, there must be a lot of defects coming in as well.  But
the actual news turns out to be a bit better than that.
<p>
What Dave feeds to Coverity is a "kitchen-sink build" with almost
everything enabled.  Where there is a configuration choice to be made, he
tries to choose like a distributor would.  The end result is that the
kernel he builds has some 6,955 options selected.  Running the scanner on
this kernel 
takes several hours.  Indeed, Dave has been keeping Coverity busy enough
that the company eventually set up a dedicated server for kernel runs, enabling
him to do two or three runs each day.
<p>
When Dave ran a scan of the 3.11 kernel, he ended up with a "defect
density" of 0.68 per thousand lines of code — somewhat above the company's
"open-source average" of 0.59.  The results since then look like this:
<p>
<blockquote>
<table cellpadding=3>
<tr><th>Kernel</th><th>Defect<br>density</th></tr>

<tr class="Odd"><td>3.11</td><td>0.68</td></tr>
<tr class="Even"><td>3.12</td><td>0.62</td></tr>
<tr class="Odd"><td>3.13</td><td>0.59</td></tr>
<tr class="Even"><td>3.14</td><td>0.55</td></tr>
<tr class="Odd"><td>3.15</td><td>0.55</td></tr>
<tr class="Even"><td>3.16</td><td>0.53</td></tr>
</table>
</blockquote>
<p><blockquote class="ad">
<b><tt>$ sudo subscribe today</tt></b>
<p>
Subscribe today and elevate your LWN privileges. You’ll have
access to all of LWN’s high-quality articles as soon as they’re
published, and help support LWN in the process.  <a href="https://lwn.net/Promo/nst-sudo/claim">Act now</a> and you can start with a free trial subscription.
</blockquote>
<p>
The current defect density, after the closing of the 3.17 merge window, is
0.52.  So things have consistently gotten better over time.
<p>
He has put together <a
href="http://codemonkey.org.uk/2014/08/14/linux-kernel-coverity-scan-hot-areas/">a
ranking</a> of the areas in the kernel with the most defects.  At the top
of the list is the staging tree.  That, he said, is good; if any other
subsystem were worse than staging, that would indicate a real problem.
Most of the other entries in the list were in the driver tree, which is not
surprising; that is where most of the code is.
<p>
The biggest single issue raised by Coverity, he said, was dead code.
Sometimes the warning makes sense, but it is not always correct.  Some code
will be unreachable due to configuration choices, for example.  Second on
the list was a failure to check return values; that, too, may or may not be
a real bug, depending on the situation.  The third item on the list —
checking for a null pointer after the pointer has already been dereferenced
— is clearly bad news and needs to be fixed.
<p>
Also scary are the static buffer overrun errors.  These can be "nasty," and
there are too many of them, though the situation is getting better.  These,
too, are not always bugs; the networking layer, for example, performs

<a href="/Articles/609000/"><img
src="https://static.lwn.net/images/conf/2014/ks/DaveJones-sm.jpg" width=150 height=188
alt="[Dave Jones]" title="Dave Jones" hspace=3 vspace=3
align="right"></a> 


tricks with its <tt>skb</tt> data structures that look like buffer overruns
but in reality are not.  Coverity also flags a large number of resource
leaks; unsurprisingly, these are usually found in error paths.
<p>
There are numerous other classes of potential errors.  Some of them, such
as "statement with no effect," tend to be harmless and may well be
intentional.  For example, assigning a variable to itself has no effect,
but it was evidently an effective way of shutting down "possibly
uninitialized" warnings from the compiler in the past.  Others, like
unchecked use of data from user space, can be more serious; in this case,
most of the offending uses are behind capability checks and are thus not
immediately exploitable.
<p>
The good news, Dave said, is that there are now less than 50 use-after-free
errors flagged in the kernel.  Various other classes of "dumb" errors have
been nearly eliminated from the kernel as well.  Dave said he keeps a close
eye on those; when one pops up in a new kernel, he tries to get it fixed
quickly. 
<p>
Ted Ts'o asked how many of the issues flagged by Coverity are real bugs.
Dave's feeling is that only a small minority of the reports indicate
serious bugs.  If one is interested in security issues, he said, the <a
href="/Articles/536173/">Trinity</a> fuzz tester has found more of them
than Coverity has. 
<p>
What about ARM coverage?  The commercial Coverity product has it, but the
free version for the open source community does not.  In truth, Dave said,
if the code can be made to compile on an x86 compiler, Coverity will scan
it.  So he has pondered approaches like commenting out all of the inline
assembly in the ARM tree and scanning the result.  That is a project for
the future, though.
<p>
Other developers can have a look at the Coverity results if they want to
help to fix the reported problems.  It's a matter of going to <a
href="http://scan.coverity.com">scan.coverity.com</a> and signing up for
the "Linux" project.  Then drop a note to Dave, and he will
approve access to the results.  As is usually the case, more eyes on these
results should lead to a better kernel in the long run.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_tools-Static_analysis">Development tools/Static analysis</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Kernel_Summit-2014">Kernel Summit/2014</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/608992/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor609093"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">One year of Coverity work</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 21, 2014 2:34 UTC (Thu)
                               by <b>agelastic</b> (guest, #96282)
                              [<a href="/Articles/609093/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It's a matter of going to scan.coverity.com and signing up for the "Linux" project. Then drop a note to Dave, and he will approve access to the results</font><br>
<p>
I admit I'm far from being a core kernel developer but I do work in security. I've sent a request to get access to Coverity scan results and was sent away "because the results are sensitive."<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/609093/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor609222"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">One year of Coverity work</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 22, 2014 6:37 UTC (Fri)
                               by <b>lkundrak</b> (subscriber, #43452)
                              [<a href="/Articles/609222/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm not sure why would this happen. Coverity is free for free software projects; you could easily build and upload Linux kernel tree there for analysis yourself.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/609222/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor609223"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">One year of Coverity work</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 22, 2014 6:43 UTC (Fri)
                               by <b>agelastic</b> (guest, #96282)
                              [<a href="/Articles/609223/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; you could easily build and upload Linux kernel tree there for analysis yourself.</font><br>
<p>
False.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/609223/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor609267"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">One year of Coverity work</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 22, 2014 14:28 UTC (Fri)
                               by <b>etienne</b> (guest, #25256)
                              [<a href="/Articles/609267/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; For example, assigning a variable to itself has no effect</font><br>
<p>
I know some developers see that has bad practice, but I use it to attract attention about a variable - when that variable is initialized and used in only some code-path.<br>
<p>
The "design pattern" is basically:<br>
void fct(...) {<br>
 int var = var;<br>
 if (test1) var = 42;<br>
 some_common_function();<br>
 if (test2) anotherfct (var);<br>
}<br>
<p>
The point is that you shall never use the variable "var" without initializing it, but in this case the compiler will not check for you - "var = var;" is just a "take care" indication to the reader and not a real initialisation.<br>
The other point is that it is not logical to always initialize "var" to a dummy value - there may not be any dummy value available, and usually it would be an error to use that dummy value considering the algorithm.<br>
So when a maintainer see "int var = var;", he will know that "test2" has to be either identical to "test1", or more restrictive than "test1".<br>
I have see too many bug created by bug-fixes applied to just "test1"...<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/609267/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor609297"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">One year of Coverity work</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 22, 2014 17:18 UTC (Fri)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/609297/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
it is not logical to always initialize "var" to a dummy value - there may not be any dummy value available, and usually it would be an error to use that dummy value considering the algorithm.
</blockquote>
<p>
A more fundamental reason not to initialize "var" to a dummy value is that it makes the code harder to read.  It makes it look like that dummy value is a legitimate value for "var" (after all, it is common for people to cram multiple pieces of information into a variable, so "-1" isn't necessarily a dummy value for a variable named "length").  And it makes it look like "var" is meaningful in the code before it is <em>really</em> set.  And that makes it much harder for a reader of the code to detect true used-before-set bugs.

      
          <div class="CommentReplyButton">
            <form action="/Articles/609297/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor609320"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">One year of Coverity work</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 22, 2014 20:46 UTC (Fri)
                               by <b>etienne</b> (guest, #25256)
                              [<a href="/Articles/609320/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Self initialized variables are surely harder to read - but that is the point: for someone trying to understand (and maybe modify) the source code, that trick tell them to double check everything about its use.<br>
It is obviouly a error to use the value of a self-initialized variable, maybe one day the compiler will flag an error in such case, either at compile time or at run time.<br>
What I need in the algorithm is a "poisonous" value (doesn't exists in C) or a memory area reservation but no visibility at that level (and in the stack, doesn't exists in C).<br>
Myself, if I have a quick bug to correct and I see the obvious test to modify, I will do the change quite quickly; if I see a self initialised variable I will look for the design pattern I was talking of.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/609320/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor609323"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">One year of Coverity work</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 22, 2014 20:50 UTC (Fri)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/609323/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
When I see a self-initialized variable, I think "bug", not "here there be dragons". Make your assumptions explicit with a comment please.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/609323/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor609407"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">One year of Coverity work</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 24, 2014 7:24 UTC (Sun)
                               by <b>johill</b> (subscriber, #25196)
                              [<a href="/Articles/609407/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Additionally, if you *don't* initialize the variable then the compiler will be able to warn you if you later create a code path where you forgot...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/609407/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor610031"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">One year of Coverity work</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 31, 2014 12:11 UTC (Sun)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/610031/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Okay, user-space code, but when I set coding standards at a company, the rule was "all warnings must be explained away".<br>
<p>
The reason was precisely that - we had certain code (where we called a commercial library that then called-back our code) that we just couldn't suppress all warnings.<br>
<p>
Sometimes you end up between a rock and a hard place, and things like "var = var" are an easy escape route...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/610031/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2014, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
