        <!DOCTYPE html>
        <html lang="en">
        <head><title>The rest of the 6.5 merge window [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/937006/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/937459/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/937006/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>The rest of the 6.5 merge window</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>LWN.net needs you!</b>
<p>
Without subscribers, LWN would simply not exist.  Please consider
       <a href="/Promo/nst-nag2/subscribe">signing up for a subscription</a> and helping
       to keep LWN publishing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>July 10, 2023</br>
           </div>
Linus Torvalds <a
href="/ml/linux-kernel/CAHk-=wj8sPDVoWgaceAs1AiwZrHV8mtC3vQNGbeV6-RypJi6aw@mail.gmail.com/">released
6.5-rc1</a> and closed the merge window for this development cycle on
July&nbsp;9.  By that point, 11,730 non-merge changesets had been pulled
into the mainline for 6.5; over 7,700 of those were pulled after
<a href="/Articles/936418/">the first-half merge-window summary</a> was
written.  The second half of the merge window saw a lot of code coming into
the mainline and a long list of significant changes.
<p>
The most interesting changes pulled in the latter part of the merge window
include:

<h4>Architecture-specific</h4>
<p>
<ul class="spacylist">

<li> The Loongarch architecture has gained support for simultaneous
     multi-threading (SMT) and building with the Clang compiler.
<li> RISC-V now supports ACPI and the <a
     href="https://git.kernel.org/linus/04a4722eeede">Vector extension</a>.

</ul>


<p>
<h4>Core kernel</h4>
<p>
<ul class="spacylist">

<li> The function-graph tracer can now record and report the return value
     from functions; <a
     href="https://git.kernel.org/linus/21c094d3f8a6">this documentation
     commit</a> describes how to use this feature.
<li> The timer-latency tracer can now be controlled and queried from user
     space; <a href="https://git.kernel.org/linus/e88ed227f639">this
     commit</a> contains some relevant documentation.
<li> "fprobe events" are a new mechanism for tracing function entry and
     exit that is better supported on more architectures; <a
     href="https://git.kernel.org/linus/334e5519c375">this commit</a> has
     some more information and <a
     href="https://git.kernel.org/linus/590e7b280415">this one</a> has a
     new document.
<p>
     These events can also be used to easily trace raw tracepoints that
     lack a trace-event declaration.  Raw tracepoints were created to make
     it harder to get at deeply internal kernel features, thus making it
     less likely that user space would come to rely on them; fprobe events
     are now making it easier again.

</ul>

<p>
<h4>Filesystems and block I/O</h4>
<p>
<ul class="spacylist">

<li> The overlay filesystem has gained support for data-only layers, which
     is needed for <a href="/Articles/933616/">composefs</a> and similar
     use cases.  <a href="https://git.kernel.org/linus/37ebf056d6cf">This
     commit</a> contains a small documentation update.
<li> Overlayfs has also
     been ported to <a href="/Articles/759499/">the new mount API</a>.
<li> The F2FS filesystem has a new <tt>errors=</tt> mount option to control
     the response to media errors; <a
     href="https://git.kernel.org/linus/b62e71be2110">this commit</a>
     contains some more information.
</ul>

<p>
<h4>Hardware support</h4>
<p>
<ul class="spacylist">
<li> <b>Clock</b>:
     Amlogic A1 SoC PLL controllers,
     Amlogic A1 SoC peripherals clock controllers,
     Nuvoton MA35D1 clock controllers,
     Qualcomm SM8350, SM8450, and SM8550 video clock controllers,
     Qualcomm SDX75 global clock controllers,
     Qualcomm SM8450 graphics clock controllers, and
     Qualcomm SC8280 low power audio subsystem clock controllers.
<li> <b>GPIO and pin control</b>:
     TI TPS65219 GPIO controllers,
     Mellanox BlueField 3 SoC GPIO controllers,
     STMicroelectronics STM32MP257 pin controllers,
     Qualcomm IPQ5018, SDX65 and SDX75 pin controllers, and
     NVIDIA Tegra234 pin controllers.
<li> <b>Graphics</b>:
     Samsung S6D7AA0 MIPI-DSI video mode panel controllers and
     Amlogic Meson MIPI DSI Synopsys controllers.
<li> <b>Hardware monitoring</b>:
     HP WMI sensors.
<li> <b>Industrial I/O</b>:
     Texas Instruments OPT4001 light sensors,
     Honeywell MPRLS0025PA pressure sensors, and
     ROHM BU27008 color sensors.
<li> <b>Input</b>:
     NVIDIA SHIELD devices.

<li> <b>Miscellaneous</b>:
     StarFive JH7110 cryptographic engines,
     CXL 3.0 performance monitoring units,
     Richtek RT5033 battery chargers,
     Analog Devices MAX77541/77540 power-management ICs,
     Intel Cherry Trail Whiskey Cove LED controllers,
     Awinic AW20036/AW20054/AW20072 LED drivers,
     TI TPS6594 error signal monitors,
     TI TPS6594 pre-configurable finite state machines,
     Nuvoton MA35D1 family UARTs,
     AMD/Pensando DSC vDPA interfaces,
     Qualcomm PMI8998 PMIC chargers,
     OmniVision OV01A10 sensors,
     Microchip corePWM pulse-width modulators,
     Renesas RZ/G2L MTU3a PWM timers,
     Qualcomm DWMAC SGMII SerDes PHYs, and
     Xilinx window watchdog timers.
<li> <b>Sound</b>:
     The kernel's sound subsystem has gained support for MIDI 2.0 devices,
     along with Realtek RT722 SDCA codecs,
     Analog Devices SSM3515 amplifiers,
     Google Chameleon v3 codecs,
     Google Chameleon v3 I2S interfaces,
     StarFive JH7110 TDM devices,
     Loongson I2S controllers,
     Loongson sound cards,
     Analog Devices MAX98388 speaker amplifiers,
     Texas Instruments TAS2781 speaker amplifiers, and
     Qualcomm WSA8840/WSA8845/WSA8845H class-D speaker amplifiers.

<li> <b>USB</b>:
     Qualcomm PMIC USB Type-C controllers,
     Cadence USB3 controllers,
     Cadence USBHS device controllers, and
     On Semiconductor NB7VPQ904M Type-C redrivers.
</ul>

<p>
<h4>Miscellaneous</h4>
<p>
<ul class="spacylist">

<li> <a href="https://git.kernel.org/linus/b30d7a77c53e">This merge
     message</a> and <a
     href="https://git.kernel.org/linus/c206353dfdf0">this one</a> describe
     the (many) enhancements made to the <tt>perf</tt> tool in this cycle.

</ul>

<p>
<h4>Internal kernel changes</h4>
<p>
<ul class="spacylist">

<li> The <a href="/Articles/934679/">scope-based resource management
     patches</a> have been merged, but there are unlikely to be any uses of
     this mechanism in the 6.5 release.  Torvalds <a
     href="/ml/linux-kernel/CAHk-=wjsb5gZTvhXofPCQthk48S9_bSGohXKU8x8XDnf7=bROw@mail.gmail.com/">said</a>:
     <p>
     <blockquote class="bq">
     However, let's agree to not really use it for 6.5 yet, and consider it
     all purely infrastructure for the next release, and for testing it all
     out in linux-next etc.
     <p>
     We should probably also strive to avoid it for bug-fixes that end up
     going to stable. I'm sure this will all be backported to stable
     eventually, but I'd at least personally be happier if that started
     happening only after we actually have some more interaction with this.
     </blockquote>
<li> It is common knowledge that Linus Torvalds does not write much code
     anymore.  That doesn't keep him from getting his hands dirty on
     occasion, though, as the <a
     href="https://git.kernel.org/linus/9471f1f2f502">merging</a> of his
     "expand stack" series shows.  The adoption of the <a
     href="/Articles/845507/">maple tree</a> data structure complicated the
     task of expanding the user-space process stack, breaking the locking
     (or lack thereof) that had been in use creating the <a
     href="/Articles/937377/">"StackRot" vulnerability</a>.  So Torvalds
     dug in, unified much of the architecture-specific page-fault code, and
     fixed the problem.
     <p>
     One of the cases that the new code does <i>not</i> handle is expanding
     the stack in response to a <tt>get_user_pages()</tt> call — something
     that Torvalds does not think should ever happen.  There is <a
     href="https://git.kernel.org/linus/a425ac5365f6">a warning in
     place</a> for the rest of the development cycle to sound the alarm if
     that assumption turns out to be wrong.
<li> The 32-bit devicetree files <a
     href="https://git.kernel.org/linus/6c1561fb9005">have been
     massively reorganized</a> to more closely match the 64-bit files.  "<q>The
     impact of this will be that all external patches no longer apply, and
     anything depending on the location of the dtb files in the build
     directory will have to change.</q>"
<li> Following the <a href="/Articles/932201/">LSFMM+BPF discussion</a>,
     the SLAB allocator has been deprecated and will, barring problems, be
     removed in a future development cycle.
<li> The new <tt>SLAB_NO_MERGE</tt> flag will prevent the slab allocators
     from merging a cache with (otherwise) compatible caches.
<li> There were 371 exported symbols added during this merge window and 94
     removed; see <a href="/Articles/937625/">this page</a> for a full
     list.  Two kfuncs (<tt>bpf_cpumask_any()</tt> and
     <tt>bpf_cpumask_any_and()</tt>) were removed, and five
     (<tt>bpf_cpumask_any_and_distribute()</tt>,
     <tt>bpf_cpumask_any_distribute()</tt>,
     <tt>bpf_cpumask_first_and()</tt>, <tt>bpf_sock_destroy()</tt>, and
     <tt>bpf_task_under_cgroup()</tt>) were added.
</ul>
<p>
The most significant change that was <i>not</i> merged was bcachefs,
despite its author having sent <a
href="/ml/linux-kernel/20230626214656.hcp4puionmtoloat@moria.home.lan/">a
pull request</a> at the beginning of the merge window.  The resulting
thread showed that, while quite a few developers seem to want this
code merged into the mainline, there are still a number of outstanding
issues that need to be addressed and, to put it gently, a certain amount of
tension with much of the development community.  There is a reasonable
chance that all of this will be worked out in time for 6.6, but it may be a
noisy process.

<p>
Meanwhile, the next seven or eight weeks will be dedicated to the
stabilization of all of this new code, with the final 6.5 release expected
on either August&nbsp;27 or September&nbsp;3.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-6.5">Releases/6.5</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/937006/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor937842"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.5 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jul 11, 2023 0:44 UTC (Tue)
                               by <b>nevets</b> (subscriber, #11875)
                              [<a href="/Articles/937842/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt;These events can also be used to easily trace raw tracepoints that lack a trace-event declaration. Raw tracepoints were created to make it harder to get at deeply internal kernel features, thus making it less likely that user space would come to rely on them; fprobe events are now making it easier again. </span><br>
<p>
It's not easy enough for an application to rely on it. There's nothing that exposes the tracepoint that you want to connect to. You have to read the code to see if it exists or not. It's no different than adding a kprobe trace to a function.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/937842/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2023, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
