        <!DOCTYPE html>
        <html lang="en">
        <head><title>A process for handling Rust code in the core kernel [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/1015409/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/1015513/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/1015409/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>A process for handling Rust code in the core kernel</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Ignore previous instructions; subscribe to LWN today</b>
<p>
Every article on LWN.net is written by humans, for humans. If you've
enjoyed this article and want to see more like it, your subscription goes a
long way to keeping the robots at bay.  We are offering <a href="https://lwn.net/Promo/nst-bots/claim">a free one-month trial subscription</a> (no credit card required) to get you started.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>March 27, 2025</br>
           <hr>
<a href="/Articles/lsfmmbpf2025/">LSFMM+BPF</a>
</div>
The 2024 Linux Storage, Filesystem, Memory-Management, and BPF Summit
included <a href="/Articles/978738/">a tense session</a> on the use of Rust
code in the kernel's filesystem layer.  The Rust topic returned in 2025 in
a session run by Andreas Hindborg, with a scope that also covered the
storage and memory-management layers.  A lot of progress has been made, and
the discussion was less adversarial this year, but there are still process
issues that need to be worked out.
<p>
<h4>Getting Rust code upstream</h4>
<p>
There are, Hindborg began, several paths by which Rust code gets into the
kernel, which he arranged on "<q>the Brauner-Hellwig scale</q>".  At the
Brauner end, some subsystems are accepting Rust code directly and
maintaining it themselves; the virtual filesystem layer (co-maintained by
Christian Brauner) is a case in point.  In these subsystems, Rust patches
are simply accepted like any others.
<p>
<a href="/Articles/1015411"><img
src="https://static.lwn.net/images/conf/2025/lsfmm/AndreasHindborg-sm.png" alt="[Andreas
Hindborg]" title="Andreas Hindborg" class="lthumb"></a>

Moving down the scale, the developers of some subsystems would like to be
able to accept Rust code directly, but the maintainers acknowledge that
they need help to do so.  The kernel's module loader is an example here; to
merge that code, experts from the Rust community have been helping.  Other
subsystems designate a separate sub-maintainer to handle Rust code; the
block layer was mentioned as using this model.
<p>
Then, there are the subsystems that don't handle Rust code at all; for
these, code goes through the Rust trees instead.  In some cases, the
maintainers are willing, and will act as reviewers, but don't feel that
they can handle the code directly; timekeeping was mentioned here.
Finally, some subsystems are not working with the Rust developers in any
way; they simply don't want to know about the Rust code.  <a
href="/Articles/1006805/">That is the case for the DMA-mapping</a> and
XArray subsystems.
<p>
None of these models are wrong, Hindborg said, but the last mentioned is
the least productive of all of them.  A subsystem's C maintainers know the
subsystem best, so their input is needed to get the best results.  He said
that an understanding of Rust is not necessary to review submissions; the
Rust code is extensively documented, and comments on the intended semantics
of that code are the most important.
<p>
<!-- middle-ad -->

Ted Ts'o said that it would help to set more explicit expectations around
testing and breakage.  If Rust code is going through the regular subsystem
trees, the maintainers should at least be doing build tests of that code,
and there should be a defined path forward when a build break happens.  If
the tree doesn't build, he asked, should patches just be dropped after a
certain time?  Hindborg answered that, if the break is observed before
merging, the patches should just be dropped right away.  But mostly, he
said, when a break happens, people just fix it and move on.
<p>
David Hildenbrand noted that changing a C interface could make it necessary
to change a lot of Rust code to match.  If the Rust code is not maintained
in the same tree, it is not clear how the patches should be split.
Hindborg said that such patches can be handled like any tree-wide series.
If need be, the developer can create a new API and slowly convert code over
to it.  If a developer is having trouble making changes to Rust code, they
can ask for help.
<p>
Liam Howlett said that, if he merges a change that breaks Rust code, it
will cause immediate problems, such as breaking continuous-integration
builds.  Then the finger of blame will point at him.  It is going to be
important to be able to do all of these changes together.  Hindborg agreed,
but also pointed out that, in the block subsystem, developers make changes
without worrying about the Rust side.  When he gets a problem report, he
fixes it within a day and all is well.  Howlett answered that this approach
will not scale; more subsystems using Rust will lead to more troubles.
Hindborg agreed that it would be better to get all of the changes in a
single series, but he didn't think he could ask that of the development
community — or get it if he did ask.  Petr Tesařík pointed out
that breaking the Rust code could lead to trouble for developers who are
trying to bisect regressions.
<p>
Hindborg asked block-subsystem maintainer Jens Axboe about his experience
with accepting Rust code; Axboe answered that it has added almost no
overhead at all.  If something breaks, he said, he often gets a patch
fixing the problem before he is even aware of it.  It is all working well,
but he pointed out that the block subsystem does not yet have a lot of Rust
code.  When asked by Hindborg, Axboe said that he does his builds with Rust
enabled, but is not able to run-test everything.
<p>
Ts'o said that he had not been doing Rust-enabled builds until recently,
and still does not do them regularly.  The reason is that his test
infrastructure is based on Debian stable, and that distribution does not
have a sufficiently recent version of the Rust compiler.  He has gotten
things working using Debian testing, but running that distribution invites
other problems.  Hindborg said that this is an easy problem to solve, all
that is needed is to wait.  The minimum version of Rust has been 1.78.0 for
a while now; over time, the problems will go away.
<p>
Matthew Wilcox said he doesn't have current Rust on his systems because he
does not like being a system administrator.  He leaves that work up to the
distributor; until it provides a suitable compiler, he just won't have it.
Jason Gunthorpe said that he had tried to do the Rust build on Ubuntu LTS,
but that the instructions in <a href="https://docs.kernel.org/rust/">the
kernel documentation</a> do not work there; 
Hindborg said that he would ensure that it was fixed.
<p>
<h4>Current and future status</h4>
<p>
A set of abstractions for the configfs filesystem is ready for
consideration, Hindborg said, but the maintainer team for configfs has recently
been "<q>cut in half</q>" (after Christoph Hellwig stopped doing that
work).  There is only one maintainer, who is not responding to email.  It
turns out that the listed maintainer has retired; Hindborg was advised to
remove him from the maintainer entry and take that subsystem over.
<p>
There have been a number of advances recently, Hindborg said.  The "rnull
stub" (a block null-device driver) has been merged, he said, as has Rust
support for 32-bit x86 systems.  It is now possible to download Rust
toolchains from kernel.org.  Other merged code includes a user-space access
module, abstractions for <tt>struct page</tt>, <tt>struct file</tt>, and
<tt>struct cred</tt>, and a linked-list implementation.  The <a
href="https://rust.docs.kernel.org/kernel/">rendered internal
documentation</a> is available on kernel.org.
<p>
The first "real" driver in Rust, for Applied Micro QT2025 PHY devices, has
been merged.  The KASAN sanitizer and Clang control-flow integrity both
work with Rust code.  There is an abstraction for misc devices, support for
tracepoints, and for RCU read locking.  The addition of the
memory-management abstractions also led to some significant improvements to
the virtual memory area (VMA) locking documentation, he said.
<p>
Looking forward, Hindborg said that the controversial DMA-mapping
abstractions will be landing soon [that may have happened by the time you
read this].  There will be support for
high-resolution timers, module parameters, I/O polling, the XArray data
structure, the <tt>iov_iter</tt> mechanism, and VMAs.  In the longer term,
the Nova graphics driver is moving forward; that will be a multi-year
effort.
<p>
In his conclusion, he repeated that the minimum version of the Rust
compiler has remained at 1.78.0 since the 6.10 release, even as newer
versions have gained support.  There are only four unstable features needed
by the kernel at this point, and that number will soon be zero, he said.
The compiler team includes kernel builds in its continuous-integration
testing to be sure they don't break it.  The kernel, he said, is a
"flagship goal" for the Rust project; the Rust developers take the kernel
project seriously, want to make it work, and are dedicating resources toward
that end.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_tools-Rust">Development tools/Rust</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Storage_Filesystem_Memory-Management_and_BPF_Summit-2025">Storage, Filesystem, Memory-Management and BPF Summit/2025</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/1015409/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor1015594"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2025 15:10 UTC (Thu)
                               by <b>ojeda</b> (subscriber, #143370)
                              [<a href="/Articles/1015594/">Link</a>] (21 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A few quick notes for completeness... I hope they are helpful.<br>
<p>
<span class="QuotedText">&gt; The reason is that his test infrastructure is based on Debian stable, and that distribution does not have a sufficiently recent version of the Rust compiler.</span><br>
<p>
Debian Trixie (the next stable, getting released in a few months) is expected to have Rust 1.85 (at least that is my understanding from our last conversations with Debian).<br>
<p>
That version is recent enough -- it is the latest Rust compiler at the moment, in fact, and supports the just released Rust 2024 edition.<br>
<p>
<span class="QuotedText">&gt; The minimum version of Rust has been 1.78.0 for a while now; over time, the problems will go away.</span><br>
<p>
Our plan is to upgrade at some point the minimum to the new Debian stable one, i.e. 1.85 (not immediately after Debian Trixie gets released, of course).<br>
<p>
<span class="QuotedText">&gt; Jason Gunthorpe said that he had tried to do the Rust build on Ubuntu LTS, but that the instructions in the kernel documentation do not work there;</span><br>
<p>
I just tried Ubuntu 24.04 LTS in a fresh VM, and I could build v6.14 without issue with the versioned packages mentioned in the instructions.<br>
<p>
Note that you also have to respect the Kconfig requirements to enable Rust, which is a bit annoying with older Rust compilers like 1.80. Please see the Ubuntu related issues at <a href="https://github.com/Rust-for-Linux/linux/issues/1127">https://github.com/Rust-for-Linux/linux/issues/1127</a>, too.<br>
<p>
It is way easier, though, in distributions that provide newer Rust compilers, such as Fedora.<br>
<p>
<span class="QuotedText">&gt; as has Rust support for 32-bit x86 systems</span><br>
<p>
Required features landed recently in `rustc` as unstable (`-Zreg-struct-return`, `-Zregparm`), but the architecture support has not been added yet (and we could be missing something else, but those two are the ones I knew for sure we needed).<br>
<p>
<span class="QuotedText">&gt; There have been a number of advances recently, (...) The first "real" driver in Rust</span><br>
<p>
In case it is useful: the authors/maintainers of (some of) those efforts maintain subpages for the main users (upstream or upcoming) in our website which may be interesting to look at -- please see the "Users" sections in the left menu at https://rust-for-linux.com.<br>
<p>
<span class="QuotedText">&gt; There are only four unstable features needed by the kernel at this point, and that number will soon be zero, he said.</span><br>
<p>
To clarify, this is likely referring to language unstable features, not unstable features in general. Language ones are important to avoid, because we don't want to have to rewrite source code. But, as the article/Andreas says, they are close to be done, finally, and we don't expect any change anyway.<br>
<p>
For instance, there are a bunch of compiler flags that are needed. Please see our <a href="https://github.com/Rust-for-Linux/linux/issues/2">https://github.com/Rust-for-Linux/linux/issues/2</a> page for the details as usual.<br>
<p>
<span class="QuotedText">&gt; The compiler team includes kernel builds in its continuous-integration testing to be sure they don't break it.</span><br>
<p>
Indeed -- this is key, and has allowed us to have confidence things work in upcoming releases and to spot issues early (only happened a couple times so far, which is good).<br>
<p>
It also allowed us in the past to declare a minimum supported version (1.78 at the moment) and thus support several versions (so far, 8 in total, plus beta and nightly should generally work).<br>
<p>
Please see https://rustc-dev-guide.rust-lang.org/tests/ecosystem-test-jobs/rust-for-linux.html for some details and the policy.<br>
<p>
<span class="QuotedText">&gt; The kernel, he said, is a "flagship goal" for the Rust project; the Rust developers take the kernel project seriously, want to make it work, and are dedicating resources toward that end.</span><br>
<p>
Indeed, in fact, we regularly meet with them to keep making progress. They have been so far open to hear what the kernel needs and offer solutions.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015594/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015631"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2025 16:39 UTC (Thu)
                               by <b>tlamp</b> (subscriber, #108540)
                              [<a href="/Articles/1015631/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; Debian Trixie (the next stable, getting released in a few months) is expected to have Rust 1.85 (at least that is my understanding from our last conversations with Debian).</span><br>
<p>
Rust 1.85 is in fact already available in the Debian Trixie repository: <br>
<a href="https://packages.debian.org/source/trixie/rustc">https://packages.debian.org/source/trixie/rustc</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015631/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015633"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2025 16:58 UTC (Thu)
                               by <b>bunch</b> (subscriber, #18522)
                              [<a href="/Articles/1015633/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
As a side question: why do maintainers insist on using distributions provided rustc instead of using rustup to install it?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015633/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015634"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2025 17:19 UTC (Thu)
                               by <b>Conan_Kudo</b> (subscriber, #103240)
                              [<a href="/Articles/1015634/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      Because that is how the Linux kernel will be built in practice. Linux is delivered through distributions, so if stuff doesn't work through distribution tooling, it won't get shipped. Rustup is a non-entity for Linux Rust development for this reason. It needs to work with conventional distribution-provided tooling.


      
          <div class="CommentReplyButton">
            <form action="/Articles/1015634/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015647"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2025 20:34 UTC (Thu)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/1015647/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The same in fact is true of anything that ships as a Deb or rpm (or whatever) package in a distro—foe example Firefox. They won't be using rustup.<br>
<p>
It doesn't have to be used everywhere. It's totally fine if a project's CI wants to use rustup to get a heads up about e.g. new additions to nightly clippy; or if rustup toolchains are recommended to users of old frozen distros that won't package that code. For example, in QEMU we will probably start requiring a rustup toolchain for Debian bookworm since Rust usage is still experimental and there's no reason for distros to enable it.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015647/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015680"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2025 10:31 UTC (Fri)
                               by <b>dottedmag</b> (subscriber, #18590)
                              [<a href="/Articles/1015680/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hear, hear.<br>
<p>
We're no longer in 1996 when software was distributed in tarballs, libc interface has not yet solidified and distributions carried patches that caused C ABI incompatibilites. Many upstreams are competent to provide binaries nowadays.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015680/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015682"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2025 11:06 UTC (Fri)
                               by <b>pbonzini</b> (subscriber, #60935)
                              [<a href="/Articles/1015682/">Link</a>] 
      </p>
      
      </div>
      </summary>
      And many others don't want to be in that business at all.

<p>You still have cases where different distros of Linux carry different versions of glibc or musl (cue the history of Python <tt>manylinux</tt>/<tt>musllinux</tt>). You have projects that also care about Windows and perhaps the three BSDs (four if you count Dragonfly), or that would have to produce architectures other than x86. You also have macOS for which cross compilation is of doubtful legal status. And so on...


      
          <div class="CommentReplyButton">
            <form action="/Articles/1015682/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor1015733"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2025 15:09 UTC (Fri)
                               by <b>nim-nim</b> (subscriber, #34454)
                              [<a href="/Articles/1015733/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
People keep saying that but no one has managed to produce a working upstream-binary-distribution yet.<br>
<p>
Once you get to the point where you try to release the kind of full system users want (ideally, preinstalled) you quickly reinvent a distribution. Many is not all nor all the time, look up the trainwreck that OpenH264 proved and that’s a single binary component produced by a well-financed corporation.<br>
<p>
If anything, the monorepo FAANGS favor is a return to a more centralised and more sourcecode-oriented distribution than the Debians and Fedoras provide.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015733/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015839"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2025 15:28 UTC (Sat)
                               by <b>surajm</b> (subscriber, #135863)
                              [<a href="/Articles/1015839/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you look how projects like chromium or fuchsia are built, they maintain almost all of their third party dependencies as prebuilts which you download alongside the git repo. It's realistically the only way, short of creating a docker container, to ensure a consistent set of tooling and dependencies are available without needing to depend on potentially less trustworthy entities (eg crates.io, npm, or what have you) that might change the package contents when you try to fetch them.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015839/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015907"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 31, 2025 8:33 UTC (Mon)
                               by <b>nim-nim</b> (subscriber, #34454)
                              [<a href="/Articles/1015907/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Exactly like distributions that maintain a repository of trusted binary prebuilds in rpm or deb format then. Once you need to ensure a minimum amount of accountability, no one plays the direct binary download from  the binary upstream game.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015907/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015910"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 31, 2025 8:49 UTC (Mon)
                               by <b>dottedmag</b> (subscriber, #18590)
                              [<a href="/Articles/1015910/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I do whenever I can. The solution is trivial, it's called "record a checksum and check it".<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015910/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor1015909"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 31, 2025 8:48 UTC (Mon)
                               by <b>dottedmag</b> (subscriber, #18590)
                              [<a href="/Articles/1015909/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There are still packaging systems and repositories in 2025 that don't provide checksums of downloads and do at least automatic ToFU, really? If yes, then it's terrifying.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015909/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor1016025"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 31, 2025 23:55 UTC (Mon)
                               by <b>MrWim</b> (subscriber, #47432)
                              [<a href="/Articles/1016025/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; If anything, the monorepo FAANGS favor is a return to a more centralised and more sourcecode-oriented distribution than the Debians and Fedoras provide.</span><br>
<p>
I wrote a bit about that here: <a href="https://blog.williammanley.net/2020/05/25/unlock-software-freedom-one-by-using-better-tools.html">https://blog.williammanley.net/2020/05/25/unlock-software...</a> :<br>
<p>
<span class="QuotedText">&gt; By doing so the huge proprietary megacorp gains more of the benefits of the fact that the software is free (as in freedom) than the free-software distros can!</span><br>
<p>
I’d love to see the major distros pursue the goal of becoming more sourcecode-oriented as you put it, unlocking the ability to modify the software they provide.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1016025/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1016027"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 1, 2025 8:29 UTC (Tue)
                               by <b>dottedmag</b> (subscriber, #18590)
                              [<a href="/Articles/1016027/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, source-code oriented, or even just «useruser-modifications oriented».<br>
<p>
It's a pretty sad state of affairs that the only games in town are Gentoo whose authors haven't even gotten around to compile ARM64 handbook, and NixOS with its horrendous language and NixPkgs repeating all the mistakes BitBake-based OpenEmbedded repository did, namely moving build logic from the build tool into the packages repository, thus making it less discoverable, underdocumented and changeable, diluting the contract between the package repository and the package description.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1016027/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor1015643"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2025 19:12 UTC (Thu)
                               by <b>ojeda</b> (subscriber, #143370)
                              [<a href="/Articles/1015643/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you mean kernel developers, some routinely use `rustup`, or the standalone installers, or the kernel.org toolchains (which currently bundle the upstream Rust binaries for simplicity -- but that may change), or build their own compilers, etc. However, other kernel developers only want to use the toolchains provided by their distributions.<br>
<p>
Outside of development, many end users (and the distributions themselves) want to use their distribution-provided toolchains too.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015643/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1016452"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 4, 2025 12:41 UTC (Fri)
                               by <b>bjackman</b> (subscriber, #109548)
                              [<a href="/Articles/1016452/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I guess the distros would also like to build the kernel they distribute using the toolchain they distribute, too?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1016452/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor1015639"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Unstable features</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2025 18:12 UTC (Thu)
                               by <b>comex</b> (subscriber, #71521)
                              [<a href="/Articles/1015639/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
From the article:<br>
<p>
<span class="QuotedText">&gt; There are only four unstable features needed by the kernel at this point, and that number will soon be zero, he said.</span><br>
<p>
This isn’t right, is it?  According to [1], there is only a small set of unstable features (indeed, four of them) allowed in *drivers*, but the core kernel crate still uses a large number of unstable features.<br>
<p>
That said, stabilizing the features needed by Rust for Linux is one of the Rust Project’s “flagship goals” [2] [3], and I’ve seen active work on many of those features happening in parallel, so that number may go down more quickly than you might expect.<br>
<p>
[1] https://rust-for-linux.com/unstable-features<br>
[2] <a href="https://blog.rust-lang.org/2024/08/12/Project-goals.html">https://blog.rust-lang.org/2024/08/12/Project-goals.html</a><br>
[3] https://rust-lang.github.io/rust-project-goals/<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015639/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015641"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Unstable features</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2025 18:55 UTC (Thu)
                               by <b>ojeda</b> (subscriber, #143370)
                              [<a href="/Articles/1015641/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; This isn’t right, is it?</span><br>
<p>
No, but because the situation is actually better! :)<br>
<p>
Even if one counts the `kernel` crate, it is essentially two language features left: `arbitrary_self_types` and `derive_coerce_pointee`. For other code, it is just the former.<br>
<p>
The reason is that some of the features we need to list are meant to support older compilers that were released when they were not stable.<br>
<p>
I will update the "Unstable features" page a bit to clarify this -- thanks!<br>
<p>
This does not mean we may not use a new feature if it is really convenient and everyone is on board and so on. But we are finally very close to being able to say we don't use unstable Rust, language-wise.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015641/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015651"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Unstable features</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 27, 2025 21:14 UTC (Thu)
                               by <b>ojeda</b> (subscriber, #143370)
                              [<a href="/Articles/1015651/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sent <a href="https://lore.kernel.org/rust-for-linux/20250327211302.286313-1-ojeda@kernel.org/">https://lore.kernel.org/rust-for-linux/20250327211302.286...</a> to clarify further.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015651/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor1015686"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2025 12:24 UTC (Fri)
                               by <b>jgg</b> (subscriber, #55211)
                              [<a href="/Articles/1015686/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; I just tried Ubuntu 24.04 LTS in a fresh VM, and I could build v6.14 without issue with the versioned packages mentioned in the instructions.</span><br>
<p>
You can build it, but not following the instructions in Documentation/rust/quick-start.rst:<br>
<p>
$ sudo apt install rustc-1.80 rust-1.80-src bindgen-0.65 rustfmt-1.80 rust-1.80-clippy<br>
$ export RUST_LIB_SRC=/usr/src/rustc-$(rustc-1.80 --version | cut -d' ' -f2)/library<br>
$ make LLVM=1 rustavailable<br>
***<br>
*** Rust bindings generator 'bindgen' could not be found.<br>
***<br>
***<br>
*** Please see Documentation/rust/quick-start.rst for details<br>
*** on how to set up the Rust support.<br>
***<br>
make[1]: *** [/tmp/x/Makefile:1798: rustavailable] Error 1<br>
make: *** [Makefile:251: __sub-make] Error 2<br>
<p>
So what is the make command?<br>
<p>
$ make LLVM=1 BINDGEN=bindgen-0.65 rustavailable<br>
***<br>
*** Rust compiler 'rustc' is too old.<br>
***   Your version:    1.75.0<br>
***   Minimum version: 1.78.0<br>
<p>
Ugh.<br>
<p>
$ make LLVM=1 BINDGEN=bindgen-0.65 RUSTC=rustc-1.80 rustavailable<br>
Failed to run rustfmt: No such file or directory (os error 2) (non-fatal, continuing)<br>
***<br>
*** Rust bindings generator 'bindgen-0.65' &lt; 0.69.5 together with libclang &gt;= 19.1<br>
*** may not work due to a bug (<a href="https://github.com/rust-lang/rust-bindgen/pull/2824">https://github.com/rust-lang/rust-bindgen/pull/2824</a>),<br>
*** unless patched (like Debian's).<br>
***   Your bindgen version:  0.65.1<br>
***   Your libclang version: 19.1.7<br>
***<br>
clang: unknown C compiler<br>
<p>
Uh.. OK..<br>
<p>
$ make LLVM=1 LLVM_SUFFIX=-17 BINDGEN=bindgen-0.65 RUSTC=rustc-1.80 rustavailable<br>
Failed to run rustfmt: No such file or directory (os error 2) (non-fatal, continuing)<br>
***<br>
*** Rust bindings generator 'bindgen-0.65' &lt; 0.69.5 together with libclang &gt;= 19.1<br>
*** may not work due to a bug (<a href="https://github.com/rust-lang/rust-bindgen/pull/2824">https://github.com/rust-lang/rust-bindgen/pull/2824</a>),<br>
*** unless patched (like Debian's).<br>
***   Your bindgen version:  0.65.1<br>
***   Your libclang version: 19.1.7<br>
***<br>
***<br>
*** libclang (used by the Rust bindings generator 'bindgen-0.65')<br>
*** version does not match Clang's. This may be a problem.<br>
***   libclang version: 19.1.7<br>
***   Clang version:    17.0.6<br>
***<br>
***<br>
*** Please see Documentation/rust/quick-start.rst for details<br>
*** on how to set up the Rust support.<br>
***<br>
Rust is available!<br>
<p>
Progress?<br>
<p>
I have lots of libclang's:<br>
<p>
$ ls /lib/x86_64-linux-gnu/libclang*<br>
/lib/x86_64-linux-gnu/libclang-17.so.1@  /lib/x86_64-linux-gnu/libclang-19.so.19<br>
/lib/x86_64-linux-gnu/libclang-17.so.17  /lib/x86_64-linux-gnu/libclang-cpp.so.17@<br>
/lib/x86_64-linux-gnu/libclang-18.so.1@  /lib/x86_64-linux-gnu/libclang-cpp.so.18@<br>
/lib/x86_64-linux-gnu/libclang-18.so.18  /lib/x86_64-linux-gnu/libclang-cpp.so.18.1@<br>
/lib/x86_64-linux-gnu/libclang-19.so.1@  /lib/x86_64-linux-gnu/libclang-cpp.so.19.1<br>
<p>
Maybe don't automatically pick the wrong one :\<br>
<p>
$ make LLVM=1 LLVM_SUFFIX=-17 BINDGEN=bindgen-0.65 RUSTC=rustc-1.80 LIBCLANG_PATH=/lib/x86_64-linux-gnu/libclang-17.so.1 rustavailable<br>
Rust is available!<br>
<p>
Yay, finally..<br>
<p>
The instructions in quick-start really should say the special make command required as well.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015686/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015687"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2025 15:13 UTC (Fri)
                               by <b>ojeda</b> (subscriber, #143370)
                              [<a href="/Articles/1015687/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<span class="QuotedText">&gt; You can build it, but not following the instructions</span><br>
<p>
You can definitely argue the instructions could be more detailed, but the existing instructions are currently meant as examples on installing the toolchain, not as a full guide on building the kernel for each particular distribution/LTS/set of packages/setup.<br>
<p>
<span class="QuotedText">&gt; Maybe don't automatically pick the wrong one :\</span><br>
<p>
Hmm... I don't think we should automatically override whatever the user's tool (or its distribution) does.<br>
<p>
<span class="QuotedText">&gt; The instructions in quick-start really should say the special make command required as well.</span><br>
<p>
I wouldn't say it is really special. In a fresh 24.04 LTS, using the install command provided, this works:<br>
<p>
make LLVM=1 RUSTC=rustc-1.80 BINDGEN=bindgen-0.65 rustavailable<br>
<p>
`LLVM=1` is common and `RUSTC`/`BINDGEN` are needed just like in the C side when using different binaries.<br>
<p>
The biggest pitfalls are the `RUST_LIB_SRC` one and the `bindgen` bugs -- they are mentioned and they were reported to upstream Ubuntu.<br>
<p>
Now, yes, an example `make` for cases that we know that work could help, or perhaps a list of related variables, but we cannot try to cover every setup either, so it is a balance.<br>
<p>
Over time, this will get easier, e.g. Ubuntu 25.04 will be better -- no versioned packages needed.<br>
<p>
And others like Fedora just work already.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015687/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor1015754"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Quick notes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2025 18:25 UTC (Fri)
                               by <b>jgg</b> (subscriber, #55211)
                              [<a href="/Articles/1015754/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It is not every setup, it is Ubuntu 24.04 LTS which is listed in its own section in the documentation with its own steps. Put the command that is required to make it work reliably so people can make it work. It is not easy to find all these weird make variables that are needed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015754/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor1015679"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Just download it</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2025 10:29 UTC (Fri)
                               by <b>dottedmag</b> (subscriber, #18590)
                              [<a href="/Articles/1015679/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"Is not available in my distribution" sounds like a weak argument for something that aids in development.<br>
<p>
Rust is not Go whose distributed prebuilt binaries are statically linked, but still the binary releases of Rust are pretty much self-contained:<br>
<p>
% x86_64-linux-gnu-readelf -a ./rustc/bin/rustc | grep NEEDED<br>
 0x0000000000000001 (NEEDED)             Shared library: [librustc_driver-fdfc7fb14758cf9e.so]<br>
 0x0000000000000001 (NEEDED)             Shared library: [libdl.so.2]<br>
 0x0000000000000001 (NEEDED)             Shared library: [librt.so.1]<br>
 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]<br>
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]<br>
%<br>
<p>
So for manual work it's one download away, and even for CI it's a one download and one checksum verification away.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/1015679/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2025, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
