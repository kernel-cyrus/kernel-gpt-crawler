        <!DOCTYPE html>
        <html lang="en">
        <head><title>Working with UTF-8 in the kernel [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/784124/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/784225/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/784124/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Working with UTF-8 in the kernel</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>This article brought to you by LWN subscribers</b>
<p>
Subscribers to LWN.net made this article &mdash; and everything that
       surrounds it &mdash; possible.  If you appreciate our content, please
       <a href="/Promo/nst-nag3/subscribe">buy a subscription</a> and make the next
       set of articles possible.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>March 28, 2019</br>
           </div>
In the real world, text is expressed in many languages using a wide variety
of character sets; those character sets can be encoded in a lot of
different ways.  In the kernel, life has always been simpler; file names
and other string data are just opaque streams of bytes.  In the few cases
where the kernel must interpret text, nothing more than ASCII is required.
The <a href="/Articles/784041/">proposed addition of case-insensitive
file-name lookups</a> to the ext4 filesystem changes things, though; now
some kernel code must 
deal with the full complexity of Unicode.  A look at the API being provided
to handle encodings illustrates nicely just how complicated this task is.
<p>
The Unicode standard, of course, defines "code points"; to a first
approximation, each code point represents a specific character in a specific
language group.  How those code points are represented in a stream of bytes
— the encoding — is a separate question.  Dealing with encodings has
challenges of its own, but over the years the <a
href="https://en.wikipedia.org/wiki/UTF-8">UTF-8</a> encoding has emerged
as the preferred way of representing code points in many settings.  UTF-8
has the advantages of representing the entire Unicode space while being
compatible with ASCII — a valid ASCII string is also valid UTF-8.  The
developers implementing case independence in the kernel decided to limit it
to the UTF-8 encoding, presumably in the hope of solving the problem
without going entirely insane.
<p>
The API that resulted has two layers: a relatively straightforward set of
higher-level operations and the primitives that are used to implement
them.  We'll start at the top and work our way down.
<p>
<h4>The high-level UTF-8 API</h4>
<p>
At a high level, the operations that will be needed can be described fairly
simply: validate a string, normalize a string, and compare two strings
(perhaps with case folding).  There is, though, a catch: the Unicode
standard comes in multiple versions (<a
href="https://unicode.org/versions/Unicode12.0.0/">version 12.0.0</a> was
released in early March), and each version is different.  The <a
href="https://en.wikipedia.org/wiki/Unicode_equivalence#Normalization">normalization</a>
and case-folding rules can change between versions, and not all code points
exist in all versions.  So, before any of the other operations can be used,
a "map" must be loaded for the Unicode version of interest:
<p>
<pre>
    struct unicode_map *utf8_load(const char *version);
</pre>
<p>
The given <tt>version</tt> number can be <tt>NULL</tt>, in which case the
latest supported version will be used and a warning will be emitted.  In the
ext4 implementation, the Unicode version used with any given filesystem is
stored in the superblock.  The latest version can be explicitly requested
by obtaining its name from <tt>utf8version_latest()</tt>, which takes no
parameters.  The return value from <tt>utf8_load()</tt> is a map pointer
that can be used with 
other operations, or an error-pointer value if something goes wrong.  The
returned pointer should be freed with <tt>utf8_unload()</tt> when it is no
longer needed.
<p>
UTF-8 strings are represented in this interface using the <a
href="https://elixir.bootlin.com/linux/v5.0/source/include/linux/dcache.h#L40"><tt>qstr</tt>
structure</a> defined in <tt>&lt;linux/dcache.h&gt;</tt>.  That reveals an
apparent assumption that the use of this API will be limited to filesystem
code; that is true for now, but could change in the future.
<p>
The single-string operations provided are:
<p>
<pre>
    int utf8_validate(const struct unicode_map *um, const struct qstr *str);
    int utf8_normalize(const struct unicode_map *um, const struct qstr *str,
		       unsigned char *dest, size_t dlen);
    int utf8_casefold(const struct unicode_map *um, const struct qstr *str,
		      unsigned char *dest, size_t dlen);
</pre>
<p>
All of the functions require the map pointer (<tt>um</tt>) and the string
to be operated upon (<tt>str</tt>).  <tt>utf_validate()</tt> returns zero
if <tt>str</tt> is a valid UTF-8 string, non-zero otherwise.  A call to
<tt>utf8_normalize()</tt> will store a normalized version of <tt>str</tt>
in <tt>dest</tt> and return the length of the result;
<tt>utf8_casefold()</tt> does case folding as well as normalization.  Both
functions will return <tt>-EINVAL</tt> if the input string is invalid or if
the result would be longer than <tt>dlen</tt>.
<p>
Comparisons are done with:
<p>
<pre>
    int utf8_strncmp(const struct unicode_map *um,
		     const struct qstr *s1, const struct qstr *s2);
    int utf8_strncasecmp(const struct unicode_map *um,
		     const struct qstr *s1, const struct qstr *s2);
</pre>
<p>
Both functions will compare the normalized versions of <tt>s1</tt> and
<tt>s2</tt>; <tt>utf8_strncasecmp()</tt> will do a case-independent
comparison.  The return value is zero if the strings are the same,
one if they differ, and <tt>-EINVAL</tt> for errors.  These functions only
test for equality; there is no "greater than" or "less than" testing.
<p>
<h4>Moving down</h4>
<p>
Normalization and case folding require the kernel to gain detailed
knowledge of the entire Unicode code point space.  There are a lot of rules,
and there are multiple ways of representing many code points.  The good news
is that these rules are <a
href="https://www.unicode.org/reports/tr44/#UCD_Files">packaged</a>, in
machine-readable form, with the 
Unicode standard itself.  The bad news is that they take up several
megabytes of space.
<p>
The UTF-8 patches incorporate these rules by processing the provided files
into a data structure in a C header file.  A fair amount of space is then
regained by removing the information for decomposing Hangul (Korean)
code points into their base components, since this is a task that can be
done algorithmically as well.  There is still a lot of data that has to go
into kernel space, though, and it's naturally different for each version of
Unicode. 
<p>
The first step for code wanting to use the lower-level API is to get a
pointer to this database for the Unicode version in use.  That is done with
one of:
<p>
<pre>
    struct utf8data *utf8nfdi(unsigned int maxage);
    struct utf8data *utf8nfdicf(unsigned int maxage);
</pre>
<p>
Here, <tt>maxage</tt> is the version number of interest, encoded in an
integer form from the major, minor, and revision numbers using the
<tt>UNICODE_AGE()</tt> macro.  If only normalization is needed,
<tt>utf8nfdi()</tt> should be called; use <tt>utf8nfdicf()</tt> if case
folding is also required.  The return value will be an opaque pointer, or
<tt>NULL</tt> if the given version cannot be supported.
<p>
Next, a cursor should be set up to track progress working through the
string of interest:
<p>
<pre>
    int utf8cursor(struct utf8cursor *cursor, const struct utf8data *data,
	           const char *s);
    int utf8ncursor(struct utf8cursor *cursor, const struct utf8data *data,
		    const char *s, size_t len);
</pre>
<p>

The <tt>cursor</tt> structure must be provided by the caller, but is
otherwise opaque; <tt>data</tt> is the database pointer obtained above.  If
the length of the string (in bytes) is known, <tt>utf8ncursor()</tt> should
be used; <tt>utf8cursor()</tt> can be used when the length is not known but
the string is null-terminated.  These functions return zero on success,
nonzero otherwise.
<p>
Working through the string is then accomplished by repeated calls to:
<p>
<pre>
    int utf8byte(struct utf8cursor *u8c);
</pre>
<p>
This function will return the next byte in the normalized (and possibly
case-folded) string, or zero at the end.  UTF-8-encoded code points
can take more than one byte, of course, so individual bytes do not, on
their own, represent code points.  Due to decomposition, the return string
may be longer than the one passed in.
<p>
As an example of how these pieces fit together, here is the full
implementation of <tt>utf8_strncasecmp()</tt>:
<p>
<pre>
    int utf8_strncasecmp(const struct unicode_map *um,
		         const struct qstr *s1, const struct qstr *s2)
    {
	const struct utf8data *data = utf8nfdicf(um-&gt;version);
	struct utf8cursor cur1, cur2;
	int c1, c2;

	if (utf8ncursor(&amp;cur1, data, s1-&gt;name, s1-&gt;len) &lt; 0)
	    return -EINVAL;

	if (utf8ncursor(&amp;cur2, data, s2-&gt;name, s2-&gt;len) &lt; 0)
	    return -EINVAL;

	do {
	    c1 = utf8byte(&amp;cur1);
	    c2 = utf8byte(&amp;cur2);

	    if (c1 &lt; 0 || c2 &lt; 0)
		return -EINVAL;
	    if (c1 != c2)
		return 1;
	} while (c1);

	return 0;
    }
</pre>
<p>

There are other functions in the low-level API for testing validity,
getting the length of strings, and so on, but the above captures the core
of it.  Those interested in the details can find them in <a
href="/ml/linux-fsdevel/20190318202745.5200-4-krisman@collabora.com/">this
patch</a>.
<p>
That is quite a bit of complexity when one considers that it is all there
just to compare strings; we are now far removed from the simple string
functions found in Kernighan &amp; Ritchie.  But that, it seems, is the
world that we live in now.  At least we get some nice emoji for all of that
complexity 👍.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Character_encoding">Character encoding</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/784124/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor784275"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2019 18:29 UTC (Thu)
                               by <b>Sesse</b> (subscriber, #53779)
                              [<a href="/Articles/784275/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Does utf8byte() actually return the next _byte_? That's a strange decision. Wouldn't the right choice normally be either to return a _code point_, or, if implementing the Unicode Collation Algorithm (UCA), the next _weight_?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784275/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784315"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2019 9:32 UTC (Fri)
                               by <b>grawity</b> (subscriber, #80596)
                              [<a href="/Articles/784315/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm somewhat disappointed it wasn't called utf8rune().<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784315/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor784292"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2019 21:48 UTC (Thu)
                               by <b>ikm</b> (guest, #493)
                              [<a href="/Articles/784292/">Link</a>] (55 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; But that, it seems, is the world that we live in now</font><br>
<p>
Is case-insensitive file name support the only user of this code? Then being able to handle Unicode is hardly the requirement of the world we live in - we can already have emojis in file names, after all, and I doubt those are case sensitive.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784292/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784296"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 28, 2019 23:35 UTC (Thu)
                               by <b>gdt</b> (subscriber, #6284)
                              [<a href="/Articles/784296/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The essential requirement is efficient case-insensitive comparison of file names. At present the provided API is not efficient; there's also races between checking the filename is not in use and creating a new file with that filename. The kernel design choices are: (1) the kernel supports UTF-8, (2) the kernel gives an efficient race-free user-space API to allow a directory to be listed, and changes to that directory locked whilst the user space handles UTF-8. Choice (2) is scary enough that choice (1) looks better.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784296/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784302"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2019 3:08 UTC (Fri)
                               by <b>zlynx</b> (guest, #2285)
                              [<a href="/Articles/784302/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I may not understand something here. But if you read a directory and assume that just because there's no file there, you are free to make a new one, that's a bad assumption. And always has been. That's the source of several /tmp vulnerabilities in the past.<br>
<p>
Always assume someone stole your filename. It isn't your until you hold a handle to it.<br>
<p>
So how is this case normalization system helping anyone?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784302/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784305"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2019 6:09 UTC (Fri)
                               by <b>khim</b> (subscriber, #9252)
                              [<a href="/Articles/784305/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Case normalization removes the need for the whole thing. To implement case-insensitive semantic in usersapce you must check if SoMeFiLeNaMe.txt is there and then create SomeFilename.txt atomically. If kernel is asked to create SomeFilename.txt and returns reference to SoMeFiLeNaMe.txt then this atomicity would be handled in kernel.<br>
<p>
P.S. I wonder if these tables (without code) could be exposed to userspace. Userspace guys ALSO often need to deal with Unicode and if kernel already has all these tables... why not use them?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784305/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784306"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2019 6:35 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/784306/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The overhead of cross-address access will probably make it impractical for userspace.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784306/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784308"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2019 8:26 UTC (Fri)
                               by <b>felix.s</b> (guest, #104710)
                              [<a href="/Articles/784308/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It seems to work fine for vDSO, doesn't it?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784308/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784309"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2019 8:28 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/784309/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That would work for basically static data. At this point a special file in /proc might work just as well.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784309/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784311"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2019 9:31 UTC (Fri)
                               by <b>dezgeg</b> (subscriber, #92243)
                              [<a href="/Articles/784311/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Having the data tables readable from /proc sounds unattractive due to this part from the article:<br>
<p>
"The UTF-8 patches incorporate these rules by processing the provided files into a data structure in a C header file. A fair amount of space is then regained by removing the information for decomposing Hangul (Korean) code points into their base components, since this is a task that can be done algorithmically as well."<br>
<p>
Exporting these non-standard tables to userspace would lock in this custom format implementation detail forever.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784311/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor784492"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 1, 2019 14:12 UTC (Mon)
                               by <b>rweikusat2</b> (subscriber, #117920)
                              [<a href="/Articles/784492/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Nothing scary about that: Open directory (or use an already open descriptor), acquire lock which prevents adding/ removing entries, process accumulated change notifications, create/ remove entry, unlock.<br>
<p>
Such a lock must already exists, BTW, it may be sufficient to expose that. Advisory locking would probably be ok as UNIX processes are usually supposed to cooperate and not fight with each other. Vastly simpler in the kernel than 'hard-coding' a specific, known-to-be-broken/ deficient case translation mechanism into certain filesystems. Considering cases like "vertical bar plus combining overline' (aka T, not going happen as that's an ASCII codepoint), I consider "kernel supports UTF-8" much more 'scary'.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784492/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor784316"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2019 10:05 UTC (Fri)
                               by <b>smurf</b> (subscriber, #17840)
                              [<a href="/Articles/784316/">Link</a>] (46 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There's also the problem of composites. Unicode, in its infinite wisdom(*), has multiple ways to store the same character (an 'ä' is either a single latin1 character, or an 'a' followed by a combining diaeresis – any sane designer would have stored the modifiers first, but I digress). You need to agree on one form with which to represent file names because the user typically can't easily generate the other, and even copy+paste tends to get mangled.<br>
<p>
There's another problem here. Correct case folding is locale dependent. One example: Turkish has an i and an ı (i without the dot). Unicode helpfully has an İ (capital I with a dot) right next to it. Guess what happens when you case-fold these in Turkey vs. everywhere else.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784316/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784318"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2019 11:21 UTC (Fri)
                               by <b>Sesse</b> (subscriber, #53779)
                              [<a href="/Articles/784318/">Link</a>] (40 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Normalization is already dealt with in the patch.<br>
<p>
Also, I don't think you can blame Unicode for the fact that Turkish and English has different alphabets.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784318/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784321"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2019 13:32 UTC (Fri)
                               by <b>drag</b> (guest, #31333)
                              [<a href="/Articles/784321/">Link</a>] (37 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  Also, I don't think you can blame Unicode for the fact that Turkish and English has different alphabets.</font><br>
<p>
What it does mean is that your case insensitive lookups for the file system are actually case sensitive with insensitive elements.  How sensitive it ends up being depends on what language a user uses.<br>
<p>
Unless, of course, the kernel is aware of the user's locale and changes the responses accordingly. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784321/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784403"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2019 22:53 UTC (Fri)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/784403/">Link</a>] (36 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The kernel is never aware of the user’s locale, so this belongs into userspace.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784403/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784410"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2019 13:17 UTC (Sat)
                               by <b>SLi</b> (subscriber, #53131)
                              [<a href="/Articles/784410/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
But the point is, there is no "case folding" independent of language; the rules for doing it are inherently language dependent.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784410/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784882"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 4, 2019 8:33 UTC (Thu)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/784882/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The rules for doing it are virtually language independent. Turkish and a small set of related languages do have a problematic difference with the dotted i, but the rest of the Latin-script languages all agree, and there seems to be no disagreements among the other languages that use casing scripts. It's unfortunate that 1% of the world's population won't get proper casing, but at this point practical compatibility with other operating systems seems more important. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784882/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785004"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 5, 2019 8:11 UTC (Fri)
                               by <b>dgm</b> (subscriber, #49227)
                              [<a href="/Articles/785004/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  practical compatibility with other operating systems seems more important. </font><br>
<p>
So Linux cannot exchange data with MacOS and Windows?! PANIC! <br>
<p>
Or put another way: if I show you that less than 1% of the population really wants or needs a case-insensitive filesystem, can I disregard your claims?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785004/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785147"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 8, 2019 2:02 UTC (Mon)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/785147/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you want to support FAT or NTFS, you need to support case-insensitive filesystems. You can half-ass it and write out potentially corrupt filesystems, but I think most of the users of these filesystems with Windows don't want that. Fortunately, there are rules for locale-insensitive case-folding, and they aren't random or arbitrary.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785147/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785288"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 8, 2019 21:18 UTC (Mon)
                               by <b>foom</b> (subscriber, #14868)
                              [<a href="/Articles/785288/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Fortunately, there are rules for locale-insensitive case-folding, and they aren't random or arbitrary.</font><br>
<p>
That may be, but FAT, exFAT, and NTFS don't use the unicode case folding rules. If the justification is to make something compatible with those systems, do we actually need the (rather complex) unicode rules?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785288/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785304"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 8, 2019 23:30 UTC (Mon)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/785304/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What rules do they use?<br>
<p>
In what way are the Unicode case-folding rules rather complex? They are for the most part fairly simple, one to one matchings of characters, with a few exceptions that you just have to deal with. The German ß and the various titlecase characters in Unicode are there and are going to have to be dealt with.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785304/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785339"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 9, 2019 15:35 UTC (Tue)
                               by <b>foom</b> (subscriber, #14868)
                              [<a href="/Articles/785339/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
NTFS and exFAT only maps a single utf16 code unit to another single utf16 code unit, via a lookup table written to disk during filesystem creation. No unicode normalization, no multicharacter equivalencies, and no folding for any characters above FFFF.<br>
<p>
You say that other cases "have to be dealt with"...but we have widely used examples showing that to not actually be the case.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785339/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor784414"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2019 13:59 UTC (Sat)
                               by <b>SLi</b> (subscriber, #53131)
                              [<a href="/Articles/784414/">Link</a>] (28 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Can you explain how the user space could help here? For a Turkish user, any system that considers "I" and "i" the same filename/string modulo case is broken. Both are letters and both have upper and lower forms, but they are different letters.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784414/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784420"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2019 16:45 UTC (Sat)
                               by <b>foom</b> (subscriber, #14868)
                              [<a href="/Articles/784420/">Link</a>] (27 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The case folding for a filesystem must be consistent, so it can't have such locale-specific rules.<br>
<p>
Neither Mac nor windows filesystems' case folding is locale sensitive, either. (NTFS does write a file during filesystem creation containing the case folding rules for that drive, so you _could_ make them be whatever you like, at the risk of breaking everything...)<br>
<p>
Everyone likes to bring up this example, but I rather expect the likelihood of normal Turkish users noticing and caring that they can't create two such files in the same directory is rather a theoretical problem, not an actual one.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784420/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784421"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2019 18:19 UTC (Sat)
                               by <b>nybble41</b> (subscriber, #55106)
                              [<a href="/Articles/784421/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The fact that case folding is broken everywhere else it's been implemented offers a good argument against implementing it in Linux.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784421/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784425"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2019 21:41 UTC (Sat)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/784425/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
case-insensitive filename comparison belongs into userspace, because there, if you setlocale(3) correctly, things like toupper(3), tolower(3) and strcoll(3) work properly even for Turkish.<br>
<p>
So, the kernel should have nothing to do with this *at all*.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784425/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784487"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 1, 2019 9:45 UTC (Mon)
                               by <b>nim-nim</b> (subscriber, #34454)
                              [<a href="/Articles/784487/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The kernel needs to provide the encoding and normalisation userspace can work from. You can’t push those to userspace, because userspace then ends up guessing (badly) the filesystem encoding.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784487/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784992"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 5, 2019 1:24 UTC (Fri)
                               by <b>xtifr</b> (guest, #143)
                              [<a href="/Articles/784992/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If the case-insensitive FS is a user-space overlay on an existing filesystem, then you don't *need* to guess anything. It will do case-folding based on the locale of the user who mounted the overlay.<br>
<p>
This means *all* the overheads will truly need to be present only for those who actively *use* the system.<br>
<p>
I honestly don't know how this is all going forward without *at least* a user-space proof-of-concept system.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784992/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785105"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 6, 2019 21:56 UTC (Sat)
                               by <b>foom</b> (subscriber, #14868)
                              [<a href="/Articles/785105/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It will do case-folding based on the locale of the user who mounted the overlay.</font><br>
<p>
But that behavior would be pretty awful -- which files you can access depending upon your current locale? There's a reason filesystems (including this ext4 proposal) store the mapping used when creating the filesystem...<br>
<p>
<font class="QuotedText">&gt; without *at least* a user-space proof-of-concept system.</font><br>
<p>
Two have been mentioned already. Android has an overlay filesystem for local access, and samba implements it when exporting the filesystem over the network.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785105/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor784428"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2019 21:44 UTC (Sat)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/784428/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yes, it must be consistent. What if a new release of Unicode comes out? Boom.<br>
<p>
Another reason why this belongs into userspace.<br>
<p>
And no, the turkish case is not theoretical. They have words which only differ in the dot above the i, and in one case, one of the two words is normal and one a rather crass insult, which led to (IIRC) a knife attack (well, some kind of real-life attack at the person) because they had no dotless i on their keyboard when texting.<br>
<p>
I’ll quote someone else: just because your latin alphabet has 26 letters, not everyone else’s does. Imagine if we’d *always* (independent on what word it’s in) make “oo” compare the same as “u”, for example.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784428/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784430"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2019 21:51 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/784430/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  And no, the turkish case is not theoretical. They have words which only differ in the dot above the i, and in one case, one of the two words is normal and one a rather crass insult, which led to (IIRC) a knife attack (well, some kind of real-life attack at the person) because they had no dotless i on their keyboard when texting.</font><br>
This is the story: <a href="https://gizmodo.com/a-cellphones-missing-dot-kills-two-people-puts-three-m-382026">https://gizmodo.com/a-cellphones-missing-dot-kills-two-pe...</a><br>
<p>
Although I personally wouldn't blame the cellphone here. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784430/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784431"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2019 22:43 UTC (Sat)
                               by <b>mpr22</b> (subscriber, #60784)
                              [<a href="/Articles/784431/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The situation was bad.<br>
<p>
Bad technology made it worse.<br>
<p>
The cellphone doesn't get off scot-free here.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784431/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor784435"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 31, 2019 1:46 UTC (Sun)
                               by <b>foom</b> (subscriber, #14868)
                              [<a href="/Articles/784435/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hopefully the filesystem records what mapping it was created with, like NTFS does. Otherwise, some of your files may become inaccessible when a new mapping is switched to (which, iirc, did happen on HFS+ before. That's not good...)<br>
<p>
Re: Turkish swears -- you can name your files either word just fine -- the filesystem does not be change your chosen filename to the other name! Only if you try to make files named both, in the same directory, will you run into an issue. I still claim that is *highly* unlikely.<br>
<p>
If we treated oo and u as the same for filename comparison purposes, because that was a very common language's policy, I rather suspect that also wouldn't be a huge problem. (It'd be weird to have such behavior, as that isn't a common policy, however.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784435/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784475"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 31, 2019 19:17 UTC (Sun)
                               by <b>naptastic</b> (guest, #60139)
                              [<a href="/Articles/784475/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; because that was a very common language's policy</font><br>
<p>
Which one‽ I've never heard of this and I am dying to know! MY BRAIN IS HUNGRY<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784475/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor784873"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 4, 2019 5:37 UTC (Thu)
                               by <b>rgmoore</b> (<b>&#x272D; supporter &#x272D;</b>, #75)
                              [<a href="/Articles/784873/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>Hopefully the filesystem records what mapping it was created with, like NTFS does. Otherwise, some of your files may become inaccessible when a new mapping is switched to (which, iirc, did happen on HFS+ before. That's not good...)</blockquote>

<p>This seems like the key to me.  If the case folding rules can change, there's no way to guarantee that the same file will always be accessible the same way, and that's true whether the case folding happens in the kernel or in userspace.
      
          <div class="CommentReplyButton">
            <form action="/Articles/784873/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor784895"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 4, 2019 12:28 UTC (Thu)
                               by <b>bosyber</b> (guest, #84963)
                              [<a href="/Articles/784895/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; If we treated oo and u as the same for filename comparison purposes, because that was a very common language's policy</font><br>
Is it? I know that it might be that way effectively in German, but in Dutch it is absolutely not, they are completely different sounds (the german u sound is closer to Dutch oe double sound, but not oo which is a loong vowel in Dutch.).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784895/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor784483"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 1, 2019 6:46 UTC (Mon)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/784483/">Link</a>] (14 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Everyone likes to bring up this example, but I rather expect the likelihood of normal Turkish users noticing and caring that they can't create two such files in the same directory is rather a theoretical problem, not an actual one.</font><br>
<p>
Check the numerous, real-world examples and references given in the comment to the previous LWN article: <a href="https://lwn.net/Articles/784041/">https://lwn.net/Articles/784041/</a> It's not just Turkish: like another natural language topic case-sensitivity is very complex and (among others) locale-specific - not just in theory but in practice.<br>
<p>
foom wrote:<br>
<font class="QuotedText">&gt; Neither Mac nor windows filesystems' case folding is locale sensitive, either. (NTFS does write a file during filesystem creation containing the case folding rules for that drive, so you _could_ make them be whatever you like, at the risk of breaking everything...)</font><br>
<p>
Interesting, references?<br>
<p>
nybble41 wrote:<br>
<font class="QuotedText">&gt; The fact that case folding is broken everywhere else it's been implemented offers a good argument against implementing it in Linux.</font><br>
<p>
Wait... should Linux be "bug for bug" compatible or linguistically correct?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784483/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784714"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2019 2:51 UTC (Wed)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/784714/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Linux should implement the standard rules for case folding, and not worry about the linguistic details.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784714/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784719"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2019 5:07 UTC (Wed)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/784719/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
What are these "standard rules" and which locale are they based on? US English?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784719/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784721"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 3, 2019 6:18 UTC (Wed)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/784721/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<a href="http://www.unicode.org/versions/Unicode12.0.0/ch05.pdf">http://www.unicode.org/versions/Unicode12.0.0/ch05.pdf</a> offers basically the standard rules, though some details you might have to refer to the technical reports. It's based on all locales; Turkish and some Lithuanian dictionary usage are about the only locales that have a case exception from standard case folding. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784721/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785251"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 8, 2019 17:53 UTC (Mon)
                               by <b>hkario</b> (subscriber, #94864)
                              [<a href="/Articles/785251/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
and German... SS being upper case of ß, but ss being the lower case of SS...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785251/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785278"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 8, 2019 20:30 UTC (Mon)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/785278/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That's not an exception. In all locales, ß uppercases to SS. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785278/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785387"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 9, 2019 18:30 UTC (Tue)
                               by <b>mirabilos</b> (subscriber, #84359)
                              [<a href="/Articles/785387/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Except it doesn’t, any more, in German.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785387/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785408"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 10, 2019 0:50 UTC (Wed)
                               by <b>dvdeug</b> (guest, #10998)
                              [<a href="/Articles/785408/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Citation needed. If you're talking about the Capital Eszett, it has been explicitly excluded from case-folding because it is non-standard. If the German speakers really wanted a change, given they are the only modern language group using it, it would change in all locales.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785408/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor786188"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2019 22:15 UTC (Wed)
                               by <b>chithanh</b> (guest, #52801)
                              [<a href="/Articles/786188/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think it is more complex than that.<br>
<p>
ß (U+00DF) indeed has no uppercase mapping in Unicode.<br>
But ẞ (U+1E9E) has a lowercase mapping of ß.<br>
<p>
So if you start with ẞ and then convert to lowercase and then to uppercase again you might end up with SS.<br>
<p>
Also, if you perform a case-insensitive filename match for ẞ it will return a file named ß.<br>
But a case-insensitive filename match for ß will not return a file named ẞ.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/786188/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor786189"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 17, 2019 22:40 UTC (Wed)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/786189/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Also, if you perform a case-insensitive filename match for ẞ it will return</font><br>
a file named ß.<br>
<font class="QuotedText">&gt; But a case-insensitive filename match for ß will not return a file named ẞ.</font><br>
<p>
Just for fun, some more "real-world" case insensitivity (from comments in the previous LWN thread)<br>
<a href="https://www.google.com/search?q=FRANCAIS">https://www.google.com/search?q=FRANCAIS</a><br>
<a href="https://www.google.com/search?q=FRANÇAIS">https://www.google.com/search?q=FRANÇAIS</a><br>
<p>
Good luck supporting this in your filesystem.<br>
<p>
<font class="QuotedText">&gt; If the German speakers really wanted a change,...</font><br>
<p>
Thanks, you just confirmed case sensitivity is not "hard science" no matter how hard Unicode tries to pretend it is. What a surprise considering it's part of natural languages. That's why it definitely has a place in high level interface user interfaces like file explorers, choosers and maybe interactive command lines even (with some autocorrection) but certainly not "hardwired" at a very low level in filesystems where it has already been seen causing damage.<br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/786189/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor784867"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 4, 2019 13:00 UTC (Thu)
                               by <b>foom</b> (subscriber, #14868)
                              [<a href="/Articles/784867/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Interesting, references?</font><br>
<p>
Search for $upcase -- the name of the 128KB pseudo file stored on in every NTFS filesystem. You can also look at the NTFS filesystem driver for Linux.<br>
<p>
This file contains the corresponding uppercased character (2 bytes) for each one of the 65536 unicode characters. When windows wants to compare filenames, it simply indexes each character in each string through this table, to make an uppercase string, before doing the comparison.<br>
<p>
When you reformat a drive it writes the newest mapping to the file, and that partition will use the same mapping as long as you keep it.<br>
<p>
And, yes, I am quite aware that everyone who knows anything about unicode is crying out in distress at the utter WRONGness of what I said above...<br>
<p>
But of course, the secret is that users aren't really the ones who care about case insensitive comparisons... They are using gui file pickers and such higher level tools where the filesystem case behavior doesn't matter.<br>
<p>
Note the primary use cases given for Linux (samba exports, Android emulating a FAT filesystem on top of ext4) are all about *software* expectations, not humans. Software that was written with hardcoded filenames of the wrong case. That's why ntfs's braindead case folding is not really a problem.<br>
<p>
Which does rather bring into question whether implementing "correct" normalization and case folding in Linux even has a point... It won't make it more compatible with the legacy software to do that...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784867/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785152"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 8, 2019 6:21 UTC (Mon)
                               by <b>cpitrat</b> (subscriber, #116459)
                              [<a href="/Articles/785152/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If the primary use case is to be compatible with NTFS, why not implement it the same way ? As I understand it, NTFS support will require a fake unicode version ?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785152/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785290"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 8, 2019 21:49 UTC (Mon)
                               by <b>foom</b> (subscriber, #14868)
                              [<a href="/Articles/785290/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't know.<br>
<p>
It does seem rather incongruous to me to justify the feature via by pointing to samba's emulation of NTFS case folding, and Android's emulation of FAT file name lookup rules, but then implementing unicode normalization and correct unicode case folding...which those don't do.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785290/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor785730"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 11, 2019 20:49 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/785730/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Because, as I understand it, utf-16 is now seen to have been a mistake.<br>
<p>
Forcing all filenames to be valid utf-16 will break quite a lot elsewhere ... I think that if you want to implement the utf universe properly in utf-16, you end up back with the 8-bit codeset mess, only bigger ...<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785730/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785759"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 11, 2019 23:15 UTC (Thu)
                               by <b>foom</b> (subscriber, #14868)
                              [<a href="/Articles/785759/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Er what? I don't really understand your comment, but NTFS doesn't implement utf-16.<br>
<p>
It stores filenames as arbitrary sequences of 16-bit values. There are a few tens of values you cannot use (ascii control characters 0-31, and some ascii punctuation), but everything else is fair game. In particular, invalid utf16 containing broken surrogate pairs is perfectly fine.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785759/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor785139"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 7, 2019 22:40 UTC (Sun)
                               by <b>jschrod</b> (subscriber, #1646)
                              [<a href="/Articles/785139/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ahem...<br>
<p>
I think a case could be made that one could blame Unicode for *not* representing these different alphabets. After all, the same code point is used for "different" characters in the alphabets - if one agrees to your statement that these are really different alphabets.<br>
<p>
But, in real life, too much water has flown under this bridge to discuss it outside an evening in a wine bar with some friends who are encoding freaks. I have to admit I would be part of such a discussion... ;-)<br>
<p>
Cheers, Joachim<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785139/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor785623"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 11, 2019 13:12 UTC (Thu)
                               by <b>robbe</b> (guest, #16131)
                              [<a href="/Articles/785623/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I blame Unicode for the fact that they did not spend a codepoint for LATIN SMALL LETTER I WITH DOT ABOVE.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785623/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor784334"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 29, 2019 14:54 UTC (Fri)
                               by <b>mina86</b> (guest, #68442)
                              [<a href="/Articles/784334/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There's also the curious case of lc(ẞ) = ß but uc(ß) = SS. Or sigma having two lower case forms. I anticipate a world of pain and kernel devs will have only themselves to blame. ;)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784334/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784409"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 30, 2019 4:27 UTC (Sat)
                               by <b>gps</b> (subscriber, #45638)
                              [<a href="/Articles/784409/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Nah, that world of pain already exists. Today it is distributed among umpteen different application and library implementations that differ.<br>
<p>
What's one more?  Some of the above could even go away after this in some system designs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784409/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784449"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 31, 2019 14:41 UTC (Sun)
                               by <b>mina86</b> (guest, #68442)
                              [<a href="/Articles/784449/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  Nah, that world of pain already exists. Today it is distributed among umpteen different application and library implementations that differ.</font><br>
<p>
That may be so but I'd rather my Samba server crashed than my kernel oopsed or executed malicious code because Unicode was handled incorrectly. Just like putting HTTP server inside the kernel wasn't a good idea, I'm not yet convinced that putting Unicode handling is.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784449/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor785153"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 8, 2019 6:24 UTC (Mon)
                               by <b>cpitrat</b> (subscriber, #116459)
                              [<a href="/Articles/785153/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If only more people were as reasonable as Irish who changed the Gaelic alphabet to be compatible with typewriters (changing there accentuated laters with combinations of naked letters, like gh) and therefore now don't have any problem like this ...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785153/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785732"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 11, 2019 20:57 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/785732/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well if you do this, aren't you going eventually to end up with just one letter in your alphabet? Okay, I'm being facetious, but this happened to the Roman alphabet in the ?1400s, when printing arrived. Pre-printing, the written English alphabet had a fair few more letters than 26. I'm not sure of the details, but at least one example is the replacement of thorn (looks like the Yen symbol) with Y, hence all the signs "Ye Olde Coffee Shop".<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785732/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor784692"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 2, 2019 21:10 UTC (Tue)
                               by <b>daniels</b> (subscriber, #16193)
                              [<a href="/Articles/784692/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Is emoji in LWN article body text, one of the four horsemen?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784692/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor784705"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 2, 2019 23:31 UTC (Tue)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/784705/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One of the four horsemen of the a-PILE-OF-POO-calypse, perhaps? (AU+1F4A9calypse for short, but that's harder to pronounce.)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/784705/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor785580"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 11, 2019 5:01 UTC (Thu)
                               by <b>lysse</b> (guest, #3190)
                              [<a href="/Articles/785580/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Crapocalypse?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785580/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor785872"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Working with UTF-8 in the kernel</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 12, 2019 20:12 UTC (Fri)
                               by <b>donbarry</b> (guest, #10485)
                              [<a href="/Articles/785872/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I'm really astonished that this userspace library is in the kernel to allow several application servers intended to bridge compatibility with broken operating systems to be somewhat simpler.<br>
<p>
At this rate, and aided by its UTF library, by Zawinski's law soon the kernel will contain an email client.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/785872/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2019, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
