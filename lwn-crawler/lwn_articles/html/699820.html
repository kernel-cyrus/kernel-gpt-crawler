        <!DOCTYPE html>
        <html lang="en">
        <head><title>AMD memory encryption technologies [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/699820/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/698957/">Return to the Security page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/699820/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>AMD memory encryption technologies</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>We're bad at marketing</b>
<p>
We can admit it, marketing is not our strong suit. Our strength is
writing the kind of articles that developers, administrators, and
free-software supporters depend on to know what is going on in the
Linux world. Please <a href="/Promo/nsn-bad/subscribe">subscribe today</a> to help us keep doing that, and so
we don’t have to get good at marketing.
</blockquote>
<div class="FeatureByline">
           By <b>Jake Edge</b><br>September 8, 2016</br>
           <hr>
<a href="/Archives/ConferenceByYear/#2016-Linux_Security_Summit">Linux Security Summit</a>
</div>
<p>
Today's virtual machines (VMs) have a variety of protections from their
brethren, but hypervisor or kernel bugs can allows guests to access the
memory of other guests.  In addition, providers of VMs can see the memory
of any of the guests, so users of public clouds have to place a lot of
trust in their provider.  AMD has some upcoming features in its x86
processors that will encrypt memory in ways that alleviate some of these
problems.  David Kaplan gave a presentation about these new technologies at
the Linux Security Summit in Toronto.
</p>

<a href="/Articles/699853/">
<img src="https://static.lwn.net/images/2016/lss-kaplan-sm.jpg" border=0 hspace=5 align="right"
alt="[David Kaplan]" title="David Kaplan" width=212 height=300>
</a>

<p>
The motivation for these features is the cloud environment.  Currently, the
hypervisor must enforce the isolation between guests through a variety of
means: hardware virtualization support, page tables, VM intercepts, and so
on.  But sometimes those break down, leading to various vulnerabilities
that allow guests to access other guests, which is scary, he said.
</p>

<p>
But users are required to trust their cloud providers since they have full
access to 
all guest memory to extract secrets or even to inject code into VMs.  The
cloud providers would rather not have that power, Kaplan said; they do not
want to be able to see their customers' data.  For one thing, that protects
the providers from "rogue admin" attacks, where a disgruntled employee uses
the unwanted access to attack a customer.
</p>

<p>
That kind of attack, as well as those where a guest gets access to
another guest's memory, are "user-access attacks", he said.  AMD is
targeting those as well as "physical-access attacks", where someone with
access to the hardware can probe the physical DRAM interface or freeze and
steal the 
memory chips (e.g. a <a
href="https://en.wikipedia.org/wiki/Cold_boot_attack">cold boot
attack</a>).  How important it is to resist those and other, similar attacks
depends on who you talk to, he said.
</p>

<p>
There are two separate features—Secure Memory Encryption
(SME) and Secure Encrypted Virtualization (SEV)—that both use the same hardware support
that will be provided in upcoming processors.  That support includes an AES-128
hardware engine inline with the RAM and memory controller so that memory
can be encrypted and decrypted on the way in and out of the processor with
"minimal performance impact".   The data inside the processor
(e.g. registers, caches) will be in the clear; there will just be a "little
extra latency" when RAM is involved.
</p>

<p>
All of the keys will be managed within the SoC by the AMD Secure Processor,
which is a separate 32-bit ARM Cortex A5 that is present on recent SoCs.
It runs a secure (closed source) operating system and enables
hardware-validated boot.  It is 
used in some laptops as a firmware <a
href="https://en.wikipedia.org/wiki/Trusted_Platform_Module">Trusted
Platform Module</a> (TPM).  The secure processor will only run AMD-signed
code; it also provides cryptographic key generation and management functions.
</p>

<p>
Of the two features, SME is the simplest.  It uses a single key that is
generated at boot time using the random-number generator to transparently
encrypt pages 
that have been marked with a special "encrypted" bit in the page-table
entry.  The operating system or hypervisor manages which pages will be
encrypted in RAM by use of that bit.  There is support for hardware
devices to DMA to and from encrypted memory as well.  SME is targeted at
thwarting physical-access attacks, since the contents of memory will be
inaccessible without the key that is not accessible outside of the secure
processor. 
</p>

<p>
SEV, on the other hand, is more complicated.  It has multiple encryption
keys in the design and is meant to protect guests' memory from each other
and from 
the hypervisor.  The eventual goal, Kaplan said, is for the hypervisor to
have no view into the guest.
</p>

<p>
There are keys for the hypervisor and for each VM, though groups of
VMs could share keys and some VMs might be unsecured.  SEV
cryptographically isolates the guests and hypervisor to the point where
cache lines (which are unencrypted) are tagged with an ID that specifies
which address space they belong to; the processor will prevent guests from
accessing the cache of other guests.
</p>

<p>
The owner of a guest is a "key player" in using SEV, Kaplan said.
Information like secrets and policies will need to be transferred to the
secure processor using the hypervisor to transport that data.  Since the
hypervisor is untrusted in this model (so that cloud providers do not have
access to customer secrets), the guest owner will create a secure channel
to the secure processor (through the hypervisor) using Diffie-Hellman (DH)
key exchange. 
</p>

<p>
Launching a guest is a somewhat complicated process; Kaplan's <a
href="http://events.linuxfoundation.org/sites/events/files/slides/AMD%20x86%20Memory%20Encryption%20Technology%20LSS%20Slides.pdf">slides
[PDF]</a> may be of interest for those who want more details.  The
hypervisor begins by loading an unencrypted BIOS or OS image into memory.
The guest owner then supplies their DH key and the hypervisor facilitates
the creation of a secure channel between the guest owner and the secure
processor (without being able to eavesdrop on the traffic).  Part of that
exchange will provide the guest owner with a certificate that allows them
to prove that they
are truly talking to the secure processor.
</p>

<p>
The hypervisor then allocates an "address space identifier" (ASID), which
is what identifies the guest (and the key for that guest's memory).  That
ASID is provided to the secure processor with a request to generate or load
a key into the AES engine and to encrypt the BIOS/OS image using that key.
The hypervisor then sets up and runs the guest using the ASID assigned; the
memory controller, AES engine, and secure processor will work together to
ensure that the memory is encrypted and decrypted appropriately.
</p>

<p>
The hypervisor will also send a "launch receipt" to the user that includes
a measurement (hash) of the image and some platform authentication
information.  If the user is provided with the right measurement, they can then
provide secrets like disk encryption keys to the guest over a secure
channel (e.g. TLS).
</p>

<p>
There are two levels of page tables: one for the guest and one for the
hypervisor.  The guest tables determine whether the memory is private or is
shared with the hypervisor.  All executable pages are private (no matter
the setting), as are the guest's page tables.  Data pages can be either, but
DMA must use shared pages.
</p>

<p>
A common question that is asked is in regards to the ASID: couldn't the
hypervisor "spoof" a different ASID?  The answer is that it could, but
it wouldn't really gain it anything.  If it tries walking the guest page tables
or executing code using the wrong key, it will not be particularly
successful.
SEV is meant to block a range of attacks, both physical and user access;
the intent is to reduce the attack surface even more in coming years.
</p>

<p>
In order to use SEV, both hypervisors and guests will need to change to
support it.  There are a number of software components required, some that
AMD expects to ship and others that it is working with the open-source
community on.  The secure processor firmware is distributed in binary form
and the source is not public.  There is a Linux driver to support the
secure processor that has been posted for review.  The open-source
hypervisor support is also being worked on.
</p>

<p>
There was a question about why AMD had not used the TPM API for its secure
processor.   Kaplan said there was interest in a simpler API that focused
on the VM launch cycle.  But the API is available and is only in beta at
this point, so those interested should comment.  Also, as is often the case
with processor features, Kaplan was unable to say when SoCs with either
feature would be available.
</p>

<p>
[I would like to thank the Linux Foundation for travel support to attend
the Linux Security Summit in Toronto.]<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Memory_management-Memory_encryption">Memory management/Memory encryption</a></td></tr>
            <tr><td><a href="/Archives/ConferenceIndex/">Conference</a></td><td><a href="/Archives/ConferenceIndex/#Linux_Security_Summit-2016">Linux Security Summit/2016</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/699820/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor700021"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 9, 2016 5:34 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/700021/">Link</a>] (15 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Part of that exchange will provide the guest owner with a certificate that allows them to prove that they are truly talking to the secure processor. </font><br>
However, a sufficiently malicious hypervisor can provide a invalid certificate and patch the code in the guest that checks this certificate.<br>
<p>
And likely it won't even be too complicated.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700021/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700080"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 9, 2016 13:33 UTC (Fri)
                               by <b>yaap</b> (subscriber, #71398)
                              [<a href="/Articles/700080/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The user should verify the given certificate and make sure it's signed by AMD. It won't protect against an organization able to extract the AMD root of trust certificate, but in practice it's still better than the current state. I don't think that being stolen by the NSA is big concern for a bank for example ;)<br>
<p>
As for patching the code in the guest, it's not possible in RAM and it's not possible if the virtual disk is encrypted with a key provided only to the guest once the certificate is verified as good and over a secure channel. The the HV can only do a DoS (not useful here) but can't tamper with the guest.<br>
<p>
Devil is in the details, but it looks ok to me.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700080/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700087"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 9, 2016 14:03 UTC (Fri)
                               by <b>luto</b> (subscriber, #39314)
                              [<a href="/Articles/700087/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Looks less than okay to me.  It's not secure against a malicious hypervisor that tries hard to break it.<br>
<p>
<p>
<a href="https://lwn.net/Articles/686814/">https://lwn.net/Articles/686814/</a><br>
<p>
<a href="http://www.mail-archive.com/linux-doc@vger.kernel.org/msg02713.html">http://www.mail-archive.com/linux-doc@vger.kernel.org/msg...</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700087/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor700199"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 9, 2016 21:29 UTC (Fri)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/700199/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The problem is with the client code that checks this certificate. It can easily be patched to accept fake certs.<br>
<p>
Various obfuscation schemes would only delay the inevitable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700199/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700220"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2016 2:34 UTC (Sat)
                               by <b>geertj</b> (subscriber, #4116)
                              [<a href="/Articles/700220/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Various obfuscation schemes would only delay the inevitable.</font><br>
<p>
I'm somewhat optimistic that the problem can be solved. First, on a meta-level, would AMD pour 10s of millions of dollars into a complicated new silicon feature if it were just obfuscation and no cryptographic security could be had? It's possible but in my view unlikely as AMD  have some very sharp engineers.<br>
<p>
The solution would use a third, trusted server that runs on hardware you own and trust (this could be in your own data center). You need that server anyway to store the keys to unlock the disk images of your VMs (we don't trust the cloud so we need to use encrypted disk images). The untrusted hypervisor would load an unencrypted initrd that tries to mount the root file system. In order unlock the disk image, the initrd would call home to the configured trusted server.<br>
<p>
Before giving the disk encryption key, that trusted server would do a DH exchange proxied via the initrd directly to the remote secure processor. You now have a safe channel between two trusted end points. The trusted server could ask the SP for a hash of the initrd (and any loaders that chain loaded into it.) and of the memory. Those can be checked to match trusted fingerprints. Then the trusted server can ask the SP to start encrypting the VM memory as long as it matches the hash (to prevent races).The memory hash would have to exclude local state. Once SEV is enabled you also likely want to have the SP check that indeed you're talking to your own initrd and not some man in the middle. This can probably be done through some challenge/response mediated by the SP. Once you have validated the integrity of the boot chain, that you're talking to "your" initrd, and that the SP tells you that your initrd is now protected using SEV, I think you've succesfully bootstrapped a trusted VM. You can now provide the disk encryption key and continue the boot.<br>
<p>
I do agree that SEV v1 still has some holes, but I think those are not fundamental just limitations of the current implementation:<br>
<p>
* Memory is encrypted but not integrity protected. Modifying the encrypted memory at a certain offset will easily lead to crashes that can be exploited.<br>
* The VM control block apparently leaks register contents. This is mentioned in the thread referred to in a sibling to the parent comment.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700220/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700221"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2016 2:59 UTC (Sat)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/700221/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Basically, you have to establish an unbroken DH chain between your trusted hardware and the AMD secure authentication chip in the motherboard.<br>
<p>
It's theoretically possible, but will be quite complicated in practice and likely to have lots of holes allowing a hypervisor to mess with you. It can try timing attacks, random number poisoning and so on.<br>
<p>
It's better than nothing as it protects against non-malicious hosting providers, but unlikely to thwart entities like NSA.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700221/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor700223"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2016 4:19 UTC (Sat)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/700223/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I'm somewhat optimistic that the problem can be solved. First, on a meta-level, would AMD pour 10s of millions of dollars into a complicated new silicon feature if it were just obfuscation and no cryptographic security could be had? It's possible but in my view unlikely as AMD have some very sharp engineers.</font><br>
<p>
That logic does not work in practice, for a related example, look at the engineering effort that has gone into failed DRM systems.  <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700223/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700263"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2016 15:34 UTC (Sat)
                               by <b>geertj</b> (subscriber, #4116)
                              [<a href="/Articles/700263/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; That logic does not work in practice, for a related example, look at the engineering effort that has gone into failed DRM systems. </font><br>
<p>
That is one example indeed. But in this case I was specifically talking about AMD. It is a high tech company with an strong and reputable engineering culture. In the case of DRM, the tech was driven by the RIAA and the MPIAA which are burocratic monopolists and definitely not tech savvy.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700263/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor700419"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 12, 2016 19:25 UTC (Mon)
                               by <b>davidstrauss</b> (guest, #85867)
                              [<a href="/Articles/700419/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; The problem is with the client code that checks this certificate. It can easily be patched to accept fake certs.</font><br>
<p>
Yes, but the guest would probably need to be restarted so the attacker can MitM the negotiation. If gaining malicious control of the hypervisor requires restarting guests to gain access, the attack still becomes a lot more noisy, which is still an improvement over today. I support making systems more tamper-evident even when we can't make them fully tamper-resistant.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700419/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700423"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 12, 2016 20:00 UTC (Mon)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/700423/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I don't know about this. All security-related changes usually have operational costs, it's not really clear for me that in this case it's really worth it.<br>
<p>
Whole memory encryption to thwart simple "pull out RAM chips" attacks certainly makes sense, though.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700423/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700425"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 12, 2016 20:47 UTC (Mon)
                               by <b>davidstrauss</b> (guest, #85867)
                              [<a href="/Articles/700425/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; I don't know about this. All security-related changes usually have operational costs, it's not really clear for me that in this case it's really worth it.</font><br>
<p>
This approach probably has implementation (and maintenance for the implementation), but it sounds like it's the sort of design that a hypervisor or guest OS could use by convention/detection without explicit administrator work (other than, say, turning it on).<br>
<p>
<font class="QuotedText">&gt; Whole memory encryption to thwart simple "pull out RAM chips" attacks certainly makes sense, though.</font><br>
<p>
It also prevents a machine-local compromise (assuming a way to trick secure boot, exploit a management module, or putting in a USB key with malicious firmware). I'd actually like this on my laptop for the host OS, even.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700425/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700426"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 12, 2016 20:57 UTC (Mon)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/700426/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; This approach probably has implementation (and maintenance for the implementation), but it sounds like it's the sort of design that a hypervisor or guest OS could use by convention/detection without explicit administrator work (other than, say, turning it on).</font><br>
Not really. It needs active participation from the guest OS and a third party that does remote attestation to provide decryption keys to fully utilize this.<br>
<p>
<font class="QuotedText">&gt; It also prevents a machine-local compromise (assuming a way to trick secure boot, exploit a management module, or putting in a USB key with malicious firmware). I'd actually like this on my laptop for the host OS, even.</font><br>
It won't protect your laptop in case of a trusted boot breach. Also, kernel/OS updates will be tricky.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700426/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor704506"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 25, 2016 3:52 UTC (Tue)
                               by <b>immibis</b> (guest, #105511)
                              [<a href="/Articles/704506/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That client code might run on another machine physically controlled by the client.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/704506/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor700257"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2016 14:57 UTC (Sat)
                               by <b>bdell</b> (subscriber, #84268)
                              [<a href="/Articles/700257/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Isn't the "guest owner" here the end user controlled system requesting the VM from the hypervisor, not code in the VM? The hypervisor can't patch in bad certificate checks in that case.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700257/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700288"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 11, 2016 1:22 UTC (Sun)
                               by <b>Cyberax</b> (<b>&#x272D; supporter &#x272D;</b>, #52523)
                              [<a href="/Articles/700288/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It's the code inside the VM. If you have a trusted external system then you build an authentication chain that includes the guest VM to obtain an encryption key to unlock important data.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700288/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700289"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 11, 2016 2:18 UTC (Sun)
                               by <b>bdell</b> (subscriber, #84268)
                              [<a href="/Articles/700289/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I guess I was going by slide 10 where the "guest owner" box is outside the box with all the hardware bits. The diagrams with the sequence of steps augment the box with "user". The secure processor supplies info about what was launched after the hypervisor can no longer tamper with it ultimately to the guest owner in slide 15 where it can be validated and authenticated before the disk encryption key is supplied to the VM. I don't see how the guest owner is inside the VM or can be tricked.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700289/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor700028"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 9, 2016 6:37 UTC (Fri)
                               by <b>zuki</b> (subscriber, #41808)
                              [<a href="/Articles/700028/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I cannot figure out one thing:<br>
the hypervisor knows the ASID of a guest. What stops the hypervisor from adding a page table mapping for itself using this ASID for all of pages it has allocated for the guest and scanning those pages for any useful secrets?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700028/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700082"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 9, 2016 13:38 UTC (Fri)
                               by <b>yaap</b> (subscriber, #71398)
                              [<a href="/Articles/700082/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Just guessing, but I would expect a read or write transaction to be tagged with the initiating ASID --- I can't see how the system could work otherwise in a multicore SMT system. Then the MMU hardware can check that the source ASID matches the target page ASID and if not block the access/trigger an exception.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700082/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor700072"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 9, 2016 12:36 UTC (Fri)
                               by <b>OwenT</b> (guest, #110558)
                              [<a href="/Articles/700072/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; It runs a secure (closed source) operating system</font><br>
I understand why AMD have chosen to keep this closed source: it's proprietary and not a great deal of use to anyone who doesn't manufacture processors, so they're unlikely to be accepting pull requests on GitHub. However, I'm still a bit disappointed in this as it makes third-party verification of the process much harder, and I'd love to see AMD open this up for review in some way.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700072/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor700214"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 10, 2016 0:33 UTC (Sat)
                               by <b>flussence</b> (guest, #85566)
                              [<a href="/Articles/700214/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I have my doubts whether having something like that out in the open would help or hurt. It's PC motherboard firmware after all — which manufacturers are notoriously useless about keeping up to date and patched. (If they were more responsible, we wouldn't need workarounds like early microcode)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700214/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor700998"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Sep 17, 2016 6:22 UTC (Sat)
                               by <b>toyotabedzrock</b> (guest, #88005)
                              [<a href="/Articles/700998/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The one issue is that without a secure place to store the disk encryption key on the system, inside a tamper resistant tpm the VM admin would have to provide it when ever the system is booted.  And that admin would need to check that the certificate matched before providing that key. <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/700998/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor748901"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">AMD memory encryption technologies</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Mar 9, 2018 3:15 UTC (Fri)
                               by <b>gdamjan</b> (subscriber, #33634)
                              [<a href="/Articles/748901/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
that seems to be the "launch receipt" that's sent by the "Secure processor"<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/748901/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2016, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
