        <!DOCTYPE html>
        <html lang="en">
        <head><title>Kernel quality control, or the lack thereof [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/774114/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/774101/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/774114/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>Kernel quality control, or the lack thereof</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>Did you know...?</b>
<p>
LWN.net is a subscriber-supported publication; we rely on subscribers
       to keep the entire operation going.  Please help out by <a
       href="/Promo/nst-nag4/subscribe">buying a subscription</a> and keeping LWN on the
       net.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>December 7, 2018</br>
           </div>
Filesystem developers tend toward a high level of conservatism when it
comes to making changes; given the consequences of mistakes, this seems
like a healthy survival trait.  One might rightly be tempted to regard a
recent disagreement over the backporting of filesystem-related fixes to the
stable kernels as an example of this conservatism, but there is more to
it.  The kernel development process has matured in many ways over the
years; perhaps this discussion hints at some of the changes that will be
needed to continue that maturation in the future.
<p>
While tracking down some problems with the XFS file cloning and
deduplication features (the <tt>FICLONERANGE</tt> and 
<tt>FIDEDUPERANGE</tt> <tt>ioctl()</tt> calls in particular), the
developers noticed that, in fact, many aspects 
of those interfaces did not work correctly.  Resource limits were not
respected, users could overwrite a setuid file without resetting the setuid
bits, time stamps would not be updated, maximum file sizes would be
ignored, and more.  Many of these problems were fixed in XFS itself, but
others affected all filesystems offering those features and needed to be
fixed at the virtual filesystem (VFS) level.  The result was a series of
pull requests including <a
href="https://git.kernel.org/linus/4718dcad7decac3a43b7339b2226f3d987cca75c">this
one</a> for 4.19-rc7, <a
href="https://git.kernel.org/linus/c2aa1a444cab2c673650ada80a7dffc4345ce2e6">this
one</a> for the 4.20 merge window, and
<a
href="https://git.kernel.org/linus/abe72ff4134028ff2189d29629c40a40bee0a989">this
one</a> for 4.20-rc4.
<p>
More recently, similar problems have been discovered with the
<a
href="http://man7.org/linux/man-pages/man2/copy_file_range.2.html"><tt>copy_file_range()</tt></a>
system call, resulting in <a
href="/ml/linux-fsdevel/20181203083416.28978-1-david@fromorbit.com/">this
patch set</a> full of fixes.  Once again, issues include the ability to
overwrite setuid files, 
overwrite swap files, change immutable files, and overshoot resource
limits.  Time stamps are not updated, overlapping copies are not caught,
and behavior between filesystems is inconsistent.  Chinner's patch set
contains another set of changes,
almost all at the VFS level, to straighten these issues out.
<p>
<h4>Mainline quality assurance</h4>
<p>
The discovery of these bugs has brought a fair amount of disappointment
with it.  It seems clear that these new features were not extensively
tested before being added to the kernel; certainly no automated tests had
been added to the xfstests suite to verify them.  Dave Chinner <a
href="/ml/linux-kernel/20181130214548.GO19305@dastard/">put it</a> this
way:
<p>
<div class="BigQuote">
	We ended up here because we *trusted* that other people had
	implemented and tested their APIs and code properly before it got
	merged. We've been severely burnt, and we've been left to clean up
	the mess made by other people by ourselves.
</div>
<p>
In time, these bugs will be fixed and users of all filesystems should
benefit.  <a
href="/ml/linux-xfs/154416379233.15344.4377231692638417530.stgit@magnolia/">Tests
are being added</a> to help ensure that these features continue to work in
the future.  This is clearly a necessary effort; Chinner and Darrick Wong
are performing a service for the kernel community as a whole by taking it
on.  This work does raise a couple of interesting issues, though.
<p>
The first of those is the prospect of regressions in programs that have
come to depend on the behavior of these system calls as it is supported in
current kernels on specific filesystems.  <a
href="http://www.hyrumslaw.com/">Hyrum's law</a> suggests that such users
are likely to exist.  Or, as Chinner <a
href="/ml/linux-api/20181203081034.GW19305@dastard/">put it</a>: "<q>the
API implementation is so broken right now that fixing it is almost
guaranteed to break something somewhere</q>".  That could lead to some
interesting discussions if users start to complain that kernel updates have
broken their programs.
<p>
<h4>Stable updates</h4>
<p>
The other question that arises concerns the backporting of all these fixes
to the stable kernel updates; indeed, it was the <a
href="/ml/linux-kernel/20181129060110.159878-25-sashal@kernel.org/">selection
of one of the VFS fixes</a> for backporting that set off the current
conversation.  The XFS developers have long been hostile to the automatic
inclusion 
of their patches in stable updates, feeling that the work to validate those
patches in older kernels has not been done and that the risk of creating
new regressions is too high.  As a result, XFS patches are not normally
considered eligible for backporting, but that exclusion does not extend to
fixes at the VFS layer.
<p>
In this case, Chinner <a
href="/ml/linux-kernel/20181129224019.GM19305@dastard/">stated</a> that the
current set of fixes has been validated for the mainline with a testing
regime that runs billions of operations over a period of days; anything
less risks not exposing some of the harder-to-hit bugs.  Backporting those
fixes to a different kernel would require the same level of testing to
create the needed confidence that they don't create new problems, he said,
and the XFS developers are too busy still fixing bugs to do that testing
now.
<p>
Chinner <a href="/ml/linux-kernel/20181202232302.GT19305@dastard/">followed
up</a> with a lengthy indictment of the kernel development process as a
whole, saying that it is focused on speed and patch quantity rather than
the quality of the final result.  The stable kernel process, in particular, is
"<q>optimised to shovel as much change as possible with /as little
effort as possible/ back into older code bases</q>".  He pointed out
that changes often appear in stable releases before they show up in a real
mainline release (as opposed to an -rc release), which doesn't leave a
whole lot of time for real stabilization.  It is not, he feels, a small
problem:
<p>
<div class="BigQuote">
	I'm taking that one step further - what we are seeing here is the
	kernel community's systemic inability to address fundamental
	engineering process deficiencies because "speed and quantity" are
	considered more important than the quality of the product being
	produced.
</div>
<p>
Sasha Levin <a
href="/ml/linux-kernel/20181203092241.GC235790@sasha-vm/">responded</a>
that the current process is the best that we can do at the moment:
<p>
<div class="BigQuote">
	This is a case where theory collides with the real world. Yes, our
	QA is lacking, but we don't have the option of not doing the
	current process.  If we stop backporting until a future data where
	our QA problem is solved we'll end up with what we had before:
	users stuck on ancient kernels without a way to upgrade.
</div>
<p>
For the time being, the VFS and XFS patches will not be included in the
stable kernel updates.  Once the fixes are complete and the filesystem test
suites have been filled out, Wong <a
href="/ml/linux-kernel/20181130203527.GP8125@magnolia/">said</a>, it should
be possible to safely backport the whole set.  At that point, this
particular issue will be solved, but that is not likely to happen until
after the 4.21/5.0 kernel release.
<p>
For the longer term, there is still the problem that, as Wong put it:
"<q>New features show up in the vfs without a lot of design
documentation, incomplete userspace interface manuals, and not much beyond
trivial testing</q>".  One might well argue that this problem extends
beyond VFS features.  The kernel community has never had much of a process
around the addition of APIs visible to user space; there are no real
requirements to ensure adequate documentation, testing, or consistency
between interfaces.  The results can be seen in our released kernels, and
in the API mistakes that just barely escape release because the right
developer happened to notice them in time.
<p>
Over the years, the kernel community has matured considerably in a number
of ways.  One need only look back to the days when we had no source-code
management system, no rules on regressions, and no release-management
discipline to see how much things have improved.  The last few years have
seen some big improvements 
around automated testing in particular.  For all of our problems, the
quality of our 
releases is quite a bit higher than it once was, even if it is not what it
should be.  Given time, it is
reasonable to expect that we can build on that base to further focus our
processes on the quality of the kernels we release, if that is something
that the community decides it wants to do.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Development_model-Kernel_quality">Development model/Kernel quality</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#System_calls-copy_file_range">System calls/copy_file_range()</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/774114/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor774285"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 7, 2018 19:21 UTC (Fri)
                               by <b>zblaxell</b> (subscriber, #26385)
                              [<a href="/Articles/774285/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; users could overwrite a setuid file without resetting the setuid bits, time stamps would not be updated, </font><br>
<p>
I always have to read these patch sets to make sure that when the above are features, they aren't getting removed.<br>
<p>
There's a "if (!is_dedupe)" in the code, so it's all good.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774285/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor774288"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 7, 2018 20:27 UTC (Fri)
                               by <b>johannbg</b> (guest, #65743)
                              [<a href="/Articles/774288/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Ah the inevitable cutting the ( legacy ) fat off and calling a flag day draws near with everyone must upgrading to that kernel release when that day comes.<br>
<p>
Dare I predict 2020 will be the year when that day comes in the spirit of Jon predictions will soon be upon us ;)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774288/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor774289"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 7, 2018 20:38 UTC (Fri)
                               by <b>mgross</b> (guest, #38112)
                              [<a href="/Articles/774289/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This is a hard problem.  I'm glad to see it getting attention.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774289/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor774305"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 8, 2018 1:20 UTC (Sat)
                               by <b>vomlehn</b> (guest, #45588)
                              [<a href="/Articles/774305/">Link</a>] (11 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
One hopes that these test will be added to a well maintained test project, though such projects are even less common than a well maintained development project. LTP comes to mind but there may be other possibilities. And, tests that aren't run don't really exists, for all practical purposes.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774305/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774357"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 8, 2018 16:45 UTC (Sat)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/774357/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt;  And, tests that aren't run don't really exists, for all practical purposes.</font><br>
<p>
Agreed 200%, this is the core issue:<br>
<p>
<font class="QuotedText">&gt; &gt; We ended up here because we *trusted* that ...</font><br>
<p>
Either tests already exist and it's just the matter of the extra mile to automate them and share their results.<br>
<p>
Or there's no decent, repeatable and re-usable test coverage and new features should simply not be added until there is. "Thanks your patches looks great, now where are your tests results please?". Not exactly ground-breaking software engineering.<br>
<p>
Exceptions could be tolerated for hardware-specific or pre-silicon drivers which require very specific test environments and for which vendors can only hurt themselves anyway. That clearly doesn't seem the case of XFS or the VFS.<br>
<p>
Validation and automation have a lesser reputation than development and tend to attract less talent. One possible and extremely simple way to address this is to treat the *development* of tests and automation to the same open-source and code review standards.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774357/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774383"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 9, 2018 11:17 UTC (Sun)
                               by <b>iabervon</b> (subscriber, #722)
                              [<a href="/Articles/774383/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think, for this case, fuzzing is probably more useful that developer-written tests. If a developer misses the code for some checks necessary to maintain security constraints, what are the chances they'll write tests that verify that using the API in a way they didn't intend doesn't violate security constraints they didn't think about? I'd be more convinced if they taught a fuzzing framework how to call their API and set it loose on a filesystem with a lot of interesting cases. I care somewhat less that it does what it's supposed to do than that whatever it actually does is something the caller is allowed to do.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774383/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774393"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 9, 2018 14:20 UTC (Sun)
                               by <b>saffroy</b> (guest, #43999)
                              [<a href="/Articles/774393/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Fuzzing is extremely useful, but it still needs a *thinking* developer to help it generate interesting cases in reasonable time.<br>
<p>
Besides tests themselves, it helps a LOT to have some kind of test coverage report, just to remind you of which parts of the code are never touched by any of your current tests.<br>
<p>
Do people publish such coverage reports for the kernel?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774393/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774431"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 10, 2018 9:49 UTC (Mon)
                               by <b>metan</b> (subscriber, #74107)
                              [<a href="/Articles/774431/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The tool to generate coverage for kernel is maintained at <a href="https://github.com/linux-test-project/lcov">https://github.com/linux-test-project/lcov</a> it should work, but I haven't tried it.<br>
<p>
However I can pretty much say that the main problems I see are various corner cases that are rarely hit (i.e. mostly failures and error propagation) and drivers. My take on this is that there is no point in doing coverage analysis when the gaps we have are enormous and easy to spot. Just have a look at our backlog of missing coverage in LTP at the moment <a href="https://github.com/linux-test-project/ltp/labels/missing%20coverage">https://github.com/linux-test-project/ltp/labels/missing%...</a>, and these are just scratching the surface with most obviously missing syscalls. We may try to proceed with the coverage analysis once we are out of work there, which will hopefully happen at some point.<br>
<p>
The problems with corner cases can be likely caught by combination of unit testing and fuzzing. Drivers testing is more problematic though, there is only so much you can do with qemu and emulated hardware. Proper driver testing needs a reasonably sized lab stacked with hardware and it's much more problematic to set up and maintain which is not going to happen unless somebody invests reasonable amount of resources into it. But there is light at the end of the tunnel as well, as far as I know Linaro has a big automated lab stacked with embedded hardware to run tests on, we are trying to tackle automated server grade hardware lab here in SUSE, and I'm pretty sure there is a lot more outside there just not that visible to the general public.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774431/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774438"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 10, 2018 12:57 UTC (Mon)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/774438/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Yeah -- and lcov won't help with the sorts of things this LWN post is talking about anyway. 100%-coverage filesystems could easily still have all these bugs, because they relate to specific states of the filesystem, and *no* coverage system could *possibly* track whether we got complete coverage of all possible corrupted filesystems! (Or, indeed, all possible states of the program: for all but the most trivial programs there are far too many.)<br>
<p>
There is no alternative to thinking about these problems, I'm afraid. There is no magic automatable road to well-tested software of this complexity.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774438/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774439"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 10, 2018 13:14 UTC (Mon)
                               by <b>metan</b> (subscriber, #74107)
                              [<a href="/Articles/774439/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Exactly there is nothing that would replace well thought tests written by senior developers, we only need to throw more manpower on the problem, which seems to be happening albeit slowly.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774439/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774597"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 11, 2018 17:37 UTC (Tue)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/774597/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Indeed if there is any part of the kernel this has really happened for, filesystems and in particular XFS must be it, and probably have the best test coverage of all. I mean, xfstests is called that for a *reason*. :) (I tell a lie: RCU has gone to the next step beyond this, formal model verification. Coming up with a formal model of XFS would be... a big job!)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774597/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774624"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 11, 2018 20:59 UTC (Tue)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/774624/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Interesting, now the question is: how much did/do xfstests offer for the two specific features reported above?<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774624/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor774401"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 9, 2018 17:28 UTC (Sun)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/774401/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Features or security? Sad but the priority has to be the former to do business. Have fewer more secure features and you lose in the market place almost every time.<br>
<p>
Thinking of it computer security is a bit like... healthcare: extremely opaque and nearly impossible for customers to make educated choices about it. From a legal perspective I suspect it's even worse, breach after breach and absolutely zero liability. To top it up class actions are no longer, killed by arbitration clauses in all Terms and Conditions. Brands might be more useful in security though.<br>
<p>
<p>
<a href="https://www.google.com/search?q=site%3Aschneier.com+liability">https://www.google.com/search?q=site%3Aschneier.com+liabi...</a><br>
<p>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774401/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor774392"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 9, 2018 13:32 UTC (Sun)
                               by <b>mupuf</b> (subscriber, #86890)
                              [<a href="/Articles/774392/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Validation and automation have a lesser reputation than development and tend to attract less talent. One possible and extremely simple way to address this is to treat the *development* of tests and automation to the same open-source and code review standards.</font><br>
<p>
This is what we do in the i915 community. No feature lands in DRM without a test in IGT, and CI developers are part of the same team.<br>
<p>
My view on this is that good quality comes from:<br>
 1) Well written driver code, peer reviewed to catch architectural issues<br>
 2) Good tests exercising the main use case, and corner cases. Tests are considered at the same level as driver code.<br>
 3) Good understand of the CI system that will execute these tests<br>
 4) Good following of the bugs filed when these tests fail<br>
<p>
Point 1) is pretty much well done in the Linux community.<br>
<p>
Point 2) is hard to justify when tests are not executed, but comes more naturally when we have a good CI system<br>
<p>
Point 3) is probably the biggest issue for the Linux CI systems: The driver usually covers a wide variety of HW and configuration which cannot all be tested in CI at all time. This leads to complexity in the CI system that needs to be understood by developers in order to prevent regressions. This is why our CI is maintained and developed in the same team developing the driver.<br>
<p>
Point 4) is coming pretty naturally when introducing a filtering system for CI failures. Some failures are known and pending fixing, and we do not want these to be considered as blocking for a patch series. We have been using bugs to create a forum of discussion for developers to discuss how to fix these issues. These bugs are associated to CI failures by a tool doing pattern matching (<a href="https://intel-gfx-ci.01.org/cibuglog/">https://intel-gfx-ci.01.org/cibuglog/</a>). The problem is that these bugs are now every developer's responsibility to fix, and that requires a change in the development culture to hold up some new features until some more important bugs are fixed.<br>
<p>
I guess we are getting quite good at CI, and I am really looking forward to us in the CI team to have more time to share our knowledge and tools for others to replicate! We have already started working on an open source toolbox for CI (<a href="https://gitlab.freedesktop.org/gfx-ci">https://gitlab.freedesktop.org/gfx-ci</a>), as discussed at XDC 2018 (<a href="https://xdc2018.x.org/slides/GFX_Testing_Workshop.pdf">https://xdc2018.x.org/slides/GFX_Testing_Workshop.pdf</a>).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774392/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor774504"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 10, 2018 20:35 UTC (Mon)
                               by <b>sandeen</b> (guest, #42852)
                              [<a href="/Articles/774504/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
"One hopes that these test will be added to a well maintained test project"<br>
<p>
You may wish to subscribe to fstests@vger.kernel.org or peruse git://git.kernel.org/pub/scm/fs/xfs/xfstests-dev.git if this sort of thing is of interest to you.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774504/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor774373"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 9, 2018 1:46 UTC (Sun)
                               by <b>luto</b> (subscriber, #39314)
                              [<a href="/Articles/774373/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
This reminds me of a bug I found once.  In a -rc4 kernel, I decided to play with the new O_TMPFILE feature.  My first basic experiment resulted in fs corruption:<br>
<p>
<a href="https://lwn.net/Articles/562296/">https://lwn.net/Articles/562296/</a><br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774373/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor775294"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2018 12:26 UTC (Thu)
                               by <b>Wol</b> (subscriber, #4433)
                              [<a href="/Articles/775294/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
That reminds me of a bug I found in Fortran 77 for Univac ... which led to data loss.<br>
<p>
The guys at the company I was contracted to were trying to abstract out the OS-specific features, like in the OPEN statement. You could declare a file as temporary, which led to it disappearing when it got closed - quite a nice feature IF IMPLEMENTED CORRECTLY!<br>
<p>
So, I opened a temporary file on a FUNIT, then later on re-used the same FUNIT for a permanent file. THE OS DIDN'T CLEAR THE TEMPORARY STATUS. So when I closed the permanent file, it disappeared ... :-)<br>
<p>
Cheers,<br>
Wol<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/775294/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor774446"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 10, 2018 14:43 UTC (Mon)
                               by <b>xorbe</b> (guest, #3165)
                              [<a href="/Articles/774446/">Link</a>] (21 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
They need code coverage metrics, not just "billions of operations over a period of days."<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774446/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774497"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 10, 2018 18:42 UTC (Mon)
                               by <b>PaulMcKenney</b> (<b>&#x272D; supporter &#x272D;</b>, #9624)
                              [<a href="/Articles/774497/">Link</a>] (20 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Code coverage is table stakes in this game, if that.  Even 100% code coverage won't guarantee that you exercised the relevant race conditions, patterns of data on mass storage, combinations of kernel-boot parameters and Kconfig options, and so forth.  For but one example, 100% code coverage in a CONFIG_PREEMPT=n kernel would not find a bug due to inopportune preemption that could happen in a CONFIG_PREEMPT=y kernel.<br>
<p>
Don't get me wrong, code coverage is fine as far as it goes, and it seems likely that the Linux kernel community would do well to do more of it, but it is not a panacea.  In particular, beyond a certain point, it is probably not the best place to put your testing effort.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774497/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774500"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 10, 2018 19:59 UTC (Mon)
                               by <b>shemminger</b> (subscriber, #5739)
                              [<a href="/Articles/774500/">Link</a>] (13 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
My experience with code coverage metrics has been mostly negative.<br>
Managers look at the % numbers and it causes developers to rearrange code to have a single return to maximize the numbers.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774500/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774502"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 10, 2018 20:21 UTC (Mon)
                               by <b>PaulMcKenney</b> (<b>&#x272D; supporter &#x272D;</b>, #9624)
                              [<a href="/Articles/774502/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I certainly have seen this.  And it can be even worse, due to penalizing good assertions and discouraging debugging code.  So oddly enough, one reason why coverage is not a panacea is exactly because some people believe that it is in fact a panacea!  :-) <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774502/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor774532"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 11, 2018 5:51 UTC (Tue)
                               by <b>JdGordy</b> (subscriber, #70103)
                              [<a href="/Articles/774532/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Meanwhile, MISRA coding standards require single returns... :/<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774532/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor775138"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2018 11:46 UTC (Tue)
                               by <b>error27</b> (subscriber, #8346)
                              [<a href="/Articles/775138/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Single return coding style introduces "forgot to set the error code" bugs.  A "goto out;" might do a ton of things  or it might not do anything so it is a mystery, but a "return -EINVAL;" is unambiguous.<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/775138/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor775143"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2018 14:05 UTC (Tue)
                               by <b>PaulMcKenney</b> (<b>&#x272D; supporter &#x272D;</b>, #9624)
                              [<a href="/Articles/775143/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you didn't know better, you might think that there is no magic bullet to take out all bugs.  :-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/775143/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor775210"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 19, 2018 13:43 UTC (Wed)
                               by <b>mathstuf</b> (subscriber, #69389)
                              [<a href="/Articles/775210/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I prefer `rm` for that job. Works really well. ;)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/775210/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor775231"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 19, 2018 16:04 UTC (Wed)
                               by <b>PaulMcKenney</b> (<b>&#x272D; supporter &#x272D;</b>, #9624)
                              [<a href="/Articles/775231/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
In the old days, I would have agreed.  But these days, "rm" can often be undone using "git checkout", or, in more extreme cases, "git clone".  ;-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/775231/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor775277"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2018 3:45 UTC (Thu)
                               by <b>neilbrown</b> (subscriber, #359)
                              [<a href="/Articles/775277/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Isn't it a simple matter of writing a virus (or a worm .. or a worm with a virus) which hunts out all bugs on the Internet and removes them.  I remember Doctor Who did that once to get rid of all the photos of himself, so it can't be too hard.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/775277/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor775280"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2018 4:37 UTC (Thu)
                               by <b>PaulMcKenney</b> (<b>&#x272D; supporter &#x272D;</b>, #9624)
                              [<a href="/Articles/775280/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Dr. Who has to do that every few years as the actors change?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/775280/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor774536"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 11, 2018 7:37 UTC (Tue)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/774536/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Managers look at the % numbers and it causes developers to rearrange code to have a single return</font><br>
<p>
Interesting, could you share a simplified example?<br>
<p>
<font class="QuotedText">&gt; My experience with code coverage metrics has been mostly negative.</font><br>
<p>
While error-handling code, corner cases and... backup configurations are notoriously untested, I agree there are diminishing returns and better trade-offs past some point. Curious what is experts' guestimation of where that percentage typically is.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774536/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774559"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 11, 2018 14:11 UTC (Tue)
                               by <b>PaulMcKenney</b> (<b>&#x272D; supporter &#x272D;</b>, #9624)
                              [<a href="/Articles/774559/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I have seen 80% used with some decent results.  But it really depends on the code and its user base.  100% of your commonly executed code really does need to be covered.  But of course the more users your code has, the larger the fraction of your code is commonly executed.<br>
<p>
If only (say) 30% of your code is tested, you very likely need to substantially increase your coverage.  If (say) 90% of your code is tested, there is a good chance that there is some better use of your time than getting to 91%.  But for any rule of thumb like these, there will be a great many exceptions, for example, the safety-critical code mentioned earlier.<br>
<p>
Hey,  you asked!  :-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774559/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774623"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 11, 2018 20:53 UTC (Tue)
                               by <b>marcH</b> (subscriber, #57642)
                              [<a href="/Articles/774623/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Hey, you asked! :-)</font><br>
<p>
Sincere thanks!<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774623/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor776057"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 5, 2019 18:06 UTC (Sat)
                               by <b>joseph.h.garvin</b> (subscriber, #64486)
                              [<a href="/Articles/776057/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I think you have things backwards. If there is a bug in commonly executed code it's going to be exposed even if there isn't a test. It's the infrequently executed code that tends to contain bugs (e.g. handling error conditions). Testing the frequently executed code still has value in that it can prevent problems from reaching customers, but bugs in frequently executed code will tend to be discovered very quickly. In a sense what the entire point of tests is is to make it so some code paths are more frequently executed.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/776057/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor776066"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Jan 5, 2019 22:29 UTC (Sat)
                               by <b>PaulMcKenney</b> (<b>&#x272D; supporter &#x272D;</b>, #9624)
                              [<a href="/Articles/776066/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Especially in my part of the Linux kernel, there is great value in preventing problems from reaching the -tip tree, let alone Linus's tree, let alone distributions, let alone customers.  This great value stems from the fact that RCU bugs tend to be a bit difficult to reproduce and track down.  It is therefore quite important to test the common cases.<br>
<p>
Nevertheless, your last sentence is spot on.  It is precisely because rcutorture forces rare code paths and  rare race conditions to execute more frequently that the number of RCU bugs reaching customers is kept down to a dull roar.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/776066/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
<a name="CommAnchor774510"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 10, 2018 21:18 UTC (Mon)
                               by <b>NAR</b> (subscriber, #1313)
                              [<a href="/Articles/774510/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      But anything less than 100% coverage <b>guarantees</b> that some part of the code is not tested...
      
          <div class="CommentReplyButton">
            <form action="/Articles/774510/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor774513"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 10, 2018 21:50 UTC (Mon)
                               by <b>PaulMcKenney</b> (<b>&#x272D; supporter &#x272D;</b>, #9624)
                              [<a href="/Articles/774513/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
And anything less than 100% race coverage similarly guarantees a hole in your testing.  As does anything less than 100% configuration-combination coverage.  As does anything less than 100% input coverage.  As does anything less than 100% hardware-configuration testing.  As does ...<br>
<p>
For most types of software, at some point it becomes more important to test more races, more configurations, more input sequences, and more hardware configurations than to provide epsilon increase in coverage by triggering that next assertion.  After all, testing and coverage is about reducing risk given the time and resources at hand.  Therefore, over-emphasizing one form of testing (such as coverage) will actually increase overall risk due to the consequent neglect of some other form of testing.<br>
<p>
Of course, there are some types of software where 100% coverage is reasonable, for example, certain types of safety-critical software.  But in this case, you will be living under extremely strict coding standards so as to (among a great many other things) make 100% coverage affordable.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/774513/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor775560"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 24, 2018 20:42 UTC (Mon)
                               by <b>anton</b> (subscriber, #25547)
                              [<a href="/Articles/775560/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      I would expect that defensive coding practices that lead to unreachable code (and thus &lt;100% coverage) are particularly widespread in safety-critical software.  I.e., you cannot trigger this particular safety-net code, and you are pretty sure that it cannot be triggered, but not absolutely sure; or even if you are absolutely sure, you foresee that the safety net might become triggerable after maintenance.  Will you remove the safety net to increase your coverage metric?

<p>OTOH, how do you test your safety net?  Remember that Ariane 5 was exploded by a safety net that was supposed (and proven) to never trigger.
      
          <div class="CommentReplyButton">
            <form action="/Articles/775560/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor775567"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 25, 2018 0:05 UTC (Tue)
                               by <b>PaulMcKenney</b> (<b>&#x272D; supporter &#x272D;</b>, #9624)
                              [<a href="/Articles/775567/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
The safety-critical software that I know of (admittedly an obsolete and vanishingly small fraction of the total) limited "if" statements for exactly this reason.<br>
<p>
But yes, Murphy will always be with us.  So even in safety critical code, at the end of the day it is about reducing risk rather than completely eliminating it.<br>
<p>
And to your point about Ariane 5's failed proof of correctness...  Same issue as the classic failed proof of correctness for the binary search algorithm!  Sadly, a proof of correctness cannot prove the assumptions on which it is based.  So Murphy will always find a way, but it is nevertheless our job to thwart him.  :-)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/775567/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor775733"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 30, 2018 11:22 UTC (Sun)
                               by <b>GoodMirek</b> (subscriber, #101902)
                              [<a href="/Articles/775733/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
There are safety nets triggered only in cases impossible to reach via software means, but possible to happen in case of HW failure.<br>
I saw that multiple times while working on embedded systems.<br>
<p>
E.g.:<br>
explosiveness=255;<br>
if explosiveness !=255 then assert;<br>
<p>
In theory, it should never assert. In reality, it is desirable to minimize a risk that 'explosiveness' variable is stored in a failed memory cell, prior that cell is used for indication of explosiveness of any kind.<br>
<p>
Or this case:<br>
if &lt;green&gt; then<br>
  explosiveness=0;<br>
else<br>
  explosiveness=255;<br>
if (explosiveness!=0 and explosiveness!=255) then assert;<br>
<p>
It is very rare to trigger and almost impossible to test such assertions, but when I saw them triggered in reality, even once in a lifetime, I appreciated their merit.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/775733/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor775737"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Kernel quality control, or the lack thereof</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 30, 2018 15:44 UTC (Sun)
                               by <b>PaulMcKenney</b> (<b>&#x272D; supporter &#x272D;</b>, #9624)
                              [<a href="/Articles/775737/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Assuming that timing considerations permitted it, one approach would be to run the code in a simulator that provided fault-injection for memory.  That said, to your point, you would have to inject the fault rather carefully to trigger that particular set of assertions.<br>
<p>
But if the point was in fact to warn about unreliable memory, mightn't this sort of fault injection nevertheless be quite useful?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/775737/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2018, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
