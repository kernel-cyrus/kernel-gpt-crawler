        <!DOCTYPE html>
        <html lang="en">
        <head><title>The rest of the 6.1 merge window [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/910608/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/911047/">Return to the Front page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/910608/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>The rest of the 6.1 merge window</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>We're bad at marketing</b>
<p>
We can admit it, marketing is not our strong suit. Our strength is
writing the kind of articles that developers, administrators, and
free-software supporters depend on to know what is going on in the
Linux world. Please <a href="/Promo/nsn-bad/subscribe">subscribe today</a> to help us keep doing that, and so
we donâ€™t have to get good at marketing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>October 17, 2022</br>
           </div>
Linus Torvalds <a
href="/ml/linux-kernel/CAHk-=wj6y5fipM2A5kEuOO9qm5PBzUY=-m9viEahhtxT09KR_g@mail.gmail.com/">released
6.1-rc1</a> and closed the 6.1 merge window on 
October&nbsp;16; at that point, 11,537 non-merge changesets had been pulled
into the mainline repository.  That is considerably less than the 13,543
changesets pulled during the 6.0 merge window, but quantity is not
everything: there were quite a few significant changes brought in this time
around.  Many of those were part of the nearly 5,800 changesets pulled
since <a href="/Articles/910312/">our first 6.1 merge window summary</a>;
read on for a look at some of the work done in the latter part of this
merge window.
<p>

<h4>Architecture-specific</h4>
<p>
<ul class="spacylist">

<li> The Loongarch architecture has gained support for perf events,
     kexec, kdump, and BPF just-in-time compilation.    
<li> On EFI systems, the kernel is now able to decompress and launch itself
     in an architecture-independent way.

</ul>


<p>
<h4>Core kernel</h4>
<p>
<ul class="spacylist">

<li> There is a new io_uring mode (obtained by setting up a ring with
     the <tt>IORING_SETUP_DEFER_TASKRUN</tt> flag) that causes the
     execution of ring-related work to be deferred until the application
     asks for it to be done.  This deferral helps to batch up work and
     prevent latency problems caused by the preemption of the application
     at inopportune times.  There is a little bit of information in <a
     href="https://git.kernel.org/linus/c0e0d6ba25f1">this commit</a>.
<li> The process-ID control-group controller can now remember the highest
     number of PIDs used, which can be consulted when deciding what the
     limit should be; this value is exported in a virtual file called
     <tt>peak</tt>.
<li> It is now possible for user-space processes to <a
     href="/Articles/887753/">request that a range of pages be "collapsed"
     into transparent huge pages</a>.  This makes huge pages somewhat less
     transparent, of course, but it also allows user space control over
     if and when this work is done.
<li> The <a href="/Articles/897260/"><tt>/dev/userfaultfd</tt> patches</a>,
     which provide a way for system administrators to grant access to <a
     href="https://man7.org/linux/man-pages/man2/userfaultfd.2.html"><tt>userfaultfd()</tt></a>
     functionality with filesystem access permissions, have been merged.
<li> Memory-tiering is the management of banks of memory with different
     performance characteristics; normally one wants the most heavily used
     pages to be resident in the fastest memory, while less-frequently used
     (but still useful) pages can be in slower RAM.  Two memory-tiering
     patch sets, both described in <a href="/Articles/898766/">this
     article</a>, have been merged for 6.1.  "Hot page selection" improves
     the detection of busy pages languishing in slower RAM so that they can
     be promoted.  Meanwhile, the "demotion-order" patches formalize the
     kernel's notion of what memory tiers mean and their relative
     performance, allowing better management of those tiers.
<li> The <a href="/Articles/894859/">multi-generational LRU</a> code has
     been merged.  This work replaces the kernel's two-queue,
     least-recently-used mechanism with a multi-stage structure that, it is
     said, is better at identifying which memory pages are actually in use.
     Included is <a href="https://git.kernel.org/linus/354ed5974429">a
     "kill switch"</a> that can be used to disable the new mechanism should
     it create problems on a given system.  The <a
     href="https://git.kernel.org/linus/07017acb0601">administrative
     guide</a> has some more information on how to control this feature,
     while the <a href="https://git.kernel.org/linus/8be976a0937a">design
     documentation</a> gets into how it all works.
<p>
     For those wondering how the multi-generational LRU and tiering
     interact: the LRU deals mostly with the management of memory within
     each zone (each area of physically contiguous memory of the same type
     on the same node), while tiering is concerned with the movement of
     pages between zones.
<li> The <a href="/Articles/845507/">maple tree</a> data structure has also
     been merged.  It is meant to be a more efficient replacement for
     red-black trees and, it is hoped, will also facilitate the
     implementation of range locking in the future.  A number of core
     memory-management subsystems have been converted over to maple trees;
     with luck the only user-visible change will be improved performance.
<li> <a href="/Articles/759781/">Pressure-stall information</a> can now be
     tracked at the control-group level.  Enabling this tracking may add a
     significant performance cost; <a
     href="https://git.kernel.org/linus/34f26a15611a">this commit</a> has
     some more information.

</ul>

<p>
<h4>Filesystems and block I/O</h4>
<p>
<ul class="spacylist">

<li> Changes merged for Btrfs provide some significant performance
     improvement, including an "<q>orders of magnitude speed boost</q> for
     the <tt>FIEMAP</tt> <tt>ioctl()</tt>.
<li> Btrfs now supports buffered writes with io_uring.
<li> The Btrfs "send" operation has gained support for files protected with
     <a href="/Articles/790185/">fs-verity</a>.
<li> The filesystems in user space (FUSE) subsystem has gained support for
     the creation of temporary files with <tt>O_TMPFILE</tt>.
</ul>

<p>
<h4>Hardware support</h4>
<p>
<ul class="spacylist">
<li> <b>Clock</b>:
     MediaTek MT6795 and MT8365 clock controllers,
     Qualcomm MSM8909 and SM6375 global clock controllers,
     Qualcomm SM6115 and SM8450 display clock controllers,
     Qualcomm SC8280XP graphics clock controllers,
     Rockchip RV1126 clock controllers,
     Spreadtrum UMS512 clocks, and
     Renesas Versaclock 7 clock controllers.
<li> <b>GPIO and pin control</b>:
     Cypress Cy8C95x0 pinctrl/gpio I2C expanders,
     Qualcomm SC8280XP and SM8450 LPASS LPI pin controllers, and
     MediaTek MT8188 pin controllers.
<li> <b>Industrial I/O</b>:
     Liteon LTRF216A light sensors,
     Richtek RTQ6056 current and power monitors,
     MEMSensing digital 3-axis accelerometers,
     Maxim max11205 analog-to-digital converters, and
     Bosch Sensortec BNO05 IMUs.
<li> <b>Input</b>:
     IBM operation panels,
     Richtek RT5120 PMIC power keys, and
     Pine64 PinePhone keyboards.
<li> <b>Media</b>:
     NXP i.MX DW100 dewarpers and
     MediaTek media data path interfaces.
<li> <b>Miscellaneous</b>:
     Synopsys DWC AHCI SATA controllers,
     Microchip LAN9662 OTP controllers,
     Microchip PolarFire SoC reset controllers,
     Aspeed HACE cryptographic engines, and
     Exar watchdog timers.
<li> <b>Multi-function device</b>:
     MediaTek MT6370 power-management ICs
     Richtek RT5120 power management ICs, and
     Rockchip RK817 PMIC battery chargers.
<li> <b>USB</b>:
     Sunplus SP7021 USB 2.0 PHYs and
     MediaTek MT6370 Type-C controllers.
</ul>

<p>
<h4>Miscellaneous</h4>
<p>
<ul class="spacylist">

<li> As usual, there is a long list of improvements to the <tt>perf</tt>
     tool, including improved support for AMD processors; <a
     href="https://git.kernel.org/linus/d465bff130bf">this merge
     message</a> contains a summary.

</ul>


<p>
<h4>Security-related</h4>
<p>
<ul class="spacylist">

<li> Support for <tt>O_NONBLOCK</tt> was (accidentally) removed from
     <tt>/dev/random</tt> back in 5.6.  Somebody eventually noticed and
     complained, so that support will return in 6.1 (and, presumably, the
     stable updates).

</ul>


<p>
<h4>Internal kernel changes</h4>
<p>
<ul class="spacylist">

<li> There is continued refactoring within the various slab allocators
     to increase the amount of code that can be shared among them.  One
     behavioral change that might be noticed is that SLAB will now obtain large
     allocations directly from the page allocator, without keeping a separate
     cache around.
     <p>
     The long-term goal of this work is to eventually be able to remove the
     SLAB and SLOB allocators, but that is still a distant prospect.
<li> There is now an interface to show how much memory is wasted due to the
     rounding-up of allocation sizes by <tt>kmalloc()</tt>; <a
     href="https://git.kernel.org/linus/6edf2576a6cc">this commit</a>
     describes how to use it.
<li> The kernel build system now requires a minimal GNU Make version of
     3.82.
<li> The x86 architecture code will now emit warnings if a kernel subsystem
     sets up memory that is both writable and executable.  The initial plan
     to prohibit such mappings entirely has been deferred due to a couple
     of late-arriving surprises, though.
<li> The conversion of memory-management functionality to <a
     href="/Articles/893512/">folios</a> continues, with most of the effort
     this time focused on the swap code.
<li> The kernel memory sanitizer (KMSAN), briefly described in <a
     href="/Articles/909245/#more">this article</a>, has been merged.
     KMSAN is focused on detecting uses of uninitialized memory in the
     kernel; <a href="https://git.kernel.org/linus/93858ae70cf4">this
     documentation patch</a> describes its use.
<li> The <tt>checkpatch.pl</tt> script will now complain about uses of the
     deprecated <tt>kmap()</tt> and <tt>kmap_atomic()</tt> functions; code
     should be using <tt>kmap_local_page()</tt> instead.
<li> There has been a fair amount of churn related to how kernel code
     obtains random numbers; <a
     href="https://git.kernel.org/linus/f1947d7c8a61">this merge
     message</a> contains the rules that describe how the internal API for
     random number is meant to be used.
</ul>
<p>

Now the time has come to stabilize all of that work and turn it into the
6.1 release, which is slated to become this year's long-term-support
kernel.  That release can be expected on December&nbsp;4 or&nbsp;11; given
the significance of some of the changes that have been merged, it would not
be surprising if this cycle were one of those that require an extra week to
become ready.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Releases-6.1">Releases/6.1</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/910608/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor911793"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.1 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 19, 2022 21:06 UTC (Wed)
                               by <b>calumapplepie</b> (guest, #143655)
                              [<a href="/Articles/911793/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
something that might be interesting to see in the release statistics is how much of the memory management code is touched by this update, and some benchmarks on speedups in the result... it seems that there are a LOT of core changes there (folios, LRU, maple trees, memory tiering, slab refactoring, kmalloc instrumentation, KMSAN).  <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/911793/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor911821"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The rest of the 6.1 merge window</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 20, 2022 8:44 UTC (Thu)
                               by <b>geert</b> (subscriber, #98403)
                              [<a href="/Articles/911821/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Exactly. v6.1-rc1 is one of the larger growing releases: +55 KiB on m68k, of which circa half thanks to our new friend the maple tree.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/911821/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2022, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
