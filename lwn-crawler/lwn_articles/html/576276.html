        <!DOCTYPE html>
        <html lang="en">
        <head><title>The Btrfs filesystem: An introduction [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/576276/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/575841/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/576276/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>The Btrfs filesystem: An introduction</h1>
</div>
<div class="ArticleText">
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>December 11, 2013</br>
           </div>
The Btrfs filesystem has been through almost every part of the hype cycle
at one point or another in its short history.  For a time, it was the
next-generation filesystem that was going to solve many of our problems;
distributors were racing to see who could be the first to ship it by
default.  Then it became clear that all those longtime filesystem
developers weren't totally out to lunch when they warned that it takes many
years to get a filesystem to a point where it can be trusted with important
data.
At this point, it is possible to go to a conference and hear almost nothing
positive 
about Btrfs; disillusionment appears to have set in.  By the time Btrfs is
truly ready, some seem to think, it will be thoroughly obsolete.
<p>
The truth may not be quite so grim.  Development on Btrfs continues, with a
strong emphasis on stability and performance.  Problems <i>are</i> getting
fixed, and users are beginning to take another look at this promising
filesystem.  More users are beginning to play with it, and openSUSE <a
href="/Articles/576280/">considered</a> the idea of using it by default
back in September.  Your editor's sense is that the situation may be bottoming
out, and that we may, slowly, be heading into a new phase where Btrfs takes
its place — still slowly — as one of the key Linux filesystems.
<p>
This article is intended to be the first in a series for users interested
in experimenting with and evaluating the Btrfs filesystem.  We'll start with
the basics of the design of the filesystem and how it is being developed;
that will be followed by a detailed look at specific Btrfs features.  One
thing that will <i>not</i> appear in this series, though, is benchmark
results; experience says that proper filesystem benchmarking is hard to do
right; it's also highly workload- and hardware-dependent. Poor-quality
results would not be helpful to anybody, so your editor will simply not
try. 
<p><blockquote class="ad">
<b><tt>$ sudo subscribe today</tt></b>
<p>
Subscribe today and elevate your LWN privileges. You’ll have
access to all of LWN’s high-quality articles as soon as they’re
published, and help support LWN in the process.  <a href="https://lwn.net/Promo/nst-sudo/claim">Act now</a> and you can start with a free trial subscription.
</blockquote>
<p>
<h4>What makes Btrfs different?</h4>
<p>
Not that long ago, Linux users were still working with filesystems that had
evolved little since the Unix days.  The ext3 filesystem, for example,
was still using block pointers: each file's inode (the central data
structure holding all the information about the file) contained a list of
pointers to each individual block holding the file's data.  That design
worked well enough when files were small, but it scales poorly: a 1GB 
file would require 256K individual block pointers.  More recent filesystems
(including ext4) use pointers to "extents" instead; each extent is a group
of contiguous blocks.  Since filesystems work to store data contiguously
anyway, extent-based storage greatly reduces the overhead of managing a
file's space.
<p>
Naturally, Btrfs uses extents as well.  But it differs from most other
Linux filesystems in a significant way: it is a "copy-on-write" (or "COW")
filesystem.  When data is overwritten in an ext4 filesystem, the new data
is written on top of the existing data on the storage device, destroying
the old copy.  Btrfs, instead, will move overwritten blocks
elsewhere in the filesystem and write the new data there, leaving the older
copy of the data in place.
<p>
The COW mode of operation brings some significant advantages.  Since old
data is not overwritten, recovery from crashes and power failures should be
more straightforward; if a transaction has not completed, the previous
state of the data (and metadata) will be where it always was.  So, among
other things, a COW filesystem does not need to implement a separate
journal to provide crash resistance.
<p>
Copy-on-write also enables some interesting new features, the most notable
of which is snapshots.  A snapshot is a virtual copy of the filesystem's
contents; it can be created without copying any of the data at all.  If, at
some later point, a block of data is changed (in either the snapshot or the
original), that one block is copied while all of the unchanged data remains
shared.  Snapshots can be used to provide a sort of "time machine"
functionality, or to simply roll back the system after a failed update.  
<p>
Another important Btrfs feature is its built-in volume manager.  A Btrfs
filesystem can span multiple physical devices in a number of RAID
configurations.  Any given volume (collection of one or more physical
drives) can also be split into "subvolumes," 
which can be thought of as independent filesystems sharing a single
physical volume set.  So Btrfs makes it possible to group part or all of a
system's storage into a big pool, then share that pool among a set of
filesystems, each with its own usage limits.
<p>
Btrfs offers a wide range of other features not supported by other
Linux filesystems.  It can perform full checksumming of both data and metadata,
making it robust in the face of data corruption by the hardware.  Full
checksumming is expensive, though, so it remains likely to be used in only
a minority of installations.  Data can be stored on-disk in compressed
form.  The <a href="/Articles/506244/">send/receive feature</a> can be used
as part 
of an incremental backup scheme, among other things.  The online
defragmentation mechanism can fix up fragmented files in a running
filesystem.  The 
3.12 kernel saw the addition of an offline de-duplication feature; it scans
for blocks containing duplicated data and collapses them down to a single,
shared copy.  And so on.
<p>
It is worth noting that 
the copy-on-write approach is not without its costs.  Obviously,
some sort of garbage collection is required or all those block copies will
quickly eat up all of the available space on the filesystem.  Copying 
blocks can take more time than simply overwriting them as well as
significantly increasing the filesystem's memory requirements.  COW
operations will also have a tendency to fragment files, wrecking the nice,
contiguous layout that the filesystem code put so much effort into
creating.  Fragmentation hurts less with solid-state devices than on
rotational storage, but, even in the former case, fragmented files will not
be as quick to access.  
<p>
So all this shiny new Btrfs functionality does not come for free.  In many
settings, administrators may well decide that the costs associated with
Btrfs outweigh the benefits; those sites will stick with filesystems like
ext4 or XFS.  For others, though, the flexibility and feature set provided
with Btrfs are likely to be quite appealing.  Once it is generally accepted
that Btrfs is ready for real-world use, chances are it will start popping
up on a lot of systems.
<p>
<h4>Development</h4>
<p>
One concern your editor has heard in conference hallways is that the pace
of Btrfs development has slowed.  For the curious, here's the changeset
count history for the Btrfs code in the kernel, grouped into approximately
one-year periods:
<p>
<blockquote>
<table>
<tr><th>Year</th><th>Changesets</th><th>Developers</th></tr>
<tr class="Odd"><td>2008 (2.6.25—29)</td><td align="center">913</td><td align="center">42</td></tr>
<tr class="Even"><td>2009 (2.6.30—33)</td><td align="center">279</td><td align="center">45</td></tr>
<tr class="Odd"><td>2010 (2.6.34—37)</td><td align="center">193</td><td align="center">33</td></tr>
<tr class="Even"><td>2011 (2.6.38—3.2)</td><td align="center">610</td><td align="center">67</td></tr>
<tr class="Odd"><td>2012 (3.3—8)</td><td align="center">773</td><td align="center">63</td></tr>
<tr class="Even"><td>2013 (3.9—13)</td><td align="center">671</td><td align="center">68</td></tr>
</table>
</blockquote>
<p>
These numbers, on their own, do not demonstrate a slowing of development;
there was an apparent slow period in 2010, but the number of changesets and
the number of developers contributing them has held steady thereafter.
That said, there are a couple of things to bear in mind when looking at
those numbers.  One is that the early work involved the addition of
features to a brand-new filesystem, while work in 2013 is almost entirely
fixes.  So the <i>size</i> of the changes has shrunk considerably, but one
could easily argue that things should be just that way.
<p>
The other relevant point is that contributions by Btrfs creator Chris Mason
have clearly fallen in recent years.  Partly that is because he has been
working on the user-space btrfs-progs code — work which is not reflected in
the above, kernel-side-only numbers — but it also seems clear that he
has been busy with other work-related issues.  It will be interesting to
see how things change now that Chris and prolific Btrfs contributor
Josef Bacik have <a href="/Articles/575105/">found a new home</a> at
Facebook.
<p>
In summary, the amount of new code going into Btrfs has clearly fallen in
recent years, but that will be seen as good news by anybody hoping for a
stable filesystem anytime soon.  There is still some significant effort
going into this filesystem, and chances are good that developer attention
will increase as distributors look more closely at using Btrfs by default.
<p>
<h4>What's next</h4>
<p>

All told, Btrfs still looks interesting, and it seems like the right time
to take a closer look at what is still the next generation Linux
filesystem.  Now that the introductory material is out of the way, the next
article in this series will start to actually play with Btrfs and explore
its feature set.  Those articles (appearing here as they are published) are:
<p>
<ul>

<li> <a href="/Articles/577218/">Getting started</a>: where to get the 
     software, and the basics of creating and using a Btrfs filesystem.
<p>
<li> <a href="/Articles/577961/">Working with multiple devices</a>: a Btrfs
     filesystem is not limited to a physical device; instead, the
     filesystem supports multiple-device filesystems in a number of RAID
     and RAID-like configurations.  This article describes that
     functionality and how to make use of it.
<p>
<li> <a href="/Articles/579009/">Subvolumes and snapshots</a>: creating
     multiple filesystems on a single storage volume, along with the
     associated snapshot mechanism.
<p>
<li> <a href="/Articles/581558/">Send/receive and <tt>ioctl()</tt></a>:
     using the send/receive feature for incremental backups, a brief
     overview of functionality available with <tt>ioctl()</tt>, and
     concluding notes.
</ul>

<p>
By the end of the series, we plan to have a reasonably
comprehensive introduction to Btrfs in place; stay tuned.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Btrfs-LWNs_guide_to">Btrfs/LWN's guide to</a></td></tr>
            <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#Filesystems-Btrfs">Filesystems/Btrfs</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/576276/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor576686"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 12, 2013 4:39 UTC (Thu)
                               by <b>geuder</b> (guest, #62854)
                              [<a href="/Articles/576686/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Hmm, what about reliability? I think it's not too long that one could hear at least rumours about people losing data.<br>
<p>
And wasn't there an issue with fsck?<br>
<p>
Myself I have only 2 experiences:<br>
<p>
- it was the default in the Meego systems I used. But for obvious reason that usage did not last long.<br>
<p>
- when I once wanted a "portable" Ubuntu installed on a USB stick, I used btrfs because of the possibility to compress everything. Besides that it probably was only a 4GB stick, I thought the bigger the speed gap between CPU and "disk", the more beneficial compression should be for overall performance, because there are plenty of spare cycles. The overall result was catastrophic, because every bigger apt-get upgrade took really several hours. The reason was that apt seems to be really cautious about not ending up in an inconsistent state if aborted in the middle of an operation, so it does plenty of fsync (IIRC) calls. At least back then that was a known performance problem in btrfs. I shortly experimented with hooking eatmydata underneath apt, but for some reasons the project then faded out...<br>
(I still wonder how Meego could live with that problem. Is it just the number of packages, which problably was only a fraction in a Meego tablet compared to a full Ubuntu desktop installation? Or is rpm less paranoid than apt about ending up with inconsistent results if something goes wrong?)   <br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576686/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor576860"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 10:47 UTC (Fri)
                               by <b>jezuch</b> (subscriber, #52988)
                              [<a href="/Articles/576860/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; Hmm, what about reliability? I think it's not too long that one could hear at least rumours about people losing data.</font><br>
<p>
I've been running btrfs on / for about 4 years, I think, and I can remember just one, non-data-eating incident. So no problems for me. But others[1] have very different experiences, so...<br>
<p>
[1] <a href="http://changelog.complete.org/archives/9123-results-with-btrfs-and-zfs">http://changelog.complete.org/archives/9123-results-with-...</a><br>
<p>
<font class="QuotedText">&gt; The reason was that apt seems to be really cautious about not ending up in an inconsistent state if aborted in the middle of an operation, so it does plenty of fsync (IIRC) calls. At least back then that was a known performance problem in btrfs.</font><br>
<p>
Yes, this was rather bad, but there was a workaround (tell APT to not be so damn paranoid). And this problem is long gone now.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576860/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor576917"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 15:48 UTC (Fri)
                               by <b>jezuch</b> (subscriber, #52988)
                              [<a href="/Articles/576917/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Oh, and BTW: my / contains only the things that I can lose and/or can be easily restored (like the operating system) so I'm not *that* crazy to give all my precious data to an experimental FS ;) (My precious data is on a RAID'ed XFS partition on at least two plain-old, trusted rotating-rust drives; the root is on an old-ish SSD from Intel.)<br>
<p>
But I really like snapshotting. It revolutionized the way I do custom builds of Debian packages: create a snapshot, make a mess (installing build-dependencies etc.), build Chromium (lots and lots of thrashing, up to 20 GB of build artifacts), move away what's important, delete snapshot. And after all of this the main filesystem doesn't have a clue that anything happened. And I don't have to clean up anything at all :)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576917/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor592653"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 1, 2014 16:12 UTC (Tue)
                               by <b>mcortese</b> (guest, #52099)
                              [<a href="/Articles/592653/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <blockquote><em>(tell APT to not be so damn paranoid)</em></blockquote>
<p>How? Especially when apt is called by the installer, not directly by the user?
      
          <div class="CommentReplyButton">
            <form action="/Articles/592653/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor592680"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Apr 1, 2014 16:43 UTC (Tue)
                               by <b>hummassa</b> (guest, #307)
                              [<a href="/Articles/592680/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
load "eatmydata" and call the installer again :D<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/592680/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor576698"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 12, 2013 9:23 UTC (Thu)
                               by <b>ebirdie</b> (guest, #512)
                              [<a href="/Articles/576698/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Incidentally I just picked this up, FWIW adding to the list of real world usage, Netgear has put Btrfs into real world use in its ReadyNAS 312 appliance.<br>
<p>
&lt;<a href="http://www.anandtech.com/show/7500/netgear-readynas-312-2bay-smb-soho-nas-review">http://www.anandtech.com/show/7500/netgear-readynas-312-2...</a>&gt;<br>
<p>
I'm pretty confident there are other vendors too, but to me this was a wake-up for Btrfs.<br>
<p>
Great that the editor is publishing the set of articles. Reading the article raised an interest to further information, what vendors/employers might have been active and how they have changed during the presented time period in development of Btrfs.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576698/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor577622"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2013 23:18 UTC (Wed)
                               by <b>Lennie</b> (subscriber, #49641)
                              [<a href="/Articles/577622/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
My guess would be they use a large BTRFS filesystem on top of RAID and don't use the multi device support in BTRFS. This is one of the things Suse has also suggested, BTRFS is stable, without using multi device support.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/577622/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor577793"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 19, 2013 23:41 UTC (Thu)
                               by <b>Pc5Y9sbv</b> (guest, #41328)
                              [<a href="/Articles/577793/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
We've been testing BTRFS in this configuration  (BTRFS formatted on one large hardware RAID disk) with mixed results.<br>
<p>
We are formatting about 20-60 TB of raw disk space (different test scenarios), and copying a wide range of different data trees which include large files and huge numbers of small files generated by programs.  There might be about 40-70 TB of uncompressed data in around 10M files (using compress-force=zlib, it shrinks to 10-15 TB).<br>
<p>
We wanted to store near-line backups with daily/weekly/monthly snapshot history and it failed miserably.  It seems we can use the transparent compression and good old-fashioned rsync --link-dest tricks to store our backup history, but if we instead try to take sub-volume snapshots and just keep modifying the "head" via rsync, it blows up and takes the filesystem with it.  So, it can handle the huge number of inodes involved in representing trees millions of files for each day, but it cannot handle the equivalent sub-volume snapshot workload.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/577793/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor577794"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 19, 2013 23:46 UTC (Thu)
                               by <b>Lennie</b> (subscriber, #49641)
                              [<a href="/Articles/577794/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Well, that is good news.<br>
<p>
It's a start. Slowly but surely it also be (more) stable for other workloads.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/577794/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor576731"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">btrfs on raw flash</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 12, 2013 14:14 UTC (Thu)
                               by <b>seanyoung</b> (subscriber, #28711)
                              [<a href="/Articles/576731/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It just occurred to me that btrfs might be very well suited for flash (i.e. without the silly ftl) since it does not overwrite data.<br>
<p>
In fact, if it can be shown that btrfs performance is significantly faster without FTL would that motivate the manufacturers to produce flash kit where you can bypass the FTL? That would give them an edge over their competition.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576731/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor576800"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">btrfs on raw flash</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 12, 2013 19:16 UTC (Thu)
                               by <b>drag</b> (guest, #31333)
                              [<a href="/Articles/576800/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I suppose it could be ported or the ideas applied to a direct-to-flash file system.<br>
<p>
But right now you can't use btrfs directly on flash.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576800/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor576847"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">btrfs on raw flash</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 8:49 UTC (Fri)
                               by <b>iq-0</b> (subscriber, #36655)
                              [<a href="/Articles/576847/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
You'd need erase block logic and btrfs only does mild write leveling on it's superblock. But it should be a good fit for flash with a simple ftl.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576847/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor576764"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 12, 2013 16:30 UTC (Thu)
                               by <b>masoncl</b> (subscriber, #47138)
                              [<a href="/Articles/576764/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks Jon, looking forward to the rest of the series.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576764/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor576825"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 12, 2013 23:33 UTC (Thu)
                               by <b>dowdle</b> (subscriber, #659)
                              [<a href="/Articles/576825/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I thought Oracle Enterprise Linux and SUSE Linux Enterprise Server both offered Btrfs as a supported option.  Since I don't use either of those, I'm not sure.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576825/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor576826"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 12, 2013 23:43 UTC (Thu)
                               by <b>dowdle</b> (subscriber, #659)
                              [<a href="/Articles/576826/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Btrfs is listed as a feature in Oracle:<br>
<p>
<a href="http://www.oracle.com/us/technologies/linux/product/features/index.html">http://www.oracle.com/us/technologies/linux/product/featu...</a><br>
<p>
Btrfs is listed as a feature in SLES:<br>
<p>
<a href="https://www.suse.com/products/server/features/">https://www.suse.com/products/server/features/</a><br>
<p>
Lastly, Btrfs is also shown as available in the RHEL 7 beta that came out recently.  They don't have it listed as "preview only" anymore.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576826/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor576828"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 0:04 UTC (Fri)
                               by <b>rahulsundaram</b> (subscriber, #21946)
                              [<a href="/Articles/576828/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
RHEL 7 beta lists Btrfs as a preview still<br>
<p>
<a href="http://www.redhat.com/about/news/archive/2013/12/red-hat-announces-availability-of-red-hat-enterprise-linux-7-beta">http://www.redhat.com/about/news/archive/2013/12/red-hat-...</a><br>
<p>
"Btrfs, an emerging file system, will be available as a technology preview within Red Hat Enterprise Linux 7"<br>
<p>
<p>
<a href="http://rhelblog.redhat.com/2013/12/11/testers-wanted-red-hat-enterprise-linux-7-beta/#more-3">http://rhelblog.redhat.com/2013/12/11/testers-wanted-red-...</a><br>
<p>
"btrfs file system .. now available to test"<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576828/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor576869"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 13:11 UTC (Fri)
                               by <b>dowdle</b> (subscriber, #659)
                              [<a href="/Articles/576869/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Thanks for the correction on RHEL7 beta.  I was going by the Release Notes which I didn't see preview or testing mentioned in.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576869/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor576830"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 0:33 UTC (Fri)
                               by <b>anselm</b> (subscriber, #2796)
                              [<a href="/Articles/576830/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <p>
In its most recent incarnation, SUSE Linux Enterprise Server prods you with considerable verve towards using Btrfs for your root file system.
</p>
<p>
On the other hand, perhaps interestingly, SUSE Linux Enterprise Server doesn't even <em>support</em> ext4 except as a read-only filesystem to get stuff off ext4-formatted disks.
</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/576830/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor577448"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2013 8:25 UTC (Wed)
                               by <b>salimma</b> (subscriber, #34460)
                              [<a href="/Articles/577448/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
At least, with SLES 11 SP3, ext4 r/w support is a kernel option away, unlike in SP2 where they make you hunt around for the additional RPM needed<br>
<p>
<a href="https://www.suse.com/releasenotes/x86_64/SUSE-SLES/11-SP3/">https://www.suse.com/releasenotes/x86_64/SUSE-SLES/11-SP3/</a><br>
<p>
Still not supported though, as you said. Bizarre decision.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/577448/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor577453"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 18, 2013 9:37 UTC (Wed)
                               by <b>anselm</b> (subscriber, #2796)
                              [<a href="/Articles/577453/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote><em>Still not supported though, as you said.</em></blockquote>
<p>And that's exactly the thing.</p>
<p>
Even if »ext4 r/w support is a kernel option away«, on SLES you're not supposed to run your own kernels if you want your installation to be supported. And who would ever want to run SLES in the first place if it wasn't for the support?
</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/577453/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
<a name="CommAnchor576839"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ZFS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 3:42 UTC (Fri)
                               by <b>grahame</b> (guest, #5823)
                              [<a href="/Articles/576839/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
While ZFS can't be merged into the kernel, it's still compelling on Linux. Have been using the Ubuntu-ZFS PPA for years with no problems. I don't run / on ZFS, but I run pretty much everything else with it. It's being run on some fairly large storage installations I know of - I wonder if that's one reason BTRFS isn't getting so much traction?<br>
<p>
Anyone know why full data checksums are considered too expensive for BTRFS? I'm running ZFS and seeing great performance (you do need a fair whack of memory) -- the checksumming doesn't seem to be a big problem on a modern system. It's very nice to know your data is actually there, too -- once you get out to storing petabytes of data, you will start to see data corruption occasionally.<br>
<p>
Scrub vs. fsck is a huge win on systems with large filesystems. My experience of ext4 is that it will develop problems over time, and if you've got a huge partition fsck can easily take a day -- and you're offline for that time. From what I know btrfs scrub isn't quite so solid as ZFS?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576839/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor576858"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ZFS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 10:11 UTC (Fri)
                               by <b>cwillu</b> (guest, #67268)
                              [<a href="/Articles/576858/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
First I've heard of the checksumming thing, and I follow the mailing list and irc channels fairly closely.  <br>
<p>
Checksumming is the default; it's typically only turned off for vm images and the like, as a side-effect of disabling copy-on-write on those files (and even this is being addressed).<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576858/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor576848"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">ZFS</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 10:21 UTC (Fri)
                               by <b>iq-0</b> (subscriber, #36655)
                              [<a href="/Articles/576848/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
It isn't true that data checksums are too expensive for btrfs, but using them does cost you some performance. And there are people that will tolerate almost *no* performance degradation (ofter for good reasons).<br>
<p>
Data checksumming is a good feature but there are enough cases where people might not want to bother with it but where they're still interested in e.g. snapshotting support, transparent compression, deduplication or incremental send/receive.<br>
<p>
The reason why btrfs isn't being picked up as much as zfs: Maturity. In the beginning zfs had much the same issues and uptime was rather slow. But it has aged pretty well and is now a pretty much proven filesystem. Btrfs still has some rough edges which make it a less than ideal filesystem for the layman, but it does have the features and they really work. When more people are using it, so will the tooling improve and will the filesystem be considered the default choice for most common uses.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576848/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor576844"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SailfishOS on Jolla phones</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 6:16 UTC (Fri)
                               by <b>zdzichu</b> (subscriber, #17118)
                              [<a href="/Articles/576844/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Recently released Jolla phone, running Sailfish, do use btrfs. The "recovery image" is stored as btrfs snapshot of stock install.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576844/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor576862"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">SailfishOS on Jolla phones</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 11:36 UTC (Fri)
                               by <b>ttonino</b> (guest, #4073)
                              [<a href="/Articles/576862/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Indeed the snapshots are very useful to integrate into an OS. For example the way Windows installs updates into a transaction: it all gets installed or nothing is installed. Or the reverse: if an update is not suitable, roll it back by switching to another snapshot.<br>
<p>
It could solve quite some problems...<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576862/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor576875"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 14:45 UTC (Fri)
                               by <b>ibukanov</b> (guest, #3942)
                              [<a href="/Articles/576875/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A year ago I tried Btrfs at home on a MacMini with Fedora 17. After couple of months it failed. Included fsck also crashed with double-free so it was complete loss of data. After that the box run flawlessly with ext4 and periodic checksumming of all files just to make sure that the hard drive works.<br>
<p>
I could accept a bug in a new file system code, but a bug with double-free in fsck in read-only mode just told me about bad test coverage for a very important recovery tool.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576875/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor576915"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 13, 2013 15:30 UTC (Fri)
                               by <b>leoc</b> (guest, #39773)
                              [<a href="/Articles/576915/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I used it exclusively on fedora 19 and found it extremely stable, but it really suffered from too much thrashing on my T61 with a 64GB SSD. When I upgraded to Fedora 20 I went back to ext4 but I find I miss many of the more useful features like inline compression and volume management.
      
          <div class="CommentReplyButton">
            <form action="/Articles/576915/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor576973"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Btrfs/fsck bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2013 0:54 UTC (Sat)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/576973/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <blockquote>
I could accept a bug in a new file system code, but a bug with double-free in fsck in read-only mode just told me about bad test coverage for a very important recovery tool.
</blockquote>
<p>
I don't follow the comparison.  Why is a bug in new file system code more acceptable than one in fsck?  Or harder to catch with testing?
<p>
I can make a case for the opposite:  If I were allocating resources for finding (or preventing) bugs between file system code and fsck, I would give lower priority to fsck.  You have all the time in the world to fix the double-free in fsck and recover your data, but if broken file system code failed to store the data, you're screwed regardless of how well fsck works.

      
          <div class="CommentReplyButton">
            <form action="/Articles/576973/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor576979"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Btrfs/fsck bugs</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 14, 2013 8:58 UTC (Sat)
                               by <b>ibukanov</b> (guest, #3942)
                              [<a href="/Articles/576979/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
fsck is a user-space utility that can be run with all those extra checks like setting MALLOC_CHECK_, using valgrind etc. Tools for the kernel code just not so good.<br>
<p>
<font class="QuotedText">&gt; I would give lower priority to fsck.</font><br>
<p>
For me working fsck gives an extra confidence that the data can be recovered as there are at least 2 types of code (fylesystem itself mounted read-only and the checker) that one can use after bugs. That was the reason that I tried it only at Fedora 17 when the long-promised fsck for Btrfs was finally appeared after at least 2 year delay. I suppose that in turn contributed to the delays with wider Btrfs usage.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/576979/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor577644"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 19, 2013 2:55 UTC (Thu)
                               by <b>heijo</b> (guest, #88363)
                              [<a href="/Articles/577644/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Is it free of known bugs causing unrecoverable data corruption?<br>
<p>
How much time has passed since the last bug causing unrecoverable data corruption has been fixed?<br>
<p>
Is there any study of the probability that btrfs is free from such bugs? (since, obviously, a filesystem is only usable if that is considered to be near certainty)<br>
<p>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/577644/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor577646"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 19, 2013 2:57 UTC (Thu)
                               by <b>heijo</b> (guest, #88363)
                              [<a href="/Articles/577646/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Also, what about SSD performance?<br>
<p>
Is the btrfs design optimal for SSDs?<br>
<p>
With 1TB SSDs now going for $500, everyone is soon going to use them for all their main data storage needs, which is what needs to be fast on desktops, so it's essential that the default filesystem is optimal for them.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/577646/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor577905"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">The Btrfs filesystem: An introduction</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 20, 2013 20:01 UTC (Fri)
                               by <b>JanC_</b> (guest, #34940)
                              [<a href="/Articles/577905/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
I am pretty sure you can find fairly recent "data corruption" bug fixes for almost every popular linux filesystem.  It would be more useful to check how often such bugs were found/fixed during the last 1-2 years, and how likely those were to be triggered in real world use cases.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/577905/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2013, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
