        <!DOCTYPE html>
        <html lang="en">
        <head><title>LogFS returns [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/363572/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/362781/">Return to the Kernel page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/363572/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>LogFS returns</h1>
</div>
<div class="ArticleText">
<blockquote class="ad">
<b>We're bad at marketing</b>
<p>
We can admit it, marketing is not our strong suit. Our strength is
writing the kind of articles that developers, administrators, and
free-software supporters depend on to know what is going on in the
Linux world. Please <a href="/Promo/nsn-bad/subscribe">subscribe today</a> to help us keep doing that, and so
we donâ€™t have to get good at marketing.
</blockquote>
<div class="FeatureByline">
           By <b>Jonathan Corbet</b><br>November 24, 2009</br>
           </div>
LogFS is a longstanding project by J&ouml;rn Engel to create a filesystem
for contemporary solid-state storage devices; it was last <a
href="http://lwn.net/Articles/234441/">covered here</a> in May, 2007.
Since then, LogFS has mostly disappeared from view.  As of
November&nbsp;20, though, <a href="http://lwn.net/Articles/363198/">LogFS
is back</a> and, seemingly, ready for a mainline merge.  J&ouml;rn says:
<p>
<div class="BigQuote">
	Logfs has been around a couple of times.  Linus last word was "go
	and don't come back until all format changes are done".  Or
	something along those lines at least.
	Format changes are done.  And I don't even intend to break
	git-bisect for anyone crazy enough to use logfs for&nbsp;/.
</div>
<p>
Sufficiently crazy users seem to be relatively scarce so far.  But having
more options for upcoming hardware can only be a good thing; it will be
interesting to see what results come out as people start to play with this
new filesystem.<br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Kernel/Index">Kernel</a></td><td><a href="/Kernel/Index#LogFS">LogFS</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/363572/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor363853"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LogFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 26, 2009 7:16 UTC (Thu)
                               by <b>johnflux</b> (guest, #58833)
                              [<a href="/Articles/363853/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Will this allows us to rollback the system to any point in time etc?  Those sorts of features, on the face of it, would be to come for free?<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/363853/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor363871"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LogFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 26, 2009 9:06 UTC (Thu)
                               by <b>joern</b> (guest, #22392)
                              [<a href="/Articles/363871/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Many people initially thought that, me included.  But the answer is no.<br>
<p>
Going back to _any_ point in time only works with near-infinite storage.  If you ever write more data than fits your medium, something previously deleted will be overwritten.<br>
<p>
The garbage collector makes things worse.  As you might know, it has to copy around existing data in order to free larger segments.  A corollary is that with a medium that is N% full, the worst case is that each segment is also N% full and the garbage collector will waste N% of the bandwidth, leaving 100-N% for the user to do real work.  If your filesystem is 90% full, performance may drop to 10%.<br>
<p>
So if the filesystem were to give any sort of guarantee that (some) old data could be recovered, the amount of available free space would drop, hurting performance.  Definitely not a free feature.<br>
<p>
Maybe I should add that performance does not necessarily drop as dramatically.  If the filesystem did a good job when writing the data, it will have seperated long-living data from short-living data.  To do so perfectly requires a chrystal ball, but even by pure accident, data that is written at the same time is often also deleted at the same time.  Therefore the worst case of every segment being exactly N% full is exceedingly rare and real performance will better than the calculated worst case above.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/363871/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor363887"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LogFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 26, 2009 9:46 UTC (Thu)
                               by <b>johnflux</b> (guest, #58833)
                              [<a href="/Articles/363887/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
A "typical" desktop user doesn't really use most of their typically 1TB hard disk.  It could be years before it needs to overwrite any existing data.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/363887/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor363910"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LogFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Nov 26, 2009 11:28 UTC (Thu)
                               by <b>joern</b> (guest, #22392)
                              [<a href="/Articles/363910/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
If you have a hard disk, I would suggest you try btrfs instead.  It was designed for spinning rust, logfs was designed for leaky electron traps.<br>
<p>
But if you can guarantee that the total amount of data ever written does not exceed the size of your medium, historical data would indeed stay around.  You cannot access deleted data through the filesystem code itself, but you could write a dump tool that goes back in time.<br>
<p>
How that dump tool would behave once the garbage collector has to reuse old segments is another question. ;)<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/363910/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor364920"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">LogFS returns</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Dec 3, 2009 13:40 UTC (Thu)
                               by <b>forthy</b> (guest, #1525)
                              [<a href="/Articles/364920/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <p>AFAIK, in NILFS, which is another log structured file system, it comes
for free - the garbage collector will reclaim those snapshots over time,
though, but there's an easy way to access those snapshots, as long as they
are there.</p>

<p>For "rotating rust", I'm far from sure that current file systems are
optimized for disks at all.  First of all, the "best" block size for a
random access medium is one where transfer time=access time.  A
contemporary hard disk can read about 1MB or seek to another location, so
block size should be 1MB (increasing to 2MB next year or so ;-).  This
should certainly contain a whole bunch of small files when used for small
files, but still, access granularity below 1MB doesn't make sense. 
Second, metadata: For all "normal" use, main memory is big enough to keep
all metadata in main memory.  Keep a log on the disk where you write your
metadata transactions sequentially, and on unmount (and when the log
exceeds a certain size), dump the whole metadata on disk.  Would make live
a lot easier for the spinning rust.</p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/364920/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2009, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
